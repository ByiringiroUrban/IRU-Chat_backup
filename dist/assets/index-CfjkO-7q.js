var L6=r=>{throw TypeError(r)};var uN=(r,s,a)=>s.has(r)||L6("Cannot "+a);var $e=(r,s,a)=>(uN(r,s,"read from private field"),a?a.call(r):s.get(r)),Gn=(r,s,a)=>s.has(r)?L6("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(r):s.set(r,a),cn=(r,s,a,c)=>(uN(r,s,"write to private field"),c?c.call(r,a):s.set(r,a),a),ri=(r,s,a)=>(uN(r,s,"access private method"),a);var av=(r,s,a,c)=>({set _(h){cn(r,s,h,a)},get _(){return $e(r,s,c)}});function Xhe(r,s){for(var a=0;a<s.length;a++){const c=s[a];if(typeof c!="string"&&!Array.isArray(c)){for(const h in c)if(h!=="default"&&!(h in r)){const f=Object.getOwnPropertyDescriptor(c,h);f&&Object.defineProperty(r,h,f.get?f:{enumerable:!0,get:()=>c[h]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))c(h);new MutationObserver(h=>{for(const f of h)if(f.type==="childList")for(const _ of f.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&c(_)}).observe(document,{childList:!0,subtree:!0});function a(h){const f={};return h.integrity&&(f.integrity=h.integrity),h.referrerPolicy&&(f.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?f.credentials="include":h.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function c(h){if(h.ep)return;h.ep=!0;const f=a(h);fetch(h.href,f)}})();var cv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nI(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var EG={exports:{}},tS={},vG={exports:{}},In={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X0=Symbol.for("react.element"),Jhe=Symbol.for("react.portal"),Qhe=Symbol.for("react.fragment"),Zhe=Symbol.for("react.strict_mode"),epe=Symbol.for("react.profiler"),tpe=Symbol.for("react.provider"),npe=Symbol.for("react.context"),rpe=Symbol.for("react.forward_ref"),spe=Symbol.for("react.suspense"),ipe=Symbol.for("react.memo"),ope=Symbol.for("react.lazy"),M6=Symbol.iterator;function ape(r){return r===null||typeof r!="object"?null:(r=M6&&r[M6]||r["@@iterator"],typeof r=="function"?r:null)}var bG={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},SG=Object.assign,xG={};function Fm(r,s,a){this.props=r,this.context=s,this.refs=xG,this.updater=a||bG}Fm.prototype.isReactComponent={};Fm.prototype.setState=function(r,s){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,s,"setState")};Fm.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function wG(){}wG.prototype=Fm.prototype;function rI(r,s,a){this.props=r,this.context=s,this.refs=xG,this.updater=a||bG}var sI=rI.prototype=new wG;sI.constructor=rI;SG(sI,Fm.prototype);sI.isPureReactComponent=!0;var j6=Array.isArray,TG=Object.prototype.hasOwnProperty,iI={current:null},CG={key:!0,ref:!0,__self:!0,__source:!0};function RG(r,s,a){var c,h={},f=null,_=null;if(s!=null)for(c in s.ref!==void 0&&(_=s.ref),s.key!==void 0&&(f=""+s.key),s)TG.call(s,c)&&!CG.hasOwnProperty(c)&&(h[c]=s[c]);var E=arguments.length-2;if(E===1)h.children=a;else if(1<E){for(var v=Array(E),x=0;x<E;x++)v[x]=arguments[x+2];h.children=v}if(r&&r.defaultProps)for(c in E=r.defaultProps,E)h[c]===void 0&&(h[c]=E[c]);return{$$typeof:X0,type:r,key:f,ref:_,props:h,_owner:iI.current}}function cpe(r,s){return{$$typeof:X0,type:r.type,key:s,ref:r.ref,props:r.props,_owner:r._owner}}function oI(r){return typeof r=="object"&&r!==null&&r.$$typeof===X0}function lpe(r){var s={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(a){return s[a]})}var U6=/\/+/g;function hN(r,s){return typeof r=="object"&&r!==null&&r.key!=null?lpe(""+r.key):s.toString(36)}function Vv(r,s,a,c,h){var f=typeof r;(f==="undefined"||f==="boolean")&&(r=null);var _=!1;if(r===null)_=!0;else switch(f){case"string":case"number":_=!0;break;case"object":switch(r.$$typeof){case X0:case Jhe:_=!0}}if(_)return _=r,h=h(_),r=c===""?"."+hN(_,0):c,j6(h)?(a="",r!=null&&(a=r.replace(U6,"$&/")+"/"),Vv(h,s,a,"",function(x){return x})):h!=null&&(oI(h)&&(h=cpe(h,a+(!h.key||_&&_.key===h.key?"":(""+h.key).replace(U6,"$&/")+"/")+r)),s.push(h)),1;if(_=0,c=c===""?".":c+":",j6(r))for(var E=0;E<r.length;E++){f=r[E];var v=c+hN(f,E);_+=Vv(f,s,a,v,h)}else if(v=ape(r),typeof v=="function")for(r=v.call(r),E=0;!(f=r.next()).done;)f=f.value,v=c+hN(f,E++),_+=Vv(f,s,a,v,h);else if(f==="object")throw s=String(r),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return _}function lv(r,s,a){if(r==null)return r;var c=[],h=0;return Vv(r,c,"","",function(f){return s.call(a,f,h++)}),c}function dpe(r){if(r._status===-1){var s=r._result;s=s(),s.then(function(a){(r._status===0||r._status===-1)&&(r._status=1,r._result=a)},function(a){(r._status===0||r._status===-1)&&(r._status=2,r._result=a)}),r._status===-1&&(r._status=0,r._result=s)}if(r._status===1)return r._result.default;throw r._result}var Ri={current:null},Fv={transition:null},upe={ReactCurrentDispatcher:Ri,ReactCurrentBatchConfig:Fv,ReactCurrentOwner:iI};function NG(){throw Error("act(...) is not supported in production builds of React.")}In.Children={map:lv,forEach:function(r,s,a){lv(r,function(){s.apply(this,arguments)},a)},count:function(r){var s=0;return lv(r,function(){s++}),s},toArray:function(r){return lv(r,function(s){return s})||[]},only:function(r){if(!oI(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};In.Component=Fm;In.Fragment=Qhe;In.Profiler=epe;In.PureComponent=rI;In.StrictMode=Zhe;In.Suspense=spe;In.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=upe;In.act=NG;In.cloneElement=function(r,s,a){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var c=SG({},r.props),h=r.key,f=r.ref,_=r._owner;if(s!=null){if(s.ref!==void 0&&(f=s.ref,_=iI.current),s.key!==void 0&&(h=""+s.key),r.type&&r.type.defaultProps)var E=r.type.defaultProps;for(v in s)TG.call(s,v)&&!CG.hasOwnProperty(v)&&(c[v]=s[v]===void 0&&E!==void 0?E[v]:s[v])}var v=arguments.length-2;if(v===1)c.children=a;else if(1<v){E=Array(v);for(var x=0;x<v;x++)E[x]=arguments[x+2];c.children=E}return{$$typeof:X0,type:r.type,key:h,ref:f,props:c,_owner:_}};In.createContext=function(r){return r={$$typeof:npe,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:tpe,_context:r},r.Consumer=r};In.createElement=RG;In.createFactory=function(r){var s=RG.bind(null,r);return s.type=r,s};In.createRef=function(){return{current:null}};In.forwardRef=function(r){return{$$typeof:rpe,render:r}};In.isValidElement=oI;In.lazy=function(r){return{$$typeof:ope,_payload:{_status:-1,_result:r},_init:dpe}};In.memo=function(r,s){return{$$typeof:ipe,type:r,compare:s===void 0?null:s}};In.startTransition=function(r){var s=Fv.transition;Fv.transition={};try{r()}finally{Fv.transition=s}};In.unstable_act=NG;In.useCallback=function(r,s){return Ri.current.useCallback(r,s)};In.useContext=function(r){return Ri.current.useContext(r)};In.useDebugValue=function(){};In.useDeferredValue=function(r){return Ri.current.useDeferredValue(r)};In.useEffect=function(r,s){return Ri.current.useEffect(r,s)};In.useId=function(){return Ri.current.useId()};In.useImperativeHandle=function(r,s,a){return Ri.current.useImperativeHandle(r,s,a)};In.useInsertionEffect=function(r,s){return Ri.current.useInsertionEffect(r,s)};In.useLayoutEffect=function(r,s){return Ri.current.useLayoutEffect(r,s)};In.useMemo=function(r,s){return Ri.current.useMemo(r,s)};In.useReducer=function(r,s,a){return Ri.current.useReducer(r,s,a)};In.useRef=function(r){return Ri.current.useRef(r)};In.useState=function(r){return Ri.current.useState(r)};In.useSyncExternalStore=function(r,s,a){return Ri.current.useSyncExternalStore(r,s,a)};In.useTransition=function(){return Ri.current.useTransition()};In.version="18.3.1";vG.exports=In;var V=vG.exports;const rt=nI(V),AG=Xhe({__proto__:null,default:rt},[V]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hpe=V,ppe=Symbol.for("react.element"),mpe=Symbol.for("react.fragment"),fpe=Object.prototype.hasOwnProperty,gpe=hpe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_pe={key:!0,ref:!0,__self:!0,__source:!0};function IG(r,s,a){var c,h={},f=null,_=null;a!==void 0&&(f=""+a),s.key!==void 0&&(f=""+s.key),s.ref!==void 0&&(_=s.ref);for(c in s)fpe.call(s,c)&&!_pe.hasOwnProperty(c)&&(h[c]=s[c]);if(r&&r.defaultProps)for(c in s=r.defaultProps,s)h[c]===void 0&&(h[c]=s[c]);return{$$typeof:ppe,type:r,key:f,ref:_,props:h,_owner:gpe.current}}tS.Fragment=mpe;tS.jsx=IG;tS.jsxs=IG;EG.exports=tS;var d=EG.exports,OG={exports:{}},vo={},PG={exports:{}},DG={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function s(le,ve){var Le=le.length;le.push(ve);e:for(;0<Le;){var qe=Le-1>>>1,We=le[qe];if(0<h(We,ve))le[qe]=ve,le[Le]=We,Le=qe;else break e}}function a(le){return le.length===0?null:le[0]}function c(le){if(le.length===0)return null;var ve=le[0],Le=le.pop();if(Le!==ve){le[0]=Le;e:for(var qe=0,We=le.length,xt=We>>>1;qe<xt;){var bt=2*(qe+1)-1,$t=le[bt],vt=bt+1,ut=le[vt];if(0>h($t,Le))vt<We&&0>h(ut,$t)?(le[qe]=ut,le[vt]=Le,qe=vt):(le[qe]=$t,le[bt]=Le,qe=bt);else if(vt<We&&0>h(ut,Le))le[qe]=ut,le[vt]=Le,qe=vt;else break e}}return ve}function h(le,ve){var Le=le.sortIndex-ve.sortIndex;return Le!==0?Le:le.id-ve.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;r.unstable_now=function(){return f.now()}}else{var _=Date,E=_.now();r.unstable_now=function(){return _.now()-E}}var v=[],x=[],T=1,R=null,N=3,L=!1,j=!1,F=!1,P=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,U=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function B(le){for(var ve=a(x);ve!==null;){if(ve.callback===null)c(x);else if(ve.startTime<=le)c(x),ve.sortIndex=ve.expirationTime,s(v,ve);else break;ve=a(x)}}function K(le){if(F=!1,B(le),!j)if(a(v)!==null)j=!0,Xe(J);else{var ve=a(x);ve!==null&&Re(K,ve.startTime-le)}}function J(le,ve){j=!1,F&&(F=!1,M(ie),ie=-1),L=!0;var Le=N;try{for(B(ve),R=a(v);R!==null&&(!(R.expirationTime>ve)||le&&!Ne());){var qe=R.callback;if(typeof qe=="function"){R.callback=null,N=R.priorityLevel;var We=qe(R.expirationTime<=ve);ve=r.unstable_now(),typeof We=="function"?R.callback=We:R===a(v)&&c(v),B(ve)}else c(v);R=a(v)}if(R!==null)var xt=!0;else{var bt=a(x);bt!==null&&Re(K,bt.startTime-ve),xt=!1}return xt}finally{R=null,N=Le,L=!1}}var te=!1,se=null,ie=-1,ue=5,de=-1;function Ne(){return!(r.unstable_now()-de<ue)}function Ce(){if(se!==null){var le=r.unstable_now();de=le;var ve=!0;try{ve=se(!0,le)}finally{ve?tt():(te=!1,se=null)}}else te=!1}var tt;if(typeof U=="function")tt=function(){U(Ce)};else if(typeof MessageChannel<"u"){var Se=new MessageChannel,Ge=Se.port2;Se.port1.onmessage=Ce,tt=function(){Ge.postMessage(null)}}else tt=function(){P(Ce,0)};function Xe(le){se=le,te||(te=!0,tt())}function Re(le,ve){ie=P(function(){le(r.unstable_now())},ve)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(le){le.callback=null},r.unstable_continueExecution=function(){j||L||(j=!0,Xe(J))},r.unstable_forceFrameRate=function(le){0>le||125<le?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ue=0<le?Math.floor(1e3/le):5},r.unstable_getCurrentPriorityLevel=function(){return N},r.unstable_getFirstCallbackNode=function(){return a(v)},r.unstable_next=function(le){switch(N){case 1:case 2:case 3:var ve=3;break;default:ve=N}var Le=N;N=ve;try{return le()}finally{N=Le}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(le,ve){switch(le){case 1:case 2:case 3:case 4:case 5:break;default:le=3}var Le=N;N=le;try{return ve()}finally{N=Le}},r.unstable_scheduleCallback=function(le,ve,Le){var qe=r.unstable_now();switch(typeof Le=="object"&&Le!==null?(Le=Le.delay,Le=typeof Le=="number"&&0<Le?qe+Le:qe):Le=qe,le){case 1:var We=-1;break;case 2:We=250;break;case 5:We=1073741823;break;case 4:We=1e4;break;default:We=5e3}return We=Le+We,le={id:T++,callback:ve,priorityLevel:le,startTime:Le,expirationTime:We,sortIndex:-1},Le>qe?(le.sortIndex=Le,s(x,le),a(v)===null&&le===a(x)&&(F?(M(ie),ie=-1):F=!0,Re(K,Le-qe))):(le.sortIndex=We,s(v,le),j||L||(j=!0,Xe(J))),le},r.unstable_shouldYield=Ne,r.unstable_wrapCallback=function(le){var ve=N;return function(){var Le=N;N=ve;try{return le.apply(this,arguments)}finally{N=Le}}}})(DG);PG.exports=DG;var ype=PG.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Epe=V,_o=ype;function Qe(r){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+r,a=1;a<arguments.length;a++)s+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var kG=new Set,p0={};function hh(r,s){Rm(r,s),Rm(r+"Capture",s)}function Rm(r,s){for(p0[r]=s,r=0;r<s.length;r++)kG.add(s[r])}var cl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),h1=Object.prototype.hasOwnProperty,vpe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,V6={},F6={};function bpe(r){return h1.call(F6,r)?!0:h1.call(V6,r)?!1:vpe.test(r)?F6[r]=!0:(V6[r]=!0,!1)}function Spe(r,s,a,c){if(a!==null&&a.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return c?!1:a!==null?!a.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function xpe(r,s,a,c){if(s===null||typeof s>"u"||Spe(r,s,a,c))return!0;if(c)return!1;if(a!==null)switch(a.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function Ni(r,s,a,c,h,f,_){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=c,this.attributeNamespace=h,this.mustUseProperty=a,this.propertyName=r,this.type=s,this.sanitizeURL=f,this.removeEmptyString=_}var Ys={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){Ys[r]=new Ni(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var s=r[0];Ys[s]=new Ni(s,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){Ys[r]=new Ni(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){Ys[r]=new Ni(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){Ys[r]=new Ni(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){Ys[r]=new Ni(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){Ys[r]=new Ni(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){Ys[r]=new Ni(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){Ys[r]=new Ni(r,5,!1,r.toLowerCase(),null,!1,!1)});var aI=/[\-:]([a-z])/g;function cI(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var s=r.replace(aI,cI);Ys[s]=new Ni(s,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var s=r.replace(aI,cI);Ys[s]=new Ni(s,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var s=r.replace(aI,cI);Ys[s]=new Ni(s,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){Ys[r]=new Ni(r,1,!1,r.toLowerCase(),null,!1,!1)});Ys.xlinkHref=new Ni("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){Ys[r]=new Ni(r,1,!1,r.toLowerCase(),null,!0,!0)});function lI(r,s,a,c){var h=Ys.hasOwnProperty(s)?Ys[s]:null;(h!==null?h.type!==0:c||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(xpe(s,a,h,c)&&(a=null),c||h===null?bpe(s)&&(a===null?r.removeAttribute(s):r.setAttribute(s,""+a)):h.mustUseProperty?r[h.propertyName]=a===null?h.type===3?!1:"":a:(s=h.attributeName,c=h.attributeNamespace,a===null?r.removeAttribute(s):(h=h.type,a=h===3||h===4&&a===!0?"":""+a,c?r.setAttributeNS(c,s,a):r.setAttribute(s,a))))}var yl=Epe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,dv=Symbol.for("react.element"),zp=Symbol.for("react.portal"),Yp=Symbol.for("react.fragment"),dI=Symbol.for("react.strict_mode"),p1=Symbol.for("react.profiler"),LG=Symbol.for("react.provider"),MG=Symbol.for("react.context"),uI=Symbol.for("react.forward_ref"),m1=Symbol.for("react.suspense"),f1=Symbol.for("react.suspense_list"),hI=Symbol.for("react.memo"),sd=Symbol.for("react.lazy"),jG=Symbol.for("react.offscreen"),B6=Symbol.iterator;function Cg(r){return r===null||typeof r!="object"?null:(r=B6&&r[B6]||r["@@iterator"],typeof r=="function"?r:null)}var zr=Object.assign,pN;function $g(r){if(pN===void 0)try{throw Error()}catch(a){var s=a.stack.trim().match(/\n( *(at )?)/);pN=s&&s[1]||""}return`
`+pN+r}var mN=!1;function fN(r,s){if(!r||mN)return"";mN=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(x){var c=x}Reflect.construct(r,[],s)}else{try{s.call()}catch(x){c=x}r.call(s.prototype)}else{try{throw Error()}catch(x){c=x}r()}}catch(x){if(x&&c&&typeof x.stack=="string"){for(var h=x.stack.split(`
`),f=c.stack.split(`
`),_=h.length-1,E=f.length-1;1<=_&&0<=E&&h[_]!==f[E];)E--;for(;1<=_&&0<=E;_--,E--)if(h[_]!==f[E]){if(_!==1||E!==1)do if(_--,E--,0>E||h[_]!==f[E]){var v=`
`+h[_].replace(" at new "," at ");return r.displayName&&v.includes("<anonymous>")&&(v=v.replace("<anonymous>",r.displayName)),v}while(1<=_&&0<=E);break}}}finally{mN=!1,Error.prepareStackTrace=a}return(r=r?r.displayName||r.name:"")?$g(r):""}function wpe(r){switch(r.tag){case 5:return $g(r.type);case 16:return $g("Lazy");case 13:return $g("Suspense");case 19:return $g("SuspenseList");case 0:case 2:case 15:return r=fN(r.type,!1),r;case 11:return r=fN(r.type.render,!1),r;case 1:return r=fN(r.type,!0),r;default:return""}}function g1(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Yp:return"Fragment";case zp:return"Portal";case p1:return"Profiler";case dI:return"StrictMode";case m1:return"Suspense";case f1:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case MG:return(r.displayName||"Context")+".Consumer";case LG:return(r._context.displayName||"Context")+".Provider";case uI:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case hI:return s=r.displayName||null,s!==null?s:g1(r.type)||"Memo";case sd:s=r._payload,r=r._init;try{return g1(r(s))}catch{}}return null}function Tpe(r){var s=r.type;switch(r.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=s.render,r=r.displayName||r.name||"",s.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return g1(s);case 8:return s===dI?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Rd(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function UG(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Cpe(r){var s=UG(r)?"checked":"value",a=Object.getOwnPropertyDescriptor(r.constructor.prototype,s),c=""+r[s];if(!r.hasOwnProperty(s)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var h=a.get,f=a.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return h.call(this)},set:function(_){c=""+_,f.call(this,_)}}),Object.defineProperty(r,s,{enumerable:a.enumerable}),{getValue:function(){return c},setValue:function(_){c=""+_},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function uv(r){r._valueTracker||(r._valueTracker=Cpe(r))}function VG(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var a=s.getValue(),c="";return r&&(c=UG(r)?r.checked?"true":"false":r.value),r=c,r!==a?(s.setValue(r),!0):!1}function db(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function _1(r,s){var a=s.checked;return zr({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??r._wrapperState.initialChecked})}function $6(r,s){var a=s.defaultValue==null?"":s.defaultValue,c=s.checked!=null?s.checked:s.defaultChecked;a=Rd(s.value!=null?s.value:a),r._wrapperState={initialChecked:c,initialValue:a,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function FG(r,s){s=s.checked,s!=null&&lI(r,"checked",s,!1)}function y1(r,s){FG(r,s);var a=Rd(s.value),c=s.type;if(a!=null)c==="number"?(a===0&&r.value===""||r.value!=a)&&(r.value=""+a):r.value!==""+a&&(r.value=""+a);else if(c==="submit"||c==="reset"){r.removeAttribute("value");return}s.hasOwnProperty("value")?E1(r,s.type,a):s.hasOwnProperty("defaultValue")&&E1(r,s.type,Rd(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(r.defaultChecked=!!s.defaultChecked)}function W6(r,s,a){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var c=s.type;if(!(c!=="submit"&&c!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+r._wrapperState.initialValue,a||s===r.value||(r.value=s),r.defaultValue=s}a=r.name,a!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,a!==""&&(r.name=a)}function E1(r,s,a){(s!=="number"||db(r.ownerDocument)!==r)&&(a==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+a&&(r.defaultValue=""+a))}var Wg=Array.isArray;function dm(r,s,a,c){if(r=r.options,s){s={};for(var h=0;h<a.length;h++)s["$"+a[h]]=!0;for(a=0;a<r.length;a++)h=s.hasOwnProperty("$"+r[a].value),r[a].selected!==h&&(r[a].selected=h),h&&c&&(r[a].defaultSelected=!0)}else{for(a=""+Rd(a),s=null,h=0;h<r.length;h++){if(r[h].value===a){r[h].selected=!0,c&&(r[h].defaultSelected=!0);return}s!==null||r[h].disabled||(s=r[h])}s!==null&&(s.selected=!0)}}function v1(r,s){if(s.dangerouslySetInnerHTML!=null)throw Error(Qe(91));return zr({},s,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function G6(r,s){var a=s.value;if(a==null){if(a=s.children,s=s.defaultValue,a!=null){if(s!=null)throw Error(Qe(92));if(Wg(a)){if(1<a.length)throw Error(Qe(93));a=a[0]}s=a}s==null&&(s=""),a=s}r._wrapperState={initialValue:Rd(a)}}function BG(r,s){var a=Rd(s.value),c=Rd(s.defaultValue);a!=null&&(a=""+a,a!==r.value&&(r.value=a),s.defaultValue==null&&r.defaultValue!==a&&(r.defaultValue=a)),c!=null&&(r.defaultValue=""+c)}function H6(r){var s=r.textContent;s===r._wrapperState.initialValue&&s!==""&&s!==null&&(r.value=s)}function $G(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function b1(r,s){return r==null||r==="http://www.w3.org/1999/xhtml"?$G(s):r==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var hv,WG=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,a,c,h){MSApp.execUnsafeLocalFunction(function(){return r(s,a,c,h)})}:r}(function(r,s){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=s;else{for(hv=hv||document.createElement("div"),hv.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=hv.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;s.firstChild;)r.appendChild(s.firstChild)}});function m0(r,s){if(s){var a=r.firstChild;if(a&&a===r.lastChild&&a.nodeType===3){a.nodeValue=s;return}}r.textContent=s}var Xg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Rpe=["Webkit","ms","Moz","O"];Object.keys(Xg).forEach(function(r){Rpe.forEach(function(s){s=s+r.charAt(0).toUpperCase()+r.substring(1),Xg[s]=Xg[r]})});function GG(r,s,a){return s==null||typeof s=="boolean"||s===""?"":a||typeof s!="number"||s===0||Xg.hasOwnProperty(r)&&Xg[r]?(""+s).trim():s+"px"}function HG(r,s){r=r.style;for(var a in s)if(s.hasOwnProperty(a)){var c=a.indexOf("--")===0,h=GG(a,s[a],c);a==="float"&&(a="cssFloat"),c?r.setProperty(a,h):r[a]=h}}var Npe=zr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function S1(r,s){if(s){if(Npe[r]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(Qe(137,r));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(Qe(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(Qe(61))}if(s.style!=null&&typeof s.style!="object")throw Error(Qe(62))}}function x1(r,s){if(r.indexOf("-")===-1)return typeof s.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var w1=null;function pI(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var T1=null,um=null,hm=null;function K6(r){if(r=Z0(r)){if(typeof T1!="function")throw Error(Qe(280));var s=r.stateNode;s&&(s=oS(s),T1(r.stateNode,r.type,s))}}function KG(r){um?hm?hm.push(r):hm=[r]:um=r}function zG(){if(um){var r=um,s=hm;if(hm=um=null,K6(r),s)for(r=0;r<s.length;r++)K6(s[r])}}function YG(r,s){return r(s)}function qG(){}var gN=!1;function XG(r,s,a){if(gN)return r(s,a);gN=!0;try{return YG(r,s,a)}finally{gN=!1,(um!==null||hm!==null)&&(qG(),zG())}}function f0(r,s){var a=r.stateNode;if(a===null)return null;var c=oS(a);if(c===null)return null;a=c[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(r=r.type,c=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!c;break e;default:r=!1}if(r)return null;if(a&&typeof a!="function")throw Error(Qe(231,s,typeof a));return a}var C1=!1;if(cl)try{var Rg={};Object.defineProperty(Rg,"passive",{get:function(){C1=!0}}),window.addEventListener("test",Rg,Rg),window.removeEventListener("test",Rg,Rg)}catch{C1=!1}function Ape(r,s,a,c,h,f,_,E,v){var x=Array.prototype.slice.call(arguments,3);try{s.apply(a,x)}catch(T){this.onError(T)}}var Jg=!1,ub=null,hb=!1,R1=null,Ipe={onError:function(r){Jg=!0,ub=r}};function Ope(r,s,a,c,h,f,_,E,v){Jg=!1,ub=null,Ape.apply(Ipe,arguments)}function Ppe(r,s,a,c,h,f,_,E,v){if(Ope.apply(this,arguments),Jg){if(Jg){var x=ub;Jg=!1,ub=null}else throw Error(Qe(198));hb||(hb=!0,R1=x)}}function ph(r){var s=r,a=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,s.flags&4098&&(a=s.return),r=s.return;while(r)}return s.tag===3?a:null}function JG(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function z6(r){if(ph(r)!==r)throw Error(Qe(188))}function Dpe(r){var s=r.alternate;if(!s){if(s=ph(r),s===null)throw Error(Qe(188));return s!==r?null:r}for(var a=r,c=s;;){var h=a.return;if(h===null)break;var f=h.alternate;if(f===null){if(c=h.return,c!==null){a=c;continue}break}if(h.child===f.child){for(f=h.child;f;){if(f===a)return z6(h),r;if(f===c)return z6(h),s;f=f.sibling}throw Error(Qe(188))}if(a.return!==c.return)a=h,c=f;else{for(var _=!1,E=h.child;E;){if(E===a){_=!0,a=h,c=f;break}if(E===c){_=!0,c=h,a=f;break}E=E.sibling}if(!_){for(E=f.child;E;){if(E===a){_=!0,a=f,c=h;break}if(E===c){_=!0,c=f,a=h;break}E=E.sibling}if(!_)throw Error(Qe(189))}}if(a.alternate!==c)throw Error(Qe(190))}if(a.tag!==3)throw Error(Qe(188));return a.stateNode.current===a?r:s}function QG(r){return r=Dpe(r),r!==null?ZG(r):null}function ZG(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var s=ZG(r);if(s!==null)return s;r=r.sibling}return null}var e7=_o.unstable_scheduleCallback,Y6=_o.unstable_cancelCallback,kpe=_o.unstable_shouldYield,Lpe=_o.unstable_requestPaint,is=_o.unstable_now,Mpe=_o.unstable_getCurrentPriorityLevel,mI=_o.unstable_ImmediatePriority,t7=_o.unstable_UserBlockingPriority,pb=_o.unstable_NormalPriority,jpe=_o.unstable_LowPriority,n7=_o.unstable_IdlePriority,nS=null,Cc=null;function Upe(r){if(Cc&&typeof Cc.onCommitFiberRoot=="function")try{Cc.onCommitFiberRoot(nS,r,void 0,(r.current.flags&128)===128)}catch{}}var Ba=Math.clz32?Math.clz32:Bpe,Vpe=Math.log,Fpe=Math.LN2;function Bpe(r){return r>>>=0,r===0?32:31-(Vpe(r)/Fpe|0)|0}var pv=64,mv=4194304;function Gg(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function mb(r,s){var a=r.pendingLanes;if(a===0)return 0;var c=0,h=r.suspendedLanes,f=r.pingedLanes,_=a&268435455;if(_!==0){var E=_&~h;E!==0?c=Gg(E):(f&=_,f!==0&&(c=Gg(f)))}else _=a&~h,_!==0?c=Gg(_):f!==0&&(c=Gg(f));if(c===0)return 0;if(s!==0&&s!==c&&!(s&h)&&(h=c&-c,f=s&-s,h>=f||h===16&&(f&4194240)!==0))return s;if(c&4&&(c|=a&16),s=r.entangledLanes,s!==0)for(r=r.entanglements,s&=c;0<s;)a=31-Ba(s),h=1<<a,c|=r[a],s&=~h;return c}function $pe(r,s){switch(r){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Wpe(r,s){for(var a=r.suspendedLanes,c=r.pingedLanes,h=r.expirationTimes,f=r.pendingLanes;0<f;){var _=31-Ba(f),E=1<<_,v=h[_];v===-1?(!(E&a)||E&c)&&(h[_]=$pe(E,s)):v<=s&&(r.expiredLanes|=E),f&=~E}}function N1(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function r7(){var r=pv;return pv<<=1,!(pv&4194240)&&(pv=64),r}function _N(r){for(var s=[],a=0;31>a;a++)s.push(r);return s}function J0(r,s,a){r.pendingLanes|=s,s!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,s=31-Ba(s),r[s]=a}function Gpe(r,s){var a=r.pendingLanes&~s;r.pendingLanes=s,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=s,r.mutableReadLanes&=s,r.entangledLanes&=s,s=r.entanglements;var c=r.eventTimes;for(r=r.expirationTimes;0<a;){var h=31-Ba(a),f=1<<h;s[h]=0,c[h]=-1,r[h]=-1,a&=~f}}function fI(r,s){var a=r.entangledLanes|=s;for(r=r.entanglements;a;){var c=31-Ba(a),h=1<<c;h&s|r[c]&s&&(r[c]|=s),a&=~h}}var rr=0;function s7(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var i7,gI,o7,a7,c7,A1=!1,fv=[],gd=null,_d=null,yd=null,g0=new Map,_0=new Map,od=[],Hpe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function q6(r,s){switch(r){case"focusin":case"focusout":gd=null;break;case"dragenter":case"dragleave":_d=null;break;case"mouseover":case"mouseout":yd=null;break;case"pointerover":case"pointerout":g0.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":_0.delete(s.pointerId)}}function Ng(r,s,a,c,h,f){return r===null||r.nativeEvent!==f?(r={blockedOn:s,domEventName:a,eventSystemFlags:c,nativeEvent:f,targetContainers:[h]},s!==null&&(s=Z0(s),s!==null&&gI(s)),r):(r.eventSystemFlags|=c,s=r.targetContainers,h!==null&&s.indexOf(h)===-1&&s.push(h),r)}function Kpe(r,s,a,c,h){switch(s){case"focusin":return gd=Ng(gd,r,s,a,c,h),!0;case"dragenter":return _d=Ng(_d,r,s,a,c,h),!0;case"mouseover":return yd=Ng(yd,r,s,a,c,h),!0;case"pointerover":var f=h.pointerId;return g0.set(f,Ng(g0.get(f)||null,r,s,a,c,h)),!0;case"gotpointercapture":return f=h.pointerId,_0.set(f,Ng(_0.get(f)||null,r,s,a,c,h)),!0}return!1}function l7(r){var s=Bu(r.target);if(s!==null){var a=ph(s);if(a!==null){if(s=a.tag,s===13){if(s=JG(a),s!==null){r.blockedOn=s,c7(r.priority,function(){o7(a)});return}}else if(s===3&&a.stateNode.current.memoizedState.isDehydrated){r.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Bv(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var a=I1(r.domEventName,r.eventSystemFlags,s[0],r.nativeEvent);if(a===null){a=r.nativeEvent;var c=new a.constructor(a.type,a);w1=c,a.target.dispatchEvent(c),w1=null}else return s=Z0(a),s!==null&&gI(s),r.blockedOn=a,!1;s.shift()}return!0}function X6(r,s,a){Bv(r)&&a.delete(s)}function zpe(){A1=!1,gd!==null&&Bv(gd)&&(gd=null),_d!==null&&Bv(_d)&&(_d=null),yd!==null&&Bv(yd)&&(yd=null),g0.forEach(X6),_0.forEach(X6)}function Ag(r,s){r.blockedOn===s&&(r.blockedOn=null,A1||(A1=!0,_o.unstable_scheduleCallback(_o.unstable_NormalPriority,zpe)))}function y0(r){function s(h){return Ag(h,r)}if(0<fv.length){Ag(fv[0],r);for(var a=1;a<fv.length;a++){var c=fv[a];c.blockedOn===r&&(c.blockedOn=null)}}for(gd!==null&&Ag(gd,r),_d!==null&&Ag(_d,r),yd!==null&&Ag(yd,r),g0.forEach(s),_0.forEach(s),a=0;a<od.length;a++)c=od[a],c.blockedOn===r&&(c.blockedOn=null);for(;0<od.length&&(a=od[0],a.blockedOn===null);)l7(a),a.blockedOn===null&&od.shift()}var pm=yl.ReactCurrentBatchConfig,fb=!0;function Ype(r,s,a,c){var h=rr,f=pm.transition;pm.transition=null;try{rr=1,_I(r,s,a,c)}finally{rr=h,pm.transition=f}}function qpe(r,s,a,c){var h=rr,f=pm.transition;pm.transition=null;try{rr=4,_I(r,s,a,c)}finally{rr=h,pm.transition=f}}function _I(r,s,a,c){if(fb){var h=I1(r,s,a,c);if(h===null)RN(r,s,c,gb,a),q6(r,c);else if(Kpe(h,r,s,a,c))c.stopPropagation();else if(q6(r,c),s&4&&-1<Hpe.indexOf(r)){for(;h!==null;){var f=Z0(h);if(f!==null&&i7(f),f=I1(r,s,a,c),f===null&&RN(r,s,c,gb,a),f===h)break;h=f}h!==null&&c.stopPropagation()}else RN(r,s,c,null,a)}}var gb=null;function I1(r,s,a,c){if(gb=null,r=pI(c),r=Bu(r),r!==null)if(s=ph(r),s===null)r=null;else if(a=s.tag,a===13){if(r=JG(s),r!==null)return r;r=null}else if(a===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null);return gb=r,null}function d7(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Mpe()){case mI:return 1;case t7:return 4;case pb:case jpe:return 16;case n7:return 536870912;default:return 16}default:return 16}}var pd=null,yI=null,$v=null;function u7(){if($v)return $v;var r,s=yI,a=s.length,c,h="value"in pd?pd.value:pd.textContent,f=h.length;for(r=0;r<a&&s[r]===h[r];r++);var _=a-r;for(c=1;c<=_&&s[a-c]===h[f-c];c++);return $v=h.slice(r,1<c?1-c:void 0)}function Wv(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function gv(){return!0}function J6(){return!1}function bo(r){function s(a,c,h,f,_){this._reactName=a,this._targetInst=h,this.type=c,this.nativeEvent=f,this.target=_,this.currentTarget=null;for(var E in r)r.hasOwnProperty(E)&&(a=r[E],this[E]=a?a(f):f[E]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?gv:J6,this.isPropagationStopped=J6,this}return zr(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=gv)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=gv)},persist:function(){},isPersistent:gv}),s}var Bm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},EI=bo(Bm),Q0=zr({},Bm,{view:0,detail:0}),Xpe=bo(Q0),yN,EN,Ig,rS=zr({},Q0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vI,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Ig&&(Ig&&r.type==="mousemove"?(yN=r.screenX-Ig.screenX,EN=r.screenY-Ig.screenY):EN=yN=0,Ig=r),yN)},movementY:function(r){return"movementY"in r?r.movementY:EN}}),Q6=bo(rS),Jpe=zr({},rS,{dataTransfer:0}),Qpe=bo(Jpe),Zpe=zr({},Q0,{relatedTarget:0}),vN=bo(Zpe),eme=zr({},Bm,{animationName:0,elapsedTime:0,pseudoElement:0}),tme=bo(eme),nme=zr({},Bm,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),rme=bo(nme),sme=zr({},Bm,{data:0}),Z6=bo(sme),ime={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ome={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ame={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function cme(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=ame[r])?!!s[r]:!1}function vI(){return cme}var lme=zr({},Q0,{key:function(r){if(r.key){var s=ime[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=Wv(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?ome[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vI,charCode:function(r){return r.type==="keypress"?Wv(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Wv(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),dme=bo(lme),ume=zr({},rS,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),e8=bo(ume),hme=zr({},Q0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vI}),pme=bo(hme),mme=zr({},Bm,{propertyName:0,elapsedTime:0,pseudoElement:0}),fme=bo(mme),gme=zr({},rS,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),_me=bo(gme),yme=[9,13,27,32],bI=cl&&"CompositionEvent"in window,Qg=null;cl&&"documentMode"in document&&(Qg=document.documentMode);var Eme=cl&&"TextEvent"in window&&!Qg,h7=cl&&(!bI||Qg&&8<Qg&&11>=Qg),t8=" ",n8=!1;function p7(r,s){switch(r){case"keyup":return yme.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function m7(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var qp=!1;function vme(r,s){switch(r){case"compositionend":return m7(s);case"keypress":return s.which!==32?null:(n8=!0,t8);case"textInput":return r=s.data,r===t8&&n8?null:r;default:return null}}function bme(r,s){if(qp)return r==="compositionend"||!bI&&p7(r,s)?(r=u7(),$v=yI=pd=null,qp=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return h7&&s.locale!=="ko"?null:s.data;default:return null}}var Sme={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function r8(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!Sme[r.type]:s==="textarea"}function f7(r,s,a,c){KG(c),s=_b(s,"onChange"),0<s.length&&(a=new EI("onChange","change",null,a,c),r.push({event:a,listeners:s}))}var Zg=null,E0=null;function xme(r){C7(r,0)}function sS(r){var s=Qp(r);if(VG(s))return r}function wme(r,s){if(r==="change")return s}var g7=!1;if(cl){var bN;if(cl){var SN="oninput"in document;if(!SN){var s8=document.createElement("div");s8.setAttribute("oninput","return;"),SN=typeof s8.oninput=="function"}bN=SN}else bN=!1;g7=bN&&(!document.documentMode||9<document.documentMode)}function i8(){Zg&&(Zg.detachEvent("onpropertychange",_7),E0=Zg=null)}function _7(r){if(r.propertyName==="value"&&sS(E0)){var s=[];f7(s,E0,r,pI(r)),XG(xme,s)}}function Tme(r,s,a){r==="focusin"?(i8(),Zg=s,E0=a,Zg.attachEvent("onpropertychange",_7)):r==="focusout"&&i8()}function Cme(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return sS(E0)}function Rme(r,s){if(r==="click")return sS(s)}function Nme(r,s){if(r==="input"||r==="change")return sS(s)}function Ame(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Ga=typeof Object.is=="function"?Object.is:Ame;function v0(r,s){if(Ga(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var a=Object.keys(r),c=Object.keys(s);if(a.length!==c.length)return!1;for(c=0;c<a.length;c++){var h=a[c];if(!h1.call(s,h)||!Ga(r[h],s[h]))return!1}return!0}function o8(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function a8(r,s){var a=o8(r);r=0;for(var c;a;){if(a.nodeType===3){if(c=r+a.textContent.length,r<=s&&c>=s)return{node:a,offset:s-r};r=c}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=o8(a)}}function y7(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?y7(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function E7(){for(var r=window,s=db();s instanceof r.HTMLIFrameElement;){try{var a=typeof s.contentWindow.location.href=="string"}catch{a=!1}if(a)r=s.contentWindow;else break;s=db(r.document)}return s}function SI(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}function Ime(r){var s=E7(),a=r.focusedElem,c=r.selectionRange;if(s!==a&&a&&a.ownerDocument&&y7(a.ownerDocument.documentElement,a)){if(c!==null&&SI(a)){if(s=c.start,r=c.end,r===void 0&&(r=s),"selectionStart"in a)a.selectionStart=s,a.selectionEnd=Math.min(r,a.value.length);else if(r=(s=a.ownerDocument||document)&&s.defaultView||window,r.getSelection){r=r.getSelection();var h=a.textContent.length,f=Math.min(c.start,h);c=c.end===void 0?f:Math.min(c.end,h),!r.extend&&f>c&&(h=c,c=f,f=h),h=a8(a,f);var _=a8(a,c);h&&_&&(r.rangeCount!==1||r.anchorNode!==h.node||r.anchorOffset!==h.offset||r.focusNode!==_.node||r.focusOffset!==_.offset)&&(s=s.createRange(),s.setStart(h.node,h.offset),r.removeAllRanges(),f>c?(r.addRange(s),r.extend(_.node,_.offset)):(s.setEnd(_.node,_.offset),r.addRange(s)))}}for(s=[],r=a;r=r.parentNode;)r.nodeType===1&&s.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<s.length;a++)r=s[a],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var Ome=cl&&"documentMode"in document&&11>=document.documentMode,Xp=null,O1=null,e0=null,P1=!1;function c8(r,s,a){var c=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;P1||Xp==null||Xp!==db(c)||(c=Xp,"selectionStart"in c&&SI(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),e0&&v0(e0,c)||(e0=c,c=_b(O1,"onSelect"),0<c.length&&(s=new EI("onSelect","select",null,s,a),r.push({event:s,listeners:c}),s.target=Xp)))}function _v(r,s){var a={};return a[r.toLowerCase()]=s.toLowerCase(),a["Webkit"+r]="webkit"+s,a["Moz"+r]="moz"+s,a}var Jp={animationend:_v("Animation","AnimationEnd"),animationiteration:_v("Animation","AnimationIteration"),animationstart:_v("Animation","AnimationStart"),transitionend:_v("Transition","TransitionEnd")},xN={},v7={};cl&&(v7=document.createElement("div").style,"AnimationEvent"in window||(delete Jp.animationend.animation,delete Jp.animationiteration.animation,delete Jp.animationstart.animation),"TransitionEvent"in window||delete Jp.transitionend.transition);function iS(r){if(xN[r])return xN[r];if(!Jp[r])return r;var s=Jp[r],a;for(a in s)if(s.hasOwnProperty(a)&&a in v7)return xN[r]=s[a];return r}var b7=iS("animationend"),S7=iS("animationiteration"),x7=iS("animationstart"),w7=iS("transitionend"),T7=new Map,l8="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Dd(r,s){T7.set(r,s),hh(s,[r])}for(var wN=0;wN<l8.length;wN++){var TN=l8[wN],Pme=TN.toLowerCase(),Dme=TN[0].toUpperCase()+TN.slice(1);Dd(Pme,"on"+Dme)}Dd(b7,"onAnimationEnd");Dd(S7,"onAnimationIteration");Dd(x7,"onAnimationStart");Dd("dblclick","onDoubleClick");Dd("focusin","onFocus");Dd("focusout","onBlur");Dd(w7,"onTransitionEnd");Rm("onMouseEnter",["mouseout","mouseover"]);Rm("onMouseLeave",["mouseout","mouseover"]);Rm("onPointerEnter",["pointerout","pointerover"]);Rm("onPointerLeave",["pointerout","pointerover"]);hh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));hh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));hh("onBeforeInput",["compositionend","keypress","textInput","paste"]);hh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));hh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));hh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),kme=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hg));function d8(r,s,a){var c=r.type||"unknown-event";r.currentTarget=a,Ppe(c,s,void 0,r),r.currentTarget=null}function C7(r,s){s=(s&4)!==0;for(var a=0;a<r.length;a++){var c=r[a],h=c.event;c=c.listeners;e:{var f=void 0;if(s)for(var _=c.length-1;0<=_;_--){var E=c[_],v=E.instance,x=E.currentTarget;if(E=E.listener,v!==f&&h.isPropagationStopped())break e;d8(h,E,x),f=v}else for(_=0;_<c.length;_++){if(E=c[_],v=E.instance,x=E.currentTarget,E=E.listener,v!==f&&h.isPropagationStopped())break e;d8(h,E,x),f=v}}}if(hb)throw r=R1,hb=!1,R1=null,r}function Cr(r,s){var a=s[j1];a===void 0&&(a=s[j1]=new Set);var c=r+"__bubble";a.has(c)||(R7(s,r,2,!1),a.add(c))}function CN(r,s,a){var c=0;s&&(c|=4),R7(a,r,c,s)}var yv="_reactListening"+Math.random().toString(36).slice(2);function b0(r){if(!r[yv]){r[yv]=!0,kG.forEach(function(a){a!=="selectionchange"&&(kme.has(a)||CN(a,!1,r),CN(a,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[yv]||(s[yv]=!0,CN("selectionchange",!1,s))}}function R7(r,s,a,c){switch(d7(s)){case 1:var h=Ype;break;case 4:h=qpe;break;default:h=_I}a=h.bind(null,s,a,r),h=void 0,!C1||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(h=!0),c?h!==void 0?r.addEventListener(s,a,{capture:!0,passive:h}):r.addEventListener(s,a,!0):h!==void 0?r.addEventListener(s,a,{passive:h}):r.addEventListener(s,a,!1)}function RN(r,s,a,c,h){var f=c;if(!(s&1)&&!(s&2)&&c!==null)e:for(;;){if(c===null)return;var _=c.tag;if(_===3||_===4){var E=c.stateNode.containerInfo;if(E===h||E.nodeType===8&&E.parentNode===h)break;if(_===4)for(_=c.return;_!==null;){var v=_.tag;if((v===3||v===4)&&(v=_.stateNode.containerInfo,v===h||v.nodeType===8&&v.parentNode===h))return;_=_.return}for(;E!==null;){if(_=Bu(E),_===null)return;if(v=_.tag,v===5||v===6){c=f=_;continue e}E=E.parentNode}}c=c.return}XG(function(){var x=f,T=pI(a),R=[];e:{var N=T7.get(r);if(N!==void 0){var L=EI,j=r;switch(r){case"keypress":if(Wv(a)===0)break e;case"keydown":case"keyup":L=dme;break;case"focusin":j="focus",L=vN;break;case"focusout":j="blur",L=vN;break;case"beforeblur":case"afterblur":L=vN;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":L=Q6;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":L=Qpe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":L=pme;break;case b7:case S7:case x7:L=tme;break;case w7:L=fme;break;case"scroll":L=Xpe;break;case"wheel":L=_me;break;case"copy":case"cut":case"paste":L=rme;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":L=e8}var F=(s&4)!==0,P=!F&&r==="scroll",M=F?N!==null?N+"Capture":null:N;F=[];for(var U=x,B;U!==null;){B=U;var K=B.stateNode;if(B.tag===5&&K!==null&&(B=K,M!==null&&(K=f0(U,M),K!=null&&F.push(S0(U,K,B)))),P)break;U=U.return}0<F.length&&(N=new L(N,j,null,a,T),R.push({event:N,listeners:F}))}}if(!(s&7)){e:{if(N=r==="mouseover"||r==="pointerover",L=r==="mouseout"||r==="pointerout",N&&a!==w1&&(j=a.relatedTarget||a.fromElement)&&(Bu(j)||j[ll]))break e;if((L||N)&&(N=T.window===T?T:(N=T.ownerDocument)?N.defaultView||N.parentWindow:window,L?(j=a.relatedTarget||a.toElement,L=x,j=j?Bu(j):null,j!==null&&(P=ph(j),j!==P||j.tag!==5&&j.tag!==6)&&(j=null)):(L=null,j=x),L!==j)){if(F=Q6,K="onMouseLeave",M="onMouseEnter",U="mouse",(r==="pointerout"||r==="pointerover")&&(F=e8,K="onPointerLeave",M="onPointerEnter",U="pointer"),P=L==null?N:Qp(L),B=j==null?N:Qp(j),N=new F(K,U+"leave",L,a,T),N.target=P,N.relatedTarget=B,K=null,Bu(T)===x&&(F=new F(M,U+"enter",j,a,T),F.target=B,F.relatedTarget=P,K=F),P=K,L&&j)t:{for(F=L,M=j,U=0,B=F;B;B=Wp(B))U++;for(B=0,K=M;K;K=Wp(K))B++;for(;0<U-B;)F=Wp(F),U--;for(;0<B-U;)M=Wp(M),B--;for(;U--;){if(F===M||M!==null&&F===M.alternate)break t;F=Wp(F),M=Wp(M)}F=null}else F=null;L!==null&&u8(R,N,L,F,!1),j!==null&&P!==null&&u8(R,P,j,F,!0)}}e:{if(N=x?Qp(x):window,L=N.nodeName&&N.nodeName.toLowerCase(),L==="select"||L==="input"&&N.type==="file")var J=wme;else if(r8(N))if(g7)J=Nme;else{J=Cme;var te=Tme}else(L=N.nodeName)&&L.toLowerCase()==="input"&&(N.type==="checkbox"||N.type==="radio")&&(J=Rme);if(J&&(J=J(r,x))){f7(R,J,a,T);break e}te&&te(r,N,x),r==="focusout"&&(te=N._wrapperState)&&te.controlled&&N.type==="number"&&E1(N,"number",N.value)}switch(te=x?Qp(x):window,r){case"focusin":(r8(te)||te.contentEditable==="true")&&(Xp=te,O1=x,e0=null);break;case"focusout":e0=O1=Xp=null;break;case"mousedown":P1=!0;break;case"contextmenu":case"mouseup":case"dragend":P1=!1,c8(R,a,T);break;case"selectionchange":if(Ome)break;case"keydown":case"keyup":c8(R,a,T)}var se;if(bI)e:{switch(r){case"compositionstart":var ie="onCompositionStart";break e;case"compositionend":ie="onCompositionEnd";break e;case"compositionupdate":ie="onCompositionUpdate";break e}ie=void 0}else qp?p7(r,a)&&(ie="onCompositionEnd"):r==="keydown"&&a.keyCode===229&&(ie="onCompositionStart");ie&&(h7&&a.locale!=="ko"&&(qp||ie!=="onCompositionStart"?ie==="onCompositionEnd"&&qp&&(se=u7()):(pd=T,yI="value"in pd?pd.value:pd.textContent,qp=!0)),te=_b(x,ie),0<te.length&&(ie=new Z6(ie,r,null,a,T),R.push({event:ie,listeners:te}),se?ie.data=se:(se=m7(a),se!==null&&(ie.data=se)))),(se=Eme?vme(r,a):bme(r,a))&&(x=_b(x,"onBeforeInput"),0<x.length&&(T=new Z6("onBeforeInput","beforeinput",null,a,T),R.push({event:T,listeners:x}),T.data=se))}C7(R,s)})}function S0(r,s,a){return{instance:r,listener:s,currentTarget:a}}function _b(r,s){for(var a=s+"Capture",c=[];r!==null;){var h=r,f=h.stateNode;h.tag===5&&f!==null&&(h=f,f=f0(r,a),f!=null&&c.unshift(S0(r,f,h)),f=f0(r,s),f!=null&&c.push(S0(r,f,h))),r=r.return}return c}function Wp(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function u8(r,s,a,c,h){for(var f=s._reactName,_=[];a!==null&&a!==c;){var E=a,v=E.alternate,x=E.stateNode;if(v!==null&&v===c)break;E.tag===5&&x!==null&&(E=x,h?(v=f0(a,f),v!=null&&_.unshift(S0(a,v,E))):h||(v=f0(a,f),v!=null&&_.push(S0(a,v,E)))),a=a.return}_.length!==0&&r.push({event:s,listeners:_})}var Lme=/\r\n?/g,Mme=/\u0000|\uFFFD/g;function h8(r){return(typeof r=="string"?r:""+r).replace(Lme,`
`).replace(Mme,"")}function Ev(r,s,a){if(s=h8(s),h8(r)!==s&&a)throw Error(Qe(425))}function yb(){}var D1=null,k1=null;function L1(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var M1=typeof setTimeout=="function"?setTimeout:void 0,jme=typeof clearTimeout=="function"?clearTimeout:void 0,p8=typeof Promise=="function"?Promise:void 0,Ume=typeof queueMicrotask=="function"?queueMicrotask:typeof p8<"u"?function(r){return p8.resolve(null).then(r).catch(Vme)}:M1;function Vme(r){setTimeout(function(){throw r})}function NN(r,s){var a=s,c=0;do{var h=a.nextSibling;if(r.removeChild(a),h&&h.nodeType===8)if(a=h.data,a==="/$"){if(c===0){r.removeChild(h),y0(s);return}c--}else a!=="$"&&a!=="$?"&&a!=="$!"||c++;a=h}while(a);y0(s)}function Ed(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return r}function m8(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var a=r.data;if(a==="$"||a==="$!"||a==="$?"){if(s===0)return r;s--}else a==="/$"&&s++}r=r.previousSibling}return null}var $m=Math.random().toString(36).slice(2),wc="__reactFiber$"+$m,x0="__reactProps$"+$m,ll="__reactContainer$"+$m,j1="__reactEvents$"+$m,Fme="__reactListeners$"+$m,Bme="__reactHandles$"+$m;function Bu(r){var s=r[wc];if(s)return s;for(var a=r.parentNode;a;){if(s=a[ll]||a[wc]){if(a=s.alternate,s.child!==null||a!==null&&a.child!==null)for(r=m8(r);r!==null;){if(a=r[wc])return a;r=m8(r)}return s}r=a,a=r.parentNode}return null}function Z0(r){return r=r[wc]||r[ll],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Qp(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(Qe(33))}function oS(r){return r[x0]||null}var U1=[],Zp=-1;function kd(r){return{current:r}}function Rr(r){0>Zp||(r.current=U1[Zp],U1[Zp]=null,Zp--)}function gr(r,s){Zp++,U1[Zp]=r.current,r.current=s}var Nd={},li=kd(Nd),Yi=kd(!1),rh=Nd;function Nm(r,s){var a=r.type.contextTypes;if(!a)return Nd;var c=r.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===s)return c.__reactInternalMemoizedMaskedChildContext;var h={},f;for(f in a)h[f]=s[f];return c&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=s,r.__reactInternalMemoizedMaskedChildContext=h),h}function qi(r){return r=r.childContextTypes,r!=null}function Eb(){Rr(Yi),Rr(li)}function f8(r,s,a){if(li.current!==Nd)throw Error(Qe(168));gr(li,s),gr(Yi,a)}function N7(r,s,a){var c=r.stateNode;if(s=s.childContextTypes,typeof c.getChildContext!="function")return a;c=c.getChildContext();for(var h in c)if(!(h in s))throw Error(Qe(108,Tpe(r)||"Unknown",h));return zr({},a,c)}function vb(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Nd,rh=li.current,gr(li,r),gr(Yi,Yi.current),!0}function g8(r,s,a){var c=r.stateNode;if(!c)throw Error(Qe(169));a?(r=N7(r,s,rh),c.__reactInternalMemoizedMergedChildContext=r,Rr(Yi),Rr(li),gr(li,r)):Rr(Yi),gr(Yi,a)}var nl=null,aS=!1,AN=!1;function A7(r){nl===null?nl=[r]:nl.push(r)}function $me(r){aS=!0,A7(r)}function Ld(){if(!AN&&nl!==null){AN=!0;var r=0,s=rr;try{var a=nl;for(rr=1;r<a.length;r++){var c=a[r];do c=c(!0);while(c!==null)}nl=null,aS=!1}catch(h){throw nl!==null&&(nl=nl.slice(r+1)),e7(mI,Ld),h}finally{rr=s,AN=!1}}return null}var em=[],tm=0,bb=null,Sb=0,Xo=[],Jo=0,sh=null,sl=1,il="";function Lu(r,s){em[tm++]=Sb,em[tm++]=bb,bb=r,Sb=s}function I7(r,s,a){Xo[Jo++]=sl,Xo[Jo++]=il,Xo[Jo++]=sh,sh=r;var c=sl;r=il;var h=32-Ba(c)-1;c&=~(1<<h),a+=1;var f=32-Ba(s)+h;if(30<f){var _=h-h%5;f=(c&(1<<_)-1).toString(32),c>>=_,h-=_,sl=1<<32-Ba(s)+h|a<<h|c,il=f+r}else sl=1<<f|a<<h|c,il=r}function xI(r){r.return!==null&&(Lu(r,1),I7(r,1,0))}function wI(r){for(;r===bb;)bb=em[--tm],em[tm]=null,Sb=em[--tm],em[tm]=null;for(;r===sh;)sh=Xo[--Jo],Xo[Jo]=null,il=Xo[--Jo],Xo[Jo]=null,sl=Xo[--Jo],Xo[Jo]=null}var fo=null,mo=null,kr=!1,Fa=null;function O7(r,s){var a=Zo(5,null,null,0);a.elementType="DELETED",a.stateNode=s,a.return=r,s=r.deletions,s===null?(r.deletions=[a],r.flags|=16):s.push(a)}function _8(r,s){switch(r.tag){case 5:var a=r.type;return s=s.nodeType!==1||a.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(r.stateNode=s,fo=r,mo=Ed(s.firstChild),!0):!1;case 6:return s=r.pendingProps===""||s.nodeType!==3?null:s,s!==null?(r.stateNode=s,fo=r,mo=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(a=sh!==null?{id:sl,overflow:il}:null,r.memoizedState={dehydrated:s,treeContext:a,retryLane:1073741824},a=Zo(18,null,null,0),a.stateNode=s,a.return=r,r.child=a,fo=r,mo=null,!0):!1;default:return!1}}function V1(r){return(r.mode&1)!==0&&(r.flags&128)===0}function F1(r){if(kr){var s=mo;if(s){var a=s;if(!_8(r,s)){if(V1(r))throw Error(Qe(418));s=Ed(a.nextSibling);var c=fo;s&&_8(r,s)?O7(c,a):(r.flags=r.flags&-4097|2,kr=!1,fo=r)}}else{if(V1(r))throw Error(Qe(418));r.flags=r.flags&-4097|2,kr=!1,fo=r}}}function y8(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;fo=r}function vv(r){if(r!==fo)return!1;if(!kr)return y8(r),kr=!0,!1;var s;if((s=r.tag!==3)&&!(s=r.tag!==5)&&(s=r.type,s=s!=="head"&&s!=="body"&&!L1(r.type,r.memoizedProps)),s&&(s=mo)){if(V1(r))throw P7(),Error(Qe(418));for(;s;)O7(r,s),s=Ed(s.nextSibling)}if(y8(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Qe(317));e:{for(r=r.nextSibling,s=0;r;){if(r.nodeType===8){var a=r.data;if(a==="/$"){if(s===0){mo=Ed(r.nextSibling);break e}s--}else a!=="$"&&a!=="$!"&&a!=="$?"||s++}r=r.nextSibling}mo=null}}else mo=fo?Ed(r.stateNode.nextSibling):null;return!0}function P7(){for(var r=mo;r;)r=Ed(r.nextSibling)}function Am(){mo=fo=null,kr=!1}function TI(r){Fa===null?Fa=[r]:Fa.push(r)}var Wme=yl.ReactCurrentBatchConfig;function Og(r,s,a){if(r=a.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(Qe(309));var c=a.stateNode}if(!c)throw Error(Qe(147,r));var h=c,f=""+r;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===f?s.ref:(s=function(_){var E=h.refs;_===null?delete E[f]:E[f]=_},s._stringRef=f,s)}if(typeof r!="string")throw Error(Qe(284));if(!a._owner)throw Error(Qe(290,r))}return r}function bv(r,s){throw r=Object.prototype.toString.call(s),Error(Qe(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r))}function E8(r){var s=r._init;return s(r._payload)}function D7(r){function s(M,U){if(r){var B=M.deletions;B===null?(M.deletions=[U],M.flags|=16):B.push(U)}}function a(M,U){if(!r)return null;for(;U!==null;)s(M,U),U=U.sibling;return null}function c(M,U){for(M=new Map;U!==null;)U.key!==null?M.set(U.key,U):M.set(U.index,U),U=U.sibling;return M}function h(M,U){return M=xd(M,U),M.index=0,M.sibling=null,M}function f(M,U,B){return M.index=B,r?(B=M.alternate,B!==null?(B=B.index,B<U?(M.flags|=2,U):B):(M.flags|=2,U)):(M.flags|=1048576,U)}function _(M){return r&&M.alternate===null&&(M.flags|=2),M}function E(M,U,B,K){return U===null||U.tag!==6?(U=MN(B,M.mode,K),U.return=M,U):(U=h(U,B),U.return=M,U)}function v(M,U,B,K){var J=B.type;return J===Yp?T(M,U,B.props.children,K,B.key):U!==null&&(U.elementType===J||typeof J=="object"&&J!==null&&J.$$typeof===sd&&E8(J)===U.type)?(K=h(U,B.props),K.ref=Og(M,U,B),K.return=M,K):(K=Xv(B.type,B.key,B.props,null,M.mode,K),K.ref=Og(M,U,B),K.return=M,K)}function x(M,U,B,K){return U===null||U.tag!==4||U.stateNode.containerInfo!==B.containerInfo||U.stateNode.implementation!==B.implementation?(U=jN(B,M.mode,K),U.return=M,U):(U=h(U,B.children||[]),U.return=M,U)}function T(M,U,B,K,J){return U===null||U.tag!==7?(U=Zu(B,M.mode,K,J),U.return=M,U):(U=h(U,B),U.return=M,U)}function R(M,U,B){if(typeof U=="string"&&U!==""||typeof U=="number")return U=MN(""+U,M.mode,B),U.return=M,U;if(typeof U=="object"&&U!==null){switch(U.$$typeof){case dv:return B=Xv(U.type,U.key,U.props,null,M.mode,B),B.ref=Og(M,null,U),B.return=M,B;case zp:return U=jN(U,M.mode,B),U.return=M,U;case sd:var K=U._init;return R(M,K(U._payload),B)}if(Wg(U)||Cg(U))return U=Zu(U,M.mode,B,null),U.return=M,U;bv(M,U)}return null}function N(M,U,B,K){var J=U!==null?U.key:null;if(typeof B=="string"&&B!==""||typeof B=="number")return J!==null?null:E(M,U,""+B,K);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case dv:return B.key===J?v(M,U,B,K):null;case zp:return B.key===J?x(M,U,B,K):null;case sd:return J=B._init,N(M,U,J(B._payload),K)}if(Wg(B)||Cg(B))return J!==null?null:T(M,U,B,K,null);bv(M,B)}return null}function L(M,U,B,K,J){if(typeof K=="string"&&K!==""||typeof K=="number")return M=M.get(B)||null,E(U,M,""+K,J);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case dv:return M=M.get(K.key===null?B:K.key)||null,v(U,M,K,J);case zp:return M=M.get(K.key===null?B:K.key)||null,x(U,M,K,J);case sd:var te=K._init;return L(M,U,B,te(K._payload),J)}if(Wg(K)||Cg(K))return M=M.get(B)||null,T(U,M,K,J,null);bv(U,K)}return null}function j(M,U,B,K){for(var J=null,te=null,se=U,ie=U=0,ue=null;se!==null&&ie<B.length;ie++){se.index>ie?(ue=se,se=null):ue=se.sibling;var de=N(M,se,B[ie],K);if(de===null){se===null&&(se=ue);break}r&&se&&de.alternate===null&&s(M,se),U=f(de,U,ie),te===null?J=de:te.sibling=de,te=de,se=ue}if(ie===B.length)return a(M,se),kr&&Lu(M,ie),J;if(se===null){for(;ie<B.length;ie++)se=R(M,B[ie],K),se!==null&&(U=f(se,U,ie),te===null?J=se:te.sibling=se,te=se);return kr&&Lu(M,ie),J}for(se=c(M,se);ie<B.length;ie++)ue=L(se,M,ie,B[ie],K),ue!==null&&(r&&ue.alternate!==null&&se.delete(ue.key===null?ie:ue.key),U=f(ue,U,ie),te===null?J=ue:te.sibling=ue,te=ue);return r&&se.forEach(function(Ne){return s(M,Ne)}),kr&&Lu(M,ie),J}function F(M,U,B,K){var J=Cg(B);if(typeof J!="function")throw Error(Qe(150));if(B=J.call(B),B==null)throw Error(Qe(151));for(var te=J=null,se=U,ie=U=0,ue=null,de=B.next();se!==null&&!de.done;ie++,de=B.next()){se.index>ie?(ue=se,se=null):ue=se.sibling;var Ne=N(M,se,de.value,K);if(Ne===null){se===null&&(se=ue);break}r&&se&&Ne.alternate===null&&s(M,se),U=f(Ne,U,ie),te===null?J=Ne:te.sibling=Ne,te=Ne,se=ue}if(de.done)return a(M,se),kr&&Lu(M,ie),J;if(se===null){for(;!de.done;ie++,de=B.next())de=R(M,de.value,K),de!==null&&(U=f(de,U,ie),te===null?J=de:te.sibling=de,te=de);return kr&&Lu(M,ie),J}for(se=c(M,se);!de.done;ie++,de=B.next())de=L(se,M,ie,de.value,K),de!==null&&(r&&de.alternate!==null&&se.delete(de.key===null?ie:de.key),U=f(de,U,ie),te===null?J=de:te.sibling=de,te=de);return r&&se.forEach(function(Ce){return s(M,Ce)}),kr&&Lu(M,ie),J}function P(M,U,B,K){if(typeof B=="object"&&B!==null&&B.type===Yp&&B.key===null&&(B=B.props.children),typeof B=="object"&&B!==null){switch(B.$$typeof){case dv:e:{for(var J=B.key,te=U;te!==null;){if(te.key===J){if(J=B.type,J===Yp){if(te.tag===7){a(M,te.sibling),U=h(te,B.props.children),U.return=M,M=U;break e}}else if(te.elementType===J||typeof J=="object"&&J!==null&&J.$$typeof===sd&&E8(J)===te.type){a(M,te.sibling),U=h(te,B.props),U.ref=Og(M,te,B),U.return=M,M=U;break e}a(M,te);break}else s(M,te);te=te.sibling}B.type===Yp?(U=Zu(B.props.children,M.mode,K,B.key),U.return=M,M=U):(K=Xv(B.type,B.key,B.props,null,M.mode,K),K.ref=Og(M,U,B),K.return=M,M=K)}return _(M);case zp:e:{for(te=B.key;U!==null;){if(U.key===te)if(U.tag===4&&U.stateNode.containerInfo===B.containerInfo&&U.stateNode.implementation===B.implementation){a(M,U.sibling),U=h(U,B.children||[]),U.return=M,M=U;break e}else{a(M,U);break}else s(M,U);U=U.sibling}U=jN(B,M.mode,K),U.return=M,M=U}return _(M);case sd:return te=B._init,P(M,U,te(B._payload),K)}if(Wg(B))return j(M,U,B,K);if(Cg(B))return F(M,U,B,K);bv(M,B)}return typeof B=="string"&&B!==""||typeof B=="number"?(B=""+B,U!==null&&U.tag===6?(a(M,U.sibling),U=h(U,B),U.return=M,M=U):(a(M,U),U=MN(B,M.mode,K),U.return=M,M=U),_(M)):a(M,U)}return P}var Im=D7(!0),k7=D7(!1),xb=kd(null),wb=null,nm=null,CI=null;function RI(){CI=nm=wb=null}function NI(r){var s=xb.current;Rr(xb),r._currentValue=s}function B1(r,s,a){for(;r!==null;){var c=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,c!==null&&(c.childLanes|=s)):c!==null&&(c.childLanes&s)!==s&&(c.childLanes|=s),r===a)break;r=r.return}}function mm(r,s){wb=r,CI=nm=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&s&&(Ki=!0),r.firstContext=null)}function na(r){var s=r._currentValue;if(CI!==r)if(r={context:r,memoizedValue:s,next:null},nm===null){if(wb===null)throw Error(Qe(308));nm=r,wb.dependencies={lanes:0,firstContext:r}}else nm=nm.next=r;return s}var $u=null;function AI(r){$u===null?$u=[r]:$u.push(r)}function L7(r,s,a,c){var h=s.interleaved;return h===null?(a.next=a,AI(s)):(a.next=h.next,h.next=a),s.interleaved=a,dl(r,c)}function dl(r,s){r.lanes|=s;var a=r.alternate;for(a!==null&&(a.lanes|=s),a=r,r=r.return;r!==null;)r.childLanes|=s,a=r.alternate,a!==null&&(a.childLanes|=s),a=r,r=r.return;return a.tag===3?a.stateNode:null}var id=!1;function II(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function M7(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function ol(r,s){return{eventTime:r,lane:s,tag:0,payload:null,callback:null,next:null}}function vd(r,s,a){var c=r.updateQueue;if(c===null)return null;if(c=c.shared,Bn&2){var h=c.pending;return h===null?s.next=s:(s.next=h.next,h.next=s),c.pending=s,dl(r,a)}return h=c.interleaved,h===null?(s.next=s,AI(c)):(s.next=h.next,h.next=s),c.interleaved=s,dl(r,a)}function Gv(r,s,a){if(s=s.updateQueue,s!==null&&(s=s.shared,(a&4194240)!==0)){var c=s.lanes;c&=r.pendingLanes,a|=c,s.lanes=a,fI(r,a)}}function v8(r,s){var a=r.updateQueue,c=r.alternate;if(c!==null&&(c=c.updateQueue,a===c)){var h=null,f=null;if(a=a.firstBaseUpdate,a!==null){do{var _={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};f===null?h=f=_:f=f.next=_,a=a.next}while(a!==null);f===null?h=f=s:f=f.next=s}else h=f=s;a={baseState:c.baseState,firstBaseUpdate:h,lastBaseUpdate:f,shared:c.shared,effects:c.effects},r.updateQueue=a;return}r=a.lastBaseUpdate,r===null?a.firstBaseUpdate=s:r.next=s,a.lastBaseUpdate=s}function Tb(r,s,a,c){var h=r.updateQueue;id=!1;var f=h.firstBaseUpdate,_=h.lastBaseUpdate,E=h.shared.pending;if(E!==null){h.shared.pending=null;var v=E,x=v.next;v.next=null,_===null?f=x:_.next=x,_=v;var T=r.alternate;T!==null&&(T=T.updateQueue,E=T.lastBaseUpdate,E!==_&&(E===null?T.firstBaseUpdate=x:E.next=x,T.lastBaseUpdate=v))}if(f!==null){var R=h.baseState;_=0,T=x=v=null,E=f;do{var N=E.lane,L=E.eventTime;if((c&N)===N){T!==null&&(T=T.next={eventTime:L,lane:0,tag:E.tag,payload:E.payload,callback:E.callback,next:null});e:{var j=r,F=E;switch(N=s,L=a,F.tag){case 1:if(j=F.payload,typeof j=="function"){R=j.call(L,R,N);break e}R=j;break e;case 3:j.flags=j.flags&-65537|128;case 0:if(j=F.payload,N=typeof j=="function"?j.call(L,R,N):j,N==null)break e;R=zr({},R,N);break e;case 2:id=!0}}E.callback!==null&&E.lane!==0&&(r.flags|=64,N=h.effects,N===null?h.effects=[E]:N.push(E))}else L={eventTime:L,lane:N,tag:E.tag,payload:E.payload,callback:E.callback,next:null},T===null?(x=T=L,v=R):T=T.next=L,_|=N;if(E=E.next,E===null){if(E=h.shared.pending,E===null)break;N=E,E=N.next,N.next=null,h.lastBaseUpdate=N,h.shared.pending=null}}while(!0);if(T===null&&(v=R),h.baseState=v,h.firstBaseUpdate=x,h.lastBaseUpdate=T,s=h.shared.interleaved,s!==null){h=s;do _|=h.lane,h=h.next;while(h!==s)}else f===null&&(h.shared.lanes=0);oh|=_,r.lanes=_,r.memoizedState=R}}function b8(r,s,a){if(r=s.effects,s.effects=null,r!==null)for(s=0;s<r.length;s++){var c=r[s],h=c.callback;if(h!==null){if(c.callback=null,c=a,typeof h!="function")throw Error(Qe(191,h));h.call(c)}}}var e_={},Rc=kd(e_),w0=kd(e_),T0=kd(e_);function Wu(r){if(r===e_)throw Error(Qe(174));return r}function OI(r,s){switch(gr(T0,s),gr(w0,r),gr(Rc,e_),r=s.nodeType,r){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:b1(null,"");break;default:r=r===8?s.parentNode:s,s=r.namespaceURI||null,r=r.tagName,s=b1(s,r)}Rr(Rc),gr(Rc,s)}function Om(){Rr(Rc),Rr(w0),Rr(T0)}function j7(r){Wu(T0.current);var s=Wu(Rc.current),a=b1(s,r.type);s!==a&&(gr(w0,r),gr(Rc,a))}function PI(r){w0.current===r&&(Rr(Rc),Rr(w0))}var Wr=kd(0);function Cb(r){for(var s=r;s!==null;){if(s.tag===13){var a=s.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var IN=[];function DI(){for(var r=0;r<IN.length;r++)IN[r]._workInProgressVersionPrimary=null;IN.length=0}var Hv=yl.ReactCurrentDispatcher,ON=yl.ReactCurrentBatchConfig,ih=0,Kr=null,Es=null,Ds=null,Rb=!1,t0=!1,C0=0,Gme=0;function si(){throw Error(Qe(321))}function kI(r,s){if(s===null)return!1;for(var a=0;a<s.length&&a<r.length;a++)if(!Ga(r[a],s[a]))return!1;return!0}function LI(r,s,a,c,h,f){if(ih=f,Kr=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Hv.current=r===null||r.memoizedState===null?Yme:qme,r=a(c,h),t0){f=0;do{if(t0=!1,C0=0,25<=f)throw Error(Qe(301));f+=1,Ds=Es=null,s.updateQueue=null,Hv.current=Xme,r=a(c,h)}while(t0)}if(Hv.current=Nb,s=Es!==null&&Es.next!==null,ih=0,Ds=Es=Kr=null,Rb=!1,s)throw Error(Qe(300));return r}function MI(){var r=C0!==0;return C0=0,r}function vc(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ds===null?Kr.memoizedState=Ds=r:Ds=Ds.next=r,Ds}function ra(){if(Es===null){var r=Kr.alternate;r=r!==null?r.memoizedState:null}else r=Es.next;var s=Ds===null?Kr.memoizedState:Ds.next;if(s!==null)Ds=s,Es=r;else{if(r===null)throw Error(Qe(310));Es=r,r={memoizedState:Es.memoizedState,baseState:Es.baseState,baseQueue:Es.baseQueue,queue:Es.queue,next:null},Ds===null?Kr.memoizedState=Ds=r:Ds=Ds.next=r}return Ds}function R0(r,s){return typeof s=="function"?s(r):s}function PN(r){var s=ra(),a=s.queue;if(a===null)throw Error(Qe(311));a.lastRenderedReducer=r;var c=Es,h=c.baseQueue,f=a.pending;if(f!==null){if(h!==null){var _=h.next;h.next=f.next,f.next=_}c.baseQueue=h=f,a.pending=null}if(h!==null){f=h.next,c=c.baseState;var E=_=null,v=null,x=f;do{var T=x.lane;if((ih&T)===T)v!==null&&(v=v.next={lane:0,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null}),c=x.hasEagerState?x.eagerState:r(c,x.action);else{var R={lane:T,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null};v===null?(E=v=R,_=c):v=v.next=R,Kr.lanes|=T,oh|=T}x=x.next}while(x!==null&&x!==f);v===null?_=c:v.next=E,Ga(c,s.memoizedState)||(Ki=!0),s.memoizedState=c,s.baseState=_,s.baseQueue=v,a.lastRenderedState=c}if(r=a.interleaved,r!==null){h=r;do f=h.lane,Kr.lanes|=f,oh|=f,h=h.next;while(h!==r)}else h===null&&(a.lanes=0);return[s.memoizedState,a.dispatch]}function DN(r){var s=ra(),a=s.queue;if(a===null)throw Error(Qe(311));a.lastRenderedReducer=r;var c=a.dispatch,h=a.pending,f=s.memoizedState;if(h!==null){a.pending=null;var _=h=h.next;do f=r(f,_.action),_=_.next;while(_!==h);Ga(f,s.memoizedState)||(Ki=!0),s.memoizedState=f,s.baseQueue===null&&(s.baseState=f),a.lastRenderedState=f}return[f,c]}function U7(){}function V7(r,s){var a=Kr,c=ra(),h=s(),f=!Ga(c.memoizedState,h);if(f&&(c.memoizedState=h,Ki=!0),c=c.queue,jI($7.bind(null,a,c,r),[r]),c.getSnapshot!==s||f||Ds!==null&&Ds.memoizedState.tag&1){if(a.flags|=2048,N0(9,B7.bind(null,a,c,h,s),void 0,null),ks===null)throw Error(Qe(349));ih&30||F7(a,s,h)}return h}function F7(r,s,a){r.flags|=16384,r={getSnapshot:s,value:a},s=Kr.updateQueue,s===null?(s={lastEffect:null,stores:null},Kr.updateQueue=s,s.stores=[r]):(a=s.stores,a===null?s.stores=[r]:a.push(r))}function B7(r,s,a,c){s.value=a,s.getSnapshot=c,W7(s)&&G7(r)}function $7(r,s,a){return a(function(){W7(s)&&G7(r)})}function W7(r){var s=r.getSnapshot;r=r.value;try{var a=s();return!Ga(r,a)}catch{return!0}}function G7(r){var s=dl(r,1);s!==null&&$a(s,r,1,-1)}function S8(r){var s=vc();return typeof r=="function"&&(r=r()),s.memoizedState=s.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:R0,lastRenderedState:r},s.queue=r,r=r.dispatch=zme.bind(null,Kr,r),[s.memoizedState,r]}function N0(r,s,a,c){return r={tag:r,create:s,destroy:a,deps:c,next:null},s=Kr.updateQueue,s===null?(s={lastEffect:null,stores:null},Kr.updateQueue=s,s.lastEffect=r.next=r):(a=s.lastEffect,a===null?s.lastEffect=r.next=r:(c=a.next,a.next=r,r.next=c,s.lastEffect=r)),r}function H7(){return ra().memoizedState}function Kv(r,s,a,c){var h=vc();Kr.flags|=r,h.memoizedState=N0(1|s,a,void 0,c===void 0?null:c)}function cS(r,s,a,c){var h=ra();c=c===void 0?null:c;var f=void 0;if(Es!==null){var _=Es.memoizedState;if(f=_.destroy,c!==null&&kI(c,_.deps)){h.memoizedState=N0(s,a,f,c);return}}Kr.flags|=r,h.memoizedState=N0(1|s,a,f,c)}function x8(r,s){return Kv(8390656,8,r,s)}function jI(r,s){return cS(2048,8,r,s)}function K7(r,s){return cS(4,2,r,s)}function z7(r,s){return cS(4,4,r,s)}function Y7(r,s){if(typeof s=="function")return r=r(),s(r),function(){s(null)};if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function q7(r,s,a){return a=a!=null?a.concat([r]):null,cS(4,4,Y7.bind(null,s,r),a)}function UI(){}function X7(r,s){var a=ra();s=s===void 0?null:s;var c=a.memoizedState;return c!==null&&s!==null&&kI(s,c[1])?c[0]:(a.memoizedState=[r,s],r)}function J7(r,s){var a=ra();s=s===void 0?null:s;var c=a.memoizedState;return c!==null&&s!==null&&kI(s,c[1])?c[0]:(r=r(),a.memoizedState=[r,s],r)}function Q7(r,s,a){return ih&21?(Ga(a,s)||(a=r7(),Kr.lanes|=a,oh|=a,r.baseState=!0),s):(r.baseState&&(r.baseState=!1,Ki=!0),r.memoizedState=a)}function Hme(r,s){var a=rr;rr=a!==0&&4>a?a:4,r(!0);var c=ON.transition;ON.transition={};try{r(!1),s()}finally{rr=a,ON.transition=c}}function Z7(){return ra().memoizedState}function Kme(r,s,a){var c=Sd(r);if(a={lane:c,action:a,hasEagerState:!1,eagerState:null,next:null},e9(r))t9(s,a);else if(a=L7(r,s,a,c),a!==null){var h=Ci();$a(a,r,c,h),n9(a,s,c)}}function zme(r,s,a){var c=Sd(r),h={lane:c,action:a,hasEagerState:!1,eagerState:null,next:null};if(e9(r))t9(s,h);else{var f=r.alternate;if(r.lanes===0&&(f===null||f.lanes===0)&&(f=s.lastRenderedReducer,f!==null))try{var _=s.lastRenderedState,E=f(_,a);if(h.hasEagerState=!0,h.eagerState=E,Ga(E,_)){var v=s.interleaved;v===null?(h.next=h,AI(s)):(h.next=v.next,v.next=h),s.interleaved=h;return}}catch{}finally{}a=L7(r,s,h,c),a!==null&&(h=Ci(),$a(a,r,c,h),n9(a,s,c))}}function e9(r){var s=r.alternate;return r===Kr||s!==null&&s===Kr}function t9(r,s){t0=Rb=!0;var a=r.pending;a===null?s.next=s:(s.next=a.next,a.next=s),r.pending=s}function n9(r,s,a){if(a&4194240){var c=s.lanes;c&=r.pendingLanes,a|=c,s.lanes=a,fI(r,a)}}var Nb={readContext:na,useCallback:si,useContext:si,useEffect:si,useImperativeHandle:si,useInsertionEffect:si,useLayoutEffect:si,useMemo:si,useReducer:si,useRef:si,useState:si,useDebugValue:si,useDeferredValue:si,useTransition:si,useMutableSource:si,useSyncExternalStore:si,useId:si,unstable_isNewReconciler:!1},Yme={readContext:na,useCallback:function(r,s){return vc().memoizedState=[r,s===void 0?null:s],r},useContext:na,useEffect:x8,useImperativeHandle:function(r,s,a){return a=a!=null?a.concat([r]):null,Kv(4194308,4,Y7.bind(null,s,r),a)},useLayoutEffect:function(r,s){return Kv(4194308,4,r,s)},useInsertionEffect:function(r,s){return Kv(4,2,r,s)},useMemo:function(r,s){var a=vc();return s=s===void 0?null:s,r=r(),a.memoizedState=[r,s],r},useReducer:function(r,s,a){var c=vc();return s=a!==void 0?a(s):s,c.memoizedState=c.baseState=s,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:s},c.queue=r,r=r.dispatch=Kme.bind(null,Kr,r),[c.memoizedState,r]},useRef:function(r){var s=vc();return r={current:r},s.memoizedState=r},useState:S8,useDebugValue:UI,useDeferredValue:function(r){return vc().memoizedState=r},useTransition:function(){var r=S8(!1),s=r[0];return r=Hme.bind(null,r[1]),vc().memoizedState=r,[s,r]},useMutableSource:function(){},useSyncExternalStore:function(r,s,a){var c=Kr,h=vc();if(kr){if(a===void 0)throw Error(Qe(407));a=a()}else{if(a=s(),ks===null)throw Error(Qe(349));ih&30||F7(c,s,a)}h.memoizedState=a;var f={value:a,getSnapshot:s};return h.queue=f,x8($7.bind(null,c,f,r),[r]),c.flags|=2048,N0(9,B7.bind(null,c,f,a,s),void 0,null),a},useId:function(){var r=vc(),s=ks.identifierPrefix;if(kr){var a=il,c=sl;a=(c&~(1<<32-Ba(c)-1)).toString(32)+a,s=":"+s+"R"+a,a=C0++,0<a&&(s+="H"+a.toString(32)),s+=":"}else a=Gme++,s=":"+s+"r"+a.toString(32)+":";return r.memoizedState=s},unstable_isNewReconciler:!1},qme={readContext:na,useCallback:X7,useContext:na,useEffect:jI,useImperativeHandle:q7,useInsertionEffect:K7,useLayoutEffect:z7,useMemo:J7,useReducer:PN,useRef:H7,useState:function(){return PN(R0)},useDebugValue:UI,useDeferredValue:function(r){var s=ra();return Q7(s,Es.memoizedState,r)},useTransition:function(){var r=PN(R0)[0],s=ra().memoizedState;return[r,s]},useMutableSource:U7,useSyncExternalStore:V7,useId:Z7,unstable_isNewReconciler:!1},Xme={readContext:na,useCallback:X7,useContext:na,useEffect:jI,useImperativeHandle:q7,useInsertionEffect:K7,useLayoutEffect:z7,useMemo:J7,useReducer:DN,useRef:H7,useState:function(){return DN(R0)},useDebugValue:UI,useDeferredValue:function(r){var s=ra();return Es===null?s.memoizedState=r:Q7(s,Es.memoizedState,r)},useTransition:function(){var r=DN(R0)[0],s=ra().memoizedState;return[r,s]},useMutableSource:U7,useSyncExternalStore:V7,useId:Z7,unstable_isNewReconciler:!1};function ka(r,s){if(r&&r.defaultProps){s=zr({},s),r=r.defaultProps;for(var a in r)s[a]===void 0&&(s[a]=r[a]);return s}return s}function $1(r,s,a,c){s=r.memoizedState,a=a(c,s),a=a==null?s:zr({},s,a),r.memoizedState=a,r.lanes===0&&(r.updateQueue.baseState=a)}var lS={isMounted:function(r){return(r=r._reactInternals)?ph(r)===r:!1},enqueueSetState:function(r,s,a){r=r._reactInternals;var c=Ci(),h=Sd(r),f=ol(c,h);f.payload=s,a!=null&&(f.callback=a),s=vd(r,f,h),s!==null&&($a(s,r,h,c),Gv(s,r,h))},enqueueReplaceState:function(r,s,a){r=r._reactInternals;var c=Ci(),h=Sd(r),f=ol(c,h);f.tag=1,f.payload=s,a!=null&&(f.callback=a),s=vd(r,f,h),s!==null&&($a(s,r,h,c),Gv(s,r,h))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var a=Ci(),c=Sd(r),h=ol(a,c);h.tag=2,s!=null&&(h.callback=s),s=vd(r,h,c),s!==null&&($a(s,r,c,a),Gv(s,r,c))}};function w8(r,s,a,c,h,f,_){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(c,f,_):s.prototype&&s.prototype.isPureReactComponent?!v0(a,c)||!v0(h,f):!0}function r9(r,s,a){var c=!1,h=Nd,f=s.contextType;return typeof f=="object"&&f!==null?f=na(f):(h=qi(s)?rh:li.current,c=s.contextTypes,f=(c=c!=null)?Nm(r,h):Nd),s=new s(a,f),r.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=lS,r.stateNode=s,s._reactInternals=r,c&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=h,r.__reactInternalMemoizedMaskedChildContext=f),s}function T8(r,s,a,c){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(a,c),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(a,c),s.state!==r&&lS.enqueueReplaceState(s,s.state,null)}function W1(r,s,a,c){var h=r.stateNode;h.props=a,h.state=r.memoizedState,h.refs={},II(r);var f=s.contextType;typeof f=="object"&&f!==null?h.context=na(f):(f=qi(s)?rh:li.current,h.context=Nm(r,f)),h.state=r.memoizedState,f=s.getDerivedStateFromProps,typeof f=="function"&&($1(r,s,f,a),h.state=r.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(s=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),s!==h.state&&lS.enqueueReplaceState(h,h.state,null),Tb(r,a,h,c),h.state=r.memoizedState),typeof h.componentDidMount=="function"&&(r.flags|=4194308)}function Pm(r,s){try{var a="",c=s;do a+=wpe(c),c=c.return;while(c);var h=a}catch(f){h=`
Error generating stack: `+f.message+`
`+f.stack}return{value:r,source:s,stack:h,digest:null}}function kN(r,s,a){return{value:r,source:null,stack:a??null,digest:s??null}}function G1(r,s){try{console.error(s.value)}catch(a){setTimeout(function(){throw a})}}var Jme=typeof WeakMap=="function"?WeakMap:Map;function s9(r,s,a){a=ol(-1,a),a.tag=3,a.payload={element:null};var c=s.value;return a.callback=function(){Ib||(Ib=!0,eA=c),G1(r,s)},a}function i9(r,s,a){a=ol(-1,a),a.tag=3;var c=r.type.getDerivedStateFromError;if(typeof c=="function"){var h=s.value;a.payload=function(){return c(h)},a.callback=function(){G1(r,s)}}var f=r.stateNode;return f!==null&&typeof f.componentDidCatch=="function"&&(a.callback=function(){G1(r,s),typeof c!="function"&&(bd===null?bd=new Set([this]):bd.add(this));var _=s.stack;this.componentDidCatch(s.value,{componentStack:_!==null?_:""})}),a}function C8(r,s,a){var c=r.pingCache;if(c===null){c=r.pingCache=new Jme;var h=new Set;c.set(s,h)}else h=c.get(s),h===void 0&&(h=new Set,c.set(s,h));h.has(a)||(h.add(a),r=ufe.bind(null,r,s,a),s.then(r,r))}function R8(r){do{var s;if((s=r.tag===13)&&(s=r.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return r;r=r.return}while(r!==null);return null}function N8(r,s,a,c,h){return r.mode&1?(r.flags|=65536,r.lanes=h,r):(r===s?r.flags|=65536:(r.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(s=ol(-1,1),s.tag=2,vd(a,s,1))),a.lanes|=1),r)}var Qme=yl.ReactCurrentOwner,Ki=!1;function Si(r,s,a,c){s.child=r===null?k7(s,null,a,c):Im(s,r.child,a,c)}function A8(r,s,a,c,h){a=a.render;var f=s.ref;return mm(s,h),c=LI(r,s,a,c,f,h),a=MI(),r!==null&&!Ki?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~h,ul(r,s,h)):(kr&&a&&xI(s),s.flags|=1,Si(r,s,c,h),s.child)}function I8(r,s,a,c,h){if(r===null){var f=a.type;return typeof f=="function"&&!KI(f)&&f.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(s.tag=15,s.type=f,o9(r,s,f,c,h)):(r=Xv(a.type,null,c,s,s.mode,h),r.ref=s.ref,r.return=s,s.child=r)}if(f=r.child,!(r.lanes&h)){var _=f.memoizedProps;if(a=a.compare,a=a!==null?a:v0,a(_,c)&&r.ref===s.ref)return ul(r,s,h)}return s.flags|=1,r=xd(f,c),r.ref=s.ref,r.return=s,s.child=r}function o9(r,s,a,c,h){if(r!==null){var f=r.memoizedProps;if(v0(f,c)&&r.ref===s.ref)if(Ki=!1,s.pendingProps=c=f,(r.lanes&h)!==0)r.flags&131072&&(Ki=!0);else return s.lanes=r.lanes,ul(r,s,h)}return H1(r,s,a,c,h)}function a9(r,s,a){var c=s.pendingProps,h=c.children,f=r!==null?r.memoizedState:null;if(c.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},gr(sm,ho),ho|=a;else{if(!(a&1073741824))return r=f!==null?f.baseLanes|a:a,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:r,cachePool:null,transitions:null},s.updateQueue=null,gr(sm,ho),ho|=r,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=f!==null?f.baseLanes:a,gr(sm,ho),ho|=c}else f!==null?(c=f.baseLanes|a,s.memoizedState=null):c=a,gr(sm,ho),ho|=c;return Si(r,s,h,a),s.child}function c9(r,s){var a=s.ref;(r===null&&a!==null||r!==null&&r.ref!==a)&&(s.flags|=512,s.flags|=2097152)}function H1(r,s,a,c,h){var f=qi(a)?rh:li.current;return f=Nm(s,f),mm(s,h),a=LI(r,s,a,c,f,h),c=MI(),r!==null&&!Ki?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~h,ul(r,s,h)):(kr&&c&&xI(s),s.flags|=1,Si(r,s,a,h),s.child)}function O8(r,s,a,c,h){if(qi(a)){var f=!0;vb(s)}else f=!1;if(mm(s,h),s.stateNode===null)zv(r,s),r9(s,a,c),W1(s,a,c,h),c=!0;else if(r===null){var _=s.stateNode,E=s.memoizedProps;_.props=E;var v=_.context,x=a.contextType;typeof x=="object"&&x!==null?x=na(x):(x=qi(a)?rh:li.current,x=Nm(s,x));var T=a.getDerivedStateFromProps,R=typeof T=="function"||typeof _.getSnapshotBeforeUpdate=="function";R||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(E!==c||v!==x)&&T8(s,_,c,x),id=!1;var N=s.memoizedState;_.state=N,Tb(s,c,_,h),v=s.memoizedState,E!==c||N!==v||Yi.current||id?(typeof T=="function"&&($1(s,a,T,c),v=s.memoizedState),(E=id||w8(s,a,E,c,N,v,x))?(R||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(s.flags|=4194308)):(typeof _.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=c,s.memoizedState=v),_.props=c,_.state=v,_.context=x,c=E):(typeof _.componentDidMount=="function"&&(s.flags|=4194308),c=!1)}else{_=s.stateNode,M7(r,s),E=s.memoizedProps,x=s.type===s.elementType?E:ka(s.type,E),_.props=x,R=s.pendingProps,N=_.context,v=a.contextType,typeof v=="object"&&v!==null?v=na(v):(v=qi(a)?rh:li.current,v=Nm(s,v));var L=a.getDerivedStateFromProps;(T=typeof L=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(E!==R||N!==v)&&T8(s,_,c,v),id=!1,N=s.memoizedState,_.state=N,Tb(s,c,_,h);var j=s.memoizedState;E!==R||N!==j||Yi.current||id?(typeof L=="function"&&($1(s,a,L,c),j=s.memoizedState),(x=id||w8(s,a,x,c,N,j,v)||!1)?(T||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(c,j,v),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(c,j,v)),typeof _.componentDidUpdate=="function"&&(s.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof _.componentDidUpdate!="function"||E===r.memoizedProps&&N===r.memoizedState||(s.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||E===r.memoizedProps&&N===r.memoizedState||(s.flags|=1024),s.memoizedProps=c,s.memoizedState=j),_.props=c,_.state=j,_.context=v,c=x):(typeof _.componentDidUpdate!="function"||E===r.memoizedProps&&N===r.memoizedState||(s.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||E===r.memoizedProps&&N===r.memoizedState||(s.flags|=1024),c=!1)}return K1(r,s,a,c,f,h)}function K1(r,s,a,c,h,f){c9(r,s);var _=(s.flags&128)!==0;if(!c&&!_)return h&&g8(s,a,!1),ul(r,s,f);c=s.stateNode,Qme.current=s;var E=_&&typeof a.getDerivedStateFromError!="function"?null:c.render();return s.flags|=1,r!==null&&_?(s.child=Im(s,r.child,null,f),s.child=Im(s,null,E,f)):Si(r,s,E,f),s.memoizedState=c.state,h&&g8(s,a,!0),s.child}function l9(r){var s=r.stateNode;s.pendingContext?f8(r,s.pendingContext,s.pendingContext!==s.context):s.context&&f8(r,s.context,!1),OI(r,s.containerInfo)}function P8(r,s,a,c,h){return Am(),TI(h),s.flags|=256,Si(r,s,a,c),s.child}var z1={dehydrated:null,treeContext:null,retryLane:0};function Y1(r){return{baseLanes:r,cachePool:null,transitions:null}}function d9(r,s,a){var c=s.pendingProps,h=Wr.current,f=!1,_=(s.flags&128)!==0,E;if((E=_)||(E=r!==null&&r.memoizedState===null?!1:(h&2)!==0),E?(f=!0,s.flags&=-129):(r===null||r.memoizedState!==null)&&(h|=1),gr(Wr,h&1),r===null)return F1(s),r=s.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(s.mode&1?r.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(_=c.children,r=c.fallback,f?(c=s.mode,f=s.child,_={mode:"hidden",children:_},!(c&1)&&f!==null?(f.childLanes=0,f.pendingProps=_):f=hS(_,c,0,null),r=Zu(r,c,a,null),f.return=s,r.return=s,f.sibling=r,s.child=f,s.child.memoizedState=Y1(a),s.memoizedState=z1,r):VI(s,_));if(h=r.memoizedState,h!==null&&(E=h.dehydrated,E!==null))return Zme(r,s,_,c,E,h,a);if(f){f=c.fallback,_=s.mode,h=r.child,E=h.sibling;var v={mode:"hidden",children:c.children};return!(_&1)&&s.child!==h?(c=s.child,c.childLanes=0,c.pendingProps=v,s.deletions=null):(c=xd(h,v),c.subtreeFlags=h.subtreeFlags&14680064),E!==null?f=xd(E,f):(f=Zu(f,_,a,null),f.flags|=2),f.return=s,c.return=s,c.sibling=f,s.child=c,c=f,f=s.child,_=r.child.memoizedState,_=_===null?Y1(a):{baseLanes:_.baseLanes|a,cachePool:null,transitions:_.transitions},f.memoizedState=_,f.childLanes=r.childLanes&~a,s.memoizedState=z1,c}return f=r.child,r=f.sibling,c=xd(f,{mode:"visible",children:c.children}),!(s.mode&1)&&(c.lanes=a),c.return=s,c.sibling=null,r!==null&&(a=s.deletions,a===null?(s.deletions=[r],s.flags|=16):a.push(r)),s.child=c,s.memoizedState=null,c}function VI(r,s){return s=hS({mode:"visible",children:s},r.mode,0,null),s.return=r,r.child=s}function Sv(r,s,a,c){return c!==null&&TI(c),Im(s,r.child,null,a),r=VI(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function Zme(r,s,a,c,h,f,_){if(a)return s.flags&256?(s.flags&=-257,c=kN(Error(Qe(422))),Sv(r,s,_,c)):s.memoizedState!==null?(s.child=r.child,s.flags|=128,null):(f=c.fallback,h=s.mode,c=hS({mode:"visible",children:c.children},h,0,null),f=Zu(f,h,_,null),f.flags|=2,c.return=s,f.return=s,c.sibling=f,s.child=c,s.mode&1&&Im(s,r.child,null,_),s.child.memoizedState=Y1(_),s.memoizedState=z1,f);if(!(s.mode&1))return Sv(r,s,_,null);if(h.data==="$!"){if(c=h.nextSibling&&h.nextSibling.dataset,c)var E=c.dgst;return c=E,f=Error(Qe(419)),c=kN(f,c,void 0),Sv(r,s,_,c)}if(E=(_&r.childLanes)!==0,Ki||E){if(c=ks,c!==null){switch(_&-_){case 4:h=2;break;case 16:h=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:h=32;break;case 536870912:h=268435456;break;default:h=0}h=h&(c.suspendedLanes|_)?0:h,h!==0&&h!==f.retryLane&&(f.retryLane=h,dl(r,h),$a(c,r,h,-1))}return HI(),c=kN(Error(Qe(421))),Sv(r,s,_,c)}return h.data==="$?"?(s.flags|=128,s.child=r.child,s=hfe.bind(null,r),h._reactRetry=s,null):(r=f.treeContext,mo=Ed(h.nextSibling),fo=s,kr=!0,Fa=null,r!==null&&(Xo[Jo++]=sl,Xo[Jo++]=il,Xo[Jo++]=sh,sl=r.id,il=r.overflow,sh=s),s=VI(s,c.children),s.flags|=4096,s)}function D8(r,s,a){r.lanes|=s;var c=r.alternate;c!==null&&(c.lanes|=s),B1(r.return,s,a)}function LN(r,s,a,c,h){var f=r.memoizedState;f===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:c,tail:a,tailMode:h}:(f.isBackwards=s,f.rendering=null,f.renderingStartTime=0,f.last=c,f.tail=a,f.tailMode=h)}function u9(r,s,a){var c=s.pendingProps,h=c.revealOrder,f=c.tail;if(Si(r,s,c.children,a),c=Wr.current,c&2)c=c&1|2,s.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&D8(r,a,s);else if(r.tag===19)D8(r,a,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}c&=1}if(gr(Wr,c),!(s.mode&1))s.memoizedState=null;else switch(h){case"forwards":for(a=s.child,h=null;a!==null;)r=a.alternate,r!==null&&Cb(r)===null&&(h=a),a=a.sibling;a=h,a===null?(h=s.child,s.child=null):(h=a.sibling,a.sibling=null),LN(s,!1,h,a,f);break;case"backwards":for(a=null,h=s.child,s.child=null;h!==null;){if(r=h.alternate,r!==null&&Cb(r)===null){s.child=h;break}r=h.sibling,h.sibling=a,a=h,h=r}LN(s,!0,a,null,f);break;case"together":LN(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function zv(r,s){!(s.mode&1)&&r!==null&&(r.alternate=null,s.alternate=null,s.flags|=2)}function ul(r,s,a){if(r!==null&&(s.dependencies=r.dependencies),oh|=s.lanes,!(a&s.childLanes))return null;if(r!==null&&s.child!==r.child)throw Error(Qe(153));if(s.child!==null){for(r=s.child,a=xd(r,r.pendingProps),s.child=a,a.return=s;r.sibling!==null;)r=r.sibling,a=a.sibling=xd(r,r.pendingProps),a.return=s;a.sibling=null}return s.child}function efe(r,s,a){switch(s.tag){case 3:l9(s),Am();break;case 5:j7(s);break;case 1:qi(s.type)&&vb(s);break;case 4:OI(s,s.stateNode.containerInfo);break;case 10:var c=s.type._context,h=s.memoizedProps.value;gr(xb,c._currentValue),c._currentValue=h;break;case 13:if(c=s.memoizedState,c!==null)return c.dehydrated!==null?(gr(Wr,Wr.current&1),s.flags|=128,null):a&s.child.childLanes?d9(r,s,a):(gr(Wr,Wr.current&1),r=ul(r,s,a),r!==null?r.sibling:null);gr(Wr,Wr.current&1);break;case 19:if(c=(a&s.childLanes)!==0,r.flags&128){if(c)return u9(r,s,a);s.flags|=128}if(h=s.memoizedState,h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),gr(Wr,Wr.current),c)break;return null;case 22:case 23:return s.lanes=0,a9(r,s,a)}return ul(r,s,a)}var h9,q1,p9,m9;h9=function(r,s){for(var a=s.child;a!==null;){if(a.tag===5||a.tag===6)r.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};q1=function(){};p9=function(r,s,a,c){var h=r.memoizedProps;if(h!==c){r=s.stateNode,Wu(Rc.current);var f=null;switch(a){case"input":h=_1(r,h),c=_1(r,c),f=[];break;case"select":h=zr({},h,{value:void 0}),c=zr({},c,{value:void 0}),f=[];break;case"textarea":h=v1(r,h),c=v1(r,c),f=[];break;default:typeof h.onClick!="function"&&typeof c.onClick=="function"&&(r.onclick=yb)}S1(a,c);var _;a=null;for(x in h)if(!c.hasOwnProperty(x)&&h.hasOwnProperty(x)&&h[x]!=null)if(x==="style"){var E=h[x];for(_ in E)E.hasOwnProperty(_)&&(a||(a={}),a[_]="")}else x!=="dangerouslySetInnerHTML"&&x!=="children"&&x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(p0.hasOwnProperty(x)?f||(f=[]):(f=f||[]).push(x,null));for(x in c){var v=c[x];if(E=h!=null?h[x]:void 0,c.hasOwnProperty(x)&&v!==E&&(v!=null||E!=null))if(x==="style")if(E){for(_ in E)!E.hasOwnProperty(_)||v&&v.hasOwnProperty(_)||(a||(a={}),a[_]="");for(_ in v)v.hasOwnProperty(_)&&E[_]!==v[_]&&(a||(a={}),a[_]=v[_])}else a||(f||(f=[]),f.push(x,a)),a=v;else x==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,E=E?E.__html:void 0,v!=null&&E!==v&&(f=f||[]).push(x,v)):x==="children"?typeof v!="string"&&typeof v!="number"||(f=f||[]).push(x,""+v):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&(p0.hasOwnProperty(x)?(v!=null&&x==="onScroll"&&Cr("scroll",r),f||E===v||(f=[])):(f=f||[]).push(x,v))}a&&(f=f||[]).push("style",a);var x=f;(s.updateQueue=x)&&(s.flags|=4)}};m9=function(r,s,a,c){a!==c&&(s.flags|=4)};function Pg(r,s){if(!kr)switch(r.tailMode){case"hidden":s=r.tail;for(var a=null;s!==null;)s.alternate!==null&&(a=s),s=s.sibling;a===null?r.tail=null:a.sibling=null;break;case"collapsed":a=r.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:c.sibling=null}}function ii(r){var s=r.alternate!==null&&r.alternate.child===r.child,a=0,c=0;if(s)for(var h=r.child;h!==null;)a|=h.lanes|h.childLanes,c|=h.subtreeFlags&14680064,c|=h.flags&14680064,h.return=r,h=h.sibling;else for(h=r.child;h!==null;)a|=h.lanes|h.childLanes,c|=h.subtreeFlags,c|=h.flags,h.return=r,h=h.sibling;return r.subtreeFlags|=c,r.childLanes=a,s}function tfe(r,s,a){var c=s.pendingProps;switch(wI(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ii(s),null;case 1:return qi(s.type)&&Eb(),ii(s),null;case 3:return c=s.stateNode,Om(),Rr(Yi),Rr(li),DI(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(vv(s)?s.flags|=4:r===null||r.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,Fa!==null&&(rA(Fa),Fa=null))),q1(r,s),ii(s),null;case 5:PI(s);var h=Wu(T0.current);if(a=s.type,r!==null&&s.stateNode!=null)p9(r,s,a,c,h),r.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!c){if(s.stateNode===null)throw Error(Qe(166));return ii(s),null}if(r=Wu(Rc.current),vv(s)){c=s.stateNode,a=s.type;var f=s.memoizedProps;switch(c[wc]=s,c[x0]=f,r=(s.mode&1)!==0,a){case"dialog":Cr("cancel",c),Cr("close",c);break;case"iframe":case"object":case"embed":Cr("load",c);break;case"video":case"audio":for(h=0;h<Hg.length;h++)Cr(Hg[h],c);break;case"source":Cr("error",c);break;case"img":case"image":case"link":Cr("error",c),Cr("load",c);break;case"details":Cr("toggle",c);break;case"input":$6(c,f),Cr("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!f.multiple},Cr("invalid",c);break;case"textarea":G6(c,f),Cr("invalid",c)}S1(a,f),h=null;for(var _ in f)if(f.hasOwnProperty(_)){var E=f[_];_==="children"?typeof E=="string"?c.textContent!==E&&(f.suppressHydrationWarning!==!0&&Ev(c.textContent,E,r),h=["children",E]):typeof E=="number"&&c.textContent!==""+E&&(f.suppressHydrationWarning!==!0&&Ev(c.textContent,E,r),h=["children",""+E]):p0.hasOwnProperty(_)&&E!=null&&_==="onScroll"&&Cr("scroll",c)}switch(a){case"input":uv(c),W6(c,f,!0);break;case"textarea":uv(c),H6(c);break;case"select":case"option":break;default:typeof f.onClick=="function"&&(c.onclick=yb)}c=h,s.updateQueue=c,c!==null&&(s.flags|=4)}else{_=h.nodeType===9?h:h.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=$G(a)),r==="http://www.w3.org/1999/xhtml"?a==="script"?(r=_.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof c.is=="string"?r=_.createElement(a,{is:c.is}):(r=_.createElement(a),a==="select"&&(_=r,c.multiple?_.multiple=!0:c.size&&(_.size=c.size))):r=_.createElementNS(r,a),r[wc]=s,r[x0]=c,h9(r,s,!1,!1),s.stateNode=r;e:{switch(_=x1(a,c),a){case"dialog":Cr("cancel",r),Cr("close",r),h=c;break;case"iframe":case"object":case"embed":Cr("load",r),h=c;break;case"video":case"audio":for(h=0;h<Hg.length;h++)Cr(Hg[h],r);h=c;break;case"source":Cr("error",r),h=c;break;case"img":case"image":case"link":Cr("error",r),Cr("load",r),h=c;break;case"details":Cr("toggle",r),h=c;break;case"input":$6(r,c),h=_1(r,c),Cr("invalid",r);break;case"option":h=c;break;case"select":r._wrapperState={wasMultiple:!!c.multiple},h=zr({},c,{value:void 0}),Cr("invalid",r);break;case"textarea":G6(r,c),h=v1(r,c),Cr("invalid",r);break;default:h=c}S1(a,h),E=h;for(f in E)if(E.hasOwnProperty(f)){var v=E[f];f==="style"?HG(r,v):f==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,v!=null&&WG(r,v)):f==="children"?typeof v=="string"?(a!=="textarea"||v!=="")&&m0(r,v):typeof v=="number"&&m0(r,""+v):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(p0.hasOwnProperty(f)?v!=null&&f==="onScroll"&&Cr("scroll",r):v!=null&&lI(r,f,v,_))}switch(a){case"input":uv(r),W6(r,c,!1);break;case"textarea":uv(r),H6(r);break;case"option":c.value!=null&&r.setAttribute("value",""+Rd(c.value));break;case"select":r.multiple=!!c.multiple,f=c.value,f!=null?dm(r,!!c.multiple,f,!1):c.defaultValue!=null&&dm(r,!!c.multiple,c.defaultValue,!0);break;default:typeof h.onClick=="function"&&(r.onclick=yb)}switch(a){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return ii(s),null;case 6:if(r&&s.stateNode!=null)m9(r,s,r.memoizedProps,c);else{if(typeof c!="string"&&s.stateNode===null)throw Error(Qe(166));if(a=Wu(T0.current),Wu(Rc.current),vv(s)){if(c=s.stateNode,a=s.memoizedProps,c[wc]=s,(f=c.nodeValue!==a)&&(r=fo,r!==null))switch(r.tag){case 3:Ev(c.nodeValue,a,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Ev(c.nodeValue,a,(r.mode&1)!==0)}f&&(s.flags|=4)}else c=(a.nodeType===9?a:a.ownerDocument).createTextNode(c),c[wc]=s,s.stateNode=c}return ii(s),null;case 13:if(Rr(Wr),c=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(kr&&mo!==null&&s.mode&1&&!(s.flags&128))P7(),Am(),s.flags|=98560,f=!1;else if(f=vv(s),c!==null&&c.dehydrated!==null){if(r===null){if(!f)throw Error(Qe(318));if(f=s.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(Qe(317));f[wc]=s}else Am(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;ii(s),f=!1}else Fa!==null&&(rA(Fa),Fa=null),f=!0;if(!f)return s.flags&65536?s:null}return s.flags&128?(s.lanes=a,s):(c=c!==null,c!==(r!==null&&r.memoizedState!==null)&&c&&(s.child.flags|=8192,s.mode&1&&(r===null||Wr.current&1?vs===0&&(vs=3):HI())),s.updateQueue!==null&&(s.flags|=4),ii(s),null);case 4:return Om(),q1(r,s),r===null&&b0(s.stateNode.containerInfo),ii(s),null;case 10:return NI(s.type._context),ii(s),null;case 17:return qi(s.type)&&Eb(),ii(s),null;case 19:if(Rr(Wr),f=s.memoizedState,f===null)return ii(s),null;if(c=(s.flags&128)!==0,_=f.rendering,_===null)if(c)Pg(f,!1);else{if(vs!==0||r!==null&&r.flags&128)for(r=s.child;r!==null;){if(_=Cb(r),_!==null){for(s.flags|=128,Pg(f,!1),c=_.updateQueue,c!==null&&(s.updateQueue=c,s.flags|=4),s.subtreeFlags=0,c=a,a=s.child;a!==null;)f=a,r=c,f.flags&=14680066,_=f.alternate,_===null?(f.childLanes=0,f.lanes=r,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=_.childLanes,f.lanes=_.lanes,f.child=_.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=_.memoizedProps,f.memoizedState=_.memoizedState,f.updateQueue=_.updateQueue,f.type=_.type,r=_.dependencies,f.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),a=a.sibling;return gr(Wr,Wr.current&1|2),s.child}r=r.sibling}f.tail!==null&&is()>Dm&&(s.flags|=128,c=!0,Pg(f,!1),s.lanes=4194304)}else{if(!c)if(r=Cb(_),r!==null){if(s.flags|=128,c=!0,a=r.updateQueue,a!==null&&(s.updateQueue=a,s.flags|=4),Pg(f,!0),f.tail===null&&f.tailMode==="hidden"&&!_.alternate&&!kr)return ii(s),null}else 2*is()-f.renderingStartTime>Dm&&a!==1073741824&&(s.flags|=128,c=!0,Pg(f,!1),s.lanes=4194304);f.isBackwards?(_.sibling=s.child,s.child=_):(a=f.last,a!==null?a.sibling=_:s.child=_,f.last=_)}return f.tail!==null?(s=f.tail,f.rendering=s,f.tail=s.sibling,f.renderingStartTime=is(),s.sibling=null,a=Wr.current,gr(Wr,c?a&1|2:a&1),s):(ii(s),null);case 22:case 23:return GI(),c=s.memoizedState!==null,r!==null&&r.memoizedState!==null!==c&&(s.flags|=8192),c&&s.mode&1?ho&1073741824&&(ii(s),s.subtreeFlags&6&&(s.flags|=8192)):ii(s),null;case 24:return null;case 25:return null}throw Error(Qe(156,s.tag))}function nfe(r,s){switch(wI(s),s.tag){case 1:return qi(s.type)&&Eb(),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return Om(),Rr(Yi),Rr(li),DI(),r=s.flags,r&65536&&!(r&128)?(s.flags=r&-65537|128,s):null;case 5:return PI(s),null;case 13:if(Rr(Wr),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(Qe(340));Am()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return Rr(Wr),null;case 4:return Om(),null;case 10:return NI(s.type._context),null;case 22:case 23:return GI(),null;case 24:return null;default:return null}}var xv=!1,ai=!1,rfe=typeof WeakSet=="function"?WeakSet:Set,Ct=null;function rm(r,s){var a=r.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(c){es(r,s,c)}else a.current=null}function X1(r,s,a){try{a()}catch(c){es(r,s,c)}}var k8=!1;function sfe(r,s){if(D1=fb,r=E7(),SI(r)){if("selectionStart"in r)var a={start:r.selectionStart,end:r.selectionEnd};else e:{a=(a=r.ownerDocument)&&a.defaultView||window;var c=a.getSelection&&a.getSelection();if(c&&c.rangeCount!==0){a=c.anchorNode;var h=c.anchorOffset,f=c.focusNode;c=c.focusOffset;try{a.nodeType,f.nodeType}catch{a=null;break e}var _=0,E=-1,v=-1,x=0,T=0,R=r,N=null;t:for(;;){for(var L;R!==a||h!==0&&R.nodeType!==3||(E=_+h),R!==f||c!==0&&R.nodeType!==3||(v=_+c),R.nodeType===3&&(_+=R.nodeValue.length),(L=R.firstChild)!==null;)N=R,R=L;for(;;){if(R===r)break t;if(N===a&&++x===h&&(E=_),N===f&&++T===c&&(v=_),(L=R.nextSibling)!==null)break;R=N,N=R.parentNode}R=L}a=E===-1||v===-1?null:{start:E,end:v}}else a=null}a=a||{start:0,end:0}}else a=null;for(k1={focusedElem:r,selectionRange:a},fb=!1,Ct=s;Ct!==null;)if(s=Ct,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,Ct=r;else for(;Ct!==null;){s=Ct;try{var j=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(j!==null){var F=j.memoizedProps,P=j.memoizedState,M=s.stateNode,U=M.getSnapshotBeforeUpdate(s.elementType===s.type?F:ka(s.type,F),P);M.__reactInternalSnapshotBeforeUpdate=U}break;case 3:var B=s.stateNode.containerInfo;B.nodeType===1?B.textContent="":B.nodeType===9&&B.documentElement&&B.removeChild(B.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Qe(163))}}catch(K){es(s,s.return,K)}if(r=s.sibling,r!==null){r.return=s.return,Ct=r;break}Ct=s.return}return j=k8,k8=!1,j}function n0(r,s,a){var c=s.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var h=c=c.next;do{if((h.tag&r)===r){var f=h.destroy;h.destroy=void 0,f!==void 0&&X1(s,a,f)}h=h.next}while(h!==c)}}function dS(r,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var a=s=s.next;do{if((a.tag&r)===r){var c=a.create;a.destroy=c()}a=a.next}while(a!==s)}}function J1(r){var s=r.ref;if(s!==null){var a=r.stateNode;switch(r.tag){case 5:r=a;break;default:r=a}typeof s=="function"?s(r):s.current=r}}function f9(r){var s=r.alternate;s!==null&&(r.alternate=null,f9(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&(delete s[wc],delete s[x0],delete s[j1],delete s[Fme],delete s[Bme])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function g9(r){return r.tag===5||r.tag===3||r.tag===4}function L8(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||g9(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Q1(r,s,a){var c=r.tag;if(c===5||c===6)r=r.stateNode,s?a.nodeType===8?a.parentNode.insertBefore(r,s):a.insertBefore(r,s):(a.nodeType===8?(s=a.parentNode,s.insertBefore(r,a)):(s=a,s.appendChild(r)),a=a._reactRootContainer,a!=null||s.onclick!==null||(s.onclick=yb));else if(c!==4&&(r=r.child,r!==null))for(Q1(r,s,a),r=r.sibling;r!==null;)Q1(r,s,a),r=r.sibling}function Z1(r,s,a){var c=r.tag;if(c===5||c===6)r=r.stateNode,s?a.insertBefore(r,s):a.appendChild(r);else if(c!==4&&(r=r.child,r!==null))for(Z1(r,s,a),r=r.sibling;r!==null;)Z1(r,s,a),r=r.sibling}var Hs=null,Ua=!1;function Ql(r,s,a){for(a=a.child;a!==null;)_9(r,s,a),a=a.sibling}function _9(r,s,a){if(Cc&&typeof Cc.onCommitFiberUnmount=="function")try{Cc.onCommitFiberUnmount(nS,a)}catch{}switch(a.tag){case 5:ai||rm(a,s);case 6:var c=Hs,h=Ua;Hs=null,Ql(r,s,a),Hs=c,Ua=h,Hs!==null&&(Ua?(r=Hs,a=a.stateNode,r.nodeType===8?r.parentNode.removeChild(a):r.removeChild(a)):Hs.removeChild(a.stateNode));break;case 18:Hs!==null&&(Ua?(r=Hs,a=a.stateNode,r.nodeType===8?NN(r.parentNode,a):r.nodeType===1&&NN(r,a),y0(r)):NN(Hs,a.stateNode));break;case 4:c=Hs,h=Ua,Hs=a.stateNode.containerInfo,Ua=!0,Ql(r,s,a),Hs=c,Ua=h;break;case 0:case 11:case 14:case 15:if(!ai&&(c=a.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){h=c=c.next;do{var f=h,_=f.destroy;f=f.tag,_!==void 0&&(f&2||f&4)&&X1(a,s,_),h=h.next}while(h!==c)}Ql(r,s,a);break;case 1:if(!ai&&(rm(a,s),c=a.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=a.memoizedProps,c.state=a.memoizedState,c.componentWillUnmount()}catch(E){es(a,s,E)}Ql(r,s,a);break;case 21:Ql(r,s,a);break;case 22:a.mode&1?(ai=(c=ai)||a.memoizedState!==null,Ql(r,s,a),ai=c):Ql(r,s,a);break;default:Ql(r,s,a)}}function M8(r){var s=r.updateQueue;if(s!==null){r.updateQueue=null;var a=r.stateNode;a===null&&(a=r.stateNode=new rfe),s.forEach(function(c){var h=pfe.bind(null,r,c);a.has(c)||(a.add(c),c.then(h,h))})}}function Ia(r,s){var a=s.deletions;if(a!==null)for(var c=0;c<a.length;c++){var h=a[c];try{var f=r,_=s,E=_;e:for(;E!==null;){switch(E.tag){case 5:Hs=E.stateNode,Ua=!1;break e;case 3:Hs=E.stateNode.containerInfo,Ua=!0;break e;case 4:Hs=E.stateNode.containerInfo,Ua=!0;break e}E=E.return}if(Hs===null)throw Error(Qe(160));_9(f,_,h),Hs=null,Ua=!1;var v=h.alternate;v!==null&&(v.return=null),h.return=null}catch(x){es(h,s,x)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)y9(s,r),s=s.sibling}function y9(r,s){var a=r.alternate,c=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Ia(s,r),Ec(r),c&4){try{n0(3,r,r.return),dS(3,r)}catch(F){es(r,r.return,F)}try{n0(5,r,r.return)}catch(F){es(r,r.return,F)}}break;case 1:Ia(s,r),Ec(r),c&512&&a!==null&&rm(a,a.return);break;case 5:if(Ia(s,r),Ec(r),c&512&&a!==null&&rm(a,a.return),r.flags&32){var h=r.stateNode;try{m0(h,"")}catch(F){es(r,r.return,F)}}if(c&4&&(h=r.stateNode,h!=null)){var f=r.memoizedProps,_=a!==null?a.memoizedProps:f,E=r.type,v=r.updateQueue;if(r.updateQueue=null,v!==null)try{E==="input"&&f.type==="radio"&&f.name!=null&&FG(h,f),x1(E,_);var x=x1(E,f);for(_=0;_<v.length;_+=2){var T=v[_],R=v[_+1];T==="style"?HG(h,R):T==="dangerouslySetInnerHTML"?WG(h,R):T==="children"?m0(h,R):lI(h,T,R,x)}switch(E){case"input":y1(h,f);break;case"textarea":BG(h,f);break;case"select":var N=h._wrapperState.wasMultiple;h._wrapperState.wasMultiple=!!f.multiple;var L=f.value;L!=null?dm(h,!!f.multiple,L,!1):N!==!!f.multiple&&(f.defaultValue!=null?dm(h,!!f.multiple,f.defaultValue,!0):dm(h,!!f.multiple,f.multiple?[]:"",!1))}h[x0]=f}catch(F){es(r,r.return,F)}}break;case 6:if(Ia(s,r),Ec(r),c&4){if(r.stateNode===null)throw Error(Qe(162));h=r.stateNode,f=r.memoizedProps;try{h.nodeValue=f}catch(F){es(r,r.return,F)}}break;case 3:if(Ia(s,r),Ec(r),c&4&&a!==null&&a.memoizedState.isDehydrated)try{y0(s.containerInfo)}catch(F){es(r,r.return,F)}break;case 4:Ia(s,r),Ec(r);break;case 13:Ia(s,r),Ec(r),h=r.child,h.flags&8192&&(f=h.memoizedState!==null,h.stateNode.isHidden=f,!f||h.alternate!==null&&h.alternate.memoizedState!==null||($I=is())),c&4&&M8(r);break;case 22:if(T=a!==null&&a.memoizedState!==null,r.mode&1?(ai=(x=ai)||T,Ia(s,r),ai=x):Ia(s,r),Ec(r),c&8192){if(x=r.memoizedState!==null,(r.stateNode.isHidden=x)&&!T&&r.mode&1)for(Ct=r,T=r.child;T!==null;){for(R=Ct=T;Ct!==null;){switch(N=Ct,L=N.child,N.tag){case 0:case 11:case 14:case 15:n0(4,N,N.return);break;case 1:rm(N,N.return);var j=N.stateNode;if(typeof j.componentWillUnmount=="function"){c=N,a=N.return;try{s=c,j.props=s.memoizedProps,j.state=s.memoizedState,j.componentWillUnmount()}catch(F){es(c,a,F)}}break;case 5:rm(N,N.return);break;case 22:if(N.memoizedState!==null){U8(R);continue}}L!==null?(L.return=N,Ct=L):U8(R)}T=T.sibling}e:for(T=null,R=r;;){if(R.tag===5){if(T===null){T=R;try{h=R.stateNode,x?(f=h.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none"):(E=R.stateNode,v=R.memoizedProps.style,_=v!=null&&v.hasOwnProperty("display")?v.display:null,E.style.display=GG("display",_))}catch(F){es(r,r.return,F)}}}else if(R.tag===6){if(T===null)try{R.stateNode.nodeValue=x?"":R.memoizedProps}catch(F){es(r,r.return,F)}}else if((R.tag!==22&&R.tag!==23||R.memoizedState===null||R===r)&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===r)break e;for(;R.sibling===null;){if(R.return===null||R.return===r)break e;T===R&&(T=null),R=R.return}T===R&&(T=null),R.sibling.return=R.return,R=R.sibling}}break;case 19:Ia(s,r),Ec(r),c&4&&M8(r);break;case 21:break;default:Ia(s,r),Ec(r)}}function Ec(r){var s=r.flags;if(s&2){try{e:{for(var a=r.return;a!==null;){if(g9(a)){var c=a;break e}a=a.return}throw Error(Qe(160))}switch(c.tag){case 5:var h=c.stateNode;c.flags&32&&(m0(h,""),c.flags&=-33);var f=L8(r);Z1(r,f,h);break;case 3:case 4:var _=c.stateNode.containerInfo,E=L8(r);Q1(r,E,_);break;default:throw Error(Qe(161))}}catch(v){es(r,r.return,v)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function ife(r,s,a){Ct=r,E9(r)}function E9(r,s,a){for(var c=(r.mode&1)!==0;Ct!==null;){var h=Ct,f=h.child;if(h.tag===22&&c){var _=h.memoizedState!==null||xv;if(!_){var E=h.alternate,v=E!==null&&E.memoizedState!==null||ai;E=xv;var x=ai;if(xv=_,(ai=v)&&!x)for(Ct=h;Ct!==null;)_=Ct,v=_.child,_.tag===22&&_.memoizedState!==null?V8(h):v!==null?(v.return=_,Ct=v):V8(h);for(;f!==null;)Ct=f,E9(f),f=f.sibling;Ct=h,xv=E,ai=x}j8(r)}else h.subtreeFlags&8772&&f!==null?(f.return=h,Ct=f):j8(r)}}function j8(r){for(;Ct!==null;){var s=Ct;if(s.flags&8772){var a=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:ai||dS(5,s);break;case 1:var c=s.stateNode;if(s.flags&4&&!ai)if(a===null)c.componentDidMount();else{var h=s.elementType===s.type?a.memoizedProps:ka(s.type,a.memoizedProps);c.componentDidUpdate(h,a.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var f=s.updateQueue;f!==null&&b8(s,f,c);break;case 3:var _=s.updateQueue;if(_!==null){if(a=null,s.child!==null)switch(s.child.tag){case 5:a=s.child.stateNode;break;case 1:a=s.child.stateNode}b8(s,_,a)}break;case 5:var E=s.stateNode;if(a===null&&s.flags&4){a=E;var v=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":v.autoFocus&&a.focus();break;case"img":v.src&&(a.src=v.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var x=s.alternate;if(x!==null){var T=x.memoizedState;if(T!==null){var R=T.dehydrated;R!==null&&y0(R)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Qe(163))}ai||s.flags&512&&J1(s)}catch(N){es(s,s.return,N)}}if(s===r){Ct=null;break}if(a=s.sibling,a!==null){a.return=s.return,Ct=a;break}Ct=s.return}}function U8(r){for(;Ct!==null;){var s=Ct;if(s===r){Ct=null;break}var a=s.sibling;if(a!==null){a.return=s.return,Ct=a;break}Ct=s.return}}function V8(r){for(;Ct!==null;){var s=Ct;try{switch(s.tag){case 0:case 11:case 15:var a=s.return;try{dS(4,s)}catch(v){es(s,a,v)}break;case 1:var c=s.stateNode;if(typeof c.componentDidMount=="function"){var h=s.return;try{c.componentDidMount()}catch(v){es(s,h,v)}}var f=s.return;try{J1(s)}catch(v){es(s,f,v)}break;case 5:var _=s.return;try{J1(s)}catch(v){es(s,_,v)}}}catch(v){es(s,s.return,v)}if(s===r){Ct=null;break}var E=s.sibling;if(E!==null){E.return=s.return,Ct=E;break}Ct=s.return}}var ofe=Math.ceil,Ab=yl.ReactCurrentDispatcher,FI=yl.ReactCurrentOwner,ea=yl.ReactCurrentBatchConfig,Bn=0,ks=null,ps=null,zs=0,ho=0,sm=kd(0),vs=0,A0=null,oh=0,uS=0,BI=0,r0=null,Hi=null,$I=0,Dm=1/0,tl=null,Ib=!1,eA=null,bd=null,wv=!1,md=null,Ob=0,s0=0,tA=null,Yv=-1,qv=0;function Ci(){return Bn&6?is():Yv!==-1?Yv:Yv=is()}function Sd(r){return r.mode&1?Bn&2&&zs!==0?zs&-zs:Wme.transition!==null?(qv===0&&(qv=r7()),qv):(r=rr,r!==0||(r=window.event,r=r===void 0?16:d7(r.type)),r):1}function $a(r,s,a,c){if(50<s0)throw s0=0,tA=null,Error(Qe(185));J0(r,a,c),(!(Bn&2)||r!==ks)&&(r===ks&&(!(Bn&2)&&(uS|=a),vs===4&&ad(r,zs)),Xi(r,c),a===1&&Bn===0&&!(s.mode&1)&&(Dm=is()+500,aS&&Ld()))}function Xi(r,s){var a=r.callbackNode;Wpe(r,s);var c=mb(r,r===ks?zs:0);if(c===0)a!==null&&Y6(a),r.callbackNode=null,r.callbackPriority=0;else if(s=c&-c,r.callbackPriority!==s){if(a!=null&&Y6(a),s===1)r.tag===0?$me(F8.bind(null,r)):A7(F8.bind(null,r)),Ume(function(){!(Bn&6)&&Ld()}),a=null;else{switch(s7(c)){case 1:a=mI;break;case 4:a=t7;break;case 16:a=pb;break;case 536870912:a=n7;break;default:a=pb}a=R9(a,v9.bind(null,r))}r.callbackPriority=s,r.callbackNode=a}}function v9(r,s){if(Yv=-1,qv=0,Bn&6)throw Error(Qe(327));var a=r.callbackNode;if(fm()&&r.callbackNode!==a)return null;var c=mb(r,r===ks?zs:0);if(c===0)return null;if(c&30||c&r.expiredLanes||s)s=Pb(r,c);else{s=c;var h=Bn;Bn|=2;var f=S9();(ks!==r||zs!==s)&&(tl=null,Dm=is()+500,Qu(r,s));do try{lfe();break}catch(E){b9(r,E)}while(!0);RI(),Ab.current=f,Bn=h,ps!==null?s=0:(ks=null,zs=0,s=vs)}if(s!==0){if(s===2&&(h=N1(r),h!==0&&(c=h,s=nA(r,h))),s===1)throw a=A0,Qu(r,0),ad(r,c),Xi(r,is()),a;if(s===6)ad(r,c);else{if(h=r.current.alternate,!(c&30)&&!afe(h)&&(s=Pb(r,c),s===2&&(f=N1(r),f!==0&&(c=f,s=nA(r,f))),s===1))throw a=A0,Qu(r,0),ad(r,c),Xi(r,is()),a;switch(r.finishedWork=h,r.finishedLanes=c,s){case 0:case 1:throw Error(Qe(345));case 2:Mu(r,Hi,tl);break;case 3:if(ad(r,c),(c&130023424)===c&&(s=$I+500-is(),10<s)){if(mb(r,0)!==0)break;if(h=r.suspendedLanes,(h&c)!==c){Ci(),r.pingedLanes|=r.suspendedLanes&h;break}r.timeoutHandle=M1(Mu.bind(null,r,Hi,tl),s);break}Mu(r,Hi,tl);break;case 4:if(ad(r,c),(c&4194240)===c)break;for(s=r.eventTimes,h=-1;0<c;){var _=31-Ba(c);f=1<<_,_=s[_],_>h&&(h=_),c&=~f}if(c=h,c=is()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*ofe(c/1960))-c,10<c){r.timeoutHandle=M1(Mu.bind(null,r,Hi,tl),c);break}Mu(r,Hi,tl);break;case 5:Mu(r,Hi,tl);break;default:throw Error(Qe(329))}}}return Xi(r,is()),r.callbackNode===a?v9.bind(null,r):null}function nA(r,s){var a=r0;return r.current.memoizedState.isDehydrated&&(Qu(r,s).flags|=256),r=Pb(r,s),r!==2&&(s=Hi,Hi=a,s!==null&&rA(s)),r}function rA(r){Hi===null?Hi=r:Hi.push.apply(Hi,r)}function afe(r){for(var s=r;;){if(s.flags&16384){var a=s.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var c=0;c<a.length;c++){var h=a[c],f=h.getSnapshot;h=h.value;try{if(!Ga(f(),h))return!1}catch{return!1}}}if(a=s.child,s.subtreeFlags&16384&&a!==null)a.return=s,s=a;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function ad(r,s){for(s&=~BI,s&=~uS,r.suspendedLanes|=s,r.pingedLanes&=~s,r=r.expirationTimes;0<s;){var a=31-Ba(s),c=1<<a;r[a]=-1,s&=~c}}function F8(r){if(Bn&6)throw Error(Qe(327));fm();var s=mb(r,0);if(!(s&1))return Xi(r,is()),null;var a=Pb(r,s);if(r.tag!==0&&a===2){var c=N1(r);c!==0&&(s=c,a=nA(r,c))}if(a===1)throw a=A0,Qu(r,0),ad(r,s),Xi(r,is()),a;if(a===6)throw Error(Qe(345));return r.finishedWork=r.current.alternate,r.finishedLanes=s,Mu(r,Hi,tl),Xi(r,is()),null}function WI(r,s){var a=Bn;Bn|=1;try{return r(s)}finally{Bn=a,Bn===0&&(Dm=is()+500,aS&&Ld())}}function ah(r){md!==null&&md.tag===0&&!(Bn&6)&&fm();var s=Bn;Bn|=1;var a=ea.transition,c=rr;try{if(ea.transition=null,rr=1,r)return r()}finally{rr=c,ea.transition=a,Bn=s,!(Bn&6)&&Ld()}}function GI(){ho=sm.current,Rr(sm)}function Qu(r,s){r.finishedWork=null,r.finishedLanes=0;var a=r.timeoutHandle;if(a!==-1&&(r.timeoutHandle=-1,jme(a)),ps!==null)for(a=ps.return;a!==null;){var c=a;switch(wI(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&Eb();break;case 3:Om(),Rr(Yi),Rr(li),DI();break;case 5:PI(c);break;case 4:Om();break;case 13:Rr(Wr);break;case 19:Rr(Wr);break;case 10:NI(c.type._context);break;case 22:case 23:GI()}a=a.return}if(ks=r,ps=r=xd(r.current,null),zs=ho=s,vs=0,A0=null,BI=uS=oh=0,Hi=r0=null,$u!==null){for(s=0;s<$u.length;s++)if(a=$u[s],c=a.interleaved,c!==null){a.interleaved=null;var h=c.next,f=a.pending;if(f!==null){var _=f.next;f.next=h,c.next=_}a.pending=c}$u=null}return r}function b9(r,s){do{var a=ps;try{if(RI(),Hv.current=Nb,Rb){for(var c=Kr.memoizedState;c!==null;){var h=c.queue;h!==null&&(h.pending=null),c=c.next}Rb=!1}if(ih=0,Ds=Es=Kr=null,t0=!1,C0=0,FI.current=null,a===null||a.return===null){vs=1,A0=s,ps=null;break}e:{var f=r,_=a.return,E=a,v=s;if(s=zs,E.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){var x=v,T=E,R=T.tag;if(!(T.mode&1)&&(R===0||R===11||R===15)){var N=T.alternate;N?(T.updateQueue=N.updateQueue,T.memoizedState=N.memoizedState,T.lanes=N.lanes):(T.updateQueue=null,T.memoizedState=null)}var L=R8(_);if(L!==null){L.flags&=-257,N8(L,_,E,f,s),L.mode&1&&C8(f,x,s),s=L,v=x;var j=s.updateQueue;if(j===null){var F=new Set;F.add(v),s.updateQueue=F}else j.add(v);break e}else{if(!(s&1)){C8(f,x,s),HI();break e}v=Error(Qe(426))}}else if(kr&&E.mode&1){var P=R8(_);if(P!==null){!(P.flags&65536)&&(P.flags|=256),N8(P,_,E,f,s),TI(Pm(v,E));break e}}f=v=Pm(v,E),vs!==4&&(vs=2),r0===null?r0=[f]:r0.push(f),f=_;do{switch(f.tag){case 3:f.flags|=65536,s&=-s,f.lanes|=s;var M=s9(f,v,s);v8(f,M);break e;case 1:E=v;var U=f.type,B=f.stateNode;if(!(f.flags&128)&&(typeof U.getDerivedStateFromError=="function"||B!==null&&typeof B.componentDidCatch=="function"&&(bd===null||!bd.has(B)))){f.flags|=65536,s&=-s,f.lanes|=s;var K=i9(f,E,s);v8(f,K);break e}}f=f.return}while(f!==null)}w9(a)}catch(J){s=J,ps===a&&a!==null&&(ps=a=a.return);continue}break}while(!0)}function S9(){var r=Ab.current;return Ab.current=Nb,r===null?Nb:r}function HI(){(vs===0||vs===3||vs===2)&&(vs=4),ks===null||!(oh&268435455)&&!(uS&268435455)||ad(ks,zs)}function Pb(r,s){var a=Bn;Bn|=2;var c=S9();(ks!==r||zs!==s)&&(tl=null,Qu(r,s));do try{cfe();break}catch(h){b9(r,h)}while(!0);if(RI(),Bn=a,Ab.current=c,ps!==null)throw Error(Qe(261));return ks=null,zs=0,vs}function cfe(){for(;ps!==null;)x9(ps)}function lfe(){for(;ps!==null&&!kpe();)x9(ps)}function x9(r){var s=C9(r.alternate,r,ho);r.memoizedProps=r.pendingProps,s===null?w9(r):ps=s,FI.current=null}function w9(r){var s=r;do{var a=s.alternate;if(r=s.return,s.flags&32768){if(a=nfe(a,s),a!==null){a.flags&=32767,ps=a;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{vs=6,ps=null;return}}else if(a=tfe(a,s,ho),a!==null){ps=a;return}if(s=s.sibling,s!==null){ps=s;return}ps=s=r}while(s!==null);vs===0&&(vs=5)}function Mu(r,s,a){var c=rr,h=ea.transition;try{ea.transition=null,rr=1,dfe(r,s,a,c)}finally{ea.transition=h,rr=c}return null}function dfe(r,s,a,c){do fm();while(md!==null);if(Bn&6)throw Error(Qe(327));a=r.finishedWork;var h=r.finishedLanes;if(a===null)return null;if(r.finishedWork=null,r.finishedLanes=0,a===r.current)throw Error(Qe(177));r.callbackNode=null,r.callbackPriority=0;var f=a.lanes|a.childLanes;if(Gpe(r,f),r===ks&&(ps=ks=null,zs=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||wv||(wv=!0,R9(pb,function(){return fm(),null})),f=(a.flags&15990)!==0,a.subtreeFlags&15990||f){f=ea.transition,ea.transition=null;var _=rr;rr=1;var E=Bn;Bn|=4,FI.current=null,sfe(r,a),y9(a,r),Ime(k1),fb=!!D1,k1=D1=null,r.current=a,ife(a),Lpe(),Bn=E,rr=_,ea.transition=f}else r.current=a;if(wv&&(wv=!1,md=r,Ob=h),f=r.pendingLanes,f===0&&(bd=null),Upe(a.stateNode),Xi(r,is()),s!==null)for(c=r.onRecoverableError,a=0;a<s.length;a++)h=s[a],c(h.value,{componentStack:h.stack,digest:h.digest});if(Ib)throw Ib=!1,r=eA,eA=null,r;return Ob&1&&r.tag!==0&&fm(),f=r.pendingLanes,f&1?r===tA?s0++:(s0=0,tA=r):s0=0,Ld(),null}function fm(){if(md!==null){var r=s7(Ob),s=ea.transition,a=rr;try{if(ea.transition=null,rr=16>r?16:r,md===null)var c=!1;else{if(r=md,md=null,Ob=0,Bn&6)throw Error(Qe(331));var h=Bn;for(Bn|=4,Ct=r.current;Ct!==null;){var f=Ct,_=f.child;if(Ct.flags&16){var E=f.deletions;if(E!==null){for(var v=0;v<E.length;v++){var x=E[v];for(Ct=x;Ct!==null;){var T=Ct;switch(T.tag){case 0:case 11:case 15:n0(8,T,f)}var R=T.child;if(R!==null)R.return=T,Ct=R;else for(;Ct!==null;){T=Ct;var N=T.sibling,L=T.return;if(f9(T),T===x){Ct=null;break}if(N!==null){N.return=L,Ct=N;break}Ct=L}}}var j=f.alternate;if(j!==null){var F=j.child;if(F!==null){j.child=null;do{var P=F.sibling;F.sibling=null,F=P}while(F!==null)}}Ct=f}}if(f.subtreeFlags&2064&&_!==null)_.return=f,Ct=_;else e:for(;Ct!==null;){if(f=Ct,f.flags&2048)switch(f.tag){case 0:case 11:case 15:n0(9,f,f.return)}var M=f.sibling;if(M!==null){M.return=f.return,Ct=M;break e}Ct=f.return}}var U=r.current;for(Ct=U;Ct!==null;){_=Ct;var B=_.child;if(_.subtreeFlags&2064&&B!==null)B.return=_,Ct=B;else e:for(_=U;Ct!==null;){if(E=Ct,E.flags&2048)try{switch(E.tag){case 0:case 11:case 15:dS(9,E)}}catch(J){es(E,E.return,J)}if(E===_){Ct=null;break e}var K=E.sibling;if(K!==null){K.return=E.return,Ct=K;break e}Ct=E.return}}if(Bn=h,Ld(),Cc&&typeof Cc.onPostCommitFiberRoot=="function")try{Cc.onPostCommitFiberRoot(nS,r)}catch{}c=!0}return c}finally{rr=a,ea.transition=s}}return!1}function B8(r,s,a){s=Pm(a,s),s=s9(r,s,1),r=vd(r,s,1),s=Ci(),r!==null&&(J0(r,1,s),Xi(r,s))}function es(r,s,a){if(r.tag===3)B8(r,r,a);else for(;s!==null;){if(s.tag===3){B8(s,r,a);break}else if(s.tag===1){var c=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(bd===null||!bd.has(c))){r=Pm(a,r),r=i9(s,r,1),s=vd(s,r,1),r=Ci(),s!==null&&(J0(s,1,r),Xi(s,r));break}}s=s.return}}function ufe(r,s,a){var c=r.pingCache;c!==null&&c.delete(s),s=Ci(),r.pingedLanes|=r.suspendedLanes&a,ks===r&&(zs&a)===a&&(vs===4||vs===3&&(zs&130023424)===zs&&500>is()-$I?Qu(r,0):BI|=a),Xi(r,s)}function T9(r,s){s===0&&(r.mode&1?(s=mv,mv<<=1,!(mv&130023424)&&(mv=4194304)):s=1);var a=Ci();r=dl(r,s),r!==null&&(J0(r,s,a),Xi(r,a))}function hfe(r){var s=r.memoizedState,a=0;s!==null&&(a=s.retryLane),T9(r,a)}function pfe(r,s){var a=0;switch(r.tag){case 13:var c=r.stateNode,h=r.memoizedState;h!==null&&(a=h.retryLane);break;case 19:c=r.stateNode;break;default:throw Error(Qe(314))}c!==null&&c.delete(s),T9(r,a)}var C9;C9=function(r,s,a){if(r!==null)if(r.memoizedProps!==s.pendingProps||Yi.current)Ki=!0;else{if(!(r.lanes&a)&&!(s.flags&128))return Ki=!1,efe(r,s,a);Ki=!!(r.flags&131072)}else Ki=!1,kr&&s.flags&1048576&&I7(s,Sb,s.index);switch(s.lanes=0,s.tag){case 2:var c=s.type;zv(r,s),r=s.pendingProps;var h=Nm(s,li.current);mm(s,a),h=LI(null,s,c,r,h,a);var f=MI();return s.flags|=1,typeof h=="object"&&h!==null&&typeof h.render=="function"&&h.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,qi(c)?(f=!0,vb(s)):f=!1,s.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,II(s),h.updater=lS,s.stateNode=h,h._reactInternals=s,W1(s,c,r,a),s=K1(null,s,c,!0,f,a)):(s.tag=0,kr&&f&&xI(s),Si(null,s,h,a),s=s.child),s;case 16:c=s.elementType;e:{switch(zv(r,s),r=s.pendingProps,h=c._init,c=h(c._payload),s.type=c,h=s.tag=ffe(c),r=ka(c,r),h){case 0:s=H1(null,s,c,r,a);break e;case 1:s=O8(null,s,c,r,a);break e;case 11:s=A8(null,s,c,r,a);break e;case 14:s=I8(null,s,c,ka(c.type,r),a);break e}throw Error(Qe(306,c,""))}return s;case 0:return c=s.type,h=s.pendingProps,h=s.elementType===c?h:ka(c,h),H1(r,s,c,h,a);case 1:return c=s.type,h=s.pendingProps,h=s.elementType===c?h:ka(c,h),O8(r,s,c,h,a);case 3:e:{if(l9(s),r===null)throw Error(Qe(387));c=s.pendingProps,f=s.memoizedState,h=f.element,M7(r,s),Tb(s,c,null,a);var _=s.memoizedState;if(c=_.element,f.isDehydrated)if(f={element:c,isDehydrated:!1,cache:_.cache,pendingSuspenseBoundaries:_.pendingSuspenseBoundaries,transitions:_.transitions},s.updateQueue.baseState=f,s.memoizedState=f,s.flags&256){h=Pm(Error(Qe(423)),s),s=P8(r,s,c,a,h);break e}else if(c!==h){h=Pm(Error(Qe(424)),s),s=P8(r,s,c,a,h);break e}else for(mo=Ed(s.stateNode.containerInfo.firstChild),fo=s,kr=!0,Fa=null,a=k7(s,null,c,a),s.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Am(),c===h){s=ul(r,s,a);break e}Si(r,s,c,a)}s=s.child}return s;case 5:return j7(s),r===null&&F1(s),c=s.type,h=s.pendingProps,f=r!==null?r.memoizedProps:null,_=h.children,L1(c,h)?_=null:f!==null&&L1(c,f)&&(s.flags|=32),c9(r,s),Si(r,s,_,a),s.child;case 6:return r===null&&F1(s),null;case 13:return d9(r,s,a);case 4:return OI(s,s.stateNode.containerInfo),c=s.pendingProps,r===null?s.child=Im(s,null,c,a):Si(r,s,c,a),s.child;case 11:return c=s.type,h=s.pendingProps,h=s.elementType===c?h:ka(c,h),A8(r,s,c,h,a);case 7:return Si(r,s,s.pendingProps,a),s.child;case 8:return Si(r,s,s.pendingProps.children,a),s.child;case 12:return Si(r,s,s.pendingProps.children,a),s.child;case 10:e:{if(c=s.type._context,h=s.pendingProps,f=s.memoizedProps,_=h.value,gr(xb,c._currentValue),c._currentValue=_,f!==null)if(Ga(f.value,_)){if(f.children===h.children&&!Yi.current){s=ul(r,s,a);break e}}else for(f=s.child,f!==null&&(f.return=s);f!==null;){var E=f.dependencies;if(E!==null){_=f.child;for(var v=E.firstContext;v!==null;){if(v.context===c){if(f.tag===1){v=ol(-1,a&-a),v.tag=2;var x=f.updateQueue;if(x!==null){x=x.shared;var T=x.pending;T===null?v.next=v:(v.next=T.next,T.next=v),x.pending=v}}f.lanes|=a,v=f.alternate,v!==null&&(v.lanes|=a),B1(f.return,a,s),E.lanes|=a;break}v=v.next}}else if(f.tag===10)_=f.type===s.type?null:f.child;else if(f.tag===18){if(_=f.return,_===null)throw Error(Qe(341));_.lanes|=a,E=_.alternate,E!==null&&(E.lanes|=a),B1(_,a,s),_=f.sibling}else _=f.child;if(_!==null)_.return=f;else for(_=f;_!==null;){if(_===s){_=null;break}if(f=_.sibling,f!==null){f.return=_.return,_=f;break}_=_.return}f=_}Si(r,s,h.children,a),s=s.child}return s;case 9:return h=s.type,c=s.pendingProps.children,mm(s,a),h=na(h),c=c(h),s.flags|=1,Si(r,s,c,a),s.child;case 14:return c=s.type,h=ka(c,s.pendingProps),h=ka(c.type,h),I8(r,s,c,h,a);case 15:return o9(r,s,s.type,s.pendingProps,a);case 17:return c=s.type,h=s.pendingProps,h=s.elementType===c?h:ka(c,h),zv(r,s),s.tag=1,qi(c)?(r=!0,vb(s)):r=!1,mm(s,a),r9(s,c,h),W1(s,c,h,a),K1(null,s,c,!0,r,a);case 19:return u9(r,s,a);case 22:return a9(r,s,a)}throw Error(Qe(156,s.tag))};function R9(r,s){return e7(r,s)}function mfe(r,s,a,c){this.tag=r,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zo(r,s,a,c){return new mfe(r,s,a,c)}function KI(r){return r=r.prototype,!(!r||!r.isReactComponent)}function ffe(r){if(typeof r=="function")return KI(r)?1:0;if(r!=null){if(r=r.$$typeof,r===uI)return 11;if(r===hI)return 14}return 2}function xd(r,s){var a=r.alternate;return a===null?(a=Zo(r.tag,s,r.key,r.mode),a.elementType=r.elementType,a.type=r.type,a.stateNode=r.stateNode,a.alternate=r,r.alternate=a):(a.pendingProps=s,a.type=r.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=r.flags&14680064,a.childLanes=r.childLanes,a.lanes=r.lanes,a.child=r.child,a.memoizedProps=r.memoizedProps,a.memoizedState=r.memoizedState,a.updateQueue=r.updateQueue,s=r.dependencies,a.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},a.sibling=r.sibling,a.index=r.index,a.ref=r.ref,a}function Xv(r,s,a,c,h,f){var _=2;if(c=r,typeof r=="function")KI(r)&&(_=1);else if(typeof r=="string")_=5;else e:switch(r){case Yp:return Zu(a.children,h,f,s);case dI:_=8,h|=8;break;case p1:return r=Zo(12,a,s,h|2),r.elementType=p1,r.lanes=f,r;case m1:return r=Zo(13,a,s,h),r.elementType=m1,r.lanes=f,r;case f1:return r=Zo(19,a,s,h),r.elementType=f1,r.lanes=f,r;case jG:return hS(a,h,f,s);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case LG:_=10;break e;case MG:_=9;break e;case uI:_=11;break e;case hI:_=14;break e;case sd:_=16,c=null;break e}throw Error(Qe(130,r==null?r:typeof r,""))}return s=Zo(_,a,s,h),s.elementType=r,s.type=c,s.lanes=f,s}function Zu(r,s,a,c){return r=Zo(7,r,c,s),r.lanes=a,r}function hS(r,s,a,c){return r=Zo(22,r,c,s),r.elementType=jG,r.lanes=a,r.stateNode={isHidden:!1},r}function MN(r,s,a){return r=Zo(6,r,null,s),r.lanes=a,r}function jN(r,s,a){return s=Zo(4,r.children!==null?r.children:[],r.key,s),s.lanes=a,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}function gfe(r,s,a,c,h){this.tag=s,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=_N(0),this.expirationTimes=_N(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_N(0),this.identifierPrefix=c,this.onRecoverableError=h,this.mutableSourceEagerHydrationData=null}function zI(r,s,a,c,h,f,_,E,v){return r=new gfe(r,s,a,E,v),s===1?(s=1,f===!0&&(s|=8)):s=0,f=Zo(3,null,null,s),r.current=f,f.stateNode=r,f.memoizedState={element:c,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},II(f),r}function _fe(r,s,a){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:zp,key:c==null?null:""+c,children:r,containerInfo:s,implementation:a}}function N9(r){if(!r)return Nd;r=r._reactInternals;e:{if(ph(r)!==r||r.tag!==1)throw Error(Qe(170));var s=r;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(qi(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(Qe(171))}if(r.tag===1){var a=r.type;if(qi(a))return N7(r,a,s)}return s}function A9(r,s,a,c,h,f,_,E,v){return r=zI(a,c,!0,r,h,f,_,E,v),r.context=N9(null),a=r.current,c=Ci(),h=Sd(a),f=ol(c,h),f.callback=s??null,vd(a,f,h),r.current.lanes=h,J0(r,h,c),Xi(r,c),r}function pS(r,s,a,c){var h=s.current,f=Ci(),_=Sd(h);return a=N9(a),s.context===null?s.context=a:s.pendingContext=a,s=ol(f,_),s.payload={element:r},c=c===void 0?null:c,c!==null&&(s.callback=c),r=vd(h,s,_),r!==null&&($a(r,h,_,f),Gv(r,h,_)),_}function Db(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function $8(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var a=r.retryLane;r.retryLane=a!==0&&a<s?a:s}}function YI(r,s){$8(r,s),(r=r.alternate)&&$8(r,s)}function yfe(){return null}var I9=typeof reportError=="function"?reportError:function(r){console.error(r)};function qI(r){this._internalRoot=r}mS.prototype.render=qI.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(Qe(409));pS(r,s,null,null)};mS.prototype.unmount=qI.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;ah(function(){pS(null,r,null,null)}),s[ll]=null}};function mS(r){this._internalRoot=r}mS.prototype.unstable_scheduleHydration=function(r){if(r){var s=a7();r={blockedOn:null,target:r,priority:s};for(var a=0;a<od.length&&s!==0&&s<od[a].priority;a++);od.splice(a,0,r),a===0&&l7(r)}};function XI(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function fS(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function W8(){}function Efe(r,s,a,c,h){if(h){if(typeof c=="function"){var f=c;c=function(){var x=Db(_);f.call(x)}}var _=A9(s,c,r,0,null,!1,!1,"",W8);return r._reactRootContainer=_,r[ll]=_.current,b0(r.nodeType===8?r.parentNode:r),ah(),_}for(;h=r.lastChild;)r.removeChild(h);if(typeof c=="function"){var E=c;c=function(){var x=Db(v);E.call(x)}}var v=zI(r,0,!1,null,null,!1,!1,"",W8);return r._reactRootContainer=v,r[ll]=v.current,b0(r.nodeType===8?r.parentNode:r),ah(function(){pS(s,v,a,c)}),v}function gS(r,s,a,c,h){var f=a._reactRootContainer;if(f){var _=f;if(typeof h=="function"){var E=h;h=function(){var v=Db(_);E.call(v)}}pS(s,_,r,h)}else _=Efe(a,s,r,h,c);return Db(_)}i7=function(r){switch(r.tag){case 3:var s=r.stateNode;if(s.current.memoizedState.isDehydrated){var a=Gg(s.pendingLanes);a!==0&&(fI(s,a|1),Xi(s,is()),!(Bn&6)&&(Dm=is()+500,Ld()))}break;case 13:ah(function(){var c=dl(r,1);if(c!==null){var h=Ci();$a(c,r,1,h)}}),YI(r,1)}};gI=function(r){if(r.tag===13){var s=dl(r,134217728);if(s!==null){var a=Ci();$a(s,r,134217728,a)}YI(r,134217728)}};o7=function(r){if(r.tag===13){var s=Sd(r),a=dl(r,s);if(a!==null){var c=Ci();$a(a,r,s,c)}YI(r,s)}};a7=function(){return rr};c7=function(r,s){var a=rr;try{return rr=r,s()}finally{rr=a}};T1=function(r,s,a){switch(s){case"input":if(y1(r,a),s=a.name,a.type==="radio"&&s!=null){for(a=r;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<a.length;s++){var c=a[s];if(c!==r&&c.form===r.form){var h=oS(c);if(!h)throw Error(Qe(90));VG(c),y1(c,h)}}}break;case"textarea":BG(r,a);break;case"select":s=a.value,s!=null&&dm(r,!!a.multiple,s,!1)}};YG=WI;qG=ah;var vfe={usingClientEntryPoint:!1,Events:[Z0,Qp,oS,KG,zG,WI]},Dg={findFiberByHostInstance:Bu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},bfe={bundleType:Dg.bundleType,version:Dg.version,rendererPackageName:Dg.rendererPackageName,rendererConfig:Dg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:yl.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=QG(r),r===null?null:r.stateNode},findFiberByHostInstance:Dg.findFiberByHostInstance||yfe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Tv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Tv.isDisabled&&Tv.supportsFiber)try{nS=Tv.inject(bfe),Cc=Tv}catch{}}vo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vfe;vo.createPortal=function(r,s){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!XI(s))throw Error(Qe(200));return _fe(r,s,null,a)};vo.createRoot=function(r,s){if(!XI(r))throw Error(Qe(299));var a=!1,c="",h=I9;return s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(c=s.identifierPrefix),s.onRecoverableError!==void 0&&(h=s.onRecoverableError)),s=zI(r,1,!1,null,null,a,!1,c,h),r[ll]=s.current,b0(r.nodeType===8?r.parentNode:r),new qI(s)};vo.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(Qe(188)):(r=Object.keys(r).join(","),Error(Qe(268,r)));return r=QG(s),r=r===null?null:r.stateNode,r};vo.flushSync=function(r){return ah(r)};vo.hydrate=function(r,s,a){if(!fS(s))throw Error(Qe(200));return gS(null,r,s,!0,a)};vo.hydrateRoot=function(r,s,a){if(!XI(r))throw Error(Qe(405));var c=a!=null&&a.hydratedSources||null,h=!1,f="",_=I9;if(a!=null&&(a.unstable_strictMode===!0&&(h=!0),a.identifierPrefix!==void 0&&(f=a.identifierPrefix),a.onRecoverableError!==void 0&&(_=a.onRecoverableError)),s=A9(s,null,r,1,a??null,h,!1,f,_),r[ll]=s.current,b0(r),c)for(r=0;r<c.length;r++)a=c[r],h=a._getVersion,h=h(a._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[a,h]:s.mutableSourceEagerHydrationData.push(a,h);return new mS(s)};vo.render=function(r,s,a){if(!fS(s))throw Error(Qe(200));return gS(null,r,s,!1,a)};vo.unmountComponentAtNode=function(r){if(!fS(r))throw Error(Qe(40));return r._reactRootContainer?(ah(function(){gS(null,null,r,!1,function(){r._reactRootContainer=null,r[ll]=null})}),!0):!1};vo.unstable_batchedUpdates=WI;vo.unstable_renderSubtreeIntoContainer=function(r,s,a,c){if(!fS(a))throw Error(Qe(200));if(r==null||r._reactInternals===void 0)throw Error(Qe(38));return gS(r,s,a,!1,c)};vo.version="18.3.1-next-f1338f8080-20240426";function O9(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(O9)}catch(r){console.error(r)}}O9(),OG.exports=vo;var t_=OG.exports;const P9=nI(t_);var D9,G8=t_;D9=G8.createRoot,G8.hydrateRoot;const Sfe=1,xfe=1e6;let UN=0;function wfe(){return UN=(UN+1)%Number.MAX_SAFE_INTEGER,UN.toString()}const VN=new Map,H8=r=>{if(VN.has(r))return;const s=setTimeout(()=>{VN.delete(r),i0({type:"REMOVE_TOAST",toastId:r})},xfe);VN.set(r,s)},Tfe=(r,s)=>{switch(s.type){case"ADD_TOAST":return{...r,toasts:[s.toast,...r.toasts].slice(0,Sfe)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(a=>a.id===s.toast.id?{...a,...s.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=s;return a?H8(a):r.toasts.forEach(c=>{H8(c.id)}),{...r,toasts:r.toasts.map(c=>c.id===a||a===void 0?{...c,open:!1}:c)}}case"REMOVE_TOAST":return s.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(a=>a.id!==s.toastId)}}},Jv=[];let Qv={toasts:[]};function i0(r){Qv=Tfe(Qv,r),Jv.forEach(s=>{s(Qv)})}function Cfe({...r}){const s=wfe(),a=h=>i0({type:"UPDATE_TOAST",toast:{...h,id:s}}),c=()=>i0({type:"DISMISS_TOAST",toastId:s});return i0({type:"ADD_TOAST",toast:{...r,id:s,open:!0,onOpenChange:h=>{h||c()}}}),{id:s,dismiss:c,update:a}}function za(){const[r,s]=V.useState(Qv);return V.useEffect(()=>(Jv.push(s),()=>{const a=Jv.indexOf(s);a>-1&&Jv.splice(a,1)}),[r]),{...r,toast:Cfe,dismiss:a=>i0({type:"DISMISS_TOAST",toastId:a})}}function fr(r,s,{checkForDefaultPrevented:a=!0}={}){return function(h){if(r==null||r(h),a===!1||!h.defaultPrevented)return s==null?void 0:s(h)}}function K8(r,s){if(typeof r=="function")return r(s);r!=null&&(r.current=s)}function k9(...r){return s=>{let a=!1;const c=r.map(h=>{const f=K8(h,s);return!a&&typeof f=="function"&&(a=!0),f});if(a)return()=>{for(let h=0;h<c.length;h++){const f=c[h];typeof f=="function"?f():K8(r[h],null)}}}}function qs(...r){return V.useCallback(k9(...r),r)}function n_(r,s=[]){let a=[];function c(f,_){const E=V.createContext(_),v=a.length;a=[...a,_];const x=R=>{var M;const{scope:N,children:L,...j}=R,F=((M=N==null?void 0:N[r])==null?void 0:M[v])||E,P=V.useMemo(()=>j,Object.values(j));return d.jsx(F.Provider,{value:P,children:L})};x.displayName=f+"Provider";function T(R,N){var F;const L=((F=N==null?void 0:N[r])==null?void 0:F[v])||E,j=V.useContext(L);if(j)return j;if(_!==void 0)return _;throw new Error(`\`${R}\` must be used within \`${f}\``)}return[x,T]}const h=()=>{const f=a.map(_=>V.createContext(_));return function(E){const v=(E==null?void 0:E[r])||f;return V.useMemo(()=>({[`__scope${r}`]:{...E,[r]:v}}),[E,v])}};return h.scopeName=r,[c,Rfe(h,...s)]}function Rfe(...r){const s=r[0];if(r.length===1)return s;const a=()=>{const c=r.map(h=>({useScope:h(),scopeName:h.scopeName}));return function(f){const _=c.reduce((E,{useScope:v,scopeName:x})=>{const R=v(f)[`__scope${x}`];return{...E,...R}},{});return V.useMemo(()=>({[`__scope${s.scopeName}`]:_}),[_])}};return a.scopeName=s.scopeName,a}function kb(r){const s=Afe(r),a=V.forwardRef((c,h)=>{const{children:f,..._}=c,E=V.Children.toArray(f),v=E.find(Ofe);if(v){const x=v.props.children,T=E.map(R=>R===v?V.Children.count(x)>1?V.Children.only(null):V.isValidElement(x)?x.props.children:null:R);return d.jsx(s,{..._,ref:h,children:V.isValidElement(x)?V.cloneElement(x,void 0,T):null})}return d.jsx(s,{..._,ref:h,children:f})});return a.displayName=`${r}.Slot`,a}var Nfe=kb("Slot");function Afe(r){const s=V.forwardRef((a,c)=>{const{children:h,...f}=a;if(V.isValidElement(h)){const _=Dfe(h),E=Pfe(f,h.props);return h.type!==V.Fragment&&(E.ref=c?k9(c,_):_),V.cloneElement(h,E)}return V.Children.count(h)>1?V.Children.only(null):null});return s.displayName=`${r}.SlotClone`,s}var L9=Symbol("radix.slottable");function Ife(r){const s=({children:a})=>d.jsx(d.Fragment,{children:a});return s.displayName=`${r}.Slottable`,s.__radixId=L9,s}function Ofe(r){return V.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===L9}function Pfe(r,s){const a={...s};for(const c in s){const h=r[c],f=s[c];/^on[A-Z]/.test(c)?h&&f?a[c]=(...E)=>{const v=f(...E);return h(...E),v}:h&&(a[c]=h):c==="style"?a[c]={...h,...f}:c==="className"&&(a[c]=[h,f].filter(Boolean).join(" "))}return{...r,...a}}function Dfe(r){var c,h;let s=(c=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:c.get,a=s&&"isReactWarning"in s&&s.isReactWarning;return a?r.ref:(s=(h=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:h.get,a=s&&"isReactWarning"in s&&s.isReactWarning,a?r.props.ref:r.props.ref||r.ref)}function kfe(r){const s=r+"CollectionProvider",[a,c]=n_(s),[h,f]=a(s,{collectionRef:{current:null},itemMap:new Map}),_=F=>{const{scope:P,children:M}=F,U=rt.useRef(null),B=rt.useRef(new Map).current;return d.jsx(h,{scope:P,itemMap:B,collectionRef:U,children:M})};_.displayName=s;const E=r+"CollectionSlot",v=kb(E),x=rt.forwardRef((F,P)=>{const{scope:M,children:U}=F,B=f(E,M),K=qs(P,B.collectionRef);return d.jsx(v,{ref:K,children:U})});x.displayName=E;const T=r+"CollectionItemSlot",R="data-radix-collection-item",N=kb(T),L=rt.forwardRef((F,P)=>{const{scope:M,children:U,...B}=F,K=rt.useRef(null),J=qs(P,K),te=f(T,M);return rt.useEffect(()=>(te.itemMap.set(K,{ref:K,...B}),()=>void te.itemMap.delete(K))),d.jsx(N,{[R]:"",ref:J,children:U})});L.displayName=T;function j(F){const P=f(r+"CollectionConsumer",F);return rt.useCallback(()=>{const U=P.collectionRef.current;if(!U)return[];const B=Array.from(U.querySelectorAll(`[${R}]`));return Array.from(P.itemMap.values()).sort((te,se)=>B.indexOf(te.ref.current)-B.indexOf(se.ref.current))},[P.collectionRef,P.itemMap])}return[{Provider:_,Slot:x,ItemSlot:L},j,c]}var Lfe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ss=Lfe.reduce((r,s)=>{const a=kb(`Primitive.${s}`),c=V.forwardRef((h,f)=>{const{asChild:_,...E}=h,v=_?a:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),d.jsx(v,{...E,ref:f})});return c.displayName=`Primitive.${s}`,{...r,[s]:c}},{});function M9(r,s){r&&t_.flushSync(()=>r.dispatchEvent(s))}function wi(r){const s=V.useRef(r);return V.useEffect(()=>{s.current=r}),V.useMemo(()=>(...a)=>{var c;return(c=s.current)==null?void 0:c.call(s,...a)},[])}function Mfe(r,s=globalThis==null?void 0:globalThis.document){const a=wi(r);V.useEffect(()=>{const c=h=>{h.key==="Escape"&&a(h)};return s.addEventListener("keydown",c,{capture:!0}),()=>s.removeEventListener("keydown",c,{capture:!0})},[a,s])}var jfe="DismissableLayer",sA="dismissableLayer.update",Ufe="dismissableLayer.pointerDownOutside",Vfe="dismissableLayer.focusOutside",z8,j9=V.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),JI=V.forwardRef((r,s)=>{const{disableOutsidePointerEvents:a=!1,onEscapeKeyDown:c,onPointerDownOutside:h,onFocusOutside:f,onInteractOutside:_,onDismiss:E,...v}=r,x=V.useContext(j9),[T,R]=V.useState(null),N=(T==null?void 0:T.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,L]=V.useState({}),j=qs(s,se=>R(se)),F=Array.from(x.layers),[P]=[...x.layersWithOutsidePointerEventsDisabled].slice(-1),M=F.indexOf(P),U=T?F.indexOf(T):-1,B=x.layersWithOutsidePointerEventsDisabled.size>0,K=U>=M,J=Bfe(se=>{const ie=se.target,ue=[...x.branches].some(de=>de.contains(ie));!K||ue||(h==null||h(se),_==null||_(se),se.defaultPrevented||E==null||E())},N),te=$fe(se=>{const ie=se.target;[...x.branches].some(de=>de.contains(ie))||(f==null||f(se),_==null||_(se),se.defaultPrevented||E==null||E())},N);return Mfe(se=>{U===x.layers.size-1&&(c==null||c(se),!se.defaultPrevented&&E&&(se.preventDefault(),E()))},N),V.useEffect(()=>{if(T)return a&&(x.layersWithOutsidePointerEventsDisabled.size===0&&(z8=N.body.style.pointerEvents,N.body.style.pointerEvents="none"),x.layersWithOutsidePointerEventsDisabled.add(T)),x.layers.add(T),Y8(),()=>{a&&x.layersWithOutsidePointerEventsDisabled.size===1&&(N.body.style.pointerEvents=z8)}},[T,N,a,x]),V.useEffect(()=>()=>{T&&(x.layers.delete(T),x.layersWithOutsidePointerEventsDisabled.delete(T),Y8())},[T,x]),V.useEffect(()=>{const se=()=>L({});return document.addEventListener(sA,se),()=>document.removeEventListener(sA,se)},[]),d.jsx(Ss.div,{...v,ref:j,style:{pointerEvents:B?K?"auto":"none":void 0,...r.style},onFocusCapture:fr(r.onFocusCapture,te.onFocusCapture),onBlurCapture:fr(r.onBlurCapture,te.onBlurCapture),onPointerDownCapture:fr(r.onPointerDownCapture,J.onPointerDownCapture)})});JI.displayName=jfe;var Ffe="DismissableLayerBranch",U9=V.forwardRef((r,s)=>{const a=V.useContext(j9),c=V.useRef(null),h=qs(s,c);return V.useEffect(()=>{const f=c.current;if(f)return a.branches.add(f),()=>{a.branches.delete(f)}},[a.branches]),d.jsx(Ss.div,{...r,ref:h})});U9.displayName=Ffe;function Bfe(r,s=globalThis==null?void 0:globalThis.document){const a=wi(r),c=V.useRef(!1),h=V.useRef(()=>{});return V.useEffect(()=>{const f=E=>{if(E.target&&!c.current){let v=function(){V9(Ufe,a,x,{discrete:!0})};const x={originalEvent:E};E.pointerType==="touch"?(s.removeEventListener("click",h.current),h.current=v,s.addEventListener("click",h.current,{once:!0})):v()}else s.removeEventListener("click",h.current);c.current=!1},_=window.setTimeout(()=>{s.addEventListener("pointerdown",f)},0);return()=>{window.clearTimeout(_),s.removeEventListener("pointerdown",f),s.removeEventListener("click",h.current)}},[s,a]),{onPointerDownCapture:()=>c.current=!0}}function $fe(r,s=globalThis==null?void 0:globalThis.document){const a=wi(r),c=V.useRef(!1);return V.useEffect(()=>{const h=f=>{f.target&&!c.current&&V9(Vfe,a,{originalEvent:f},{discrete:!1})};return s.addEventListener("focusin",h),()=>s.removeEventListener("focusin",h)},[s,a]),{onFocusCapture:()=>c.current=!0,onBlurCapture:()=>c.current=!1}}function Y8(){const r=new CustomEvent(sA);document.dispatchEvent(r)}function V9(r,s,a,{discrete:c}){const h=a.originalEvent.target,f=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:a});s&&h.addEventListener(r,s,{once:!0}),c?M9(h,f):h.dispatchEvent(f)}var Wfe=JI,Gfe=U9,hl=globalThis!=null&&globalThis.document?V.useLayoutEffect:()=>{},Hfe="Portal",F9=V.forwardRef((r,s)=>{var E;const{container:a,...c}=r,[h,f]=V.useState(!1);hl(()=>f(!0),[]);const _=a||h&&((E=globalThis==null?void 0:globalThis.document)==null?void 0:E.body);return _?P9.createPortal(d.jsx(Ss.div,{...c,ref:s}),_):null});F9.displayName=Hfe;function Kfe(r,s){return V.useReducer((a,c)=>s[a][c]??a,r)}var mh=r=>{const{present:s,children:a}=r,c=zfe(s),h=typeof a=="function"?a({present:c.isPresent}):V.Children.only(a),f=qs(c.ref,Yfe(h));return typeof a=="function"||c.isPresent?V.cloneElement(h,{ref:f}):null};mh.displayName="Presence";function zfe(r){const[s,a]=V.useState(),c=V.useRef(null),h=V.useRef(r),f=V.useRef("none"),_=r?"mounted":"unmounted",[E,v]=Kfe(_,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return V.useEffect(()=>{const x=Cv(c.current);f.current=E==="mounted"?x:"none"},[E]),hl(()=>{const x=c.current,T=h.current;if(T!==r){const N=f.current,L=Cv(x);r?v("MOUNT"):L==="none"||(x==null?void 0:x.display)==="none"?v("UNMOUNT"):v(T&&N!==L?"ANIMATION_OUT":"UNMOUNT"),h.current=r}},[r,v]),hl(()=>{if(s){let x;const T=s.ownerDocument.defaultView??window,R=L=>{const F=Cv(c.current).includes(L.animationName);if(L.target===s&&F&&(v("ANIMATION_END"),!h.current)){const P=s.style.animationFillMode;s.style.animationFillMode="forwards",x=T.setTimeout(()=>{s.style.animationFillMode==="forwards"&&(s.style.animationFillMode=P)})}},N=L=>{L.target===s&&(f.current=Cv(c.current))};return s.addEventListener("animationstart",N),s.addEventListener("animationcancel",R),s.addEventListener("animationend",R),()=>{T.clearTimeout(x),s.removeEventListener("animationstart",N),s.removeEventListener("animationcancel",R),s.removeEventListener("animationend",R)}}else v("ANIMATION_END")},[s,v]),{isPresent:["mounted","unmountSuspended"].includes(E),ref:V.useCallback(x=>{c.current=x?getComputedStyle(x):null,a(x)},[])}}function Cv(r){return(r==null?void 0:r.animationName)||"none"}function Yfe(r){var c,h;let s=(c=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:c.get,a=s&&"isReactWarning"in s&&s.isReactWarning;return a?r.ref:(s=(h=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:h.get,a=s&&"isReactWarning"in s&&s.isReactWarning,a?r.props.ref:r.props.ref||r.ref)}var qfe=AG[" useInsertionEffect ".trim().toString()]||hl;function Xfe({prop:r,defaultProp:s,onChange:a=()=>{},caller:c}){const[h,f,_]=Jfe({defaultProp:s,onChange:a}),E=r!==void 0,v=E?r:h;{const T=V.useRef(r!==void 0);V.useEffect(()=>{const R=T.current;R!==E&&console.warn(`${c} is changing from ${R?"controlled":"uncontrolled"} to ${E?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),T.current=E},[E,c])}const x=V.useCallback(T=>{var R;if(E){const N=Qfe(T)?T(r):T;N!==r&&((R=_.current)==null||R.call(_,N))}else f(T)},[E,r,f,_]);return[v,x]}function Jfe({defaultProp:r,onChange:s}){const[a,c]=V.useState(r),h=V.useRef(a),f=V.useRef(s);return qfe(()=>{f.current=s},[s]),V.useEffect(()=>{var _;h.current!==a&&((_=f.current)==null||_.call(f,a),h.current=a)},[a,h]),[a,c,f]}function Qfe(r){return typeof r=="function"}var Zfe=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),ege="VisuallyHidden",_S=V.forwardRef((r,s)=>d.jsx(Ss.span,{...r,ref:s,style:{...Zfe,...r.style}}));_S.displayName=ege;var tge=_S,QI="ToastProvider",[ZI,nge,rge]=kfe("Toast"),[B9,V1e]=n_("Toast",[rge]),[sge,yS]=B9(QI),$9=r=>{const{__scopeToast:s,label:a="Notification",duration:c=5e3,swipeDirection:h="right",swipeThreshold:f=50,children:_}=r,[E,v]=V.useState(null),[x,T]=V.useState(0),R=V.useRef(!1),N=V.useRef(!1);return a.trim()||console.error(`Invalid prop \`label\` supplied to \`${QI}\`. Expected non-empty \`string\`.`),d.jsx(ZI.Provider,{scope:s,children:d.jsx(sge,{scope:s,label:a,duration:c,swipeDirection:h,swipeThreshold:f,toastCount:x,viewport:E,onViewportChange:v,onToastAdd:V.useCallback(()=>T(L=>L+1),[]),onToastRemove:V.useCallback(()=>T(L=>L-1),[]),isFocusedToastEscapeKeyDownRef:R,isClosePausedRef:N,children:_})})};$9.displayName=QI;var W9="ToastViewport",ige=["F8"],iA="toast.viewportPause",oA="toast.viewportResume",G9=V.forwardRef((r,s)=>{const{__scopeToast:a,hotkey:c=ige,label:h="Notifications ({hotkey})",...f}=r,_=yS(W9,a),E=nge(a),v=V.useRef(null),x=V.useRef(null),T=V.useRef(null),R=V.useRef(null),N=qs(s,R,_.onViewportChange),L=c.join("+").replace(/Key/g,"").replace(/Digit/g,""),j=_.toastCount>0;V.useEffect(()=>{const P=M=>{var B;c.length!==0&&c.every(K=>M[K]||M.code===K)&&((B=R.current)==null||B.focus())};return document.addEventListener("keydown",P),()=>document.removeEventListener("keydown",P)},[c]),V.useEffect(()=>{const P=v.current,M=R.current;if(j&&P&&M){const U=()=>{if(!_.isClosePausedRef.current){const te=new CustomEvent(iA);M.dispatchEvent(te),_.isClosePausedRef.current=!0}},B=()=>{if(_.isClosePausedRef.current){const te=new CustomEvent(oA);M.dispatchEvent(te),_.isClosePausedRef.current=!1}},K=te=>{!P.contains(te.relatedTarget)&&B()},J=()=>{P.contains(document.activeElement)||B()};return P.addEventListener("focusin",U),P.addEventListener("focusout",K),P.addEventListener("pointermove",U),P.addEventListener("pointerleave",J),window.addEventListener("blur",U),window.addEventListener("focus",B),()=>{P.removeEventListener("focusin",U),P.removeEventListener("focusout",K),P.removeEventListener("pointermove",U),P.removeEventListener("pointerleave",J),window.removeEventListener("blur",U),window.removeEventListener("focus",B)}}},[j,_.isClosePausedRef]);const F=V.useCallback(({tabbingDirection:P})=>{const U=E().map(B=>{const K=B.ref.current,J=[K,...yge(K)];return P==="forwards"?J:J.reverse()});return(P==="forwards"?U.reverse():U).flat()},[E]);return V.useEffect(()=>{const P=R.current;if(P){const M=U=>{var J,te,se;const B=U.altKey||U.ctrlKey||U.metaKey;if(U.key==="Tab"&&!B){const ie=document.activeElement,ue=U.shiftKey;if(U.target===P&&ue){(J=x.current)==null||J.focus();return}const Ce=F({tabbingDirection:ue?"backwards":"forwards"}),tt=Ce.findIndex(Se=>Se===ie);FN(Ce.slice(tt+1))?U.preventDefault():ue?(te=x.current)==null||te.focus():(se=T.current)==null||se.focus()}};return P.addEventListener("keydown",M),()=>P.removeEventListener("keydown",M)}},[E,F]),d.jsxs(Gfe,{ref:v,role:"region","aria-label":h.replace("{hotkey}",L),tabIndex:-1,style:{pointerEvents:j?void 0:"none"},children:[j&&d.jsx(aA,{ref:x,onFocusFromOutsideViewport:()=>{const P=F({tabbingDirection:"forwards"});FN(P)}}),d.jsx(ZI.Slot,{scope:a,children:d.jsx(Ss.ol,{tabIndex:-1,...f,ref:N})}),j&&d.jsx(aA,{ref:T,onFocusFromOutsideViewport:()=>{const P=F({tabbingDirection:"backwards"});FN(P)}})]})});G9.displayName=W9;var H9="ToastFocusProxy",aA=V.forwardRef((r,s)=>{const{__scopeToast:a,onFocusFromOutsideViewport:c,...h}=r,f=yS(H9,a);return d.jsx(_S,{"aria-hidden":!0,tabIndex:0,...h,ref:s,style:{position:"fixed"},onFocus:_=>{var x;const E=_.relatedTarget;!((x=f.viewport)!=null&&x.contains(E))&&c()}})});aA.displayName=H9;var r_="Toast",oge="toast.swipeStart",age="toast.swipeMove",cge="toast.swipeCancel",lge="toast.swipeEnd",K9=V.forwardRef((r,s)=>{const{forceMount:a,open:c,defaultOpen:h,onOpenChange:f,..._}=r,[E,v]=Xfe({prop:c,defaultProp:h??!0,onChange:f,caller:r_});return d.jsx(mh,{present:a||E,children:d.jsx(hge,{open:E,..._,ref:s,onClose:()=>v(!1),onPause:wi(r.onPause),onResume:wi(r.onResume),onSwipeStart:fr(r.onSwipeStart,x=>{x.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:fr(r.onSwipeMove,x=>{const{x:T,y:R}=x.detail.delta;x.currentTarget.setAttribute("data-swipe","move"),x.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${T}px`),x.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${R}px`)}),onSwipeCancel:fr(r.onSwipeCancel,x=>{x.currentTarget.setAttribute("data-swipe","cancel"),x.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),x.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),x.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),x.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:fr(r.onSwipeEnd,x=>{const{x:T,y:R}=x.detail.delta;x.currentTarget.setAttribute("data-swipe","end"),x.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),x.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),x.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${T}px`),x.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${R}px`),v(!1)})})})});K9.displayName=r_;var[dge,uge]=B9(r_,{onClose(){}}),hge=V.forwardRef((r,s)=>{const{__scopeToast:a,type:c="foreground",duration:h,open:f,onClose:_,onEscapeKeyDown:E,onPause:v,onResume:x,onSwipeStart:T,onSwipeMove:R,onSwipeCancel:N,onSwipeEnd:L,...j}=r,F=yS(r_,a),[P,M]=V.useState(null),U=qs(s,Se=>M(Se)),B=V.useRef(null),K=V.useRef(null),J=h||F.duration,te=V.useRef(0),se=V.useRef(J),ie=V.useRef(0),{onToastAdd:ue,onToastRemove:de}=F,Ne=wi(()=>{var Ge;(P==null?void 0:P.contains(document.activeElement))&&((Ge=F.viewport)==null||Ge.focus()),_()}),Ce=V.useCallback(Se=>{!Se||Se===1/0||(window.clearTimeout(ie.current),te.current=new Date().getTime(),ie.current=window.setTimeout(Ne,Se))},[Ne]);V.useEffect(()=>{const Se=F.viewport;if(Se){const Ge=()=>{Ce(se.current),x==null||x()},Xe=()=>{const Re=new Date().getTime()-te.current;se.current=se.current-Re,window.clearTimeout(ie.current),v==null||v()};return Se.addEventListener(iA,Xe),Se.addEventListener(oA,Ge),()=>{Se.removeEventListener(iA,Xe),Se.removeEventListener(oA,Ge)}}},[F.viewport,J,v,x,Ce]),V.useEffect(()=>{f&&!F.isClosePausedRef.current&&Ce(J)},[f,J,F.isClosePausedRef,Ce]),V.useEffect(()=>(ue(),()=>de()),[ue,de]);const tt=V.useMemo(()=>P?Z9(P):null,[P]);return F.viewport?d.jsxs(d.Fragment,{children:[tt&&d.jsx(pge,{__scopeToast:a,role:"status","aria-live":c==="foreground"?"assertive":"polite","aria-atomic":!0,children:tt}),d.jsx(dge,{scope:a,onClose:Ne,children:t_.createPortal(d.jsx(ZI.ItemSlot,{scope:a,children:d.jsx(Wfe,{asChild:!0,onEscapeKeyDown:fr(E,()=>{F.isFocusedToastEscapeKeyDownRef.current||Ne(),F.isFocusedToastEscapeKeyDownRef.current=!1}),children:d.jsx(Ss.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":f?"open":"closed","data-swipe-direction":F.swipeDirection,...j,ref:U,style:{userSelect:"none",touchAction:"none",...r.style},onKeyDown:fr(r.onKeyDown,Se=>{Se.key==="Escape"&&(E==null||E(Se.nativeEvent),Se.nativeEvent.defaultPrevented||(F.isFocusedToastEscapeKeyDownRef.current=!0,Ne()))}),onPointerDown:fr(r.onPointerDown,Se=>{Se.button===0&&(B.current={x:Se.clientX,y:Se.clientY})}),onPointerMove:fr(r.onPointerMove,Se=>{if(!B.current)return;const Ge=Se.clientX-B.current.x,Xe=Se.clientY-B.current.y,Re=!!K.current,le=["left","right"].includes(F.swipeDirection),ve=["left","up"].includes(F.swipeDirection)?Math.min:Math.max,Le=le?ve(0,Ge):0,qe=le?0:ve(0,Xe),We=Se.pointerType==="touch"?10:2,xt={x:Le,y:qe},bt={originalEvent:Se,delta:xt};Re?(K.current=xt,Rv(age,R,bt,{discrete:!1})):q8(xt,F.swipeDirection,We)?(K.current=xt,Rv(oge,T,bt,{discrete:!1}),Se.target.setPointerCapture(Se.pointerId)):(Math.abs(Ge)>We||Math.abs(Xe)>We)&&(B.current=null)}),onPointerUp:fr(r.onPointerUp,Se=>{const Ge=K.current,Xe=Se.target;if(Xe.hasPointerCapture(Se.pointerId)&&Xe.releasePointerCapture(Se.pointerId),K.current=null,B.current=null,Ge){const Re=Se.currentTarget,le={originalEvent:Se,delta:Ge};q8(Ge,F.swipeDirection,F.swipeThreshold)?Rv(lge,L,le,{discrete:!0}):Rv(cge,N,le,{discrete:!0}),Re.addEventListener("click",ve=>ve.preventDefault(),{once:!0})}})})})}),F.viewport)})]}):null}),pge=r=>{const{__scopeToast:s,children:a,...c}=r,h=yS(r_,s),[f,_]=V.useState(!1),[E,v]=V.useState(!1);return gge(()=>_(!0)),V.useEffect(()=>{const x=window.setTimeout(()=>v(!0),1e3);return()=>window.clearTimeout(x)},[]),E?null:d.jsx(F9,{asChild:!0,children:d.jsx(_S,{...c,children:f&&d.jsxs(d.Fragment,{children:[h.label," ",a]})})})},mge="ToastTitle",z9=V.forwardRef((r,s)=>{const{__scopeToast:a,...c}=r;return d.jsx(Ss.div,{...c,ref:s})});z9.displayName=mge;var fge="ToastDescription",Y9=V.forwardRef((r,s)=>{const{__scopeToast:a,...c}=r;return d.jsx(Ss.div,{...c,ref:s})});Y9.displayName=fge;var q9="ToastAction",X9=V.forwardRef((r,s)=>{const{altText:a,...c}=r;return a.trim()?d.jsx(Q9,{altText:a,asChild:!0,children:d.jsx(eO,{...c,ref:s})}):(console.error(`Invalid prop \`altText\` supplied to \`${q9}\`. Expected non-empty \`string\`.`),null)});X9.displayName=q9;var J9="ToastClose",eO=V.forwardRef((r,s)=>{const{__scopeToast:a,...c}=r,h=uge(J9,a);return d.jsx(Q9,{asChild:!0,children:d.jsx(Ss.button,{type:"button",...c,ref:s,onClick:fr(r.onClick,h.onClose)})})});eO.displayName=J9;var Q9=V.forwardRef((r,s)=>{const{__scopeToast:a,altText:c,...h}=r;return d.jsx(Ss.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":c||void 0,...h,ref:s})});function Z9(r){const s=[];return Array.from(r.childNodes).forEach(c=>{if(c.nodeType===c.TEXT_NODE&&c.textContent&&s.push(c.textContent),_ge(c)){const h=c.ariaHidden||c.hidden||c.style.display==="none",f=c.dataset.radixToastAnnounceExclude==="";if(!h)if(f){const _=c.dataset.radixToastAnnounceAlt;_&&s.push(_)}else s.push(...Z9(c))}}),s}function Rv(r,s,a,{discrete:c}){const h=a.originalEvent.currentTarget,f=new CustomEvent(r,{bubbles:!0,cancelable:!0,detail:a});s&&h.addEventListener(r,s,{once:!0}),c?M9(h,f):h.dispatchEvent(f)}var q8=(r,s,a=0)=>{const c=Math.abs(r.x),h=Math.abs(r.y),f=c>h;return s==="left"||s==="right"?f&&c>a:!f&&h>a};function gge(r=()=>{}){const s=wi(r);hl(()=>{let a=0,c=0;return a=window.requestAnimationFrame(()=>c=window.requestAnimationFrame(s)),()=>{window.cancelAnimationFrame(a),window.cancelAnimationFrame(c)}},[s])}function _ge(r){return r.nodeType===r.ELEMENT_NODE}function yge(r){const s=[],a=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:c=>{const h=c.tagName==="INPUT"&&c.type==="hidden";return c.disabled||c.hidden||h?NodeFilter.FILTER_SKIP:c.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)s.push(a.currentNode);return s}function FN(r){const s=document.activeElement;return r.some(a=>a===s?!0:(a.focus(),document.activeElement!==s))}var Ege=$9,eH=G9,tH=K9,nH=z9,rH=Y9,sH=X9,iH=eO;function oH(r){var s,a,c="";if(typeof r=="string"||typeof r=="number")c+=r;else if(typeof r=="object")if(Array.isArray(r)){var h=r.length;for(s=0;s<h;s++)r[s]&&(a=oH(r[s]))&&(c&&(c+=" "),c+=a)}else for(a in r)r[a]&&(c&&(c+=" "),c+=a);return c}function aH(){for(var r,s,a=0,c="",h=arguments.length;a<h;a++)(r=arguments[a])&&(s=oH(r))&&(c&&(c+=" "),c+=s);return c}const X8=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,J8=aH,cH=(r,s)=>a=>{var c;if((s==null?void 0:s.variants)==null)return J8(r,a==null?void 0:a.class,a==null?void 0:a.className);const{variants:h,defaultVariants:f}=s,_=Object.keys(h).map(x=>{const T=a==null?void 0:a[x],R=f==null?void 0:f[x];if(T===null)return null;const N=X8(T)||X8(R);return h[x][N]}),E=a&&Object.entries(a).reduce((x,T)=>{let[R,N]=T;return N===void 0||(x[R]=N),x},{}),v=s==null||(c=s.compoundVariants)===null||c===void 0?void 0:c.reduce((x,T)=>{let{class:R,className:N,...L}=T;return Object.entries(L).every(j=>{let[F,P]=j;return Array.isArray(P)?P.includes({...f,...E}[F]):{...f,...E}[F]===P})?[...x,R,N]:x},[]);return J8(r,_,v,a==null?void 0:a.class,a==null?void 0:a.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vge=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),lH=(...r)=>r.filter((s,a,c)=>!!s&&s.trim()!==""&&c.indexOf(s)===a).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var bge={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sge=V.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:a=2,absoluteStrokeWidth:c,className:h="",children:f,iconNode:_,...E},v)=>V.createElement("svg",{ref:v,...bge,width:s,height:s,stroke:r,strokeWidth:c?Number(a)*24/Number(s):a,className:lH("lucide",h),...E},[..._.map(([x,T])=>V.createElement(x,T)),...Array.isArray(f)?f:[f]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=(r,s)=>{const a=V.forwardRef(({className:c,...h},f)=>V.createElement(Sge,{ref:f,iconNode:s,className:lH(`lucide-${vge(r)}`,c),...h}));return a.displayName=`${r}`,a};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tO=et("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lb=et("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xge=et("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wge=et("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tge=et("BadgeCheck",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dH=et("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cge=et("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rge=et("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uH=et("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hH=et("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pH=et("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q8=et("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nge=et("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nO=et("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mH=et("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Age=et("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ige=et("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oge=et("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pge=et("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cA=et("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dge=et("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rO=et("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kge=et("ContactRound",[["path",{d:"M16 2v2",key:"scm5qe"}],["path",{d:"M17.915 22a6 6 0 0 0-12 0",key:"suqz9p"}],["path",{d:"M8 2v2",key:"pbkmx"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",key:"12vinp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lge=et("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ES=et("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vS=et("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fH=et("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kg=et("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lA=et("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dA=et("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mge=et("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const al=et("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jge=et("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uge=et("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vge=et("Gavel",[["path",{d:"m14.5 12.5-8 8a2.119 2.119 0 1 1-3-3l8-8",key:"15492f"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m9 7 8 8",key:"5jnvq1"}],["path",{d:"m21 11-8-8",key:"z4y7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gH=et("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fge=et("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bge=et("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uA=et("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _H=et("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hA=et("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $ge=et("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yH=et("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z8=et("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pA=et("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wge=et("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gge=et("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e$=et("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hge=et("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I0=et("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bS=et("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sO=et("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kge=et("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zge=et("Megaphone",[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iO=et("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pl=et("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yge=et("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mA=et("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qge=et("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fA=et("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fh=et("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oO=et("PhoneCall",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}],["path",{d:"M14.05 2a9 9 0 0 1 8 7.94",key:"vmijpz"}],["path",{d:"M14.05 6A5 5 0 0 1 18 10",key:"13nbpp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t$=et("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wd=et("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xge=et("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Md=et("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jge=et("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zv=et("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wm=et("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EH=et("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O0=et("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ch=et("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const km=et("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qge=et("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aO=et("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zge=et("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e0e=et("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t0e=et("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gh=et("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n0e=et("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r0e=et("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vH=et("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eh=et("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nc=et("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s0e=et("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eb=et("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i0e=et("Workflow",[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o0e=et("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yo=et("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a0e=et("Youtube",[["path",{d:"M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17",key:"1q2vi4"}],["path",{d:"m10 15 5-3-5-3z",key:"1jp15x"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mb=et("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),cO="-",c0e=r=>{const s=d0e(r),{conflictingClassGroups:a,conflictingClassGroupModifiers:c}=r;return{getClassGroupId:_=>{const E=_.split(cO);return E[0]===""&&E.length!==1&&E.shift(),bH(E,s)||l0e(_)},getConflictingClassGroupIds:(_,E)=>{const v=a[_]||[];return E&&c[_]?[...v,...c[_]]:v}}},bH=(r,s)=>{var _;if(r.length===0)return s.classGroupId;const a=r[0],c=s.nextPart.get(a),h=c?bH(r.slice(1),c):void 0;if(h)return h;if(s.validators.length===0)return;const f=r.join(cO);return(_=s.validators.find(({validator:E})=>E(f)))==null?void 0:_.classGroupId},n$=/^\[(.+)\]$/,l0e=r=>{if(n$.test(r)){const s=n$.exec(r)[1],a=s==null?void 0:s.substring(0,s.indexOf(":"));if(a)return"arbitrary.."+a}},d0e=r=>{const{theme:s,prefix:a}=r,c={nextPart:new Map,validators:[]};return h0e(Object.entries(r.classGroups),a).forEach(([f,_])=>{gA(_,c,f,s)}),c},gA=(r,s,a,c)=>{r.forEach(h=>{if(typeof h=="string"){const f=h===""?s:r$(s,h);f.classGroupId=a;return}if(typeof h=="function"){if(u0e(h)){gA(h(c),s,a,c);return}s.validators.push({validator:h,classGroupId:a});return}Object.entries(h).forEach(([f,_])=>{gA(_,r$(s,f),a,c)})})},r$=(r,s)=>{let a=r;return s.split(cO).forEach(c=>{a.nextPart.has(c)||a.nextPart.set(c,{nextPart:new Map,validators:[]}),a=a.nextPart.get(c)}),a},u0e=r=>r.isThemeGetter,h0e=(r,s)=>s?r.map(([a,c])=>{const h=c.map(f=>typeof f=="string"?s+f:typeof f=="object"?Object.fromEntries(Object.entries(f).map(([_,E])=>[s+_,E])):f);return[a,h]}):r,p0e=r=>{if(r<1)return{get:()=>{},set:()=>{}};let s=0,a=new Map,c=new Map;const h=(f,_)=>{a.set(f,_),s++,s>r&&(s=0,c=a,a=new Map)};return{get(f){let _=a.get(f);if(_!==void 0)return _;if((_=c.get(f))!==void 0)return h(f,_),_},set(f,_){a.has(f)?a.set(f,_):h(f,_)}}},SH="!",m0e=r=>{const{separator:s,experimentalParseClassName:a}=r,c=s.length===1,h=s[0],f=s.length,_=E=>{const v=[];let x=0,T=0,R;for(let P=0;P<E.length;P++){let M=E[P];if(x===0){if(M===h&&(c||E.slice(P,P+f)===s)){v.push(E.slice(T,P)),T=P+f;continue}if(M==="/"){R=P;continue}}M==="["?x++:M==="]"&&x--}const N=v.length===0?E:E.substring(T),L=N.startsWith(SH),j=L?N.substring(1):N,F=R&&R>T?R-T:void 0;return{modifiers:v,hasImportantModifier:L,baseClassName:j,maybePostfixModifierPosition:F}};return a?E=>a({className:E,parseClassName:_}):_},f0e=r=>{if(r.length<=1)return r;const s=[];let a=[];return r.forEach(c=>{c[0]==="["?(s.push(...a.sort(),c),a=[]):a.push(c)}),s.push(...a.sort()),s},g0e=r=>({cache:p0e(r.cacheSize),parseClassName:m0e(r),...c0e(r)}),_0e=/\s+/,y0e=(r,s)=>{const{parseClassName:a,getClassGroupId:c,getConflictingClassGroupIds:h}=s,f=[],_=r.trim().split(_0e);let E="";for(let v=_.length-1;v>=0;v-=1){const x=_[v],{modifiers:T,hasImportantModifier:R,baseClassName:N,maybePostfixModifierPosition:L}=a(x);let j=!!L,F=c(j?N.substring(0,L):N);if(!F){if(!j){E=x+(E.length>0?" "+E:E);continue}if(F=c(N),!F){E=x+(E.length>0?" "+E:E);continue}j=!1}const P=f0e(T).join(":"),M=R?P+SH:P,U=M+F;if(f.includes(U))continue;f.push(U);const B=h(F,j);for(let K=0;K<B.length;++K){const J=B[K];f.push(M+J)}E=x+(E.length>0?" "+E:E)}return E};function E0e(){let r=0,s,a,c="";for(;r<arguments.length;)(s=arguments[r++])&&(a=xH(s))&&(c&&(c+=" "),c+=a);return c}const xH=r=>{if(typeof r=="string")return r;let s,a="";for(let c=0;c<r.length;c++)r[c]&&(s=xH(r[c]))&&(a&&(a+=" "),a+=s);return a};function v0e(r,...s){let a,c,h,f=_;function _(v){const x=s.reduce((T,R)=>R(T),r());return a=g0e(x),c=a.cache.get,h=a.cache.set,f=E,E(v)}function E(v){const x=c(v);if(x)return x;const T=y0e(v,a);return h(v,T),T}return function(){return f(E0e.apply(null,arguments))}}const Tr=r=>{const s=a=>a[r]||[];return s.isThemeGetter=!0,s},wH=/^\[(?:([a-z-]+):)?(.+)\]$/i,b0e=/^\d+\/\d+$/,S0e=new Set(["px","full","screen"]),x0e=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,w0e=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,T0e=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,C0e=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,R0e=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Zc=r=>gm(r)||S0e.has(r)||b0e.test(r),Zl=r=>Gm(r,"length",L0e),gm=r=>!!r&&!Number.isNaN(Number(r)),BN=r=>Gm(r,"number",gm),Lg=r=>!!r&&Number.isInteger(Number(r)),N0e=r=>r.endsWith("%")&&gm(r.slice(0,-1)),_n=r=>wH.test(r),ed=r=>x0e.test(r),A0e=new Set(["length","size","percentage"]),I0e=r=>Gm(r,A0e,TH),O0e=r=>Gm(r,"position",TH),P0e=new Set(["image","url"]),D0e=r=>Gm(r,P0e,j0e),k0e=r=>Gm(r,"",M0e),Mg=()=>!0,Gm=(r,s,a)=>{const c=wH.exec(r);return c?c[1]?typeof s=="string"?c[1]===s:s.has(c[1]):a(c[2]):!1},L0e=r=>w0e.test(r)&&!T0e.test(r),TH=()=>!1,M0e=r=>C0e.test(r),j0e=r=>R0e.test(r),U0e=()=>{const r=Tr("colors"),s=Tr("spacing"),a=Tr("blur"),c=Tr("brightness"),h=Tr("borderColor"),f=Tr("borderRadius"),_=Tr("borderSpacing"),E=Tr("borderWidth"),v=Tr("contrast"),x=Tr("grayscale"),T=Tr("hueRotate"),R=Tr("invert"),N=Tr("gap"),L=Tr("gradientColorStops"),j=Tr("gradientColorStopPositions"),F=Tr("inset"),P=Tr("margin"),M=Tr("opacity"),U=Tr("padding"),B=Tr("saturate"),K=Tr("scale"),J=Tr("sepia"),te=Tr("skew"),se=Tr("space"),ie=Tr("translate"),ue=()=>["auto","contain","none"],de=()=>["auto","hidden","clip","visible","scroll"],Ne=()=>["auto",_n,s],Ce=()=>[_n,s],tt=()=>["",Zc,Zl],Se=()=>["auto",gm,_n],Ge=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Xe=()=>["solid","dashed","dotted","double","none"],Re=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],le=()=>["start","end","center","between","around","evenly","stretch"],ve=()=>["","0",_n],Le=()=>["auto","avoid","all","avoid-page","page","left","right","column"],qe=()=>[gm,_n];return{cacheSize:500,separator:":",theme:{colors:[Mg],spacing:[Zc,Zl],blur:["none","",ed,_n],brightness:qe(),borderColor:[r],borderRadius:["none","","full",ed,_n],borderSpacing:Ce(),borderWidth:tt(),contrast:qe(),grayscale:ve(),hueRotate:qe(),invert:ve(),gap:Ce(),gradientColorStops:[r],gradientColorStopPositions:[N0e,Zl],inset:Ne(),margin:Ne(),opacity:qe(),padding:Ce(),saturate:qe(),scale:qe(),sepia:ve(),skew:qe(),space:Ce(),translate:Ce()},classGroups:{aspect:[{aspect:["auto","square","video",_n]}],container:["container"],columns:[{columns:[ed]}],"break-after":[{"break-after":Le()}],"break-before":[{"break-before":Le()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Ge(),_n]}],overflow:[{overflow:de()}],"overflow-x":[{"overflow-x":de()}],"overflow-y":[{"overflow-y":de()}],overscroll:[{overscroll:ue()}],"overscroll-x":[{"overscroll-x":ue()}],"overscroll-y":[{"overscroll-y":ue()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[F]}],"inset-x":[{"inset-x":[F]}],"inset-y":[{"inset-y":[F]}],start:[{start:[F]}],end:[{end:[F]}],top:[{top:[F]}],right:[{right:[F]}],bottom:[{bottom:[F]}],left:[{left:[F]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Lg,_n]}],basis:[{basis:Ne()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",_n]}],grow:[{grow:ve()}],shrink:[{shrink:ve()}],order:[{order:["first","last","none",Lg,_n]}],"grid-cols":[{"grid-cols":[Mg]}],"col-start-end":[{col:["auto",{span:["full",Lg,_n]},_n]}],"col-start":[{"col-start":Se()}],"col-end":[{"col-end":Se()}],"grid-rows":[{"grid-rows":[Mg]}],"row-start-end":[{row:["auto",{span:[Lg,_n]},_n]}],"row-start":[{"row-start":Se()}],"row-end":[{"row-end":Se()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",_n]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",_n]}],gap:[{gap:[N]}],"gap-x":[{"gap-x":[N]}],"gap-y":[{"gap-y":[N]}],"justify-content":[{justify:["normal",...le()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...le(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...le(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[U]}],px:[{px:[U]}],py:[{py:[U]}],ps:[{ps:[U]}],pe:[{pe:[U]}],pt:[{pt:[U]}],pr:[{pr:[U]}],pb:[{pb:[U]}],pl:[{pl:[U]}],m:[{m:[P]}],mx:[{mx:[P]}],my:[{my:[P]}],ms:[{ms:[P]}],me:[{me:[P]}],mt:[{mt:[P]}],mr:[{mr:[P]}],mb:[{mb:[P]}],ml:[{ml:[P]}],"space-x":[{"space-x":[se]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[se]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",_n,s]}],"min-w":[{"min-w":[_n,s,"min","max","fit"]}],"max-w":[{"max-w":[_n,s,"none","full","min","max","fit","prose",{screen:[ed]},ed]}],h:[{h:[_n,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[_n,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[_n,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[_n,s,"auto","min","max","fit"]}],"font-size":[{text:["base",ed,Zl]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",BN]}],"font-family":[{font:[Mg]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",_n]}],"line-clamp":[{"line-clamp":["none",gm,BN]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Zc,_n]}],"list-image":[{"list-image":["none",_n]}],"list-style-type":[{list:["none","disc","decimal",_n]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[M]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[M]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Xe(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Zc,Zl]}],"underline-offset":[{"underline-offset":["auto",Zc,_n]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ce()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",_n]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",_n]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[M]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Ge(),O0e]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",I0e]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},D0e]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[j]}],"gradient-via-pos":[{via:[j]}],"gradient-to-pos":[{to:[j]}],"gradient-from":[{from:[L]}],"gradient-via":[{via:[L]}],"gradient-to":[{to:[L]}],rounded:[{rounded:[f]}],"rounded-s":[{"rounded-s":[f]}],"rounded-e":[{"rounded-e":[f]}],"rounded-t":[{"rounded-t":[f]}],"rounded-r":[{"rounded-r":[f]}],"rounded-b":[{"rounded-b":[f]}],"rounded-l":[{"rounded-l":[f]}],"rounded-ss":[{"rounded-ss":[f]}],"rounded-se":[{"rounded-se":[f]}],"rounded-ee":[{"rounded-ee":[f]}],"rounded-es":[{"rounded-es":[f]}],"rounded-tl":[{"rounded-tl":[f]}],"rounded-tr":[{"rounded-tr":[f]}],"rounded-br":[{"rounded-br":[f]}],"rounded-bl":[{"rounded-bl":[f]}],"border-w":[{border:[E]}],"border-w-x":[{"border-x":[E]}],"border-w-y":[{"border-y":[E]}],"border-w-s":[{"border-s":[E]}],"border-w-e":[{"border-e":[E]}],"border-w-t":[{"border-t":[E]}],"border-w-r":[{"border-r":[E]}],"border-w-b":[{"border-b":[E]}],"border-w-l":[{"border-l":[E]}],"border-opacity":[{"border-opacity":[M]}],"border-style":[{border:[...Xe(),"hidden"]}],"divide-x":[{"divide-x":[E]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[E]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[M]}],"divide-style":[{divide:Xe()}],"border-color":[{border:[h]}],"border-color-x":[{"border-x":[h]}],"border-color-y":[{"border-y":[h]}],"border-color-s":[{"border-s":[h]}],"border-color-e":[{"border-e":[h]}],"border-color-t":[{"border-t":[h]}],"border-color-r":[{"border-r":[h]}],"border-color-b":[{"border-b":[h]}],"border-color-l":[{"border-l":[h]}],"divide-color":[{divide:[h]}],"outline-style":[{outline:["",...Xe()]}],"outline-offset":[{"outline-offset":[Zc,_n]}],"outline-w":[{outline:[Zc,Zl]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:tt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[M]}],"ring-offset-w":[{"ring-offset":[Zc,Zl]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",ed,k0e]}],"shadow-color":[{shadow:[Mg]}],opacity:[{opacity:[M]}],"mix-blend":[{"mix-blend":[...Re(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Re()}],filter:[{filter:["","none"]}],blur:[{blur:[a]}],brightness:[{brightness:[c]}],contrast:[{contrast:[v]}],"drop-shadow":[{"drop-shadow":["","none",ed,_n]}],grayscale:[{grayscale:[x]}],"hue-rotate":[{"hue-rotate":[T]}],invert:[{invert:[R]}],saturate:[{saturate:[B]}],sepia:[{sepia:[J]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[a]}],"backdrop-brightness":[{"backdrop-brightness":[c]}],"backdrop-contrast":[{"backdrop-contrast":[v]}],"backdrop-grayscale":[{"backdrop-grayscale":[x]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[T]}],"backdrop-invert":[{"backdrop-invert":[R]}],"backdrop-opacity":[{"backdrop-opacity":[M]}],"backdrop-saturate":[{"backdrop-saturate":[B]}],"backdrop-sepia":[{"backdrop-sepia":[J]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[_]}],"border-spacing-x":[{"border-spacing-x":[_]}],"border-spacing-y":[{"border-spacing-y":[_]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",_n]}],duration:[{duration:qe()}],ease:[{ease:["linear","in","out","in-out",_n]}],delay:[{delay:qe()}],animate:[{animate:["none","spin","ping","pulse","bounce",_n]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[K]}],"scale-x":[{"scale-x":[K]}],"scale-y":[{"scale-y":[K]}],rotate:[{rotate:[Lg,_n]}],"translate-x":[{"translate-x":[ie]}],"translate-y":[{"translate-y":[ie]}],"skew-x":[{"skew-x":[te]}],"skew-y":[{"skew-y":[te]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",_n]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",_n]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ce()}],"scroll-mx":[{"scroll-mx":Ce()}],"scroll-my":[{"scroll-my":Ce()}],"scroll-ms":[{"scroll-ms":Ce()}],"scroll-me":[{"scroll-me":Ce()}],"scroll-mt":[{"scroll-mt":Ce()}],"scroll-mr":[{"scroll-mr":Ce()}],"scroll-mb":[{"scroll-mb":Ce()}],"scroll-ml":[{"scroll-ml":Ce()}],"scroll-p":[{"scroll-p":Ce()}],"scroll-px":[{"scroll-px":Ce()}],"scroll-py":[{"scroll-py":Ce()}],"scroll-ps":[{"scroll-ps":Ce()}],"scroll-pe":[{"scroll-pe":Ce()}],"scroll-pt":[{"scroll-pt":Ce()}],"scroll-pr":[{"scroll-pr":Ce()}],"scroll-pb":[{"scroll-pb":Ce()}],"scroll-pl":[{"scroll-pl":Ce()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",_n]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[Zc,Zl,BN]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},V0e=v0e(U0e);function Xs(...r){return V0e(aH(r))}const F0e=Ege,CH=V.forwardRef(({className:r,...s},a)=>d.jsx(eH,{ref:a,className:Xs("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...s}));CH.displayName=eH.displayName;const B0e=cH("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),RH=V.forwardRef(({className:r,variant:s,...a},c)=>d.jsx(tH,{ref:c,className:Xs(B0e({variant:s}),r),...a}));RH.displayName=tH.displayName;const $0e=V.forwardRef(({className:r,...s},a)=>d.jsx(sH,{ref:a,className:Xs("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",r),...s}));$0e.displayName=sH.displayName;const NH=V.forwardRef(({className:r,...s},a)=>d.jsx(iH,{ref:a,className:Xs("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...s,children:d.jsx(yo,{className:"h-4 w-4"})}));NH.displayName=iH.displayName;const AH=V.forwardRef(({className:r,...s},a)=>d.jsx(nH,{ref:a,className:Xs("text-sm font-semibold",r),...s}));AH.displayName=nH.displayName;const IH=V.forwardRef(({className:r,...s},a)=>d.jsx(rH,{ref:a,className:Xs("text-sm opacity-90",r),...s}));IH.displayName=rH.displayName;function W0e(){const{toasts:r}=za();return d.jsxs(F0e,{children:[r.map(function({id:s,title:a,description:c,action:h,...f}){return d.jsxs(RH,{...f,children:[d.jsxs("div",{className:"grid gap-1",children:[a&&d.jsx(AH,{children:a}),c&&d.jsx(IH,{children:c})]}),h,d.jsx(NH,{})]},s)}),d.jsx(CH,{})]})}var jb=["light","dark"],lO="(prefers-color-scheme: dark)",G0e=typeof window>"u",dO=V.createContext(void 0),H0e={setTheme:r=>{},themes:[]},sr=()=>{var r;return(r=V.useContext(dO))!=null?r:H0e},K0e=r=>V.useContext(dO)?r.children:V.createElement(Y0e,{...r}),z0e=["light","dark"],Y0e=({forcedTheme:r,disableTransitionOnChange:s=!1,enableSystem:a=!0,enableColorScheme:c=!0,storageKey:h="theme",themes:f=z0e,defaultTheme:_=a?"system":"light",attribute:E="data-theme",value:v,children:x,nonce:T})=>{let[R,N]=V.useState(()=>s$(h,_)),[L,j]=V.useState(()=>s$(h)),F=v?Object.values(v):f,P=V.useCallback(K=>{let J=K;if(!J)return;K==="system"&&a&&(J=i$());let te=v?v[J]:J,se=s?X0e():null,ie=document.documentElement;if(E==="class"?(ie.classList.remove(...F),te&&ie.classList.add(te)):te?ie.setAttribute(E,te):ie.removeAttribute(E),c){let ue=jb.includes(_)?_:null,de=jb.includes(J)?J:ue;ie.style.colorScheme=de}se==null||se()},[]),M=V.useCallback(K=>{let J=typeof K=="function"?K(K):K;N(J);try{localStorage.setItem(h,J)}catch{}},[r]),U=V.useCallback(K=>{let J=i$(K);j(J),R==="system"&&a&&!r&&P("system")},[R,r]);V.useEffect(()=>{let K=window.matchMedia(lO);return K.addListener(U),U(K),()=>K.removeListener(U)},[U]),V.useEffect(()=>{let K=J=>{if(J.key!==h)return;let te=J.newValue||_;M(te)};return window.addEventListener("storage",K),()=>window.removeEventListener("storage",K)},[M]),V.useEffect(()=>{P(r??R)},[r,R]);let B=V.useMemo(()=>({theme:R,setTheme:M,forcedTheme:r,resolvedTheme:R==="system"?L:R,themes:a?[...f,"system"]:f,systemTheme:a?L:void 0}),[R,M,r,L,a,f]);return V.createElement(dO.Provider,{value:B},V.createElement(q0e,{forcedTheme:r,disableTransitionOnChange:s,enableSystem:a,enableColorScheme:c,storageKey:h,themes:f,defaultTheme:_,attribute:E,value:v,children:x,attrs:F,nonce:T}),x)},q0e=V.memo(({forcedTheme:r,storageKey:s,attribute:a,enableSystem:c,enableColorScheme:h,defaultTheme:f,value:_,attrs:E,nonce:v})=>{let x=f==="system",T=a==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${E.map(j=>`'${j}'`).join(",")})`};`:`var d=document.documentElement,n='${a}',s='setAttribute';`,R=h?jb.includes(f)&&f?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${f}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",N=(j,F=!1,P=!0)=>{let M=_?_[j]:j,U=F?j+"|| ''":`'${M}'`,B="";return h&&P&&!F&&jb.includes(j)&&(B+=`d.style.colorScheme = '${j}';`),a==="class"?F||M?B+=`c.add(${U})`:B+="null":M&&(B+=`d[s](n,${U})`),B},L=r?`!function(){${T}${N(r)}}()`:c?`!function(){try{${T}var e=localStorage.getItem('${s}');if('system'===e||(!e&&${x})){var t='${lO}',m=window.matchMedia(t);if(m.media!==t||m.matches){${N("dark")}}else{${N("light")}}}else if(e){${_?`var x=${JSON.stringify(_)};`:""}${N(_?"x[e]":"e",!0)}}${x?"":"else{"+N(f,!1,!1)+"}"}${R}}catch(e){}}()`:`!function(){try{${T}var e=localStorage.getItem('${s}');if(e){${_?`var x=${JSON.stringify(_)};`:""}${N(_?"x[e]":"e",!0)}}else{${N(f,!1,!1)};}${R}}catch(t){}}();`;return V.createElement("script",{nonce:v,dangerouslySetInnerHTML:{__html:L}})}),s$=(r,s)=>{if(G0e)return;let a;try{a=localStorage.getItem(r)||void 0}catch{}return a||s},X0e=()=>{let r=document.createElement("style");return r.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(r),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(r)},1)}},i$=r=>(r||(r=window.matchMedia(lO)),r.matches?"dark":"light"),J0e=r=>{switch(r){case"success":return e_e;case"info":return n_e;case"warning":return t_e;case"error":return r_e;default:return null}},Q0e=Array(12).fill(0),Z0e=({visible:r,className:s})=>rt.createElement("div",{className:["sonner-loading-wrapper",s].filter(Boolean).join(" "),"data-visible":r},rt.createElement("div",{className:"sonner-spinner"},Q0e.map((a,c)=>rt.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${c}`})))),e_e=rt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},rt.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),t_e=rt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},rt.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),n_e=rt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},rt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),r_e=rt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},rt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),s_e=rt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},rt.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),rt.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),i_e=()=>{let[r,s]=rt.useState(document.hidden);return rt.useEffect(()=>{let a=()=>{s(document.hidden)};return document.addEventListener("visibilitychange",a),()=>window.removeEventListener("visibilitychange",a)},[]),r},_A=1,o_e=class{constructor(){this.subscribe=r=>(this.subscribers.push(r),()=>{let s=this.subscribers.indexOf(r);this.subscribers.splice(s,1)}),this.publish=r=>{this.subscribers.forEach(s=>s(r))},this.addToast=r=>{this.publish(r),this.toasts=[...this.toasts,r]},this.create=r=>{var s;let{message:a,...c}=r,h=typeof(r==null?void 0:r.id)=="number"||((s=r.id)==null?void 0:s.length)>0?r.id:_A++,f=this.toasts.find(E=>E.id===h),_=r.dismissible===void 0?!0:r.dismissible;return this.dismissedToasts.has(h)&&this.dismissedToasts.delete(h),f?this.toasts=this.toasts.map(E=>E.id===h?(this.publish({...E,...r,id:h,title:a}),{...E,...r,id:h,dismissible:_,title:a}):E):this.addToast({title:a,...c,dismissible:_,id:h}),h},this.dismiss=r=>(this.dismissedToasts.add(r),r||this.toasts.forEach(s=>{this.subscribers.forEach(a=>a({id:s.id,dismiss:!0}))}),this.subscribers.forEach(s=>s({id:r,dismiss:!0})),r),this.message=(r,s)=>this.create({...s,message:r}),this.error=(r,s)=>this.create({...s,message:r,type:"error"}),this.success=(r,s)=>this.create({...s,type:"success",message:r}),this.info=(r,s)=>this.create({...s,type:"info",message:r}),this.warning=(r,s)=>this.create({...s,type:"warning",message:r}),this.loading=(r,s)=>this.create({...s,type:"loading",message:r}),this.promise=(r,s)=>{if(!s)return;let a;s.loading!==void 0&&(a=this.create({...s,promise:r,type:"loading",message:s.loading,description:typeof s.description!="function"?s.description:void 0}));let c=r instanceof Promise?r:r(),h=a!==void 0,f,_=c.then(async v=>{if(f=["resolve",v],rt.isValidElement(v))h=!1,this.create({id:a,type:"default",message:v});else if(c_e(v)&&!v.ok){h=!1;let x=typeof s.error=="function"?await s.error(`HTTP error! status: ${v.status}`):s.error,T=typeof s.description=="function"?await s.description(`HTTP error! status: ${v.status}`):s.description;this.create({id:a,type:"error",message:x,description:T})}else if(s.success!==void 0){h=!1;let x=typeof s.success=="function"?await s.success(v):s.success,T=typeof s.description=="function"?await s.description(v):s.description;this.create({id:a,type:"success",message:x,description:T})}}).catch(async v=>{if(f=["reject",v],s.error!==void 0){h=!1;let x=typeof s.error=="function"?await s.error(v):s.error,T=typeof s.description=="function"?await s.description(v):s.description;this.create({id:a,type:"error",message:x,description:T})}}).finally(()=>{var v;h&&(this.dismiss(a),a=void 0),(v=s.finally)==null||v.call(s)}),E=()=>new Promise((v,x)=>_.then(()=>f[0]==="reject"?x(f[1]):v(f[1])).catch(x));return typeof a!="string"&&typeof a!="number"?{unwrap:E}:Object.assign(a,{unwrap:E})},this.custom=(r,s)=>{let a=(s==null?void 0:s.id)||_A++;return this.create({jsx:r(a),id:a,...s}),a},this.getActiveToasts=()=>this.toasts.filter(r=>!this.dismissedToasts.has(r.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Gi=new o_e,a_e=(r,s)=>{let a=(s==null?void 0:s.id)||_A++;return Gi.addToast({title:r,...s,id:a}),a},c_e=r=>r&&typeof r=="object"&&"ok"in r&&typeof r.ok=="boolean"&&"status"in r&&typeof r.status=="number",l_e=a_e,d_e=()=>Gi.toasts,u_e=()=>Gi.getActiveToasts(),dt=Object.assign(l_e,{success:Gi.success,info:Gi.info,warning:Gi.warning,error:Gi.error,custom:Gi.custom,message:Gi.message,promise:Gi.promise,dismiss:Gi.dismiss,loading:Gi.loading},{getHistory:d_e,getToasts:u_e});function h_e(r,{insertAt:s}={}){if(typeof document>"u")return;let a=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css",s==="top"&&a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c),c.styleSheet?c.styleSheet.cssText=r:c.appendChild(document.createTextNode(r))}h_e(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function Nv(r){return r.label!==void 0}var p_e=3,m_e="32px",f_e="16px",o$=4e3,g_e=356,__e=14,y_e=20,E_e=200;function Oa(...r){return r.filter(Boolean).join(" ")}function v_e(r){let[s,a]=r.split("-"),c=[];return s&&c.push(s),a&&c.push(a),c}var b_e=r=>{var s,a,c,h,f,_,E,v,x,T,R;let{invert:N,toast:L,unstyled:j,interacting:F,setHeights:P,visibleToasts:M,heights:U,index:B,toasts:K,expanded:J,removeToast:te,defaultRichColors:se,closeButton:ie,style:ue,cancelButtonStyle:de,actionButtonStyle:Ne,className:Ce="",descriptionClassName:tt="",duration:Se,position:Ge,gap:Xe,loadingIcon:Re,expandByDefault:le,classNames:ve,icons:Le,closeButtonAriaLabel:qe="Close toast",pauseWhenPageIsHidden:We}=r,[xt,bt]=rt.useState(null),[$t,vt]=rt.useState(null),[ut,Wt]=rt.useState(!1),[Jt,Dt]=rt.useState(!1),[At,be]=rt.useState(!1),[ht,Gt]=rt.useState(!1),[Ln,Mn]=rt.useState(!1),[bn,ln]=rt.useState(0),[vn,Xn]=rt.useState(0),Mr=rt.useRef(L.duration||Se||o$),So=rt.useRef(null),ir=rt.useRef(null),Jn=B===0,ia=B+1<=M,jr=L.type,yr=L.dismissible!==!1,di=L.className||"",ui=L.descriptionClassName||"",xs=rt.useMemo(()=>U.findIndex(Ze=>Ze.toastId===L.id)||0,[U,L.id]),xo=rt.useMemo(()=>{var Ze;return(Ze=L.closeButton)!=null?Ze:ie},[L.closeButton,ie]),ws=rt.useMemo(()=>L.duration||Se||o$,[L.duration,Se]),hi=rt.useRef(0),os=rt.useRef(0),wo=rt.useRef(0),Ai=rt.useRef(null),[qa,De]=Ge.split("-"),Ie=rt.useMemo(()=>U.reduce((Ze,ae,Ae)=>Ae>=xs?Ze:Ze+ae.height,0),[U,xs]),Pe=i_e(),ze=L.invert||N,at=jr==="loading";os.current=rt.useMemo(()=>xs*Xe+Ie,[xs,Ie]),rt.useEffect(()=>{Mr.current=ws},[ws]),rt.useEffect(()=>{Wt(!0)},[]),rt.useEffect(()=>{let Ze=ir.current;if(Ze){let ae=Ze.getBoundingClientRect().height;return Xn(ae),P(Ae=>[{toastId:L.id,height:ae,position:L.position},...Ae]),()=>P(Ae=>Ae.filter(Be=>Be.toastId!==L.id))}},[P,L.id]),rt.useLayoutEffect(()=>{if(!ut)return;let Ze=ir.current,ae=Ze.style.height;Ze.style.height="auto";let Ae=Ze.getBoundingClientRect().height;Ze.style.height=ae,Xn(Ae),P(Be=>Be.find(Ye=>Ye.toastId===L.id)?Be.map(Ye=>Ye.toastId===L.id?{...Ye,height:Ae}:Ye):[{toastId:L.id,height:Ae,position:L.position},...Be])},[ut,L.title,L.description,P,L.id]);let ft=rt.useCallback(()=>{Dt(!0),ln(os.current),P(Ze=>Ze.filter(ae=>ae.toastId!==L.id)),setTimeout(()=>{te(L)},E_e)},[L,te,P,os]);rt.useEffect(()=>{if(L.promise&&jr==="loading"||L.duration===1/0||L.type==="loading")return;let Ze;return J||F||We&&Pe?(()=>{if(wo.current<hi.current){let ae=new Date().getTime()-hi.current;Mr.current=Mr.current-ae}wo.current=new Date().getTime()})():Mr.current!==1/0&&(hi.current=new Date().getTime(),Ze=setTimeout(()=>{var ae;(ae=L.onAutoClose)==null||ae.call(L,L),ft()},Mr.current)),()=>clearTimeout(Ze)},[J,F,L,jr,We,Pe,ft]),rt.useEffect(()=>{L.delete&&ft()},[ft,L.delete]);function Rt(){var Ze,ae,Ae;return Le!=null&&Le.loading?rt.createElement("div",{className:Oa(ve==null?void 0:ve.loader,(Ze=L==null?void 0:L.classNames)==null?void 0:Ze.loader,"sonner-loader"),"data-visible":jr==="loading"},Le.loading):Re?rt.createElement("div",{className:Oa(ve==null?void 0:ve.loader,(ae=L==null?void 0:L.classNames)==null?void 0:ae.loader,"sonner-loader"),"data-visible":jr==="loading"},Re):rt.createElement(Z0e,{className:Oa(ve==null?void 0:ve.loader,(Ae=L==null?void 0:L.classNames)==null?void 0:Ae.loader),visible:jr==="loading"})}return rt.createElement("li",{tabIndex:0,ref:ir,className:Oa(Ce,di,ve==null?void 0:ve.toast,(s=L==null?void 0:L.classNames)==null?void 0:s.toast,ve==null?void 0:ve.default,ve==null?void 0:ve[jr],(a=L==null?void 0:L.classNames)==null?void 0:a[jr]),"data-sonner-toast":"","data-rich-colors":(c=L.richColors)!=null?c:se,"data-styled":!(L.jsx||L.unstyled||j),"data-mounted":ut,"data-promise":!!L.promise,"data-swiped":Ln,"data-removed":Jt,"data-visible":ia,"data-y-position":qa,"data-x-position":De,"data-index":B,"data-front":Jn,"data-swiping":At,"data-dismissible":yr,"data-type":jr,"data-invert":ze,"data-swipe-out":ht,"data-swipe-direction":$t,"data-expanded":!!(J||le&&ut),style:{"--index":B,"--toasts-before":B,"--z-index":K.length-B,"--offset":`${Jt?bn:os.current}px`,"--initial-height":le?"auto":`${vn}px`,...ue,...L.style},onDragEnd:()=>{be(!1),bt(null),Ai.current=null},onPointerDown:Ze=>{at||!yr||(So.current=new Date,ln(os.current),Ze.target.setPointerCapture(Ze.pointerId),Ze.target.tagName!=="BUTTON"&&(be(!0),Ai.current={x:Ze.clientX,y:Ze.clientY}))},onPointerUp:()=>{var Ze,ae,Ae,Be;if(ht||!yr)return;Ai.current=null;let Ye=Number(((Ze=ir.current)==null?void 0:Ze.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),pt=Number(((ae=ir.current)==null?void 0:ae.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Cn=new Date().getTime()-((Ae=So.current)==null?void 0:Ae.getTime()),yn=xt==="x"?Ye:pt,nn=Math.abs(yn)/Cn;if(Math.abs(yn)>=y_e||nn>.11){ln(os.current),(Be=L.onDismiss)==null||Be.call(L,L),vt(xt==="x"?Ye>0?"right":"left":pt>0?"down":"up"),ft(),Gt(!0),Mn(!1);return}be(!1),bt(null)},onPointerMove:Ze=>{var ae,Ae,Be,Ye;if(!Ai.current||!yr||((ae=window.getSelection())==null?void 0:ae.toString().length)>0)return;let pt=Ze.clientY-Ai.current.y,Cn=Ze.clientX-Ai.current.x,yn=(Ae=r.swipeDirections)!=null?Ae:v_e(Ge);!xt&&(Math.abs(Cn)>1||Math.abs(pt)>1)&&bt(Math.abs(Cn)>Math.abs(pt)?"x":"y");let nn={x:0,y:0};xt==="y"?(yn.includes("top")||yn.includes("bottom"))&&(yn.includes("top")&&pt<0||yn.includes("bottom")&&pt>0)&&(nn.y=pt):xt==="x"&&(yn.includes("left")||yn.includes("right"))&&(yn.includes("left")&&Cn<0||yn.includes("right")&&Cn>0)&&(nn.x=Cn),(Math.abs(nn.x)>0||Math.abs(nn.y)>0)&&Mn(!0),(Be=ir.current)==null||Be.style.setProperty("--swipe-amount-x",`${nn.x}px`),(Ye=ir.current)==null||Ye.style.setProperty("--swipe-amount-y",`${nn.y}px`)}},xo&&!L.jsx?rt.createElement("button",{"aria-label":qe,"data-disabled":at,"data-close-button":!0,onClick:at||!yr?()=>{}:()=>{var Ze;ft(),(Ze=L.onDismiss)==null||Ze.call(L,L)},className:Oa(ve==null?void 0:ve.closeButton,(h=L==null?void 0:L.classNames)==null?void 0:h.closeButton)},(f=Le==null?void 0:Le.close)!=null?f:s_e):null,L.jsx||V.isValidElement(L.title)?L.jsx?L.jsx:typeof L.title=="function"?L.title():L.title:rt.createElement(rt.Fragment,null,jr||L.icon||L.promise?rt.createElement("div",{"data-icon":"",className:Oa(ve==null?void 0:ve.icon,(_=L==null?void 0:L.classNames)==null?void 0:_.icon)},L.promise||L.type==="loading"&&!L.icon?L.icon||Rt():null,L.type!=="loading"?L.icon||(Le==null?void 0:Le[jr])||J0e(jr):null):null,rt.createElement("div",{"data-content":"",className:Oa(ve==null?void 0:ve.content,(E=L==null?void 0:L.classNames)==null?void 0:E.content)},rt.createElement("div",{"data-title":"",className:Oa(ve==null?void 0:ve.title,(v=L==null?void 0:L.classNames)==null?void 0:v.title)},typeof L.title=="function"?L.title():L.title),L.description?rt.createElement("div",{"data-description":"",className:Oa(tt,ui,ve==null?void 0:ve.description,(x=L==null?void 0:L.classNames)==null?void 0:x.description)},typeof L.description=="function"?L.description():L.description):null),V.isValidElement(L.cancel)?L.cancel:L.cancel&&Nv(L.cancel)?rt.createElement("button",{"data-button":!0,"data-cancel":!0,style:L.cancelButtonStyle||de,onClick:Ze=>{var ae,Ae;Nv(L.cancel)&&yr&&((Ae=(ae=L.cancel).onClick)==null||Ae.call(ae,Ze),ft())},className:Oa(ve==null?void 0:ve.cancelButton,(T=L==null?void 0:L.classNames)==null?void 0:T.cancelButton)},L.cancel.label):null,V.isValidElement(L.action)?L.action:L.action&&Nv(L.action)?rt.createElement("button",{"data-button":!0,"data-action":!0,style:L.actionButtonStyle||Ne,onClick:Ze=>{var ae,Ae;Nv(L.action)&&((Ae=(ae=L.action).onClick)==null||Ae.call(ae,Ze),!Ze.defaultPrevented&&ft())},className:Oa(ve==null?void 0:ve.actionButton,(R=L==null?void 0:L.classNames)==null?void 0:R.actionButton)},L.action.label):null))};function a$(){if(typeof window>"u"||typeof document>"u")return"ltr";let r=document.documentElement.getAttribute("dir");return r==="auto"||!r?window.getComputedStyle(document.documentElement).direction:r}function S_e(r,s){let a={};return[r,s].forEach((c,h)=>{let f=h===1,_=f?"--mobile-offset":"--offset",E=f?f_e:m_e;function v(x){["top","right","bottom","left"].forEach(T=>{a[`${_}-${T}`]=typeof x=="number"?`${x}px`:x})}typeof c=="number"||typeof c=="string"?v(c):typeof c=="object"?["top","right","bottom","left"].forEach(x=>{c[x]===void 0?a[`${_}-${x}`]=E:a[`${_}-${x}`]=typeof c[x]=="number"?`${c[x]}px`:c[x]}):v(E)}),a}var x_e=V.forwardRef(function(r,s){let{invert:a,position:c="bottom-right",hotkey:h=["altKey","KeyT"],expand:f,closeButton:_,className:E,offset:v,mobileOffset:x,theme:T="light",richColors:R,duration:N,style:L,visibleToasts:j=p_e,toastOptions:F,dir:P=a$(),gap:M=__e,loadingIcon:U,icons:B,containerAriaLabel:K="Notifications",pauseWhenPageIsHidden:J}=r,[te,se]=rt.useState([]),ie=rt.useMemo(()=>Array.from(new Set([c].concat(te.filter(We=>We.position).map(We=>We.position)))),[te,c]),[ue,de]=rt.useState([]),[Ne,Ce]=rt.useState(!1),[tt,Se]=rt.useState(!1),[Ge,Xe]=rt.useState(T!=="system"?T:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Re=rt.useRef(null),le=h.join("+").replace(/Key/g,"").replace(/Digit/g,""),ve=rt.useRef(null),Le=rt.useRef(!1),qe=rt.useCallback(We=>{se(xt=>{var bt;return(bt=xt.find($t=>$t.id===We.id))!=null&&bt.delete||Gi.dismiss(We.id),xt.filter(({id:$t})=>$t!==We.id)})},[]);return rt.useEffect(()=>Gi.subscribe(We=>{if(We.dismiss){se(xt=>xt.map(bt=>bt.id===We.id?{...bt,delete:!0}:bt));return}setTimeout(()=>{P9.flushSync(()=>{se(xt=>{let bt=xt.findIndex($t=>$t.id===We.id);return bt!==-1?[...xt.slice(0,bt),{...xt[bt],...We},...xt.slice(bt+1)]:[We,...xt]})})})}),[]),rt.useEffect(()=>{if(T!=="system"){Xe(T);return}if(T==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Xe("dark"):Xe("light")),typeof window>"u")return;let We=window.matchMedia("(prefers-color-scheme: dark)");try{We.addEventListener("change",({matches:xt})=>{Xe(xt?"dark":"light")})}catch{We.addListener(({matches:bt})=>{try{Xe(bt?"dark":"light")}catch($t){console.error($t)}})}},[T]),rt.useEffect(()=>{te.length<=1&&Ce(!1)},[te]),rt.useEffect(()=>{let We=xt=>{var bt,$t;h.every(vt=>xt[vt]||xt.code===vt)&&(Ce(!0),(bt=Re.current)==null||bt.focus()),xt.code==="Escape"&&(document.activeElement===Re.current||($t=Re.current)!=null&&$t.contains(document.activeElement))&&Ce(!1)};return document.addEventListener("keydown",We),()=>document.removeEventListener("keydown",We)},[h]),rt.useEffect(()=>{if(Re.current)return()=>{ve.current&&(ve.current.focus({preventScroll:!0}),ve.current=null,Le.current=!1)}},[Re.current]),rt.createElement("section",{ref:s,"aria-label":`${K} ${le}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},ie.map((We,xt)=>{var bt;let[$t,vt]=We.split("-");return te.length?rt.createElement("ol",{key:We,dir:P==="auto"?a$():P,tabIndex:-1,ref:Re,className:E,"data-sonner-toaster":!0,"data-theme":Ge,"data-y-position":$t,"data-lifted":Ne&&te.length>1&&!f,"data-x-position":vt,style:{"--front-toast-height":`${((bt=ue[0])==null?void 0:bt.height)||0}px`,"--width":`${g_e}px`,"--gap":`${M}px`,...L,...S_e(v,x)},onBlur:ut=>{Le.current&&!ut.currentTarget.contains(ut.relatedTarget)&&(Le.current=!1,ve.current&&(ve.current.focus({preventScroll:!0}),ve.current=null))},onFocus:ut=>{ut.target instanceof HTMLElement&&ut.target.dataset.dismissible==="false"||Le.current||(Le.current=!0,ve.current=ut.relatedTarget)},onMouseEnter:()=>Ce(!0),onMouseMove:()=>Ce(!0),onMouseLeave:()=>{tt||Ce(!1)},onDragEnd:()=>Ce(!1),onPointerDown:ut=>{ut.target instanceof HTMLElement&&ut.target.dataset.dismissible==="false"||Se(!0)},onPointerUp:()=>Se(!1)},te.filter(ut=>!ut.position&&xt===0||ut.position===We).map((ut,Wt)=>{var Jt,Dt;return rt.createElement(b_e,{key:ut.id,icons:B,index:Wt,toast:ut,defaultRichColors:R,duration:(Jt=F==null?void 0:F.duration)!=null?Jt:N,className:F==null?void 0:F.className,descriptionClassName:F==null?void 0:F.descriptionClassName,invert:a,visibleToasts:j,closeButton:(Dt=F==null?void 0:F.closeButton)!=null?Dt:_,interacting:tt,position:We,style:F==null?void 0:F.style,unstyled:F==null?void 0:F.unstyled,classNames:F==null?void 0:F.classNames,cancelButtonStyle:F==null?void 0:F.cancelButtonStyle,actionButtonStyle:F==null?void 0:F.actionButtonStyle,removeToast:qe,toasts:te.filter(At=>At.position==ut.position),heights:ue.filter(At=>At.position==ut.position),setHeights:de,expandByDefault:f,gap:M,loadingIcon:U,expanded:Ne,pauseWhenPageIsHidden:J,swipeDirections:r.swipeDirections})})):null}))});const w_e=({...r})=>{const{theme:s="system"}=sr();return d.jsx(x_e,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...r})},T_e=["top","right","bottom","left"],Ad=Math.min,po=Math.max,Ub=Math.round,Av=Math.floor,Ac=r=>({x:r,y:r}),C_e={left:"right",right:"left",bottom:"top",top:"bottom"},R_e={start:"end",end:"start"};function yA(r,s,a){return po(r,Ad(s,a))}function ml(r,s){return typeof r=="function"?r(s):r}function fl(r){return r.split("-")[0]}function Hm(r){return r.split("-")[1]}function uO(r){return r==="x"?"y":"x"}function hO(r){return r==="y"?"height":"width"}const N_e=new Set(["top","bottom"]);function Tc(r){return N_e.has(fl(r))?"y":"x"}function pO(r){return uO(Tc(r))}function A_e(r,s,a){a===void 0&&(a=!1);const c=Hm(r),h=pO(r),f=hO(h);let _=h==="x"?c===(a?"end":"start")?"right":"left":c==="start"?"bottom":"top";return s.reference[f]>s.floating[f]&&(_=Vb(_)),[_,Vb(_)]}function I_e(r){const s=Vb(r);return[EA(r),s,EA(s)]}function EA(r){return r.replace(/start|end/g,s=>R_e[s])}const c$=["left","right"],l$=["right","left"],O_e=["top","bottom"],P_e=["bottom","top"];function D_e(r,s,a){switch(r){case"top":case"bottom":return a?s?l$:c$:s?c$:l$;case"left":case"right":return s?O_e:P_e;default:return[]}}function k_e(r,s,a,c){const h=Hm(r);let f=D_e(fl(r),a==="start",c);return h&&(f=f.map(_=>_+"-"+h),s&&(f=f.concat(f.map(EA)))),f}function Vb(r){return r.replace(/left|right|bottom|top/g,s=>C_e[s])}function L_e(r){return{top:0,right:0,bottom:0,left:0,...r}}function OH(r){return typeof r!="number"?L_e(r):{top:r,right:r,bottom:r,left:r}}function Fb(r){const{x:s,y:a,width:c,height:h}=r;return{width:c,height:h,top:a,left:s,right:s+c,bottom:a+h,x:s,y:a}}function d$(r,s,a){let{reference:c,floating:h}=r;const f=Tc(s),_=pO(s),E=hO(_),v=fl(s),x=f==="y",T=c.x+c.width/2-h.width/2,R=c.y+c.height/2-h.height/2,N=c[E]/2-h[E]/2;let L;switch(v){case"top":L={x:T,y:c.y-h.height};break;case"bottom":L={x:T,y:c.y+c.height};break;case"right":L={x:c.x+c.width,y:R};break;case"left":L={x:c.x-h.width,y:R};break;default:L={x:c.x,y:c.y}}switch(Hm(s)){case"start":L[_]-=N*(a&&x?-1:1);break;case"end":L[_]+=N*(a&&x?-1:1);break}return L}const M_e=async(r,s,a)=>{const{placement:c="bottom",strategy:h="absolute",middleware:f=[],platform:_}=a,E=f.filter(Boolean),v=await(_.isRTL==null?void 0:_.isRTL(s));let x=await _.getElementRects({reference:r,floating:s,strategy:h}),{x:T,y:R}=d$(x,c,v),N=c,L={},j=0;for(let F=0;F<E.length;F++){const{name:P,fn:M}=E[F],{x:U,y:B,data:K,reset:J}=await M({x:T,y:R,initialPlacement:c,placement:N,strategy:h,middlewareData:L,rects:x,platform:_,elements:{reference:r,floating:s}});T=U??T,R=B??R,L={...L,[P]:{...L[P],...K}},J&&j<=50&&(j++,typeof J=="object"&&(J.placement&&(N=J.placement),J.rects&&(x=J.rects===!0?await _.getElementRects({reference:r,floating:s,strategy:h}):J.rects),{x:T,y:R}=d$(x,N,v)),F=-1)}return{x:T,y:R,placement:N,strategy:h,middlewareData:L}};async function P0(r,s){var a;s===void 0&&(s={});const{x:c,y:h,platform:f,rects:_,elements:E,strategy:v}=r,{boundary:x="clippingAncestors",rootBoundary:T="viewport",elementContext:R="floating",altBoundary:N=!1,padding:L=0}=ml(s,r),j=OH(L),P=E[N?R==="floating"?"reference":"floating":R],M=Fb(await f.getClippingRect({element:(a=await(f.isElement==null?void 0:f.isElement(P)))==null||a?P:P.contextElement||await(f.getDocumentElement==null?void 0:f.getDocumentElement(E.floating)),boundary:x,rootBoundary:T,strategy:v})),U=R==="floating"?{x:c,y:h,width:_.floating.width,height:_.floating.height}:_.reference,B=await(f.getOffsetParent==null?void 0:f.getOffsetParent(E.floating)),K=await(f.isElement==null?void 0:f.isElement(B))?await(f.getScale==null?void 0:f.getScale(B))||{x:1,y:1}:{x:1,y:1},J=Fb(f.convertOffsetParentRelativeRectToViewportRelativeRect?await f.convertOffsetParentRelativeRectToViewportRelativeRect({elements:E,rect:U,offsetParent:B,strategy:v}):U);return{top:(M.top-J.top+j.top)/K.y,bottom:(J.bottom-M.bottom+j.bottom)/K.y,left:(M.left-J.left+j.left)/K.x,right:(J.right-M.right+j.right)/K.x}}const j_e=r=>({name:"arrow",options:r,async fn(s){const{x:a,y:c,placement:h,rects:f,platform:_,elements:E,middlewareData:v}=s,{element:x,padding:T=0}=ml(r,s)||{};if(x==null)return{};const R=OH(T),N={x:a,y:c},L=pO(h),j=hO(L),F=await _.getDimensions(x),P=L==="y",M=P?"top":"left",U=P?"bottom":"right",B=P?"clientHeight":"clientWidth",K=f.reference[j]+f.reference[L]-N[L]-f.floating[j],J=N[L]-f.reference[L],te=await(_.getOffsetParent==null?void 0:_.getOffsetParent(x));let se=te?te[B]:0;(!se||!await(_.isElement==null?void 0:_.isElement(te)))&&(se=E.floating[B]||f.floating[j]);const ie=K/2-J/2,ue=se/2-F[j]/2-1,de=Ad(R[M],ue),Ne=Ad(R[U],ue),Ce=de,tt=se-F[j]-Ne,Se=se/2-F[j]/2+ie,Ge=yA(Ce,Se,tt),Xe=!v.arrow&&Hm(h)!=null&&Se!==Ge&&f.reference[j]/2-(Se<Ce?de:Ne)-F[j]/2<0,Re=Xe?Se<Ce?Se-Ce:Se-tt:0;return{[L]:N[L]+Re,data:{[L]:Ge,centerOffset:Se-Ge-Re,...Xe&&{alignmentOffset:Re}},reset:Xe}}}),U_e=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(s){var a,c;const{placement:h,middlewareData:f,rects:_,initialPlacement:E,platform:v,elements:x}=s,{mainAxis:T=!0,crossAxis:R=!0,fallbackPlacements:N,fallbackStrategy:L="bestFit",fallbackAxisSideDirection:j="none",flipAlignment:F=!0,...P}=ml(r,s);if((a=f.arrow)!=null&&a.alignmentOffset)return{};const M=fl(h),U=Tc(E),B=fl(E)===E,K=await(v.isRTL==null?void 0:v.isRTL(x.floating)),J=N||(B||!F?[Vb(E)]:I_e(E)),te=j!=="none";!N&&te&&J.push(...k_e(E,F,j,K));const se=[E,...J],ie=await P0(s,P),ue=[];let de=((c=f.flip)==null?void 0:c.overflows)||[];if(T&&ue.push(ie[M]),R){const Se=A_e(h,_,K);ue.push(ie[Se[0]],ie[Se[1]])}if(de=[...de,{placement:h,overflows:ue}],!ue.every(Se=>Se<=0)){var Ne,Ce;const Se=(((Ne=f.flip)==null?void 0:Ne.index)||0)+1,Ge=se[Se];if(Ge&&(!(R==="alignment"?U!==Tc(Ge):!1)||de.every(le=>le.overflows[0]>0&&Tc(le.placement)===U)))return{data:{index:Se,overflows:de},reset:{placement:Ge}};let Xe=(Ce=de.filter(Re=>Re.overflows[0]<=0).sort((Re,le)=>Re.overflows[1]-le.overflows[1])[0])==null?void 0:Ce.placement;if(!Xe)switch(L){case"bestFit":{var tt;const Re=(tt=de.filter(le=>{if(te){const ve=Tc(le.placement);return ve===U||ve==="y"}return!0}).map(le=>[le.placement,le.overflows.filter(ve=>ve>0).reduce((ve,Le)=>ve+Le,0)]).sort((le,ve)=>le[1]-ve[1])[0])==null?void 0:tt[0];Re&&(Xe=Re);break}case"initialPlacement":Xe=E;break}if(h!==Xe)return{reset:{placement:Xe}}}return{}}}};function u$(r,s){return{top:r.top-s.height,right:r.right-s.width,bottom:r.bottom-s.height,left:r.left-s.width}}function h$(r){return T_e.some(s=>r[s]>=0)}const V_e=function(r){return r===void 0&&(r={}),{name:"hide",options:r,async fn(s){const{rects:a}=s,{strategy:c="referenceHidden",...h}=ml(r,s);switch(c){case"referenceHidden":{const f=await P0(s,{...h,elementContext:"reference"}),_=u$(f,a.reference);return{data:{referenceHiddenOffsets:_,referenceHidden:h$(_)}}}case"escaped":{const f=await P0(s,{...h,altBoundary:!0}),_=u$(f,a.floating);return{data:{escapedOffsets:_,escaped:h$(_)}}}default:return{}}}}},PH=new Set(["left","top"]);async function F_e(r,s){const{placement:a,platform:c,elements:h}=r,f=await(c.isRTL==null?void 0:c.isRTL(h.floating)),_=fl(a),E=Hm(a),v=Tc(a)==="y",x=PH.has(_)?-1:1,T=f&&v?-1:1,R=ml(s,r);let{mainAxis:N,crossAxis:L,alignmentAxis:j}=typeof R=="number"?{mainAxis:R,crossAxis:0,alignmentAxis:null}:{mainAxis:R.mainAxis||0,crossAxis:R.crossAxis||0,alignmentAxis:R.alignmentAxis};return E&&typeof j=="number"&&(L=E==="end"?j*-1:j),v?{x:L*T,y:N*x}:{x:N*x,y:L*T}}const B_e=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(s){var a,c;const{x:h,y:f,placement:_,middlewareData:E}=s,v=await F_e(s,r);return _===((a=E.offset)==null?void 0:a.placement)&&(c=E.arrow)!=null&&c.alignmentOffset?{}:{x:h+v.x,y:f+v.y,data:{...v,placement:_}}}}},$_e=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(s){const{x:a,y:c,placement:h}=s,{mainAxis:f=!0,crossAxis:_=!1,limiter:E={fn:P=>{let{x:M,y:U}=P;return{x:M,y:U}}},...v}=ml(r,s),x={x:a,y:c},T=await P0(s,v),R=Tc(fl(h)),N=uO(R);let L=x[N],j=x[R];if(f){const P=N==="y"?"top":"left",M=N==="y"?"bottom":"right",U=L+T[P],B=L-T[M];L=yA(U,L,B)}if(_){const P=R==="y"?"top":"left",M=R==="y"?"bottom":"right",U=j+T[P],B=j-T[M];j=yA(U,j,B)}const F=E.fn({...s,[N]:L,[R]:j});return{...F,data:{x:F.x-a,y:F.y-c,enabled:{[N]:f,[R]:_}}}}}},W_e=function(r){return r===void 0&&(r={}),{options:r,fn(s){const{x:a,y:c,placement:h,rects:f,middlewareData:_}=s,{offset:E=0,mainAxis:v=!0,crossAxis:x=!0}=ml(r,s),T={x:a,y:c},R=Tc(h),N=uO(R);let L=T[N],j=T[R];const F=ml(E,s),P=typeof F=="number"?{mainAxis:F,crossAxis:0}:{mainAxis:0,crossAxis:0,...F};if(v){const B=N==="y"?"height":"width",K=f.reference[N]-f.floating[B]+P.mainAxis,J=f.reference[N]+f.reference[B]-P.mainAxis;L<K?L=K:L>J&&(L=J)}if(x){var M,U;const B=N==="y"?"width":"height",K=PH.has(fl(h)),J=f.reference[R]-f.floating[B]+(K&&((M=_.offset)==null?void 0:M[R])||0)+(K?0:P.crossAxis),te=f.reference[R]+f.reference[B]+(K?0:((U=_.offset)==null?void 0:U[R])||0)-(K?P.crossAxis:0);j<J?j=J:j>te&&(j=te)}return{[N]:L,[R]:j}}}},G_e=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(s){var a,c;const{placement:h,rects:f,platform:_,elements:E}=s,{apply:v=()=>{},...x}=ml(r,s),T=await P0(s,x),R=fl(h),N=Hm(h),L=Tc(h)==="y",{width:j,height:F}=f.floating;let P,M;R==="top"||R==="bottom"?(P=R,M=N===(await(_.isRTL==null?void 0:_.isRTL(E.floating))?"start":"end")?"left":"right"):(M=R,P=N==="end"?"top":"bottom");const U=F-T.top-T.bottom,B=j-T.left-T.right,K=Ad(F-T[P],U),J=Ad(j-T[M],B),te=!s.middlewareData.shift;let se=K,ie=J;if((a=s.middlewareData.shift)!=null&&a.enabled.x&&(ie=B),(c=s.middlewareData.shift)!=null&&c.enabled.y&&(se=U),te&&!N){const de=po(T.left,0),Ne=po(T.right,0),Ce=po(T.top,0),tt=po(T.bottom,0);L?ie=j-2*(de!==0||Ne!==0?de+Ne:po(T.left,T.right)):se=F-2*(Ce!==0||tt!==0?Ce+tt:po(T.top,T.bottom))}await v({...s,availableWidth:ie,availableHeight:se});const ue=await _.getDimensions(E.floating);return j!==ue.width||F!==ue.height?{reset:{rects:!0}}:{}}}};function SS(){return typeof window<"u"}function Km(r){return DH(r)?(r.nodeName||"").toLowerCase():"#document"}function go(r){var s;return(r==null||(s=r.ownerDocument)==null?void 0:s.defaultView)||window}function Mc(r){var s;return(s=(DH(r)?r.ownerDocument:r.document)||window.document)==null?void 0:s.documentElement}function DH(r){return SS()?r instanceof Node||r instanceof go(r).Node:!1}function Ha(r){return SS()?r instanceof Element||r instanceof go(r).Element:!1}function kc(r){return SS()?r instanceof HTMLElement||r instanceof go(r).HTMLElement:!1}function p$(r){return!SS()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof go(r).ShadowRoot}const H_e=new Set(["inline","contents"]);function s_(r){const{overflow:s,overflowX:a,overflowY:c,display:h}=Ka(r);return/auto|scroll|overlay|hidden|clip/.test(s+c+a)&&!H_e.has(h)}const K_e=new Set(["table","td","th"]);function z_e(r){return K_e.has(Km(r))}const Y_e=[":popover-open",":modal"];function xS(r){return Y_e.some(s=>{try{return r.matches(s)}catch{return!1}})}const q_e=["transform","translate","scale","rotate","perspective"],X_e=["transform","translate","scale","rotate","perspective","filter"],J_e=["paint","layout","strict","content"];function mO(r){const s=fO(),a=Ha(r)?Ka(r):r;return q_e.some(c=>a[c]?a[c]!=="none":!1)||(a.containerType?a.containerType!=="normal":!1)||!s&&(a.backdropFilter?a.backdropFilter!=="none":!1)||!s&&(a.filter?a.filter!=="none":!1)||X_e.some(c=>(a.willChange||"").includes(c))||J_e.some(c=>(a.contain||"").includes(c))}function Q_e(r){let s=Id(r);for(;kc(s)&&!Lm(s);){if(mO(s))return s;if(xS(s))return null;s=Id(s)}return null}function fO(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Z_e=new Set(["html","body","#document"]);function Lm(r){return Z_e.has(Km(r))}function Ka(r){return go(r).getComputedStyle(r)}function wS(r){return Ha(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function Id(r){if(Km(r)==="html")return r;const s=r.assignedSlot||r.parentNode||p$(r)&&r.host||Mc(r);return p$(s)?s.host:s}function kH(r){const s=Id(r);return Lm(s)?r.ownerDocument?r.ownerDocument.body:r.body:kc(s)&&s_(s)?s:kH(s)}function D0(r,s,a){var c;s===void 0&&(s=[]),a===void 0&&(a=!0);const h=kH(r),f=h===((c=r.ownerDocument)==null?void 0:c.body),_=go(h);if(f){const E=vA(_);return s.concat(_,_.visualViewport||[],s_(h)?h:[],E&&a?D0(E):[])}return s.concat(h,D0(h,[],a))}function vA(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function LH(r){const s=Ka(r);let a=parseFloat(s.width)||0,c=parseFloat(s.height)||0;const h=kc(r),f=h?r.offsetWidth:a,_=h?r.offsetHeight:c,E=Ub(a)!==f||Ub(c)!==_;return E&&(a=f,c=_),{width:a,height:c,$:E}}function gO(r){return Ha(r)?r:r.contextElement}function _m(r){const s=gO(r);if(!kc(s))return Ac(1);const a=s.getBoundingClientRect(),{width:c,height:h,$:f}=LH(s);let _=(f?Ub(a.width):a.width)/c,E=(f?Ub(a.height):a.height)/h;return(!_||!Number.isFinite(_))&&(_=1),(!E||!Number.isFinite(E))&&(E=1),{x:_,y:E}}const eye=Ac(0);function MH(r){const s=go(r);return!fO()||!s.visualViewport?eye:{x:s.visualViewport.offsetLeft,y:s.visualViewport.offsetTop}}function tye(r,s,a){return s===void 0&&(s=!1),!a||s&&a!==go(r)?!1:s}function lh(r,s,a,c){s===void 0&&(s=!1),a===void 0&&(a=!1);const h=r.getBoundingClientRect(),f=gO(r);let _=Ac(1);s&&(c?Ha(c)&&(_=_m(c)):_=_m(r));const E=tye(f,a,c)?MH(f):Ac(0);let v=(h.left+E.x)/_.x,x=(h.top+E.y)/_.y,T=h.width/_.x,R=h.height/_.y;if(f){const N=go(f),L=c&&Ha(c)?go(c):c;let j=N,F=vA(j);for(;F&&c&&L!==j;){const P=_m(F),M=F.getBoundingClientRect(),U=Ka(F),B=M.left+(F.clientLeft+parseFloat(U.paddingLeft))*P.x,K=M.top+(F.clientTop+parseFloat(U.paddingTop))*P.y;v*=P.x,x*=P.y,T*=P.x,R*=P.y,v+=B,x+=K,j=go(F),F=vA(j)}}return Fb({width:T,height:R,x:v,y:x})}function _O(r,s){const a=wS(r).scrollLeft;return s?s.left+a:lh(Mc(r)).left+a}function jH(r,s,a){a===void 0&&(a=!1);const c=r.getBoundingClientRect(),h=c.left+s.scrollLeft-(a?0:_O(r,c)),f=c.top+s.scrollTop;return{x:h,y:f}}function nye(r){let{elements:s,rect:a,offsetParent:c,strategy:h}=r;const f=h==="fixed",_=Mc(c),E=s?xS(s.floating):!1;if(c===_||E&&f)return a;let v={scrollLeft:0,scrollTop:0},x=Ac(1);const T=Ac(0),R=kc(c);if((R||!R&&!f)&&((Km(c)!=="body"||s_(_))&&(v=wS(c)),kc(c))){const L=lh(c);x=_m(c),T.x=L.x+c.clientLeft,T.y=L.y+c.clientTop}const N=_&&!R&&!f?jH(_,v,!0):Ac(0);return{width:a.width*x.x,height:a.height*x.y,x:a.x*x.x-v.scrollLeft*x.x+T.x+N.x,y:a.y*x.y-v.scrollTop*x.y+T.y+N.y}}function rye(r){return Array.from(r.getClientRects())}function sye(r){const s=Mc(r),a=wS(r),c=r.ownerDocument.body,h=po(s.scrollWidth,s.clientWidth,c.scrollWidth,c.clientWidth),f=po(s.scrollHeight,s.clientHeight,c.scrollHeight,c.clientHeight);let _=-a.scrollLeft+_O(r);const E=-a.scrollTop;return Ka(c).direction==="rtl"&&(_+=po(s.clientWidth,c.clientWidth)-h),{width:h,height:f,x:_,y:E}}function iye(r,s){const a=go(r),c=Mc(r),h=a.visualViewport;let f=c.clientWidth,_=c.clientHeight,E=0,v=0;if(h){f=h.width,_=h.height;const x=fO();(!x||x&&s==="fixed")&&(E=h.offsetLeft,v=h.offsetTop)}return{width:f,height:_,x:E,y:v}}const oye=new Set(["absolute","fixed"]);function aye(r,s){const a=lh(r,!0,s==="fixed"),c=a.top+r.clientTop,h=a.left+r.clientLeft,f=kc(r)?_m(r):Ac(1),_=r.clientWidth*f.x,E=r.clientHeight*f.y,v=h*f.x,x=c*f.y;return{width:_,height:E,x:v,y:x}}function m$(r,s,a){let c;if(s==="viewport")c=iye(r,a);else if(s==="document")c=sye(Mc(r));else if(Ha(s))c=aye(s,a);else{const h=MH(r);c={x:s.x-h.x,y:s.y-h.y,width:s.width,height:s.height}}return Fb(c)}function UH(r,s){const a=Id(r);return a===s||!Ha(a)||Lm(a)?!1:Ka(a).position==="fixed"||UH(a,s)}function cye(r,s){const a=s.get(r);if(a)return a;let c=D0(r,[],!1).filter(E=>Ha(E)&&Km(E)!=="body"),h=null;const f=Ka(r).position==="fixed";let _=f?Id(r):r;for(;Ha(_)&&!Lm(_);){const E=Ka(_),v=mO(_);!v&&E.position==="fixed"&&(h=null),(f?!v&&!h:!v&&E.position==="static"&&!!h&&oye.has(h.position)||s_(_)&&!v&&UH(r,_))?c=c.filter(T=>T!==_):h=E,_=Id(_)}return s.set(r,c),c}function lye(r){let{element:s,boundary:a,rootBoundary:c,strategy:h}=r;const _=[...a==="clippingAncestors"?xS(s)?[]:cye(s,this._c):[].concat(a),c],E=_[0],v=_.reduce((x,T)=>{const R=m$(s,T,h);return x.top=po(R.top,x.top),x.right=Ad(R.right,x.right),x.bottom=Ad(R.bottom,x.bottom),x.left=po(R.left,x.left),x},m$(s,E,h));return{width:v.right-v.left,height:v.bottom-v.top,x:v.left,y:v.top}}function dye(r){const{width:s,height:a}=LH(r);return{width:s,height:a}}function uye(r,s,a){const c=kc(s),h=Mc(s),f=a==="fixed",_=lh(r,!0,f,s);let E={scrollLeft:0,scrollTop:0};const v=Ac(0);function x(){v.x=_O(h)}if(c||!c&&!f)if((Km(s)!=="body"||s_(h))&&(E=wS(s)),c){const L=lh(s,!0,f,s);v.x=L.x+s.clientLeft,v.y=L.y+s.clientTop}else h&&x();f&&!c&&h&&x();const T=h&&!c&&!f?jH(h,E):Ac(0),R=_.left+E.scrollLeft-v.x-T.x,N=_.top+E.scrollTop-v.y-T.y;return{x:R,y:N,width:_.width,height:_.height}}function $N(r){return Ka(r).position==="static"}function f$(r,s){if(!kc(r)||Ka(r).position==="fixed")return null;if(s)return s(r);let a=r.offsetParent;return Mc(r)===a&&(a=a.ownerDocument.body),a}function VH(r,s){const a=go(r);if(xS(r))return a;if(!kc(r)){let h=Id(r);for(;h&&!Lm(h);){if(Ha(h)&&!$N(h))return h;h=Id(h)}return a}let c=f$(r,s);for(;c&&z_e(c)&&$N(c);)c=f$(c,s);return c&&Lm(c)&&$N(c)&&!mO(c)?a:c||Q_e(r)||a}const hye=async function(r){const s=this.getOffsetParent||VH,a=this.getDimensions,c=await a(r.floating);return{reference:uye(r.reference,await s(r.floating),r.strategy),floating:{x:0,y:0,width:c.width,height:c.height}}};function pye(r){return Ka(r).direction==="rtl"}const mye={convertOffsetParentRelativeRectToViewportRelativeRect:nye,getDocumentElement:Mc,getClippingRect:lye,getOffsetParent:VH,getElementRects:hye,getClientRects:rye,getDimensions:dye,getScale:_m,isElement:Ha,isRTL:pye};function FH(r,s){return r.x===s.x&&r.y===s.y&&r.width===s.width&&r.height===s.height}function fye(r,s){let a=null,c;const h=Mc(r);function f(){var E;clearTimeout(c),(E=a)==null||E.disconnect(),a=null}function _(E,v){E===void 0&&(E=!1),v===void 0&&(v=1),f();const x=r.getBoundingClientRect(),{left:T,top:R,width:N,height:L}=x;if(E||s(),!N||!L)return;const j=Av(R),F=Av(h.clientWidth-(T+N)),P=Av(h.clientHeight-(R+L)),M=Av(T),B={rootMargin:-j+"px "+-F+"px "+-P+"px "+-M+"px",threshold:po(0,Ad(1,v))||1};let K=!0;function J(te){const se=te[0].intersectionRatio;if(se!==v){if(!K)return _();se?_(!1,se):c=setTimeout(()=>{_(!1,1e-7)},1e3)}se===1&&!FH(x,r.getBoundingClientRect())&&_(),K=!1}try{a=new IntersectionObserver(J,{...B,root:h.ownerDocument})}catch{a=new IntersectionObserver(J,B)}a.observe(r)}return _(!0),f}function gye(r,s,a,c){c===void 0&&(c={});const{ancestorScroll:h=!0,ancestorResize:f=!0,elementResize:_=typeof ResizeObserver=="function",layoutShift:E=typeof IntersectionObserver=="function",animationFrame:v=!1}=c,x=gO(r),T=h||f?[...x?D0(x):[],...D0(s)]:[];T.forEach(M=>{h&&M.addEventListener("scroll",a,{passive:!0}),f&&M.addEventListener("resize",a)});const R=x&&E?fye(x,a):null;let N=-1,L=null;_&&(L=new ResizeObserver(M=>{let[U]=M;U&&U.target===x&&L&&(L.unobserve(s),cancelAnimationFrame(N),N=requestAnimationFrame(()=>{var B;(B=L)==null||B.observe(s)})),a()}),x&&!v&&L.observe(x),L.observe(s));let j,F=v?lh(r):null;v&&P();function P(){const M=lh(r);F&&!FH(F,M)&&a(),F=M,j=requestAnimationFrame(P)}return a(),()=>{var M;T.forEach(U=>{h&&U.removeEventListener("scroll",a),f&&U.removeEventListener("resize",a)}),R==null||R(),(M=L)==null||M.disconnect(),L=null,v&&cancelAnimationFrame(j)}}const _ye=B_e,yye=$_e,Eye=U_e,vye=G_e,bye=V_e,g$=j_e,Sye=W_e,xye=(r,s,a)=>{const c=new Map,h={platform:mye,...a},f={...h.platform,_c:c};return M_e(r,s,{...h,platform:f})};var wye=typeof document<"u",Tye=function(){},tb=wye?V.useLayoutEffect:Tye;function Bb(r,s){if(r===s)return!0;if(typeof r!=typeof s)return!1;if(typeof r=="function"&&r.toString()===s.toString())return!0;let a,c,h;if(r&&s&&typeof r=="object"){if(Array.isArray(r)){if(a=r.length,a!==s.length)return!1;for(c=a;c--!==0;)if(!Bb(r[c],s[c]))return!1;return!0}if(h=Object.keys(r),a=h.length,a!==Object.keys(s).length)return!1;for(c=a;c--!==0;)if(!{}.hasOwnProperty.call(s,h[c]))return!1;for(c=a;c--!==0;){const f=h[c];if(!(f==="_owner"&&r.$$typeof)&&!Bb(r[f],s[f]))return!1}return!0}return r!==r&&s!==s}function BH(r){return typeof window>"u"?1:(r.ownerDocument.defaultView||window).devicePixelRatio||1}function _$(r,s){const a=BH(r);return Math.round(s*a)/a}function WN(r){const s=V.useRef(r);return tb(()=>{s.current=r}),s}function Cye(r){r===void 0&&(r={});const{placement:s="bottom",strategy:a="absolute",middleware:c=[],platform:h,elements:{reference:f,floating:_}={},transform:E=!0,whileElementsMounted:v,open:x}=r,[T,R]=V.useState({x:0,y:0,strategy:a,placement:s,middlewareData:{},isPositioned:!1}),[N,L]=V.useState(c);Bb(N,c)||L(c);const[j,F]=V.useState(null),[P,M]=V.useState(null),U=V.useCallback(le=>{le!==te.current&&(te.current=le,F(le))},[]),B=V.useCallback(le=>{le!==se.current&&(se.current=le,M(le))},[]),K=f||j,J=_||P,te=V.useRef(null),se=V.useRef(null),ie=V.useRef(T),ue=v!=null,de=WN(v),Ne=WN(h),Ce=WN(x),tt=V.useCallback(()=>{if(!te.current||!se.current)return;const le={placement:s,strategy:a,middleware:N};Ne.current&&(le.platform=Ne.current),xye(te.current,se.current,le).then(ve=>{const Le={...ve,isPositioned:Ce.current!==!1};Se.current&&!Bb(ie.current,Le)&&(ie.current=Le,t_.flushSync(()=>{R(Le)}))})},[N,s,a,Ne,Ce]);tb(()=>{x===!1&&ie.current.isPositioned&&(ie.current.isPositioned=!1,R(le=>({...le,isPositioned:!1})))},[x]);const Se=V.useRef(!1);tb(()=>(Se.current=!0,()=>{Se.current=!1}),[]),tb(()=>{if(K&&(te.current=K),J&&(se.current=J),K&&J){if(de.current)return de.current(K,J,tt);tt()}},[K,J,tt,de,ue]);const Ge=V.useMemo(()=>({reference:te,floating:se,setReference:U,setFloating:B}),[U,B]),Xe=V.useMemo(()=>({reference:K,floating:J}),[K,J]),Re=V.useMemo(()=>{const le={position:a,left:0,top:0};if(!Xe.floating)return le;const ve=_$(Xe.floating,T.x),Le=_$(Xe.floating,T.y);return E?{...le,transform:"translate("+ve+"px, "+Le+"px)",...BH(Xe.floating)>=1.5&&{willChange:"transform"}}:{position:a,left:ve,top:Le}},[a,E,Xe.floating,T.x,T.y]);return V.useMemo(()=>({...T,update:tt,refs:Ge,elements:Xe,floatingStyles:Re}),[T,tt,Ge,Xe,Re])}const Rye=r=>{function s(a){return{}.hasOwnProperty.call(a,"current")}return{name:"arrow",options:r,fn(a){const{element:c,padding:h}=typeof r=="function"?r(a):r;return c&&s(c)?c.current!=null?g$({element:c.current,padding:h}).fn(a):{}:c?g$({element:c,padding:h}).fn(a):{}}}},Nye=(r,s)=>({..._ye(r),options:[r,s]}),Aye=(r,s)=>({...yye(r),options:[r,s]}),Iye=(r,s)=>({...Sye(r),options:[r,s]}),Oye=(r,s)=>({...Eye(r),options:[r,s]}),Pye=(r,s)=>({...vye(r),options:[r,s]}),Dye=(r,s)=>({...bye(r),options:[r,s]}),kye=(r,s)=>({...Rye(r),options:[r,s]});var Lye="Arrow",$H=V.forwardRef((r,s)=>{const{children:a,width:c=10,height:h=5,...f}=r;return d.jsx(Ss.svg,{...f,ref:s,width:c,height:h,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:r.asChild?a:d.jsx("polygon",{points:"0,0 30,0 15,10"})})});$H.displayName=Lye;var Mye=$H;function jye(r){const[s,a]=V.useState(void 0);return hl(()=>{if(r){a({width:r.offsetWidth,height:r.offsetHeight});const c=new ResizeObserver(h=>{if(!Array.isArray(h)||!h.length)return;const f=h[0];let _,E;if("borderBoxSize"in f){const v=f.borderBoxSize,x=Array.isArray(v)?v[0]:v;_=x.inlineSize,E=x.blockSize}else _=r.offsetWidth,E=r.offsetHeight;a({width:_,height:E})});return c.observe(r,{box:"border-box"}),()=>c.unobserve(r)}else a(void 0)},[r]),s}var WH="Popper",[GH,HH]=n_(WH),[F1e,KH]=GH(WH),zH="PopperAnchor",YH=V.forwardRef((r,s)=>{const{__scopePopper:a,virtualRef:c,...h}=r,f=KH(zH,a),_=V.useRef(null),E=qs(s,_);return V.useEffect(()=>{f.onAnchorChange((c==null?void 0:c.current)||_.current)}),c?null:d.jsx(Ss.div,{...h,ref:E})});YH.displayName=zH;var yO="PopperContent",[Uye,Vye]=GH(yO),qH=V.forwardRef((r,s)=>{var ut,Wt,Jt,Dt,At,be;const{__scopePopper:a,side:c="bottom",sideOffset:h=0,align:f="center",alignOffset:_=0,arrowPadding:E=0,avoidCollisions:v=!0,collisionBoundary:x=[],collisionPadding:T=0,sticky:R="partial",hideWhenDetached:N=!1,updatePositionStrategy:L="optimized",onPlaced:j,...F}=r,P=KH(yO,a),[M,U]=V.useState(null),B=qs(s,ht=>U(ht)),[K,J]=V.useState(null),te=jye(K),se=(te==null?void 0:te.width)??0,ie=(te==null?void 0:te.height)??0,ue=c+(f!=="center"?"-"+f:""),de=typeof T=="number"?T:{top:0,right:0,bottom:0,left:0,...T},Ne=Array.isArray(x)?x:[x],Ce=Ne.length>0,tt={padding:de,boundary:Ne.filter(Bye),altBoundary:Ce},{refs:Se,floatingStyles:Ge,placement:Xe,isPositioned:Re,middlewareData:le}=Cye({strategy:"fixed",placement:ue,whileElementsMounted:(...ht)=>gye(...ht,{animationFrame:L==="always"}),elements:{reference:P.anchor},middleware:[Nye({mainAxis:h+ie,alignmentAxis:_}),v&&Aye({mainAxis:!0,crossAxis:!1,limiter:R==="partial"?Iye():void 0,...tt}),v&&Oye({...tt}),Pye({...tt,apply:({elements:ht,rects:Gt,availableWidth:Ln,availableHeight:Mn})=>{const{width:bn,height:ln}=Gt.reference,vn=ht.floating.style;vn.setProperty("--radix-popper-available-width",`${Ln}px`),vn.setProperty("--radix-popper-available-height",`${Mn}px`),vn.setProperty("--radix-popper-anchor-width",`${bn}px`),vn.setProperty("--radix-popper-anchor-height",`${ln}px`)}}),K&&kye({element:K,padding:E}),$ye({arrowWidth:se,arrowHeight:ie}),N&&Dye({strategy:"referenceHidden",...tt})]}),[ve,Le]=QH(Xe),qe=wi(j);hl(()=>{Re&&(qe==null||qe())},[Re,qe]);const We=(ut=le.arrow)==null?void 0:ut.x,xt=(Wt=le.arrow)==null?void 0:Wt.y,bt=((Jt=le.arrow)==null?void 0:Jt.centerOffset)!==0,[$t,vt]=V.useState();return hl(()=>{M&&vt(window.getComputedStyle(M).zIndex)},[M]),d.jsx("div",{ref:Se.setFloating,"data-radix-popper-content-wrapper":"",style:{...Ge,transform:Re?Ge.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:$t,"--radix-popper-transform-origin":[(Dt=le.transformOrigin)==null?void 0:Dt.x,(At=le.transformOrigin)==null?void 0:At.y].join(" "),...((be=le.hide)==null?void 0:be.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:r.dir,children:d.jsx(Uye,{scope:a,placedSide:ve,onArrowChange:J,arrowX:We,arrowY:xt,shouldHideArrow:bt,children:d.jsx(Ss.div,{"data-side":ve,"data-align":Le,...F,ref:B,style:{...F.style,animation:Re?void 0:"none"}})})})});qH.displayName=yO;var XH="PopperArrow",Fye={top:"bottom",right:"left",bottom:"top",left:"right"},JH=V.forwardRef(function(s,a){const{__scopePopper:c,...h}=s,f=Vye(XH,c),_=Fye[f.placedSide];return d.jsx("span",{ref:f.onArrowChange,style:{position:"absolute",left:f.arrowX,top:f.arrowY,[_]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[f.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[f.placedSide],visibility:f.shouldHideArrow?"hidden":void 0},children:d.jsx(Mye,{...h,ref:a,style:{...h.style,display:"block"}})})});JH.displayName=XH;function Bye(r){return r!==null}var $ye=r=>({name:"transformOrigin",options:r,fn(s){var P,M,U;const{placement:a,rects:c,middlewareData:h}=s,_=((P=h.arrow)==null?void 0:P.centerOffset)!==0,E=_?0:r.arrowWidth,v=_?0:r.arrowHeight,[x,T]=QH(a),R={start:"0%",center:"50%",end:"100%"}[T],N=(((M=h.arrow)==null?void 0:M.x)??0)+E/2,L=(((U=h.arrow)==null?void 0:U.y)??0)+v/2;let j="",F="";return x==="bottom"?(j=_?R:`${N}px`,F=`${-v}px`):x==="top"?(j=_?R:`${N}px`,F=`${c.floating.height+v}px`):x==="right"?(j=`${-v}px`,F=_?R:`${L}px`):x==="left"&&(j=`${c.floating.width+v}px`,F=_?R:`${L}px`),{data:{x:j,y:F}}}});function QH(r){const[s,a="center"]=r.split("-");return[s,a]}var Wye=YH,Gye=qH,Hye=JH,[TS,B1e]=n_("Tooltip",[HH]),EO=HH(),ZH="TooltipProvider",Kye=700,y$="tooltip.open",[zye,eK]=TS(ZH),tK=r=>{const{__scopeTooltip:s,delayDuration:a=Kye,skipDelayDuration:c=300,disableHoverableContent:h=!1,children:f}=r,_=V.useRef(!0),E=V.useRef(!1),v=V.useRef(0);return V.useEffect(()=>{const x=v.current;return()=>window.clearTimeout(x)},[]),d.jsx(zye,{scope:s,isOpenDelayedRef:_,delayDuration:a,onOpen:V.useCallback(()=>{window.clearTimeout(v.current),_.current=!1},[]),onClose:V.useCallback(()=>{window.clearTimeout(v.current),v.current=window.setTimeout(()=>_.current=!0,c)},[c]),isPointerInTransitRef:E,onPointerInTransitChange:V.useCallback(x=>{E.current=x},[]),disableHoverableContent:h,children:f})};tK.displayName=ZH;var nK="Tooltip",[$1e,CS]=TS(nK),bA="TooltipTrigger",Yye=V.forwardRef((r,s)=>{const{__scopeTooltip:a,...c}=r,h=CS(bA,a),f=eK(bA,a),_=EO(a),E=V.useRef(null),v=qs(s,E,h.onTriggerChange),x=V.useRef(!1),T=V.useRef(!1),R=V.useCallback(()=>x.current=!1,[]);return V.useEffect(()=>()=>document.removeEventListener("pointerup",R),[R]),d.jsx(Wye,{asChild:!0,..._,children:d.jsx(Ss.button,{"aria-describedby":h.open?h.contentId:void 0,"data-state":h.stateAttribute,...c,ref:v,onPointerMove:fr(r.onPointerMove,N=>{N.pointerType!=="touch"&&!T.current&&!f.isPointerInTransitRef.current&&(h.onTriggerEnter(),T.current=!0)}),onPointerLeave:fr(r.onPointerLeave,()=>{h.onTriggerLeave(),T.current=!1}),onPointerDown:fr(r.onPointerDown,()=>{h.open&&h.onClose(),x.current=!0,document.addEventListener("pointerup",R,{once:!0})}),onFocus:fr(r.onFocus,()=>{x.current||h.onOpen()}),onBlur:fr(r.onBlur,h.onClose),onClick:fr(r.onClick,h.onClose)})})});Yye.displayName=bA;var qye="TooltipPortal",[W1e,Xye]=TS(qye,{forceMount:void 0}),Mm="TooltipContent",rK=V.forwardRef((r,s)=>{const a=Xye(Mm,r.__scopeTooltip),{forceMount:c=a.forceMount,side:h="top",...f}=r,_=CS(Mm,r.__scopeTooltip);return d.jsx(mh,{present:c||_.open,children:_.disableHoverableContent?d.jsx(sK,{side:h,...f,ref:s}):d.jsx(Jye,{side:h,...f,ref:s})})}),Jye=V.forwardRef((r,s)=>{const a=CS(Mm,r.__scopeTooltip),c=eK(Mm,r.__scopeTooltip),h=V.useRef(null),f=qs(s,h),[_,E]=V.useState(null),{trigger:v,onClose:x}=a,T=h.current,{onPointerInTransitChange:R}=c,N=V.useCallback(()=>{E(null),R(!1)},[R]),L=V.useCallback((j,F)=>{const P=j.currentTarget,M={x:j.clientX,y:j.clientY},U=nEe(M,P.getBoundingClientRect()),B=rEe(M,U),K=sEe(F.getBoundingClientRect()),J=oEe([...B,...K]);E(J),R(!0)},[R]);return V.useEffect(()=>()=>N(),[N]),V.useEffect(()=>{if(v&&T){const j=P=>L(P,T),F=P=>L(P,v);return v.addEventListener("pointerleave",j),T.addEventListener("pointerleave",F),()=>{v.removeEventListener("pointerleave",j),T.removeEventListener("pointerleave",F)}}},[v,T,L,N]),V.useEffect(()=>{if(_){const j=F=>{const P=F.target,M={x:F.clientX,y:F.clientY},U=(v==null?void 0:v.contains(P))||(T==null?void 0:T.contains(P)),B=!iEe(M,_);U?N():B&&(N(),x())};return document.addEventListener("pointermove",j),()=>document.removeEventListener("pointermove",j)}},[v,T,_,x,N]),d.jsx(sK,{...r,ref:f})}),[Qye,Zye]=TS(nK,{isInside:!1}),eEe=Ife("TooltipContent"),sK=V.forwardRef((r,s)=>{const{__scopeTooltip:a,children:c,"aria-label":h,onEscapeKeyDown:f,onPointerDownOutside:_,...E}=r,v=CS(Mm,a),x=EO(a),{onClose:T}=v;return V.useEffect(()=>(document.addEventListener(y$,T),()=>document.removeEventListener(y$,T)),[T]),V.useEffect(()=>{if(v.trigger){const R=N=>{const L=N.target;L!=null&&L.contains(v.trigger)&&T()};return window.addEventListener("scroll",R,{capture:!0}),()=>window.removeEventListener("scroll",R,{capture:!0})}},[v.trigger,T]),d.jsx(JI,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:f,onPointerDownOutside:_,onFocusOutside:R=>R.preventDefault(),onDismiss:T,children:d.jsxs(Gye,{"data-state":v.stateAttribute,...x,...E,ref:s,style:{...E.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[d.jsx(eEe,{children:c}),d.jsx(Qye,{scope:a,isInside:!0,children:d.jsx(tge,{id:v.contentId,role:"tooltip",children:h||c})})]})})});rK.displayName=Mm;var iK="TooltipArrow",tEe=V.forwardRef((r,s)=>{const{__scopeTooltip:a,...c}=r,h=EO(a);return Zye(iK,a).isInside?null:d.jsx(Hye,{...h,...c,ref:s})});tEe.displayName=iK;function nEe(r,s){const a=Math.abs(s.top-r.y),c=Math.abs(s.bottom-r.y),h=Math.abs(s.right-r.x),f=Math.abs(s.left-r.x);switch(Math.min(a,c,h,f)){case f:return"left";case h:return"right";case a:return"top";case c:return"bottom";default:throw new Error("unreachable")}}function rEe(r,s,a=5){const c=[];switch(s){case"top":c.push({x:r.x-a,y:r.y+a},{x:r.x+a,y:r.y+a});break;case"bottom":c.push({x:r.x-a,y:r.y-a},{x:r.x+a,y:r.y-a});break;case"left":c.push({x:r.x+a,y:r.y-a},{x:r.x+a,y:r.y+a});break;case"right":c.push({x:r.x-a,y:r.y-a},{x:r.x-a,y:r.y+a});break}return c}function sEe(r){const{top:s,right:a,bottom:c,left:h}=r;return[{x:h,y:s},{x:a,y:s},{x:a,y:c},{x:h,y:c}]}function iEe(r,s){const{x:a,y:c}=r;let h=!1;for(let f=0,_=s.length-1;f<s.length;_=f++){const E=s[f],v=s[_],x=E.x,T=E.y,R=v.x,N=v.y;T>c!=N>c&&a<(R-x)*(c-T)/(N-T)+x&&(h=!h)}return h}function oEe(r){const s=r.slice();return s.sort((a,c)=>a.x<c.x?-1:a.x>c.x?1:a.y<c.y?-1:a.y>c.y?1:0),aEe(s)}function aEe(r){if(r.length<=1)return r.slice();const s=[];for(let c=0;c<r.length;c++){const h=r[c];for(;s.length>=2;){const f=s[s.length-1],_=s[s.length-2];if((f.x-_.x)*(h.y-_.y)>=(f.y-_.y)*(h.x-_.x))s.pop();else break}s.push(h)}s.pop();const a=[];for(let c=r.length-1;c>=0;c--){const h=r[c];for(;a.length>=2;){const f=a[a.length-1],_=a[a.length-2];if((f.x-_.x)*(h.y-_.y)>=(f.y-_.y)*(h.x-_.x))a.pop();else break}a.push(h)}return a.pop(),s.length===1&&a.length===1&&s[0].x===a[0].x&&s[0].y===a[0].y?s:s.concat(a)}var cEe=tK,oK=rK;const lEe=cEe,dEe=V.forwardRef(({className:r,sideOffset:s=4,...a},c)=>d.jsx(oK,{ref:c,sideOffset:s,className:Xs("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...a}));dEe.displayName=oK.displayName;var RS=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},NS=typeof window>"u"||"Deno"in globalThis;function La(){}function uEe(r,s){return typeof r=="function"?r(s):r}function hEe(r){return typeof r=="number"&&r>=0&&r!==1/0}function pEe(r,s){return Math.max(r+(s||0)-Date.now(),0)}function SA(r,s){return typeof r=="function"?r(s):r}function mEe(r,s){return typeof r=="function"?r(s):r}function E$(r,s){const{type:a="all",exact:c,fetchStatus:h,predicate:f,queryKey:_,stale:E}=r;if(_){if(c){if(s.queryHash!==vO(_,s.options))return!1}else if(!L0(s.queryKey,_))return!1}if(a!=="all"){const v=s.isActive();if(a==="active"&&!v||a==="inactive"&&v)return!1}return!(typeof E=="boolean"&&s.isStale()!==E||h&&h!==s.state.fetchStatus||f&&!f(s))}function v$(r,s){const{exact:a,status:c,predicate:h,mutationKey:f}=r;if(f){if(!s.options.mutationKey)return!1;if(a){if(k0(s.options.mutationKey)!==k0(f))return!1}else if(!L0(s.options.mutationKey,f))return!1}return!(c&&s.state.status!==c||h&&!h(s))}function vO(r,s){return((s==null?void 0:s.queryKeyHashFn)||k0)(r)}function k0(r){return JSON.stringify(r,(s,a)=>xA(a)?Object.keys(a).sort().reduce((c,h)=>(c[h]=a[h],c),{}):a)}function L0(r,s){return r===s?!0:typeof r!=typeof s?!1:r&&s&&typeof r=="object"&&typeof s=="object"?Object.keys(s).every(a=>L0(r[a],s[a])):!1}function aK(r,s){if(r===s)return r;const a=b$(r)&&b$(s);if(a||xA(r)&&xA(s)){const c=a?r:Object.keys(r),h=c.length,f=a?s:Object.keys(s),_=f.length,E=a?[]:{},v=new Set(c);let x=0;for(let T=0;T<_;T++){const R=a?T:f[T];(!a&&v.has(R)||a)&&r[R]===void 0&&s[R]===void 0?(E[R]=void 0,x++):(E[R]=aK(r[R],s[R]),E[R]===r[R]&&r[R]!==void 0&&x++)}return h===_&&x===h?r:E}return s}function b$(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function xA(r){if(!S$(r))return!1;const s=r.constructor;if(s===void 0)return!0;const a=s.prototype;return!(!S$(a)||!a.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function S$(r){return Object.prototype.toString.call(r)==="[object Object]"}function fEe(r){return new Promise(s=>{setTimeout(s,r)})}function gEe(r,s,a){return typeof a.structuralSharing=="function"?a.structuralSharing(r,s):a.structuralSharing!==!1?aK(r,s):s}function _Ee(r,s,a=0){const c=[...r,s];return a&&c.length>a?c.slice(1):c}function yEe(r,s,a=0){const c=[s,...r];return a&&c.length>a?c.slice(0,-1):c}var bO=Symbol();function cK(r,s){return!r.queryFn&&(s!=null&&s.initialPromise)?()=>s.initialPromise:!r.queryFn||r.queryFn===bO?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn}var Ku,cd,Em,uG,EEe=(uG=class extends RS{constructor(){super();Gn(this,Ku);Gn(this,cd);Gn(this,Em);cn(this,Em,s=>{if(!NS&&window.addEventListener){const a=()=>s();return window.addEventListener("visibilitychange",a,!1),()=>{window.removeEventListener("visibilitychange",a)}}})}onSubscribe(){$e(this,cd)||this.setEventListener($e(this,Em))}onUnsubscribe(){var s;this.hasListeners()||((s=$e(this,cd))==null||s.call(this),cn(this,cd,void 0))}setEventListener(s){var a;cn(this,Em,s),(a=$e(this,cd))==null||a.call(this),cn(this,cd,s(c=>{typeof c=="boolean"?this.setFocused(c):this.onFocus()}))}setFocused(s){$e(this,Ku)!==s&&(cn(this,Ku,s),this.onFocus())}onFocus(){const s=this.isFocused();this.listeners.forEach(a=>{a(s)})}isFocused(){var s;return typeof $e(this,Ku)=="boolean"?$e(this,Ku):((s=globalThis.document)==null?void 0:s.visibilityState)!=="hidden"}},Ku=new WeakMap,cd=new WeakMap,Em=new WeakMap,uG),lK=new EEe,vm,ld,bm,hG,vEe=(hG=class extends RS{constructor(){super();Gn(this,vm,!0);Gn(this,ld);Gn(this,bm);cn(this,bm,s=>{if(!NS&&window.addEventListener){const a=()=>s(!0),c=()=>s(!1);return window.addEventListener("online",a,!1),window.addEventListener("offline",c,!1),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",c)}}})}onSubscribe(){$e(this,ld)||this.setEventListener($e(this,bm))}onUnsubscribe(){var s;this.hasListeners()||((s=$e(this,ld))==null||s.call(this),cn(this,ld,void 0))}setEventListener(s){var a;cn(this,bm,s),(a=$e(this,ld))==null||a.call(this),cn(this,ld,s(this.setOnline.bind(this)))}setOnline(s){$e(this,vm)!==s&&(cn(this,vm,s),this.listeners.forEach(c=>{c(s)}))}isOnline(){return $e(this,vm)}},vm=new WeakMap,ld=new WeakMap,bm=new WeakMap,hG),$b=new vEe;function bEe(){let r,s;const a=new Promise((h,f)=>{r=h,s=f});a.status="pending",a.catch(()=>{});function c(h){Object.assign(a,h),delete a.resolve,delete a.reject}return a.resolve=h=>{c({status:"fulfilled",value:h}),r(h)},a.reject=h=>{c({status:"rejected",reason:h}),s(h)},a}function SEe(r){return Math.min(1e3*2**r,3e4)}function dK(r){return(r??"online")==="online"?$b.isOnline():!0}var uK=class extends Error{constructor(r){super("CancelledError"),this.revert=r==null?void 0:r.revert,this.silent=r==null?void 0:r.silent}};function GN(r){return r instanceof uK}function hK(r){let s=!1,a=0,c=!1,h;const f=bEe(),_=F=>{var P;c||(N(new uK(F)),(P=r.abort)==null||P.call(r))},E=()=>{s=!0},v=()=>{s=!1},x=()=>lK.isFocused()&&(r.networkMode==="always"||$b.isOnline())&&r.canRun(),T=()=>dK(r.networkMode)&&r.canRun(),R=F=>{var P;c||(c=!0,(P=r.onSuccess)==null||P.call(r,F),h==null||h(),f.resolve(F))},N=F=>{var P;c||(c=!0,(P=r.onError)==null||P.call(r,F),h==null||h(),f.reject(F))},L=()=>new Promise(F=>{var P;h=M=>{(c||x())&&F(M)},(P=r.onPause)==null||P.call(r)}).then(()=>{var F;h=void 0,c||(F=r.onContinue)==null||F.call(r)}),j=()=>{if(c)return;let F;const P=a===0?r.initialPromise:void 0;try{F=P??r.fn()}catch(M){F=Promise.reject(M)}Promise.resolve(F).then(R).catch(M=>{var te;if(c)return;const U=r.retry??(NS?0:3),B=r.retryDelay??SEe,K=typeof B=="function"?B(a,M):B,J=U===!0||typeof U=="number"&&a<U||typeof U=="function"&&U(a,M);if(s||!J){N(M);return}a++,(te=r.onFail)==null||te.call(r,a,M),fEe(K).then(()=>x()?void 0:L()).then(()=>{s?N(M):j()})})};return{promise:f,cancel:_,continue:()=>(h==null||h(),f),cancelRetry:E,continueRetry:v,canStart:T,start:()=>(T()?j():L().then(j),f)}}var xEe=r=>setTimeout(r,0);function wEe(){let r=[],s=0,a=E=>{E()},c=E=>{E()},h=xEe;const f=E=>{s?r.push(E):h(()=>{a(E)})},_=()=>{const E=r;r=[],E.length&&h(()=>{c(()=>{E.forEach(v=>{a(v)})})})};return{batch:E=>{let v;s++;try{v=E()}finally{s--,s||_()}return v},batchCalls:E=>(...v)=>{f(()=>{E(...v)})},schedule:f,setNotifyFunction:E=>{a=E},setBatchNotifyFunction:E=>{c=E},setScheduler:E=>{h=E}}}var xi=wEe(),zu,pG,pK=(pG=class{constructor(){Gn(this,zu)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),hEe(this.gcTime)&&cn(this,zu,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??(NS?1/0:5*60*1e3))}clearGcTimeout(){$e(this,zu)&&(clearTimeout($e(this,zu)),cn(this,zu,void 0))}},zu=new WeakMap,pG),Sm,Yu,qo,qu,oi,Y0,Xu,Ma,el,mG,TEe=(mG=class extends pK{constructor(s){super();Gn(this,Ma);Gn(this,Sm);Gn(this,Yu);Gn(this,qo);Gn(this,qu);Gn(this,oi);Gn(this,Y0);Gn(this,Xu);cn(this,Xu,!1),cn(this,Y0,s.defaultOptions),this.setOptions(s.options),this.observers=[],cn(this,qu,s.client),cn(this,qo,$e(this,qu).getQueryCache()),this.queryKey=s.queryKey,this.queryHash=s.queryHash,cn(this,Sm,REe(this.options)),this.state=s.state??$e(this,Sm),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var s;return(s=$e(this,oi))==null?void 0:s.promise}setOptions(s){this.options={...$e(this,Y0),...s},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&$e(this,qo).remove(this)}setData(s,a){const c=gEe(this.state.data,s,this.options);return ri(this,Ma,el).call(this,{data:c,type:"success",dataUpdatedAt:a==null?void 0:a.updatedAt,manual:a==null?void 0:a.manual}),c}setState(s,a){ri(this,Ma,el).call(this,{type:"setState",state:s,setStateOptions:a})}cancel(s){var c,h;const a=(c=$e(this,oi))==null?void 0:c.promise;return(h=$e(this,oi))==null||h.cancel(s),a?a.then(La).catch(La):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState($e(this,Sm))}isActive(){return this.observers.some(s=>mEe(s.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===bO||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(s=>SA(s.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(s=>s.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(s=0){return this.state.data===void 0?!0:s==="static"?!1:this.state.isInvalidated?!0:!pEe(this.state.dataUpdatedAt,s)}onFocus(){var a;const s=this.observers.find(c=>c.shouldFetchOnWindowFocus());s==null||s.refetch({cancelRefetch:!1}),(a=$e(this,oi))==null||a.continue()}onOnline(){var a;const s=this.observers.find(c=>c.shouldFetchOnReconnect());s==null||s.refetch({cancelRefetch:!1}),(a=$e(this,oi))==null||a.continue()}addObserver(s){this.observers.includes(s)||(this.observers.push(s),this.clearGcTimeout(),$e(this,qo).notify({type:"observerAdded",query:this,observer:s}))}removeObserver(s){this.observers.includes(s)&&(this.observers=this.observers.filter(a=>a!==s),this.observers.length||($e(this,oi)&&($e(this,Xu)?$e(this,oi).cancel({revert:!0}):$e(this,oi).cancelRetry()),this.scheduleGc()),$e(this,qo).notify({type:"observerRemoved",query:this,observer:s}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ri(this,Ma,el).call(this,{type:"invalidate"})}fetch(s,a){var x,T,R;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(a!=null&&a.cancelRefetch))this.cancel({silent:!0});else if($e(this,oi))return $e(this,oi).continueRetry(),$e(this,oi).promise}if(s&&this.setOptions(s),!this.options.queryFn){const N=this.observers.find(L=>L.options.queryFn);N&&this.setOptions(N.options)}const c=new AbortController,h=N=>{Object.defineProperty(N,"signal",{enumerable:!0,get:()=>(cn(this,Xu,!0),c.signal)})},f=()=>{const N=cK(this.options,a),j=(()=>{const F={client:$e(this,qu),queryKey:this.queryKey,meta:this.meta};return h(F),F})();return cn(this,Xu,!1),this.options.persister?this.options.persister(N,j,this):N(j)},E=(()=>{const N={fetchOptions:a,options:this.options,queryKey:this.queryKey,client:$e(this,qu),state:this.state,fetchFn:f};return h(N),N})();(x=this.options.behavior)==null||x.onFetch(E,this),cn(this,Yu,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((T=E.fetchOptions)==null?void 0:T.meta))&&ri(this,Ma,el).call(this,{type:"fetch",meta:(R=E.fetchOptions)==null?void 0:R.meta});const v=N=>{var L,j,F,P;GN(N)&&N.silent||ri(this,Ma,el).call(this,{type:"error",error:N}),GN(N)||((j=(L=$e(this,qo).config).onError)==null||j.call(L,N,this),(P=(F=$e(this,qo).config).onSettled)==null||P.call(F,this.state.data,N,this)),this.scheduleGc()};return cn(this,oi,hK({initialPromise:a==null?void 0:a.initialPromise,fn:E.fetchFn,abort:c.abort.bind(c),onSuccess:N=>{var L,j,F,P;if(N===void 0){v(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(N)}catch(M){v(M);return}(j=(L=$e(this,qo).config).onSuccess)==null||j.call(L,N,this),(P=(F=$e(this,qo).config).onSettled)==null||P.call(F,N,this.state.error,this),this.scheduleGc()},onError:v,onFail:(N,L)=>{ri(this,Ma,el).call(this,{type:"failed",failureCount:N,error:L})},onPause:()=>{ri(this,Ma,el).call(this,{type:"pause"})},onContinue:()=>{ri(this,Ma,el).call(this,{type:"continue"})},retry:E.options.retry,retryDelay:E.options.retryDelay,networkMode:E.options.networkMode,canRun:()=>!0})),$e(this,oi).start()}},Sm=new WeakMap,Yu=new WeakMap,qo=new WeakMap,qu=new WeakMap,oi=new WeakMap,Y0=new WeakMap,Xu=new WeakMap,Ma=new WeakSet,el=function(s){const a=c=>{switch(s.type){case"failed":return{...c,fetchFailureCount:s.failureCount,fetchFailureReason:s.error};case"pause":return{...c,fetchStatus:"paused"};case"continue":return{...c,fetchStatus:"fetching"};case"fetch":return{...c,...CEe(c.data,this.options),fetchMeta:s.meta??null};case"success":return cn(this,Yu,void 0),{...c,data:s.data,dataUpdateCount:c.dataUpdateCount+1,dataUpdatedAt:s.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!s.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const h=s.error;return GN(h)&&h.revert&&$e(this,Yu)?{...$e(this,Yu),fetchStatus:"idle"}:{...c,error:h,errorUpdateCount:c.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:c.fetchFailureCount+1,fetchFailureReason:h,fetchStatus:"idle",status:"error"};case"invalidate":return{...c,isInvalidated:!0};case"setState":return{...c,...s.state}}};this.state=a(this.state),xi.batch(()=>{this.observers.forEach(c=>{c.onQueryUpdate()}),$e(this,qo).notify({query:this,type:"updated",action:s})})},mG);function CEe(r,s){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:dK(s.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function REe(r){const s=typeof r.initialData=="function"?r.initialData():r.initialData,a=s!==void 0,c=a?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:s,dataUpdateCount:0,dataUpdatedAt:a?c??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:a?"success":"pending",fetchStatus:"idle"}}var bc,fG,NEe=(fG=class extends RS{constructor(s={}){super();Gn(this,bc);this.config=s,cn(this,bc,new Map)}build(s,a,c){const h=a.queryKey,f=a.queryHash??vO(h,a);let _=this.get(f);return _||(_=new TEe({client:s,queryKey:h,queryHash:f,options:s.defaultQueryOptions(a),state:c,defaultOptions:s.getQueryDefaults(h)}),this.add(_)),_}add(s){$e(this,bc).has(s.queryHash)||($e(this,bc).set(s.queryHash,s),this.notify({type:"added",query:s}))}remove(s){const a=$e(this,bc).get(s.queryHash);a&&(s.destroy(),a===s&&$e(this,bc).delete(s.queryHash),this.notify({type:"removed",query:s}))}clear(){xi.batch(()=>{this.getAll().forEach(s=>{this.remove(s)})})}get(s){return $e(this,bc).get(s)}getAll(){return[...$e(this,bc).values()]}find(s){const a={exact:!0,...s};return this.getAll().find(c=>E$(a,c))}findAll(s={}){const a=this.getAll();return Object.keys(s).length>0?a.filter(c=>E$(s,c)):a}notify(s){xi.batch(()=>{this.listeners.forEach(a=>{a(s)})})}onFocus(){xi.batch(()=>{this.getAll().forEach(s=>{s.onFocus()})})}onOnline(){xi.batch(()=>{this.getAll().forEach(s=>{s.onOnline()})})}},bc=new WeakMap,fG),Sc,bi,Ju,xc,nd,gG,AEe=(gG=class extends pK{constructor(s){super();Gn(this,xc);Gn(this,Sc);Gn(this,bi);Gn(this,Ju);this.mutationId=s.mutationId,cn(this,bi,s.mutationCache),cn(this,Sc,[]),this.state=s.state||IEe(),this.setOptions(s.options),this.scheduleGc()}setOptions(s){this.options=s,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(s){$e(this,Sc).includes(s)||($e(this,Sc).push(s),this.clearGcTimeout(),$e(this,bi).notify({type:"observerAdded",mutation:this,observer:s}))}removeObserver(s){cn(this,Sc,$e(this,Sc).filter(a=>a!==s)),this.scheduleGc(),$e(this,bi).notify({type:"observerRemoved",mutation:this,observer:s})}optionalRemove(){$e(this,Sc).length||(this.state.status==="pending"?this.scheduleGc():$e(this,bi).remove(this))}continue(){var s;return((s=$e(this,Ju))==null?void 0:s.continue())??this.execute(this.state.variables)}async execute(s){var f,_,E,v,x,T,R,N,L,j,F,P,M,U,B,K,J,te,se,ie;const a=()=>{ri(this,xc,nd).call(this,{type:"continue"})};cn(this,Ju,hK({fn:()=>this.options.mutationFn?this.options.mutationFn(s):Promise.reject(new Error("No mutationFn found")),onFail:(ue,de)=>{ri(this,xc,nd).call(this,{type:"failed",failureCount:ue,error:de})},onPause:()=>{ri(this,xc,nd).call(this,{type:"pause"})},onContinue:a,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>$e(this,bi).canRun(this)}));const c=this.state.status==="pending",h=!$e(this,Ju).canStart();try{if(c)a();else{ri(this,xc,nd).call(this,{type:"pending",variables:s,isPaused:h}),await((_=(f=$e(this,bi).config).onMutate)==null?void 0:_.call(f,s,this));const de=await((v=(E=this.options).onMutate)==null?void 0:v.call(E,s));de!==this.state.context&&ri(this,xc,nd).call(this,{type:"pending",context:de,variables:s,isPaused:h})}const ue=await $e(this,Ju).start();return await((T=(x=$e(this,bi).config).onSuccess)==null?void 0:T.call(x,ue,s,this.state.context,this)),await((N=(R=this.options).onSuccess)==null?void 0:N.call(R,ue,s,this.state.context)),await((j=(L=$e(this,bi).config).onSettled)==null?void 0:j.call(L,ue,null,this.state.variables,this.state.context,this)),await((P=(F=this.options).onSettled)==null?void 0:P.call(F,ue,null,s,this.state.context)),ri(this,xc,nd).call(this,{type:"success",data:ue}),ue}catch(ue){try{throw await((U=(M=$e(this,bi).config).onError)==null?void 0:U.call(M,ue,s,this.state.context,this)),await((K=(B=this.options).onError)==null?void 0:K.call(B,ue,s,this.state.context)),await((te=(J=$e(this,bi).config).onSettled)==null?void 0:te.call(J,void 0,ue,this.state.variables,this.state.context,this)),await((ie=(se=this.options).onSettled)==null?void 0:ie.call(se,void 0,ue,s,this.state.context)),ue}finally{ri(this,xc,nd).call(this,{type:"error",error:ue})}}finally{$e(this,bi).runNext(this)}}},Sc=new WeakMap,bi=new WeakMap,Ju=new WeakMap,xc=new WeakSet,nd=function(s){const a=c=>{switch(s.type){case"failed":return{...c,failureCount:s.failureCount,failureReason:s.error};case"pause":return{...c,isPaused:!0};case"continue":return{...c,isPaused:!1};case"pending":return{...c,context:s.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:s.isPaused,status:"pending",variables:s.variables,submittedAt:Date.now()};case"success":return{...c,data:s.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...c,data:void 0,error:s.error,failureCount:c.failureCount+1,failureReason:s.error,isPaused:!1,status:"error"}}};this.state=a(this.state),xi.batch(()=>{$e(this,Sc).forEach(c=>{c.onMutationUpdate(s)}),$e(this,bi).notify({mutation:this,type:"updated",action:s})})},gG);function IEe(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var rl,ja,q0,_G,OEe=(_G=class extends RS{constructor(s={}){super();Gn(this,rl);Gn(this,ja);Gn(this,q0);this.config=s,cn(this,rl,new Set),cn(this,ja,new Map),cn(this,q0,0)}build(s,a,c){const h=new AEe({mutationCache:this,mutationId:++av(this,q0)._,options:s.defaultMutationOptions(a),state:c});return this.add(h),h}add(s){$e(this,rl).add(s);const a=Iv(s);if(typeof a=="string"){const c=$e(this,ja).get(a);c?c.push(s):$e(this,ja).set(a,[s])}this.notify({type:"added",mutation:s})}remove(s){if($e(this,rl).delete(s)){const a=Iv(s);if(typeof a=="string"){const c=$e(this,ja).get(a);if(c)if(c.length>1){const h=c.indexOf(s);h!==-1&&c.splice(h,1)}else c[0]===s&&$e(this,ja).delete(a)}}this.notify({type:"removed",mutation:s})}canRun(s){const a=Iv(s);if(typeof a=="string"){const c=$e(this,ja).get(a),h=c==null?void 0:c.find(f=>f.state.status==="pending");return!h||h===s}else return!0}runNext(s){var c;const a=Iv(s);if(typeof a=="string"){const h=(c=$e(this,ja).get(a))==null?void 0:c.find(f=>f!==s&&f.state.isPaused);return(h==null?void 0:h.continue())??Promise.resolve()}else return Promise.resolve()}clear(){xi.batch(()=>{$e(this,rl).forEach(s=>{this.notify({type:"removed",mutation:s})}),$e(this,rl).clear(),$e(this,ja).clear()})}getAll(){return Array.from($e(this,rl))}find(s){const a={exact:!0,...s};return this.getAll().find(c=>v$(a,c))}findAll(s={}){return this.getAll().filter(a=>v$(s,a))}notify(s){xi.batch(()=>{this.listeners.forEach(a=>{a(s)})})}resumePausedMutations(){const s=this.getAll().filter(a=>a.state.isPaused);return xi.batch(()=>Promise.all(s.map(a=>a.continue().catch(La))))}},rl=new WeakMap,ja=new WeakMap,q0=new WeakMap,_G);function Iv(r){var s;return(s=r.options.scope)==null?void 0:s.id}function x$(r){return{onFetch:(s,a)=>{var T,R,N,L,j;const c=s.options,h=(N=(R=(T=s.fetchOptions)==null?void 0:T.meta)==null?void 0:R.fetchMore)==null?void 0:N.direction,f=((L=s.state.data)==null?void 0:L.pages)||[],_=((j=s.state.data)==null?void 0:j.pageParams)||[];let E={pages:[],pageParams:[]},v=0;const x=async()=>{let F=!1;const P=B=>{Object.defineProperty(B,"signal",{enumerable:!0,get:()=>(s.signal.aborted?F=!0:s.signal.addEventListener("abort",()=>{F=!0}),s.signal)})},M=cK(s.options,s.fetchOptions),U=async(B,K,J)=>{if(F)return Promise.reject();if(K==null&&B.pages.length)return Promise.resolve(B);const se=(()=>{const Ne={client:s.client,queryKey:s.queryKey,pageParam:K,direction:J?"backward":"forward",meta:s.options.meta};return P(Ne),Ne})(),ie=await M(se),{maxPages:ue}=s.options,de=J?yEe:_Ee;return{pages:de(B.pages,ie,ue),pageParams:de(B.pageParams,K,ue)}};if(h&&f.length){const B=h==="backward",K=B?PEe:w$,J={pages:f,pageParams:_},te=K(c,J);E=await U(J,te,B)}else{const B=r??f.length;do{const K=v===0?_[0]??c.initialPageParam:w$(c,E);if(v>0&&K==null)break;E=await U(E,K),v++}while(v<B)}return E};s.options.persister?s.fetchFn=()=>{var F,P;return(P=(F=s.options).persister)==null?void 0:P.call(F,x,{client:s.client,queryKey:s.queryKey,meta:s.options.meta,signal:s.signal},a)}:s.fetchFn=x}}}function w$(r,{pages:s,pageParams:a}){const c=s.length-1;return s.length>0?r.getNextPageParam(s[c],s,a[c],a):void 0}function PEe(r,{pages:s,pageParams:a}){var c;return s.length>0?(c=r.getPreviousPageParam)==null?void 0:c.call(r,s[0],s,a[0],a):void 0}var Qr,dd,ud,xm,wm,hd,Tm,Cm,yG,DEe=(yG=class{constructor(r={}){Gn(this,Qr);Gn(this,dd);Gn(this,ud);Gn(this,xm);Gn(this,wm);Gn(this,hd);Gn(this,Tm);Gn(this,Cm);cn(this,Qr,r.queryCache||new NEe),cn(this,dd,r.mutationCache||new OEe),cn(this,ud,r.defaultOptions||{}),cn(this,xm,new Map),cn(this,wm,new Map),cn(this,hd,0)}mount(){av(this,hd)._++,$e(this,hd)===1&&(cn(this,Tm,lK.subscribe(async r=>{r&&(await this.resumePausedMutations(),$e(this,Qr).onFocus())})),cn(this,Cm,$b.subscribe(async r=>{r&&(await this.resumePausedMutations(),$e(this,Qr).onOnline())})))}unmount(){var r,s;av(this,hd)._--,$e(this,hd)===0&&((r=$e(this,Tm))==null||r.call(this),cn(this,Tm,void 0),(s=$e(this,Cm))==null||s.call(this),cn(this,Cm,void 0))}isFetching(r){return $e(this,Qr).findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return $e(this,dd).findAll({...r,status:"pending"}).length}getQueryData(r){var a;const s=this.defaultQueryOptions({queryKey:r});return(a=$e(this,Qr).get(s.queryHash))==null?void 0:a.state.data}ensureQueryData(r){const s=this.defaultQueryOptions(r),a=$e(this,Qr).build(this,s),c=a.state.data;return c===void 0?this.fetchQuery(r):(r.revalidateIfStale&&a.isStaleByTime(SA(s.staleTime,a))&&this.prefetchQuery(s),Promise.resolve(c))}getQueriesData(r){return $e(this,Qr).findAll(r).map(({queryKey:s,state:a})=>{const c=a.data;return[s,c]})}setQueryData(r,s,a){const c=this.defaultQueryOptions({queryKey:r}),h=$e(this,Qr).get(c.queryHash),f=h==null?void 0:h.state.data,_=uEe(s,f);if(_!==void 0)return $e(this,Qr).build(this,c).setData(_,{...a,manual:!0})}setQueriesData(r,s,a){return xi.batch(()=>$e(this,Qr).findAll(r).map(({queryKey:c})=>[c,this.setQueryData(c,s,a)]))}getQueryState(r){var a;const s=this.defaultQueryOptions({queryKey:r});return(a=$e(this,Qr).get(s.queryHash))==null?void 0:a.state}removeQueries(r){const s=$e(this,Qr);xi.batch(()=>{s.findAll(r).forEach(a=>{s.remove(a)})})}resetQueries(r,s){const a=$e(this,Qr);return xi.batch(()=>(a.findAll(r).forEach(c=>{c.reset()}),this.refetchQueries({type:"active",...r},s)))}cancelQueries(r,s={}){const a={revert:!0,...s},c=xi.batch(()=>$e(this,Qr).findAll(r).map(h=>h.cancel(a)));return Promise.all(c).then(La).catch(La)}invalidateQueries(r,s={}){return xi.batch(()=>($e(this,Qr).findAll(r).forEach(a=>{a.invalidate()}),(r==null?void 0:r.refetchType)==="none"?Promise.resolve():this.refetchQueries({...r,type:(r==null?void 0:r.refetchType)??(r==null?void 0:r.type)??"active"},s)))}refetchQueries(r,s={}){const a={...s,cancelRefetch:s.cancelRefetch??!0},c=xi.batch(()=>$e(this,Qr).findAll(r).filter(h=>!h.isDisabled()&&!h.isStatic()).map(h=>{let f=h.fetch(void 0,a);return a.throwOnError||(f=f.catch(La)),h.state.fetchStatus==="paused"?Promise.resolve():f}));return Promise.all(c).then(La)}fetchQuery(r){const s=this.defaultQueryOptions(r);s.retry===void 0&&(s.retry=!1);const a=$e(this,Qr).build(this,s);return a.isStaleByTime(SA(s.staleTime,a))?a.fetch(s):Promise.resolve(a.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(La).catch(La)}fetchInfiniteQuery(r){return r.behavior=x$(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(La).catch(La)}ensureInfiniteQueryData(r){return r.behavior=x$(r.pages),this.ensureQueryData(r)}resumePausedMutations(){return $b.isOnline()?$e(this,dd).resumePausedMutations():Promise.resolve()}getQueryCache(){return $e(this,Qr)}getMutationCache(){return $e(this,dd)}getDefaultOptions(){return $e(this,ud)}setDefaultOptions(r){cn(this,ud,r)}setQueryDefaults(r,s){$e(this,xm).set(k0(r),{queryKey:r,defaultOptions:s})}getQueryDefaults(r){const s=[...$e(this,xm).values()],a={};return s.forEach(c=>{L0(r,c.queryKey)&&Object.assign(a,c.defaultOptions)}),a}setMutationDefaults(r,s){$e(this,wm).set(k0(r),{mutationKey:r,defaultOptions:s})}getMutationDefaults(r){const s=[...$e(this,wm).values()],a={};return s.forEach(c=>{L0(r,c.mutationKey)&&Object.assign(a,c.defaultOptions)}),a}defaultQueryOptions(r){if(r._defaulted)return r;const s={...$e(this,ud).queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:!0};return s.queryHash||(s.queryHash=vO(s.queryKey,s)),s.refetchOnReconnect===void 0&&(s.refetchOnReconnect=s.networkMode!=="always"),s.throwOnError===void 0&&(s.throwOnError=!!s.suspense),!s.networkMode&&s.persister&&(s.networkMode="offlineFirst"),s.queryFn===bO&&(s.enabled=!1),s}defaultMutationOptions(r){return r!=null&&r._defaulted?r:{...$e(this,ud).mutations,...(r==null?void 0:r.mutationKey)&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:!0}}clear(){$e(this,Qr).clear(),$e(this,dd).clear()}},Qr=new WeakMap,dd=new WeakMap,ud=new WeakMap,xm=new WeakMap,wm=new WeakMap,hd=new WeakMap,Tm=new WeakMap,Cm=new WeakMap,yG),kEe=V.createContext(void 0),LEe=({client:r,children:s})=>(V.useEffect(()=>(r.mount(),()=>{r.unmount()}),[r]),d.jsx(kEe.Provider,{value:r,children:s}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function M0(){return M0=Object.assign?Object.assign.bind():function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(r[c]=a[c])}return r},M0.apply(this,arguments)}var fd;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(fd||(fd={}));const T$="popstate";function MEe(r){r===void 0&&(r={});function s(c,h){let{pathname:f,search:_,hash:E}=c.location;return wA("",{pathname:f,search:_,hash:E},h.state&&h.state.usr||null,h.state&&h.state.key||"default")}function a(c,h){return typeof h=="string"?h:Wb(h)}return UEe(s,a,null,r)}function fs(r,s){if(r===!1||r===null||typeof r>"u")throw new Error(s)}function mK(r,s){if(!r){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function jEe(){return Math.random().toString(36).substr(2,8)}function C$(r,s){return{usr:r.state,key:r.key,idx:s}}function wA(r,s,a,c){return a===void 0&&(a=null),M0({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof s=="string"?zm(s):s,{state:a,key:s&&s.key||c||jEe()})}function Wb(r){let{pathname:s="/",search:a="",hash:c=""}=r;return a&&a!=="?"&&(s+=a.charAt(0)==="?"?a:"?"+a),c&&c!=="#"&&(s+=c.charAt(0)==="#"?c:"#"+c),s}function zm(r){let s={};if(r){let a=r.indexOf("#");a>=0&&(s.hash=r.substr(a),r=r.substr(0,a));let c=r.indexOf("?");c>=0&&(s.search=r.substr(c),r=r.substr(0,c)),r&&(s.pathname=r)}return s}function UEe(r,s,a,c){c===void 0&&(c={});let{window:h=document.defaultView,v5Compat:f=!1}=c,_=h.history,E=fd.Pop,v=null,x=T();x==null&&(x=0,_.replaceState(M0({},_.state,{idx:x}),""));function T(){return(_.state||{idx:null}).idx}function R(){E=fd.Pop;let P=T(),M=P==null?null:P-x;x=P,v&&v({action:E,location:F.location,delta:M})}function N(P,M){E=fd.Push;let U=wA(F.location,P,M);x=T()+1;let B=C$(U,x),K=F.createHref(U);try{_.pushState(B,"",K)}catch(J){if(J instanceof DOMException&&J.name==="DataCloneError")throw J;h.location.assign(K)}f&&v&&v({action:E,location:F.location,delta:1})}function L(P,M){E=fd.Replace;let U=wA(F.location,P,M);x=T();let B=C$(U,x),K=F.createHref(U);_.replaceState(B,"",K),f&&v&&v({action:E,location:F.location,delta:0})}function j(P){let M=h.location.origin!=="null"?h.location.origin:h.location.href,U=typeof P=="string"?P:Wb(P);return U=U.replace(/ $/,"%20"),fs(M,"No window.location.(origin|href) available to create URL for href: "+U),new URL(U,M)}let F={get action(){return E},get location(){return r(h,_)},listen(P){if(v)throw new Error("A history only accepts one active listener");return h.addEventListener(T$,R),v=P,()=>{h.removeEventListener(T$,R),v=null}},createHref(P){return s(h,P)},createURL:j,encodeLocation(P){let M=j(P);return{pathname:M.pathname,search:M.search,hash:M.hash}},push:N,replace:L,go(P){return _.go(P)}};return F}var R$;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(R$||(R$={}));function VEe(r,s,a){return a===void 0&&(a="/"),FEe(r,s,a,!1)}function FEe(r,s,a,c){let h=typeof s=="string"?zm(s):s,f=SO(h.pathname||"/",a);if(f==null)return null;let _=fK(r);BEe(_);let E=null;for(let v=0;E==null&&v<_.length;++v){let x=QEe(f);E=XEe(_[v],x,c)}return E}function fK(r,s,a,c){s===void 0&&(s=[]),a===void 0&&(a=[]),c===void 0&&(c="");let h=(f,_,E)=>{let v={relativePath:E===void 0?f.path||"":E,caseSensitive:f.caseSensitive===!0,childrenIndex:_,route:f};v.relativePath.startsWith("/")&&(fs(v.relativePath.startsWith(c),'Absolute route path "'+v.relativePath+'" nested under path '+('"'+c+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),v.relativePath=v.relativePath.slice(c.length));let x=Td([c,v.relativePath]),T=a.concat(v);f.children&&f.children.length>0&&(fs(f.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+x+'".')),fK(f.children,s,T,x)),!(f.path==null&&!f.index)&&s.push({path:x,score:YEe(x,f.index),routesMeta:T})};return r.forEach((f,_)=>{var E;if(f.path===""||!((E=f.path)!=null&&E.includes("?")))h(f,_);else for(let v of gK(f.path))h(f,_,v)}),s}function gK(r){let s=r.split("/");if(s.length===0)return[];let[a,...c]=s,h=a.endsWith("?"),f=a.replace(/\?$/,"");if(c.length===0)return h?[f,""]:[f];let _=gK(c.join("/")),E=[];return E.push(..._.map(v=>v===""?f:[f,v].join("/"))),h&&E.push(..._),E.map(v=>r.startsWith("/")&&v===""?"/":v)}function BEe(r){r.sort((s,a)=>s.score!==a.score?a.score-s.score:qEe(s.routesMeta.map(c=>c.childrenIndex),a.routesMeta.map(c=>c.childrenIndex)))}const $Ee=/^:[\w-]+$/,WEe=3,GEe=2,HEe=1,KEe=10,zEe=-2,N$=r=>r==="*";function YEe(r,s){let a=r.split("/"),c=a.length;return a.some(N$)&&(c+=zEe),s&&(c+=GEe),a.filter(h=>!N$(h)).reduce((h,f)=>h+($Ee.test(f)?WEe:f===""?HEe:KEe),c)}function qEe(r,s){return r.length===s.length&&r.slice(0,-1).every((c,h)=>c===s[h])?r[r.length-1]-s[s.length-1]:0}function XEe(r,s,a){let{routesMeta:c}=r,h={},f="/",_=[];for(let E=0;E<c.length;++E){let v=c[E],x=E===c.length-1,T=f==="/"?s:s.slice(f.length)||"/",R=A$({path:v.relativePath,caseSensitive:v.caseSensitive,end:x},T),N=v.route;if(!R&&x&&a&&!c[c.length-1].route.index&&(R=A$({path:v.relativePath,caseSensitive:v.caseSensitive,end:!1},T)),!R)return null;Object.assign(h,R.params),_.push({params:h,pathname:Td([f,R.pathname]),pathnameBase:nve(Td([f,R.pathnameBase])),route:N}),R.pathnameBase!=="/"&&(f=Td([f,R.pathnameBase]))}return _}function A$(r,s){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[a,c]=JEe(r.path,r.caseSensitive,r.end),h=s.match(a);if(!h)return null;let f=h[0],_=f.replace(/(.)\/+$/,"$1"),E=h.slice(1);return{params:c.reduce((x,T,R)=>{let{paramName:N,isOptional:L}=T;if(N==="*"){let F=E[R]||"";_=f.slice(0,f.length-F.length).replace(/(.)\/+$/,"$1")}const j=E[R];return L&&!j?x[N]=void 0:x[N]=(j||"").replace(/%2F/g,"/"),x},{}),pathname:f,pathnameBase:_,pattern:r}}function JEe(r,s,a){s===void 0&&(s=!1),a===void 0&&(a=!0),mK(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let c=[],h="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(_,E,v)=>(c.push({paramName:E,isOptional:v!=null}),v?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(c.push({paramName:"*"}),h+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?h+="\\/*$":r!==""&&r!=="/"&&(h+="(?:(?=\\/|$))"),[new RegExp(h,s?void 0:"i"),c]}function QEe(r){try{return r.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return mK(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),r}}function SO(r,s){if(s==="/")return r;if(!r.toLowerCase().startsWith(s.toLowerCase()))return null;let a=s.endsWith("/")?s.length-1:s.length,c=r.charAt(a);return c&&c!=="/"?null:r.slice(a)||"/"}function ZEe(r,s){s===void 0&&(s="/");let{pathname:a,search:c="",hash:h=""}=typeof r=="string"?zm(r):r;return{pathname:a?a.startsWith("/")?a:eve(a,s):s,search:rve(c),hash:sve(h)}}function eve(r,s){let a=s.replace(/\/+$/,"").split("/");return r.split("/").forEach(h=>{h===".."?a.length>1&&a.pop():h!=="."&&a.push(h)}),a.length>1?a.join("/"):"/"}function HN(r,s,a,c){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(c)+"].  Please separate it out to the ")+("`to."+a+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function tve(r){return r.filter((s,a)=>a===0||s.route.path&&s.route.path.length>0)}function _K(r,s){let a=tve(r);return s?a.map((c,h)=>h===a.length-1?c.pathname:c.pathnameBase):a.map(c=>c.pathnameBase)}function yK(r,s,a,c){c===void 0&&(c=!1);let h;typeof r=="string"?h=zm(r):(h=M0({},r),fs(!h.pathname||!h.pathname.includes("?"),HN("?","pathname","search",h)),fs(!h.pathname||!h.pathname.includes("#"),HN("#","pathname","hash",h)),fs(!h.search||!h.search.includes("#"),HN("#","search","hash",h)));let f=r===""||h.pathname==="",_=f?"/":h.pathname,E;if(_==null)E=a;else{let R=s.length-1;if(!c&&_.startsWith("..")){let N=_.split("/");for(;N[0]==="..";)N.shift(),R-=1;h.pathname=N.join("/")}E=R>=0?s[R]:"/"}let v=ZEe(h,E),x=_&&_!=="/"&&_.endsWith("/"),T=(f||_===".")&&a.endsWith("/");return!v.pathname.endsWith("/")&&(x||T)&&(v.pathname+="/"),v}const Td=r=>r.join("/").replace(/\/\/+/g,"/"),nve=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),rve=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,sve=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function ive(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const EK=["post","put","patch","delete"];new Set(EK);const ove=["get",...EK];new Set(ove);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function j0(){return j0=Object.assign?Object.assign.bind():function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(r[c]=a[c])}return r},j0.apply(this,arguments)}const xO=V.createContext(null),ave=V.createContext(null),_h=V.createContext(null),AS=V.createContext(null),yh=V.createContext({outlet:null,matches:[],isDataRoute:!1}),vK=V.createContext(null);function cve(r,s){let{relative:a}=s===void 0?{}:s;i_()||fs(!1);let{basename:c,navigator:h}=V.useContext(_h),{hash:f,pathname:_,search:E}=SK(r,{relative:a}),v=_;return c!=="/"&&(v=_==="/"?c:Td([c,_])),h.createHref({pathname:v,search:E,hash:f})}function i_(){return V.useContext(AS)!=null}function Eh(){return i_()||fs(!1),V.useContext(AS).location}function bK(r){V.useContext(_h).static||V.useLayoutEffect(r)}function vh(){let{isDataRoute:r}=V.useContext(yh);return r?bve():lve()}function lve(){i_()||fs(!1);let r=V.useContext(xO),{basename:s,future:a,navigator:c}=V.useContext(_h),{matches:h}=V.useContext(yh),{pathname:f}=Eh(),_=JSON.stringify(_K(h,a.v7_relativeSplatPath)),E=V.useRef(!1);return bK(()=>{E.current=!0}),V.useCallback(function(x,T){if(T===void 0&&(T={}),!E.current)return;if(typeof x=="number"){c.go(x);return}let R=yK(x,JSON.parse(_),f,T.relative==="path");r==null&&s!=="/"&&(R.pathname=R.pathname==="/"?s:Td([s,R.pathname])),(T.replace?c.replace:c.push)(R,T.state,T)},[s,c,_,f,r])}function SK(r,s){let{relative:a}=s===void 0?{}:s,{future:c}=V.useContext(_h),{matches:h}=V.useContext(yh),{pathname:f}=Eh(),_=JSON.stringify(_K(h,c.v7_relativeSplatPath));return V.useMemo(()=>yK(r,JSON.parse(_),f,a==="path"),[r,_,f,a])}function dve(r,s){return uve(r,s)}function uve(r,s,a,c){i_()||fs(!1);let{navigator:h}=V.useContext(_h),{matches:f}=V.useContext(yh),_=f[f.length-1],E=_?_.params:{};_&&_.pathname;let v=_?_.pathnameBase:"/";_&&_.route;let x=Eh(),T;if(s){var R;let P=typeof s=="string"?zm(s):s;v==="/"||(R=P.pathname)!=null&&R.startsWith(v)||fs(!1),T=P}else T=x;let N=T.pathname||"/",L=N;if(v!=="/"){let P=v.replace(/^\//,"").split("/");L="/"+N.replace(/^\//,"").split("/").slice(P.length).join("/")}let j=VEe(r,{pathname:L}),F=gve(j&&j.map(P=>Object.assign({},P,{params:Object.assign({},E,P.params),pathname:Td([v,h.encodeLocation?h.encodeLocation(P.pathname).pathname:P.pathname]),pathnameBase:P.pathnameBase==="/"?v:Td([v,h.encodeLocation?h.encodeLocation(P.pathnameBase).pathname:P.pathnameBase])})),f,a,c);return s&&F?V.createElement(AS.Provider,{value:{location:j0({pathname:"/",search:"",hash:"",state:null,key:"default"},T),navigationType:fd.Pop}},F):F}function hve(){let r=vve(),s=ive(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),a=r instanceof Error?r.stack:null,h={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return V.createElement(V.Fragment,null,V.createElement("h2",null,"Unexpected Application Error!"),V.createElement("h3",{style:{fontStyle:"italic"}},s),a?V.createElement("pre",{style:h},a):null,null)}const pve=V.createElement(hve,null);class mve extends V.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,a){return a.location!==s.location||a.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:a.error,location:a.location,revalidation:s.revalidation||a.revalidation}}componentDidCatch(s,a){console.error("React Router caught the following error during render",s,a)}render(){return this.state.error!==void 0?V.createElement(yh.Provider,{value:this.props.routeContext},V.createElement(vK.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function fve(r){let{routeContext:s,match:a,children:c}=r,h=V.useContext(xO);return h&&h.static&&h.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(h.staticContext._deepestRenderedBoundaryId=a.route.id),V.createElement(yh.Provider,{value:s},c)}function gve(r,s,a,c){var h;if(s===void 0&&(s=[]),a===void 0&&(a=null),c===void 0&&(c=null),r==null){var f;if(!a)return null;if(a.errors)r=a.matches;else if((f=c)!=null&&f.v7_partialHydration&&s.length===0&&!a.initialized&&a.matches.length>0)r=a.matches;else return null}let _=r,E=(h=a)==null?void 0:h.errors;if(E!=null){let T=_.findIndex(R=>R.route.id&&(E==null?void 0:E[R.route.id])!==void 0);T>=0||fs(!1),_=_.slice(0,Math.min(_.length,T+1))}let v=!1,x=-1;if(a&&c&&c.v7_partialHydration)for(let T=0;T<_.length;T++){let R=_[T];if((R.route.HydrateFallback||R.route.hydrateFallbackElement)&&(x=T),R.route.id){let{loaderData:N,errors:L}=a,j=R.route.loader&&N[R.route.id]===void 0&&(!L||L[R.route.id]===void 0);if(R.route.lazy||j){v=!0,x>=0?_=_.slice(0,x+1):_=[_[0]];break}}}return _.reduceRight((T,R,N)=>{let L,j=!1,F=null,P=null;a&&(L=E&&R.route.id?E[R.route.id]:void 0,F=R.route.errorElement||pve,v&&(x<0&&N===0?(j=!0,P=null):x===N&&(j=!0,P=R.route.hydrateFallbackElement||null)));let M=s.concat(_.slice(0,N+1)),U=()=>{let B;return L?B=F:j?B=P:R.route.Component?B=V.createElement(R.route.Component,null):R.route.element?B=R.route.element:B=T,V.createElement(fve,{match:R,routeContext:{outlet:T,matches:M,isDataRoute:a!=null},children:B})};return a&&(R.route.ErrorBoundary||R.route.errorElement||N===0)?V.createElement(mve,{location:a.location,revalidation:a.revalidation,component:F,error:L,children:U(),routeContext:{outlet:null,matches:M,isDataRoute:!0}}):U()},null)}var xK=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(xK||{}),Gb=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(Gb||{});function _ve(r){let s=V.useContext(xO);return s||fs(!1),s}function yve(r){let s=V.useContext(ave);return s||fs(!1),s}function Eve(r){let s=V.useContext(yh);return s||fs(!1),s}function wK(r){let s=Eve(),a=s.matches[s.matches.length-1];return a.route.id||fs(!1),a.route.id}function vve(){var r;let s=V.useContext(vK),a=yve(Gb.UseRouteError),c=wK(Gb.UseRouteError);return s!==void 0?s:(r=a.errors)==null?void 0:r[c]}function bve(){let{router:r}=_ve(xK.UseNavigateStable),s=wK(Gb.UseNavigateStable),a=V.useRef(!1);return bK(()=>{a.current=!0}),V.useCallback(function(h,f){f===void 0&&(f={}),a.current&&(typeof h=="number"?r.navigate(h):r.navigate(h,j0({fromRouteId:s},f)))},[r,s])}function Sve(r,s){r==null||r.v7_startTransition,r==null||r.v7_relativeSplatPath}function Gs(r){fs(!1)}function xve(r){let{basename:s="/",children:a=null,location:c,navigationType:h=fd.Pop,navigator:f,static:_=!1,future:E}=r;i_()&&fs(!1);let v=s.replace(/^\/*/,"/"),x=V.useMemo(()=>({basename:v,navigator:f,static:_,future:j0({v7_relativeSplatPath:!1},E)}),[v,E,f,_]);typeof c=="string"&&(c=zm(c));let{pathname:T="/",search:R="",hash:N="",state:L=null,key:j="default"}=c,F=V.useMemo(()=>{let P=SO(T,v);return P==null?null:{location:{pathname:P,search:R,hash:N,state:L,key:j},navigationType:h}},[v,T,R,N,L,j,h]);return F==null?null:V.createElement(_h.Provider,{value:x},V.createElement(AS.Provider,{children:a,value:F}))}function wve(r){let{children:s,location:a}=r;return dve(TA(s),a)}new Promise(()=>{});function TA(r,s){s===void 0&&(s=[]);let a=[];return V.Children.forEach(r,(c,h)=>{if(!V.isValidElement(c))return;let f=[...s,h];if(c.type===V.Fragment){a.push.apply(a,TA(c.props.children,f));return}c.type!==Gs&&fs(!1),!c.props.index||!c.props.children||fs(!1);let _={id:c.props.id||f.join("-"),caseSensitive:c.props.caseSensitive,element:c.props.element,Component:c.props.Component,index:c.props.index,path:c.props.path,loader:c.props.loader,action:c.props.action,errorElement:c.props.errorElement,ErrorBoundary:c.props.ErrorBoundary,hasErrorBoundary:c.props.ErrorBoundary!=null||c.props.errorElement!=null,shouldRevalidate:c.props.shouldRevalidate,handle:c.props.handle,lazy:c.props.lazy};c.props.children&&(_.children=TA(c.props.children,f)),a.push(_)}),a}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function CA(){return CA=Object.assign?Object.assign.bind():function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(r[c]=a[c])}return r},CA.apply(this,arguments)}function Tve(r,s){if(r==null)return{};var a={},c=Object.keys(r),h,f;for(f=0;f<c.length;f++)h=c[f],!(s.indexOf(h)>=0)&&(a[h]=r[h]);return a}function Cve(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function Rve(r,s){return r.button===0&&(!s||s==="_self")&&!Cve(r)}const Nve=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Ave="6";try{window.__reactRouterVersion=Ave}catch{}const Ive="startTransition",I$=AG[Ive];function Ove(r){let{basename:s,children:a,future:c,window:h}=r,f=V.useRef();f.current==null&&(f.current=MEe({window:h,v5Compat:!0}));let _=f.current,[E,v]=V.useState({action:_.action,location:_.location}),{v7_startTransition:x}=c||{},T=V.useCallback(R=>{x&&I$?I$(()=>v(R)):v(R)},[v,x]);return V.useLayoutEffect(()=>_.listen(T),[_,T]),V.useEffect(()=>Sve(c),[c]),V.createElement(xve,{basename:s,children:a,location:E.location,navigationType:E.action,navigator:_,future:c})}const Pve=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Dve=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Fn=V.forwardRef(function(s,a){let{onClick:c,relative:h,reloadDocument:f,replace:_,state:E,target:v,to:x,preventScrollReset:T,viewTransition:R}=s,N=Tve(s,Nve),{basename:L}=V.useContext(_h),j,F=!1;if(typeof x=="string"&&Dve.test(x)&&(j=x,Pve))try{let B=new URL(window.location.href),K=x.startsWith("//")?new URL(B.protocol+x):new URL(x),J=SO(K.pathname,L);K.origin===B.origin&&J!=null?x=J+K.search+K.hash:F=!0}catch{}let P=cve(x,{relative:h}),M=kve(x,{replace:_,state:E,target:v,preventScrollReset:T,relative:h,viewTransition:R});function U(B){c&&c(B),B.defaultPrevented||M(B)}return V.createElement("a",CA({},N,{href:j||P,onClick:F||f?c:U,ref:a,target:v}))});var O$;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(O$||(O$={}));var P$;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(P$||(P$={}));function kve(r,s){let{target:a,replace:c,state:h,preventScrollReset:f,relative:_,viewTransition:E}=s===void 0?{}:s,v=vh(),x=Eh(),T=SK(r,{relative:_});return V.useCallback(R=>{if(Rve(R,a)){R.preventDefault();let N=c!==void 0?c:Wb(x)===Wb(T);v(r,{replace:N,state:h,preventScrollReset:f,relative:_,viewTransition:E})}},[x,v,T,c,h,a,r,f,_,E])}const Lve=cH("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),qn=V.forwardRef(({className:r,variant:s,size:a,asChild:c=!1,...h},f)=>{const _=c?Nfe:"button";return d.jsx(_,{className:Xs(Lve({variant:s,size:a,className:r})),ref:f,...h})});qn.displayName="Button";const wO="/assets/iruchatlogo-D7fopICj.png",TO=()=>{try{const r=localStorage.getItem("iru-auth");return r?JSON.parse(r):null}catch{return null}},TK=()=>TO()!==null,CO=()=>{const r=TO();return(r==null?void 0:r.user)||null},bs=()=>{const r=TO();return(r==null?void 0:r.token)||null},CK=()=>{localStorage.removeItem("iru-auth")},Mve=()=>{const r=CO();return(r==null?void 0:r.role)==="admin"},jve=()=>{const[r,s]=V.useState(!1),[a,c]=V.useState(!1),[h,f]=V.useState(null),[_,E]=V.useState(!1),v=V.useRef(null),x=Eh(),T=vh(),{toast:R}=za();V.useEffect(()=>{const F=()=>{c(TK()),f(CO())};return F(),window.addEventListener("storage",F),window.addEventListener("focus",F),()=>{window.removeEventListener("storage",F),window.removeEventListener("focus",F)}},[x]),V.useEffect(()=>{const F=P=>{v.current&&!v.current.contains(P.target)&&E(!1)};return document.addEventListener("mousedown",F),()=>{document.removeEventListener("mousedown",F)}},[]);const N=()=>{CK(),c(!1),f(null),R({title:"Logged out",description:"You have been successfully logged out."}),T("/")},L=[{name:"Home",path:"/"},{name:"Features",path:"/features"},{name:"Solutions",path:"/solutions"},{name:"About",path:"/about"},{name:"Contact",path:"/contact"}],j=F=>x.pathname===F;return d.jsxs("header",{className:"fixed top-0 left-0 right-0 z-50 glass border-b border-border/20",children:[d.jsxs("div",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[d.jsx(Fn,{to:"/",className:"flex items-center space-x-2 transition-transform duration-300 hover:scale-105",children:d.jsx("img",{src:wO,alt:"IRU Chat Logo",className:"h-12 w-auto"})}),d.jsx("nav",{className:"hidden lg:flex items-center space-x-8",children:L.map(F=>d.jsx(Fn,{to:F.path,className:`text-sm font-medium transition-colors duration-200 hover:text-brand-blue ${j(F.path)?"text-brand-blue":"text-text-secondary hover:text-text"}`,children:F.name},F.path))}),d.jsxs("div",{className:"hidden lg:flex items-center space-x-4",children:[d.jsx(Fn,{to:"/chat",children:d.jsx(qn,{variant:"ghost",className:"w-full justify-start text-text-secondary",children:"Chat Now"})}),a?d.jsxs("div",{className:"relative",ref:v,children:[d.jsxs(qn,{variant:"ghost",className:"flex items-center gap-2",onClick:()=>E(!_),children:[d.jsx(eh,{className:"w-4 h-4"}),(h==null?void 0:h.name)||"Account",d.jsx(mH,{className:"w-4 h-4"})]}),_&&d.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-bg-card border border-border rounded-lg shadow-lg z-50",children:d.jsxs("div",{className:"py-1",children:[d.jsxs(Fn,{to:"/account",onClick:()=>E(!1),className:"block px-4 py-2 text-sm text-text hover:bg-bg-secondary transition-colors flex items-center gap-2",children:[d.jsx(eh,{className:"w-4 h-4"}),"My Account"]}),d.jsxs(Fn,{to:"/account",onClick:()=>{E(!1)},className:"block px-4 py-2 text-sm text-text hover:bg-bg-secondary transition-colors flex items-center gap-2",children:[d.jsx(ch,{className:"w-4 h-4"}),"Settings"]}),d.jsx("div",{className:"border-t border-border my-1"}),d.jsxs("button",{onClick:()=>{E(!1),N()},className:"w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-500/10 transition-colors flex items-center gap-2",children:[d.jsx(I0,{className:"w-4 h-4"}),"Logout"]})]})})]}):d.jsx(Fn,{to:"/auth",children:d.jsx(qn,{className:"w-full btn-hero",children:"Get Started"})})]}),d.jsx("button",{onClick:()=>s(!r),className:"lg:hidden p-2 text-text-secondary hover:text-text transition-colors","aria-label":"Toggle menu",children:r?d.jsx(yo,{size:24}):d.jsx(iO,{size:24})})]}),r&&d.jsx("div",{className:"lg:hidden glass border-t border-border/20",children:d.jsxs("nav",{className:"container mx-auto px-4 py-6 space-y-4",children:[L.map(F=>d.jsx(Fn,{to:F.path,onClick:()=>s(!1),className:`block py-2 text-sm font-medium transition-colors duration-200 ${j(F.path)?"text-brand-blue":"text-text-secondary hover:text-text"}`,children:F.name},F.path)),d.jsxs("div",{className:"pt-4 space-y-3",children:[d.jsx(Fn,{to:"/chat",onClick:()=>s(!1),children:d.jsx(qn,{variant:"ghost",className:"w-full justify-start text-text-secondary",children:"Chat Now"})}),a?d.jsxs(d.Fragment,{children:[d.jsx(Fn,{to:"/account",onClick:()=>s(!1),children:d.jsxs(qn,{variant:"ghost",className:"w-full justify-start flex items-center gap-2",children:[d.jsx(eh,{className:"w-4 h-4"}),"My Account"]})}),d.jsx(Fn,{to:"/account",onClick:()=>{s(!1)},children:d.jsxs(qn,{variant:"ghost",className:"w-full justify-start flex items-center gap-2",children:[d.jsx(ch,{className:"w-4 h-4"}),"Settings"]})}),d.jsxs(qn,{onClick:()=>{s(!1),N()},variant:"outline",className:"w-full flex items-center gap-2 border-red-500/50 text-red-500 hover:bg-red-500/10",children:[d.jsx(I0,{className:"w-4 h-4"}),"Logout"]})]}):d.jsx(Fn,{to:"/auth",onClick:()=>s(!1),children:d.jsx(qn,{className:"w-full btn-hero",children:"Get Started"})})]})]})})]})},Fu=V.forwardRef(({className:r,type:s,...a},c)=>d.jsx("input",{type:s,className:Xs("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:c,...a}));Fu.displayName="Input";const Uve=()=>{const r=["Innovation","Technology","Learning","Future","Growth","Success"],[s,a]=V.useState(0),[c,h]=V.useState(!1);return V.useEffect(()=>{const f=setInterval(()=>{h(!0),setTimeout(()=>{a(_=>(_+1)%r.length),h(!1)},500)},2500);return()=>clearInterval(f)},[]),d.jsx("div",{className:"overflow-hidden h-12 md:h-16 mb-6",children:d.jsx("div",{className:"relative h-full flex items-center justify-center",children:r.map((f,_)=>d.jsxs("span",{className:`absolute text-xl md:text-3xl font-bold transition-all duration-700 ease-in-out ${_===s?`opacity-100 transform-none ${c?"blur-sm scale-105":""}`:"opacity-0 translate-y-16"}`,children:[d.jsx("span",{className:"text-white",children:" Smart, Secure & AI-Powered "}),d.jsx("span",{className:"bg-gradient-to-r from-techblue-300 via-techblue to-techpurple-light text-transparent bg-clip-text",children:f})]},_))})})},Vve=()=>d.jsxs("footer",{className:"bg-gradient-to-r from-techdark to-techblue-900 text-white relative overflow-hidden",children:[d.jsxs("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden opacity-15 pointer-events-none",children:[d.jsx("div",{className:"absolute w-40 h-40 bg-techblue-400 rounded-full -top-10 -left-10 animate-pulse",style:{animationDuration:"6s"}}),d.jsx("div",{className:"absolute w-60 h-60 bg-techblue-500 rounded-full top-40 right-20 animate-pulse",style:{animationDuration:"8s"}}),d.jsx("div",{className:"absolute w-20 h-20 bg-techpurple-light rounded-full bottom-10 left-1/4 animate-pulse",style:{animationDuration:"4s"}})]}),d.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl pt-16 pb-8 relative z-10",children:[d.jsx(Uve,{}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12",children:[d.jsxs("div",{className:"transform transition-transform duration-500 hover:-translate-y-2",children:[d.jsxs("h3",{className:"text-xl md:text-2xl font-bold mb-4 relative inline-block",children:["IRU",d.jsx("span",{className:"text-techblue-300",children:" Chat"}),d.jsx("span",{className:"absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-techblue to-techpurple-light transition-all duration-300 group-hover:w-full"})]}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Developed by IRU BUSINESS GROUP Ltd. Smart, secure, and scalable communication for modern organizations worldwide."}),d.jsxs("div",{className:"flex space-x-4",children:[d.jsx("a",{href:"https://www.instagram.com/irubusinessgroup?igsh=Y2s1N25qY2xzM2Zu",target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-techblue hover:scale-110 transition-all duration-300","aria-label":"Instagram",children:d.jsx($ge,{size:20})}),d.jsx("a",{href:"https://x.com/IRUBUSINESSES?t=QHreTJ4D1GtZfix4tQIpyw&s=09",target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-techblue hover:scale-110 transition-all duration-300","aria-label":"X (Twitter)",children:d.jsx(n0e,{size:20})}),d.jsx("a",{href:"https://www.linkedin.com/in/iru-business-group-571ba3334?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app",target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-techblue hover:scale-110 transition-all duration-300","aria-label":"LinkedIn",children:d.jsx(Gge,{size:20})}),d.jsx("a",{href:"https://www.youtube.com/@IRUTV-2060",target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-techblue hover:scale-110 transition-all duration-300","aria-label":"YouTube",children:d.jsx(a0e,{size:20})})]})]}),d.jsxs("div",{className:"transform transition-transform duration-500 hover:-translate-y-2",children:[d.jsxs("h4",{className:"font-semibold text-lg mb-4 relative inline-block",children:["Company",d.jsx("span",{className:"absolute -bottom-1 left-0 w-1/3 h-0.5 bg-gradient-to-r from-techblue to-techpurple-light"})]}),d.jsxs("ul",{className:"space-y-2",children:[d.jsx("li",{className:"transform hover:translate-x-2 transition-transform duration-300",children:d.jsx(Fn,{to:"/about",className:"text-gray-300 hover:text-white flex items-center",children:d.jsx("span",{className:"hover:text-techblue-300",children:"About Us"})})}),d.jsx("li",{className:"transform hover:translate-x-2 transition-transform duration-300",children:d.jsx(Fn,{to:"/contact",className:"text-gray-300 hover:text-white flex items-center",children:d.jsx("span",{className:"hover:text-techblue-300",children:"Contact"})})})]})]}),d.jsxs("div",{className:"transform transition-transform duration-500 hover:-translate-y-2",children:[d.jsxs("h4",{className:"font-semibold text-lg mb-4 relative inline-block",children:["Solutions",d.jsx("span",{className:"absolute -bottom-1 left-0 w-1/3 h-0.5 bg-gradient-to-r from-techblue to-techpurple-light"})]}),d.jsxs("ul",{className:"space-y-2",children:[d.jsx("li",{className:"transform hover:translate-x-2 transition-transform duration-300",children:d.jsx(Fn,{to:"/features",className:"text-gray-300 hover:text-white flex items-center",children:d.jsx("span",{className:"hover:text-techblue-300",children:"Features"})})}),d.jsx("li",{className:"transform hover:translate-x-2 transition-transform duration-300",children:d.jsx(Fn,{to:"/solutions",className:"text-gray-300 hover:text-white flex items-center",children:d.jsx("span",{className:"hover:text-techblue-300",children:"Solutions"})})}),d.jsx("li",{className:"transform hover:translate-x-2 transition-transform duration-300",children:d.jsx(Fn,{to:"/pricing",className:"text-gray-300 hover:text-white flex items-center",children:d.jsx("span",{className:"hover:text-techblue-300",children:"Pricing"})})})]})]}),d.jsxs("div",{className:"transform transition-transform duration-500 hover:-translate-y-2",children:[d.jsxs("h4",{className:"font-semibold text-lg mb-4 relative inline-block",children:["Newsletter",d.jsx("span",{className:"absolute -bottom-1 left-0 w-1/3 h-0.5 bg-gradient-to-r from-techblue to-techpurple-light"})]}),d.jsx("p",{className:"text-gray-300 mb-4",children:"Subscribe to our newsletter for the latest updates."}),d.jsxs("div",{className:"flex space-x-2 group",children:[d.jsx(Fu,{type:"email",placeholder:"Your Email",className:"bg-white/10 border-white/20 text-white placeholder:text-gray-400 focus:border-techblue-300 transition-all duration-300"}),d.jsx(qn,{className:"bg-techblue hover:bg-techblue-700 group-hover:animate-pulse transition-all duration-300 button-glow",children:"Subscribe"})]})]})]}),d.jsx("div",{className:"border-t border-white/20 pt-8 mt-8",children:d.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center",children:[d.jsxs("a",{href:"https://www.irubusinessgroup.com/",target:"_blank",rel:"noopener noreferrer",className:"text-gray-400 text-sm hover:text-white transition-colors duration-300",children:[" ",new Date().getFullYear()," IRU Business Group. All rights reserved."]}),d.jsx("div",{className:"flex space-x-6 mt-4 md:mt-0",children:["Privacy Policy","Terms of Service","Sitemap"].map((r,s)=>d.jsx(Fn,{to:`/${r.toLowerCase().replace(/\s+/g,"-")}`,className:"text-gray-400 text-sm hover:text-white hover:underline transition-all duration-300",children:r},s))})]})})]})]}),Fve=({onOpenChatbot:r})=>{const[s,a]=V.useState(!1),c=Eh();V.useEffect(()=>{const _=()=>{a(window.scrollY>300)};return window.addEventListener("scroll",_),()=>window.removeEventListener("scroll",_)},[]);const h=()=>{window.scrollTo({top:0,behavior:"smooth"})},f=c.pathname==="/support"||c.pathname==="/chat";return d.jsxs(d.Fragment,{children:[!f&&d.jsx("button",{onClick:r,className:"fixed bottom-24 right-4 md:right-6 z-50 group","aria-label":"Open Chat",children:d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute inset-0 bg-brand-blue rounded-full animate-ping opacity-20",style:{animationDuration:"2s"}}),d.jsx("div",{className:"relative w-12 h-12 md:w-14 md:h-14 rounded-full bg-gradient-to-br from-brand-blue to-brand-cyan flex items-center justify-center shadow-lg shadow-brand-blue/50 transition-all duration-300 hover:scale-110 hover:shadow-xl hover:shadow-brand-blue/70 group-hover:rotate-3",children:d.jsx(pl,{className:"w-5 h-5 md:w-6 md:h-6 text-white transition-transform duration-300 group-hover:scale-110"})}),d.jsxs("div",{className:"absolute right-full mr-3 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none",children:[d.jsx("div",{className:"bg-bg-card text-text px-3 py-2 rounded-lg text-sm whitespace-nowrap shadow-lg border border-border",children:"Start Chatting"}),d.jsx("div",{className:"absolute left-full top-1/2 -translate-y-1/2 border-4 border-transparent border-l-bg-card"})]})]})}),s&&d.jsx("button",{onClick:h,className:"fixed bottom-4 md:bottom-6 right-4 md:right-6 z-50 w-12 h-12 md:w-14 md:h-14 rounded-full bg-gradient-to-br from-brand-blue to-brand-cyan flex items-center justify-center shadow-lg shadow-brand-blue/50 transition-all duration-300 hover:scale-110 hover:shadow-xl hover:shadow-brand-blue/70 animate-scale-in","aria-label":"Back to top",children:d.jsx(xge,{className:"w-5 h-5 md:w-6 md:h-6 text-white transition-transform duration-300 hover:translate-y-[-2px]"})})]})},Eo=({children:r})=>{const s=vh(),a=()=>{s("/chat")};return d.jsxs("div",{className:"min-h-screen bg-background",children:[d.jsx(jve,{}),d.jsx("main",{className:"pt-16",children:r}),d.jsx(Vve,{}),d.jsx(Fve,{onOpenChatbot:a})]})},RK=V.createContext({});function Bve(r){const s=V.useRef(null);return s.current===null&&(s.current=r()),s.current}const RO=typeof window<"u",$ve=RO?V.useLayoutEffect:V.useEffect,NO=V.createContext(null);function AO(r,s){r.indexOf(s)===-1&&r.push(s)}function IO(r,s){const a=r.indexOf(s);a>-1&&r.splice(a,1)}const gl=(r,s,a)=>a>s?s:a<r?r:a;let Hb=()=>{};const _l={},NK=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r);function AK(r){return typeof r=="object"&&r!==null}const IK=r=>/^0[^.\s]+$/u.test(r);function OO(r){let s;return()=>(s===void 0&&(s=r()),s)}const ta=r=>r,Wve=(r,s)=>a=>s(r(a)),o_=(...r)=>r.reduce(Wve),U0=(r,s,a)=>{const c=s-r;return c===0?1:(a-r)/c};class PO{constructor(){this.subscriptions=[]}add(s){return AO(this.subscriptions,s),()=>IO(this.subscriptions,s)}notify(s,a,c){const h=this.subscriptions.length;if(h)if(h===1)this.subscriptions[0](s,a,c);else for(let f=0;f<h;f++){const _=this.subscriptions[f];_&&_(s,a,c)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Ic=r=>r*1e3,Oc=r=>r/1e3;function OK(r,s){return s?r*(1e3/s):0}const PK=(r,s,a)=>(((1-3*a+3*s)*r+(3*a-6*s))*r+3*s)*r,Gve=1e-7,Hve=12;function Kve(r,s,a,c,h){let f,_,E=0;do _=s+(a-s)/2,f=PK(_,c,h)-r,f>0?a=_:s=_;while(Math.abs(f)>Gve&&++E<Hve);return _}function a_(r,s,a,c){if(r===s&&a===c)return ta;const h=f=>Kve(f,0,1,r,a);return f=>f===0||f===1?f:PK(h(f),s,c)}const DK=r=>s=>s<=.5?r(2*s)/2:(2-r(2*(1-s)))/2,kK=r=>s=>1-r(1-s),LK=a_(.33,1.53,.69,.99),DO=kK(LK),MK=DK(DO),jK=r=>(r*=2)<1?.5*DO(r):.5*(2-Math.pow(2,-10*(r-1))),kO=r=>1-Math.sin(Math.acos(r)),UK=kK(kO),VK=DK(kO),zve=a_(.42,0,1,1),Yve=a_(0,0,.58,1),FK=a_(.42,0,.58,1),qve=r=>Array.isArray(r)&&typeof r[0]!="number",BK=r=>Array.isArray(r)&&typeof r[0]=="number",D$={linear:ta,easeIn:zve,easeInOut:FK,easeOut:Yve,circIn:kO,circInOut:VK,circOut:UK,backIn:DO,backInOut:MK,backOut:LK,anticipate:jK},Xve=r=>typeof r=="string",k$=r=>{if(BK(r)){Hb(r.length===4);const[s,a,c,h]=r;return a_(s,a,c,h)}else if(Xve(r))return Hb(D$[r]!==void 0),D$[r];return r},Ov=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],L$={value:null,addProjectionMetrics:null};function Jve(r,s){let a=new Set,c=new Set,h=!1,f=!1;const _=new WeakSet;let E={delta:0,timestamp:0,isProcessing:!1},v=0;function x(R){_.has(R)&&(T.schedule(R),r()),v++,R(E)}const T={schedule:(R,N=!1,L=!1)=>{const F=L&&h?a:c;return N&&_.add(R),F.has(R)||F.add(R),R},cancel:R=>{c.delete(R),_.delete(R)},process:R=>{if(E=R,h){f=!0;return}h=!0,[a,c]=[c,a],a.forEach(x),s&&L$.value&&L$.value.frameloop[s].push(v),v=0,a.clear(),h=!1,f&&(f=!1,T.process(R))}};return T}const Qve=40;function $K(r,s){let a=!1,c=!0;const h={delta:0,timestamp:0,isProcessing:!1},f=()=>a=!0,_=Ov.reduce((B,K)=>(B[K]=Jve(f,s?K:void 0),B),{}),{setup:E,read:v,resolveKeyframes:x,preUpdate:T,update:R,preRender:N,render:L,postRender:j}=_,F=()=>{const B=_l.useManualTiming?h.timestamp:performance.now();a=!1,_l.useManualTiming||(h.delta=c?1e3/60:Math.max(Math.min(B-h.timestamp,Qve),1)),h.timestamp=B,h.isProcessing=!0,E.process(h),v.process(h),x.process(h),T.process(h),R.process(h),N.process(h),L.process(h),j.process(h),h.isProcessing=!1,a&&s&&(c=!1,r(F))},P=()=>{a=!0,c=!0,h.isProcessing||r(F)};return{schedule:Ov.reduce((B,K)=>{const J=_[K];return B[K]=(te,se=!1,ie=!1)=>(a||P(),J.schedule(te,se,ie)),B},{}),cancel:B=>{for(let K=0;K<Ov.length;K++)_[Ov[K]].cancel(B)},state:h,steps:_}}const{schedule:Lr,cancel:Od,state:Ks,steps:KN}=$K(typeof requestAnimationFrame<"u"?requestAnimationFrame:ta,!0);let nb;function Zve(){nb=void 0}const zi={now:()=>(nb===void 0&&zi.set(Ks.isProcessing||_l.useManualTiming?Ks.timestamp:performance.now()),nb),set:r=>{nb=r,queueMicrotask(Zve)}},WK=r=>s=>typeof s=="string"&&s.startsWith(r),LO=WK("--"),ebe=WK("var(--"),MO=r=>ebe(r)?tbe.test(r.split("/*")[0].trim()):!1,tbe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Ym={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},V0={...Ym,transform:r=>gl(0,1,r)},Pv={...Ym,default:1},o0=r=>Math.round(r*1e5)/1e5,jO=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function nbe(r){return r==null}const rbe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,UO=(r,s)=>a=>!!(typeof a=="string"&&rbe.test(a)&&a.startsWith(r)||s&&!nbe(a)&&Object.prototype.hasOwnProperty.call(a,s)),GK=(r,s,a)=>c=>{if(typeof c!="string")return c;const[h,f,_,E]=c.match(jO);return{[r]:parseFloat(h),[s]:parseFloat(f),[a]:parseFloat(_),alpha:E!==void 0?parseFloat(E):1}},sbe=r=>gl(0,255,r),zN={...Ym,transform:r=>Math.round(sbe(r))},Gu={test:UO("rgb","red"),parse:GK("red","green","blue"),transform:({red:r,green:s,blue:a,alpha:c=1})=>"rgba("+zN.transform(r)+", "+zN.transform(s)+", "+zN.transform(a)+", "+o0(V0.transform(c))+")"};function ibe(r){let s="",a="",c="",h="";return r.length>5?(s=r.substring(1,3),a=r.substring(3,5),c=r.substring(5,7),h=r.substring(7,9)):(s=r.substring(1,2),a=r.substring(2,3),c=r.substring(3,4),h=r.substring(4,5),s+=s,a+=a,c+=c,h+=h),{red:parseInt(s,16),green:parseInt(a,16),blue:parseInt(c,16),alpha:h?parseInt(h,16)/255:1}}const RA={test:UO("#"),parse:ibe,transform:Gu.transform},c_=r=>({test:s=>typeof s=="string"&&s.endsWith(r)&&s.split(" ").length===1,parse:parseFloat,transform:s=>`${s}${r}`}),rd=c_("deg"),Pc=c_("%"),Yt=c_("px"),obe=c_("vh"),abe=c_("vw"),M$={...Pc,parse:r=>Pc.parse(r)/100,transform:r=>Pc.transform(r*100)},im={test:UO("hsl","hue"),parse:GK("hue","saturation","lightness"),transform:({hue:r,saturation:s,lightness:a,alpha:c=1})=>"hsla("+Math.round(r)+", "+Pc.transform(o0(s))+", "+Pc.transform(o0(a))+", "+o0(V0.transform(c))+")"},hs={test:r=>Gu.test(r)||RA.test(r)||im.test(r),parse:r=>Gu.test(r)?Gu.parse(r):im.test(r)?im.parse(r):RA.parse(r),transform:r=>typeof r=="string"?r:r.hasOwnProperty("red")?Gu.transform(r):im.transform(r),getAnimatableNone:r=>{const s=hs.parse(r);return s.alpha=0,hs.transform(s)}},cbe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function lbe(r){var s,a;return isNaN(r)&&typeof r=="string"&&(((s=r.match(jO))==null?void 0:s.length)||0)+(((a=r.match(cbe))==null?void 0:a.length)||0)>0}const HK="number",KK="color",dbe="var",ube="var(",j$="${}",hbe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function F0(r){const s=r.toString(),a=[],c={color:[],number:[],var:[]},h=[];let f=0;const E=s.replace(hbe,v=>(hs.test(v)?(c.color.push(f),h.push(KK),a.push(hs.parse(v))):v.startsWith(ube)?(c.var.push(f),h.push(dbe),a.push(v)):(c.number.push(f),h.push(HK),a.push(parseFloat(v))),++f,j$)).split(j$);return{values:a,split:E,indexes:c,types:h}}function zK(r){return F0(r).values}function YK(r){const{split:s,types:a}=F0(r),c=s.length;return h=>{let f="";for(let _=0;_<c;_++)if(f+=s[_],h[_]!==void 0){const E=a[_];E===HK?f+=o0(h[_]):E===KK?f+=hs.transform(h[_]):f+=h[_]}return f}}const pbe=r=>typeof r=="number"?0:hs.test(r)?hs.getAnimatableNone(r):r;function mbe(r){const s=zK(r);return YK(r)(s.map(pbe))}const Pd={test:lbe,parse:zK,createTransformer:YK,getAnimatableNone:mbe};function YN(r,s,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?r+(s-r)*6*a:a<1/2?s:a<2/3?r+(s-r)*(2/3-a)*6:r}function fbe({hue:r,saturation:s,lightness:a,alpha:c}){r/=360,s/=100,a/=100;let h=0,f=0,_=0;if(!s)h=f=_=a;else{const E=a<.5?a*(1+s):a+s-a*s,v=2*a-E;h=YN(v,E,r+1/3),f=YN(v,E,r),_=YN(v,E,r-1/3)}return{red:Math.round(h*255),green:Math.round(f*255),blue:Math.round(_*255),alpha:c}}function Kb(r,s){return a=>a>0?s:r}const Gr=(r,s,a)=>r+(s-r)*a,qN=(r,s,a)=>{const c=r*r,h=a*(s*s-c)+c;return h<0?0:Math.sqrt(h)},gbe=[RA,Gu,im],_be=r=>gbe.find(s=>s.test(r));function U$(r){const s=_be(r);if(!s)return!1;let a=s.parse(r);return s===im&&(a=fbe(a)),a}const V$=(r,s)=>{const a=U$(r),c=U$(s);if(!a||!c)return Kb(r,s);const h={...a};return f=>(h.red=qN(a.red,c.red,f),h.green=qN(a.green,c.green,f),h.blue=qN(a.blue,c.blue,f),h.alpha=Gr(a.alpha,c.alpha,f),Gu.transform(h))},NA=new Set(["none","hidden"]);function ybe(r,s){return NA.has(r)?a=>a<=0?r:s:a=>a>=1?s:r}function Ebe(r,s){return a=>Gr(r,s,a)}function VO(r){return typeof r=="number"?Ebe:typeof r=="string"?MO(r)?Kb:hs.test(r)?V$:Sbe:Array.isArray(r)?qK:typeof r=="object"?hs.test(r)?V$:vbe:Kb}function qK(r,s){const a=[...r],c=a.length,h=r.map((f,_)=>VO(f)(f,s[_]));return f=>{for(let _=0;_<c;_++)a[_]=h[_](f);return a}}function vbe(r,s){const a={...r,...s},c={};for(const h in a)r[h]!==void 0&&s[h]!==void 0&&(c[h]=VO(r[h])(r[h],s[h]));return h=>{for(const f in c)a[f]=c[f](h);return a}}function bbe(r,s){const a=[],c={color:0,var:0,number:0};for(let h=0;h<s.values.length;h++){const f=s.types[h],_=r.indexes[f][c[f]],E=r.values[_]??0;a[h]=E,c[f]++}return a}const Sbe=(r,s)=>{const a=Pd.createTransformer(s),c=F0(r),h=F0(s);return c.indexes.var.length===h.indexes.var.length&&c.indexes.color.length===h.indexes.color.length&&c.indexes.number.length>=h.indexes.number.length?NA.has(r)&&!h.values.length||NA.has(s)&&!c.values.length?ybe(r,s):o_(qK(bbe(c,h),h.values),a):Kb(r,s)};function XK(r,s,a){return typeof r=="number"&&typeof s=="number"&&typeof a=="number"?Gr(r,s,a):VO(r)(r,s)}const xbe=r=>{const s=({timestamp:a})=>r(a);return{start:(a=!0)=>Lr.update(s,a),stop:()=>Od(s),now:()=>Ks.isProcessing?Ks.timestamp:zi.now()}},JK=(r,s,a=10)=>{let c="";const h=Math.max(Math.round(s/a),2);for(let f=0;f<h;f++)c+=Math.round(r(f/(h-1))*1e4)/1e4+", ";return`linear(${c.substring(0,c.length-2)})`},zb=2e4;function FO(r){let s=0;const a=50;let c=r.next(s);for(;!c.done&&s<zb;)s+=a,c=r.next(s);return s>=zb?1/0:s}function wbe(r,s=100,a){const c=a({...r,keyframes:[0,s]}),h=Math.min(FO(c),zb);return{type:"keyframes",ease:f=>c.next(h*f).value/s,duration:Oc(h)}}const Tbe=5;function QK(r,s,a){const c=Math.max(s-Tbe,0);return OK(a-r(c),s-c)}const Zr={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},XN=.001;function Cbe({duration:r=Zr.duration,bounce:s=Zr.bounce,velocity:a=Zr.velocity,mass:c=Zr.mass}){let h,f,_=1-s;_=gl(Zr.minDamping,Zr.maxDamping,_),r=gl(Zr.minDuration,Zr.maxDuration,Oc(r)),_<1?(h=x=>{const T=x*_,R=T*r,N=T-a,L=AA(x,_),j=Math.exp(-R);return XN-N/L*j},f=x=>{const R=x*_*r,N=R*a+a,L=Math.pow(_,2)*Math.pow(x,2)*r,j=Math.exp(-R),F=AA(Math.pow(x,2),_);return(-h(x)+XN>0?-1:1)*((N-L)*j)/F}):(h=x=>{const T=Math.exp(-x*r),R=(x-a)*r+1;return-XN+T*R},f=x=>{const T=Math.exp(-x*r),R=(a-x)*(r*r);return T*R});const E=5/r,v=Nbe(h,f,E);if(r=Ic(r),isNaN(v))return{stiffness:Zr.stiffness,damping:Zr.damping,duration:r};{const x=Math.pow(v,2)*c;return{stiffness:x,damping:_*2*Math.sqrt(c*x),duration:r}}}const Rbe=12;function Nbe(r,s,a){let c=a;for(let h=1;h<Rbe;h++)c=c-r(c)/s(c);return c}function AA(r,s){return r*Math.sqrt(1-s*s)}const Abe=["duration","bounce"],Ibe=["stiffness","damping","mass"];function F$(r,s){return s.some(a=>r[a]!==void 0)}function Obe(r){let s={velocity:Zr.velocity,stiffness:Zr.stiffness,damping:Zr.damping,mass:Zr.mass,isResolvedFromDuration:!1,...r};if(!F$(r,Ibe)&&F$(r,Abe))if(r.visualDuration){const a=r.visualDuration,c=2*Math.PI/(a*1.2),h=c*c,f=2*gl(.05,1,1-(r.bounce||0))*Math.sqrt(h);s={...s,mass:Zr.mass,stiffness:h,damping:f}}else{const a=Cbe(r);s={...s,...a,mass:Zr.mass},s.isResolvedFromDuration=!0}return s}function Yb(r=Zr.visualDuration,s=Zr.bounce){const a=typeof r!="object"?{visualDuration:r,keyframes:[0,1],bounce:s}:r;let{restSpeed:c,restDelta:h}=a;const f=a.keyframes[0],_=a.keyframes[a.keyframes.length-1],E={done:!1,value:f},{stiffness:v,damping:x,mass:T,duration:R,velocity:N,isResolvedFromDuration:L}=Obe({...a,velocity:-Oc(a.velocity||0)}),j=N||0,F=x/(2*Math.sqrt(v*T)),P=_-f,M=Oc(Math.sqrt(v/T)),U=Math.abs(P)<5;c||(c=U?Zr.restSpeed.granular:Zr.restSpeed.default),h||(h=U?Zr.restDelta.granular:Zr.restDelta.default);let B;if(F<1){const J=AA(M,F);B=te=>{const se=Math.exp(-F*M*te);return _-se*((j+F*M*P)/J*Math.sin(J*te)+P*Math.cos(J*te))}}else if(F===1)B=J=>_-Math.exp(-M*J)*(P+(j+M*P)*J);else{const J=M*Math.sqrt(F*F-1);B=te=>{const se=Math.exp(-F*M*te),ie=Math.min(J*te,300);return _-se*((j+F*M*P)*Math.sinh(ie)+J*P*Math.cosh(ie))/J}}const K={calculatedDuration:L&&R||null,next:J=>{const te=B(J);if(L)E.done=J>=R;else{let se=J===0?j:0;F<1&&(se=J===0?Ic(j):QK(B,J,te));const ie=Math.abs(se)<=c,ue=Math.abs(_-te)<=h;E.done=ie&&ue}return E.value=E.done?_:te,E},toString:()=>{const J=Math.min(FO(K),zb),te=JK(se=>K.next(J*se).value,J,30);return J+"ms "+te},toTransition:()=>{}};return K}Yb.applyToOptions=r=>{const s=wbe(r,100,Yb);return r.ease=s.ease,r.duration=Ic(s.duration),r.type="keyframes",r};function IA({keyframes:r,velocity:s=0,power:a=.8,timeConstant:c=325,bounceDamping:h=10,bounceStiffness:f=500,modifyTarget:_,min:E,max:v,restDelta:x=.5,restSpeed:T}){const R=r[0],N={done:!1,value:R},L=ie=>E!==void 0&&ie<E||v!==void 0&&ie>v,j=ie=>E===void 0?v:v===void 0||Math.abs(E-ie)<Math.abs(v-ie)?E:v;let F=a*s;const P=R+F,M=_===void 0?P:_(P);M!==P&&(F=M-R);const U=ie=>-F*Math.exp(-ie/c),B=ie=>M+U(ie),K=ie=>{const ue=U(ie),de=B(ie);N.done=Math.abs(ue)<=x,N.value=N.done?M:de};let J,te;const se=ie=>{L(N.value)&&(J=ie,te=Yb({keyframes:[N.value,j(N.value)],velocity:QK(B,ie,N.value),damping:h,stiffness:f,restDelta:x,restSpeed:T}))};return se(0),{calculatedDuration:null,next:ie=>{let ue=!1;return!te&&J===void 0&&(ue=!0,K(ie),se(ie)),J!==void 0&&ie>=J?te.next(ie-J):(!ue&&K(ie),N)}}}function Pbe(r,s,a){const c=[],h=a||_l.mix||XK,f=r.length-1;for(let _=0;_<f;_++){let E=h(r[_],r[_+1]);if(s){const v=Array.isArray(s)?s[_]||ta:s;E=o_(v,E)}c.push(E)}return c}function Dbe(r,s,{clamp:a=!0,ease:c,mixer:h}={}){const f=r.length;if(Hb(f===s.length),f===1)return()=>s[0];if(f===2&&s[0]===s[1])return()=>s[1];const _=r[0]===r[1];r[0]>r[f-1]&&(r=[...r].reverse(),s=[...s].reverse());const E=Pbe(s,c,h),v=E.length,x=T=>{if(_&&T<r[0])return s[0];let R=0;if(v>1)for(;R<r.length-2&&!(T<r[R+1]);R++);const N=U0(r[R],r[R+1],T);return E[R](N)};return a?T=>x(gl(r[0],r[f-1],T)):x}function kbe(r,s){const a=r[r.length-1];for(let c=1;c<=s;c++){const h=U0(0,s,c);r.push(Gr(a,1,h))}}function Lbe(r){const s=[0];return kbe(s,r.length-1),s}function Mbe(r,s){return r.map(a=>a*s)}function jbe(r,s){return r.map(()=>s||FK).splice(0,r.length-1)}function a0({duration:r=300,keyframes:s,times:a,ease:c="easeInOut"}){const h=qve(c)?c.map(k$):k$(c),f={done:!1,value:s[0]},_=Mbe(a&&a.length===s.length?a:Lbe(s),r),E=Dbe(_,s,{ease:Array.isArray(h)?h:jbe(s,h)});return{calculatedDuration:r,next:v=>(f.value=E(v),f.done=v>=r,f)}}const Ube=r=>r!==null;function BO(r,{repeat:s,repeatType:a="loop"},c,h=1){const f=r.filter(Ube),E=h<0||s&&a!=="loop"&&s%2===1?0:f.length-1;return!E||c===void 0?f[E]:c}const Vbe={decay:IA,inertia:IA,tween:a0,keyframes:a0,spring:Yb};function ZK(r){typeof r.type=="string"&&(r.type=Vbe[r.type])}class $O{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(s=>{this.resolve=s})}notifyFinished(){this.resolve()}then(s,a){return this.finished.then(s,a)}}const Fbe=r=>r/100;class WO extends $O{constructor(s){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var c,h;const{motionValue:a}=this.options;a&&a.updatedAt!==zi.now()&&this.tick(zi.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(h=(c=this.options).onStop)==null||h.call(c))},this.options=s,this.initAnimation(),this.play(),s.autoplay===!1&&this.pause()}initAnimation(){const{options:s}=this;ZK(s);const{type:a=a0,repeat:c=0,repeatDelay:h=0,repeatType:f,velocity:_=0}=s;let{keyframes:E}=s;const v=a||a0;v!==a0&&typeof E[0]!="number"&&(this.mixKeyframes=o_(Fbe,XK(E[0],E[1])),E=[0,100]);const x=v({...s,keyframes:E});f==="mirror"&&(this.mirroredGenerator=v({...s,keyframes:[...E].reverse(),velocity:-_})),x.calculatedDuration===null&&(x.calculatedDuration=FO(x));const{calculatedDuration:T}=x;this.calculatedDuration=T,this.resolvedDuration=T+h,this.totalDuration=this.resolvedDuration*(c+1)-h,this.generator=x}updateTime(s){const a=Math.round(s-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=a}tick(s,a=!1){const{generator:c,totalDuration:h,mixKeyframes:f,mirroredGenerator:_,resolvedDuration:E,calculatedDuration:v}=this;if(this.startTime===null)return c.next(0);const{delay:x=0,keyframes:T,repeat:R,repeatType:N,repeatDelay:L,type:j,onUpdate:F,finalKeyframe:P}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,s):this.speed<0&&(this.startTime=Math.min(s-h/this.speed,this.startTime)),a?this.currentTime=s:this.updateTime(s);const M=this.currentTime-x*(this.playbackSpeed>=0?1:-1),U=this.playbackSpeed>=0?M<0:M>h;this.currentTime=Math.max(M,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=h);let B=this.currentTime,K=c;if(R){const ie=Math.min(this.currentTime,h)/E;let ue=Math.floor(ie),de=ie%1;!de&&ie>=1&&(de=1),de===1&&ue--,ue=Math.min(ue,R+1),!!(ue%2)&&(N==="reverse"?(de=1-de,L&&(de-=L/E)):N==="mirror"&&(K=_)),B=gl(0,1,de)*E}const J=U?{done:!1,value:T[0]}:K.next(B);f&&(J.value=f(J.value));let{done:te}=J;!U&&v!==null&&(te=this.playbackSpeed>=0?this.currentTime>=h:this.currentTime<=0);const se=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&te);return se&&j!==IA&&(J.value=BO(T,this.options,P,this.speed)),F&&F(J.value),se&&this.finish(),J}then(s,a){return this.finished.then(s,a)}get duration(){return Oc(this.calculatedDuration)}get time(){return Oc(this.currentTime)}set time(s){var a;s=Ic(s),this.currentTime=s,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=s:this.driver&&(this.startTime=this.driver.now()-s/this.playbackSpeed),(a=this.driver)==null||a.start(!1)}get speed(){return this.playbackSpeed}set speed(s){this.updateTime(zi.now());const a=this.playbackSpeed!==s;this.playbackSpeed=s,a&&(this.time=Oc(this.currentTime))}play(){var h,f;if(this.isStopped)return;const{driver:s=xbe,startTime:a}=this.options;this.driver||(this.driver=s(_=>this.tick(_))),(f=(h=this.options).onPlay)==null||f.call(h);const c=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=c):this.holdTime!==null?this.startTime=c-this.holdTime:this.startTime||(this.startTime=a??c),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(zi.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var s,a;this.notifyFinished(),this.teardown(),this.state="finished",(a=(s=this.options).onComplete)==null||a.call(s)}cancel(){var s,a;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(a=(s=this.options).onCancel)==null||a.call(s)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(s){return this.startTime=0,this.tick(s,!0)}attachTimeline(s){var a;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(a=this.driver)==null||a.stop(),s.observe(this)}}function Bbe(r){for(let s=1;s<r.length;s++)r[s]??(r[s]=r[s-1])}const Hu=r=>r*180/Math.PI,OA=r=>{const s=Hu(Math.atan2(r[1],r[0]));return PA(s)},$be={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:r=>(Math.abs(r[0])+Math.abs(r[3]))/2,rotate:OA,rotateZ:OA,skewX:r=>Hu(Math.atan(r[1])),skewY:r=>Hu(Math.atan(r[2])),skew:r=>(Math.abs(r[1])+Math.abs(r[2]))/2},PA=r=>(r=r%360,r<0&&(r+=360),r),B$=OA,$$=r=>Math.sqrt(r[0]*r[0]+r[1]*r[1]),W$=r=>Math.sqrt(r[4]*r[4]+r[5]*r[5]),Wbe={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:$$,scaleY:W$,scale:r=>($$(r)+W$(r))/2,rotateX:r=>PA(Hu(Math.atan2(r[6],r[5]))),rotateY:r=>PA(Hu(Math.atan2(-r[2],r[0]))),rotateZ:B$,rotate:B$,skewX:r=>Hu(Math.atan(r[4])),skewY:r=>Hu(Math.atan(r[1])),skew:r=>(Math.abs(r[1])+Math.abs(r[4]))/2};function DA(r){return r.includes("scale")?1:0}function kA(r,s){if(!r||r==="none")return DA(s);const a=r.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let c,h;if(a)c=Wbe,h=a;else{const E=r.match(/^matrix\(([-\d.e\s,]+)\)$/u);c=$be,h=E}if(!h)return DA(s);const f=c[s],_=h[1].split(",").map(Hbe);return typeof f=="function"?f(_):_[f]}const Gbe=(r,s)=>{const{transform:a="none"}=getComputedStyle(r);return kA(a,s)};function Hbe(r){return parseFloat(r.trim())}const qm=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Xm=new Set(qm),G$=r=>r===Ym||r===Yt,Kbe=new Set(["x","y","z"]),zbe=qm.filter(r=>!Kbe.has(r));function Ybe(r){const s=[];return zbe.forEach(a=>{const c=r.getValue(a);c!==void 0&&(s.push([a,c.get()]),c.set(a.startsWith("scale")?1:0))}),s}const th={width:({x:r},{paddingLeft:s="0",paddingRight:a="0"})=>r.max-r.min-parseFloat(s)-parseFloat(a),height:({y:r},{paddingTop:s="0",paddingBottom:a="0"})=>r.max-r.min-parseFloat(s)-parseFloat(a),top:(r,{top:s})=>parseFloat(s),left:(r,{left:s})=>parseFloat(s),bottom:({y:r},{top:s})=>parseFloat(s)+(r.max-r.min),right:({x:r},{left:s})=>parseFloat(s)+(r.max-r.min),x:(r,{transform:s})=>kA(s,"x"),y:(r,{transform:s})=>kA(s,"y")};th.translateX=th.x;th.translateY=th.y;const nh=new Set;let LA=!1,MA=!1,jA=!1;function ez(){if(MA){const r=Array.from(nh).filter(c=>c.needsMeasurement),s=new Set(r.map(c=>c.element)),a=new Map;s.forEach(c=>{const h=Ybe(c);h.length&&(a.set(c,h),c.render())}),r.forEach(c=>c.measureInitialState()),s.forEach(c=>{c.render();const h=a.get(c);h&&h.forEach(([f,_])=>{var E;(E=c.getValue(f))==null||E.set(_)})}),r.forEach(c=>c.measureEndState()),r.forEach(c=>{c.suspendedScrollY!==void 0&&window.scrollTo(0,c.suspendedScrollY)})}MA=!1,LA=!1,nh.forEach(r=>r.complete(jA)),nh.clear()}function tz(){nh.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(MA=!0)})}function qbe(){jA=!0,tz(),ez(),jA=!1}class GO{constructor(s,a,c,h,f,_=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...s],this.onComplete=a,this.name=c,this.motionValue=h,this.element=f,this.isAsync=_}scheduleResolve(){this.state="scheduled",this.isAsync?(nh.add(this),LA||(LA=!0,Lr.read(tz),Lr.resolveKeyframes(ez))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:s,name:a,element:c,motionValue:h}=this;if(s[0]===null){const f=h==null?void 0:h.get(),_=s[s.length-1];if(f!==void 0)s[0]=f;else if(c&&a){const E=c.readValue(a,_);E!=null&&(s[0]=E)}s[0]===void 0&&(s[0]=_),h&&f===void 0&&h.set(s[0])}Bbe(s)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(s=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,s),nh.delete(this)}cancel(){this.state==="scheduled"&&(nh.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Xbe=r=>r.startsWith("--");function Jbe(r,s,a){Xbe(s)?r.style.setProperty(s,a):r.style[s]=a}const Qbe=OO(()=>window.ScrollTimeline!==void 0),Zbe={};function eSe(r,s){const a=OO(r);return()=>Zbe[s]??a()}const nz=eSe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Kg=([r,s,a,c])=>`cubic-bezier(${r}, ${s}, ${a}, ${c})`,H$={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Kg([0,.65,.55,1]),circOut:Kg([.55,0,1,.45]),backIn:Kg([.31,.01,.66,-.59]),backOut:Kg([.33,1.53,.69,.99])};function rz(r,s){if(r)return typeof r=="function"?nz()?JK(r,s):"ease-out":BK(r)?Kg(r):Array.isArray(r)?r.map(a=>rz(a,s)||H$.easeOut):H$[r]}function tSe(r,s,a,{delay:c=0,duration:h=300,repeat:f=0,repeatType:_="loop",ease:E="easeOut",times:v}={},x=void 0){const T={[s]:a};v&&(T.offset=v);const R=rz(E,h);Array.isArray(R)&&(T.easing=R);const N={delay:c,duration:h,easing:Array.isArray(R)?"linear":R,fill:"both",iterations:f+1,direction:_==="reverse"?"alternate":"normal"};return x&&(N.pseudoElement=x),r.animate(T,N)}function sz(r){return typeof r=="function"&&"applyToOptions"in r}function nSe({type:r,...s}){return sz(r)&&nz()?r.applyToOptions(s):(s.duration??(s.duration=300),s.ease??(s.ease="easeOut"),s)}class rSe extends $O{constructor(s){if(super(),this.finishedTime=null,this.isStopped=!1,!s)return;const{element:a,name:c,keyframes:h,pseudoElement:f,allowFlatten:_=!1,finalKeyframe:E,onComplete:v}=s;this.isPseudoElement=!!f,this.allowFlatten=_,this.options=s,Hb(typeof s.type!="string");const x=nSe(s);this.animation=tSe(a,c,h,x,f),x.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!f){const T=BO(h,this.options,E,this.speed);this.updateMotionValue?this.updateMotionValue(T):Jbe(a,c,T),this.animation.cancel()}v==null||v(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var s,a;(a=(s=this.animation).finish)==null||a.call(s)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:s}=this;s==="idle"||s==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var s,a;this.isPseudoElement||(a=(s=this.animation).commitStyles)==null||a.call(s)}get duration(){var a,c;const s=((c=(a=this.animation.effect)==null?void 0:a.getComputedTiming)==null?void 0:c.call(a).duration)||0;return Oc(Number(s))}get time(){return Oc(Number(this.animation.currentTime)||0)}set time(s){this.finishedTime=null,this.animation.currentTime=Ic(s)}get speed(){return this.animation.playbackRate}set speed(s){s<0&&(this.finishedTime=null),this.animation.playbackRate=s}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(s){this.animation.startTime=s}attachTimeline({timeline:s,observe:a}){var c;return this.allowFlatten&&((c=this.animation.effect)==null||c.updateTiming({easing:"linear"})),this.animation.onfinish=null,s&&Qbe()?(this.animation.timeline=s,ta):a(this)}}const iz={anticipate:jK,backInOut:MK,circInOut:VK};function sSe(r){return r in iz}function iSe(r){typeof r.ease=="string"&&sSe(r.ease)&&(r.ease=iz[r.ease])}const K$=10;class oSe extends rSe{constructor(s){iSe(s),ZK(s),super(s),s.startTime&&(this.startTime=s.startTime),this.options=s}updateMotionValue(s){const{motionValue:a,onUpdate:c,onComplete:h,element:f,..._}=this.options;if(!a)return;if(s!==void 0){a.set(s);return}const E=new WO({..._,autoplay:!1}),v=Ic(this.finishedTime??this.time);a.setWithVelocity(E.sample(v-K$).value,E.sample(v).value,K$),E.stop()}}const z$=(r,s)=>s==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(Pd.test(r)||r==="0")&&!r.startsWith("url("));function aSe(r){const s=r[0];if(r.length===1)return!0;for(let a=0;a<r.length;a++)if(r[a]!==s)return!0}function cSe(r,s,a,c){const h=r[0];if(h===null)return!1;if(s==="display"||s==="visibility")return!0;const f=r[r.length-1],_=z$(h,s),E=z$(f,s);return!_||!E?!1:aSe(r)||(a==="spring"||sz(a))&&c}function UA(r){r.duration=0,r.type}const lSe=new Set(["opacity","clipPath","filter","transform"]),dSe=OO(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function uSe(r){var T;const{motionValue:s,name:a,repeatDelay:c,repeatType:h,damping:f,type:_}=r;if(!(((T=s==null?void 0:s.owner)==null?void 0:T.current)instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:x}=s.owner.getProps();return dSe()&&a&&lSe.has(a)&&(a!=="transform"||!x)&&!v&&!c&&h!=="mirror"&&f!==0&&_!=="inertia"}const hSe=40;class pSe extends $O{constructor({autoplay:s=!0,delay:a=0,type:c="keyframes",repeat:h=0,repeatDelay:f=0,repeatType:_="loop",keyframes:E,name:v,motionValue:x,element:T,...R}){var j;super(),this.stop=()=>{var F,P;this._animation&&(this._animation.stop(),(F=this.stopTimeline)==null||F.call(this)),(P=this.keyframeResolver)==null||P.cancel()},this.createdAt=zi.now();const N={autoplay:s,delay:a,type:c,repeat:h,repeatDelay:f,repeatType:_,name:v,motionValue:x,element:T,...R},L=(T==null?void 0:T.KeyframeResolver)||GO;this.keyframeResolver=new L(E,(F,P,M)=>this.onKeyframesResolved(F,P,N,!M),v,x,T),(j=this.keyframeResolver)==null||j.scheduleResolve()}onKeyframesResolved(s,a,c,h){this.keyframeResolver=void 0;const{name:f,type:_,velocity:E,delay:v,isHandoff:x,onUpdate:T}=c;this.resolvedAt=zi.now(),cSe(s,f,_,E)||((_l.instantAnimations||!v)&&(T==null||T(BO(s,c,a))),s[0]=s[s.length-1],UA(c),c.repeat=0);const N={startTime:h?this.resolvedAt?this.resolvedAt-this.createdAt>hSe?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:a,...c,keyframes:s},L=!x&&uSe(N)?new oSe({...N,element:N.motionValue.owner.current}):new WO(N);L.finished.then(()=>this.notifyFinished()).catch(ta),this.pendingTimeline&&(this.stopTimeline=L.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=L}get finished(){return this._animation?this.animation.finished:this._finished}then(s,a){return this.finished.finally(s).then(()=>{})}get animation(){var s;return this._animation||((s=this.keyframeResolver)==null||s.resume(),qbe()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(s){this.animation.time=s}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(s){this.animation.speed=s}get startTime(){return this.animation.startTime}attachTimeline(s){return this._animation?this.stopTimeline=this.animation.attachTimeline(s):this.pendingTimeline=s,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var s;this._animation&&this.animation.cancel(),(s=this.keyframeResolver)==null||s.cancel()}}const mSe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function fSe(r){const s=mSe.exec(r);if(!s)return[,];const[,a,c,h]=s;return[`--${a??c}`,h]}function oz(r,s,a=1){const[c,h]=fSe(r);if(!c)return;const f=window.getComputedStyle(s).getPropertyValue(c);if(f){const _=f.trim();return NK(_)?parseFloat(_):_}return MO(h)?oz(h,s,a+1):h}function HO(r,s){return(r==null?void 0:r[s])??(r==null?void 0:r.default)??r}const az=new Set(["width","height","top","left","right","bottom",...qm]),gSe={test:r=>r==="auto",parse:r=>r},cz=r=>s=>s.test(r),lz=[Ym,Yt,Pc,rd,abe,obe,gSe],Y$=r=>lz.find(cz(r));function _Se(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||IK(r):!0}const ySe=new Set(["brightness","contrast","saturate","opacity"]);function ESe(r){const[s,a]=r.slice(0,-1).split("(");if(s==="drop-shadow")return r;const[c]=a.match(jO)||[];if(!c)return r;const h=a.replace(c,"");let f=ySe.has(s)?1:0;return c!==a&&(f*=100),s+"("+f+h+")"}const vSe=/\b([a-z-]*)\(.*?\)/gu,VA={...Pd,getAnimatableNone:r=>{const s=r.match(vSe);return s?s.map(ESe).join(" "):r}},q$={...Ym,transform:Math.round},bSe={rotate:rd,rotateX:rd,rotateY:rd,rotateZ:rd,scale:Pv,scaleX:Pv,scaleY:Pv,scaleZ:Pv,skew:rd,skewX:rd,skewY:rd,distance:Yt,translateX:Yt,translateY:Yt,translateZ:Yt,x:Yt,y:Yt,z:Yt,perspective:Yt,transformPerspective:Yt,opacity:V0,originX:M$,originY:M$,originZ:Yt},KO={borderWidth:Yt,borderTopWidth:Yt,borderRightWidth:Yt,borderBottomWidth:Yt,borderLeftWidth:Yt,borderRadius:Yt,radius:Yt,borderTopLeftRadius:Yt,borderTopRightRadius:Yt,borderBottomRightRadius:Yt,borderBottomLeftRadius:Yt,width:Yt,maxWidth:Yt,height:Yt,maxHeight:Yt,top:Yt,right:Yt,bottom:Yt,left:Yt,padding:Yt,paddingTop:Yt,paddingRight:Yt,paddingBottom:Yt,paddingLeft:Yt,margin:Yt,marginTop:Yt,marginRight:Yt,marginBottom:Yt,marginLeft:Yt,backgroundPositionX:Yt,backgroundPositionY:Yt,...bSe,zIndex:q$,fillOpacity:V0,strokeOpacity:V0,numOctaves:q$},SSe={...KO,color:hs,backgroundColor:hs,outlineColor:hs,fill:hs,stroke:hs,borderColor:hs,borderTopColor:hs,borderRightColor:hs,borderBottomColor:hs,borderLeftColor:hs,filter:VA,WebkitFilter:VA},dz=r=>SSe[r];function uz(r,s){let a=dz(r);return a!==VA&&(a=Pd),a.getAnimatableNone?a.getAnimatableNone(s):void 0}const xSe=new Set(["auto","none","0"]);function wSe(r,s,a){let c=0,h;for(;c<r.length&&!h;){const f=r[c];typeof f=="string"&&!xSe.has(f)&&F0(f).values.length&&(h=r[c]),c++}if(h&&a)for(const f of s)r[f]=uz(a,h)}class TSe extends GO{constructor(s,a,c,h,f){super(s,a,c,h,f,!0)}readKeyframes(){const{unresolvedKeyframes:s,element:a,name:c}=this;if(!a||!a.current)return;super.readKeyframes();for(let v=0;v<s.length;v++){let x=s[v];if(typeof x=="string"&&(x=x.trim(),MO(x))){const T=oz(x,a.current);T!==void 0&&(s[v]=T),v===s.length-1&&(this.finalKeyframe=x)}}if(this.resolveNoneKeyframes(),!az.has(c)||s.length!==2)return;const[h,f]=s,_=Y$(h),E=Y$(f);if(_!==E)if(G$(_)&&G$(E))for(let v=0;v<s.length;v++){const x=s[v];typeof x=="string"&&(s[v]=parseFloat(x))}else th[c]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:s,name:a}=this,c=[];for(let h=0;h<s.length;h++)(s[h]===null||_Se(s[h]))&&c.push(h);c.length&&wSe(s,c,a)}measureInitialState(){const{element:s,unresolvedKeyframes:a,name:c}=this;if(!s||!s.current)return;c==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=th[c](s.measureViewportBox(),window.getComputedStyle(s.current)),a[0]=this.measuredOrigin;const h=a[a.length-1];h!==void 0&&s.getValue(c,h).jump(h,!1)}measureEndState(){var E;const{element:s,name:a,unresolvedKeyframes:c}=this;if(!s||!s.current)return;const h=s.getValue(a);h&&h.jump(this.measuredOrigin,!1);const f=c.length-1,_=c[f];c[f]=th[a](s.measureViewportBox(),window.getComputedStyle(s.current)),_!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=_),(E=this.removedTransforms)!=null&&E.length&&this.removedTransforms.forEach(([v,x])=>{s.getValue(v).set(x)}),this.resolveNoneKeyframes()}}function CSe(r,s,a){if(r instanceof EventTarget)return[r];if(typeof r=="string"){const h=document.querySelectorAll(r);return h?Array.from(h):[]}return Array.from(r)}const hz=(r,s)=>s&&typeof r=="number"?s.transform(r):r;function RSe(r){return AK(r)&&"offsetHeight"in r}const X$=30,NSe=r=>!isNaN(parseFloat(r));class ASe{constructor(s,a={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=c=>{var f;const h=zi.now();if(this.updatedAt!==h&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(c),this.current!==this.prev&&((f=this.events.change)==null||f.notify(this.current),this.dependents))for(const _ of this.dependents)_.dirty()},this.hasAnimated=!1,this.setCurrent(s),this.owner=a.owner}setCurrent(s){this.current=s,this.updatedAt=zi.now(),this.canTrackVelocity===null&&s!==void 0&&(this.canTrackVelocity=NSe(this.current))}setPrevFrameValue(s=this.current){this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt}onChange(s){return this.on("change",s)}on(s,a){this.events[s]||(this.events[s]=new PO);const c=this.events[s].add(a);return s==="change"?()=>{c(),Lr.read(()=>{this.events.change.getSize()||this.stop()})}:c}clearListeners(){for(const s in this.events)this.events[s].clear()}attach(s,a){this.passiveEffect=s,this.stopPassiveEffect=a}set(s){this.passiveEffect?this.passiveEffect(s,this.updateAndNotify):this.updateAndNotify(s)}setWithVelocity(s,a,c){this.set(a),this.prev=void 0,this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt-c}jump(s,a=!0){this.updateAndNotify(s),this.prev=s,this.prevUpdatedAt=this.prevFrameValue=void 0,a&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var s;(s=this.events.change)==null||s.notify(this.current)}addDependent(s){this.dependents||(this.dependents=new Set),this.dependents.add(s)}removeDependent(s){this.dependents&&this.dependents.delete(s)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const s=zi.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||s-this.updatedAt>X$)return 0;const a=Math.min(this.updatedAt-this.prevUpdatedAt,X$);return OK(parseFloat(this.current)-parseFloat(this.prevFrameValue),a)}start(s){return this.stop(),new Promise(a=>{this.hasAnimated=!0,this.animation=s(a),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var s,a;(s=this.dependents)==null||s.clear(),(a=this.events.destroy)==null||a.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function jm(r,s){return new ASe(r,s)}const{schedule:zO,cancel:G1e}=$K(queueMicrotask,!1),Da={x:!1,y:!1};function pz(){return Da.x||Da.y}function ISe(r){return r==="x"||r==="y"?Da[r]?null:(Da[r]=!0,()=>{Da[r]=!1}):Da.x||Da.y?null:(Da.x=Da.y=!0,()=>{Da.x=Da.y=!1})}function mz(r,s){const a=CSe(r),c=new AbortController,h={passive:!0,...s,signal:c.signal};return[a,h,()=>c.abort()]}function J$(r){return!(r.pointerType==="touch"||pz())}function OSe(r,s,a={}){const[c,h,f]=mz(r,a),_=E=>{if(!J$(E))return;const{target:v}=E,x=s(v,E);if(typeof x!="function"||!v)return;const T=R=>{J$(R)&&(x(R),v.removeEventListener("pointerleave",T))};v.addEventListener("pointerleave",T,h)};return c.forEach(E=>{E.addEventListener("pointerenter",_,h)}),f}const fz=(r,s)=>s?r===s?!0:fz(r,s.parentElement):!1,YO=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1,PSe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function DSe(r){return PSe.has(r.tagName)||r.tabIndex!==-1}const rb=new WeakSet;function Q$(r){return s=>{s.key==="Enter"&&r(s)}}function JN(r,s){r.dispatchEvent(new PointerEvent("pointer"+s,{isPrimary:!0,bubbles:!0}))}const kSe=(r,s)=>{const a=r.currentTarget;if(!a)return;const c=Q$(()=>{if(rb.has(a))return;JN(a,"down");const h=Q$(()=>{JN(a,"up")}),f=()=>JN(a,"cancel");a.addEventListener("keyup",h,s),a.addEventListener("blur",f,s)});a.addEventListener("keydown",c,s),a.addEventListener("blur",()=>a.removeEventListener("keydown",c),s)};function Z$(r){return YO(r)&&!pz()}function LSe(r,s,a={}){const[c,h,f]=mz(r,a),_=E=>{const v=E.currentTarget;if(!Z$(E))return;rb.add(v);const x=s(v,E),T=(L,j)=>{window.removeEventListener("pointerup",R),window.removeEventListener("pointercancel",N),rb.has(v)&&rb.delete(v),Z$(L)&&typeof x=="function"&&x(L,{success:j})},R=L=>{T(L,v===window||v===document||a.useGlobalTarget||fz(v,L.target))},N=L=>{T(L,!1)};window.addEventListener("pointerup",R,h),window.addEventListener("pointercancel",N,h)};return c.forEach(E=>{(a.useGlobalTarget?window:E).addEventListener("pointerdown",_,h),RSe(E)&&(E.addEventListener("focus",x=>kSe(x,h)),!DSe(E)&&!E.hasAttribute("tabindex")&&(E.tabIndex=0))}),f}function gz(r){return AK(r)&&"ownerSVGElement"in r}function MSe(r){return gz(r)&&r.tagName==="svg"}const ci=r=>!!(r&&r.getVelocity),jSe=[...lz,hs,Pd],USe=r=>jSe.find(cz(r)),_z=V.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"});function VSe(r=!0){const s=V.useContext(NO);if(s===null)return[!0,null];const{isPresent:a,onExitComplete:c,register:h}=s,f=V.useId();V.useEffect(()=>{if(r)return h(f)},[r]);const _=V.useCallback(()=>r&&c&&c(f),[f,c,r]);return!a&&c?[!1,_]:[!0]}const yz=V.createContext({strict:!1}),eW={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Um={};for(const r in eW)Um[r]={isEnabled:s=>eW[r].some(a=>!!s[a])};function FSe(r){for(const s in r)Um[s]={...Um[s],...r[s]}}const BSe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function qb(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||BSe.has(r)}let Ez=r=>!qb(r);function $Se(r){typeof r=="function"&&(Ez=s=>s.startsWith("on")?!qb(s):r(s))}try{$Se(require("@emotion/is-prop-valid").default)}catch{}function WSe(r,s,a){const c={};for(const h in r)h==="values"&&typeof r.values=="object"||(Ez(h)||a===!0&&qb(h)||!s&&!qb(h)||r.draggable&&h.startsWith("onDrag"))&&(c[h]=r[h]);return c}const IS=V.createContext({});function OS(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}function B0(r){return typeof r=="string"||Array.isArray(r)}const qO=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],XO=["initial",...qO];function PS(r){return OS(r.animate)||XO.some(s=>B0(r[s]))}function vz(r){return!!(PS(r)||r.variants)}function GSe(r,s){if(PS(r)){const{initial:a,animate:c}=r;return{initial:a===!1||B0(a)?a:void 0,animate:B0(c)?c:void 0}}return r.inherit!==!1?s:{}}function HSe(r){const{initial:s,animate:a}=GSe(r,V.useContext(IS));return V.useMemo(()=>({initial:s,animate:a}),[tW(s),tW(a)])}function tW(r){return Array.isArray(r)?r.join(" "):r}const $0={};function KSe(r){for(const s in r)$0[s]=r[s],LO(s)&&($0[s].isCSSVariable=!0)}function bz(r,{layout:s,layoutId:a}){return Xm.has(r)||r.startsWith("origin")||(s||a!==void 0)&&(!!$0[r]||r==="opacity")}const zSe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},YSe=qm.length;function qSe(r,s,a){let c="",h=!0;for(let f=0;f<YSe;f++){const _=qm[f],E=r[_];if(E===void 0)continue;let v=!0;if(typeof E=="number"?v=E===(_.startsWith("scale")?1:0):v=parseFloat(E)===0,!v||a){const x=hz(E,KO[_]);if(!v){h=!1;const T=zSe[_]||_;c+=`${T}(${x}) `}a&&(s[_]=x)}}return c=c.trim(),a?c=a(s,h?"":c):h&&(c="none"),c}function JO(r,s,a){const{style:c,vars:h,transformOrigin:f}=r;let _=!1,E=!1;for(const v in s){const x=s[v];if(Xm.has(v)){_=!0;continue}else if(LO(v)){h[v]=x;continue}else{const T=hz(x,KO[v]);v.startsWith("origin")?(E=!0,f[v]=T):c[v]=T}}if(s.transform||(_||a?c.transform=qSe(s,r.transform,a):c.transform&&(c.transform="none")),E){const{originX:v="50%",originY:x="50%",originZ:T=0}=f;c.transformOrigin=`${v} ${x} ${T}`}}const QO=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Sz(r,s,a){for(const c in s)!ci(s[c])&&!bz(c,a)&&(r[c]=s[c])}function XSe({transformTemplate:r},s){return V.useMemo(()=>{const a=QO();return JO(a,s,r),Object.assign({},a.vars,a.style)},[s])}function JSe(r,s){const a=r.style||{},c={};return Sz(c,a,r),Object.assign(c,XSe(r,s)),c}function QSe(r,s){const a={},c=JSe(r,s);return r.drag&&r.dragListener!==!1&&(a.draggable=!1,c.userSelect=c.WebkitUserSelect=c.WebkitTouchCallout="none",c.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(a.tabIndex=0),a.style=c,a}const ZSe={offset:"stroke-dashoffset",array:"stroke-dasharray"},exe={offset:"strokeDashoffset",array:"strokeDasharray"};function txe(r,s,a=1,c=0,h=!0){r.pathLength=1;const f=h?ZSe:exe;r[f.offset]=Yt.transform(-c);const _=Yt.transform(s),E=Yt.transform(a);r[f.array]=`${_} ${E}`}function xz(r,{attrX:s,attrY:a,attrScale:c,pathLength:h,pathSpacing:f=1,pathOffset:_=0,...E},v,x,T){if(JO(r,E,x),v){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:R,style:N}=r;R.transform&&(N.transform=R.transform,delete R.transform),(N.transform||R.transformOrigin)&&(N.transformOrigin=R.transformOrigin??"50% 50%",delete R.transformOrigin),N.transform&&(N.transformBox=(T==null?void 0:T.transformBox)??"fill-box",delete R.transformBox),s!==void 0&&(R.x=s),a!==void 0&&(R.y=a),c!==void 0&&(R.scale=c),h!==void 0&&txe(R,h,f,_,!1)}const wz=()=>({...QO(),attrs:{}}),Tz=r=>typeof r=="string"&&r.toLowerCase()==="svg";function nxe(r,s,a,c){const h=V.useMemo(()=>{const f=wz();return xz(f,s,Tz(c),r.transformTemplate,r.style),{...f.attrs,style:{...f.style}}},[s]);if(r.style){const f={};Sz(f,r.style,r),h.style={...f,...h.style}}return h}const rxe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function ZO(r){return typeof r!="string"||r.includes("-")?!1:!!(rxe.indexOf(r)>-1||/[A-Z]/u.test(r))}function sxe(r,s,a,{latestValues:c},h,f=!1){const E=(ZO(r)?nxe:QSe)(s,c,h,r),v=WSe(s,typeof r=="string",f),x=r!==V.Fragment?{...v,...E,ref:a}:{},{children:T}=s,R=V.useMemo(()=>ci(T)?T.get():T,[T]);return V.createElement(r,{...x,children:R})}function nW(r){const s=[{},{}];return r==null||r.values.forEach((a,c)=>{s[0][c]=a.get(),s[1][c]=a.getVelocity()}),s}function e2(r,s,a,c){if(typeof s=="function"){const[h,f]=nW(c);s=s(a!==void 0?a:r.custom,h,f)}if(typeof s=="string"&&(s=r.variants&&r.variants[s]),typeof s=="function"){const[h,f]=nW(c);s=s(a!==void 0?a:r.custom,h,f)}return s}function sb(r){return ci(r)?r.get():r}function ixe({scrapeMotionValuesFromProps:r,createRenderState:s},a,c,h){return{latestValues:oxe(a,c,h,r),renderState:s()}}function oxe(r,s,a,c){const h={},f=c(r,{});for(const N in f)h[N]=sb(f[N]);let{initial:_,animate:E}=r;const v=PS(r),x=vz(r);s&&x&&!v&&r.inherit!==!1&&(_===void 0&&(_=s.initial),E===void 0&&(E=s.animate));let T=a?a.initial===!1:!1;T=T||_===!1;const R=T?E:_;if(R&&typeof R!="boolean"&&!OS(R)){const N=Array.isArray(R)?R:[R];for(let L=0;L<N.length;L++){const j=e2(r,N[L]);if(j){const{transitionEnd:F,transition:P,...M}=j;for(const U in M){let B=M[U];if(Array.isArray(B)){const K=T?B.length-1:0;B=B[K]}B!==null&&(h[U]=B)}for(const U in F)h[U]=F[U]}}}return h}const Cz=r=>(s,a)=>{const c=V.useContext(IS),h=V.useContext(NO),f=()=>ixe(r,s,c,h);return a?f():Bve(f)};function t2(r,s,a){var f;const{style:c}=r,h={};for(const _ in c)(ci(c[_])||s.style&&ci(s.style[_])||bz(_,r)||((f=a==null?void 0:a.getValue(_))==null?void 0:f.liveStyle)!==void 0)&&(h[_]=c[_]);return h}const axe=Cz({scrapeMotionValuesFromProps:t2,createRenderState:QO});function Rz(r,s,a){const c=t2(r,s,a);for(const h in r)if(ci(r[h])||ci(s[h])){const f=qm.indexOf(h)!==-1?"attr"+h.charAt(0).toUpperCase()+h.substring(1):h;c[f]=r[h]}return c}const cxe=Cz({scrapeMotionValuesFromProps:Rz,createRenderState:wz}),lxe=Symbol.for("motionComponentSymbol");function om(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function dxe(r,s,a){return V.useCallback(c=>{c&&r.onMount&&r.onMount(c),s&&(c?s.mount(c):s.unmount()),a&&(typeof a=="function"?a(c):om(a)&&(a.current=c))},[s])}const n2=r=>r.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),uxe="framerAppearId",Nz="data-"+n2(uxe),Az=V.createContext({});function hxe(r,s,a,c,h){var F,P;const{visualElement:f}=V.useContext(IS),_=V.useContext(yz),E=V.useContext(NO),v=V.useContext(_z).reducedMotion,x=V.useRef(null);c=c||_.renderer,!x.current&&c&&(x.current=c(r,{visualState:s,parent:f,props:a,presenceContext:E,blockInitialAnimation:E?E.initial===!1:!1,reducedMotionConfig:v}));const T=x.current,R=V.useContext(Az);T&&!T.projection&&h&&(T.type==="html"||T.type==="svg")&&pxe(x.current,a,h,R);const N=V.useRef(!1);V.useInsertionEffect(()=>{T&&N.current&&T.update(a,E)});const L=a[Nz],j=V.useRef(!!L&&!((F=window.MotionHandoffIsComplete)!=null&&F.call(window,L))&&((P=window.MotionHasOptimisedAnimation)==null?void 0:P.call(window,L)));return $ve(()=>{T&&(N.current=!0,window.MotionIsMounted=!0,T.updateFeatures(),T.scheduleRenderMicrotask(),j.current&&T.animationState&&T.animationState.animateChanges())}),V.useEffect(()=>{T&&(!j.current&&T.animationState&&T.animationState.animateChanges(),j.current&&(queueMicrotask(()=>{var M;(M=window.MotionHandoffMarkAsComplete)==null||M.call(window,L)}),j.current=!1),T.enteringChildren=void 0)}),T}function pxe(r,s,a,c){const{layoutId:h,layout:f,drag:_,dragConstraints:E,layoutScroll:v,layoutRoot:x,layoutCrossfade:T}=s;r.projection=new a(r.latestValues,s["data-framer-portal-id"]?void 0:Iz(r.parent)),r.projection.setOptions({layoutId:h,layout:f,alwaysMeasureLayout:!!_||E&&om(E),visualElement:r,animationType:typeof f=="string"?f:"both",initialPromotionConfig:c,crossfade:T,layoutScroll:v,layoutRoot:x})}function Iz(r){if(r)return r.options.allowProjection!==!1?r.projection:Iz(r.parent)}function QN(r,{forwardMotionProps:s=!1}={},a,c){a&&FSe(a);const h=ZO(r)?cxe:axe;function f(E,v){let x;const T={...V.useContext(_z),...E,layoutId:mxe(E)},{isStatic:R}=T,N=HSe(E),L=h(E,R);if(!R&&RO){fxe();const j=gxe(T);x=j.MeasureLayout,N.visualElement=hxe(r,L,T,c,j.ProjectionNode)}return d.jsxs(IS.Provider,{value:N,children:[x&&N.visualElement?d.jsx(x,{visualElement:N.visualElement,...T}):null,sxe(r,E,dxe(L,N.visualElement,v),L,R,s)]})}f.displayName=`motion.${typeof r=="string"?r:`create(${r.displayName??r.name??""})`}`;const _=V.forwardRef(f);return _[lxe]=r,_}function mxe({layoutId:r}){const s=V.useContext(RK).id;return s&&r!==void 0?s+"-"+r:r}function fxe(r,s){V.useContext(yz).strict}function gxe(r){const{drag:s,layout:a}=Um;if(!s&&!a)return{};const c={...s,...a};return{MeasureLayout:s!=null&&s.isEnabled(r)||a!=null&&a.isEnabled(r)?c.MeasureLayout:void 0,ProjectionNode:c.ProjectionNode}}function _xe(r,s){if(typeof Proxy>"u")return QN;const a=new Map,c=(f,_)=>QN(f,_,r,s),h=(f,_)=>c(f,_);return new Proxy(h,{get:(f,_)=>_==="create"?c:(a.has(_)||a.set(_,QN(_,void 0,r,s)),a.get(_))})}function Oz({top:r,left:s,right:a,bottom:c}){return{x:{min:s,max:a},y:{min:r,max:c}}}function yxe({x:r,y:s}){return{top:s.min,right:r.max,bottom:s.max,left:r.min}}function Exe(r,s){if(!s)return r;const a=s({x:r.left,y:r.top}),c=s({x:r.right,y:r.bottom});return{top:a.y,left:a.x,bottom:c.y,right:c.x}}function ZN(r){return r===void 0||r===1}function FA({scale:r,scaleX:s,scaleY:a}){return!ZN(r)||!ZN(s)||!ZN(a)}function ju(r){return FA(r)||Pz(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function Pz(r){return rW(r.x)||rW(r.y)}function rW(r){return r&&r!=="0%"}function Xb(r,s,a){const c=r-a,h=s*c;return a+h}function sW(r,s,a,c,h){return h!==void 0&&(r=Xb(r,h,c)),Xb(r,a,c)+s}function BA(r,s=0,a=1,c,h){r.min=sW(r.min,s,a,c,h),r.max=sW(r.max,s,a,c,h)}function Dz(r,{x:s,y:a}){BA(r.x,s.translate,s.scale,s.originPoint),BA(r.y,a.translate,a.scale,a.originPoint)}const iW=.999999999999,oW=1.0000000000001;function vxe(r,s,a,c=!1){const h=a.length;if(!h)return;s.x=s.y=1;let f,_;for(let E=0;E<h;E++){f=a[E],_=f.projectionDelta;const{visualElement:v}=f.options;v&&v.props.style&&v.props.style.display==="contents"||(c&&f.options.layoutScroll&&f.scroll&&f!==f.root&&cm(r,{x:-f.scroll.offset.x,y:-f.scroll.offset.y}),_&&(s.x*=_.x.scale,s.y*=_.y.scale,Dz(r,_)),c&&ju(f.latestValues)&&cm(r,f.latestValues))}s.x<oW&&s.x>iW&&(s.x=1),s.y<oW&&s.y>iW&&(s.y=1)}function am(r,s){r.min=r.min+s,r.max=r.max+s}function aW(r,s,a,c,h=.5){const f=Gr(r.min,r.max,h);BA(r,s,a,f,c)}function cm(r,s){aW(r.x,s.x,s.scaleX,s.scale,s.originX),aW(r.y,s.y,s.scaleY,s.scale,s.originY)}function kz(r,s){return Oz(Exe(r.getBoundingClientRect(),s))}function bxe(r,s,a){const c=kz(r,a),{scroll:h}=s;return h&&(am(c.x,h.offset.x),am(c.y,h.offset.y)),c}const cW=()=>({translate:0,scale:1,origin:0,originPoint:0}),lm=()=>({x:cW(),y:cW()}),lW=()=>({min:0,max:0}),ss=()=>({x:lW(),y:lW()}),$A={current:null},Lz={current:!1};function Sxe(){if(Lz.current=!0,!!RO)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),s=()=>$A.current=r.matches;r.addEventListener("change",s),s()}else $A.current=!1}const xxe=new WeakMap;function wxe(r,s,a){for(const c in s){const h=s[c],f=a[c];if(ci(h))r.addValue(c,h);else if(ci(f))r.addValue(c,jm(h,{owner:r}));else if(f!==h)if(r.hasValue(c)){const _=r.getValue(c);_.liveStyle===!0?_.jump(h):_.hasAnimated||_.set(h)}else{const _=r.getStaticValue(c);r.addValue(c,jm(_!==void 0?_:h,{owner:r}))}}for(const c in a)s[c]===void 0&&r.removeValue(c);return s}const dW=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Txe{scrapeMotionValuesFromProps(s,a,c){return{}}constructor({parent:s,props:a,presenceContext:c,reducedMotionConfig:h,blockInitialAnimation:f,visualState:_},E={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=GO,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const N=zi.now();this.renderScheduledAt<N&&(this.renderScheduledAt=N,Lr.render(this.render,!1,!0))};const{latestValues:v,renderState:x}=_;this.latestValues=v,this.baseTarget={...v},this.initialValues=a.initial?{...v}:{},this.renderState=x,this.parent=s,this.props=a,this.presenceContext=c,this.depth=s?s.depth+1:0,this.reducedMotionConfig=h,this.options=E,this.blockInitialAnimation=!!f,this.isControllingVariants=PS(a),this.isVariantNode=vz(a),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(s&&s.current);const{willChange:T,...R}=this.scrapeMotionValuesFromProps(a,{},this);for(const N in R){const L=R[N];v[N]!==void 0&&ci(L)&&L.set(v[N])}}mount(s){var a;this.current=s,xxe.set(s,this),this.projection&&!this.projection.instance&&this.projection.mount(s),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((c,h)=>this.bindToMotionValue(h,c)),Lz.current||Sxe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:$A.current,(a=this.parent)==null||a.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var s;this.projection&&this.projection.unmount(),Od(this.notifyUpdate),Od(this.render),this.valueSubscriptions.forEach(a=>a()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(s=this.parent)==null||s.removeChild(this);for(const a in this.events)this.events[a].clear();for(const a in this.features){const c=this.features[a];c&&(c.unmount(),c.isMounted=!1)}this.current=null}addChild(s){this.children.add(s),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(s)}removeChild(s){this.children.delete(s),this.enteringChildren&&this.enteringChildren.delete(s)}bindToMotionValue(s,a){this.valueSubscriptions.has(s)&&this.valueSubscriptions.get(s)();const c=Xm.has(s);c&&this.onBindTransform&&this.onBindTransform();const h=a.on("change",_=>{this.latestValues[s]=_,this.props.onUpdate&&Lr.preRender(this.notifyUpdate),c&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,s,a)),this.valueSubscriptions.set(s,()=>{h(),f&&f(),a.owner&&a.stop()})}sortNodePosition(s){return!this.current||!this.sortInstanceNodePosition||this.type!==s.type?0:this.sortInstanceNodePosition(this.current,s.current)}updateFeatures(){let s="animation";for(s in Um){const a=Um[s];if(!a)continue;const{isEnabled:c,Feature:h}=a;if(!this.features[s]&&h&&c(this.props)&&(this.features[s]=new h(this)),this.features[s]){const f=this.features[s];f.isMounted?f.update():(f.mount(),f.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ss()}getStaticValue(s){return this.latestValues[s]}setStaticValue(s,a){this.latestValues[s]=a}update(s,a){(s.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=s,this.prevPresenceContext=this.presenceContext,this.presenceContext=a;for(let c=0;c<dW.length;c++){const h=dW[c];this.propEventSubscriptions[h]&&(this.propEventSubscriptions[h](),delete this.propEventSubscriptions[h]);const f="on"+h,_=s[f];_&&(this.propEventSubscriptions[h]=this.on(h,_))}this.prevMotionValues=wxe(this,this.scrapeMotionValuesFromProps(s,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(s){return this.props.variants?this.props.variants[s]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(s){const a=this.getClosestVariantNode();if(a)return a.variantChildren&&a.variantChildren.add(s),()=>a.variantChildren.delete(s)}addValue(s,a){const c=this.values.get(s);a!==c&&(c&&this.removeValue(s),this.bindToMotionValue(s,a),this.values.set(s,a),this.latestValues[s]=a.get())}removeValue(s){this.values.delete(s);const a=this.valueSubscriptions.get(s);a&&(a(),this.valueSubscriptions.delete(s)),delete this.latestValues[s],this.removeValueFromRenderState(s,this.renderState)}hasValue(s){return this.values.has(s)}getValue(s,a){if(this.props.values&&this.props.values[s])return this.props.values[s];let c=this.values.get(s);return c===void 0&&a!==void 0&&(c=jm(a===null?void 0:a,{owner:this}),this.addValue(s,c)),c}readValue(s,a){let c=this.latestValues[s]!==void 0||!this.current?this.latestValues[s]:this.getBaseTargetFromProps(this.props,s)??this.readValueFromInstance(this.current,s,this.options);return c!=null&&(typeof c=="string"&&(NK(c)||IK(c))?c=parseFloat(c):!USe(c)&&Pd.test(a)&&(c=uz(s,a)),this.setBaseTarget(s,ci(c)?c.get():c)),ci(c)?c.get():c}setBaseTarget(s,a){this.baseTarget[s]=a}getBaseTarget(s){var f;const{initial:a}=this.props;let c;if(typeof a=="string"||typeof a=="object"){const _=e2(this.props,a,(f=this.presenceContext)==null?void 0:f.custom);_&&(c=_[s])}if(a&&c!==void 0)return c;const h=this.getBaseTargetFromProps(this.props,s);return h!==void 0&&!ci(h)?h:this.initialValues[s]!==void 0&&c===void 0?void 0:this.baseTarget[s]}on(s,a){return this.events[s]||(this.events[s]=new PO),this.events[s].add(a)}notify(s,...a){this.events[s]&&this.events[s].notify(...a)}scheduleRenderMicrotask(){zO.render(this.render)}}class Mz extends Txe{constructor(){super(...arguments),this.KeyframeResolver=TSe}sortInstanceNodePosition(s,a){return s.compareDocumentPosition(a)&2?1:-1}getBaseTargetFromProps(s,a){return s.style?s.style[a]:void 0}removeValueFromRenderState(s,{vars:a,style:c}){delete a[s],delete c[s]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:s}=this.props;ci(s)&&(this.childSubscription=s.on("change",a=>{this.current&&(this.current.textContent=`${a}`)}))}}function jz(r,{style:s,vars:a},c,h){const f=r.style;let _;for(_ in s)f[_]=s[_];h==null||h.applyProjectionStyles(f,c);for(_ in a)f.setProperty(_,a[_])}function Cxe(r){return window.getComputedStyle(r)}class Rxe extends Mz{constructor(){super(...arguments),this.type="html",this.renderInstance=jz}readValueFromInstance(s,a){var c;if(Xm.has(a))return(c=this.projection)!=null&&c.isProjecting?DA(a):Gbe(s,a);{const h=Cxe(s),f=(LO(a)?h.getPropertyValue(a):h[a])||0;return typeof f=="string"?f.trim():f}}measureInstanceViewportBox(s,{transformPagePoint:a}){return kz(s,a)}build(s,a,c){JO(s,a,c.transformTemplate)}scrapeMotionValuesFromProps(s,a,c){return t2(s,a,c)}}const Uz=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Nxe(r,s,a,c){jz(r,s,void 0,c);for(const h in s.attrs)r.setAttribute(Uz.has(h)?h:n2(h),s.attrs[h])}class Axe extends Mz{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ss}getBaseTargetFromProps(s,a){return s[a]}readValueFromInstance(s,a){if(Xm.has(a)){const c=dz(a);return c&&c.default||0}return a=Uz.has(a)?a:n2(a),s.getAttribute(a)}scrapeMotionValuesFromProps(s,a,c){return Rz(s,a,c)}build(s,a,c){xz(s,a,this.isSVGTag,c.transformTemplate,c.style)}renderInstance(s,a,c,h){Nxe(s,a,c,h)}mount(s){this.isSVGTag=Tz(s.tagName),super.mount(s)}}const Ixe=(r,s)=>ZO(r)?new Axe(s):new Rxe(s,{allowProjection:r!==V.Fragment});function ym(r,s,a){const c=r.getProps();return e2(c,s,a!==void 0?a:c.custom,r)}const WA=r=>Array.isArray(r);function Oxe(r,s,a){r.hasValue(s)?r.getValue(s).set(a):r.addValue(s,jm(a))}function Pxe(r){return WA(r)?r[r.length-1]||0:r}function Dxe(r,s){const a=ym(r,s);let{transitionEnd:c={},transition:h={},...f}=a||{};f={...f,...c};for(const _ in f){const E=Pxe(f[_]);Oxe(r,_,E)}}function kxe(r){return!!(ci(r)&&r.add)}function GA(r,s){const a=r.getValue("willChange");if(kxe(a))return a.add(s);if(!a&&_l.WillChange){const c=new _l.WillChange("auto");r.addValue("willChange",c),c.add(s)}}function Vz(r){return r.props[Nz]}const Lxe=r=>r!==null;function Mxe(r,{repeat:s,repeatType:a="loop"},c){const h=r.filter(Lxe),f=s&&a!=="loop"&&s%2===1?0:h.length-1;return!f||c===void 0?h[f]:c}const jxe={type:"spring",stiffness:500,damping:25,restSpeed:10},Uxe=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),Vxe={type:"keyframes",duration:.8},Fxe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Bxe=(r,{keyframes:s})=>s.length>2?Vxe:Xm.has(r)?r.startsWith("scale")?Uxe(s[1]):jxe:Fxe;function $xe({when:r,delay:s,delayChildren:a,staggerChildren:c,staggerDirection:h,repeat:f,repeatType:_,repeatDelay:E,from:v,elapsed:x,...T}){return!!Object.keys(T).length}const r2=(r,s,a,c={},h,f)=>_=>{const E=HO(c,r)||{},v=E.delay||c.delay||0;let{elapsed:x=0}=c;x=x-Ic(v);const T={keyframes:Array.isArray(a)?a:[null,a],ease:"easeOut",velocity:s.getVelocity(),...E,delay:-x,onUpdate:N=>{s.set(N),E.onUpdate&&E.onUpdate(N)},onComplete:()=>{_(),E.onComplete&&E.onComplete()},name:r,motionValue:s,element:f?void 0:h};$xe(E)||Object.assign(T,Bxe(r,T)),T.duration&&(T.duration=Ic(T.duration)),T.repeatDelay&&(T.repeatDelay=Ic(T.repeatDelay)),T.from!==void 0&&(T.keyframes[0]=T.from);let R=!1;if((T.type===!1||T.duration===0&&!T.repeatDelay)&&(UA(T),T.delay===0&&(R=!0)),(_l.instantAnimations||_l.skipAnimations)&&(R=!0,UA(T),T.delay=0),T.allowFlatten=!E.type&&!E.ease,R&&!f&&s.get()!==void 0){const N=Mxe(T.keyframes,E);if(N!==void 0){Lr.update(()=>{T.onUpdate(N),T.onComplete()});return}}return E.isSync?new WO(T):new pSe(T)};function Wxe({protectedKeys:r,needsAnimating:s},a){const c=r.hasOwnProperty(a)&&s[a]!==!0;return s[a]=!1,c}function Fz(r,s,{delay:a=0,transitionOverride:c,type:h}={}){let{transition:f=r.getDefaultTransition(),transitionEnd:_,...E}=s;c&&(f=c);const v=[],x=h&&r.animationState&&r.animationState.getState()[h];for(const T in E){const R=r.getValue(T,r.latestValues[T]??null),N=E[T];if(N===void 0||x&&Wxe(x,T))continue;const L={delay:a,...HO(f||{},T)},j=R.get();if(j!==void 0&&!R.isAnimating&&!Array.isArray(N)&&N===j&&!L.velocity)continue;let F=!1;if(window.MotionHandoffAnimation){const M=Vz(r);if(M){const U=window.MotionHandoffAnimation(M,T,Lr);U!==null&&(L.startTime=U,F=!0)}}GA(r,T),R.start(r2(T,R,N,r.shouldReduceMotion&&az.has(T)?{type:!1}:L,r,F));const P=R.animation;P&&v.push(P)}return _&&Promise.all(v).then(()=>{Lr.update(()=>{_&&Dxe(r,_)})}),v}function Bz(r,s,a,c=0,h=1){const f=Array.from(r).sort((x,T)=>x.sortNodePosition(T)).indexOf(s),_=r.size,E=(_-1)*c;return typeof a=="function"?a(f,_):h===1?f*c:E-f*c}function HA(r,s,a={}){var v;const c=ym(r,s,a.type==="exit"?(v=r.presenceContext)==null?void 0:v.custom:void 0);let{transition:h=r.getDefaultTransition()||{}}=c||{};a.transitionOverride&&(h=a.transitionOverride);const f=c?()=>Promise.all(Fz(r,c,a)):()=>Promise.resolve(),_=r.variantChildren&&r.variantChildren.size?(x=0)=>{const{delayChildren:T=0,staggerChildren:R,staggerDirection:N}=h;return Gxe(r,s,x,T,R,N,a)}:()=>Promise.resolve(),{when:E}=h;if(E){const[x,T]=E==="beforeChildren"?[f,_]:[_,f];return x().then(()=>T())}else return Promise.all([f(),_(a.delay)])}function Gxe(r,s,a=0,c=0,h=0,f=1,_){const E=[];for(const v of r.variantChildren)v.notify("AnimationStart",s),E.push(HA(v,s,{..._,delay:a+(typeof c=="function"?0:c)+Bz(r.variantChildren,v,c,h,f)}).then(()=>v.notify("AnimationComplete",s)));return Promise.all(E)}function Hxe(r,s,a={}){r.notify("AnimationStart",s);let c;if(Array.isArray(s)){const h=s.map(f=>HA(r,f,a));c=Promise.all(h)}else if(typeof s=="string")c=HA(r,s,a);else{const h=typeof s=="function"?ym(r,s,a.custom):s;c=Promise.all(Fz(r,h,a))}return c.then(()=>{r.notify("AnimationComplete",s)})}function $z(r,s){if(!Array.isArray(s))return!1;const a=s.length;if(a!==r.length)return!1;for(let c=0;c<a;c++)if(s[c]!==r[c])return!1;return!0}const Kxe=XO.length;function Wz(r){if(!r)return;if(!r.isControllingVariants){const a=r.parent?Wz(r.parent)||{}:{};return r.props.initial!==void 0&&(a.initial=r.props.initial),a}const s={};for(let a=0;a<Kxe;a++){const c=XO[a],h=r.props[c];(B0(h)||h===!1)&&(s[c]=h)}return s}const zxe=[...qO].reverse(),Yxe=qO.length;function qxe(r){return s=>Promise.all(s.map(({animation:a,options:c})=>Hxe(r,a,c)))}function Xxe(r){let s=qxe(r),a=uW(),c=!0;const h=v=>(x,T)=>{var N;const R=ym(r,T,v==="exit"?(N=r.presenceContext)==null?void 0:N.custom:void 0);if(R){const{transition:L,transitionEnd:j,...F}=R;x={...x,...F,...j}}return x};function f(v){s=v(r)}function _(v){const{props:x}=r,T=Wz(r.parent)||{},R=[],N=new Set;let L={},j=1/0;for(let P=0;P<Yxe;P++){const M=zxe[P],U=a[M],B=x[M]!==void 0?x[M]:T[M],K=B0(B),J=M===v?U.isActive:null;J===!1&&(j=P);let te=B===T[M]&&B!==x[M]&&K;if(te&&c&&r.manuallyAnimateOnMount&&(te=!1),U.protectedKeys={...L},!U.isActive&&J===null||!B&&!U.prevProp||OS(B)||typeof B=="boolean")continue;const se=Jxe(U.prevProp,B);let ie=se||M===v&&U.isActive&&!te&&K||P>j&&K,ue=!1;const de=Array.isArray(B)?B:[B];let Ne=de.reduce(h(M),{});J===!1&&(Ne={});const{prevResolvedValues:Ce={}}=U,tt={...Ce,...Ne},Se=Re=>{ie=!0,N.has(Re)&&(ue=!0,N.delete(Re)),U.needsAnimating[Re]=!0;const le=r.getValue(Re);le&&(le.liveStyle=!1)};for(const Re in tt){const le=Ne[Re],ve=Ce[Re];if(L.hasOwnProperty(Re))continue;let Le=!1;WA(le)&&WA(ve)?Le=!$z(le,ve):Le=le!==ve,Le?le!=null?Se(Re):N.add(Re):le!==void 0&&N.has(Re)?Se(Re):U.protectedKeys[Re]=!0}U.prevProp=B,U.prevResolvedValues=Ne,U.isActive&&(L={...L,...Ne}),c&&r.blockInitialAnimation&&(ie=!1);const Ge=te&&se;ie&&(!Ge||ue)&&R.push(...de.map(Re=>{const le={type:M};if(typeof Re=="string"&&c&&!Ge&&r.manuallyAnimateOnMount&&r.parent){const{parent:ve}=r,Le=ym(ve,Re);if(ve.enteringChildren&&Le){const{delayChildren:qe}=Le.transition||{};le.delay=Bz(ve.enteringChildren,r,qe)}}return{animation:Re,options:le}}))}if(N.size){const P={};if(typeof x.initial!="boolean"){const M=ym(r,Array.isArray(x.initial)?x.initial[0]:x.initial);M&&M.transition&&(P.transition=M.transition)}N.forEach(M=>{const U=r.getBaseTarget(M),B=r.getValue(M);B&&(B.liveStyle=!0),P[M]=U??null}),R.push({animation:P})}let F=!!R.length;return c&&(x.initial===!1||x.initial===x.animate)&&!r.manuallyAnimateOnMount&&(F=!1),c=!1,F?s(R):Promise.resolve()}function E(v,x){var R;if(a[v].isActive===x)return Promise.resolve();(R=r.variantChildren)==null||R.forEach(N=>{var L;return(L=N.animationState)==null?void 0:L.setActive(v,x)}),a[v].isActive=x;const T=_(v);for(const N in a)a[N].protectedKeys={};return T}return{animateChanges:_,setActive:E,setAnimateFunction:f,getState:()=>a,reset:()=>{a=uW(),c=!0}}}function Jxe(r,s){return typeof s=="string"?s!==r:Array.isArray(s)?!$z(s,r):!1}function Du(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function uW(){return{animate:Du(!0),whileInView:Du(),whileHover:Du(),whileTap:Du(),whileDrag:Du(),whileFocus:Du(),exit:Du()}}class jd{constructor(s){this.isMounted=!1,this.node=s}update(){}}class Qxe extends jd{constructor(s){super(s),s.animationState||(s.animationState=Xxe(s))}updateAnimationControlsSubscription(){const{animate:s}=this.node.getProps();OS(s)&&(this.unmountControls=s.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:s}=this.node.getProps(),{animate:a}=this.node.prevProps||{};s!==a&&this.updateAnimationControlsSubscription()}unmount(){var s;this.node.animationState.reset(),(s=this.unmountControls)==null||s.call(this)}}let Zxe=0;class ewe extends jd{constructor(){super(...arguments),this.id=Zxe++}update(){if(!this.node.presenceContext)return;const{isPresent:s,onExitComplete:a}=this.node.presenceContext,{isPresent:c}=this.node.prevPresenceContext||{};if(!this.node.animationState||s===c)return;const h=this.node.animationState.setActive("exit",!s);a&&!s&&h.then(()=>{a(this.id)})}mount(){const{register:s,onExitComplete:a}=this.node.presenceContext||{};a&&a(this.id),s&&(this.unmount=s(this.id))}unmount(){}}const twe={animation:{Feature:Qxe},exit:{Feature:ewe}};function W0(r,s,a,c={passive:!0}){return r.addEventListener(s,a,c),()=>r.removeEventListener(s,a)}function l_(r){return{point:{x:r.pageX,y:r.pageY}}}const nwe=r=>s=>YO(s)&&r(s,l_(s));function c0(r,s,a,c){return W0(r,s,nwe(a),c)}const Gz=1e-4,rwe=1-Gz,swe=1+Gz,Hz=.01,iwe=0-Hz,owe=0+Hz;function Ti(r){return r.max-r.min}function awe(r,s,a){return Math.abs(r-s)<=a}function hW(r,s,a,c=.5){r.origin=c,r.originPoint=Gr(s.min,s.max,r.origin),r.scale=Ti(a)/Ti(s),r.translate=Gr(a.min,a.max,r.origin)-r.originPoint,(r.scale>=rwe&&r.scale<=swe||isNaN(r.scale))&&(r.scale=1),(r.translate>=iwe&&r.translate<=owe||isNaN(r.translate))&&(r.translate=0)}function l0(r,s,a,c){hW(r.x,s.x,a.x,c?c.originX:void 0),hW(r.y,s.y,a.y,c?c.originY:void 0)}function pW(r,s,a){r.min=a.min+s.min,r.max=r.min+Ti(s)}function cwe(r,s,a){pW(r.x,s.x,a.x),pW(r.y,s.y,a.y)}function mW(r,s,a){r.min=s.min-a.min,r.max=r.min+Ti(s)}function d0(r,s,a){mW(r.x,s.x,a.x),mW(r.y,s.y,a.y)}function Yo(r){return[r("x"),r("y")]}const Kz=({current:r})=>r?r.ownerDocument.defaultView:null,fW=(r,s)=>Math.abs(r-s);function lwe(r,s){const a=fW(r.x,s.x),c=fW(r.y,s.y);return Math.sqrt(a**2+c**2)}class zz{constructor(s,a,{transformPagePoint:c,contextWindow:h=window,dragSnapToOrigin:f=!1,distanceThreshold:_=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const N=t1(this.lastMoveEventInfo,this.history),L=this.startEvent!==null,j=lwe(N.offset,{x:0,y:0})>=this.distanceThreshold;if(!L&&!j)return;const{point:F}=N,{timestamp:P}=Ks;this.history.push({...F,timestamp:P});const{onStart:M,onMove:U}=this.handlers;L||(M&&M(this.lastMoveEvent,N),this.startEvent=this.lastMoveEvent),U&&U(this.lastMoveEvent,N)},this.handlePointerMove=(N,L)=>{this.lastMoveEvent=N,this.lastMoveEventInfo=e1(L,this.transformPagePoint),Lr.update(this.updatePoint,!0)},this.handlePointerUp=(N,L)=>{this.end();const{onEnd:j,onSessionEnd:F,resumeAnimation:P}=this.handlers;if(this.dragSnapToOrigin&&P&&P(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const M=t1(N.type==="pointercancel"?this.lastMoveEventInfo:e1(L,this.transformPagePoint),this.history);this.startEvent&&j&&j(N,M),F&&F(N,M)},!YO(s))return;this.dragSnapToOrigin=f,this.handlers=a,this.transformPagePoint=c,this.distanceThreshold=_,this.contextWindow=h||window;const E=l_(s),v=e1(E,this.transformPagePoint),{point:x}=v,{timestamp:T}=Ks;this.history=[{...x,timestamp:T}];const{onSessionStart:R}=a;R&&R(s,t1(v,this.history)),this.removeListeners=o_(c0(this.contextWindow,"pointermove",this.handlePointerMove),c0(this.contextWindow,"pointerup",this.handlePointerUp),c0(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(s){this.handlers=s}end(){this.removeListeners&&this.removeListeners(),Od(this.updatePoint)}}function e1(r,s){return s?{point:s(r.point)}:r}function gW(r,s){return{x:r.x-s.x,y:r.y-s.y}}function t1({point:r},s){return{point:r,delta:gW(r,Yz(s)),offset:gW(r,dwe(s)),velocity:uwe(s,.1)}}function dwe(r){return r[0]}function Yz(r){return r[r.length-1]}function uwe(r,s){if(r.length<2)return{x:0,y:0};let a=r.length-1,c=null;const h=Yz(r);for(;a>=0&&(c=r[a],!(h.timestamp-c.timestamp>Ic(s)));)a--;if(!c)return{x:0,y:0};const f=Oc(h.timestamp-c.timestamp);if(f===0)return{x:0,y:0};const _={x:(h.x-c.x)/f,y:(h.y-c.y)/f};return _.x===1/0&&(_.x=0),_.y===1/0&&(_.y=0),_}function hwe(r,{min:s,max:a},c){return s!==void 0&&r<s?r=c?Gr(s,r,c.min):Math.max(r,s):a!==void 0&&r>a&&(r=c?Gr(a,r,c.max):Math.min(r,a)),r}function _W(r,s,a){return{min:s!==void 0?r.min+s:void 0,max:a!==void 0?r.max+a-(r.max-r.min):void 0}}function pwe(r,{top:s,left:a,bottom:c,right:h}){return{x:_W(r.x,a,h),y:_W(r.y,s,c)}}function yW(r,s){let a=s.min-r.min,c=s.max-r.max;return s.max-s.min<r.max-r.min&&([a,c]=[c,a]),{min:a,max:c}}function mwe(r,s){return{x:yW(r.x,s.x),y:yW(r.y,s.y)}}function fwe(r,s){let a=.5;const c=Ti(r),h=Ti(s);return h>c?a=U0(s.min,s.max-c,r.min):c>h&&(a=U0(r.min,r.max-h,s.min)),gl(0,1,a)}function gwe(r,s){const a={};return s.min!==void 0&&(a.min=s.min-r.min),s.max!==void 0&&(a.max=s.max-r.min),a}const KA=.35;function _we(r=KA){return r===!1?r=0:r===!0&&(r=KA),{x:EW(r,"left","right"),y:EW(r,"top","bottom")}}function EW(r,s,a){return{min:vW(r,s),max:vW(r,a)}}function vW(r,s){return typeof r=="number"?r:r[s]||0}const ywe=new WeakMap;class Ewe{constructor(s){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ss(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=s}start(s,{snapToCursor:a=!1,distanceThreshold:c}={}){const{presenceContext:h}=this.visualElement;if(h&&h.isPresent===!1)return;const f=R=>{const{dragSnapToOrigin:N}=this.getProps();N?this.pauseAnimation():this.stopAnimation(),a&&this.snapToCursor(l_(R).point)},_=(R,N)=>{const{drag:L,dragPropagation:j,onDragStart:F}=this.getProps();if(L&&!j&&(this.openDragLock&&this.openDragLock(),this.openDragLock=ISe(L),!this.openDragLock))return;this.latestPointerEvent=R,this.latestPanInfo=N,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Yo(M=>{let U=this.getAxisMotionValue(M).get()||0;if(Pc.test(U)){const{projection:B}=this.visualElement;if(B&&B.layout){const K=B.layout.layoutBox[M];K&&(U=Ti(K)*(parseFloat(U)/100))}}this.originPoint[M]=U}),F&&Lr.postRender(()=>F(R,N)),GA(this.visualElement,"transform");const{animationState:P}=this.visualElement;P&&P.setActive("whileDrag",!0)},E=(R,N)=>{this.latestPointerEvent=R,this.latestPanInfo=N;const{dragPropagation:L,dragDirectionLock:j,onDirectionLock:F,onDrag:P}=this.getProps();if(!L&&!this.openDragLock)return;const{offset:M}=N;if(j&&this.currentDirection===null){this.currentDirection=vwe(M),this.currentDirection!==null&&F&&F(this.currentDirection);return}this.updateAxis("x",N.point,M),this.updateAxis("y",N.point,M),this.visualElement.render(),P&&P(R,N)},v=(R,N)=>{this.latestPointerEvent=R,this.latestPanInfo=N,this.stop(R,N),this.latestPointerEvent=null,this.latestPanInfo=null},x=()=>Yo(R=>{var N;return this.getAnimationState(R)==="paused"&&((N=this.getAxisMotionValue(R).animation)==null?void 0:N.play())}),{dragSnapToOrigin:T}=this.getProps();this.panSession=new zz(s,{onSessionStart:f,onStart:_,onMove:E,onSessionEnd:v,resumeAnimation:x},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:T,distanceThreshold:c,contextWindow:Kz(this.visualElement)})}stop(s,a){const c=s||this.latestPointerEvent,h=a||this.latestPanInfo,f=this.isDragging;if(this.cancel(),!f||!h||!c)return;const{velocity:_}=h;this.startAnimation(_);const{onDragEnd:E}=this.getProps();E&&Lr.postRender(()=>E(c,h))}cancel(){this.isDragging=!1;const{projection:s,animationState:a}=this.visualElement;s&&(s.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:c}=this.getProps();!c&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),a&&a.setActive("whileDrag",!1)}updateAxis(s,a,c){const{drag:h}=this.getProps();if(!c||!Dv(s,h,this.currentDirection))return;const f=this.getAxisMotionValue(s);let _=this.originPoint[s]+c[s];this.constraints&&this.constraints[s]&&(_=hwe(_,this.constraints[s],this.elastic[s])),f.set(_)}resolveConstraints(){var f;const{dragConstraints:s,dragElastic:a}=this.getProps(),c=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(f=this.visualElement.projection)==null?void 0:f.layout,h=this.constraints;s&&om(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&c?this.constraints=pwe(c.layoutBox,s):this.constraints=!1,this.elastic=_we(a),h!==this.constraints&&c&&this.constraints&&!this.hasMutatedConstraints&&Yo(_=>{this.constraints!==!1&&this.getAxisMotionValue(_)&&(this.constraints[_]=gwe(c.layoutBox[_],this.constraints[_]))})}resolveRefConstraints(){const{dragConstraints:s,onMeasureDragConstraints:a}=this.getProps();if(!s||!om(s))return!1;const c=s.current,{projection:h}=this.visualElement;if(!h||!h.layout)return!1;const f=bxe(c,h.root,this.visualElement.getTransformPagePoint());let _=mwe(h.layout.layoutBox,f);if(a){const E=a(yxe(_));this.hasMutatedConstraints=!!E,E&&(_=Oz(E))}return _}startAnimation(s){const{drag:a,dragMomentum:c,dragElastic:h,dragTransition:f,dragSnapToOrigin:_,onDragTransitionEnd:E}=this.getProps(),v=this.constraints||{},x=Yo(T=>{if(!Dv(T,a,this.currentDirection))return;let R=v&&v[T]||{};_&&(R={min:0,max:0});const N=h?200:1e6,L=h?40:1e7,j={type:"inertia",velocity:c?s[T]:0,bounceStiffness:N,bounceDamping:L,timeConstant:750,restDelta:1,restSpeed:10,...f,...R};return this.startAxisValueAnimation(T,j)});return Promise.all(x).then(E)}startAxisValueAnimation(s,a){const c=this.getAxisMotionValue(s);return GA(this.visualElement,s),c.start(r2(s,c,0,a,this.visualElement,!1))}stopAnimation(){Yo(s=>this.getAxisMotionValue(s).stop())}pauseAnimation(){Yo(s=>{var a;return(a=this.getAxisMotionValue(s).animation)==null?void 0:a.pause()})}getAnimationState(s){var a;return(a=this.getAxisMotionValue(s).animation)==null?void 0:a.state}getAxisMotionValue(s){const a=`_drag${s.toUpperCase()}`,c=this.visualElement.getProps(),h=c[a];return h||this.visualElement.getValue(s,(c.initial?c.initial[s]:void 0)||0)}snapToCursor(s){Yo(a=>{const{drag:c}=this.getProps();if(!Dv(a,c,this.currentDirection))return;const{projection:h}=this.visualElement,f=this.getAxisMotionValue(a);if(h&&h.layout){const{min:_,max:E}=h.layout.layoutBox[a];f.set(s[a]-Gr(_,E,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:s,dragConstraints:a}=this.getProps(),{projection:c}=this.visualElement;if(!om(a)||!c||!this.constraints)return;this.stopAnimation();const h={x:0,y:0};Yo(_=>{const E=this.getAxisMotionValue(_);if(E&&this.constraints!==!1){const v=E.get();h[_]=fwe({min:v,max:v},this.constraints[_])}});const{transformTemplate:f}=this.visualElement.getProps();this.visualElement.current.style.transform=f?f({},""):"none",c.root&&c.root.updateScroll(),c.updateLayout(),this.resolveConstraints(),Yo(_=>{if(!Dv(_,s,null))return;const E=this.getAxisMotionValue(_),{min:v,max:x}=this.constraints[_];E.set(Gr(v,x,h[_]))})}addListeners(){if(!this.visualElement.current)return;ywe.set(this.visualElement,this);const s=this.visualElement.current,a=c0(s,"pointerdown",v=>{const{drag:x,dragListener:T=!0}=this.getProps();x&&T&&this.start(v)}),c=()=>{const{dragConstraints:v}=this.getProps();om(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:h}=this.visualElement,f=h.addEventListener("measure",c);h&&!h.layout&&(h.root&&h.root.updateScroll(),h.updateLayout()),Lr.read(c);const _=W0(window,"resize",()=>this.scalePositionWithinConstraints()),E=h.addEventListener("didUpdate",({delta:v,hasLayoutChanged:x})=>{this.isDragging&&x&&(Yo(T=>{const R=this.getAxisMotionValue(T);R&&(this.originPoint[T]+=v[T].translate,R.set(R.get()+v[T].translate))}),this.visualElement.render())});return()=>{_(),a(),f(),E&&E()}}getProps(){const s=this.visualElement.getProps(),{drag:a=!1,dragDirectionLock:c=!1,dragPropagation:h=!1,dragConstraints:f=!1,dragElastic:_=KA,dragMomentum:E=!0}=s;return{...s,drag:a,dragDirectionLock:c,dragPropagation:h,dragConstraints:f,dragElastic:_,dragMomentum:E}}}function Dv(r,s,a){return(s===!0||s===r)&&(a===null||a===r)}function vwe(r,s=10){let a=null;return Math.abs(r.y)>s?a="y":Math.abs(r.x)>s&&(a="x"),a}class bwe extends jd{constructor(s){super(s),this.removeGroupControls=ta,this.removeListeners=ta,this.controls=new Ewe(s)}mount(){const{dragControls:s}=this.node.getProps();s&&(this.removeGroupControls=s.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ta}unmount(){this.removeGroupControls(),this.removeListeners()}}const bW=r=>(s,a)=>{r&&Lr.postRender(()=>r(s,a))};class Swe extends jd{constructor(){super(...arguments),this.removePointerDownListener=ta}onPointerDown(s){this.session=new zz(s,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Kz(this.node)})}createPanHandlers(){const{onPanSessionStart:s,onPanStart:a,onPan:c,onPanEnd:h}=this.node.getProps();return{onSessionStart:bW(s),onStart:bW(a),onMove:c,onEnd:(f,_)=>{delete this.session,h&&Lr.postRender(()=>h(f,_))}}}mount(){this.removePointerDownListener=c0(this.node.current,"pointerdown",s=>this.onPointerDown(s))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const ib={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function SW(r,s){return s.max===s.min?0:r/(s.max-s.min)*100}const jg={correct:(r,s)=>{if(!s.target)return r;if(typeof r=="string")if(Yt.test(r))r=parseFloat(r);else return r;const a=SW(r,s.target.x),c=SW(r,s.target.y);return`${a}% ${c}%`}},xwe={correct:(r,{treeScale:s,projectionDelta:a})=>{const c=r,h=Pd.parse(r);if(h.length>5)return c;const f=Pd.createTransformer(r),_=typeof h[0]!="number"?1:0,E=a.x.scale*s.x,v=a.y.scale*s.y;h[0+_]/=E,h[1+_]/=v;const x=Gr(E,v,.5);return typeof h[2+_]=="number"&&(h[2+_]/=x),typeof h[3+_]=="number"&&(h[3+_]/=x),f(h)}};let n1=!1;class wwe extends V.Component{componentDidMount(){const{visualElement:s,layoutGroup:a,switchLayoutGroup:c,layoutId:h}=this.props,{projection:f}=s;KSe(Twe),f&&(a.group&&a.group.add(f),c&&c.register&&h&&c.register(f),n1&&f.root.didUpdate(),f.addEventListener("animationComplete",()=>{this.safeToRemove()}),f.setOptions({...f.options,onExitComplete:()=>this.safeToRemove()})),ib.hasEverUpdated=!0}getSnapshotBeforeUpdate(s){const{layoutDependency:a,visualElement:c,drag:h,isPresent:f}=this.props,{projection:_}=c;return _&&(_.isPresent=f,n1=!0,h||s.layoutDependency!==a||a===void 0||s.isPresent!==f?_.willUpdate():this.safeToRemove(),s.isPresent!==f&&(f?_.promote():_.relegate()||Lr.postRender(()=>{const E=_.getStack();(!E||!E.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:s}=this.props.visualElement;s&&(s.root.didUpdate(),zO.postRender(()=>{!s.currentAnimation&&s.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:s,layoutGroup:a,switchLayoutGroup:c}=this.props,{projection:h}=s;n1=!0,h&&(h.scheduleCheckAfterUnmount(),a&&a.group&&a.group.remove(h),c&&c.deregister&&c.deregister(h))}safeToRemove(){const{safeToRemove:s}=this.props;s&&s()}render(){return null}}function qz(r){const[s,a]=VSe(),c=V.useContext(RK);return d.jsx(wwe,{...r,layoutGroup:c,switchLayoutGroup:V.useContext(Az),isPresent:s,safeToRemove:a})}const Twe={borderRadius:{...jg,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:jg,borderTopRightRadius:jg,borderBottomLeftRadius:jg,borderBottomRightRadius:jg,boxShadow:xwe};function Cwe(r,s,a){const c=ci(r)?r:jm(r);return c.start(r2("",c,s,a)),c.animation}const Rwe=(r,s)=>r.depth-s.depth;class Nwe{constructor(){this.children=[],this.isDirty=!1}add(s){AO(this.children,s),this.isDirty=!0}remove(s){IO(this.children,s),this.isDirty=!0}forEach(s){this.isDirty&&this.children.sort(Rwe),this.isDirty=!1,this.children.forEach(s)}}function Awe(r,s){const a=zi.now(),c=({timestamp:h})=>{const f=h-a;f>=s&&(Od(c),r(f-s))};return Lr.setup(c,!0),()=>Od(c)}const Xz=["TopLeft","TopRight","BottomLeft","BottomRight"],Iwe=Xz.length,xW=r=>typeof r=="string"?parseFloat(r):r,wW=r=>typeof r=="number"||Yt.test(r);function Owe(r,s,a,c,h,f){h?(r.opacity=Gr(0,a.opacity??1,Pwe(c)),r.opacityExit=Gr(s.opacity??1,0,Dwe(c))):f&&(r.opacity=Gr(s.opacity??1,a.opacity??1,c));for(let _=0;_<Iwe;_++){const E=`border${Xz[_]}Radius`;let v=TW(s,E),x=TW(a,E);if(v===void 0&&x===void 0)continue;v||(v=0),x||(x=0),v===0||x===0||wW(v)===wW(x)?(r[E]=Math.max(Gr(xW(v),xW(x),c),0),(Pc.test(x)||Pc.test(v))&&(r[E]+="%")):r[E]=x}(s.rotate||a.rotate)&&(r.rotate=Gr(s.rotate||0,a.rotate||0,c))}function TW(r,s){return r[s]!==void 0?r[s]:r.borderRadius}const Pwe=Jz(0,.5,UK),Dwe=Jz(.5,.95,ta);function Jz(r,s,a){return c=>c<r?0:c>s?1:a(U0(r,s,c))}function CW(r,s){r.min=s.min,r.max=s.max}function zo(r,s){CW(r.x,s.x),CW(r.y,s.y)}function RW(r,s){r.translate=s.translate,r.scale=s.scale,r.originPoint=s.originPoint,r.origin=s.origin}function NW(r,s,a,c,h){return r-=s,r=Xb(r,1/a,c),h!==void 0&&(r=Xb(r,1/h,c)),r}function kwe(r,s=0,a=1,c=.5,h,f=r,_=r){if(Pc.test(s)&&(s=parseFloat(s),s=Gr(_.min,_.max,s/100)-_.min),typeof s!="number")return;let E=Gr(f.min,f.max,c);r===f&&(E-=s),r.min=NW(r.min,s,a,E,h),r.max=NW(r.max,s,a,E,h)}function AW(r,s,[a,c,h],f,_){kwe(r,s[a],s[c],s[h],s.scale,f,_)}const Lwe=["x","scaleX","originX"],Mwe=["y","scaleY","originY"];function IW(r,s,a,c){AW(r.x,s,Lwe,a?a.x:void 0,c?c.x:void 0),AW(r.y,s,Mwe,a?a.y:void 0,c?c.y:void 0)}function OW(r){return r.translate===0&&r.scale===1}function Qz(r){return OW(r.x)&&OW(r.y)}function PW(r,s){return r.min===s.min&&r.max===s.max}function jwe(r,s){return PW(r.x,s.x)&&PW(r.y,s.y)}function DW(r,s){return Math.round(r.min)===Math.round(s.min)&&Math.round(r.max)===Math.round(s.max)}function Zz(r,s){return DW(r.x,s.x)&&DW(r.y,s.y)}function kW(r){return Ti(r.x)/Ti(r.y)}function LW(r,s){return r.translate===s.translate&&r.scale===s.scale&&r.originPoint===s.originPoint}class Uwe{constructor(){this.members=[]}add(s){AO(this.members,s),s.scheduleRender()}remove(s){if(IO(this.members,s),s===this.prevLead&&(this.prevLead=void 0),s===this.lead){const a=this.members[this.members.length-1];a&&this.promote(a)}}relegate(s){const a=this.members.findIndex(h=>s===h);if(a===0)return!1;let c;for(let h=a;h>=0;h--){const f=this.members[h];if(f.isPresent!==!1){c=f;break}}return c?(this.promote(c),!0):!1}promote(s,a){const c=this.lead;if(s!==c&&(this.prevLead=c,this.lead=s,s.show(),c)){c.instance&&c.scheduleRender(),s.scheduleRender(),s.resumeFrom=c,a&&(s.resumeFrom.preserveOpacity=!0),c.snapshot&&(s.snapshot=c.snapshot,s.snapshot.latestValues=c.animationValues||c.latestValues),s.root&&s.root.isUpdating&&(s.isLayoutDirty=!0);const{crossfade:h}=s.options;h===!1&&c.hide()}}exitAnimationComplete(){this.members.forEach(s=>{const{options:a,resumingFrom:c}=s;a.onExitComplete&&a.onExitComplete(),c&&c.options.onExitComplete&&c.options.onExitComplete()})}scheduleRender(){this.members.forEach(s=>{s.instance&&s.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Vwe(r,s,a){let c="";const h=r.x.translate/s.x,f=r.y.translate/s.y,_=(a==null?void 0:a.z)||0;if((h||f||_)&&(c=`translate3d(${h}px, ${f}px, ${_}px) `),(s.x!==1||s.y!==1)&&(c+=`scale(${1/s.x}, ${1/s.y}) `),a){const{transformPerspective:x,rotate:T,rotateX:R,rotateY:N,skewX:L,skewY:j}=a;x&&(c=`perspective(${x}px) ${c}`),T&&(c+=`rotate(${T}deg) `),R&&(c+=`rotateX(${R}deg) `),N&&(c+=`rotateY(${N}deg) `),L&&(c+=`skewX(${L}deg) `),j&&(c+=`skewY(${j}deg) `)}const E=r.x.scale*s.x,v=r.y.scale*s.y;return(E!==1||v!==1)&&(c+=`scale(${E}, ${v})`),c||"none"}const r1=["","X","Y","Z"],Fwe=1e3;let Bwe=0;function s1(r,s,a,c){const{latestValues:h}=s;h[r]&&(a[r]=h[r],s.setStaticValue(r,0),c&&(c[r]=0))}function eY(r){if(r.hasCheckedOptimisedAppear=!0,r.root===r)return;const{visualElement:s}=r.options;if(!s)return;const a=Vz(s);if(window.MotionHasOptimisedAnimation(a,"transform")){const{layout:h,layoutId:f}=r.options;window.MotionCancelOptimisedAnimation(a,"transform",Lr,!(h||f))}const{parent:c}=r;c&&!c.hasCheckedOptimisedAppear&&eY(c)}function tY({attachResizeListener:r,defaultParent:s,measureScroll:a,checkIsScrollRoot:c,resetTransform:h}){return class{constructor(_={},E=s==null?void 0:s()){this.id=Bwe++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Gwe),this.nodes.forEach(Ywe),this.nodes.forEach(qwe),this.nodes.forEach(Hwe)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=_,this.root=E?E.root||E:this,this.path=E?[...E.path,E]:[],this.parent=E,this.depth=E?E.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new Nwe)}addEventListener(_,E){return this.eventHandlers.has(_)||this.eventHandlers.set(_,new PO),this.eventHandlers.get(_).add(E)}notifyListeners(_,...E){const v=this.eventHandlers.get(_);v&&v.notify(...E)}hasListeners(_){return this.eventHandlers.has(_)}mount(_){if(this.instance)return;this.isSVG=gz(_)&&!MSe(_),this.instance=_;const{layoutId:E,layout:v,visualElement:x}=this.options;if(x&&!x.current&&x.mount(_),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(v||E)&&(this.isLayoutDirty=!0),r){let T,R=0;const N=()=>this.root.updateBlockedByResize=!1;Lr.read(()=>{R=window.innerWidth}),r(_,()=>{const L=window.innerWidth;L!==R&&(R=L,this.root.updateBlockedByResize=!0,T&&T(),T=Awe(N,250),ib.hasAnimatedSinceResize&&(ib.hasAnimatedSinceResize=!1,this.nodes.forEach(UW)))})}E&&this.root.registerSharedNode(E,this),this.options.animate!==!1&&x&&(E||v)&&this.addEventListener("didUpdate",({delta:T,hasLayoutChanged:R,hasRelativeLayoutChanged:N,layout:L})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const j=this.options.transition||x.getDefaultTransition()||eTe,{onLayoutAnimationStart:F,onLayoutAnimationComplete:P}=x.getProps(),M=!this.targetLayout||!Zz(this.targetLayout,L),U=!R&&N;if(this.options.layoutRoot||this.resumeFrom||U||R&&(M||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const B={...HO(j,"layout"),onPlay:F,onComplete:P};(x.shouldReduceMotion||this.options.layoutRoot)&&(B.delay=0,B.type=!1),this.startAnimation(B),this.setAnimationOrigin(T,U)}else R||UW(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=L})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const _=this.getStack();_&&_.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Od(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Xwe),this.animationId++)}getTransformTemplate(){const{visualElement:_}=this.options;return _&&_.getProps().transformTemplate}willUpdate(_=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&eY(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let T=0;T<this.path.length;T++){const R=this.path[T];R.shouldResetTransform=!0,R.updateScroll("snapshot"),R.options.layoutRoot&&R.willUpdate(!1)}const{layoutId:E,layout:v}=this.options;if(E===void 0&&!v)return;const x=this.getTransformTemplate();this.prevTransformTemplateValue=x?x(this.latestValues,""):void 0,this.updateSnapshot(),_&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(MW);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(jW);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(zwe),this.nodes.forEach($we),this.nodes.forEach(Wwe)):this.nodes.forEach(jW),this.clearAllSnapshots();const E=zi.now();Ks.delta=gl(0,1e3/60,E-Ks.timestamp),Ks.timestamp=E,Ks.isProcessing=!0,KN.update.process(Ks),KN.preRender.process(Ks),KN.render.process(Ks),Ks.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,zO.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Kwe),this.sharedNodes.forEach(Jwe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Lr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Lr.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Ti(this.snapshot.measuredBox.x)&&!Ti(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const _=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ss(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:E}=this.options;E&&E.notify("LayoutMeasure",this.layout.layoutBox,_?_.layoutBox:void 0)}updateScroll(_="measure"){let E=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===_&&(E=!1),E&&this.instance){const v=c(this.instance);this.scroll={animationId:this.root.animationId,phase:_,isRoot:v,offset:a(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!h)return;const _=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,E=this.projectionDelta&&!Qz(this.projectionDelta),v=this.getTransformTemplate(),x=v?v(this.latestValues,""):void 0,T=x!==this.prevTransformTemplateValue;_&&this.instance&&(E||ju(this.latestValues)||T)&&(h(this.instance,x),this.shouldResetTransform=!1,this.scheduleRender())}measure(_=!0){const E=this.measurePageBox();let v=this.removeElementScroll(E);return _&&(v=this.removeTransform(v)),tTe(v),{animationId:this.root.animationId,measuredBox:E,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var x;const{visualElement:_}=this.options;if(!_)return ss();const E=_.measureViewportBox();if(!(((x=this.scroll)==null?void 0:x.wasRoot)||this.path.some(nTe))){const{scroll:T}=this.root;T&&(am(E.x,T.offset.x),am(E.y,T.offset.y))}return E}removeElementScroll(_){var v;const E=ss();if(zo(E,_),(v=this.scroll)!=null&&v.wasRoot)return E;for(let x=0;x<this.path.length;x++){const T=this.path[x],{scroll:R,options:N}=T;T!==this.root&&R&&N.layoutScroll&&(R.wasRoot&&zo(E,_),am(E.x,R.offset.x),am(E.y,R.offset.y))}return E}applyTransform(_,E=!1){const v=ss();zo(v,_);for(let x=0;x<this.path.length;x++){const T=this.path[x];!E&&T.options.layoutScroll&&T.scroll&&T!==T.root&&cm(v,{x:-T.scroll.offset.x,y:-T.scroll.offset.y}),ju(T.latestValues)&&cm(v,T.latestValues)}return ju(this.latestValues)&&cm(v,this.latestValues),v}removeTransform(_){const E=ss();zo(E,_);for(let v=0;v<this.path.length;v++){const x=this.path[v];if(!x.instance||!ju(x.latestValues))continue;FA(x.latestValues)&&x.updateSnapshot();const T=ss(),R=x.measurePageBox();zo(T,R),IW(E,x.latestValues,x.snapshot?x.snapshot.layoutBox:void 0,T)}return ju(this.latestValues)&&IW(E,this.latestValues),E}setTargetDelta(_){this.targetDelta=_,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(_){this.options={...this.options,..._,crossfade:_.crossfade!==void 0?_.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ks.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(_=!1){var N;const E=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=E.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=E.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=E.isSharedProjectionDirty);const v=!!this.resumingFrom||this!==E;if(!(_||v&&this.isSharedProjectionDirty||this.isProjectionDirty||(N=this.parent)!=null&&N.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:T,layoutId:R}=this.options;if(!(!this.layout||!(T||R))){if(this.resolvedRelativeTargetAt=Ks.timestamp,!this.targetDelta&&!this.relativeTarget){const L=this.getClosestProjectingParent();L&&L.layout&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ss(),this.relativeTargetOrigin=ss(),d0(this.relativeTargetOrigin,this.layout.layoutBox,L.layout.layoutBox),zo(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ss(),this.targetWithTransforms=ss()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),cwe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):zo(this.target,this.layout.layoutBox),Dz(this.target,this.targetDelta)):zo(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const L=this.getClosestProjectingParent();L&&!!L.resumingFrom==!!this.resumingFrom&&!L.options.layoutScroll&&L.target&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ss(),this.relativeTargetOrigin=ss(),d0(this.relativeTargetOrigin,this.target,L.target),zo(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||FA(this.parent.latestValues)||Pz(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var j;const _=this.getLead(),E=!!this.resumingFrom||this!==_;let v=!0;if((this.isProjectionDirty||(j=this.parent)!=null&&j.isProjectionDirty)&&(v=!1),E&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(v=!1),this.resolvedRelativeTargetAt===Ks.timestamp&&(v=!1),v)return;const{layout:x,layoutId:T}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(x||T))return;zo(this.layoutCorrected,this.layout.layoutBox);const R=this.treeScale.x,N=this.treeScale.y;vxe(this.layoutCorrected,this.treeScale,this.path,E),_.layout&&!_.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(_.target=_.layout.layoutBox,_.targetWithTransforms=ss());const{target:L}=_;if(!L){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(RW(this.prevProjectionDelta.x,this.projectionDelta.x),RW(this.prevProjectionDelta.y,this.projectionDelta.y)),l0(this.projectionDelta,this.layoutCorrected,L,this.latestValues),(this.treeScale.x!==R||this.treeScale.y!==N||!LW(this.projectionDelta.x,this.prevProjectionDelta.x)||!LW(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",L))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(_=!0){var E;if((E=this.options.visualElement)==null||E.scheduleRender(),_){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=lm(),this.projectionDelta=lm(),this.projectionDeltaWithTransform=lm()}setAnimationOrigin(_,E=!1){const v=this.snapshot,x=v?v.latestValues:{},T={...this.latestValues},R=lm();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!E;const N=ss(),L=v?v.source:void 0,j=this.layout?this.layout.source:void 0,F=L!==j,P=this.getStack(),M=!P||P.members.length<=1,U=!!(F&&!M&&this.options.crossfade===!0&&!this.path.some(Zwe));this.animationProgress=0;let B;this.mixTargetDelta=K=>{const J=K/1e3;VW(R.x,_.x,J),VW(R.y,_.y,J),this.setTargetDelta(R),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(d0(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Qwe(this.relativeTarget,this.relativeTargetOrigin,N,J),B&&jwe(this.relativeTarget,B)&&(this.isProjectionDirty=!1),B||(B=ss()),zo(B,this.relativeTarget)),F&&(this.animationValues=T,Owe(T,x,this.latestValues,J,U,M)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=J},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(_){var E,v,x;this.notifyListeners("animationStart"),(E=this.currentAnimation)==null||E.stop(),(x=(v=this.resumingFrom)==null?void 0:v.currentAnimation)==null||x.stop(),this.pendingAnimation&&(Od(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Lr.update(()=>{ib.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=jm(0)),this.currentAnimation=Cwe(this.motionValue,[0,1e3],{..._,velocity:0,isSync:!0,onUpdate:T=>{this.mixTargetDelta(T),_.onUpdate&&_.onUpdate(T)},onStop:()=>{},onComplete:()=>{_.onComplete&&_.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const _=this.getStack();_&&_.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Fwe),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const _=this.getLead();let{targetWithTransforms:E,target:v,layout:x,latestValues:T}=_;if(!(!E||!v||!x)){if(this!==_&&this.layout&&x&&nY(this.options.animationType,this.layout.layoutBox,x.layoutBox)){v=this.target||ss();const R=Ti(this.layout.layoutBox.x);v.x.min=_.target.x.min,v.x.max=v.x.min+R;const N=Ti(this.layout.layoutBox.y);v.y.min=_.target.y.min,v.y.max=v.y.min+N}zo(E,v),cm(E,T),l0(this.projectionDeltaWithTransform,this.layoutCorrected,E,T)}}registerSharedNode(_,E){this.sharedNodes.has(_)||this.sharedNodes.set(_,new Uwe),this.sharedNodes.get(_).add(E);const x=E.options.initialPromotionConfig;E.promote({transition:x?x.transition:void 0,preserveFollowOpacity:x&&x.shouldPreserveFollowOpacity?x.shouldPreserveFollowOpacity(E):void 0})}isLead(){const _=this.getStack();return _?_.lead===this:!0}getLead(){var E;const{layoutId:_}=this.options;return _?((E=this.getStack())==null?void 0:E.lead)||this:this}getPrevLead(){var E;const{layoutId:_}=this.options;return _?(E=this.getStack())==null?void 0:E.prevLead:void 0}getStack(){const{layoutId:_}=this.options;if(_)return this.root.sharedNodes.get(_)}promote({needsReset:_,transition:E,preserveFollowOpacity:v}={}){const x=this.getStack();x&&x.promote(this,v),_&&(this.projectionDelta=void 0,this.needsReset=!0),E&&this.setOptions({transition:E})}relegate(){const _=this.getStack();return _?_.relegate(this):!1}resetSkewAndRotation(){const{visualElement:_}=this.options;if(!_)return;let E=!1;const{latestValues:v}=_;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(E=!0),!E)return;const x={};v.z&&s1("z",_,x,this.animationValues);for(let T=0;T<r1.length;T++)s1(`rotate${r1[T]}`,_,x,this.animationValues),s1(`skew${r1[T]}`,_,x,this.animationValues);_.render();for(const T in x)_.setStaticValue(T,x[T]),this.animationValues&&(this.animationValues[T]=x[T]);_.scheduleRender()}applyProjectionStyles(_,E){if(!this.instance||this.isSVG)return;if(!this.isVisible){_.visibility="hidden";return}const v=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,_.visibility="",_.opacity="",_.pointerEvents=sb(E==null?void 0:E.pointerEvents)||"",_.transform=v?v(this.latestValues,""):"none";return}const x=this.getLead();if(!this.projectionDelta||!this.layout||!x.target){this.options.layoutId&&(_.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,_.pointerEvents=sb(E==null?void 0:E.pointerEvents)||""),this.hasProjected&&!ju(this.latestValues)&&(_.transform=v?v({},""):"none",this.hasProjected=!1);return}_.visibility="";const T=x.animationValues||x.latestValues;this.applyTransformsToTarget();let R=Vwe(this.projectionDeltaWithTransform,this.treeScale,T);v&&(R=v(T,R)),_.transform=R;const{x:N,y:L}=this.projectionDelta;_.transformOrigin=`${N.origin*100}% ${L.origin*100}% 0`,x.animationValues?_.opacity=x===this?T.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:T.opacityExit:_.opacity=x===this?T.opacity!==void 0?T.opacity:"":T.opacityExit!==void 0?T.opacityExit:0;for(const j in $0){if(T[j]===void 0)continue;const{correct:F,applyTo:P,isCSSVariable:M}=$0[j],U=R==="none"?T[j]:F(T[j],x);if(P){const B=P.length;for(let K=0;K<B;K++)_[P[K]]=U}else M?this.options.visualElement.renderState.vars[j]=U:_[j]=U}this.options.layoutId&&(_.pointerEvents=x===this?sb(E==null?void 0:E.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(_=>{var E;return(E=_.currentAnimation)==null?void 0:E.stop()}),this.root.nodes.forEach(MW),this.root.sharedNodes.clear()}}}function $we(r){r.updateLayout()}function Wwe(r){var a;const s=((a=r.resumeFrom)==null?void 0:a.snapshot)||r.snapshot;if(r.isLead()&&r.layout&&s&&r.hasListeners("didUpdate")){const{layoutBox:c,measuredBox:h}=r.layout,{animationType:f}=r.options,_=s.source!==r.layout.source;f==="size"?Yo(R=>{const N=_?s.measuredBox[R]:s.layoutBox[R],L=Ti(N);N.min=c[R].min,N.max=N.min+L}):nY(f,s.layoutBox,c)&&Yo(R=>{const N=_?s.measuredBox[R]:s.layoutBox[R],L=Ti(c[R]);N.max=N.min+L,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[R].max=r.relativeTarget[R].min+L)});const E=lm();l0(E,c,s.layoutBox);const v=lm();_?l0(v,r.applyTransform(h,!0),s.measuredBox):l0(v,c,s.layoutBox);const x=!Qz(E);let T=!1;if(!r.resumeFrom){const R=r.getClosestProjectingParent();if(R&&!R.resumeFrom){const{snapshot:N,layout:L}=R;if(N&&L){const j=ss();d0(j,s.layoutBox,N.layoutBox);const F=ss();d0(F,c,L.layoutBox),Zz(j,F)||(T=!0),R.options.layoutRoot&&(r.relativeTarget=F,r.relativeTargetOrigin=j,r.relativeParent=R)}}}r.notifyListeners("didUpdate",{layout:c,snapshot:s,delta:v,layoutDelta:E,hasLayoutChanged:x,hasRelativeLayoutChanged:T})}else if(r.isLead()){const{onExitComplete:c}=r.options;c&&c()}r.options.transition=void 0}function Gwe(r){r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function Hwe(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function Kwe(r){r.clearSnapshot()}function MW(r){r.clearMeasurements()}function jW(r){r.isLayoutDirty=!1}function zwe(r){const{visualElement:s}=r.options;s&&s.getProps().onBeforeLayoutMeasure&&s.notify("BeforeLayoutMeasure"),r.resetTransform()}function UW(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function Ywe(r){r.resolveTargetDelta()}function qwe(r){r.calcProjection()}function Xwe(r){r.resetSkewAndRotation()}function Jwe(r){r.removeLeadSnapshot()}function VW(r,s,a){r.translate=Gr(s.translate,0,a),r.scale=Gr(s.scale,1,a),r.origin=s.origin,r.originPoint=s.originPoint}function FW(r,s,a,c){r.min=Gr(s.min,a.min,c),r.max=Gr(s.max,a.max,c)}function Qwe(r,s,a,c){FW(r.x,s.x,a.x,c),FW(r.y,s.y,a.y,c)}function Zwe(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const eTe={duration:.45,ease:[.4,0,.1,1]},BW=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),$W=BW("applewebkit/")&&!BW("chrome/")?Math.round:ta;function WW(r){r.min=$W(r.min),r.max=$W(r.max)}function tTe(r){WW(r.x),WW(r.y)}function nY(r,s,a){return r==="position"||r==="preserve-aspect"&&!awe(kW(s),kW(a),.2)}function nTe(r){var s;return r!==r.root&&((s=r.scroll)==null?void 0:s.wasRoot)}const rTe=tY({attachResizeListener:(r,s)=>W0(r,"resize",s),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),i1={current:void 0},rY=tY({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!i1.current){const r=new rTe({});r.mount(window),r.setOptions({layoutScroll:!0}),i1.current=r}return i1.current},resetTransform:(r,s)=>{r.style.transform=s!==void 0?s:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),sTe={pan:{Feature:Swe},drag:{Feature:bwe,ProjectionNode:rY,MeasureLayout:qz}};function GW(r,s,a){const{props:c}=r;r.animationState&&c.whileHover&&r.animationState.setActive("whileHover",a==="Start");const h="onHover"+a,f=c[h];f&&Lr.postRender(()=>f(s,l_(s)))}class iTe extends jd{mount(){const{current:s}=this.node;s&&(this.unmount=OSe(s,(a,c)=>(GW(this.node,c,"Start"),h=>GW(this.node,h,"End"))))}unmount(){}}class oTe extends jd{constructor(){super(...arguments),this.isActive=!1}onFocus(){let s=!1;try{s=this.node.current.matches(":focus-visible")}catch{s=!0}!s||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=o_(W0(this.node.current,"focus",()=>this.onFocus()),W0(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function HW(r,s,a){const{props:c}=r;if(r.current instanceof HTMLButtonElement&&r.current.disabled)return;r.animationState&&c.whileTap&&r.animationState.setActive("whileTap",a==="Start");const h="onTap"+(a==="End"?"":a),f=c[h];f&&Lr.postRender(()=>f(s,l_(s)))}class aTe extends jd{mount(){const{current:s}=this.node;s&&(this.unmount=LSe(s,(a,c)=>(HW(this.node,c,"Start"),(h,{success:f})=>HW(this.node,h,f?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const zA=new WeakMap,o1=new WeakMap,cTe=r=>{const s=zA.get(r.target);s&&s(r)},lTe=r=>{r.forEach(cTe)};function dTe({root:r,...s}){const a=r||document;o1.has(a)||o1.set(a,{});const c=o1.get(a),h=JSON.stringify(s);return c[h]||(c[h]=new IntersectionObserver(lTe,{root:r,...s})),c[h]}function uTe(r,s,a){const c=dTe(s);return zA.set(r,a),c.observe(r),()=>{zA.delete(r),c.unobserve(r)}}const hTe={some:0,all:1};class pTe extends jd{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:s={}}=this.node.getProps(),{root:a,margin:c,amount:h="some",once:f}=s,_={root:a?a.current:void 0,rootMargin:c,threshold:typeof h=="number"?h:hTe[h]},E=v=>{const{isIntersecting:x}=v;if(this.isInView===x||(this.isInView=x,f&&!x&&this.hasEnteredView))return;x&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",x);const{onViewportEnter:T,onViewportLeave:R}=this.node.getProps(),N=x?T:R;N&&N(v)};return uTe(this.node.current,_,E)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:s,prevProps:a}=this.node;["amount","margin","root"].some(mTe(s,a))&&this.startObserver()}unmount(){}}function mTe({viewport:r={}},{viewport:s={}}={}){return a=>r[a]!==s[a]}const fTe={inView:{Feature:pTe},tap:{Feature:aTe},focus:{Feature:oTe},hover:{Feature:iTe}},gTe={layout:{ProjectionNode:rY,MeasureLayout:qz}},_Te={...twe,...fTe,...sTe,...gTe},yTe=_xe(_Te,Ixe),ETe=()=>{const r="Hi! My name is Iru Anna",[s,a]=V.useState(""),[c,h]=V.useState(!1),[f,_]=V.useState(0),[E,v]=V.useState(120);return V.useEffect(()=>{const T=setTimeout(()=>{c?(a(r.substring(0,s.length-1)),v(60),s===""&&(h(!1),_(f+1))):(a(r.substring(0,s.length+1)),v(120),s===r&&setTimeout(()=>h(!0),1e3))},E);return()=>clearTimeout(T)},[s,c,f,E,r]),d.jsxs("section",{className:"relative min-h-screen flex flex-col items-center justify-center overflow-hidden bg-gradient-to-br from-green-200/50 via-white to-gray-100",children:[d.jsx("div",{className:"absolute inset-0 opacity-40 pointer-events-none",children:d.jsxs("svg",{className:"w-full h-full",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 200 200",children:[d.jsx("defs",{children:d.jsx("pattern",{id:"hexPattern",width:"40",height:"35",patternUnits:"userSpaceOnUse",children:d.jsx("polygon",{points:"20,0 40,10 40,25 20,35 0,25 0,10",fill:"none",stroke:"#fff",strokeWidth:"0.5",opacity:"0.3"})})}),d.jsx("rect",{width:"100%",height:"100%",fill:"url(#hexPattern)"})]})}),d.jsx("div",{className:"relative z-10 flex flex-col items-center",children:d.jsxs("div",{className:"relative w-56 h-56 md:w-72 md:h-72 rounded-full shadow-2xl ring-4 ring-white/50",children:[d.jsx("img",{src:"/Girl.png",alt:"AI Assistant",width:320,height:320,className:"rounded-full object-cover shadow-2xl"}),d.jsxs("div",{className:"absolute -left-36 top-1/3 bg-white shadow-lg px-6 py-3 rounded-2xl border border-gray-200 animate-bounce",children:[d.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 font-semibold",children:s}),d.jsx("span",{className:"animate-pulse text-indigo-500",children:"|"})]})]})}),d.jsxs(yTe.h1,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:1.5,ease:"easeOut"},className:"relative mt-10 text-4xl md:text-5xl font-extrabold text-center",children:[d.jsx("span",{className:"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 text-transparent bg-clip-text animate-gradient-x bg-[length:200%_200%]",children:"Smart, Secure & AI-Powered Communication"}),d.jsx("br",{}),d.jsx("span",{className:"text-gray-800",children:"for Teams, Clients & Communities"})]})]})};function vTe({title:r,titleId:s,...a},c){return V.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":s},a),r?V.createElement("title",{id:s},r):null,V.createElement("path",{fillRule:"evenodd",d:"M12.97 3.97a.75.75 0 0 1 1.06 0l7.5 7.5a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 1 1-1.06-1.06l6.22-6.22H3a.75.75 0 0 1 0-1.5h16.19l-6.22-6.22a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"}))}const bTe=V.forwardRef(vTe);function STe({title:r,titleId:s,...a},c){return V.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":s},a),r?V.createElement("title",{id:s},r):null,V.createElement("path",{fillRule:"evenodd",d:"M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .913-.143Z",clipRule:"evenodd"}))}const xTe=V.forwardRef(STe);function wTe({title:r,titleId:s,...a},c){return V.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":s},a),r?V.createElement("title",{id:s},r):null,V.createElement("path",{fillRule:"evenodd",d:"M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6Zm4.5 7.5a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0v-2.25a.75.75 0 0 1 .75-.75Zm3.75-1.5a.75.75 0 0 0-1.5 0v4.5a.75.75 0 0 0 1.5 0V12Zm2.25-3a.75.75 0 0 1 .75.75v6.75a.75.75 0 0 1-1.5 0V9.75A.75.75 0 0 1 13.5 9Zm3.75-1.5a.75.75 0 0 0-1.5 0v9a.75.75 0 0 0 1.5 0v-9Z",clipRule:"evenodd"}))}const TTe=V.forwardRef(wTe);function CTe({title:r,titleId:s,...a},c){return V.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":s},a),r?V.createElement("title",{id:s},r):null,V.createElement("path",{fillRule:"evenodd",d:"M19.916 4.626a.75.75 0 0 1 .208 1.04l-9 13.5a.75.75 0 0 1-1.154.114l-6-6a.75.75 0 0 1 1.06-1.06l5.353 5.353 8.493-12.74a.75.75 0 0 1 1.04-.207Z",clipRule:"evenodd"}))}const RTe=V.forwardRef(CTe);function NTe({title:r,titleId:s,...a},c){return V.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":s},a),r?V.createElement("title",{id:s},r):null,V.createElement("path",{fillRule:"evenodd",d:"M3 6a3 3 0 0 1 3-3h2.25a3 3 0 0 1 3 3v2.25a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6Zm9.75 0a3 3 0 0 1 3-3H18a3 3 0 0 1 3 3v2.25a3 3 0 0 1-3 3h-2.25a3 3 0 0 1-3-3V6ZM3 15.75a3 3 0 0 1 3-3h2.25a3 3 0 0 1 3 3V18a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3v-2.25Zm9.75 0a3 3 0 0 1 3-3H18a3 3 0 0 1 3 3V18a3 3 0 0 1-3 3h-2.25a3 3 0 0 1-3-3v-2.25Z",clipRule:"evenodd"}))}const ATe=V.forwardRef(NTe),ITe=()=>d.jsxs("section",{className:"relative overflow-hidden py-16 md:py-24 bg-gradient-to-br from-gray-900 to-blue-950",children:[d.jsx("div",{className:"absolute top-0 -left-4 w-72 h-72 bg-blue-400 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob"}),d.jsx("div",{className:"absolute -bottom-10 right-20 w-80 h-80 bg-cyan-400 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-2000"}),d.jsx("div",{className:"absolute -bottom-10 left-10 w-64 h-64 bg-sky-400 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-4000"}),d.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 lg:px-12 xl:px-20 2xl:px-24 max-w-7xl",children:d.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-between gap-12",children:[d.jsxs("div",{className:"lg:w-1/2 text-center lg:text-left",children:[d.jsxs("p",{className:"text-xs sm:text-sm font-semibold text-cyan-400 uppercase tracking-wider mb-3 flex items-center justify-center lg:justify-start",children:[d.jsx("span",{className:"w-8 h-px bg-cyan-400 mr-2"}),"ABOUT US"]}),d.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl lg:text-5xl xl:text-5xl 2xl:text-6xl font-extrabold text-white leading-snug mb-6",children:["Seamless IT Solutions ",d.jsx("br",{className:"hidden md:block"})," For Business Growth"]}),d.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center lg:justify-start mb-8",children:[d.jsx("span",{className:"text-blue-400 text-5xl sm:text-6xl xl:text-6xl 2xl:text-7xl font-extrabold mr-4 mb-4 sm:mb-0",children:"25+"}),d.jsxs("p",{className:"text-base sm:text-lg text-gray-300 max-w-md",children:[d.jsx("span",{className:"font-bold text-cyan-400",children:"Years of experience"})," ","we are dedicated to safeguarding your digital world. Founded on the principles of innovation, trust, and resilience, we specialize in providing cutting-edge IT solutions to businesses."]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-y-4 gap-x-8 mb-10",children:[d.jsx(kv,{text:"Transforming Ideas into Solutions"}),d.jsx(kv,{text:"Where Strategy Meets Technology"}),d.jsx(kv,{text:"Innovation: Strategy. Success."}),d.jsx(kv,{text:"Building Digital Futures Together"})]}),d.jsxs("div",{className:"flex justify-center lg:justify-start space-x-4",children:[d.jsx(Fn,{to:"/about",children:d.jsx(qn,{className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-1",children:"See More About"})}),d.jsx(Fn,{to:"/about",children:d.jsx("button",{className:"bg-transparent border border-blue-500 text-blue-400 hover:bg-blue-100/10 font-semibold py-3 px-3 rounded-full transition duration-300 ease-in-out",children:d.jsx(bTe,{className:"h-5 w-5"})})})]})]}),d.jsx("div",{className:"lg:w-1/2 flex justify-center relative mt-12 lg:mt-0 px-4 sm:px-0",children:d.jsx("div",{className:"relative z-10 w-full max-w-md sm:max-w-lg lg:max-w-xl xl:max-w-2xl rounded-xl overflow-hidden shadow-2xl transform rotate-3 hover:rotate-0 transition-transform duration-500 ease-in-out",children:d.jsx("img",{src:"/About.jpg",alt:"Team Collaboration",className:"w-full h-auto object-cover"})})})]})})]}),kv=({text:r})=>d.jsxs("div",{className:"flex items-center text-gray-200",children:[d.jsx(RTe,{className:"h-5 w-5 text-blue-400 mr-2 flex-shrink-0"}),d.jsx("span",{className:"text-sm sm:text-base lg:text-lg",children:r})]}),OTe=()=>d.jsxs("section",{className:"relative overflow-hidden py-16 md:py-24 bg-gray-50 dark:bg-gray-900",children:[d.jsx("div",{className:"absolute top-0 -right-20 w-80 h-80 bg-blue-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob"}),d.jsx("div",{className:"absolute bottom-0 -left-20 w-96 h-96 bg-blue-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-2000"}),d.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 lg:px-12 xl:px-20 max-w-7xl",children:d.jsxs("div",{className:"flex flex-col lg:flex-row items-start justify-between gap-16",children:[d.jsxs("div",{className:"lg:w-2/5 text-center lg:text-left",children:[d.jsxs("p",{className:"text-sm font-semibold text-blue-600 dark:text-blue-400 uppercase tracking-wider mb-2 flex items-center justify-center lg:justify-start",children:[d.jsx("span",{className:"w-8 h-px bg-blue-600 dark:bg-blue-400 mr-2"})," OUR PROCESS"]}),d.jsxs("h1",{className:"text-4xl md:text-5xl font-extrabold text-gray-900 dark:text-white leading-tight mb-6",children:["Easy Dynamic And ",d.jsx("br",{className:"hidden md:block"})," Optimal Workflows"]}),d.jsx("div",{className:"hidden lg:flex flex-col items-center mt-24",children:d.jsx(Fn,{to:"/about",children:d.jsx(qn,{className:"relative transform rotate-90 text-sm font-semibold text-white px-6 py-3 rounded-full shadow-lg transition duration-300 ease-in-out bg-gradient-to-r from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800",children:d.jsx("span",{className:"relative z-10",children:"How We Work"})})})})]}),d.jsxs("div",{className:"lg:w-3/5 grid grid-cols-1 md:grid-cols-2 gap-8",children:[d.jsx(Lv,{step:"01",title:"Sign Up & Connect",description:"Create your secure IRU Chat account and connect your teams, clients, or customers in minutes. Choose between web, mobile, or desktop for seamless access anywhere."}),d.jsx(Lv,{step:"02",title:"Smart & Secure Messaging",description:"Send instant messages, voice notes, or video callsall protected by end-to-end encryption. AI filters and spam protection ensure a clean, distraction free environment."}),d.jsx(Lv,{step:"03",title:"AI-Powered Assistance",description:"Enable IRU Chat AI Assistants to automate tasks, answer questions, translate conversations instantly, and analyze customer needs in real-time."}),d.jsx(Lv,{step:"04",title:"Collaborate & Share",description:"Share files, documents, and media instantly. Create group chats or project channels to keep your work organized and accessible."})]})]})})]}),Lv=({step:r,title:s,description:a})=>d.jsxs("div",{className:"p-8 rounded-2xl shadow-lg bg-white dark:bg-gray-800 transition-all duration-300 ease-in-out transform hover:scale-105 hover:shadow-2xl border-2 border-transparent hover:border-blue-500",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsxs("div",{className:"relative w-12 h-12 flex items-center justify-center rounded-full bg-blue-100 dark:bg-gray-700",children:[d.jsx("span",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:r}),d.jsx("div",{className:"absolute w-16 h-16 rounded-full bg-blue-100 dark:bg-gray-700 -z-10 animate-ping opacity-75"})]}),d.jsxs("div",{className:"ml-4",children:[d.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-widest",children:"STEP"}),d.jsx("h3",{className:"text-lg font-extrabold text-gray-900 dark:text-white mt-1",children:s})]})]}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a})]}),PTe=()=>d.jsx("section",{className:"bg-gray-900 py-16 md:py-24 text-white",children:d.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-12 xl:px-20 max-w-7xl",children:[d.jsxs("div",{className:"flex flex-col items-center text-center",children:[d.jsx("p",{className:"text-sm font-semibold text-teal-400 uppercase tracking-wider mb-2",children:"OUR SERVICES"}),d.jsxs("h1",{className:"text-4xl md:text-5xl font-extrabold leading-tight mb-12",children:["AI-Powered Solutions For Your ",d.jsx("br",{className:"hidden md:block"})," Business"]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mt-12",children:[d.jsx(a1,{icon:d.jsx(ATe,{className:"h-8 w-8 text-teal-400"}),title:"AI Consulting & Strategy",benefits:["Basic support (email only)","Access to core AI functions"],imageUrl:"/AI-01.jpg"}),d.jsx(a1,{icon:d.jsx(TTe,{className:"h-8 w-8 text-teal-400"}),title:"AI Software Development",benefits:["Basic support (email only)","Access to core AI functions"],imageUrl:"/AI-02.jpg"}),d.jsx(a1,{icon:d.jsx(xTe,{className:"h-8 w-8 text-teal-400"}),title:"AI-Powered Automation",benefits:["Basic support (email only)","Access to core AI functions"],imageUrl:"/AI-03.jpg"})]}),d.jsx("div",{className:"mt-16 text-center",children:d.jsxs("a",{href:"#",className:"inline-block border border-gray-600 hover:border-teal-400 text-sm font-medium py-3 px-8 rounded-full transition duration-300 ease-in-out",children:["Leading The AI Solutions Revolution.",d.jsx("span",{className:"ml-2 underline hover:no-underline",children:"View More Details"})]})})]})}),a1=({icon:r,title:s,benefits:a,imageUrl:c})=>d.jsxs("div",{className:"p-6 bg-gray-800 rounded-lg border-2 border-transparent transition-all duration-300 ease-in-out transform hover:scale-105 hover:border-teal-500 hover:shadow-2xl",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx("div",{className:"p-2 bg-gray-700 rounded-full",children:r}),d.jsx("h3",{className:"text-xl font-bold ml-4",children:s})]}),d.jsx("div",{className:"mb-4 text-gray-400",children:a.map((h,f)=>d.jsxs("p",{className:"flex items-center mb-1 text-sm",children:[d.jsx("span",{className:"text-teal-400 font-bold mr-2",children:"+"}),h]},f))}),d.jsx("div",{className:"rounded-lg overflow-hidden mt-4",children:d.jsx("img",{src:c,alt:s,className:"w-full h-auto object-cover transition-transform duration-300 ease-in-out transform hover:scale-110"})})]});function DTe(r){return Object.prototype.toString.call(r)==="[object Object]"}function KW(r){return DTe(r)||Array.isArray(r)}function kTe(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function s2(r,s){const a=Object.keys(r),c=Object.keys(s);if(a.length!==c.length)return!1;const h=JSON.stringify(Object.keys(r.breakpoints||{})),f=JSON.stringify(Object.keys(s.breakpoints||{}));return h!==f?!1:a.every(_=>{const E=r[_],v=s[_];return typeof E=="function"?`${E}`==`${v}`:!KW(E)||!KW(v)?E===v:s2(E,v)})}function zW(r){return r.concat().sort((s,a)=>s.name>a.name?1:-1).map(s=>s.options)}function LTe(r,s){if(r.length!==s.length)return!1;const a=zW(r),c=zW(s);return a.every((h,f)=>{const _=c[f];return s2(h,_)})}function i2(r){return typeof r=="number"}function YA(r){return typeof r=="string"}function DS(r){return typeof r=="boolean"}function YW(r){return Object.prototype.toString.call(r)==="[object Object]"}function Hr(r){return Math.abs(r)}function o2(r){return Math.sign(r)}function u0(r,s){return Hr(r-s)}function MTe(r,s){if(r===0||s===0||Hr(r)<=Hr(s))return 0;const a=u0(Hr(r),Hr(s));return Hr(a/r)}function jTe(r){return Math.round(r*100)/100}function G0(r){return H0(r).map(Number)}function Wa(r){return r[d_(r)]}function d_(r){return Math.max(0,r.length-1)}function a2(r,s){return s===d_(r)}function qW(r,s=0){return Array.from(Array(r),(a,c)=>s+c)}function H0(r){return Object.keys(r)}function sY(r,s){return[r,s].reduce((a,c)=>(H0(c).forEach(h=>{const f=a[h],_=c[h],E=YW(f)&&YW(_);a[h]=E?sY(f,_):_}),a),{})}function qA(r,s){return typeof s.MouseEvent<"u"&&r instanceof s.MouseEvent}function UTe(r,s){const a={start:c,center:h,end:f};function c(){return 0}function h(v){return f(v)/2}function f(v){return s-v}function _(v,x){return YA(r)?a[r](v):r(s,v,x)}return{measure:_}}function K0(){let r=[];function s(h,f,_,E={passive:!0}){let v;if("addEventListener"in h)h.addEventListener(f,_,E),v=()=>h.removeEventListener(f,_,E);else{const x=h;x.addListener(_),v=()=>x.removeListener(_)}return r.push(v),c}function a(){r=r.filter(h=>h())}const c={add:s,clear:a};return c}function VTe(r,s,a,c){const h=K0(),f=1e3/60;let _=null,E=0,v=0;function x(){h.add(r,"visibilitychange",()=>{r.hidden&&j()})}function T(){L(),h.clear()}function R(P){if(!v)return;_||(_=P,a(),a());const M=P-_;for(_=P,E+=M;E>=f;)a(),E-=f;const U=E/f;c(U),v&&(v=s.requestAnimationFrame(R))}function N(){v||(v=s.requestAnimationFrame(R))}function L(){s.cancelAnimationFrame(v),_=null,E=0,v=0}function j(){_=null,E=0}return{init:x,destroy:T,start:N,stop:L,update:a,render:c}}function FTe(r,s){const a=s==="rtl",c=r==="y",h=c?"y":"x",f=c?"x":"y",_=!c&&a?-1:1,E=T(),v=R();function x(j){const{height:F,width:P}=j;return c?F:P}function T(){return c?"top":a?"right":"left"}function R(){return c?"bottom":a?"left":"right"}function N(j){return j*_}return{scroll:h,cross:f,startEdge:E,endEdge:v,measureSize:x,direction:N}}function dh(r=0,s=0){const a=Hr(r-s);function c(x){return x<r}function h(x){return x>s}function f(x){return c(x)||h(x)}function _(x){return f(x)?c(x)?r:s:x}function E(x){return a?x-a*Math.ceil((x-s)/a):x}return{length:a,max:s,min:r,constrain:_,reachedAny:f,reachedMax:h,reachedMin:c,removeOffset:E}}function iY(r,s,a){const{constrain:c}=dh(0,r),h=r+1;let f=_(s);function _(N){return a?Hr((h+N)%h):c(N)}function E(){return f}function v(N){return f=_(N),R}function x(N){return T().set(E()+N)}function T(){return iY(r,E(),a)}const R={get:E,set:v,add:x,clone:T};return R}function BTe(r,s,a,c,h,f,_,E,v,x,T,R,N,L,j,F,P,M,U){const{cross:B,direction:K}=r,J=["INPUT","SELECT","TEXTAREA"],te={passive:!1},se=K0(),ie=K0(),ue=dh(50,225).constrain(L.measure(20)),de={mouse:300,touch:400},Ne={mouse:500,touch:600},Ce=j?43:25;let tt=!1,Se=0,Ge=0,Xe=!1,Re=!1,le=!1,ve=!1;function Le(be){if(!U)return;function ht(Ln){(DS(U)||U(be,Ln))&&vt(Ln)}const Gt=s;se.add(Gt,"dragstart",Ln=>Ln.preventDefault(),te).add(Gt,"touchmove",()=>{},te).add(Gt,"touchend",()=>{}).add(Gt,"touchstart",ht).add(Gt,"mousedown",ht).add(Gt,"touchcancel",Wt).add(Gt,"contextmenu",Wt).add(Gt,"click",Jt,!0)}function qe(){se.clear(),ie.clear()}function We(){const be=ve?a:s;ie.add(be,"touchmove",ut,te).add(be,"touchend",Wt).add(be,"mousemove",ut,te).add(be,"mouseup",Wt)}function xt(be){const ht=be.nodeName||"";return J.includes(ht)}function bt(){return(j?Ne:de)[ve?"mouse":"touch"]}function $t(be,ht){const Gt=R.add(o2(be)*-1),Ln=T.byDistance(be,!j).distance;return j||Hr(be)<ue?Ln:P&&ht?Ln*.5:T.byIndex(Gt.get(),0).distance}function vt(be){const ht=qA(be,c);ve=ht,le=j&&ht&&!be.buttons&&tt,tt=u0(h.get(),_.get())>=2,!(ht&&be.button!==0)&&(xt(be.target)||(Xe=!0,f.pointerDown(be),x.useFriction(0).useDuration(0),h.set(_),We(),Se=f.readPoint(be),Ge=f.readPoint(be,B),N.emit("pointerDown")))}function ut(be){if(!qA(be,c)&&be.touches.length>=2)return Wt(be);const Gt=f.readPoint(be),Ln=f.readPoint(be,B),Mn=u0(Gt,Se),bn=u0(Ln,Ge);if(!Re&&!ve&&(!be.cancelable||(Re=Mn>bn,!Re)))return Wt(be);const ln=f.pointerMove(be);Mn>F&&(le=!0),x.useFriction(.3).useDuration(.75),E.start(),h.add(K(ln)),be.preventDefault()}function Wt(be){const Gt=T.byDistance(0,!1).index!==R.get(),Ln=f.pointerUp(be)*bt(),Mn=$t(K(Ln),Gt),bn=MTe(Ln,Mn),ln=Ce-10*bn,vn=M+bn/50;Re=!1,Xe=!1,ie.clear(),x.useDuration(ln).useFriction(vn),v.distance(Mn,!j),ve=!1,N.emit("pointerUp")}function Jt(be){le&&(be.stopPropagation(),be.preventDefault(),le=!1)}function Dt(){return Xe}return{init:Le,destroy:qe,pointerDown:Dt}}function $Te(r,s){let c,h;function f(R){return R.timeStamp}function _(R,N){const j=`client${(N||r.scroll)==="x"?"X":"Y"}`;return(qA(R,s)?R:R.touches[0])[j]}function E(R){return c=R,h=R,_(R)}function v(R){const N=_(R)-_(h),L=f(R)-f(c)>170;return h=R,L&&(c=R),N}function x(R){if(!c||!h)return 0;const N=_(h)-_(c),L=f(R)-f(c),j=f(R)-f(h)>170,F=N/L;return L&&!j&&Hr(F)>.1?F:0}return{pointerDown:E,pointerMove:v,pointerUp:x,readPoint:_}}function WTe(){function r(a){const{offsetTop:c,offsetLeft:h,offsetWidth:f,offsetHeight:_}=a;return{top:c,right:h+f,bottom:c+_,left:h,width:f,height:_}}return{measure:r}}function GTe(r){function s(c){return r*(c/100)}return{measure:s}}function HTe(r,s,a,c,h,f,_){const E=[r].concat(c);let v,x,T=[],R=!1;function N(P){return h.measureSize(_.measure(P))}function L(P){if(!f)return;x=N(r),T=c.map(N);function M(U){for(const B of U){if(R)return;const K=B.target===r,J=c.indexOf(B.target),te=K?x:T[J],se=N(K?r:c[J]);if(Hr(se-te)>=.5){P.reInit(),s.emit("resize");break}}}v=new ResizeObserver(U=>{(DS(f)||f(P,U))&&M(U)}),a.requestAnimationFrame(()=>{E.forEach(U=>v.observe(U))})}function j(){R=!0,v&&v.disconnect()}return{init:L,destroy:j}}function KTe(r,s,a,c,h,f){let _=0,E=0,v=h,x=f,T=r.get(),R=0;function N(){const te=c.get()-r.get(),se=!v;let ie=0;return se?(_=0,a.set(c),r.set(c),ie=te):(a.set(r),_+=te/v,_*=x,T+=_,r.add(_),ie=T-R),E=o2(ie),R=T,J}function L(){const te=c.get()-s.get();return Hr(te)<.001}function j(){return v}function F(){return E}function P(){return _}function M(){return B(h)}function U(){return K(f)}function B(te){return v=te,J}function K(te){return x=te,J}const J={direction:F,duration:j,velocity:P,seek:N,settled:L,useBaseFriction:U,useBaseDuration:M,useFriction:K,useDuration:B};return J}function zTe(r,s,a,c,h){const f=h.measure(10),_=h.measure(50),E=dh(.1,.99);let v=!1;function x(){return!(v||!r.reachedAny(a.get())||!r.reachedAny(s.get()))}function T(L){if(!x())return;const j=r.reachedMin(s.get())?"min":"max",F=Hr(r[j]-s.get()),P=a.get()-s.get(),M=E.constrain(F/_);a.subtract(P*M),!L&&Hr(P)<f&&(a.set(r.constrain(a.get())),c.useDuration(25).useBaseFriction())}function R(L){v=!L}return{shouldConstrain:x,constrain:T,toggleActive:R}}function YTe(r,s,a,c,h){const f=dh(-s+r,0),_=R(),E=T(),v=N();function x(j,F){return u0(j,F)<=1}function T(){const j=_[0],F=Wa(_),P=_.lastIndexOf(j),M=_.indexOf(F)+1;return dh(P,M)}function R(){return a.map((j,F)=>{const{min:P,max:M}=f,U=f.constrain(j),B=!F,K=a2(a,F);return B?M:K||x(P,U)?P:x(M,U)?M:U}).map(j=>parseFloat(j.toFixed(3)))}function N(){if(s<=r+h)return[f.max];if(c==="keepSnaps")return _;const{min:j,max:F}=E;return _.slice(j,F)}return{snapsContained:v,scrollContainLimit:E}}function qTe(r,s,a){const c=s[0],h=a?c-r:Wa(s);return{limit:dh(h,c)}}function XTe(r,s,a,c){const f=s.min+.1,_=s.max+.1,{reachedMin:E,reachedMax:v}=dh(f,_);function x(N){return N===1?v(a.get()):N===-1?E(a.get()):!1}function T(N){if(!x(N))return;const L=r*(N*-1);c.forEach(j=>j.add(L))}return{loop:T}}function JTe(r){const{max:s,length:a}=r;function c(f){const _=f-s;return a?_/-a:0}return{get:c}}function QTe(r,s,a,c,h){const{startEdge:f,endEdge:_}=r,{groupSlides:E}=h,v=R().map(s.measure),x=N(),T=L();function R(){return E(c).map(F=>Wa(F)[_]-F[0][f]).map(Hr)}function N(){return c.map(F=>a[f]-F[f]).map(F=>-Hr(F))}function L(){return E(x).map(F=>F[0]).map((F,P)=>F+v[P])}return{snaps:x,snapsAligned:T}}function ZTe(r,s,a,c,h,f){const{groupSlides:_}=h,{min:E,max:v}=c,x=T();function T(){const N=_(f),L=!r||s==="keepSnaps";return a.length===1?[f]:L?N:N.slice(E,v).map((j,F,P)=>{const M=!F,U=a2(P,F);if(M){const B=Wa(P[0])+1;return qW(B)}if(U){const B=d_(f)-Wa(P)[0]+1;return qW(B,Wa(P)[0])}return j})}return{slideRegistry:x}}function eCe(r,s,a,c,h){const{reachedAny:f,removeOffset:_,constrain:E}=c;function v(j){return j.concat().sort((F,P)=>Hr(F)-Hr(P))[0]}function x(j){const F=r?_(j):E(j),P=s.map((U,B)=>({diff:T(U-F,0),index:B})).sort((U,B)=>Hr(U.diff)-Hr(B.diff)),{index:M}=P[0];return{index:M,distance:F}}function T(j,F){const P=[j,j+a,j-a];if(!r)return j;if(!F)return v(P);const M=P.filter(U=>o2(U)===F);return M.length?v(M):Wa(P)-a}function R(j,F){const P=s[j]-h.get(),M=T(P,F);return{index:j,distance:M}}function N(j,F){const P=h.get()+j,{index:M,distance:U}=x(P),B=!r&&f(P);if(!F||B)return{index:M,distance:j};const K=s[M]-U,J=j+T(K,0);return{index:M,distance:J}}return{byDistance:N,byIndex:R,shortcut:T}}function tCe(r,s,a,c,h,f,_){function E(R){const N=R.distance,L=R.index!==s.get();f.add(N),N&&(c.duration()?r.start():(r.update(),r.render(1),r.update())),L&&(a.set(s.get()),s.set(R.index),_.emit("select"))}function v(R,N){const L=h.byDistance(R,N);E(L)}function x(R,N){const L=s.clone().set(R),j=h.byIndex(L.get(),N);E(j)}return{distance:v,index:x}}function nCe(r,s,a,c,h,f,_,E){const v={passive:!0,capture:!0};let x=0;function T(L){if(!E)return;function j(F){if(new Date().getTime()-x>10)return;_.emit("slideFocusStart"),r.scrollLeft=0;const U=a.findIndex(B=>B.includes(F));i2(U)&&(h.useDuration(0),c.index(U,0),_.emit("slideFocus"))}f.add(document,"keydown",R,!1),s.forEach((F,P)=>{f.add(F,"focus",M=>{(DS(E)||E(L,M))&&j(P)},v)})}function R(L){L.code==="Tab"&&(x=new Date().getTime())}return{init:T}}function zg(r){let s=r;function a(){return s}function c(v){s=_(v)}function h(v){s+=_(v)}function f(v){s-=_(v)}function _(v){return i2(v)?v:v.get()}return{get:a,set:c,add:h,subtract:f}}function oY(r,s){const a=r.scroll==="x"?_:E,c=s.style;let h=null,f=!1;function _(N){return`translate3d(${N}px,0px,0px)`}function E(N){return`translate3d(0px,${N}px,0px)`}function v(N){if(f)return;const L=jTe(r.direction(N));L!==h&&(c.transform=a(L),h=L)}function x(N){f=!N}function T(){f||(c.transform="",s.getAttribute("style")||s.removeAttribute("style"))}return{clear:T,to:v,toggleActive:x}}function rCe(r,s,a,c,h,f,_,E,v){const T=G0(h),R=G0(h).reverse(),N=M().concat(U());function L(se,ie){return se.reduce((ue,de)=>ue-h[de],ie)}function j(se,ie){return se.reduce((ue,de)=>L(ue,ie)>0?ue.concat([de]):ue,[])}function F(se){return f.map((ie,ue)=>({start:ie-c[ue]+.5+se,end:ie+s-.5+se}))}function P(se,ie,ue){const de=F(ie);return se.map(Ne=>{const Ce=ue?0:-a,tt=ue?a:0,Se=ue?"end":"start",Ge=de[Ne][Se];return{index:Ne,loopPoint:Ge,slideLocation:zg(-1),translate:oY(r,v[Ne]),target:()=>E.get()>Ge?Ce:tt}})}function M(){const se=_[0],ie=j(R,se);return P(ie,a,!1)}function U(){const se=s-_[0]-1,ie=j(T,se);return P(ie,-a,!0)}function B(){return N.every(({index:se})=>{const ie=T.filter(ue=>ue!==se);return L(ie,s)<=.1})}function K(){N.forEach(se=>{const{target:ie,translate:ue,slideLocation:de}=se,Ne=ie();Ne!==de.get()&&(ue.to(Ne),de.set(Ne))})}function J(){N.forEach(se=>se.translate.clear())}return{canLoop:B,clear:J,loop:K,loopPoints:N}}function sCe(r,s,a){let c,h=!1;function f(v){if(!a)return;function x(T){for(const R of T)if(R.type==="childList"){v.reInit(),s.emit("slidesChanged");break}}c=new MutationObserver(T=>{h||(DS(a)||a(v,T))&&x(T)}),c.observe(r,{childList:!0})}function _(){c&&c.disconnect(),h=!0}return{init:f,destroy:_}}function iCe(r,s,a,c){const h={};let f=null,_=null,E,v=!1;function x(){E=new IntersectionObserver(j=>{v||(j.forEach(F=>{const P=s.indexOf(F.target);h[P]=F}),f=null,_=null,a.emit("slidesInView"))},{root:r.parentElement,threshold:c}),s.forEach(j=>E.observe(j))}function T(){E&&E.disconnect(),v=!0}function R(j){return H0(h).reduce((F,P)=>{const M=parseInt(P),{isIntersecting:U}=h[M];return(j&&U||!j&&!U)&&F.push(M),F},[])}function N(j=!0){if(j&&f)return f;if(!j&&_)return _;const F=R(j);return j&&(f=F),j||(_=F),F}return{init:x,destroy:T,get:N}}function oCe(r,s,a,c,h,f){const{measureSize:_,startEdge:E,endEdge:v}=r,x=a[0]&&h,T=j(),R=F(),N=a.map(_),L=P();function j(){if(!x)return 0;const U=a[0];return Hr(s[E]-U[E])}function F(){if(!x)return 0;const U=f.getComputedStyle(Wa(c));return parseFloat(U.getPropertyValue(`margin-${v}`))}function P(){return a.map((U,B,K)=>{const J=!B,te=a2(K,B);return J?N[B]+T:te?N[B]+R:K[B+1][E]-U[E]}).map(Hr)}return{slideSizes:N,slideSizesWithGaps:L,startGap:T,endGap:R}}function aCe(r,s,a,c,h,f,_,E,v){const{startEdge:x,endEdge:T,direction:R}=r,N=i2(a);function L(M,U){return G0(M).filter(B=>B%U===0).map(B=>M.slice(B,B+U))}function j(M){return M.length?G0(M).reduce((U,B,K)=>{const J=Wa(U)||0,te=J===0,se=B===d_(M),ie=h[x]-f[J][x],ue=h[x]-f[B][T],de=!c&&te?R(_):0,Ne=!c&&se?R(E):0,Ce=Hr(ue-Ne-(ie+de));return K&&Ce>s+v&&U.push(B),se&&U.push(M.length),U},[]).map((U,B,K)=>{const J=Math.max(K[B-1]||0);return M.slice(J,U)}):[]}function F(M){return N?L(M,a):j(M)}return{groupSlides:F}}function cCe(r,s,a,c,h,f,_){const{align:E,axis:v,direction:x,startIndex:T,loop:R,duration:N,dragFree:L,dragThreshold:j,inViewThreshold:F,slidesToScroll:P,skipSnaps:M,containScroll:U,watchResize:B,watchSlides:K,watchDrag:J,watchFocus:te}=f,se=2,ie=WTe(),ue=ie.measure(s),de=a.map(ie.measure),Ne=FTe(v,x),Ce=Ne.measureSize(ue),tt=GTe(Ce),Se=UTe(E,Ce),Ge=!R&&!!U,Xe=R||!!U,{slideSizes:Re,slideSizesWithGaps:le,startGap:ve,endGap:Le}=oCe(Ne,ue,de,a,Xe,h),qe=aCe(Ne,Ce,P,R,ue,de,ve,Le,se),{snaps:We,snapsAligned:xt}=QTe(Ne,Se,ue,de,qe),bt=-Wa(We)+Wa(le),{snapsContained:$t,scrollContainLimit:vt}=YTe(Ce,bt,xt,U,se),ut=Ge?$t:xt,{limit:Wt}=qTe(bt,ut,R),Jt=iY(d_(ut),T,R),Dt=Jt.clone(),At=G0(a),be=({dragHandler:xs,scrollBody:xo,scrollBounds:ws,options:{loop:hi}})=>{hi||ws.constrain(xs.pointerDown()),xo.seek()},ht=({scrollBody:xs,translate:xo,location:ws,offsetLocation:hi,previousLocation:os,scrollLooper:wo,slideLooper:Ai,dragHandler:qa,animation:De,eventHandler:Ie,scrollBounds:Pe,options:{loop:ze}},at)=>{const ft=xs.settled(),Rt=!Pe.shouldConstrain(),Ze=ze?ft:ft&&Rt,ae=Ze&&!qa.pointerDown();ae&&De.stop();const Ae=ws.get()*at+os.get()*(1-at);hi.set(Ae),ze&&(wo.loop(xs.direction()),Ai.loop()),xo.to(hi.get()),ae&&Ie.emit("settle"),Ze||Ie.emit("scroll")},Gt=VTe(c,h,()=>be(ui),xs=>ht(ui,xs)),Ln=.68,Mn=ut[Jt.get()],bn=zg(Mn),ln=zg(Mn),vn=zg(Mn),Xn=zg(Mn),Mr=KTe(bn,vn,ln,Xn,N,Ln),So=eCe(R,ut,bt,Wt,Xn),ir=tCe(Gt,Jt,Dt,Mr,So,Xn,_),Jn=JTe(Wt),ia=K0(),jr=iCe(s,a,_,F),{slideRegistry:yr}=ZTe(Ge,U,ut,vt,qe,At),di=nCe(r,a,yr,ir,Mr,ia,_,te),ui={ownerDocument:c,ownerWindow:h,eventHandler:_,containerRect:ue,slideRects:de,animation:Gt,axis:Ne,dragHandler:BTe(Ne,r,c,h,Xn,$Te(Ne,h),bn,Gt,ir,Mr,So,Jt,_,tt,L,j,M,Ln,J),eventStore:ia,percentOfView:tt,index:Jt,indexPrevious:Dt,limit:Wt,location:bn,offsetLocation:vn,previousLocation:ln,options:f,resizeHandler:HTe(s,_,h,a,Ne,B,ie),scrollBody:Mr,scrollBounds:zTe(Wt,vn,Xn,Mr,tt),scrollLooper:XTe(bt,Wt,vn,[bn,vn,ln,Xn]),scrollProgress:Jn,scrollSnapList:ut.map(Jn.get),scrollSnaps:ut,scrollTarget:So,scrollTo:ir,slideLooper:rCe(Ne,Ce,bt,Re,le,We,ut,vn,a),slideFocus:di,slidesHandler:sCe(s,_,K),slidesInView:jr,slideIndexes:At,slideRegistry:yr,slidesToScroll:qe,target:Xn,translate:oY(Ne,s)};return ui}function lCe(){let r={},s;function a(x){s=x}function c(x){return r[x]||[]}function h(x){return c(x).forEach(T=>T(s,x)),v}function f(x,T){return r[x]=c(x).concat([T]),v}function _(x,T){return r[x]=c(x).filter(R=>R!==T),v}function E(){r={}}const v={init:a,emit:h,off:_,on:f,clear:E};return v}const dCe={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function uCe(r){function s(f,_){return sY(f,_||{})}function a(f){const _=f.breakpoints||{},E=H0(_).filter(v=>r.matchMedia(v).matches).map(v=>_[v]).reduce((v,x)=>s(v,x),{});return s(f,E)}function c(f){return f.map(_=>H0(_.breakpoints||{})).reduce((_,E)=>_.concat(E),[]).map(r.matchMedia)}return{mergeOptions:s,optionsAtMedia:a,optionsMediaQueries:c}}function hCe(r){let s=[];function a(f,_){return s=_.filter(({options:E})=>r.optionsAtMedia(E).active!==!1),s.forEach(E=>E.init(f,r)),_.reduce((E,v)=>Object.assign(E,{[v.name]:v}),{})}function c(){s=s.filter(f=>f.destroy())}return{init:a,destroy:c}}function Jb(r,s,a){const c=r.ownerDocument,h=c.defaultView,f=uCe(h),_=hCe(f),E=K0(),v=lCe(),{mergeOptions:x,optionsAtMedia:T,optionsMediaQueries:R}=f,{on:N,off:L,emit:j}=v,F=Ne;let P=!1,M,U=x(dCe,Jb.globalOptions),B=x(U),K=[],J,te,se;function ie(){const{container:At,slides:be}=B;te=(YA(At)?r.querySelector(At):At)||r.children[0];const Gt=YA(be)?te.querySelectorAll(be):be;se=[].slice.call(Gt||te.children)}function ue(At){const be=cCe(r,te,se,c,h,At,v);if(At.loop&&!be.slideLooper.canLoop()){const ht=Object.assign({},At,{loop:!1});return ue(ht)}return be}function de(At,be){P||(U=x(U,At),B=T(U),K=be||K,ie(),M=ue(B),R([U,...K.map(({options:ht})=>ht)]).forEach(ht=>E.add(ht,"change",Ne)),B.active&&(M.translate.to(M.location.get()),M.animation.init(),M.slidesInView.init(),M.slideFocus.init(Dt),M.eventHandler.init(Dt),M.resizeHandler.init(Dt),M.slidesHandler.init(Dt),M.options.loop&&M.slideLooper.loop(),te.offsetParent&&se.length&&M.dragHandler.init(Dt),J=_.init(Dt,K)))}function Ne(At,be){const ht=qe();Ce(),de(x({startIndex:ht},At),be),v.emit("reInit")}function Ce(){M.dragHandler.destroy(),M.eventStore.clear(),M.translate.clear(),M.slideLooper.clear(),M.resizeHandler.destroy(),M.slidesHandler.destroy(),M.slidesInView.destroy(),M.animation.destroy(),_.destroy(),E.clear()}function tt(){P||(P=!0,E.clear(),Ce(),v.emit("destroy"),v.clear())}function Se(At,be,ht){!B.active||P||(M.scrollBody.useBaseFriction().useDuration(be===!0?0:B.duration),M.scrollTo.index(At,ht||0))}function Ge(At){const be=M.index.add(1).get();Se(be,At,-1)}function Xe(At){const be=M.index.add(-1).get();Se(be,At,1)}function Re(){return M.index.add(1).get()!==qe()}function le(){return M.index.add(-1).get()!==qe()}function ve(){return M.scrollSnapList}function Le(){return M.scrollProgress.get(M.offsetLocation.get())}function qe(){return M.index.get()}function We(){return M.indexPrevious.get()}function xt(){return M.slidesInView.get()}function bt(){return M.slidesInView.get(!1)}function $t(){return J}function vt(){return M}function ut(){return r}function Wt(){return te}function Jt(){return se}const Dt={canScrollNext:Re,canScrollPrev:le,containerNode:Wt,internalEngine:vt,destroy:tt,off:L,on:N,emit:j,plugins:$t,previousScrollSnap:We,reInit:F,rootNode:ut,scrollNext:Ge,scrollPrev:Xe,scrollProgress:Le,scrollSnapList:ve,scrollTo:Se,selectedScrollSnap:qe,slideNodes:Jt,slidesInView:xt,slidesNotInView:bt};return de(s,a),setTimeout(()=>v.emit("init"),0),Dt}Jb.globalOptions=void 0;function c2(r={},s=[]){const a=V.useRef(r),c=V.useRef(s),[h,f]=V.useState(),[_,E]=V.useState(),v=V.useCallback(()=>{h&&h.reInit(a.current,c.current)},[h]);return V.useEffect(()=>{s2(a.current,r)||(a.current=r,v())},[r,v]),V.useEffect(()=>{LTe(c.current,s)||(c.current=s,v())},[s,v]),V.useEffect(()=>{if(kTe()&&_){Jb.globalOptions=c2.globalOptions;const x=Jb(_,a.current,c.current);return f(x),()=>x.destroy()}else f(void 0)},[_,f]),[E,h]}c2.globalOptions=void 0;const aY=V.createContext(null);function kS(){const r=V.useContext(aY);if(!r)throw new Error("useCarousel must be used within a <Carousel />");return r}const cY=V.forwardRef(({orientation:r="horizontal",opts:s,setApi:a,plugins:c,className:h,children:f,..._},E)=>{const[v,x]=c2({...s,axis:r==="horizontal"?"x":"y"},c),[T,R]=V.useState(!1),[N,L]=V.useState(!1),j=V.useCallback(U=>{U&&(R(U.canScrollPrev()),L(U.canScrollNext()))},[]),F=V.useCallback(()=>{x==null||x.scrollPrev()},[x]),P=V.useCallback(()=>{x==null||x.scrollNext()},[x]),M=V.useCallback(U=>{U.key==="ArrowLeft"?(U.preventDefault(),F()):U.key==="ArrowRight"&&(U.preventDefault(),P())},[F,P]);return V.useEffect(()=>{!x||!a||a(x)},[x,a]),V.useEffect(()=>{if(x)return j(x),x.on("reInit",j),x.on("select",j),()=>{x==null||x.off("select",j)}},[x,j]),d.jsx(aY.Provider,{value:{carouselRef:v,api:x,opts:s,orientation:r||((s==null?void 0:s.axis)==="y"?"vertical":"horizontal"),scrollPrev:F,scrollNext:P,canScrollPrev:T,canScrollNext:N},children:d.jsx("div",{ref:E,onKeyDownCapture:M,className:Xs("relative",h),role:"region","aria-roledescription":"carousel",..._,children:f})})});cY.displayName="Carousel";const lY=V.forwardRef(({className:r,...s},a)=>{const{carouselRef:c,orientation:h}=kS();return d.jsx("div",{ref:c,className:"overflow-hidden",children:d.jsx("div",{ref:a,className:Xs("flex",h==="horizontal"?"-ml-4":"-mt-4 flex-col",r),...s})})});lY.displayName="CarouselContent";const dY=V.forwardRef(({className:r,...s},a)=>{const{orientation:c}=kS();return d.jsx("div",{ref:a,role:"group","aria-roledescription":"slide",className:Xs("min-w-0 shrink-0 grow-0 basis-full",c==="horizontal"?"pl-4":"pt-4",r),...s})});dY.displayName="CarouselItem";const uY=V.forwardRef(({className:r,variant:s="outline",size:a="icon",...c},h)=>{const{orientation:f,scrollPrev:_,canScrollPrev:E}=kS();return d.jsxs(qn,{ref:h,variant:s,size:a,className:Xs("absolute  h-8 w-8 rounded-full",f==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",r),disabled:!E,onClick:_,...c,children:[d.jsx(tO,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"Previous slide"})]})});uY.displayName="CarouselPrevious";const hY=V.forwardRef(({className:r,variant:s="outline",size:a="icon",...c},h)=>{const{orientation:f,scrollNext:_,canScrollNext:E}=kS();return d.jsxs(qn,{ref:h,variant:s,size:a,className:Xs("absolute h-8 w-8 rounded-full",f==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",r),disabled:!E,onClick:_,...c,children:[d.jsx(Lb,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"Next slide"})]})});hY.displayName="CarouselNext";const pCe=[{quote:"Integrating AI and robotics into our curriculum has transformed the educational experience for our students, making it more engaging and personalized. The improvements in student performance and enthusiasm for STEM subjects have been outstanding. We're thrilled with the positive impact on our learning environment.",author:"Cyusa Stessy",position:"CEO & Founder",avatar:"/Stessy.jpg",rating:5},{quote:"The AI-powered virtual classroom solution has revolutionized how we deliver remote education. Students are more engaged, and teachers can now provide personalized attention at scale. The analytics have been invaluable for improving our curriculum.",author:"Kanyana",position:"Education Director",avatar:"/Kanyana.jpg",rating:5},{quote:"Implementing the robotic lab assistants in our science program has sparked incredible creativity and interest among students. The hands-on learning experience has made complex concepts accessible and fun to explore.",author:"Burabyo",position:"STEM Coordinator",avatar:"/Burabyo.jpg",rating:5}],mCe=()=>{const[r,s]=V.useState(!1);return V.useEffect(()=>{const a=new IntersectionObserver(([h])=>{h.isIntersecting&&s(!0)},{threshold:.1}),c=document.getElementById("ai-robotic-testimonials");return c&&a.observe(c),()=>{c&&a.unobserve(c)}},[]),d.jsxs("section",{id:"ai-robotic-testimonials",className:"py-24 bg-gradient-to-br from-slate-900 to-slate-800 text-white relative overflow-hidden",children:[d.jsx("div",{className:"container mx-auto px-4 relative z-10",children:d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[d.jsx("div",{className:`transition-all duration-1000 ${r?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute -inset-4 bg-gradient-to-r from-techblue/30 to-techpurple/30 rounded-3xl transform rotate-2 opacity-70"}),d.jsx("img",{src:"/cyborg-woman.jpg",alt:"Robot and human face comparison",className:"rounded-2xl shadow-xl w-full object-cover relative z-10 h-[500px]"}),d.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-10 bg-gradient-to-t from-black/80 to-transparent rounded-b-2xl z-20",children:d.jsxs("h2",{className:"text-4xl font-bold leading-tight",children:["What ",d.jsx("span",{className:"text-pink-500",children:"people say"})," about",d.jsx("br",{}),"AI & Robotic education"]})})]})}),d.jsx("div",{className:`transition-all duration-1000 delay-300 ${r?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:d.jsxs(cY,{className:"w-full",children:[d.jsx(lY,{children:pCe.map((a,c)=>d.jsx(dY,{children:d.jsx("div",{className:"bg-gradient-to-br from-emerald-400 to-green-500 p-1 rounded-3xl shadow-xl",children:d.jsxs("div",{className:"bg-emerald-50 text-gray-800 p-8 rounded-3xl",children:[d.jsx("div",{className:"flex mb-4",children:[...Array(5)].map((h,f)=>d.jsx("svg",{className:"w-6 h-6 text-yellow-500",fill:"currentColor",viewBox:"0 0 20 20",children:d.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})},f))}),d.jsxs("blockquote",{className:"text-xl mb-8",children:['"',a.quote,'"']}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden border-4 border-white shadow-lg",children:d.jsx("img",{src:a.avatar,alt:a.author,className:"w-full h-full object-cover"})}),d.jsxs("div",{children:[d.jsx("div",{className:"font-bold text-xl",children:a.author}),d.jsx("div",{className:"text-gray-600",children:a.position})]}),d.jsx("div",{className:"ml-auto text-6xl font-serif text-emerald-300",children:""})]})]})})},c))}),d.jsxs("div",{className:"flex justify-center gap-2 mt-8",children:[d.jsx(uY,{className:"relative inset-0 translate-y-0 bg-white/20 hover:bg-white/30 text-white border-none"}),d.jsx(hY,{className:"relative inset-0 translate-y-0 bg-white/20 hover:bg-white/30 text-white border-none"})]})]})})]})}),d.jsx("div",{className:"absolute top-0 right-0 w-1/2 h-1/2 bg-techblue/10 blur-3xl rounded-full"}),d.jsx("div",{className:"absolute bottom-0 left-0 w-1/2 h-1/2 bg-techpurple/10 blur-3xl rounded-full"})]})},fCe=()=>d.jsx("div",{className:"flex justify-center items-center min-h-screen bg-gray-100 p-4",children:d.jsxs("div",{className:"flex flex-col md:flex-row max-w-6xl w-full bg-white rounded-lg shadow-xl overflow-hidden",children:[d.jsxs("div",{className:"relative flex-1 bg-white p-6 md:p-8 flex flex-col justify-between",children:[d.jsxs("div",{className:"bg-red-500 text-white p-4 rounded-t-lg flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center",children:[d.jsxs("div",{className:"w-10 h-10 bg-white rounded-full flex items-center justify-center mr-3",children:[d.jsx("img",{src:"/Girl.png",alt:"Retro AI",className:"w-6 h-6"})," "]}),d.jsxs("div",{children:[d.jsx("p",{className:"font-bold text-lg",children:"Retro AI"}),d.jsx("p",{className:"text-sm",children:"Online"})]})]}),d.jsxs("div",{className:"flex space-x-1",children:[d.jsx("span",{className:"h-1 w-1 bg-white rounded-full"}),d.jsx("span",{className:"h-1 w-1 bg-white rounded-full"}),d.jsx("span",{className:"h-1 w-1 bg-white rounded-full"})]})]}),d.jsxs("div",{className:"flex-grow p-4 space-y-4 overflow-y-auto",children:[d.jsxs("div",{className:"flex items-start",children:[d.jsxs("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center mr-2",children:[d.jsx("span",{className:"text-sm font-bold",children:"JD"})," "]}),d.jsx("div",{className:"bg-gray-200 text-gray-800 p-3 rounded-tr-xl rounded-bl-xl rounded-br-xl max-w-xs",children:"How are you?"})]}),d.jsx("div",{className:"flex justify-end",children:d.jsx("div",{className:"bg-green-500 text-white p-3 rounded-tl-xl rounded-bl-xl rounded-br-xl max-w-xs",children:"Can you solve the current design model?"})}),d.jsx("p",{className:"text-right text-xs text-gray-500",children:"10:20PM"}),d.jsxs("div",{className:"flex items-start",children:[d.jsxs("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center mr-2",children:[d.jsx("span",{className:"text-sm font-bold",children:"JD"})," "]}),d.jsx("div",{className:"bg-gray-200 text-gray-800 p-3 rounded-tr-xl rounded-bl-xl rounded-br-xl max-w-xs",children:"I'm fine? Are you ok?"})]}),d.jsx("div",{className:"flex justify-end",children:d.jsx("div",{className:"bg-purple-500 text-white p-3 rounded-tl-xl rounded-bl-xl rounded-br-xl max-w-xs",children:"Sure, Let me find the solution"})}),d.jsx("p",{className:"text-right text-xs text-gray-500",children:"10:21PM"})]}),d.jsxs("div",{className:"p-4 bg-white border-t border-gray-200 flex items-center",children:[d.jsx("input",{type:"text",placeholder:"Ask me anything...",className:"flex-grow p-3 rounded-full bg-gray-100 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"}),d.jsx("button",{className:"ml-3 p-3 bg-blue-600 text-white rounded-full",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),d.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-cyan-400 text-white text-3xl font-bold p-4 rounded-lg shadow-lg rotate-12",style:{zIndex:10},children:["60x ",d.jsx("br",{})," Faster"]})]}),d.jsxs("div",{className:"flex-1 p-8 md:p-12 flex flex-col justify-center bg-gray-50",children:[d.jsx("p",{className:"text-sm font-semibold text-gray-600 uppercase mb-2",children:"Fastest AI Chatbot"}),d.jsx("h2",{className:"text-4xl md:text-5xl font-extrabold text-gray-900 leading-tight mb-6",children:"Accurate, fast & source backed responses"}),d.jsx("p",{className:"text-lg text-gray-700 leading-relaxed",children:"Business-ready chatbot responses backed by file & webpage sources, designed with anti-hallucination features to prevent irrelevant answers."})]})]})}),gCe=()=>d.jsxs(Eo,{children:[d.jsx(ETe,{}),d.jsx(fCe,{}),d.jsx(ITe,{}),d.jsx(OTe,{}),d.jsx(PTe,{}),d.jsx(mCe,{})]}),_Ce=({category:r,index:s,isReversed:a,onFeatureClick:c})=>{const[h,f]=V.useState(!1),[_,E]=V.useState(!1),v=V.useRef(null),x=r.icon;return V.useEffect(()=>{const T=new IntersectionObserver(([R])=>{R.isIntersecting&&f(!0)},{threshold:.1,rootMargin:"0px 0px -100px 0px"});return v.current&&T.observe(v.current),()=>{v.current&&T.unobserve(v.current)}},[]),d.jsxs("div",{ref:v,className:`grid grid-cols-1 lg:grid-cols-2 gap-12 items-center transition-all duration-1000 ${h?"opacity-100 translate-y-0":"opacity-0 translate-y-12"} ${a?"lg:grid-flow-col-dense":""}`,style:{transitionDelay:`${s*150}ms`},children:[d.jsxs("div",{className:a?"lg:col-start-2":"",children:[d.jsxs("div",{className:"flex items-center space-x-4 mb-6 group",children:[d.jsx("div",{className:`w-16 h-16 rounded-2xl bg-gradient-to-br from-brand-blue to-brand-cyan flex items-center justify-center transition-all duration-500 ${_?"scale-110 rotate-6 shadow-lg shadow-brand-blue/50":"scale-100 rotate-0"}`,children:d.jsx(x,{className:"w-8 h-8 text-white transition-transform duration-500 group-hover:scale-110"})}),d.jsx("div",{children:d.jsx("h2",{className:"text-3xl font-bold text-text transition-colors duration-300 group-hover:text-brand-blue",children:r.title})})]}),d.jsx("p",{className:"text-lg text-text-secondary mb-8 leading-relaxed",children:r.description}),d.jsx("ul",{className:"space-y-4",children:r.features.map((T,R)=>{T.split("")[0].trim();const N=T;return d.jsxs("li",{onClick:()=>c(r.title,N),className:"flex items-start space-x-3 group/feature transition-all duration-300 hover:translate-x-2 cursor-pointer p-2 rounded-lg hover:bg-bg-card",style:{animationDelay:`${s*150+R*100}ms`},children:[d.jsx("div",{className:"w-2 h-2 bg-brand-blue rounded-full mt-2 flex-shrink-0 transition-all duration-300 group-hover/feature:scale-150 group-hover/feature:bg-brand-cyan"}),d.jsxs("div",{className:"flex-1 flex items-center justify-between",children:[d.jsx("span",{className:"text-text-secondary transition-colors duration-300 group-hover/feature:text-text",children:T}),d.jsx(Lb,{className:"w-4 h-4 text-brand-blue opacity-0 group-hover/feature:opacity-100 transition-opacity duration-300 flex-shrink-0 ml-2"})]})]},R)})}),d.jsxs("button",{onClick:()=>c(r.title,r.description),className:"mt-6 px-6 py-3 bg-gradient-to-r from-brand-blue to-brand-cyan text-white rounded-lg font-semibold hover:shadow-lg hover:scale-105 transition-all duration-300 flex items-center space-x-2 group",children:[d.jsxs("span",{children:["Learn More About ",r.title]}),d.jsx(Lb,{className:"w-4 h-4 group-hover:translate-x-1 transition-transform"})]})]}),d.jsx("div",{className:`${a?"lg:col-start-1":""}`,onMouseEnter:()=>E(!0),onMouseLeave:()=>E(!1),children:d.jsxs("div",{className:"relative group",children:[d.jsxs("div",{onClick:()=>c(r.title,r.description),className:`card-interactive p-8 text-center transition-all duration-700 cursor-pointer ${_?"scale-105 rotate-1 shadow-2xl shadow-brand-blue/20 border-brand-blue/50":"scale-100 rotate-0"}`,style:{transform:_?"perspective(1000px) rotateY(2deg) rotateX(-2deg) scale(1.05)":"perspective(1000px) rotateY(0deg) rotateX(0deg) scale(1)"},children:[d.jsx("div",{className:`w-32 h-32 mx-auto mb-6 rounded-3xl bg-gradient-to-br from-brand-blue/20 to-brand-cyan/20 flex items-center justify-center transition-all duration-700 ${_?"scale-110 rotate-12 shadow-xl shadow-brand-blue/30":"scale-100 rotate-0"}`,children:d.jsx(x,{className:`w-16 h-16 text-brand-blue transition-all duration-700 ${_?"scale-125 rotate-12":"scale-100 rotate-0"}`})}),d.jsx("h3",{className:"text-xl font-semibold text-text mb-4 transition-colors duration-300 group-hover:text-brand-blue",children:r.title}),d.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[d.jsx("span",{className:`text-2xl font-bold text-gradient transition-all duration-500 ${_?"scale-125":"scale-100"}`,children:r.features.length}),d.jsx("span",{className:"text-text-secondary",children:"Features"})]}),d.jsx("div",{className:"mt-4 text-sm text-brand-blue opacity-0 group-hover:opacity-100 transition-opacity",children:"Click to learn more "})]}),d.jsx("div",{className:`absolute -top-4 -right-4 w-8 h-8 bg-brand-cyan/20 rounded-full blur-sm transition-all duration-700 ${_?"scale-150 opacity-100 animate-pulse":"scale-100 opacity-60"}`}),d.jsx("div",{className:`absolute -bottom-4 -left-4 w-12 h-12 bg-brand-blue/20 rounded-full blur-sm transition-all duration-700 ${_?"scale-150 opacity-100 animate-pulse":"scale-100 opacity-60"}`,style:{animationDelay:"0.3s"}}),d.jsx("div",{className:`absolute inset-0 rounded-xl bg-gradient-to-br from-brand-blue/0 to-brand-cyan/0 transition-all duration-700 pointer-events-none ${_?"from-brand-blue/10 to-brand-cyan/10 blur-xl":""}`})]})})]})},yCe=()=>{const[r,s]=V.useState(!1),[a,c]=V.useState(!1),h=V.useRef(null),f=V.useRef(null);V.useEffect(()=>{const v=new IntersectionObserver(([T])=>{T.isIntersecting&&s(!0)},{threshold:.2}),x=new IntersectionObserver(([T])=>{T.isIntersecting&&c(!0)},{threshold:.2});return h.current&&v.observe(h.current),f.current&&x.observe(f.current),()=>{h.current&&v.unobserve(h.current),f.current&&x.unobserve(f.current)}},[]);const _=(v,x)=>{window.location.href="/chat"},E=[{title:"AI-Powered Conversation Intelligence",description:"Smart assistants that enhance your communication experience",icon:Rge,features:["Context Memory AI  Remembers conversation history for smarter responses","Smart Meeting Summaries  Automatic recaps with action points","Sentiment Insights  Detects customer mood in real time for better engagement"]},{title:"Multi-Layer Privacy & Security",description:"Uncompromising data protection with advanced security features",icon:km,features:["Self-Destructing Confidential Rooms  Temporary encrypted spaces for sensitive talks","On-Device AI Processing  Keeps data local for maximum privacy","Stealth Mode  Disguises the app for private communication"]},{title:"Built-in Business & Collaboration Tools",description:"Everything you need for seamless teamwork",icon:Nc,features:["Space Hosting  Create virtual 'spaces' for projects, events, or departments, each with its own chat, file storage, and tools","Live Meetings  High-quality video/audio meetings directly inside IRU Chat without third-party apps","Contract & Document Signing  Legally sign files right in the chat","Voice-to-Task Conversion  Turn voice messages into trackable tasks automatically"]},{title:"Community & Broadcast Messaging",description:"Advanced tools for community engagement and broadcasting",icon:pl,features:["Community Channels  Large-scale discussion areas with topic threads","Broadcast Messaging  Send updates to unlimited subscribers without them being able to reply directly","Interest-Based Communities  Public or private spaces where people connect around shared topics"]},{title:"Real-Time Multilingual Collaboration",description:"Break down language barriers with instant translation",icon:gH,features:["Live Chat Translation  Instant text or voice translation for global teams","Group Translation Mode  Mixed-language groups communicate seamlessly"]},{title:"Advanced Media & File Features",description:"Powerful media handling and file management capabilities",icon:Nge,features:["AI Search in Files & Media  Find exact details inside images, audio, or documents instantly","Smart Document Scanner  Scan and share without leaving the chat"]},{title:"Productivity-First Experience",description:"Features designed to maximize your efficiency",icon:Mb,features:["Topic Threads Inside Chats  Organise discussions without creating new groups","AI Meeting Scheduler  Sets up meetings from chat context","Focus Mode  AI blocks non-essential notifications during work hours"]}];return d.jsxs(Eo,{children:[d.jsxs("section",{className:"hero-bg py-24 overflow-hidden relative",children:[d.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[d.jsx("div",{className:"absolute top-20 left-10 w-72 h-72 bg-brand-blue/10 rounded-full blur-3xl animate-pulse"}),d.jsx("div",{className:"absolute bottom-20 right-10 w-96 h-96 bg-brand-cyan/10 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}})]}),d.jsx("div",{className:"container mx-auto px-4 relative z-10",children:d.jsxs("div",{ref:h,className:`text-center max-w-4xl mx-auto transition-all duration-1000 ${r?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:[d.jsxs("h1",{className:"text-5xl md:text-6xl font-bold text-text mb-6",children:["Innovative ",d.jsx("span",{className:"text-gradient bg-clip-text text-transparent bg-gradient-to-r from-brand-blue to-brand-cyan",children:"Features"}),d.jsx("br",{}),"Built for the Future"]}),d.jsx("p",{className:"text-xl text-text-secondary leading-relaxed",children:"Discover the comprehensive suite of AI-powered features that make IRU Chat the most advanced communication platform for modern businesses."}),d.jsx("p",{className:"text-lg text-brand-blue mt-4 font-medium",children:" Click on any feature to learn more in Chat Now!"})]})})]}),d.jsx("section",{className:"py-24 bg-bg-secondary relative",children:d.jsx("div",{className:"container mx-auto px-4",children:d.jsx("div",{className:"space-y-24",children:E.map((v,x)=>d.jsx(_Ce,{category:v,index:x,isReversed:x%2===1,onFeatureClick:_},x))})})}),d.jsxs("section",{className:"py-24 bg-bg relative overflow-hidden",children:[d.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-brand-blue/5 via-transparent to-brand-cyan/5"}),d.jsx("div",{className:"container mx-auto px-4 relative z-10",children:d.jsxs("div",{ref:f,className:`text-center max-w-3xl mx-auto transition-all duration-1000 ${a?"opacity-100 translate-y-0 scale-100":"opacity-0 translate-y-10 scale-95"}`,children:[d.jsxs("h2",{className:"text-4xl font-bold text-text mb-6",children:["Experience All Features",d.jsx("br",{}),d.jsx("span",{className:"text-gradient bg-clip-text text-transparent bg-gradient-to-r from-brand-blue to-brand-cyan",children:"Risk-Free"})]}),d.jsx("p",{className:"text-xl text-text-secondary mb-8",children:"Start your 30-day free trial and discover how IRU Chat can transform your team's communication and productivity."}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[d.jsx(Fn,{to:"auth",children:d.jsx(qn,{className:"btn-hero text-lg px-8 py-4 transition-all duration-300 hover:scale-105 hover:shadow-xl hover:shadow-brand-blue/40",children:"Start Free Trial"})}),d.jsx(Fn,{to:"contact",children:d.jsx(qn,{className:"btn-secondary text-lg px-8 py-4 transition-all duration-300 hover:scale-105 hover:bg-brand-blue/10",children:"Schedule Demo"})})]})]})})]})]})},ECe=()=>{const r=[{icon:hH,title:"Banking & Financial Services",description:"Secure client communication portals and internal team collaboration",useCases:["Secure client communication portals","Private banking advisory chats","Internal team collaboration under bank branding"],benefits:["End-to-end encryption","Regulatory compliance","Audit trail capabilities","White-label customization"]},{icon:uA,title:"Healthcare & Medical Providers",description:"HIPAA-compliant patient communication tools and secure messaging",useCases:["HIPAA-compliant patient communication tools","Doctor-patient consultations and follow-ups","Staff coordination with secure messaging"],benefits:["HIPAA compliance guarantee","Secure patient data handling","End-to-end encryption","Telemedicine integration"]},{icon:Fge,title:"Education & E-Learning",description:"Branded platforms for enhanced learning and communication",useCases:["Branded platforms for student-teacher communication","Virtual classrooms with chat, video, and file sharing","Community channels for alumni and events"],benefits:["FERPA compliance","Multi-language support","Virtual classroom tools","Custom branding options"]},{icon:Zge,title:"Retail & E-Commerce",description:"Customer service integration and branded community channels",useCases:["Customer service chat integrated with sales platforms","Branded community channels for loyal customers and VIPs"],benefits:["24/7 customer support","Sales platform integration","Customer loyalty programs","Real-time order assistance"]},{icon:Vge,title:"Telecommunications",description:"Customer support and internal coordination tools",useCases:["Customer support chat branded as the telecom company's own","Internal team and field staff coordination apps"],benefits:["Brand consistency","Customer service integration","Field team coordination","Network status updates"]},{icon:Nc,title:"Government & Public Sector",description:"Secure inter-department and public engagement platforms",useCases:["Secure communication for inter-department coordination","Public engagement platforms with controlled access"],benefits:["Government-grade security","FISMA compliance","Controlled access systems","Inter-agency coordination"]},{icon:uH,title:"Professional Services & Consulting",description:"Client communication and project collaboration tools",useCases:["Client communication portals with secure document sharing","Project collaboration under consulting firm branding"],benefits:["Secure document sharing","Professional branding","Project management tools","Client portal access"]},{icon:hA,title:"Real Estate",description:"Client interaction channels and collaboration tools",useCases:["Branded client interaction channels for property inquiries","Agent collaboration and deal tracking tools"],benefits:["Lead management system","Property showcase tools","Agent collaboration","Deal tracking features"]},{icon:Xge,title:"Media & Entertainment",description:"Fan community and production team collaboration",useCases:["Fan community channels and broadcast messaging","Internal production team collaboration apps"],benefits:["Fan engagement tools","Broadcast messaging","Content collaboration","Community management"]},{icon:uA,title:"Nonprofits & NGOs",description:"Donor communication and secure coordination platforms",useCases:["Donor and volunteer communication platforms","Secure internal coordination with branded identity"],benefits:["Donor engagement tools","Volunteer coordination","Secure communications","Custom branding"]}];return d.jsxs(Eo,{children:[d.jsx("section",{className:"hero-bg py-24",children:d.jsx("div",{className:"container mx-auto px-4",children:d.jsxs("div",{className:"text-center max-w-4xl mx-auto",children:[d.jsxs("h1",{className:"text-5xl md:text-6xl font-bold text-text mb-6",children:["Tailored ",d.jsx("span",{className:"text-gradient",children:"Solutions"}),d.jsx("br",{}),"for Every Industry"]}),d.jsx("p",{className:"text-xl text-text-secondary leading-relaxed",children:"IRU Chat adapts to your industry's unique needs with specialized features, compliance standards, and workflow optimizations."})]})})}),d.jsx("section",{className:"py-24 bg-bg-secondary",children:d.jsx("div",{className:"container mx-auto px-4",children:d.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12",children:r.map((s,a)=>{const c=s.icon;return d.jsxs("div",{className:"card-interactive",children:[d.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[d.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gradient-to-br from-brand-blue to-brand-cyan flex items-center justify-center",children:d.jsx(c,{className:"w-8 h-8 text-white"})}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-2xl font-bold text-text",children:s.title}),d.jsx("p",{className:"text-text-secondary",children:s.description})]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-text mb-4",children:"Key Use Cases"}),d.jsx("ul",{className:"space-y-3",children:s.useCases.map((h,f)=>d.jsxs("li",{className:"flex items-start space-x-3",children:[d.jsx("div",{className:"w-2 h-2 bg-brand-blue rounded-full mt-2 flex-shrink-0"}),d.jsx("span",{className:"text-text-secondary text-sm",children:h})]},f))})]}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-text mb-4",children:"Key Benefits"}),d.jsx("ul",{className:"space-y-3",children:s.benefits.map((h,f)=>d.jsxs("li",{className:"flex items-start space-x-3",children:[d.jsx("div",{className:"w-2 h-2 bg-brand-cyan rounded-full mt-2 flex-shrink-0"}),d.jsx("span",{className:"text-text-secondary text-sm",children:h})]},f))})]})]}),d.jsx("div",{className:"mt-6 pt-6 border-t border-border",children:d.jsxs("button",{className:"btn-secondary w-full",children:["Learn More About ",s.title]})})]},a)})})})}),d.jsx("section",{className:"py-24 bg-bg",children:d.jsx("div",{className:"container mx-auto px-4",children:d.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[d.jsxs("h2",{className:"text-4xl font-bold text-text mb-6",children:[d.jsx("span",{className:"text-gradient",children:"White-Label"})," Solutions"]}),d.jsx("p",{className:"text-xl text-text-secondary mb-12 leading-relaxed",children:"Transform IRU Chat into your own branded communication platform with our comprehensive white-label options."}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[d.jsxs("div",{className:"card-interactive text-center",children:[d.jsx("div",{className:"w-16 h-16 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-brand-blue to-brand-cyan flex items-center justify-center",children:d.jsx("span",{className:"text-white font-bold text-xl",children:"1"})}),d.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Custom Branding"}),d.jsx("p",{className:"text-text-secondary",children:"Complete customization of colors, logos, and interface to match your brand identity."})]}),d.jsxs("div",{className:"card-interactive text-center",children:[d.jsx("div",{className:"w-16 h-16 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-brand-cyan to-brand-blue flex items-center justify-center",children:d.jsx("span",{className:"text-white font-bold text-xl",children:"2"})}),d.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Custom Domain"}),d.jsx("p",{className:"text-text-secondary",children:"Host on your own domain with SSL certificates and full DNS control."})]}),d.jsxs("div",{className:"card-interactive text-center",children:[d.jsx("div",{className:"w-16 h-16 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-brand-blue to-brand-cyan flex items-center justify-center",children:d.jsx("span",{className:"text-white font-bold text-xl",children:"3"})}),d.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"API Integration"}),d.jsx("p",{className:"text-text-secondary",children:"Seamless integration with your existing systems and workflows."})]})]})]})})}),d.jsx("section",{className:"py-24 bg-bg-secondary",children:d.jsx("div",{className:"container mx-auto px-4",children:d.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[d.jsxs("h2",{className:"text-4xl font-bold text-text mb-6",children:["Ready to Transform Your",d.jsx("br",{}),d.jsx("span",{className:"text-gradient",children:"Industry Communication?"})]}),d.jsx("p",{className:"text-xl text-text-secondary mb-8",children:"Let's discuss how IRU Chat can be tailored to your specific industry needs and compliance requirements."}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[d.jsx(Fn,{to:"/contact",children:d.jsx(qn,{className:"btn-hero text-lg px-8 py-4",children:"Schedule Consultation"})}),d.jsx(Fn,{to:"/contact",children:d.jsx(qn,{className:"btn-secondary text-lg px-8 py-4",children:"Request Demo"})})]})]})})})]})},vCe="",bCe=()=>{const[r,s]=V.useState([]),[a,c]=V.useState(!0);V.useEffect(()=>{h()},[]);const h=async()=>{try{const T=await fetch(`${vCe}/api/pricing`);if(T.ok){const N=(await T.json()).filter(L=>L.isActive).sort((L,j)=>L.price-j.price);s(N)}}catch(T){console.error("Error fetching pricing plans:",T)}finally{c(!1)}},f=[{id:"1",name:"Starter",price:3500,duration:"monthly",description:"Ideal for Small Teams & Startups",popular:!1,features:["Secure messaging, group chats","Up to 50 participants per channel","File sharing"]},{id:"2",name:"Professional",price:7500,duration:"monthly",description:"Ideal for Growing Businesses",popular:!0,features:["All Starter features","AI-powered chat assistant","Live translation","Up to 200 participants per channel","10GB file storage"]},{id:"3",name:"Business",price:14500,duration:"monthly",description:"Ideal for Enterprises & Institutions",popular:!1,features:["All Professional features","Live meetings","Space hosting","Unlimited channels","Broadcast messaging","50GB file storage"]},{id:"4",name:"Enterprise",price:25e3,duration:"monthly",description:"Ideal for Large-Scale Organizations",popular:!1,features:["All Business features","On-premises hosting","Custom AI bots","Dedicated account manager","Unlimited storage","Priority support"]}],_=r.length>0?r:f,E=T=>T==="monthly"?"per user/month":T==="yearly"?"per user/year":T==="lifetime"?"one-time payment":`per ${T}`,v=(T,R)=>R==="Enterprise"?`From RWF ${T.toLocaleString()}`:`RWF ${T.toLocaleString()}`,x=[{name:"Verified User Badge",price:"RWF 5,000",period:"per year",description:"Enhanced credibility, exclusive badge on profile"},{name:"Extra Storage",price:"RWF 500",period:"per GB/month",description:"Add additional file storage"},{name:"Custom AI Bot Development",price:"From RWF 250,000",period:"",description:"Custom AI chatbots for your specific needs"},{name:"White-Label Branding",price:"From RWF 1,500,000",period:"per year",description:"Full customization with your corporate identity"}];return d.jsxs(Eo,{children:[d.jsx("section",{className:"hero-bg py-24",children:d.jsx("div",{className:"container mx-auto px-4",children:d.jsxs("div",{className:"text-center max-w-4xl mx-auto",children:[d.jsxs("h1",{className:"text-5xl md:text-6xl font-bold text-text mb-6",children:["Simple, ",d.jsx("span",{className:"text-gradient",children:"Transparent"}),d.jsx("br",{}),"Pricing"]}),d.jsx("p",{className:"text-xl text-text-secondary leading-relaxed mb-8",children:"Choose the perfect plan for your team. Start free, scale as you grow, and unlock the full potential of AI-powered communication."}),d.jsxs("div",{className:"inline-flex items-center space-x-2 bg-bg-card/30 backdrop-blur-sm border border-border/20 rounded-full px-6 py-3",children:[d.jsx("span",{className:"w-2 h-2 bg-brand-cyan rounded-full animate-pulse"}),d.jsx("span",{className:"text-sm text-text-secondary",children:"30-day free trial  No credit card required"})]})]})})}),d.jsx("section",{className:"py-24 bg-bg-secondary",children:d.jsx("div",{className:"container mx-auto px-4",children:a?d.jsx("div",{className:"text-center py-12",children:d.jsx("p",{className:"text-text-secondary",children:"Loading pricing plans..."})}):d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:_.map((T,R)=>{const N=T.name==="Professional"||T.popular||R===1,L=Array.isArray(T.features)?T.features:T.features||[];return d.jsxs("div",{className:`relative bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-700 hover:border-blue-500 transition-all ${N?"ring-2 ring-blue-500":""}`,children:[N&&d.jsx("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:d.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 text-white px-4 py-1 rounded-full text-sm font-semibold flex items-center space-x-1",children:[d.jsx(aO,{className:"w-4 h-4"}),d.jsx("span",{children:"Most Popular"})]})}),d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:T.name}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:T.description||`Ideal for ${T.name} users`}),d.jsxs("div",{className:"mb-6",children:[d.jsx("span",{className:"text-4xl font-bold text-cyan-400",children:v(T.price,T.name)}),d.jsx("span",{className:"text-gray-400 ml-2 text-sm",children:E(T.duration)})]}),d.jsxs(qn,{className:`w-full ${N?"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[T.name==="Enterprise"?"Contact Sales":"Start Free Trial",d.jsx(Lb,{className:"ml-2 w-4 h-4"})]})]}),d.jsx("div",{className:"space-y-4",children:L.map((j,F)=>d.jsxs("div",{className:"flex items-start space-x-3",children:[d.jsx(nO,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),d.jsx("span",{className:"text-gray-300 text-sm",children:j})]},F))})]},T.id||R)})})})}),d.jsx("section",{className:"py-24 bg-bg-secondary",children:d.jsxs("div",{className:"container mx-auto px-4",children:[d.jsx("div",{className:"text-center max-w-3xl mx-auto mb-16",children:d.jsxs("h2",{className:"text-4xl font-bold text-text mb-6",children:["Available ",d.jsx("span",{className:"text-gradient",children:"Add-Ons"})]})}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:x.map((T,R)=>d.jsxs("div",{className:"card-interactive",children:[d.jsx("h3",{className:"text-xl font-bold text-text mb-2",children:T.name}),d.jsx("p",{className:"text-text-secondary text-sm mb-4",children:T.description}),d.jsxs("div",{className:"mb-6",children:[d.jsx("span",{className:"text-2xl font-bold text-gradient",children:T.price}),T.period&&d.jsx("span",{className:"text-text-secondary ml-2",children:T.period})]})]},R))})]})}),d.jsx("section",{className:"py-24 bg-bg-secondary",children:d.jsxs("div",{className:"container mx-auto px-4",children:[d.jsx("div",{className:"text-center max-w-3xl mx-auto mb-16",children:d.jsxs("h2",{className:"text-4xl font-bold text-text mb-6",children:["Frequently Asked ",d.jsx("span",{className:"text-gradient",children:"Questions"})]})}),d.jsx("div",{className:"max-w-4xl mx-auto space-y-8",children:[{question:"Can I change my plan anytime?",answer:"Yes, you can upgrade or downgrade your plan at any time. Changes take effect immediately and you'll be billed prorated amounts."},{question:"Is there a free trial?",answer:"All plans include a 30-day free trial with full access to features. No credit card required to start."},{question:"What payment methods do you accept?",answer:"We accept all major credit cards, PayPal, and bank transfers for annual plans. Enterprise customers can also pay by invoice."},{question:"Is my data secure?",answer:"Absolutely. We use end-to-end encryption, comply with international security standards, and undergo regular security audits."},{question:"Do you offer discounts for annual billing?",answer:"Yes, annual billing provides a 20% discount on all plans. Contact sales for custom enterprise pricing."}].map((T,R)=>d.jsxs("div",{className:"card-interactive",children:[d.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:T.question}),d.jsx("p",{className:"text-text-secondary",children:T.answer})]},R))})]})}),d.jsx("section",{className:"py-24 bg-bg",children:d.jsx("div",{className:"container mx-auto px-4",children:d.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[d.jsxs("h2",{className:"text-4xl font-bold text-text mb-6",children:["Ready to Get ",d.jsx("span",{className:"text-gradient",children:"Started?"})]}),d.jsx("p",{className:"text-xl text-text-secondary mb-8",children:"Join thousands of teams already using IRU Chat to revolutionize their communication."}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[d.jsx(Fn,{to:"auth",children:d.jsx(qn,{className:"btn-hero text-lg px-8 py-4",children:"Start Free Trial"})}),d.jsx(Fn,{to:"contact",children:d.jsx(qn,{className:"btn-secondary text-lg px-8 py-4",children:"Schedule Demo"})})]})]})})})]})},XW="",SCe=()=>{const[r,s]=V.useState("signIn"),[a,c]=V.useState(""),[h,f]=V.useState(""),[_,E]=V.useState(""),[v,x]=V.useState(!1),[T,R]=V.useState(!1),[N,L]=V.useState(!1),j=vh(),{toast:F}=za(),P=async te=>{te.preventDefault(),x(!0);try{const se=`${XW}/api/auth/login`;console.log(" Sign in request to:",se);const ie=await fetch(se,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:h})});console.log(" Response status:",ie.status,ie.statusText),console.log(" Response headers:",Object.fromEntries(ie.headers.entries()));const ue=ie.headers.get("content-type");if(!ue||!ue.includes("application/json")){const Ne=await ie.text();throw console.error(" Non-JSON response:",Ne.substring(0,200)),new Error(`Server returned ${ie.status}: Expected JSON but got ${ue}. Make sure the backend server is running on port 5000.`)}const de=await ie.json();if(!ie.ok){if(de.errors&&Array.isArray(de.errors)){const Ne=de.errors.map(Ce=>Ce.msg||Ce.message).join(", ");throw new Error(Ne||"Validation failed")}throw new Error(de.error||de.message||"Failed to sign in")}localStorage.setItem("iru-auth",JSON.stringify({token:de.token,user:{id:de.user.id,name:de.user.fullName,email:de.user.email,role:de.user.role||"user",createdAt:de.user.createdAt}})),F({title:"Signed in",description:`Welcome back, ${de.user.fullName}!`}),de.user.role==="admin"?j("/admin"):j("/chat")}catch(se){console.error(" Sign in error:",se),F({title:"Sign in failed",description:se.message||"Please check your credentials and try again.",variant:"destructive"})}finally{x(!1)}},M=async te=>{te.preventDefault(),x(!0);try{const se=`${XW}/api/auth/register`;console.log(" Sign up request to:",se);const ie=await fetch(se,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:_,email:a,password:h})});console.log(" Response status:",ie.status,ie.statusText),console.log(" Response headers:",Object.fromEntries(ie.headers.entries()));const ue=ie.headers.get("content-type");if(!ue||!ue.includes("application/json")){const Ne=await ie.text();throw console.error(" Non-JSON response:",Ne.substring(0,200)),new Error(`Server returned ${ie.status}: Expected JSON but got ${ue}. Make sure the backend server is running on port 5000.`)}const de=await ie.json();if(!ie.ok){if(de.errors&&Array.isArray(de.errors)){const Ne=de.errors.map(Ce=>Ce.msg||Ce.message).join(", ");throw new Error(Ne||"Validation failed")}throw new Error(de.error||de.message||"Failed to create account")}localStorage.setItem("iru-auth",JSON.stringify({token:de.token,user:{id:de.user.id,name:de.user.fullName,email:de.user.email,role:de.user.role||"user",createdAt:de.user.createdAt}})),F({title:"Account created",description:`Welcome, ${de.user.fullName}!`}),de.user.role==="admin"?j("/admin"):j("/chat")}catch(se){console.error(" Sign up error:",se),F({title:"Sign up failed",description:se.message||"Please check your details and try again.",variant:"destructive"})}finally{x(!1)}},U=async()=>{F({title:"Google Sign In",description:"Google authentication will be available soon!"})},B=async()=>{F({title:"Google Sign Up",description:"Google authentication will be available soon!"})},K=()=>d.jsxs("form",{onSubmit:P,children:[d.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Welcome back"}),d.jsx("p",{className:"text-gray-600 mb-6",children:"Sign in to your account to continue chatting"}),d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{htmlFor:"email",className:"block text-gray-700 text-sm font-medium mb-2",children:"Email"}),d.jsx("input",{type:"email",id:"email",value:a,onChange:te=>c(te.target.value),placeholder:"you@email.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",required:!0})]}),d.jsxs("div",{className:"mb-6",children:[d.jsxs("div",{className:"flex justify-between items-center mb-2",children:[d.jsx("label",{htmlFor:"password",className:"block text-gray-700 text-sm font-medium",children:"Password"}),d.jsx("span",{className:"text-sm text-gray-400",children:"Keep it safe"})]}),d.jsxs("div",{className:"relative",children:[d.jsx("input",{type:T?"text":"password",id:"password",value:h,onChange:te=>f(te.target.value),placeholder:"",className:"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",required:!0}),d.jsx("button",{type:"button",onClick:()=>R(!T),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700","aria-label":T?"Hide password":"Show password",children:T?d.jsx(lA,{size:18}):d.jsx(dA,{size:18})})]})]}),d.jsx(qn,{type:"submit",className:"w-full btn-hero",disabled:v,children:v?"Signing in...":"Sign In"}),d.jsxs("div",{className:"relative my-6",children:[d.jsx("div",{className:"absolute inset-0 flex items-center",children:d.jsx("div",{className:"w-full border-t border-gray-300"})}),d.jsx("div",{className:"relative flex justify-center text-sm",children:d.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),d.jsxs("button",{type:"button",onClick:U,className:"w-full flex items-center justify-center gap-3 px-4 py-2.5 border border-gray-300 rounded-lg bg-white hover:bg-gray-50 transition-colors text-gray-700 font-medium shadow-sm",children:[d.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[d.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),d.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),d.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),d.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),d.jsx("span",{className:"text-gray-800",children:"Sign in with Google"})]})]}),J=()=>d.jsxs("form",{onSubmit:M,children:[d.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Create an account"}),d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{htmlFor:"name",className:"block text-gray-700 text-sm font-medium mb-2",children:"Full Name"}),d.jsx("input",{type:"text",id:"name",value:_,onChange:te=>E(te.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",required:!0})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{htmlFor:"email-signup",className:"block text-gray-700 text-sm font-medium mb-2",children:"Email"}),d.jsx("input",{type:"email",id:"email-signup",value:a,onChange:te=>c(te.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",required:!0})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{htmlFor:"password-signup",className:"block text-gray-700 text-sm font-medium mb-2",children:"Password"}),d.jsxs("div",{className:"relative",children:[d.jsx("input",{type:N?"text":"password",id:"password-signup",value:h,onChange:te=>f(te.target.value),placeholder:"",className:"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",required:!0}),d.jsx("button",{type:"button",onClick:()=>L(!N),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700","aria-label":N?"Hide password":"Show password",children:N?d.jsx(lA,{size:18}):d.jsx(dA,{size:18})})]})]}),d.jsx(qn,{type:"submit",className:"w-full btn-hero mt-4",disabled:v,children:v?"Creating account...":"Create Account"}),d.jsxs("div",{className:"relative my-6",children:[d.jsx("div",{className:"absolute inset-0 flex items-center",children:d.jsx("div",{className:"w-full border-t border-gray-300"})}),d.jsx("div",{className:"relative flex justify-center text-sm",children:d.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),d.jsxs("button",{type:"button",onClick:B,className:"w-full flex items-center justify-center gap-3 px-4 py-2.5 border border-gray-300 rounded-lg bg-white hover:bg-gray-50 transition-colors text-gray-700 font-medium shadow-sm",children:[d.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[d.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),d.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),d.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),d.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),d.jsx("span",{className:"text-gray-800",children:"Sign up with Google"})]})]});return d.jsx("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center p-4",children:d.jsxs("div",{className:"w-full max-w-md bg-white rounded-lg shadow-xl p-8",children:[d.jsxs(Fn,{to:"/",className:"inline-flex items-center text-gray-600 hover:text-gray-900 mb-6 transition-colors",children:[d.jsx(tO,{size:18,className:"mr-2"}),d.jsx("span",{className:"text-sm font-medium",children:"Back to Home"})]}),d.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg mb-8",children:[d.jsx("button",{className:`flex-1 py-2 text-center rounded-md text-lg font-medium transition-all duration-300 ${r==="signIn"?"bg-white shadow text-gray-800":"text-gray-600 hover:text-gray-800"}`,onClick:()=>s("signIn"),type:"button",children:"Sign In"}),d.jsx("button",{className:`flex-1 py-2 text-center rounded-md text-lg font-medium transition-all duration-300 ${r==="signUp"?"bg-white shadow text-gray-800":"text-gray-600 hover:text-gray-800"}`,onClick:()=>s("signUp"),type:"button",children:"Sign Up"})]}),r==="signIn"?K():J()]})})},xCe=()=>{const r=[{icon:Mb,title:"Innovation",description:"Continuously pushing the boundaries of technology."},{icon:km,title:"Security",description:"Protecting every conversation with uncompromising privacy."},{icon:uA,title:"Excellence",description:"Delivering a premium user experience at every level."},{icon:Nc,title:"Customer Focus",description:"Designing solutions that truly serve user needs."}],s=[{icon:km,title:"End-to-End Encrypted Messaging",description:"Protect your conversations from unauthorized access"},{icon:Mb,title:"AI Chat Assistants",description:"Automate responses, analyze interactions, and boost efficiency"},{icon:gH,title:"Multi-Language Support",description:"Instant translation for global communications"},{icon:wge,title:"Seamless Integrations",description:"Connect with IRU ecosystem products & third-party tools"}],a=[{number:"10,000+",label:"Active Organizations"},{number:"1M+",label:"Messages Sent Daily"},{number:"99.99%",label:"Uptime Guarantee"},{number:"50+",label:"Countries Served"}];return d.jsxs(Eo,{children:[d.jsx("section",{className:"hero-bg py-24",children:d.jsx("div",{className:"container mx-auto px-4",children:d.jsxs("div",{className:"text-center max-w-4xl mx-auto",children:[d.jsxs("h1",{className:"text-5xl md:text-6xl font-bold text-text mb-6",children:["About ",d.jsx("span",{className:"text-gradient",children:"IRU Chat"}),d.jsx("br",{}),"Where Communication Meets Intelligence"]}),d.jsx("p",{className:"text-xl text-text-secondary leading-relaxed",children:"IRU Chat is a next-generation, AI powered messaging platform designed for seamless, secure, and intelligent communication. Developed by IRU BUSINESS GROUP Ltd, we transform every conversation into a productive experience with real-time messaging, smart automation, and advanced data privacy."})]})})}),d.jsx("section",{className:"py-24 bg-bg-secondary",children:d.jsx("div",{className:"container mx-auto px-4",children:d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[d.jsxs("div",{className:"card-interactive",children:[d.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[d.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gradient-to-br from-brand-blue to-brand-cyan flex items-center justify-center",children:d.jsx(dA,{className:"w-8 h-8 text-white"})}),d.jsx("h2",{className:"text-3xl font-bold text-text",children:"Our Vision"})]}),d.jsxs("p",{className:"text-lg text-text-secondary leading-relaxed",children:["To become the ",d.jsx("strong",{className:"text-text",children:"global leader"})," in intelligent, secure, and integrated communication systems that empower people and businesses to connect, collaborate, and grow without barriers."]})]}),d.jsxs("div",{className:"card-interactive",children:[d.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[d.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gradient-to-br from-brand-cyan to-brand-blue flex items-center justify-center",children:d.jsx(t0e,{className:"w-8 h-8 text-white"})}),d.jsx("h2",{className:"text-3xl font-bold text-text",children:"Our Mission"})]}),d.jsxs("p",{className:"text-lg text-text-secondary leading-relaxed",children:["To provide a ",d.jsx("strong",{className:"text-text",children:"smart, secure, and scalable communication solution"}),"that enhances productivity, strengthens relationships, and drives business success through AI-powered features and uncompromising data privacy."]})]})]})})}),d.jsx("section",{className:"py-24 bg-bg",children:d.jsxs("div",{className:"container mx-auto px-4",children:[d.jsxs("div",{className:"text-center max-w-3xl mx-auto mb-16",children:[d.jsxs("h2",{className:"text-4xl font-bold text-text mb-6",children:["Our Core ",d.jsx("span",{className:"text-gradient",children:"Values"})]}),d.jsx("p",{className:"text-xl text-text-secondary",children:"The principles that guide everything we do and shape our culture of excellence."})]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:r.map((c,h)=>{const f=c.icon;return d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-3xl bg-gradient-to-br from-brand-blue to-brand-cyan flex items-center justify-center",children:d.jsx(f,{className:"w-10 h-10 text-white"})}),d.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:c.title}),d.jsx("p",{className:"text-text-secondary leading-relaxed",children:c.description})]},h)})})]})}),d.jsx("section",{className:"py-24 bg-bg-secondary",children:d.jsxs("div",{className:"container mx-auto px-4",children:[d.jsxs("div",{className:"text-center max-w-3xl mx-auto mb-16",children:[d.jsxs("h2",{className:"text-4xl font-bold text-text mb-6",children:["Key ",d.jsx("span",{className:"text-gradient",children:"Highlights"})]}),d.jsx("p",{className:"text-xl text-text-secondary",children:"What makes IRU Chat the preferred choice for modern businesses."})]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:s.map((c,h)=>{const f=c.icon;return d.jsxs("div",{className:"card-interactive text-center",children:[d.jsx("div",{className:"w-16 h-16 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-brand-blue/20 to-brand-cyan/20 flex items-center justify-center",children:d.jsx(f,{className:"w-8 h-8 text-brand-blue"})}),d.jsx("h3",{className:"text-lg font-semibold text-text mb-3",children:c.title}),d.jsx("p",{className:"text-text-secondary text-sm",children:c.description})]},h)})})]})}),d.jsx("section",{className:"py-24 bg-bg",children:d.jsx("div",{className:"container mx-auto px-4",children:d.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-8",children:a.map((c,h)=>d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-4xl md:text-5xl font-bold text-gradient mb-2",children:c.number}),d.jsx("div",{className:"text-text-secondary",children:c.label})]},h))})})}),d.jsx("section",{className:"py-24 bg-bg-secondary",children:d.jsx("div",{className:"container mx-auto px-4",children:d.jsxs("div",{className:"max-w-4xl mx-auto",children:[d.jsx("div",{className:"text-center mb-16",children:d.jsxs("h2",{className:"text-4xl font-bold text-text mb-6",children:["Company ",d.jsx("span",{className:"text-gradient",children:"Profile"})]})}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[d.jsxs("div",{className:"card-interactive",children:[d.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Company Information"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-text-secondary",children:"Company Name:"}),d.jsx("span",{className:"text-text font-medium",children:"IRU BUSINESS GROUP Ltd"})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-text-secondary",children:"Headquarters:"}),d.jsx("span",{className:"text-text font-medium",children:"Gahanga, Kicukiro, Kigali, Rwanda"})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-text-secondary",children:"Industry:"}),d.jsx("span",{className:"text-text font-medium",children:"Technology, AI Solutions, Enterprise Communication"})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-text-secondary",children:"Founded:"}),d.jsx("span",{className:"text-text font-medium",children:"2023"})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-text-secondary",children:"Phone:"}),d.jsx("a",{href:"tel:+250795381733",className:"text-text font-medium hover:text-brand-blue transition-colors",children:"0795 381 733 / 0736 318 111"})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-text-secondary",children:"WhatsApp:"}),d.jsx("a",{href:"https://wa.me/250795381733",target:"_blank",rel:"noopener noreferrer",className:"text-text font-medium hover:text-brand-blue transition-colors",children:"0795381733"})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-text-secondary",children:"Address:"}),d.jsx("span",{className:"text-text font-medium",children:"Gahanga, Kicukiro, Kigali, Rwanda"})]})]})]}),d.jsxs("div",{className:"card-interactive",children:[d.jsx("h3",{className:"text-xl font-semibold text-text mb-4",children:"Our Focus"}),d.jsxs("ul",{className:"space-y-3",children:[d.jsxs("li",{className:"flex items-start space-x-3",children:[d.jsx("div",{className:"w-2 h-2 bg-brand-blue rounded-full mt-2 flex-shrink-0"}),d.jsx("span",{className:"text-text-secondary",children:"Real-time, secure messaging"})]}),d.jsxs("li",{className:"flex items-start space-x-3",children:[d.jsx("div",{className:"w-2 h-2 bg-brand-cyan rounded-full mt-2 flex-shrink-0"}),d.jsx("span",{className:"text-text-secondary",children:"AI-powered assistants & chatbots"})]}),d.jsxs("li",{className:"flex items-start space-x-3",children:[d.jsx("div",{className:"w-2 h-2 bg-brand-blue rounded-full mt-2 flex-shrink-0"}),d.jsx("span",{className:"text-text-secondary",children:"Multi-language instant translation"})]}),d.jsxs("li",{className:"flex items-start space-x-3",children:[d.jsx("div",{className:"w-2 h-2 bg-brand-cyan rounded-full mt-2 flex-shrink-0"}),d.jsx("span",{className:"text-text-secondary",children:"Team collaboration & file sharing"})]}),d.jsxs("li",{className:"flex items-start space-x-3",children:[d.jsx("div",{className:"w-2 h-2 bg-brand-blue rounded-full mt-2 flex-shrink-0"}),d.jsx("span",{className:"text-text-secondary",children:"Integration with the IRU ecosystem and third-party apps"})]}),d.jsxs("li",{className:"flex items-start space-x-3",children:[d.jsx("div",{className:"w-2 h-2 bg-brand-cyan rounded-full mt-2 flex-shrink-0"}),d.jsx("span",{className:"text-text-secondary",children:"Scalable for businesses of any size"})]})]})]})]})]})})})]})},Lc=Object.create(null);Lc.open="0";Lc.close="1";Lc.ping="2";Lc.pong="3";Lc.message="4";Lc.upgrade="5";Lc.noop="6";const ob=Object.create(null);Object.keys(Lc).forEach(r=>{ob[Lc[r]]=r});const XA={type:"error",data:"parser error"},pY=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",mY=typeof ArrayBuffer=="function",fY=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,l2=({type:r,data:s},a,c)=>pY&&s instanceof Blob?a?c(s):JW(s,c):mY&&(s instanceof ArrayBuffer||fY(s))?a?c(s):JW(new Blob([s]),c):c(Lc[r]+(s||"")),JW=(r,s)=>{const a=new FileReader;return a.onload=function(){const c=a.result.split(",")[1];s("b"+(c||""))},a.readAsDataURL(r)};function QW(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let c1;function wCe(r,s){if(pY&&r.data instanceof Blob)return r.data.arrayBuffer().then(QW).then(s);if(mY&&(r.data instanceof ArrayBuffer||fY(r.data)))return s(QW(r.data));l2(r,!1,a=>{c1||(c1=new TextEncoder),s(c1.encode(a))})}const ZW="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Yg=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<ZW.length;r++)Yg[ZW.charCodeAt(r)]=r;const TCe=r=>{let s=r.length*.75,a=r.length,c,h=0,f,_,E,v;r[r.length-1]==="="&&(s--,r[r.length-2]==="="&&s--);const x=new ArrayBuffer(s),T=new Uint8Array(x);for(c=0;c<a;c+=4)f=Yg[r.charCodeAt(c)],_=Yg[r.charCodeAt(c+1)],E=Yg[r.charCodeAt(c+2)],v=Yg[r.charCodeAt(c+3)],T[h++]=f<<2|_>>4,T[h++]=(_&15)<<4|E>>2,T[h++]=(E&3)<<6|v&63;return x},CCe=typeof ArrayBuffer=="function",d2=(r,s)=>{if(typeof r!="string")return{type:"message",data:gY(r,s)};const a=r.charAt(0);return a==="b"?{type:"message",data:RCe(r.substring(1),s)}:ob[a]?r.length>1?{type:ob[a],data:r.substring(1)}:{type:ob[a]}:XA},RCe=(r,s)=>{if(CCe){const a=TCe(r);return gY(a,s)}else return{base64:!0,data:r}},gY=(r,s)=>{switch(s){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},_Y="",NCe=(r,s)=>{const a=r.length,c=new Array(a);let h=0;r.forEach((f,_)=>{l2(f,!1,E=>{c[_]=E,++h===a&&s(c.join(_Y))})})},ACe=(r,s)=>{const a=r.split(_Y),c=[];for(let h=0;h<a.length;h++){const f=d2(a[h],s);if(c.push(f),f.type==="error")break}return c};function ICe(){return new TransformStream({transform(r,s){wCe(r,a=>{const c=a.length;let h;if(c<126)h=new Uint8Array(1),new DataView(h.buffer).setUint8(0,c);else if(c<65536){h=new Uint8Array(3);const f=new DataView(h.buffer);f.setUint8(0,126),f.setUint16(1,c)}else{h=new Uint8Array(9);const f=new DataView(h.buffer);f.setUint8(0,127),f.setBigUint64(1,BigInt(c))}r.data&&typeof r.data!="string"&&(h[0]|=128),s.enqueue(h),s.enqueue(a)})}})}let l1;function Mv(r){return r.reduce((s,a)=>s+a.length,0)}function jv(r,s){if(r[0].length===s)return r.shift();const a=new Uint8Array(s);let c=0;for(let h=0;h<s;h++)a[h]=r[0][c++],c===r[0].length&&(r.shift(),c=0);return r.length&&c<r[0].length&&(r[0]=r[0].slice(c)),a}function OCe(r,s){l1||(l1=new TextDecoder);const a=[];let c=0,h=-1,f=!1;return new TransformStream({transform(_,E){for(a.push(_);;){if(c===0){if(Mv(a)<1)break;const v=jv(a,1);f=(v[0]&128)===128,h=v[0]&127,h<126?c=3:h===126?c=1:c=2}else if(c===1){if(Mv(a)<2)break;const v=jv(a,2);h=new DataView(v.buffer,v.byteOffset,v.length).getUint16(0),c=3}else if(c===2){if(Mv(a)<8)break;const v=jv(a,8),x=new DataView(v.buffer,v.byteOffset,v.length),T=x.getUint32(0);if(T>Math.pow(2,21)-1){E.enqueue(XA);break}h=T*Math.pow(2,32)+x.getUint32(4),c=3}else{if(Mv(a)<h)break;const v=jv(a,h);E.enqueue(d2(f?v:l1.decode(v),s)),c=0}if(h===0||h>r){E.enqueue(XA);break}}}})}const yY=4;function ms(r){if(r)return PCe(r)}function PCe(r){for(var s in ms.prototype)r[s]=ms.prototype[s];return r}ms.prototype.on=ms.prototype.addEventListener=function(r,s){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(s),this};ms.prototype.once=function(r,s){function a(){this.off(r,a),s.apply(this,arguments)}return a.fn=s,this.on(r,a),this};ms.prototype.off=ms.prototype.removeListener=ms.prototype.removeAllListeners=ms.prototype.removeEventListener=function(r,s){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var a=this._callbacks["$"+r];if(!a)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var c,h=0;h<a.length;h++)if(c=a[h],c===s||c.fn===s){a.splice(h,1);break}return a.length===0&&delete this._callbacks["$"+r],this};ms.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var s=new Array(arguments.length-1),a=this._callbacks["$"+r],c=1;c<arguments.length;c++)s[c-1]=arguments[c];if(a){a=a.slice(0);for(var c=0,h=a.length;c<h;++c)a[c].apply(this,s)}return this};ms.prototype.emitReserved=ms.prototype.emit;ms.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};ms.prototype.hasListeners=function(r){return!!this.listeners(r).length};const LS=typeof Promise=="function"&&typeof Promise.resolve=="function"?s=>Promise.resolve().then(s):(s,a)=>a(s,0),Qo=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),DCe="arraybuffer";function EY(r,...s){return s.reduce((a,c)=>(r.hasOwnProperty(c)&&(a[c]=r[c]),a),{})}const kCe=Qo.setTimeout,LCe=Qo.clearTimeout;function MS(r,s){s.useNativeTimers?(r.setTimeoutFn=kCe.bind(Qo),r.clearTimeoutFn=LCe.bind(Qo)):(r.setTimeoutFn=Qo.setTimeout.bind(Qo),r.clearTimeoutFn=Qo.clearTimeout.bind(Qo))}const MCe=1.33;function jCe(r){return typeof r=="string"?UCe(r):Math.ceil((r.byteLength||r.size)*MCe)}function UCe(r){let s=0,a=0;for(let c=0,h=r.length;c<h;c++)s=r.charCodeAt(c),s<128?a+=1:s<2048?a+=2:s<55296||s>=57344?a+=3:(c++,a+=4);return a}function vY(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function VCe(r){let s="";for(let a in r)r.hasOwnProperty(a)&&(s.length&&(s+="&"),s+=encodeURIComponent(a)+"="+encodeURIComponent(r[a]));return s}function FCe(r){let s={},a=r.split("&");for(let c=0,h=a.length;c<h;c++){let f=a[c].split("=");s[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}return s}class BCe extends Error{constructor(s,a,c){super(s),this.description=a,this.context=c,this.type="TransportError"}}class u2 extends ms{constructor(s){super(),this.writable=!1,MS(this,s),this.opts=s,this.query=s.query,this.socket=s.socket,this.supportsBinary=!s.forceBase64}onError(s,a,c){return super.emitReserved("error",new BCe(s,a,c)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(s){this.readyState==="open"&&this.write(s)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(s){const a=d2(s,this.socket.binaryType);this.onPacket(a)}onPacket(s){super.emitReserved("packet",s)}onClose(s){this.readyState="closed",super.emitReserved("close",s)}pause(s){}createUri(s,a={}){return s+"://"+this._hostname()+this._port()+this.opts.path+this._query(a)}_hostname(){const s=this.opts.hostname;return s.indexOf(":")===-1?s:"["+s+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(s){const a=VCe(s);return a.length?"?"+a:""}}class $Ce extends u2{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(s){this.readyState="pausing";const a=()=>{this.readyState="paused",s()};if(this._polling||!this.writable){let c=0;this._polling&&(c++,this.once("pollComplete",function(){--c||a()})),this.writable||(c++,this.once("drain",function(){--c||a()}))}else a()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(s){const a=c=>{if(this.readyState==="opening"&&c.type==="open"&&this.onOpen(),c.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(c)};ACe(s,this.socket.binaryType).forEach(a),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const s=()=>{this.write([{type:"close"}])};this.readyState==="open"?s():this.once("open",s)}write(s){this.writable=!1,NCe(s,a=>{this.doWrite(a,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const s=this.opts.secure?"https":"http",a=this.query||{};return this.opts.timestampRequests!==!1&&(a[this.opts.timestampParam]=vY()),!this.supportsBinary&&!a.sid&&(a.b64=1),this.createUri(s,a)}}let bY=!1;try{bY=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const WCe=bY;function GCe(){}class HCe extends $Ce{constructor(s){if(super(s),typeof location<"u"){const a=location.protocol==="https:";let c=location.port;c||(c=a?"443":"80"),this.xd=typeof location<"u"&&s.hostname!==location.hostname||c!==s.port}}doWrite(s,a){const c=this.request({method:"POST",data:s});c.on("success",a),c.on("error",(h,f)=>{this.onError("xhr post error",h,f)})}doPoll(){const s=this.request();s.on("data",this.onData.bind(this)),s.on("error",(a,c)=>{this.onError("xhr poll error",a,c)}),this.pollXhr=s}}class Dc extends ms{constructor(s,a,c){super(),this.createRequest=s,MS(this,c),this._opts=c,this._method=c.method||"GET",this._uri=a,this._data=c.data!==void 0?c.data:null,this._create()}_create(){var s;const a=EY(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");a.xdomain=!!this._opts.xd;const c=this._xhr=this.createRequest(a);try{c.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){c.setDisableHeaderCheck&&c.setDisableHeaderCheck(!0);for(let h in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(h)&&c.setRequestHeader(h,this._opts.extraHeaders[h])}}catch{}if(this._method==="POST")try{c.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{c.setRequestHeader("Accept","*/*")}catch{}(s=this._opts.cookieJar)===null||s===void 0||s.addCookies(c),"withCredentials"in c&&(c.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(c.timeout=this._opts.requestTimeout),c.onreadystatechange=()=>{var h;c.readyState===3&&((h=this._opts.cookieJar)===null||h===void 0||h.parseCookies(c.getResponseHeader("set-cookie"))),c.readyState===4&&(c.status===200||c.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof c.status=="number"?c.status:0)},0))},c.send(this._data)}catch(h){this.setTimeoutFn(()=>{this._onError(h)},0);return}typeof document<"u"&&(this._index=Dc.requestsCount++,Dc.requests[this._index]=this)}_onError(s){this.emitReserved("error",s,this._xhr),this._cleanup(!0)}_cleanup(s){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=GCe,s)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Dc.requests[this._index],this._xhr=null}}_onLoad(){const s=this._xhr.responseText;s!==null&&(this.emitReserved("data",s),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Dc.requestsCount=0;Dc.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",eG);else if(typeof addEventListener=="function"){const r="onpagehide"in Qo?"pagehide":"unload";addEventListener(r,eG,!1)}}function eG(){for(let r in Dc.requests)Dc.requests.hasOwnProperty(r)&&Dc.requests[r].abort()}const KCe=function(){const r=SY({xdomain:!1});return r&&r.responseType!==null}();class zCe extends HCe{constructor(s){super(s);const a=s&&s.forceBase64;this.supportsBinary=KCe&&!a}request(s={}){return Object.assign(s,{xd:this.xd},this.opts),new Dc(SY,this.uri(),s)}}function SY(r){const s=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!s||WCe))return new XMLHttpRequest}catch{}if(!s)try{return new Qo[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const xY=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class YCe extends u2{get name(){return"websocket"}doOpen(){const s=this.uri(),a=this.opts.protocols,c=xY?{}:EY(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(c.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(s,a,c)}catch(h){return this.emitReserved("error",h)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=s=>this.onClose({description:"websocket connection closed",context:s}),this.ws.onmessage=s=>this.onData(s.data),this.ws.onerror=s=>this.onError("websocket error",s)}write(s){this.writable=!1;for(let a=0;a<s.length;a++){const c=s[a],h=a===s.length-1;l2(c,this.supportsBinary,f=>{try{this.doWrite(c,f)}catch{}h&&LS(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const s=this.opts.secure?"wss":"ws",a=this.query||{};return this.opts.timestampRequests&&(a[this.opts.timestampParam]=vY()),this.supportsBinary||(a.b64=1),this.createUri(s,a)}}const d1=Qo.WebSocket||Qo.MozWebSocket;class qCe extends YCe{createSocket(s,a,c){return xY?new d1(s,a,c):a?new d1(s,a):new d1(s)}doWrite(s,a){this.ws.send(a)}}class XCe extends u2{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(s){return this.emitReserved("error",s)}this._transport.closed.then(()=>{this.onClose()}).catch(s=>{this.onError("webtransport error",s)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(s=>{const a=OCe(Number.MAX_SAFE_INTEGER,this.socket.binaryType),c=s.readable.pipeThrough(a).getReader(),h=ICe();h.readable.pipeTo(s.writable),this._writer=h.writable.getWriter();const f=()=>{c.read().then(({done:E,value:v})=>{E||(this.onPacket(v),f())}).catch(E=>{})};f();const _={type:"open"};this.query.sid&&(_.data=`{"sid":"${this.query.sid}"}`),this._writer.write(_).then(()=>this.onOpen())})})}write(s){this.writable=!1;for(let a=0;a<s.length;a++){const c=s[a],h=a===s.length-1;this._writer.write(c).then(()=>{h&&LS(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var s;(s=this._transport)===null||s===void 0||s.close()}}const JCe={websocket:qCe,webtransport:XCe,polling:zCe},QCe=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ZCe=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function JA(r){if(r.length>8e3)throw"URI too long";const s=r,a=r.indexOf("["),c=r.indexOf("]");a!=-1&&c!=-1&&(r=r.substring(0,a)+r.substring(a,c).replace(/:/g,";")+r.substring(c,r.length));let h=QCe.exec(r||""),f={},_=14;for(;_--;)f[ZCe[_]]=h[_]||"";return a!=-1&&c!=-1&&(f.source=s,f.host=f.host.substring(1,f.host.length-1).replace(/;/g,":"),f.authority=f.authority.replace("[","").replace("]","").replace(/;/g,":"),f.ipv6uri=!0),f.pathNames=eRe(f,f.path),f.queryKey=tRe(f,f.query),f}function eRe(r,s){const a=/\/{2,9}/g,c=s.replace(a,"/").split("/");return(s.slice(0,1)=="/"||s.length===0)&&c.splice(0,1),s.slice(-1)=="/"&&c.splice(c.length-1,1),c}function tRe(r,s){const a={};return s.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(c,h,f){h&&(a[h]=f)}),a}const QA=typeof addEventListener=="function"&&typeof removeEventListener=="function",ab=[];QA&&addEventListener("offline",()=>{ab.forEach(r=>r())},!1);class Cd extends ms{constructor(s,a){if(super(),this.binaryType=DCe,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,s&&typeof s=="object"&&(a=s,s=null),s){const c=JA(s);a.hostname=c.host,a.secure=c.protocol==="https"||c.protocol==="wss",a.port=c.port,c.query&&(a.query=c.query)}else a.host&&(a.hostname=JA(a.host).host);MS(this,a),this.secure=a.secure!=null?a.secure:typeof location<"u"&&location.protocol==="https:",a.hostname&&!a.port&&(a.port=this.secure?"443":"80"),this.hostname=a.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=a.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},a.transports.forEach(c=>{const h=c.prototype.name;this.transports.push(h),this._transportsByName[h]=c}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},a),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=FCe(this.opts.query)),QA&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ab.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(s){const a=Object.assign({},this.opts.query);a.EIO=yY,a.transport=s,this.id&&(a.sid=this.id);const c=Object.assign({},this.opts,{query:a,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[s]);return new this._transportsByName[s](c)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const s=this.opts.rememberUpgrade&&Cd.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const a=this.createTransport(s);a.open(),this.setTransport(a)}setTransport(s){this.transport&&this.transport.removeAllListeners(),this.transport=s,s.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",a=>this._onClose("transport close",a))}onOpen(){this.readyState="open",Cd.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(s){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",s),this.emitReserved("heartbeat"),s.type){case"open":this.onHandshake(JSON.parse(s.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const a=new Error("server error");a.code=s.data,this._onError(a);break;case"message":this.emitReserved("data",s.data),this.emitReserved("message",s.data);break}}onHandshake(s){this.emitReserved("handshake",s),this.id=s.sid,this.transport.query.sid=s.sid,this._pingInterval=s.pingInterval,this._pingTimeout=s.pingTimeout,this._maxPayload=s.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const s=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+s,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},s),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const s=this._getWritablePackets();this.transport.send(s),this._prevBufferLen=s.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let a=1;for(let c=0;c<this.writeBuffer.length;c++){const h=this.writeBuffer[c].data;if(h&&(a+=jCe(h)),c>0&&a>this._maxPayload)return this.writeBuffer.slice(0,c);a+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const s=Date.now()>this._pingTimeoutTime;return s&&(this._pingTimeoutTime=0,LS(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),s}write(s,a,c){return this._sendPacket("message",s,a,c),this}send(s,a,c){return this._sendPacket("message",s,a,c),this}_sendPacket(s,a,c,h){if(typeof a=="function"&&(h=a,a=void 0),typeof c=="function"&&(h=c,c=null),this.readyState==="closing"||this.readyState==="closed")return;c=c||{},c.compress=c.compress!==!1;const f={type:s,data:a,options:c};this.emitReserved("packetCreate",f),this.writeBuffer.push(f),h&&this.once("flush",h),this.flush()}close(){const s=()=>{this._onClose("forced close"),this.transport.close()},a=()=>{this.off("upgrade",a),this.off("upgradeError",a),s()},c=()=>{this.once("upgrade",a),this.once("upgradeError",a)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?c():s()}):this.upgrading?c():s()),this}_onError(s){if(Cd.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",s),this._onClose("transport error",s)}_onClose(s,a){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),QA&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const c=ab.indexOf(this._offlineEventListener);c!==-1&&ab.splice(c,1)}this.readyState="closed",this.id=null,this.emitReserved("close",s,a),this.writeBuffer=[],this._prevBufferLen=0}}}Cd.protocol=yY;class nRe extends Cd{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let s=0;s<this._upgrades.length;s++)this._probe(this._upgrades[s])}_probe(s){let a=this.createTransport(s),c=!1;Cd.priorWebsocketSuccess=!1;const h=()=>{c||(a.send([{type:"ping",data:"probe"}]),a.once("packet",R=>{if(!c)if(R.type==="pong"&&R.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",a),!a)return;Cd.priorWebsocketSuccess=a.name==="websocket",this.transport.pause(()=>{c||this.readyState!=="closed"&&(T(),this.setTransport(a),a.send([{type:"upgrade"}]),this.emitReserved("upgrade",a),a=null,this.upgrading=!1,this.flush())})}else{const N=new Error("probe error");N.transport=a.name,this.emitReserved("upgradeError",N)}}))};function f(){c||(c=!0,T(),a.close(),a=null)}const _=R=>{const N=new Error("probe error: "+R);N.transport=a.name,f(),this.emitReserved("upgradeError",N)};function E(){_("transport closed")}function v(){_("socket closed")}function x(R){a&&R.name!==a.name&&f()}const T=()=>{a.removeListener("open",h),a.removeListener("error",_),a.removeListener("close",E),this.off("close",v),this.off("upgrading",x)};a.once("open",h),a.once("error",_),a.once("close",E),this.once("close",v),this.once("upgrading",x),this._upgrades.indexOf("webtransport")!==-1&&s!=="webtransport"?this.setTimeoutFn(()=>{c||a.open()},200):a.open()}onHandshake(s){this._upgrades=this._filterUpgrades(s.upgrades),super.onHandshake(s)}_filterUpgrades(s){const a=[];for(let c=0;c<s.length;c++)~this.transports.indexOf(s[c])&&a.push(s[c]);return a}}let rRe=class extends nRe{constructor(s,a={}){const c=typeof s=="object"?s:a;(!c.transports||c.transports&&typeof c.transports[0]=="string")&&(c.transports=(c.transports||["polling","websocket","webtransport"]).map(h=>JCe[h]).filter(h=>!!h)),super(s,c)}};function sRe(r,s="",a){let c=r;a=a||typeof location<"u"&&location,r==null&&(r=a.protocol+"//"+a.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=a.protocol+r:r=a.host+r),/^(https?|wss?):\/\//.test(r)||(typeof a<"u"?r=a.protocol+"//"+r:r="https://"+r),c=JA(r)),c.port||(/^(http|ws)$/.test(c.protocol)?c.port="80":/^(http|ws)s$/.test(c.protocol)&&(c.port="443")),c.path=c.path||"/";const f=c.host.indexOf(":")!==-1?"["+c.host+"]":c.host;return c.id=c.protocol+"://"+f+":"+c.port+s,c.href=c.protocol+"://"+f+(a&&a.port===c.port?"":":"+c.port),c}const iRe=typeof ArrayBuffer=="function",oRe=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,wY=Object.prototype.toString,aRe=typeof Blob=="function"||typeof Blob<"u"&&wY.call(Blob)==="[object BlobConstructor]",cRe=typeof File=="function"||typeof File<"u"&&wY.call(File)==="[object FileConstructor]";function h2(r){return iRe&&(r instanceof ArrayBuffer||oRe(r))||aRe&&r instanceof Blob||cRe&&r instanceof File}function cb(r,s){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let a=0,c=r.length;a<c;a++)if(cb(r[a]))return!0;return!1}if(h2(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return cb(r.toJSON(),!0);for(const a in r)if(Object.prototype.hasOwnProperty.call(r,a)&&cb(r[a]))return!0;return!1}function lRe(r){const s=[],a=r.data,c=r;return c.data=ZA(a,s),c.attachments=s.length,{packet:c,buffers:s}}function ZA(r,s){if(!r)return r;if(h2(r)){const a={_placeholder:!0,num:s.length};return s.push(r),a}else if(Array.isArray(r)){const a=new Array(r.length);for(let c=0;c<r.length;c++)a[c]=ZA(r[c],s);return a}else if(typeof r=="object"&&!(r instanceof Date)){const a={};for(const c in r)Object.prototype.hasOwnProperty.call(r,c)&&(a[c]=ZA(r[c],s));return a}return r}function dRe(r,s){return r.data=eI(r.data,s),delete r.attachments,r}function eI(r,s){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<s.length)return s[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let a=0;a<r.length;a++)r[a]=eI(r[a],s);else if(typeof r=="object")for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&(r[a]=eI(r[a],s));return r}const uRe=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],hRe=5;var Dn;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(Dn||(Dn={}));class pRe{constructor(s){this.replacer=s}encode(s){return(s.type===Dn.EVENT||s.type===Dn.ACK)&&cb(s)?this.encodeAsBinary({type:s.type===Dn.EVENT?Dn.BINARY_EVENT:Dn.BINARY_ACK,nsp:s.nsp,data:s.data,id:s.id}):[this.encodeAsString(s)]}encodeAsString(s){let a=""+s.type;return(s.type===Dn.BINARY_EVENT||s.type===Dn.BINARY_ACK)&&(a+=s.attachments+"-"),s.nsp&&s.nsp!=="/"&&(a+=s.nsp+","),s.id!=null&&(a+=s.id),s.data!=null&&(a+=JSON.stringify(s.data,this.replacer)),a}encodeAsBinary(s){const a=lRe(s),c=this.encodeAsString(a.packet),h=a.buffers;return h.unshift(c),h}}function tG(r){return Object.prototype.toString.call(r)==="[object Object]"}class p2 extends ms{constructor(s){super(),this.reviver=s}add(s){let a;if(typeof s=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");a=this.decodeString(s);const c=a.type===Dn.BINARY_EVENT;c||a.type===Dn.BINARY_ACK?(a.type=c?Dn.EVENT:Dn.ACK,this.reconstructor=new mRe(a),a.attachments===0&&super.emitReserved("decoded",a)):super.emitReserved("decoded",a)}else if(h2(s)||s.base64)if(this.reconstructor)a=this.reconstructor.takeBinaryData(s),a&&(this.reconstructor=null,super.emitReserved("decoded",a));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+s)}decodeString(s){let a=0;const c={type:Number(s.charAt(0))};if(Dn[c.type]===void 0)throw new Error("unknown packet type "+c.type);if(c.type===Dn.BINARY_EVENT||c.type===Dn.BINARY_ACK){const f=a+1;for(;s.charAt(++a)!=="-"&&a!=s.length;);const _=s.substring(f,a);if(_!=Number(_)||s.charAt(a)!=="-")throw new Error("Illegal attachments");c.attachments=Number(_)}if(s.charAt(a+1)==="/"){const f=a+1;for(;++a&&!(s.charAt(a)===","||a===s.length););c.nsp=s.substring(f,a)}else c.nsp="/";const h=s.charAt(a+1);if(h!==""&&Number(h)==h){const f=a+1;for(;++a;){const _=s.charAt(a);if(_==null||Number(_)!=_){--a;break}if(a===s.length)break}c.id=Number(s.substring(f,a+1))}if(s.charAt(++a)){const f=this.tryParse(s.substr(a));if(p2.isPayloadValid(c.type,f))c.data=f;else throw new Error("invalid payload")}return c}tryParse(s){try{return JSON.parse(s,this.reviver)}catch{return!1}}static isPayloadValid(s,a){switch(s){case Dn.CONNECT:return tG(a);case Dn.DISCONNECT:return a===void 0;case Dn.CONNECT_ERROR:return typeof a=="string"||tG(a);case Dn.EVENT:case Dn.BINARY_EVENT:return Array.isArray(a)&&(typeof a[0]=="number"||typeof a[0]=="string"&&uRe.indexOf(a[0])===-1);case Dn.ACK:case Dn.BINARY_ACK:return Array.isArray(a)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class mRe{constructor(s){this.packet=s,this.buffers=[],this.reconPack=s}takeBinaryData(s){if(this.buffers.push(s),this.buffers.length===this.reconPack.attachments){const a=dRe(this.reconPack,this.buffers);return this.finishedReconstruction(),a}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const fRe=Object.freeze(Object.defineProperty({__proto__:null,Decoder:p2,Encoder:pRe,get PacketType(){return Dn},protocol:hRe},Symbol.toStringTag,{value:"Module"}));function Va(r,s,a){return r.on(s,a),function(){r.off(s,a)}}const gRe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class TY extends ms{constructor(s,a,c){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=s,this.nsp=a,c&&c.auth&&(this.auth=c.auth),this._opts=Object.assign({},c),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const s=this.io;this.subs=[Va(s,"open",this.onopen.bind(this)),Va(s,"packet",this.onpacket.bind(this)),Va(s,"error",this.onerror.bind(this)),Va(s,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...s){return s.unshift("message"),this.emit.apply(this,s),this}emit(s,...a){var c,h,f;if(gRe.hasOwnProperty(s))throw new Error('"'+s.toString()+'" is a reserved event name');if(a.unshift(s),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(a),this;const _={type:Dn.EVENT,data:a};if(_.options={},_.options.compress=this.flags.compress!==!1,typeof a[a.length-1]=="function"){const T=this.ids++,R=a.pop();this._registerAckCallback(T,R),_.id=T}const E=(h=(c=this.io.engine)===null||c===void 0?void 0:c.transport)===null||h===void 0?void 0:h.writable,v=this.connected&&!(!((f=this.io.engine)===null||f===void 0)&&f._hasPingExpired());return this.flags.volatile&&!E||(v?(this.notifyOutgoingListeners(_),this.packet(_)):this.sendBuffer.push(_)),this.flags={},this}_registerAckCallback(s,a){var c;const h=(c=this.flags.timeout)!==null&&c!==void 0?c:this._opts.ackTimeout;if(h===void 0){this.acks[s]=a;return}const f=this.io.setTimeoutFn(()=>{delete this.acks[s];for(let E=0;E<this.sendBuffer.length;E++)this.sendBuffer[E].id===s&&this.sendBuffer.splice(E,1);a.call(this,new Error("operation has timed out"))},h),_=(...E)=>{this.io.clearTimeoutFn(f),a.apply(this,E)};_.withError=!0,this.acks[s]=_}emitWithAck(s,...a){return new Promise((c,h)=>{const f=(_,E)=>_?h(_):c(E);f.withError=!0,a.push(f),this.emit(s,...a)})}_addToQueue(s){let a;typeof s[s.length-1]=="function"&&(a=s.pop());const c={id:this._queueSeq++,tryCount:0,pending:!1,args:s,flags:Object.assign({fromQueue:!0},this.flags)};s.push((h,...f)=>c!==this._queue[0]?void 0:(h!==null?c.tryCount>this._opts.retries&&(this._queue.shift(),a&&a(h)):(this._queue.shift(),a&&a(null,...f)),c.pending=!1,this._drainQueue())),this._queue.push(c),this._drainQueue()}_drainQueue(s=!1){if(!this.connected||this._queue.length===0)return;const a=this._queue[0];a.pending&&!s||(a.pending=!0,a.tryCount++,this.flags=a.flags,this.emit.apply(this,a.args))}packet(s){s.nsp=this.nsp,this.io._packet(s)}onopen(){typeof this.auth=="function"?this.auth(s=>{this._sendConnectPacket(s)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(s){this.packet({type:Dn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},s):s})}onerror(s){this.connected||this.emitReserved("connect_error",s)}onclose(s,a){this.connected=!1,delete this.id,this.emitReserved("disconnect",s,a),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(s=>{if(!this.sendBuffer.some(c=>String(c.id)===s)){const c=this.acks[s];delete this.acks[s],c.withError&&c.call(this,new Error("socket has been disconnected"))}})}onpacket(s){if(s.nsp===this.nsp)switch(s.type){case Dn.CONNECT:s.data&&s.data.sid?this.onconnect(s.data.sid,s.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Dn.EVENT:case Dn.BINARY_EVENT:this.onevent(s);break;case Dn.ACK:case Dn.BINARY_ACK:this.onack(s);break;case Dn.DISCONNECT:this.ondisconnect();break;case Dn.CONNECT_ERROR:this.destroy();const c=new Error(s.data.message);c.data=s.data.data,this.emitReserved("connect_error",c);break}}onevent(s){const a=s.data||[];s.id!=null&&a.push(this.ack(s.id)),this.connected?this.emitEvent(a):this.receiveBuffer.push(Object.freeze(a))}emitEvent(s){if(this._anyListeners&&this._anyListeners.length){const a=this._anyListeners.slice();for(const c of a)c.apply(this,s)}super.emit.apply(this,s),this._pid&&s.length&&typeof s[s.length-1]=="string"&&(this._lastOffset=s[s.length-1])}ack(s){const a=this;let c=!1;return function(...h){c||(c=!0,a.packet({type:Dn.ACK,id:s,data:h}))}}onack(s){const a=this.acks[s.id];typeof a=="function"&&(delete this.acks[s.id],a.withError&&s.data.unshift(null),a.apply(this,s.data))}onconnect(s,a){this.id=s,this.recovered=a&&this._pid===a,this._pid=a,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(s=>this.emitEvent(s)),this.receiveBuffer=[],this.sendBuffer.forEach(s=>{this.notifyOutgoingListeners(s),this.packet(s)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(s=>s()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Dn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(s){return this.flags.compress=s,this}get volatile(){return this.flags.volatile=!0,this}timeout(s){return this.flags.timeout=s,this}onAny(s){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(s),this}prependAny(s){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(s),this}offAny(s){if(!this._anyListeners)return this;if(s){const a=this._anyListeners;for(let c=0;c<a.length;c++)if(s===a[c])return a.splice(c,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(s){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(s),this}prependAnyOutgoing(s){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(s),this}offAnyOutgoing(s){if(!this._anyOutgoingListeners)return this;if(s){const a=this._anyOutgoingListeners;for(let c=0;c<a.length;c++)if(s===a[c])return a.splice(c,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(s){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const a=this._anyOutgoingListeners.slice();for(const c of a)c.apply(this,s.data)}}}function Jm(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Jm.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var s=Math.random(),a=Math.floor(s*this.jitter*r);r=Math.floor(s*10)&1?r+a:r-a}return Math.min(r,this.max)|0};Jm.prototype.reset=function(){this.attempts=0};Jm.prototype.setMin=function(r){this.ms=r};Jm.prototype.setMax=function(r){this.max=r};Jm.prototype.setJitter=function(r){this.jitter=r};class tI extends ms{constructor(s,a){var c;super(),this.nsps={},this.subs=[],s&&typeof s=="object"&&(a=s,s=void 0),a=a||{},a.path=a.path||"/socket.io",this.opts=a,MS(this,a),this.reconnection(a.reconnection!==!1),this.reconnectionAttempts(a.reconnectionAttempts||1/0),this.reconnectionDelay(a.reconnectionDelay||1e3),this.reconnectionDelayMax(a.reconnectionDelayMax||5e3),this.randomizationFactor((c=a.randomizationFactor)!==null&&c!==void 0?c:.5),this.backoff=new Jm({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(a.timeout==null?2e4:a.timeout),this._readyState="closed",this.uri=s;const h=a.parser||fRe;this.encoder=new h.Encoder,this.decoder=new h.Decoder,this._autoConnect=a.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(s){return arguments.length?(this._reconnection=!!s,s||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(s){return s===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=s,this)}reconnectionDelay(s){var a;return s===void 0?this._reconnectionDelay:(this._reconnectionDelay=s,(a=this.backoff)===null||a===void 0||a.setMin(s),this)}randomizationFactor(s){var a;return s===void 0?this._randomizationFactor:(this._randomizationFactor=s,(a=this.backoff)===null||a===void 0||a.setJitter(s),this)}reconnectionDelayMax(s){var a;return s===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=s,(a=this.backoff)===null||a===void 0||a.setMax(s),this)}timeout(s){return arguments.length?(this._timeout=s,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(s){if(~this._readyState.indexOf("open"))return this;this.engine=new rRe(this.uri,this.opts);const a=this.engine,c=this;this._readyState="opening",this.skipReconnect=!1;const h=Va(a,"open",function(){c.onopen(),s&&s()}),f=E=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",E),s?s(E):this.maybeReconnectOnOpen()},_=Va(a,"error",f);if(this._timeout!==!1){const E=this._timeout,v=this.setTimeoutFn(()=>{h(),f(new Error("timeout")),a.close()},E);this.opts.autoUnref&&v.unref(),this.subs.push(()=>{this.clearTimeoutFn(v)})}return this.subs.push(h),this.subs.push(_),this}connect(s){return this.open(s)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const s=this.engine;this.subs.push(Va(s,"ping",this.onping.bind(this)),Va(s,"data",this.ondata.bind(this)),Va(s,"error",this.onerror.bind(this)),Va(s,"close",this.onclose.bind(this)),Va(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(s){try{this.decoder.add(s)}catch(a){this.onclose("parse error",a)}}ondecoded(s){LS(()=>{this.emitReserved("packet",s)},this.setTimeoutFn)}onerror(s){this.emitReserved("error",s)}socket(s,a){let c=this.nsps[s];return c?this._autoConnect&&!c.active&&c.connect():(c=new TY(this,s,a),this.nsps[s]=c),c}_destroy(s){const a=Object.keys(this.nsps);for(const c of a)if(this.nsps[c].active)return;this._close()}_packet(s){const a=this.encoder.encode(s);for(let c=0;c<a.length;c++)this.engine.write(a[c],s.options)}cleanup(){this.subs.forEach(s=>s()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(s,a){var c;this.cleanup(),(c=this.engine)===null||c===void 0||c.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",s,a),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const s=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const a=this.backoff.duration();this._reconnecting=!0;const c=this.setTimeoutFn(()=>{s.skipReconnect||(this.emitReserved("reconnect_attempt",s.backoff.attempts),!s.skipReconnect&&s.open(h=>{h?(s._reconnecting=!1,s.reconnect(),this.emitReserved("reconnect_error",h)):s.onreconnect()}))},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}}onreconnect(){const s=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",s)}}const Ug={};function h0(r,s){typeof r=="object"&&(s=r,r=void 0),s=s||{};const a=sRe(r,s.path||"/socket.io"),c=a.source,h=a.id,f=a.path,_=Ug[h]&&f in Ug[h].nsps,E=s.forceNew||s["force new connection"]||s.multiplex===!1||_;let v;return E?v=new tI(c,s):(Ug[h]||(Ug[h]=new tI(c,s)),v=Ug[h]),a.query&&!s.query&&(s.query=a.queryKey),v.socket(a.path,s)}Object.assign(h0,{Manager:tI,Socket:TY,io:h0,connect:h0});var _Re=V.createContext(void 0);function yRe(r){const s=V.useContext(_Re);return r||s||"ltr"}function ERe(r,[s,a]){return Math.min(a,Math.max(s,r))}function vRe(r,s){return V.useReducer((a,c)=>s[a][c]??a,r)}var m2="ScrollArea",[CY,z1e]=n_(m2),[bRe,sa]=CY(m2),RY=V.forwardRef((r,s)=>{const{__scopeScrollArea:a,type:c="hover",dir:h,scrollHideDelay:f=600,..._}=r,[E,v]=V.useState(null),[x,T]=V.useState(null),[R,N]=V.useState(null),[L,j]=V.useState(null),[F,P]=V.useState(null),[M,U]=V.useState(0),[B,K]=V.useState(0),[J,te]=V.useState(!1),[se,ie]=V.useState(!1),ue=qs(s,Ne=>v(Ne)),de=yRe(h);return d.jsx(bRe,{scope:a,type:c,dir:de,scrollHideDelay:f,scrollArea:E,viewport:x,onViewportChange:T,content:R,onContentChange:N,scrollbarX:L,onScrollbarXChange:j,scrollbarXEnabled:J,onScrollbarXEnabledChange:te,scrollbarY:F,onScrollbarYChange:P,scrollbarYEnabled:se,onScrollbarYEnabledChange:ie,onCornerWidthChange:U,onCornerHeightChange:K,children:d.jsx(Ss.div,{dir:de,..._,ref:ue,style:{position:"relative","--radix-scroll-area-corner-width":M+"px","--radix-scroll-area-corner-height":B+"px",...r.style}})})});RY.displayName=m2;var NY="ScrollAreaViewport",AY=V.forwardRef((r,s)=>{const{__scopeScrollArea:a,children:c,nonce:h,...f}=r,_=sa(NY,a),E=V.useRef(null),v=qs(s,E,_.onViewportChange);return d.jsxs(d.Fragment,{children:[d.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:h}),d.jsx(Ss.div,{"data-radix-scroll-area-viewport":"",...f,ref:v,style:{overflowX:_.scrollbarXEnabled?"scroll":"hidden",overflowY:_.scrollbarYEnabled?"scroll":"hidden",...r.style},children:d.jsx("div",{ref:_.onContentChange,style:{minWidth:"100%",display:"table"},children:c})})]})});AY.displayName=NY;var jc="ScrollAreaScrollbar",f2=V.forwardRef((r,s)=>{const{forceMount:a,...c}=r,h=sa(jc,r.__scopeScrollArea),{onScrollbarXEnabledChange:f,onScrollbarYEnabledChange:_}=h,E=r.orientation==="horizontal";return V.useEffect(()=>(E?f(!0):_(!0),()=>{E?f(!1):_(!1)}),[E,f,_]),h.type==="hover"?d.jsx(SRe,{...c,ref:s,forceMount:a}):h.type==="scroll"?d.jsx(xRe,{...c,ref:s,forceMount:a}):h.type==="auto"?d.jsx(IY,{...c,ref:s,forceMount:a}):h.type==="always"?d.jsx(g2,{...c,ref:s}):null});f2.displayName=jc;var SRe=V.forwardRef((r,s)=>{const{forceMount:a,...c}=r,h=sa(jc,r.__scopeScrollArea),[f,_]=V.useState(!1);return V.useEffect(()=>{const E=h.scrollArea;let v=0;if(E){const x=()=>{window.clearTimeout(v),_(!0)},T=()=>{v=window.setTimeout(()=>_(!1),h.scrollHideDelay)};return E.addEventListener("pointerenter",x),E.addEventListener("pointerleave",T),()=>{window.clearTimeout(v),E.removeEventListener("pointerenter",x),E.removeEventListener("pointerleave",T)}}},[h.scrollArea,h.scrollHideDelay]),d.jsx(mh,{present:a||f,children:d.jsx(IY,{"data-state":f?"visible":"hidden",...c,ref:s})})}),xRe=V.forwardRef((r,s)=>{const{forceMount:a,...c}=r,h=sa(jc,r.__scopeScrollArea),f=r.orientation==="horizontal",_=US(()=>v("SCROLL_END"),100),[E,v]=vRe("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return V.useEffect(()=>{if(E==="idle"){const x=window.setTimeout(()=>v("HIDE"),h.scrollHideDelay);return()=>window.clearTimeout(x)}},[E,h.scrollHideDelay,v]),V.useEffect(()=>{const x=h.viewport,T=f?"scrollLeft":"scrollTop";if(x){let R=x[T];const N=()=>{const L=x[T];R!==L&&(v("SCROLL"),_()),R=L};return x.addEventListener("scroll",N),()=>x.removeEventListener("scroll",N)}},[h.viewport,f,v,_]),d.jsx(mh,{present:a||E!=="hidden",children:d.jsx(g2,{"data-state":E==="hidden"?"hidden":"visible",...c,ref:s,onPointerEnter:fr(r.onPointerEnter,()=>v("POINTER_ENTER")),onPointerLeave:fr(r.onPointerLeave,()=>v("POINTER_LEAVE"))})})}),IY=V.forwardRef((r,s)=>{const a=sa(jc,r.__scopeScrollArea),{forceMount:c,...h}=r,[f,_]=V.useState(!1),E=r.orientation==="horizontal",v=US(()=>{if(a.viewport){const x=a.viewport.offsetWidth<a.viewport.scrollWidth,T=a.viewport.offsetHeight<a.viewport.scrollHeight;_(E?x:T)}},10);return Vm(a.viewport,v),Vm(a.content,v),d.jsx(mh,{present:c||f,children:d.jsx(g2,{"data-state":f?"visible":"hidden",...h,ref:s})})}),g2=V.forwardRef((r,s)=>{const{orientation:a="vertical",...c}=r,h=sa(jc,r.__scopeScrollArea),f=V.useRef(null),_=V.useRef(0),[E,v]=V.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),x=LY(E.viewport,E.content),T={...c,sizes:E,onSizesChange:v,hasThumb:x>0&&x<1,onThumbChange:N=>f.current=N,onThumbPointerUp:()=>_.current=0,onThumbPointerDown:N=>_.current=N};function R(N,L){return ARe(N,_.current,E,L)}return a==="horizontal"?d.jsx(wRe,{...T,ref:s,onThumbPositionChange:()=>{if(h.viewport&&f.current){const N=h.viewport.scrollLeft,L=nG(N,E,h.dir);f.current.style.transform=`translate3d(${L}px, 0, 0)`}},onWheelScroll:N=>{h.viewport&&(h.viewport.scrollLeft=N)},onDragScroll:N=>{h.viewport&&(h.viewport.scrollLeft=R(N,h.dir))}}):a==="vertical"?d.jsx(TRe,{...T,ref:s,onThumbPositionChange:()=>{if(h.viewport&&f.current){const N=h.viewport.scrollTop,L=nG(N,E);f.current.style.transform=`translate3d(0, ${L}px, 0)`}},onWheelScroll:N=>{h.viewport&&(h.viewport.scrollTop=N)},onDragScroll:N=>{h.viewport&&(h.viewport.scrollTop=R(N))}}):null}),wRe=V.forwardRef((r,s)=>{const{sizes:a,onSizesChange:c,...h}=r,f=sa(jc,r.__scopeScrollArea),[_,E]=V.useState(),v=V.useRef(null),x=qs(s,v,f.onScrollbarXChange);return V.useEffect(()=>{v.current&&E(getComputedStyle(v.current))},[v]),d.jsx(PY,{"data-orientation":"horizontal",...h,ref:x,sizes:a,style:{bottom:0,left:f.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:f.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":jS(a)+"px",...r.style},onThumbPointerDown:T=>r.onThumbPointerDown(T.x),onDragScroll:T=>r.onDragScroll(T.x),onWheelScroll:(T,R)=>{if(f.viewport){const N=f.viewport.scrollLeft+T.deltaX;r.onWheelScroll(N),jY(N,R)&&T.preventDefault()}},onResize:()=>{v.current&&f.viewport&&_&&c({content:f.viewport.scrollWidth,viewport:f.viewport.offsetWidth,scrollbar:{size:v.current.clientWidth,paddingStart:Zb(_.paddingLeft),paddingEnd:Zb(_.paddingRight)}})}})}),TRe=V.forwardRef((r,s)=>{const{sizes:a,onSizesChange:c,...h}=r,f=sa(jc,r.__scopeScrollArea),[_,E]=V.useState(),v=V.useRef(null),x=qs(s,v,f.onScrollbarYChange);return V.useEffect(()=>{v.current&&E(getComputedStyle(v.current))},[v]),d.jsx(PY,{"data-orientation":"vertical",...h,ref:x,sizes:a,style:{top:0,right:f.dir==="ltr"?0:void 0,left:f.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":jS(a)+"px",...r.style},onThumbPointerDown:T=>r.onThumbPointerDown(T.y),onDragScroll:T=>r.onDragScroll(T.y),onWheelScroll:(T,R)=>{if(f.viewport){const N=f.viewport.scrollTop+T.deltaY;r.onWheelScroll(N),jY(N,R)&&T.preventDefault()}},onResize:()=>{v.current&&f.viewport&&_&&c({content:f.viewport.scrollHeight,viewport:f.viewport.offsetHeight,scrollbar:{size:v.current.clientHeight,paddingStart:Zb(_.paddingTop),paddingEnd:Zb(_.paddingBottom)}})}})}),[CRe,OY]=CY(jc),PY=V.forwardRef((r,s)=>{const{__scopeScrollArea:a,sizes:c,hasThumb:h,onThumbChange:f,onThumbPointerUp:_,onThumbPointerDown:E,onThumbPositionChange:v,onDragScroll:x,onWheelScroll:T,onResize:R,...N}=r,L=sa(jc,a),[j,F]=V.useState(null),P=qs(s,ue=>F(ue)),M=V.useRef(null),U=V.useRef(""),B=L.viewport,K=c.content-c.viewport,J=wi(T),te=wi(v),se=US(R,10);function ie(ue){if(M.current){const de=ue.clientX-M.current.left,Ne=ue.clientY-M.current.top;x({x:de,y:Ne})}}return V.useEffect(()=>{const ue=de=>{const Ne=de.target;(j==null?void 0:j.contains(Ne))&&J(de,K)};return document.addEventListener("wheel",ue,{passive:!1}),()=>document.removeEventListener("wheel",ue,{passive:!1})},[B,j,K,J]),V.useEffect(te,[c,te]),Vm(j,se),Vm(L.content,se),d.jsx(CRe,{scope:a,scrollbar:j,hasThumb:h,onThumbChange:wi(f),onThumbPointerUp:wi(_),onThumbPositionChange:te,onThumbPointerDown:wi(E),children:d.jsx(Ss.div,{...N,ref:P,style:{position:"absolute",...N.style},onPointerDown:fr(r.onPointerDown,ue=>{ue.button===0&&(ue.target.setPointerCapture(ue.pointerId),M.current=j.getBoundingClientRect(),U.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",L.viewport&&(L.viewport.style.scrollBehavior="auto"),ie(ue))}),onPointerMove:fr(r.onPointerMove,ie),onPointerUp:fr(r.onPointerUp,ue=>{const de=ue.target;de.hasPointerCapture(ue.pointerId)&&de.releasePointerCapture(ue.pointerId),document.body.style.webkitUserSelect=U.current,L.viewport&&(L.viewport.style.scrollBehavior=""),M.current=null})})})}),Qb="ScrollAreaThumb",DY=V.forwardRef((r,s)=>{const{forceMount:a,...c}=r,h=OY(Qb,r.__scopeScrollArea);return d.jsx(mh,{present:a||h.hasThumb,children:d.jsx(RRe,{ref:s,...c})})}),RRe=V.forwardRef((r,s)=>{const{__scopeScrollArea:a,style:c,...h}=r,f=sa(Qb,a),_=OY(Qb,a),{onThumbPositionChange:E}=_,v=qs(s,R=>_.onThumbChange(R)),x=V.useRef(void 0),T=US(()=>{x.current&&(x.current(),x.current=void 0)},100);return V.useEffect(()=>{const R=f.viewport;if(R){const N=()=>{if(T(),!x.current){const L=IRe(R,E);x.current=L,E()}};return E(),R.addEventListener("scroll",N),()=>R.removeEventListener("scroll",N)}},[f.viewport,T,E]),d.jsx(Ss.div,{"data-state":_.hasThumb?"visible":"hidden",...h,ref:v,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...c},onPointerDownCapture:fr(r.onPointerDownCapture,R=>{const L=R.target.getBoundingClientRect(),j=R.clientX-L.left,F=R.clientY-L.top;_.onThumbPointerDown({x:j,y:F})}),onPointerUp:fr(r.onPointerUp,_.onThumbPointerUp)})});DY.displayName=Qb;var _2="ScrollAreaCorner",kY=V.forwardRef((r,s)=>{const a=sa(_2,r.__scopeScrollArea),c=!!(a.scrollbarX&&a.scrollbarY);return a.type!=="scroll"&&c?d.jsx(NRe,{...r,ref:s}):null});kY.displayName=_2;var NRe=V.forwardRef((r,s)=>{const{__scopeScrollArea:a,...c}=r,h=sa(_2,a),[f,_]=V.useState(0),[E,v]=V.useState(0),x=!!(f&&E);return Vm(h.scrollbarX,()=>{var R;const T=((R=h.scrollbarX)==null?void 0:R.offsetHeight)||0;h.onCornerHeightChange(T),v(T)}),Vm(h.scrollbarY,()=>{var R;const T=((R=h.scrollbarY)==null?void 0:R.offsetWidth)||0;h.onCornerWidthChange(T),_(T)}),x?d.jsx(Ss.div,{...c,ref:s,style:{width:f,height:E,position:"absolute",right:h.dir==="ltr"?0:void 0,left:h.dir==="rtl"?0:void 0,bottom:0,...r.style}}):null});function Zb(r){return r?parseInt(r,10):0}function LY(r,s){const a=r/s;return isNaN(a)?0:a}function jS(r){const s=LY(r.viewport,r.content),a=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,c=(r.scrollbar.size-a)*s;return Math.max(c,18)}function ARe(r,s,a,c="ltr"){const h=jS(a),f=h/2,_=s||f,E=h-_,v=a.scrollbar.paddingStart+_,x=a.scrollbar.size-a.scrollbar.paddingEnd-E,T=a.content-a.viewport,R=c==="ltr"?[0,T]:[T*-1,0];return MY([v,x],R)(r)}function nG(r,s,a="ltr"){const c=jS(s),h=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,f=s.scrollbar.size-h,_=s.content-s.viewport,E=f-c,v=a==="ltr"?[0,_]:[_*-1,0],x=ERe(r,v);return MY([0,_],[0,E])(x)}function MY(r,s){return a=>{if(r[0]===r[1]||s[0]===s[1])return s[0];const c=(s[1]-s[0])/(r[1]-r[0]);return s[0]+c*(a-r[0])}}function jY(r,s){return r>0&&r<s}var IRe=(r,s=()=>{})=>{let a={left:r.scrollLeft,top:r.scrollTop},c=0;return function h(){const f={left:r.scrollLeft,top:r.scrollTop},_=a.left!==f.left,E=a.top!==f.top;(_||E)&&s(),a=f,c=window.requestAnimationFrame(h)}(),()=>window.cancelAnimationFrame(c)};function US(r,s){const a=wi(r),c=V.useRef(0);return V.useEffect(()=>()=>window.clearTimeout(c.current),[]),V.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(a,s)},[a,s])}function Vm(r,s){const a=wi(s);hl(()=>{let c=0;if(r){const h=new ResizeObserver(()=>{cancelAnimationFrame(c),c=window.requestAnimationFrame(a)});return h.observe(r),()=>{window.cancelAnimationFrame(c),h.unobserve(r)}}},[r,a])}var UY=RY,ORe=AY,PRe=kY;const VY=V.forwardRef(({className:r,children:s,...a},c)=>d.jsxs(UY,{ref:c,className:Xs("relative overflow-hidden",r),...a,children:[d.jsx(ORe,{className:"h-full w-full rounded-[inherit]",children:s}),d.jsx(FY,{}),d.jsx(PRe,{})]}));VY.displayName=UY.displayName;const FY=V.forwardRef(({className:r,orientation:s="vertical",...a},c)=>d.jsx(f2,{ref:c,orientation:s,className:Xs("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...a,children:d.jsx(DY,{className:"relative flex-1 rounded-full bg-border"})}));FY.displayName=f2.displayName;const DRe=[{title:"Workspace",items:[{id:"status",label:"Status",icon:Pge},{id:"chats",label:"Chats",icon:pl},{id:"calls",label:"Calls",icon:oO},{id:"contacts",label:"Contacts",icon:kge},{id:"live-stream",label:"Live Stream",icon:Jge},{id:"histories",label:"Histories",icon:_H}]},{title:"Smart Tools",items:[{id:"action-board",label:"Action Board",icon:Q8},{id:"thread-doc",label:"Thread  Doc Studio",icon:al},{id:"summaries",label:"Smart Summaries",icon:aO},{id:"automations",label:"Workflow Automations",icon:o0e},{id:"command-center",label:"Command Center",icon:ch}]},{title:"Trust & Safety",items:[{id:"dignity-mode",label:"IRU Dignity Mode",icon:dH},{id:"consent-controls",label:"Consent Controls",icon:Hge},{id:"verification",label:"Identity & Verification",icon:Tge},{id:"moderation",label:"Reports & Moderation",icon:km},{id:"privacy-center",label:"Privacy Center",icon:lA}]},{title:"Creator Tools",items:[{id:"live-studio",label:"Live Studio",icon:pH},{id:"communities",label:"Community Builder",icon:vH},{id:"monetization",label:"Monetization",icon:ES},{id:"content-library",label:"Content Library",icon:Uge},{id:"creator-analytics",label:"Creator Analytics",icon:Q8}]},{title:"Preferences",items:[{id:"settings",label:"Settings",icon:ch}]},{title:"Enterprise",items:[{id:"enterprise-tools",label:"Enterprise Tools",icon:hH}]},{title:"Growth",items:[{id:"advertise",label:"Advertise / Marketing",icon:zge}]}],kRe=({activeNav:r,onNavChange:s,isOnline:a=!0})=>{const{theme:c,setTheme:h}=sr(),f=c==="dark",_=f?"bg-[#0a1628]":"bg-white",E=f?"border-[#1e3a5f]":"border-gray-200",v=f?"text-white":"text-gray-900",x=f?"text-slate-400":"text-gray-500",T=f?"text-slate-500":"text-gray-500",R=f?"text-slate-300":"text-gray-700",N=f?"hover:bg-white/5":"hover:bg-gray-100",L=f?"hover:text-white":"hover:text-gray-900",j=f?"bg-gradient-to-r from-cyan-500/20 to-blue-500/20":"bg-gradient-to-r from-blue-500/10 to-cyan-500/10",F=f?"text-cyan-400":"text-blue-600",P=f?"border-cyan-400":"border-blue-500",M=f?"border-[#1e3a5f]":"border-gray-200",U=f?"text-slate-500":"text-gray-500",B=f?"bg-white/10":"bg-gray-100",K=f?"text-slate-300":"text-gray-700",J=f?"hover:bg-white/10":"hover:bg-gray-100",te=f?"text-slate-400 hover:text-white":"text-gray-500 hover:text-gray-900";return d.jsxs("aside",{className:`w-60 flex-shrink-0 flex flex-col h-full ${_} border-r ${E}`,children:[d.jsx("div",{className:`p-4 border-b ${E}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-10 h-10 rounded-xl overflow-hidden flex items-center justify-center flex-shrink-0 transition-all duration-300 ease-out transform hover:scale-110",children:d.jsx("img",{src:wO,alt:"IRU Chat Logo",className:"w-full h-full object-contain"})}),d.jsxs("div",{children:[d.jsx("h1",{className:`font-semibold text-base ${v}`,children:"IRU Chat"}),d.jsx("small",{className:`text-xs ${x}`,children:"/chat  UI skeleton"})]})]})}),d.jsx(VY,{className:"flex-1 overflow-y-auto",children:d.jsx("nav",{className:"p-2","aria-label":"Sidebar",children:DRe.map(se=>d.jsxs("div",{className:"mb-3",children:[d.jsx("div",{className:`px-3 py-2 text-[10px] font-semibold uppercase tracking-wider ${T}`,children:se.title}),se.items.map(ie=>{const ue=ie.icon,de=r===ie.id;return d.jsxs("button",{onClick:()=>s(ie.id),className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm transition-all duration-300 ease-out transform hover:scale-[1.02] active:scale-[0.98] ${de?`${j} ${F} border-l-2 ${P}`:`${R} ${N} ${L}`}`,children:[d.jsx(ue,{className:`w-4 h-4 ${de?F:""}`}),d.jsx("span",{className:"truncate",children:ie.label})]},ie.id)})]},se.title))})}),d.jsxs("div",{className:`p-4 border-t ${M}`,children:[d.jsxs("div",{className:"flex items-center justify-between mb-3",children:[d.jsx("div",{className:"flex items-center gap-2",children:d.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${a?f?"bg-emerald-500/20 text-emerald-400":"bg-emerald-100 text-emerald-700":f?"bg-slate-500/20 text-slate-400":"bg-gray-100 text-gray-500"}`,children:[d.jsx("span",{className:`w-2 h-2 rounded-full ${a?f?"bg-emerald-400":"bg-emerald-500":f?"bg-slate-500":"bg-gray-400"} ${a?"animate-pulse":""}`}),a?"Online":"Offline"]})}),d.jsx("button",{onClick:()=>h(f?"light":"dark"),className:`p-2 rounded-lg transition-colors ${J} ${te}`,title:"Toggle theme",children:f?d.jsx(e0e,{className:"w-4 h-4"}):d.jsx(qge,{className:"w-4 h-4"})})]}),d.jsxs("div",{className:`text-[11px] ${U}`,children:["Tip: ",d.jsx("kbd",{className:`px-1.5 py-0.5 rounded ${B} ${K}`,children:"Ctrl"})," + ",d.jsx("kbd",{className:`px-1.5 py-0.5 rounded ${B} ${K}`,children:"K"})," for quick search (wireframe)."]})]})]})};function Ya(r){const s=Object.prototype.toString.call(r);return r instanceof Date||typeof r=="object"&&s==="[object Date]"?new r.constructor(+r):typeof r=="number"||s==="[object Number]"||typeof r=="string"||s==="[object String]"?new Date(r):new Date(NaN)}function uh(r,s){return r instanceof Date?new r.constructor(s):new Date(s)}const BY=6048e5,LRe=864e5;let MRe={};function VS(){return MRe}function z0(r,s){var E,v,x,T;const a=VS(),c=(s==null?void 0:s.weekStartsOn)??((v=(E=s==null?void 0:s.locale)==null?void 0:E.options)==null?void 0:v.weekStartsOn)??a.weekStartsOn??((T=(x=a.locale)==null?void 0:x.options)==null?void 0:T.weekStartsOn)??0,h=Ya(r),f=h.getDay(),_=(f<c?7:0)+f-c;return h.setDate(h.getDate()-_),h.setHours(0,0,0,0),h}function eS(r){return z0(r,{weekStartsOn:1})}function $Y(r){const s=Ya(r),a=s.getFullYear(),c=uh(r,0);c.setFullYear(a+1,0,4),c.setHours(0,0,0,0);const h=eS(c),f=uh(r,0);f.setFullYear(a,0,4),f.setHours(0,0,0,0);const _=eS(f);return s.getTime()>=h.getTime()?a+1:s.getTime()>=_.getTime()?a:a-1}function rG(r){const s=Ya(r);return s.setHours(0,0,0,0),s}function sG(r){const s=Ya(r),a=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return a.setUTCFullYear(s.getFullYear()),+r-+a}function jRe(r,s){const a=rG(r),c=rG(s),h=+a-sG(a),f=+c-sG(c);return Math.round((h-f)/LRe)}function URe(r){const s=$Y(r),a=uh(r,0);return a.setFullYear(s,0,4),a.setHours(0,0,0,0),eS(a)}function VRe(r){return r instanceof Date||typeof r=="object"&&Object.prototype.toString.call(r)==="[object Date]"}function FRe(r){if(!VRe(r)&&typeof r!="number")return!1;const s=Ya(r);return!isNaN(Number(s))}function BRe(r){const s=Ya(r),a=uh(r,0);return a.setFullYear(s.getFullYear(),0,1),a.setHours(0,0,0,0),a}const $Re={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},WRe=(r,s,a)=>{let c;const h=$Re[r];return typeof h=="string"?c=h:s===1?c=h.one:c=h.other.replace("{{count}}",s.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+c:c+" ago":c};function u1(r){return(s={})=>{const a=s.width?String(s.width):r.defaultWidth;return r.formats[a]||r.formats[r.defaultWidth]}}const GRe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},HRe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},KRe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},zRe={date:u1({formats:GRe,defaultWidth:"full"}),time:u1({formats:HRe,defaultWidth:"full"}),dateTime:u1({formats:KRe,defaultWidth:"full"})},YRe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},qRe=(r,s,a,c)=>YRe[r];function Vg(r){return(s,a)=>{const c=a!=null&&a.context?String(a.context):"standalone";let h;if(c==="formatting"&&r.formattingValues){const _=r.defaultFormattingWidth||r.defaultWidth,E=a!=null&&a.width?String(a.width):_;h=r.formattingValues[E]||r.formattingValues[_]}else{const _=r.defaultWidth,E=a!=null&&a.width?String(a.width):r.defaultWidth;h=r.values[E]||r.values[_]}const f=r.argumentCallback?r.argumentCallback(s):s;return h[f]}}const XRe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},JRe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},QRe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},ZRe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},eNe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},tNe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},nNe=(r,s)=>{const a=Number(r),c=a%100;if(c>20||c<10)switch(c%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},rNe={ordinalNumber:nNe,era:Vg({values:XRe,defaultWidth:"wide"}),quarter:Vg({values:JRe,defaultWidth:"wide",argumentCallback:r=>r-1}),month:Vg({values:QRe,defaultWidth:"wide"}),day:Vg({values:ZRe,defaultWidth:"wide"}),dayPeriod:Vg({values:eNe,defaultWidth:"wide",formattingValues:tNe,defaultFormattingWidth:"wide"})};function Fg(r){return(s,a={})=>{const c=a.width,h=c&&r.matchPatterns[c]||r.matchPatterns[r.defaultMatchWidth],f=s.match(h);if(!f)return null;const _=f[0],E=c&&r.parsePatterns[c]||r.parsePatterns[r.defaultParseWidth],v=Array.isArray(E)?iNe(E,R=>R.test(_)):sNe(E,R=>R.test(_));let x;x=r.valueCallback?r.valueCallback(v):v,x=a.valueCallback?a.valueCallback(x):x;const T=s.slice(_.length);return{value:x,rest:T}}}function sNe(r,s){for(const a in r)if(Object.prototype.hasOwnProperty.call(r,a)&&s(r[a]))return a}function iNe(r,s){for(let a=0;a<r.length;a++)if(s(r[a]))return a}function oNe(r){return(s,a={})=>{const c=s.match(r.matchPattern);if(!c)return null;const h=c[0],f=s.match(r.parsePattern);if(!f)return null;let _=r.valueCallback?r.valueCallback(f[0]):f[0];_=a.valueCallback?a.valueCallback(_):_;const E=s.slice(h.length);return{value:_,rest:E}}}const aNe=/^(\d+)(th|st|nd|rd)?/i,cNe=/\d+/i,lNe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},dNe={any:[/^b/i,/^(a|c)/i]},uNe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},hNe={any:[/1/i,/2/i,/3/i,/4/i]},pNe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},mNe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},fNe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},gNe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},_Ne={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},yNe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},ENe={ordinalNumber:oNe({matchPattern:aNe,parsePattern:cNe,valueCallback:r=>parseInt(r,10)}),era:Fg({matchPatterns:lNe,defaultMatchWidth:"wide",parsePatterns:dNe,defaultParseWidth:"any"}),quarter:Fg({matchPatterns:uNe,defaultMatchWidth:"wide",parsePatterns:hNe,defaultParseWidth:"any",valueCallback:r=>r+1}),month:Fg({matchPatterns:pNe,defaultMatchWidth:"wide",parsePatterns:mNe,defaultParseWidth:"any"}),day:Fg({matchPatterns:fNe,defaultMatchWidth:"wide",parsePatterns:gNe,defaultParseWidth:"any"}),dayPeriod:Fg({matchPatterns:_Ne,defaultMatchWidth:"any",parsePatterns:yNe,defaultParseWidth:"any"})},vNe={code:"en-US",formatDistance:WRe,formatLong:zRe,formatRelative:qRe,localize:rNe,match:ENe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function bNe(r){const s=Ya(r);return jRe(s,BRe(s))+1}function SNe(r){const s=Ya(r),a=+eS(s)-+URe(s);return Math.round(a/BY)+1}function WY(r,s){var T,R,N,L;const a=Ya(r),c=a.getFullYear(),h=VS(),f=(s==null?void 0:s.firstWeekContainsDate)??((R=(T=s==null?void 0:s.locale)==null?void 0:T.options)==null?void 0:R.firstWeekContainsDate)??h.firstWeekContainsDate??((L=(N=h.locale)==null?void 0:N.options)==null?void 0:L.firstWeekContainsDate)??1,_=uh(r,0);_.setFullYear(c+1,0,f),_.setHours(0,0,0,0);const E=z0(_,s),v=uh(r,0);v.setFullYear(c,0,f),v.setHours(0,0,0,0);const x=z0(v,s);return a.getTime()>=E.getTime()?c+1:a.getTime()>=x.getTime()?c:c-1}function xNe(r,s){var E,v,x,T;const a=VS(),c=(s==null?void 0:s.firstWeekContainsDate)??((v=(E=s==null?void 0:s.locale)==null?void 0:E.options)==null?void 0:v.firstWeekContainsDate)??a.firstWeekContainsDate??((T=(x=a.locale)==null?void 0:x.options)==null?void 0:T.firstWeekContainsDate)??1,h=WY(r,s),f=uh(r,0);return f.setFullYear(h,0,c),f.setHours(0,0,0,0),z0(f,s)}function wNe(r,s){const a=Ya(r),c=+z0(a,s)-+xNe(a,s);return Math.round(c/BY)+1}function nr(r,s){const a=r<0?"-":"",c=Math.abs(r).toString().padStart(s,"0");return a+c}const td={y(r,s){const a=r.getFullYear(),c=a>0?a:1-a;return nr(s==="yy"?c%100:c,s.length)},M(r,s){const a=r.getMonth();return s==="M"?String(a+1):nr(a+1,2)},d(r,s){return nr(r.getDate(),s.length)},a(r,s){const a=r.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(r,s){return nr(r.getHours()%12||12,s.length)},H(r,s){return nr(r.getHours(),s.length)},m(r,s){return nr(r.getMinutes(),s.length)},s(r,s){return nr(r.getSeconds(),s.length)},S(r,s){const a=s.length,c=r.getMilliseconds(),h=Math.trunc(c*Math.pow(10,a-3));return nr(h,s.length)}},Gp={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},iG={G:function(r,s,a){const c=r.getFullYear()>0?1:0;switch(s){case"G":case"GG":case"GGG":return a.era(c,{width:"abbreviated"});case"GGGGG":return a.era(c,{width:"narrow"});case"GGGG":default:return a.era(c,{width:"wide"})}},y:function(r,s,a){if(s==="yo"){const c=r.getFullYear(),h=c>0?c:1-c;return a.ordinalNumber(h,{unit:"year"})}return td.y(r,s)},Y:function(r,s,a,c){const h=WY(r,c),f=h>0?h:1-h;if(s==="YY"){const _=f%100;return nr(_,2)}return s==="Yo"?a.ordinalNumber(f,{unit:"year"}):nr(f,s.length)},R:function(r,s){const a=$Y(r);return nr(a,s.length)},u:function(r,s){const a=r.getFullYear();return nr(a,s.length)},Q:function(r,s,a){const c=Math.ceil((r.getMonth()+1)/3);switch(s){case"Q":return String(c);case"QQ":return nr(c,2);case"Qo":return a.ordinalNumber(c,{unit:"quarter"});case"QQQ":return a.quarter(c,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(c,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(c,{width:"wide",context:"formatting"})}},q:function(r,s,a){const c=Math.ceil((r.getMonth()+1)/3);switch(s){case"q":return String(c);case"qq":return nr(c,2);case"qo":return a.ordinalNumber(c,{unit:"quarter"});case"qqq":return a.quarter(c,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(c,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(c,{width:"wide",context:"standalone"})}},M:function(r,s,a){const c=r.getMonth();switch(s){case"M":case"MM":return td.M(r,s);case"Mo":return a.ordinalNumber(c+1,{unit:"month"});case"MMM":return a.month(c,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(c,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(c,{width:"wide",context:"formatting"})}},L:function(r,s,a){const c=r.getMonth();switch(s){case"L":return String(c+1);case"LL":return nr(c+1,2);case"Lo":return a.ordinalNumber(c+1,{unit:"month"});case"LLL":return a.month(c,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(c,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(c,{width:"wide",context:"standalone"})}},w:function(r,s,a,c){const h=wNe(r,c);return s==="wo"?a.ordinalNumber(h,{unit:"week"}):nr(h,s.length)},I:function(r,s,a){const c=SNe(r);return s==="Io"?a.ordinalNumber(c,{unit:"week"}):nr(c,s.length)},d:function(r,s,a){return s==="do"?a.ordinalNumber(r.getDate(),{unit:"date"}):td.d(r,s)},D:function(r,s,a){const c=bNe(r);return s==="Do"?a.ordinalNumber(c,{unit:"dayOfYear"}):nr(c,s.length)},E:function(r,s,a){const c=r.getDay();switch(s){case"E":case"EE":case"EEE":return a.day(c,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(c,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(c,{width:"short",context:"formatting"});case"EEEE":default:return a.day(c,{width:"wide",context:"formatting"})}},e:function(r,s,a,c){const h=r.getDay(),f=(h-c.weekStartsOn+8)%7||7;switch(s){case"e":return String(f);case"ee":return nr(f,2);case"eo":return a.ordinalNumber(f,{unit:"day"});case"eee":return a.day(h,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(h,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(h,{width:"short",context:"formatting"});case"eeee":default:return a.day(h,{width:"wide",context:"formatting"})}},c:function(r,s,a,c){const h=r.getDay(),f=(h-c.weekStartsOn+8)%7||7;switch(s){case"c":return String(f);case"cc":return nr(f,s.length);case"co":return a.ordinalNumber(f,{unit:"day"});case"ccc":return a.day(h,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(h,{width:"narrow",context:"standalone"});case"cccccc":return a.day(h,{width:"short",context:"standalone"});case"cccc":default:return a.day(h,{width:"wide",context:"standalone"})}},i:function(r,s,a){const c=r.getDay(),h=c===0?7:c;switch(s){case"i":return String(h);case"ii":return nr(h,s.length);case"io":return a.ordinalNumber(h,{unit:"day"});case"iii":return a.day(c,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(c,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(c,{width:"short",context:"formatting"});case"iiii":default:return a.day(c,{width:"wide",context:"formatting"})}},a:function(r,s,a){const h=r.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return a.dayPeriod(h,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(h,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(h,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(h,{width:"wide",context:"formatting"})}},b:function(r,s,a){const c=r.getHours();let h;switch(c===12?h=Gp.noon:c===0?h=Gp.midnight:h=c/12>=1?"pm":"am",s){case"b":case"bb":return a.dayPeriod(h,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(h,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(h,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(h,{width:"wide",context:"formatting"})}},B:function(r,s,a){const c=r.getHours();let h;switch(c>=17?h=Gp.evening:c>=12?h=Gp.afternoon:c>=4?h=Gp.morning:h=Gp.night,s){case"B":case"BB":case"BBB":return a.dayPeriod(h,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(h,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(h,{width:"wide",context:"formatting"})}},h:function(r,s,a){if(s==="ho"){let c=r.getHours()%12;return c===0&&(c=12),a.ordinalNumber(c,{unit:"hour"})}return td.h(r,s)},H:function(r,s,a){return s==="Ho"?a.ordinalNumber(r.getHours(),{unit:"hour"}):td.H(r,s)},K:function(r,s,a){const c=r.getHours()%12;return s==="Ko"?a.ordinalNumber(c,{unit:"hour"}):nr(c,s.length)},k:function(r,s,a){let c=r.getHours();return c===0&&(c=24),s==="ko"?a.ordinalNumber(c,{unit:"hour"}):nr(c,s.length)},m:function(r,s,a){return s==="mo"?a.ordinalNumber(r.getMinutes(),{unit:"minute"}):td.m(r,s)},s:function(r,s,a){return s==="so"?a.ordinalNumber(r.getSeconds(),{unit:"second"}):td.s(r,s)},S:function(r,s){return td.S(r,s)},X:function(r,s,a){const c=r.getTimezoneOffset();if(c===0)return"Z";switch(s){case"X":return aG(c);case"XXXX":case"XX":return Uu(c);case"XXXXX":case"XXX":default:return Uu(c,":")}},x:function(r,s,a){const c=r.getTimezoneOffset();switch(s){case"x":return aG(c);case"xxxx":case"xx":return Uu(c);case"xxxxx":case"xxx":default:return Uu(c,":")}},O:function(r,s,a){const c=r.getTimezoneOffset();switch(s){case"O":case"OO":case"OOO":return"GMT"+oG(c,":");case"OOOO":default:return"GMT"+Uu(c,":")}},z:function(r,s,a){const c=r.getTimezoneOffset();switch(s){case"z":case"zz":case"zzz":return"GMT"+oG(c,":");case"zzzz":default:return"GMT"+Uu(c,":")}},t:function(r,s,a){const c=Math.trunc(r.getTime()/1e3);return nr(c,s.length)},T:function(r,s,a){const c=r.getTime();return nr(c,s.length)}};function oG(r,s=""){const a=r>0?"-":"+",c=Math.abs(r),h=Math.trunc(c/60),f=c%60;return f===0?a+String(h):a+String(h)+s+nr(f,2)}function aG(r,s){return r%60===0?(r>0?"-":"+")+nr(Math.abs(r)/60,2):Uu(r,s)}function Uu(r,s=""){const a=r>0?"-":"+",c=Math.abs(r),h=nr(Math.trunc(c/60),2),f=nr(c%60,2);return a+h+s+f}const cG=(r,s)=>{switch(r){case"P":return s.date({width:"short"});case"PP":return s.date({width:"medium"});case"PPP":return s.date({width:"long"});case"PPPP":default:return s.date({width:"full"})}},GY=(r,s)=>{switch(r){case"p":return s.time({width:"short"});case"pp":return s.time({width:"medium"});case"ppp":return s.time({width:"long"});case"pppp":default:return s.time({width:"full"})}},TNe=(r,s)=>{const a=r.match(/(P+)(p+)?/)||[],c=a[1],h=a[2];if(!h)return cG(r,s);let f;switch(c){case"P":f=s.dateTime({width:"short"});break;case"PP":f=s.dateTime({width:"medium"});break;case"PPP":f=s.dateTime({width:"long"});break;case"PPPP":default:f=s.dateTime({width:"full"});break}return f.replace("{{date}}",cG(c,s)).replace("{{time}}",GY(h,s))},CNe={p:GY,P:TNe},RNe=/^D+$/,NNe=/^Y+$/,ANe=["D","DD","YY","YYYY"];function INe(r){return RNe.test(r)}function ONe(r){return NNe.test(r)}function PNe(r,s,a){const c=DNe(r,s,a);if(console.warn(c),ANe.includes(r))throw new RangeError(c)}function DNe(r,s,a){const c=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${s}\`) for formatting ${c} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const kNe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,LNe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,MNe=/^'([^]*?)'?$/,jNe=/''/g,UNe=/[a-zA-Z]/;function y2(r,s,a){var T,R,N,L;const c=VS(),h=c.locale??vNe,f=c.firstWeekContainsDate??((R=(T=c.locale)==null?void 0:T.options)==null?void 0:R.firstWeekContainsDate)??1,_=c.weekStartsOn??((L=(N=c.locale)==null?void 0:N.options)==null?void 0:L.weekStartsOn)??0,E=Ya(r);if(!FRe(E))throw new RangeError("Invalid time value");let v=s.match(LNe).map(j=>{const F=j[0];if(F==="p"||F==="P"){const P=CNe[F];return P(j,h.formatLong)}return j}).join("").match(kNe).map(j=>{if(j==="''")return{isToken:!1,value:"'"};const F=j[0];if(F==="'")return{isToken:!1,value:VNe(j)};if(iG[F])return{isToken:!0,value:j};if(F.match(UNe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+F+"`");return{isToken:!1,value:j}});h.localize.preprocessor&&(v=h.localize.preprocessor(E,v));const x={firstWeekContainsDate:f,weekStartsOn:_,locale:h};return v.map(j=>{if(!j.isToken)return j.value;const F=j.value;(ONe(F)||INe(F))&&PNe(F,s,String(r));const P=iG[F[0]];return P(E,F,h.localize,x)}).join("")}function VNe(r){const s=r.match(MNe);return s?s[1].replace(jNe,"'"):r}const FNe=({chats:r,selectedChat:s,onChatSelect:a,onNewChat:c,onUserSelect:h,filter:f,onFilterChange:_,getChatName:E,getChatAvatar:v,getChatInitials:x})=>{const{theme:T}=sr(),R=T==="dark",[N,L]=rt.useState([]),[j,F]=rt.useState(!1),P=R?"bg-[#101828]":"bg-white",M=R?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",U=R?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",B=R?"text-[#e7eefc]":"text-[#0f172a]",K=R?"text-[#9bb0d0]":"text-[#475569]",J=R?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",te=R?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",se=R?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",ie=R?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",ue=R?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",de=R?"bg-[rgba(110,168,255,0.10)]":"bg-[rgba(37,99,235,0.10)]",Ne=R?"hover:bg-[rgba(255,255,255,0.05)]":"hover:bg-[rgba(15,23,42,0.05)]",[Ce,tt]=rt.useState("dms");rt.useEffect(()=>{Se()},[]);const Se=async()=>{try{F(!0);const Ge=localStorage.getItem("iru-auth");if(!Ge){console.error("No auth data found in localStorage"),F(!1);return}const Re=JSON.parse(Ge).token;if(!Re){console.error("No token found in auth data"),F(!1);return}const le="http://localhost:5000";console.log("Fetching users from:",`${le}/api/users`);const ve=await fetch(`${le}/api/users`,{headers:{Authorization:`Bearer ${Re}`}});if(console.log("Users API response status:",ve.status),ve.ok){const Le=await ve.json();console.log("Loaded users from database:",(Le==null?void 0:Le.length)||0,Le),L(Array.isArray(Le)?Le:[])}else{const Le=await ve.text();console.error("Failed to fetch users:",ve.status,Le);const qe=await fetch(`${le}/api/calls/users`,{headers:{Authorization:`Bearer ${Re}`}});if(qe.ok){const We=await qe.json();console.log("Loaded users from calls endpoint:",(We==null?void 0:We.length)||0),L(Array.isArray(We)?We:[])}else console.error("Both endpoints failed")}}catch(Ge){console.error("Error loading users:",Ge)}finally{F(!1)}};return d.jsxs("section",{className:`w-80 flex-shrink-0 flex flex-col h-full ${P} border-r ${M} rounded-none ${J} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${M} ${U}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${B}`,children:"Chat List"}),d.jsxs("div",{className:"flex gap-1",children:[d.jsx("button",{onClick:()=>tt("dms"),className:`px-2 py-1 rounded-full text-xs font-medium transition-colors border ${Ce==="dms"?te:se}`,children:"DMs"}),d.jsx("button",{onClick:()=>tt("groups"),className:`px-2 py-1 rounded-full text-xs font-medium transition-colors border ${Ce==="groups"?te:se}`,children:"Groups"})]})]}),d.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[d.jsxs("div",{className:"p-4 space-y-3 flex-1 overflow-y-auto",children:[d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{onClick:()=>_("all"),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-300 ease-out transform hover:scale-105 active:scale-95 border ${f==="all"?te:se}`,role:"tab","aria-selected":f==="all",children:"All"}),d.jsx("button",{onClick:()=>_("unread"),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-300 ease-out transform hover:scale-105 active:scale-95 border ${f==="unread"?te:se}`,role:"tab","aria-selected":f==="unread",children:"Unread"}),d.jsx("button",{onClick:()=>_("pinned"),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-300 ease-out transform hover:scale-105 active:scale-95 border ${f==="pinned"?te:se}`,role:"tab","aria-selected":f==="pinned",children:"Pinned"})]}),d.jsx("button",{onClick:c,className:`w-full px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-300 ease-out transform hover:scale-[1.02] hover:shadow-lg active:scale-[0.98] border ${ie}`,children:"+ New Chat"}),d.jsxs("div",{className:"space-y-1",children:[d.jsx("div",{className:"space-y-1 mb-4",children:j?d.jsx("div",{className:`p-4 text-center ${K} text-sm`,children:"Loading users..."}):N.length>0?d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:`px-4 py-2 ${K} text-xs font-medium uppercase tracking-wide border-b ${M} flex items-center justify-between`,children:[d.jsxs("span",{children:["Available Users (",N.length,")"]}),d.jsx("button",{onClick:Se,disabled:j,className:`text-xs ${ue} px-2 py-1 rounded disabled:opacity-50`,title:"Refresh users",children:" Refresh"})]}),N.map(Ge=>{if(!Ge||!Ge.id||!Ge.fullName)return null;const Xe=Ge.fullName.split(" ").map(Re=>Re[0]).join("").toUpperCase().slice(0,2);return d.jsx("div",{onClick:()=>h==null?void 0:h(Ge),className:`p-3 rounded-lg cursor-pointer transition-all duration-300 ease-out transform hover:scale-[1.02] hover:shadow-lg animate-slide-in-left ${Ne}`,children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden ${R?"bg-gray-600":"bg-gray-300"}`,children:Ge.profilePicture?d.jsx("img",{src:Ge.profilePicture,alt:Ge.fullName,className:"w-full h-full object-cover"}):d.jsx("span",{className:`text-sm font-semibold ${R?"text-white":"text-gray-900"}`,children:Xe})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsxs("div",{className:"flex items-center justify-between mb-1",children:[d.jsx("span",{className:`text-sm font-medium ${B} truncate`,children:Ge.fullName}),Ge.isOnline&&d.jsx("span",{className:`w-2 h-2 rounded-full ${R?"bg-green-400":"bg-green-500"}`,title:"Online"})]}),d.jsx("div",{className:"flex items-center justify-between",children:d.jsx("p",{className:`text-xs ${K} truncate pr-2`,children:Ge.email||Ge.username||"No email"})})]})]})},Ge.id)})]}):d.jsxs("div",{className:`p-4 text-center ${K} text-sm border-b ${M}`,children:[d.jsx("p",{className:"font-medium mb-1",children:"No users found"}),d.jsx("p",{className:"text-xs",children:"Please check your connection or try refreshing"})]})}),r.length===0&&N.length>0?d.jsxs("div",{className:`p-4 text-center ${K} text-sm border-t ${M} mt-4`,children:[d.jsx("p",{className:"font-medium mb-1",children:"No chats yet"}),d.jsx("p",{className:"text-xs",children:"Select a user above to start chatting"})]}):r.length>0?r.map((Ge,Xe)=>{var We;const Re=(We=Ge.messages)==null?void 0:We[0],le=(s==null?void 0:s.id)===Ge.id,ve=E(Ge),Le=v(Ge),qe=x(Ge);return d.jsx("div",{onClick:()=>{console.log("Chat clicked:",Ge.id,ve),a(Ge)},className:`p-3 rounded-lg cursor-pointer transition-all duration-300 ease-out transform hover:scale-[1.02] hover:shadow-lg animate-slide-in-left ${le?de:Ne}`,style:{animationDelay:`${Xe*50}ms`},children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${R?"bg-gray-600":"bg-gray-300"}`,children:Le?d.jsx("img",{src:Le,alt:ve,className:"w-full h-full object-cover rounded-full"}):d.jsx("span",{className:`text-sm font-semibold ${R?"text-white":"text-gray-900"}`,children:qe})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsxs("div",{className:"flex items-center justify-between mb-1",children:[d.jsx("span",{className:`text-sm font-medium ${B} truncate`,children:ve}),Ge.unreadCount&&Ge.unreadCount>0&&d.jsx("span",{className:"inline-flex items-center justify-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-red-500 text-white",children:Ge.unreadCount})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("p",{className:`text-xs ${K} truncate pr-2`,children:Re?Re.content.length>30?Re.content.substring(0,30)+"...":Re.content:"No messages yet"}),Re&&d.jsx("span",{className:`text-xs ${K} flex-shrink-0`,children:y2(new Date(Re.createdAt),"HH:mm")})]})]})]})},Ge.id)}):null]})]}),d.jsx("div",{className:`px-4 py-3 border-t ${M} ${K} text-xs`,children:"Replace these with a virtualized list (large chats)."})]})]})},BNe=({messages:r,currentUserId:s,inputValue:a,onInputChange:c,onSendMessage:h,onFileSelect:f,onDeleteMessage:_,isMessageRead:E,isRecording:v,recordingTime:x,onStartRecording:T,onStopRecording:R,onCancelRecording:N,onSendVoice:L,audioBlob:j,formatRecordingTime:F,chatName:P="Conversation",chatAvatar:M,onVoiceCall:U,onVideoCall:B})=>{const{theme:K}=sr(),J=K==="dark",te=V.useRef(null),[se,ie]=V.useState(null),[ue,de]=V.useState(!1),[Ne,Ce]=V.useState("all");V.useEffect(()=>{var be;(be=te.current)==null||be.scrollIntoView({behavior:"smooth"})},[r]);const tt=J?"bg-[#101828]":"bg-white",Se=J?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",Ge=J?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",Xe=J?"text-[#e7eefc]":"text-[#0f172a]",Re=J?"text-[#9bb0d0]":"text-[#475569]",le=J?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",ve=J?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",Le=J?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",qe=J?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",We=J?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",xt=J?"text-[#e7eefc]":"text-[#0f172a]",bt=J?"placeholder-[#9bb0d0]":"placeholder-[#475569]",$t=J?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",vt=J?"bg-[rgba(110,168,255,0.20)]":"bg-[rgba(37,99,235,0.20)]",ut=J?"bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.05)]",Wt=J?"bg-[rgba(255,255,255,0.09)]":"bg-[rgba(15,23,42,0.10)]",Jt=J?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",Dt=J?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",At=rt.useMemo(()=>Ne==="all"?r.filter(be=>!be.isDeleted):Ne==="unread"?r.filter(be=>!be.isDeleted&&!E(be)):Ne==="pinned"?r.filter(be=>!be.isDeleted&&be.isPinned):r.filter(be=>!be.isDeleted),[r,Ne,E]);return d.jsxs("section",{className:`flex-1 flex flex-col h-full ${tt} border-r ${Se} rounded-none ${le} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${Se} ${Ge}`,children:[d.jsxs("div",{className:"flex items-center gap-2",children:[M?d.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0",children:d.jsx("img",{src:M,alt:P,className:"w-full h-8 object-cover"})}):d.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${J?"bg-gray-600":"bg-gray-300"}`,children:d.jsx("span",{className:`text-xs font-semibold ${J?"text-white":"text-gray-900"}`,children:P.split(" ").map(be=>be[0]).join("").toUpperCase().slice(0,2)})}),d.jsxs("div",{children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${Xe}`,children:P&&P!=="Conversation"&&P!=="Group Chat"&&P!=="Unknown User"?`Conversation with ${P}`:P||"Conversation"}),P&&P!=="Conversation"&&P!=="Group Chat"&&P!=="Unknown User"&&d.jsx("p",{className:`text-xs ${Re} m-0`,children:P})]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[U&&d.jsx("button",{onClick:U,className:`p-2 rounded-lg border transition-colors ${$t} hover:opacity-80`,title:"Voice Call",children:d.jsx(wd,{className:"w-4 h-4"})}),B&&d.jsx("button",{onClick:B,className:`p-2 rounded-lg border transition-colors ${$t} hover:opacity-80`,title:"Video Call",children:d.jsx(eb,{className:"w-4 h-4"})}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${Le} ${ve} ${Re} text-xs`,children:"Thread-ready"})]})]}),d.jsxs("div",{className:`px-4 py-2 border-b ${Se} ${Ge} flex items-center gap-2`,children:[d.jsx("button",{onClick:()=>Ce("all"),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${Ne==="all"?Jt:Dt}`,children:"All"}),d.jsx("button",{onClick:()=>Ce("unread"),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${Ne==="unread"?Jt:Dt}`,children:"Unread"}),d.jsx("button",{onClick:()=>Ce("pinned"),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${Ne==="pinned"?Jt:Dt}`,children:"Pinned"})]}),d.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:[At.length===0?d.jsx(d.Fragment,{children:d.jsx("div",{className:`mb-4 ${Re} text-xs text-center py-8`,children:d.jsx("p",{children:"No messages yet. Start the conversation!"})})}):At.map((be,ht)=>{var Ln;const Gt=be.senderId===s;return E(be),d.jsx("div",{className:`flex ${Gt?"justify-end":"justify-start"} animate-fade-in group`,style:{animationDelay:`${ht*50}ms`},onMouseEnter:()=>ie(be.id),onMouseLeave:()=>ie(null),children:d.jsxs("div",{className:`max-w-[78%] rounded-lg px-3 py-2 transition-all duration-300 hover:shadow-md relative ${Gt?vt:ut}`,children:[d.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[d.jsxs("div",{className:`text-xs font-medium ${Re}`,children:[Gt?"You":((Ln=be.sender)==null?void 0:Ln.fullName)||"Unknown","  ",y2(new Date(be.createdAt),"HH:mm")]}),Gt&&_&&se===be.id&&d.jsx("button",{onClick:()=>_(be.id),className:`p-1 rounded hover:bg-opacity-20 transition-colors ${J?"hover:bg-red-500 text-red-400":"hover:bg-red-500 text-red-600"}`,title:"Delete message",children:d.jsx(gh,{className:"w-3 h-3"})})]}),d.jsxs("div",{className:`text-sm ${Xe}`,children:[be.type==="image"&&be.fileUrl&&d.jsxs("div",{className:"mb-1",children:[d.jsx("img",{src:be.fileUrl,alt:be.content||"Image",className:"max-w-full rounded-lg max-h-64 object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(be.fileUrl,"_blank")}),be.content&&be.content!==be.fileName&&d.jsx("p",{className:"mt-2",children:be.content})]}),be.type==="video"&&be.fileUrl&&d.jsxs("div",{className:"mb-1",children:[d.jsx("video",{src:be.fileUrl,controls:!0,className:"max-w-full rounded-lg max-h-64",children:"Your browser does not support the video tag."}),be.content&&be.content!==be.fileName&&d.jsx("p",{className:"mt-2",children:be.content})]}),be.type==="audio"&&be.fileUrl&&d.jsx("div",{className:"mb-1 flex items-center gap-2",children:d.jsx("audio",{src:be.fileUrl,controls:!0,className:"flex-1",children:"Your browser does not support the audio tag."})}),be.type==="file"&&d.jsxs("div",{className:"flex items-center gap-2 p-2 rounded bg-opacity-50 hover:bg-opacity-70 transition-colors",children:[d.jsx(fA,{className:"w-4 h-4 flex-shrink-0"}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("a",{href:be.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline truncate block",children:be.fileName||be.content}),be.fileSize&&d.jsxs("span",{className:`text-xs ${Re}`,children:[(be.fileSize/1024).toFixed(1)," KB"]})]})]}),be.type==="text"&&d.jsx("p",{className:"whitespace-pre-wrap break-words",children:be.content}),!["image","video","audio","file","text"].includes(be.type)&&d.jsx("p",{children:be.content})]})]})},be.id)}),d.jsx("div",{ref:te})]}),d.jsx("div",{className:`h-px ${Wt}`}),j&&!v&&d.jsxs("div",{className:`px-4 py-3 border-t ${Se} ${Ge} flex items-center justify-between gap-3`,children:[d.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[d.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${J?"bg-red-500/20":"bg-red-500/10"}`,children:d.jsx(mA,{className:`w-5 h-5 ${J?"text-red-400":"text-red-600"}`})}),d.jsxs("div",{className:"flex-1",children:[d.jsx("p",{className:`text-sm font-medium ${Xe}`,children:"Voice message ready"}),d.jsx("p",{className:`text-xs ${Re}`,children:"Click send to share"})]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{type:"button",onClick:N,className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${J?"border-gray-600 text-gray-400 hover:bg-gray-800":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:"Cancel"}),d.jsxs("button",{type:"button",onClick:L,className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ${J?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc] hover:bg-[rgba(110,168,255,0.20)]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a] hover:bg-[rgba(37,99,235,0.20)]"} border`,children:[d.jsx(O0,{className:"w-3 h-3 inline mr-1"}),"Send"]})]})]}),d.jsxs("div",{className:"p-4 space-y-3",children:[d.jsx("label",{className:`block text-xs ${Re}`,htmlFor:"messageInput",children:"Message"}),d.jsx("textarea",{id:"messageInput",value:a,onChange:be=>c(be.target.value),onKeyDown:be=>{be.key==="Enter"&&!be.shiftKey&&(be.preventDefault(),h(be))},placeholder:"Type a message",rows:3,disabled:v,className:`w-full px-3 py-2 rounded-lg ${qe} border ${We} ${xt} text-sm ${bt} focus:outline-none focus:ring-2 ${J?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"} resize-none disabled:opacity-50 disabled:cursor-not-allowed`}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsxs("button",{type:"button",onClick:f,disabled:v,className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors border ${$t} disabled:opacity-50 disabled:cursor-not-allowed`,children:[d.jsx(fA,{className:"w-4 h-4 inline mr-1"}),"Attach"]}),d.jsxs("button",{type:"button",onClick:()=>{const be=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],ht=be[Math.floor(Math.random()*be.length)];c(a+ht),de(!1)},disabled:v,className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors border ${$t} disabled:opacity-50 disabled:cursor-not-allowed relative`,title:"Add emoji",children:[d.jsx(Qge,{className:"w-4 h-4 inline mr-1"}),"Emoji"]}),d.jsxs("button",{type:"button",onClick:v?R:T,className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors border ${v?J?"bg-red-500/20 border-red-500/50 text-red-400 animate-pulse":"bg-red-500/20 border-red-500/50 text-red-600 animate-pulse":$t}`,children:[d.jsx(mA,{className:"w-4 h-4 inline mr-1"}),v?`Stop (${F(x)})`:"Voice"]})]}),d.jsxs("button",{type:"button",onClick:be=>{be.preventDefault(),h(be)},disabled:!a.trim()&&!j||v,className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${$t} disabled:opacity-50 disabled:cursor-not-allowed`,children:[d.jsx(O0,{className:"w-4 h-4 inline mr-1"}),"Send"]})]})]})]})},$Ne=({chat:r,messages:s,onMute:a,onArchive:c,onBlockReport:h})=>{var J;const{theme:f}=sr(),_=f==="dark",E=_?"bg-[#101828]":"bg-white",v=_?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",x=_?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",T=_?"text-[#e7eefc]":"text-[#0f172a]",R=_?"text-[#9bb0d0]":"text-[#475569]",N=_?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",L=_?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",j=_?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",F=_?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#e7eefc] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#0f172a] hover:bg-[rgba(15,23,42,0.05)]",P=_?"bg-[rgba(255,107,107,0.12)] border-[rgba(255,107,107,0.35)] text-[#ff6b6b] hover:bg-[rgba(255,107,107,0.20)]":"bg-[rgba(220,38,38,0.12)] border-[rgba(220,38,38,0.35)] text-[#dc2626] hover:bg-[rgba(220,38,38,0.20)]",M=_?"bg-[rgba(255,255,255,0.09)]":"bg-[rgba(15,23,42,0.10)]",U=((J=r==null?void 0:r.members)==null?void 0:J.length)||0,B=s.filter(te=>te.isPinned&&!te.isDeleted).length,K=s.filter(te=>te.fileUrl&&!te.isDeleted).length;return d.jsxs("section",{className:`w-80 flex-shrink-0 flex flex-col h-full ${E} border-l ${v} rounded-none ${N} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${v} ${x}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${T}`,children:"Info"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${j} ${L} ${R} text-xs`,children:"Members  Files"})]}),d.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:d.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[d.jsx("p",{className:`text-xs ${R}`,children:"Chat details panel."}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:`text-sm ${T}`,children:"Members"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${j} ${L} ${R} text-xs`,children:U})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:`text-sm ${T}`,children:"Pinned"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${j} ${L} ${R} text-xs`,children:B})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:`text-sm ${T}`,children:"Shared files"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${j} ${L} ${R} text-xs`,children:K})]})]}),d.jsx("div",{className:`h-px ${M}`}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("button",{onClick:a,className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${F}`,children:"Mute"}),d.jsx("button",{onClick:c,className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${F}`,children:"Archive"}),d.jsx("button",{onClick:h,className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${P}`,children:"Block / Report"})]})]})})]})},$r=({title:r,subtitle:s,searchQuery:a,onSearchChange:c,onNewAction:h,onMenuToggle:f})=>{const{theme:_}=sr(),E=_==="dark";return d.jsxs("header",{className:`h-16 flex items-center justify-between px-4 border-b ${E?"bg-card border-border":"bg-white border-border"}`,children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("button",{onClick:f,className:"p-2 rounded-lg transition-all duration-300 ease-out transform hover:scale-110 active:scale-95 lg:hidden hover:bg-muted","aria-label":"Open menu",children:d.jsx(iO,{className:"w-5 h-5"})}),d.jsxs("div",{children:[d.jsx("h1",{className:"font-semibold text-lg text-foreground",children:r}),d.jsx("p",{className:"text-xs text-muted-foreground",children:s})]})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsxs("div",{className:"relative",children:[d.jsx(EH,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),d.jsx("input",{type:"search",placeholder:"Search (placeholder)",value:a,onChange:v=>c(v.target.value),className:"w-64 pl-10 pr-4 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-ring bg-muted text-foreground placeholder:text-muted-foreground"})]}),d.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300 ease-out transform hover:scale-105 hover:shadow-lg active:scale-95 bg-primary text-primary-foreground hover:bg-primary/90",children:[d.jsx(Md,{className:"w-4 h-4"}),"New"]})]})]})},lG="http://localhost:5000",WNe=({isOpen:r,onClose:s,onChatCreated:a})=>{const[c,h]=V.useState(""),[f,_]=V.useState([]),[E,v]=V.useState([]),[x,T]=V.useState("one-to-one"),[R,N]=V.useState(""),[L,j]=V.useState(!1);V.useEffect(()=>{r?F():(h(""),v([]),N(""),T("one-to-one"))},[r]);const F=async()=>{try{const K=P();if(!K){console.log("No auth token, cannot load users");return}j(!0);const J=await fetch(`${lG}/api/users`,{headers:{Authorization:`Bearer ${K}`}});if(J.ok){const te=await J.json();_(te)}else console.error("Failed to load users:",J.statusText)}catch(K){console.error("Error loading users:",K)}finally{j(!1)}},P=()=>{try{const K=localStorage.getItem("iru-auth");if(K)return JSON.parse(K).token}catch{return null}return null},M=f.filter(K=>{var te;if(!c)return!0;const J=c.toLowerCase();return K.fullName.toLowerCase().includes(J)||K.email.toLowerCase().includes(J)||((te=K.username)==null?void 0:te.toLowerCase().includes(J))}),U=K=>{v(x==="one-to-one"?[K]:J=>J.find(se=>se.id===K.id)?J.filter(se=>se.id!==K.id):[...J,K])},B=async()=>{if(!(x==="one-to-one"&&E.length!==1)&&!(x==="group"&&(E.length<1||!R.trim()))){j(!0);try{const K=P(),J=await fetch(`${lG}/api/chats`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${K}`},body:JSON.stringify({type:x,name:x==="group"?R:void 0,memberIds:E.map(te=>te.id)})});if(J.ok){const te=await J.json();a(te),s()}else{const te=await J.json().catch(()=>({})),se=te.error||te.message||"Failed to create chat";console.error("Chat creation error:",te),alert(se)}}catch(K){console.error("Error creating chat:",K),alert(K.message||"Failed to create chat. Please try again.")}finally{j(!1)}}};return r?d.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg w-full max-w-md shadow-xl",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"New Chat"}),d.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:d.jsx(yo,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]}),d.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("button",{onClick:()=>{T("one-to-one"),v([])},className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${x==="one-to-one"?"bg-[#075e54] text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[d.jsx(vH,{className:"w-4 h-4 inline mr-2"}),"One-to-One"]}),d.jsxs("button",{onClick:()=>{T("group"),v([])},className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${x==="group"?"bg-[#075e54] text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:[d.jsx(Nc,{className:"w-4 h-4 inline mr-2"}),"Group"]})]})}),x==="group"&&d.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:d.jsx("input",{type:"text",placeholder:"Group name",value:R,onChange:K=>N(K.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-[#075e54]"})}),E.length>0&&d.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:d.jsx("div",{className:"flex flex-wrap gap-2",children:E.map(K=>d.jsxs("div",{className:"flex items-center gap-2 bg-[#075e54] text-white px-3 py-1 rounded-full text-sm",children:[d.jsx("span",{children:K.fullName}),d.jsx("button",{onClick:()=>U(K),className:"hover:bg-[#064d44] rounded-full p-0.5",children:d.jsx(yo,{className:"w-3 h-3"})})]},K.id))})}),d.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:d.jsxs("div",{className:"relative",children:[d.jsx(EH,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),d.jsx("input",{type:"text",placeholder:"Search users...",value:c,onChange:K=>h(K.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-[#075e54]"})]})}),d.jsx("div",{className:"max-h-96 overflow-y-auto",children:L?d.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:"Loading users..."}):M.length===0?d.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:c?"No users found":"No users available"}):M.map(K=>{const J=E.some(te=>te.id===K.id);return d.jsx("div",{onClick:()=>U(K),className:`p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${J?"bg-blue-50 dark:bg-blue-900/20":""}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center overflow-hidden",children:K.profilePicture?d.jsx("img",{src:K.profilePicture,alt:K.fullName,className:"w-full h-full object-cover"}):d.jsx("span",{className:"text-gray-600 dark:text-gray-300 font-semibold text-sm",children:K.fullName.charAt(0).toUpperCase()})}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:K.fullName}),d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:K.email})]}),J&&d.jsx("div",{className:"w-6 h-6 rounded-full bg-[#075e54] flex items-center justify-center",children:d.jsx(nO,{className:"w-4 h-4 text-white"})})]})},K.id)})}),d.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-2",children:[d.jsx("button",{onClick:s,className:"px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600",children:"Cancel"}),d.jsx("button",{onClick:B,disabled:L||x==="one-to-one"&&E.length!==1||x==="group"&&(E.length<1||!R.trim()),className:"px-4 py-2 rounded-lg bg-[#075e54] text-white hover:bg-[#064d44] disabled:opacity-50 disabled:cursor-not-allowed",children:L?"Creating...":"Create Chat"})]})]})}):null},GNe="http://localhost:5000",HNe=({isOpen:r,onClose:s,isDark:a})=>{var j;const[c,h]=V.useState(null),[f,_]=V.useState(!0),[E,v]=V.useState(!1),x=vh();V.useEffect(()=>{r&&T()},[r]),V.useEffect(()=>{const F=P=>{const M=P.target,U=M.closest(".help-menu-container"),B=M.closest("[data-settings-sidebar]");E&&!U&&!B&&v(!1)};if(E)return document.addEventListener("mousedown",F),()=>{document.removeEventListener("mousedown",F)}},[E]);const T=async()=>{var F,P,M,U,B,K,J,te,se,ie,ue,de,Ne,Ce,tt,Se,Ge;try{const Xe=localStorage.getItem("iru-auth");if(!Xe){x("/auth");return}const Re=JSON.parse(Xe),le=Re.token;try{const ve=await fetch(`${GNe}/api/users/me`,{headers:{Authorization:`Bearer ${le}`}});if(ve.ok){const Le=await ve.json();h({id:Le.id,fullName:Le.fullName||Le.name||"User",username:Le.username||((F=Le.email)==null?void 0:F.split("@")[0]),email:Le.email,profilePicture:Le.profilePicture,role:Le.role||"user",plan:Le.plan||"Free"})}else h({id:((P=Re.user)==null?void 0:P.id)||"user",fullName:((M=Re.user)==null?void 0:M.name)||((U=Re.user)==null?void 0:U.fullName)||"User",username:((K=(B=Re.user)==null?void 0:B.email)==null?void 0:K.split("@")[0])||"user",email:((J=Re.user)==null?void 0:J.email)||"",profilePicture:(te=Re.user)==null?void 0:te.profilePicture,role:((se=Re.user)==null?void 0:se.role)||"user",plan:"Free"})}catch{const Le=JSON.parse(Xe);h({id:((ie=Le.user)==null?void 0:ie.id)||"user",fullName:((ue=Le.user)==null?void 0:ue.name)||((de=Le.user)==null?void 0:de.fullName)||"User",username:((Ce=(Ne=Le.user)==null?void 0:Ne.email)==null?void 0:Ce.split("@")[0])||"user",email:((tt=Le.user)==null?void 0:tt.email)||"",profilePicture:(Se=Le.user)==null?void 0:Se.profilePicture,role:((Ge=Le.user)==null?void 0:Ge.role)||"user",plan:"Free"})}}catch(Xe){console.error("Error loading user profile:",Xe)}finally{_(!1)}},R=()=>{localStorage.removeItem("iru-auth"),x("/auth")},N=F=>{const P=F.split(" ");return P.length>=2?(P[0][0]+P[P.length-1][0]).toUpperCase():F.substring(0,2).toUpperCase()},L=F=>F.length>20?F.substring(0,17)+"...":F;return r?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:s}),d.jsxs("div",{className:`fixed left-20 top-0 bottom-0 w-80 ${a?"bg-[#1e293b]":"bg-gray-800"} z-50 flex flex-col shadow-2xl overflow-visible`,"data-settings-sidebar":!0,children:[d.jsxs("div",{className:`p-6 ${a?"bg-[#1e293b]":"bg-gray-800"} border-b border-gray-700`,children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-xl font-semibold text-white",children:"Settings"}),d.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:bg-gray-700 transition-colors",children:d.jsx(yo,{className:"w-5 h-5 text-gray-300"})})]}),f?d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-600 animate-pulse"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("div",{className:"h-4 bg-gray-600 rounded w-24 mb-2 animate-pulse"}),d.jsx("div",{className:"h-3 bg-gray-600 rounded w-32 animate-pulse"})]})]}):c?d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold ${c.profilePicture?"":"bg-gradient-to-br from-pink-500 to-purple-600"} overflow-hidden`,children:c.profilePicture?d.jsx("img",{src:c.profilePicture,alt:c.fullName,className:"w-full h-full object-cover"}):d.jsx("span",{children:N(c.fullName)})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("h3",{className:"font-semibold text-lg text-white truncate",children:c.fullName}),d.jsxs("p",{className:"text-sm text-gray-400 truncate",children:["@",c.username||((j=c.email)==null?void 0:j.split("@")[0])]})]})]}):null]}),d.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-visible py-4",children:d.jsxs("div",{className:"px-4 space-y-1 relative",children:[d.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors hover:bg-gray-700",children:[d.jsx(aO,{className:"w-5 h-5 text-gray-300"}),d.jsx("span",{className:"flex-1 text-left text-gray-200",children:"Upgrade plan"})]}),d.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors hover:bg-gray-700",children:[d.jsx(rO,{className:"w-5 h-5 text-gray-300"}),d.jsx("span",{className:"flex-1 text-left text-gray-200",children:"Personalization"})]}),d.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors hover:bg-gray-700",children:[d.jsx(ch,{className:"w-5 h-5 text-gray-300"}),d.jsx("span",{className:"flex-1 text-left text-gray-200",children:"Settings"})]}),d.jsxs("div",{className:"relative help-menu-container",children:[d.jsxs("button",{onClick:()=>v(!E),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${E?"bg-gray-700":"hover:bg-gray-700"}`,children:[d.jsx(cA,{className:"w-5 h-5 text-gray-300"}),d.jsx("span",{className:"flex-1 text-left text-gray-200",children:"Help"}),d.jsx(Age,{className:`w-4 h-4 text-gray-400 transition-transform ${E?"rotate-90":""}`})]}),E&&d.jsxs("div",{className:`absolute left-full top-0 ml-2 w-64 ${a?"bg-[#1e293b]":"bg-gray-800"} rounded-lg shadow-2xl border border-gray-700 py-2 z-[60] help-menu-container`,style:{minWidth:"256px"},children:[d.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-gray-700 transition-colors",children:[d.jsx(cA,{className:"w-4 h-4 text-gray-300"}),d.jsx("span",{className:"flex-1 text-left text-sm text-gray-200",children:"Help center"}),d.jsx(kg,{className:"w-4 h-4 text-gray-400"})]}),d.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-gray-700 transition-colors",children:[d.jsx(al,{className:"w-4 h-4 text-gray-300"}),d.jsx("span",{className:"flex-1 text-left text-sm text-gray-200",children:"Release notes"}),d.jsx(kg,{className:"w-4 h-4 text-gray-400"})]}),d.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-gray-700 transition-colors",children:[d.jsx(al,{className:"w-4 h-4 text-gray-300"}),d.jsx("span",{className:"flex-1 text-left text-sm text-gray-200",children:"Terms & policies"}),d.jsx(kg,{className:"w-4 h-4 text-gray-400"})]}),d.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-gray-700 transition-colors",children:[d.jsx(jge,{className:"w-4 h-4 text-gray-300"}),d.jsx("span",{className:"flex-1 text-left text-sm text-gray-200",children:"Report Bug"}),d.jsx(kg,{className:"w-4 h-4 text-gray-400"})]}),d.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-gray-700 transition-colors",children:[d.jsx(fH,{className:"w-4 h-4 text-gray-300"}),d.jsx("span",{className:"flex-1 text-left text-sm text-gray-200",children:"Download apps"}),d.jsx(kg,{className:"w-4 h-4 text-gray-400"})]})]})]}),d.jsxs("button",{onClick:R,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors hover:bg-gray-700",children:[d.jsx(I0,{className:"w-5 h-5 text-gray-300"}),d.jsx("span",{className:"flex-1 text-left text-gray-200",children:"Log out"})]})]})}),c&&d.jsx("div",{className:`p-4 border-t border-gray-700 ${a?"bg-[#1e293b]":"bg-gray-800"}`,children:d.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[d.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold ${c.profilePicture?"":"bg-gradient-to-br from-pink-500 to-purple-600"} overflow-hidden`,children:c.profilePicture?d.jsx("img",{src:c.profilePicture,alt:c.fullName,className:"w-full h-full object-cover"}):d.jsx("span",{className:"text-sm",children:N(c.fullName)})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("p",{className:"font-medium text-white truncate",children:L(c.fullName)}),d.jsx("p",{className:"text-sm text-gray-400",children:c.plan||"Free"})]}),d.jsx("button",{className:"px-4 py-1.5 rounded-lg text-sm font-medium transition-colors bg-gray-700 hover:bg-gray-600 text-white",children:"Upgrade"})]})})]})]}):null},Uv="http://localhost:5000",KNe=()=>{const{theme:r}=sr(),s=r==="dark",[a,c]=V.useState(!0),[h,f]=V.useState(!1),[_,E]=V.useState("online"),[v,x]=V.useState(""),[T,R]=V.useState("30 min"),[N,L]=V.useState(!0),[j,F]=V.useState(!0),[P,M]=V.useState(!1),[U,B]=V.useState(!0),[K,J]=V.useState([]),te=()=>{try{const vt=localStorage.getItem("iru-auth");return vt?JSON.parse(vt).token:null}catch(vt){return console.error("Error getting auth token:",vt),null}};V.useEffect(()=>{(async()=>{try{c(!0);const ut=te();if(!ut){console.log("No auth token, cannot load status"),c(!1);return}const Wt=await fetch(`${Uv}/api/status`,{headers:{Authorization:`Bearer ${ut}`}});if(Wt.ok){const Dt=await Wt.json();if(E(Dt.status||"online"),x(Dt.customStatus||""),L(Dt.showLastSeen??!0),F(Dt.sendReadReceipts??!0),M(Dt.allowStatusVisibility??!1),B(Dt.autoAway??!0),Dt.statusExpiresAt){const At=new Date(Dt.statusExpiresAt),be=new Date,ht=At.getTime()-be.getTime(),Gt=Math.floor(ht/(1e3*60));Gt<=30?R("30 min"):Gt<=60?R("1 hour"):R("Today")}}const Jt=await fetch(`${Uv}/api/status/history?limit=10`,{headers:{Authorization:`Bearer ${ut}`}});if(Jt.ok){const Dt=await Jt.json();J(Dt.history||[])}}catch(ut){console.error("Error loading status:",ut),dt.error("Failed to load status settings")}finally{c(!1)}})()},[]);const se=async()=>{var vt;try{f(!0);const ut=te();if(!ut){dt.error("Please login to update status");return}const Wt=await fetch(`${Uv}/api/status`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ut}`},body:JSON.stringify({status:_,customStatus:v||null,statusExpiry:v?T:null,showLastSeen:N,sendReadReceipts:j,allowStatusVisibility:P,autoAway:U})});if(Wt.ok){dt.success("Status updated successfully");const Jt=await fetch(`${Uv}/api/status/history?limit=10`,{headers:{Authorization:`Bearer ${ut}`}});if(Jt.ok){const Dt=await Jt.json();J(Dt.history||[])}}else{const Jt=await Wt.json().catch(()=>({}));(vt=Jt.error)!=null&&vt.includes("migration")?console.warn("Status update: Migration not applied yet, using default values"):dt.error(Jt.error||"Failed to update status")}}catch(ut){console.error("Error saving status:",ut),dt.error("Failed to update status")}finally{f(!1)}},ie=vt=>{E(vt),setTimeout(()=>{se()},100)},ue=()=>{setTimeout(()=>{se()},300)},de=s?"bg-[#101828]":"bg-white",Ne=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",Ce=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",tt=s?"text-[#e7eefc]":"text-[#0f172a]",Se=s?"text-[#9bb0d0]":"text-[#475569]",Ge=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",Xe=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",Re=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",le=s?"text-[#e7eefc]":"text-[#0f172a]",ve=s?"placeholder-[#9bb0d0]":"placeholder-[#475569]",Le=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",qe=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",We=s?"bg-[rgba(255,255,255,0.09)]":"bg-[rgba(15,23,42,0.10)]",xt=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",bt=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",$t=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]";return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 max-w-7xl mx-auto",children:[d.jsxs("section",{className:`${de} border ${Ne} rounded-[22px] ${Ge} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${Ne} ${Ce}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${tt}`,children:"Presence"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${$t} ${bt} ${Se} text-xs`,children:"Personal"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"flex flex-wrap gap-2",children:[d.jsx("button",{onClick:()=>ie("online"),disabled:h||a,className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${_==="online"?Le:qe} ${h||a?"opacity-50 cursor-not-allowed":""}`,children:"Online"}),d.jsx("button",{onClick:()=>ie("away"),disabled:h||a,className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${_==="away"?Le:qe} ${h||a?"opacity-50 cursor-not-allowed":""}`,children:"Away"}),d.jsx("button",{onClick:()=>ie("dnd"),disabled:h||a,className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${_==="dnd"?Le:qe} ${h||a?"opacity-50 cursor-not-allowed":""}`,children:"Do Not Disturb"}),d.jsx("button",{onClick:()=>ie("invisible"),disabled:h||a,className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${_==="invisible"?Le:qe} ${h||a?"opacity-50 cursor-not-allowed":""}`,children:"Invisible"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${Se}`,htmlFor:"customStatus",children:"Custom status"}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("input",{id:"customStatus",type:"text",value:v,onChange:vt=>x(vt.target.value),placeholder:"e.g., In a meeting until 4 PM",className:`flex-1 px-3 py-2 rounded-lg ${Xe} border ${Re} ${le} text-sm ${ve} focus:outline-none focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`}),d.jsxs("select",{value:T,onChange:vt=>R(vt.target.value),className:`px-3 py-2 rounded-lg ${Xe} border ${Re} ${le} text-sm focus:outline-none focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`,"aria-label":"Expiry",children:[d.jsx("option",{value:"30 min",children:"30 min"}),d.jsx("option",{value:"1 hour",children:"1 hour"}),d.jsx("option",{value:"Today",children:"Today"}),d.jsx("option",{value:"Custom",children:"Custom"})]})]}),d.jsx("button",{onClick:se,disabled:h||a,className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${h||a?"opacity-50 cursor-not-allowed":Le}`,children:h?"Saving...":"Save Status"})]})]})]}),d.jsxs("section",{className:`${de} border ${Ne} rounded-[22px] ${Ge} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${Ne} ${Ce}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${tt}`,children:"Privacy Quick Toggles"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${$t} ${bt} ${Se} text-xs`,children:"Controls"})]}),d.jsxs("div",{className:"p-4 space-y-3",children:[d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:N,onChange:vt=>{L(vt.target.checked),ue()},disabled:a,className:`w-4 h-4 rounded ${Re} ${Xe} ${s?"text-[#6ea8ff]":"text-[#2563eb]"} focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`}),d.jsx("span",{className:`text-sm ${tt}`,children:"Show last seen"})]}),d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:j,onChange:vt=>{F(vt.target.checked),ue()},disabled:a,className:`w-4 h-4 rounded ${Re} ${Xe} ${s?"text-[#6ea8ff]":"text-[#2563eb]"} focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`}),d.jsx("span",{className:`text-sm ${tt}`,children:"Send read receipts"})]}),d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:P,onChange:vt=>{M(vt.target.checked),ue()},disabled:a,className:`w-4 h-4 rounded ${Re} ${Xe} ${s?"text-[#6ea8ff]":"text-[#2563eb]"} focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`}),d.jsx("span",{className:`text-sm ${tt}`,children:"Allow status visibility to everyone"})]}),d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:U,onChange:vt=>{B(vt.target.checked),ue()},disabled:a,className:`w-4 h-4 rounded ${Re} ${Xe} ${s?"text-[#6ea8ff]":"text-[#2563eb]"} focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`}),d.jsx("span",{className:`text-sm ${tt}`,children:"Auto-away on inactivity"})]}),d.jsx("div",{className:`h-px ${We} my-2.5`}),d.jsxs("p",{className:`text-xs ${Se}`,children:["For enterprise policies, enforce these in ",d.jsx("strong",{className:tt,children:"Enterprise Tools"}),"."]})]})]}),d.jsxs("section",{className:`lg:col-span-2 ${de} border ${Ne} rounded-[22px] ${Ge} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${Ne} ${Ce}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${tt}`,children:"Status History"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${$t} ${bt} ${Se} text-xs`,children:"Last 10"})]}),d.jsx("div",{className:"p-4",children:d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${xt} px-2 py-2.5 text-left text-xs font-semibold ${Se}`,children:"Time"}),d.jsx("th",{className:`border-b ${xt} px-2 py-2.5 text-left text-xs font-semibold ${Se}`,children:"Status"}),d.jsx("th",{className:`border-b ${xt} px-2 py-2.5 text-left text-xs font-semibold ${Se}`,children:"Note"})]})}),d.jsx("tbody",{children:a?d.jsx("tr",{children:d.jsx("td",{colSpan:3,className:`border-b ${xt} px-2 py-2.5 ${Se} text-center`,children:"Loading history..."})}):K.length===0?d.jsx("tr",{children:d.jsx("td",{colSpan:3,className:`border-b ${xt} px-2 py-2.5 ${Se} text-center`,children:"No status history yet"})}):K.map(vt=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${xt} px-2 py-2.5 ${tt}`,children:vt.time&&vt.time!==""?y2(new Date(vt.time),"MMM d, yyyy h:mm a"):""}),d.jsx("td",{className:`border-b ${xt} px-2 py-2.5 ${tt}`,children:vt.status}),d.jsx("td",{className:`border-b ${xt} px-2 py-2.5 ${tt}`,children:vt.note||""})]},vt.id))})]})})]})]})})})};var HY={exports:{}};(function(r,s){(function(a,c){r.exports=c()})(cv,function(){function a(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in e)){var o=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,o.get?o:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}var c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof cv<"u"?cv:typeof self<"u"?self:{};function h(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var f=function(e){try{return!!e()}catch{return!0}},_=!f(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=_,v=Function.prototype,x=v.call,T=E&&v.bind.bind(x,x),R=E?T:function(e){return function(){return x.apply(e,arguments)}},N=R({}.isPrototypeOf),L=function(e){return e&&e.Math===Math&&e},j=L(typeof globalThis=="object"&&globalThis)||L(typeof window=="object"&&window)||L(typeof self=="object"&&self)||L(typeof c=="object"&&c)||L(typeof c=="object"&&c)||function(){return this}()||Function("return this")(),F=_,P=Function.prototype,M=P.apply,U=P.call,B=typeof Reflect=="object"&&Reflect.apply||(F?U.bind(M):function(){return U.apply(M,arguments)}),K=R,J=K({}.toString),te=K("".slice),se=function(e){return te(J(e),8,-1)},ie=se,ue=R,de=function(e){if(ie(e)==="Function")return ue(e)},Ne=typeof document=="object"&&document.all,Ce=Ne===void 0&&Ne!==void 0?function(e){return typeof e=="function"||e===Ne}:function(e){return typeof e=="function"},tt={},Se=!f(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Ge=_,Xe=Function.prototype.call,Re=Ge?Xe.bind(Xe):function(){return Xe.apply(Xe,arguments)},le={},ve={}.propertyIsEnumerable,Le=Object.getOwnPropertyDescriptor,qe=Le&&!ve.call({1:2},1);le.f=qe?function(e){var t=Le(this,e);return!!t&&t.enumerable}:ve;var We,xt,bt=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},$t=f,vt=se,ut=Object,Wt=R("".split),Jt=$t(function(){return!ut("z").propertyIsEnumerable(0)})?function(e){return vt(e)==="String"?Wt(e,""):ut(e)}:ut,Dt=function(e){return e==null},At=Dt,be=TypeError,ht=function(e){if(At(e))throw new be("Can't call method on "+e);return e},Gt=Jt,Ln=ht,Mn=function(e){return Gt(Ln(e))},bn=Ce,ln=function(e){return typeof e=="object"?e!==null:bn(e)},vn={},Xn=vn,Mr=j,So=Ce,ir=function(e){return So(e)?e:void 0},Jn=function(e,t){return arguments.length<2?ir(Xn[e])||ir(Mr[e]):Xn[e]&&Xn[e][t]||Mr[e]&&Mr[e][t]},ia=j.navigator,jr=ia&&ia.userAgent,yr=jr?String(jr):"",di=j,ui=yr,xs=di.process,xo=di.Deno,ws=xs&&xs.versions||xo&&xo.version,hi=ws&&ws.v8;hi&&(xt=(We=hi.split("."))[0]>0&&We[0]<4?1:+(We[0]+We[1])),!xt&&ui&&(!(We=ui.match(/Edge\/(\d+)/))||We[1]>=74)&&(We=ui.match(/Chrome\/(\d+)/))&&(xt=+We[1]);var os=xt,wo=os,Ai=f,qa=j.String,De=!!Object.getOwnPropertySymbols&&!Ai(function(){var e=Symbol("symbol detection");return!qa(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&wo&&wo<41}),Ie=De&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Pe=Jn,ze=Ce,at=N,ft=Object,Rt=Ie?function(e){return typeof e=="symbol"}:function(e){var t=Pe("Symbol");return ze(t)&&at(t.prototype,ft(e))},Ze=String,ae=function(e){try{return Ze(e)}catch{return"Object"}},Ae=Ce,Be=ae,Ye=TypeError,pt=function(e){if(Ae(e))return e;throw new Ye(Be(e)+" is not a function")},Cn=pt,yn=Dt,nn=function(e,t){var n=e[t];return yn(n)?void 0:Cn(n)},as=Re,Ii=Ce,Ji=ln,bh=TypeError,E2={exports:{}},v2=j,qY=Object.defineProperty,XY=j,JY=function(e,t){try{qY(v2,e,{value:t,configurable:!0,writable:!0})}catch{v2[e]=t}return t},b2="__core-js_shared__",S2=E2.exports=XY[b2]||JY(b2,{});(S2.versions||(S2.versions=[])).push({version:"3.46.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var FS=E2.exports,x2=FS,Sh=function(e,t){return x2[e]||(x2[e]=t||{})},QY=ht,ZY=Object,Xa=function(e){return ZY(QY(e))},eq=Xa,tq=R({}.hasOwnProperty),cs=Object.hasOwn||function(e,t){return tq(eq(e),t)},nq=R,rq=0,sq=Math.random(),iq=nq(1.1.toString),BS=function(e){return"Symbol("+(e===void 0?"":e)+")_"+iq(++rq+sq,36)},oq=Sh,w2=cs,aq=BS,cq=De,lq=Ie,xh=j.Symbol,$S=oq("wks"),dq=lq?xh.for||xh:xh&&xh.withoutSetter||aq,or=function(e){return w2($S,e)||($S[e]=cq&&w2(xh,e)?xh[e]:dq("Symbol."+e)),$S[e]},uq=Re,T2=ln,C2=Rt,hq=nn,pq=function(e,t){var n,i;if(Ii(n=e.toString)&&!Ji(i=as(n,e))||Ii(n=e.valueOf)&&!Ji(i=as(n,e)))return i;throw new bh("Can't convert object to primitive value")},mq=TypeError,fq=or("toPrimitive"),gq=function(e,t){if(!T2(e)||C2(e))return e;var n,i=hq(e,fq);if(i){if(n=uq(i,e,t),!T2(n)||C2(n))return n;throw new mq("Can't convert object to primitive value")}return pq(e)},_q=Rt,WS=function(e){var t=gq(e,"string");return _q(t)?t:t+""},R2=ln,GS=j.document,yq=R2(GS)&&R2(GS.createElement),HS=function(e){return yq?GS.createElement(e):{}},Eq=HS,N2=!Se&&!f(function(){return Object.defineProperty(Eq("div"),"a",{get:function(){return 7}}).a!==7}),vq=Se,bq=Re,Sq=le,xq=bt,wq=Mn,Tq=WS,Cq=cs,Rq=N2,A2=Object.getOwnPropertyDescriptor;tt.f=vq?A2:function(e,t){if(e=wq(e),t=Tq(t),Rq)try{return A2(e,t)}catch{}if(Cq(e,t))return xq(!bq(Sq.f,e,t),e[t])};var Nq=f,Aq=Ce,Iq=/#|\.prototype\./,Qm=function(e,t){var n=Pq[Oq(e)];return n===kq||n!==Dq&&(Aq(t)?Nq(t):!!t)},Oq=Qm.normalize=function(e){return String(e).replace(Iq,".").toLowerCase()},Pq=Qm.data={},Dq=Qm.NATIVE="N",kq=Qm.POLYFILL="P",I2=Qm,Lq=pt,Mq=_,jq=de(de.bind),El=function(e,t){return Lq(e),t===void 0?e:Mq?jq(e,t):function(){return e.apply(t,arguments)}},To={},O2=Se&&f(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Uq=ln,Vq=String,Fq=TypeError,pi=function(e){if(Uq(e))return e;throw new Fq(Vq(e)+" is not an object")},Bq=Se,$q=N2,Wq=O2,u_=pi,P2=WS,Gq=TypeError,KS=Object.defineProperty,Hq=Object.getOwnPropertyDescriptor,zS="enumerable",YS="configurable",qS="writable";To.f=Bq?Wq?function(e,t,n){if(u_(e),t=P2(t),u_(n),typeof e=="function"&&t==="prototype"&&"value"in n&&qS in n&&!n[qS]){var i=Hq(e,t);i&&i[qS]&&(e[t]=n.value,n={configurable:YS in n?n[YS]:i[YS],enumerable:zS in n?n[zS]:i[zS],writable:!1})}return KS(e,t,n)}:KS:function(e,t,n){if(u_(e),t=P2(t),u_(n),$q)try{return KS(e,t,n)}catch{}if("get"in n||"set"in n)throw new Gq("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Kq=To,zq=bt,Ud=Se?function(e,t,n){return Kq.f(e,t,zq(1,n))}:function(e,t,n){return e[t]=n,e},Zm=j,Yq=B,qq=de,Xq=Ce,Jq=tt.f,Qq=I2,wh=vn,Zq=El,Th=Ud,D2=cs,eX=function(e){var t=function(n,i,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,i)}return new e(n,i,o)}return Yq(e,this,arguments)};return t.prototype=e.prototype,t},Qt=function(e,t){var n,i,o,l,u,p,m,g,y,b=e.target,S=e.global,w=e.stat,k=e.proto,I=S?Zm:w?Zm[b]:Zm[b]&&Zm[b].prototype,O=S?wh:wh[b]||Th(wh,b,{})[b],W=O.prototype;for(l in t)i=!(n=Qq(S?l:b+(w?".":"#")+l,e.forced))&&I&&D2(I,l),p=O[l],i&&(m=e.dontCallGetSet?(y=Jq(I,l))&&y.value:I[l]),u=i&&m?m:t[l],(n||k||typeof p!=typeof u)&&(g=e.bind&&i?Zq(u,Zm):e.wrap&&i?eX(u):k&&Xq(u)?qq(u):u,(e.sham||u&&u.sham||p&&p.sham)&&Th(g,"sham",!0),Th(O,l,g),k&&(D2(wh,o=b+"Prototype")||Th(wh,o,{}),Th(wh[o],l,u),e.real&&W&&(n||!W[l])&&Th(W,l,u)))},tX=Math.ceil,nX=Math.floor,rX=Math.trunc||function(e){var t=+e;return(t>0?nX:tX)(t)},sX=rX,XS=function(e){var t=+e;return t!=t||t===0?0:sX(t)},iX=XS,oX=Math.max,aX=Math.min,JS=function(e,t){var n=iX(e);return n<0?oX(n+t,0):aX(n,t)},cX=XS,lX=Math.min,k2=function(e){var t=cX(e);return t>0?lX(t,9007199254740991):0},dX=k2,vl=function(e){return dX(e.length)},uX=Mn,hX=JS,pX=vl,L2=function(e){return function(t,n,i){var o=uX(t),l=pX(o);if(l===0)return!e&&-1;var u,p=hX(i,l);if(e&&n!=n){for(;l>p;)if((u=o[p++])!=u)return!0}else for(;l>p;p++)if((e||p in o)&&o[p]===n)return e||p||0;return!e&&-1}},QS={includes:L2(!0),indexOf:L2(!1)},mX=QS.includes;Qt({target:"Array",proto:!0,forced:f(function(){return!Array(1).includes()})},{includes:function(e){return mX(this,e,arguments.length>1?arguments[1]:void 0)}});var fX=j,gX=vn,Qi=function(e,t){var n=gX[e+"Prototype"],i=n&&n[t];if(i)return i;var o=fX[e],l=o&&o.prototype;return l&&l[t]},_X=Qi("Array","includes"),yX=ln,EX=se,vX=or("match"),ZS=function(e){var t;return yX(e)&&((t=e[vX])!==void 0?!!t:EX(e)==="RegExp")},bX=ZS,SX=TypeError,M2={};M2[or("toStringTag")]="z";var ex=String(M2)==="[object z]",xX=ex,wX=Ce,h_=se,TX=or("toStringTag"),CX=Object,RX=h_(function(){return arguments}())==="Arguments",bl=xX?h_:function(e){var t,n,i;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(o,l){try{return o[l]}catch{}}(t=CX(e),TX))=="string"?n:RX?h_(t):(i=h_(t))==="Object"&&wX(t.callee)?"Arguments":i},NX=bl,AX=String,mi=function(e){if(NX(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return AX(e)},IX=or("match"),OX=Qt,PX=function(e){if(bX(e))throw new SX("The method doesn't accept regular expressions");return e},DX=ht,j2=mi,kX=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[IX]=!1,"/./"[e](t)}catch{}}return!1},LX=R("".indexOf);OX({target:"String",proto:!0,forced:!kX("includes")},{includes:function(e){return!!~LX(j2(DX(this)),j2(PX(e)),arguments.length>1?arguments[1]:void 0)}});var MX=Qi("String","includes"),U2=N,jX=_X,UX=MX,tx=Array.prototype,nx=String.prototype,VX=function(e){var t=e.includes;return e===tx||U2(tx,e)&&t===tx.includes?jX:typeof e=="string"||e===nx||U2(nx,e)&&t===nx.includes?UX:t},fe=h(VX),FX=pt,BX=Xa,$X=Jt,WX=vl,V2=TypeError,F2="Reduce of empty array with no initial value",B2=function(e){return function(t,n,i,o){var l=BX(t),u=$X(l),p=WX(l);if(FX(n),p===0&&i<2)throw new V2(F2);var m=e?p-1:0,g=e?-1:1;if(i<2)for(;;){if(m in u){o=u[m],m+=g;break}if(m+=g,e?m<0:p<=m)throw new V2(F2)}for(;e?m>=0:p>m;m+=g)m in u&&(o=n(o,u[m],m,l));return o}},GX={left:B2(!1),right:B2(!0)},HX=f,p_=function(e,t){var n=[][e];return!!n&&HX(function(){n.call(null,t||function(){return 1},1)})},ef=j,KX=yr,zX=se,m_=function(e){return KX.slice(0,e.length)===e},rx=m_("Bun/")?"BUN":m_("Cloudflare-Workers")?"CLOUDFLARE":m_("Deno/")?"DENO":m_("Node.js/")?"NODE":ef.Bun&&typeof Bun.version=="string"?"BUN":ef.Deno&&typeof Deno.version=="object"?"DENO":zX(ef.process)==="process"?"NODE":ef.window&&ef.document?"BROWSER":"REST",f_=rx==="NODE",YX=GX.left;Qt({target:"Array",proto:!0,forced:!f_&&os>79&&os<83||!p_("reduce")},{reduce:function(e){var t=arguments.length;return YX(this,e,t,t>1?arguments[1]:void 0)}});var qX=Qi("Array","reduce"),XX=N,JX=qX,sx=Array.prototype,QX=function(e){var t=e.reduce;return e===sx||XX(sx,e)&&t===sx.reduce?JX:t},$2=QX,Zi=h($2),ZX=se,tf=Array.isArray||function(e){return ZX(e)==="Array"},eJ=Qt,tJ=tf,nJ=R([].reverse),W2=[1,2];eJ({target:"Array",proto:!0,forced:String(W2)===String(W2.reverse())},{reverse:function(){return tJ(this)&&(this.length=this.length),nJ(this)}});var rJ=Qi("Array","reverse"),sJ=N,iJ=rJ,ix=Array.prototype,oJ=function(e){var t=e.reverse;return e===ix||sJ(ix,e)&&t===ix.reverse?iJ:t},G2=oJ,H2=h(G2),aJ=BS,K2=Sh("keys"),g_=function(e){return K2[e]||(K2[e]=aJ(e))},cJ=!f(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),lJ=cs,dJ=Ce,uJ=Xa,hJ=cJ,z2=g_("IE_PROTO"),ox=Object,pJ=ox.prototype,ax=hJ?ox.getPrototypeOf:function(e){var t=uJ(e);if(lJ(t,z2))return t[z2];var n=t.constructor;return dJ(n)&&t instanceof n?n.prototype:t instanceof ox?pJ:null},mJ=R,fJ=pt,gJ=ln,_J=function(e){return gJ(e)||e===null},yJ=String,EJ=TypeError,vJ=function(e,t,n){try{return mJ(fJ(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},bJ=ln,SJ=ht,xJ=function(e){if(_J(e))return e;throw new EJ("Can't set "+yJ(e)+" as a prototype")},wJ=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=vJ(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,o){return SJ(i),xJ(o),bJ(i)&&(t?e(i,o):i.__proto__=o),i}}():void 0),__={},y_={},cx=cs,TJ=Mn,CJ=QS.indexOf,RJ=y_,Y2=R([].push),q2=function(e,t){var n,i=TJ(e),o=0,l=[];for(n in i)!cx(RJ,n)&&cx(i,n)&&Y2(l,n);for(;t.length>o;)cx(i,n=t[o++])&&(~CJ(l,n)||Y2(l,n));return l},lx=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],NJ=q2,AJ=lx.concat("length","prototype");__.f=Object.getOwnPropertyNames||function(e){return NJ(e,AJ)};var nf={};nf.f=Object.getOwnPropertySymbols;var IJ=Jn,OJ=__,PJ=nf,DJ=pi,kJ=R([].concat),LJ=IJ("Reflect","ownKeys")||function(e){var t=OJ.f(DJ(e)),n=PJ.f;return n?kJ(t,n(e)):t},X2=cs,MJ=LJ,jJ=tt,UJ=To,dx={},VJ=q2,FJ=lx,E_=Object.keys||function(e){return VJ(e,FJ)},BJ=Se,$J=O2,WJ=To,GJ=pi,HJ=Mn,KJ=E_;dx.f=BJ&&!$J?Object.defineProperties:function(e,t){GJ(e);for(var n,i=HJ(t),o=KJ(t),l=o.length,u=0;l>u;)WJ.f(e,n=o[u++],i[n]);return e};var v_,J2=Jn("document","documentElement"),zJ=pi,YJ=dx,Q2=lx,qJ=y_,XJ=J2,JJ=HS,ux="prototype",hx="script",Z2=g_("IE_PROTO"),px=function(){},eP=function(e){return"<"+hx+">"+e+"</"+hx+">"},tP=function(e){e.write(eP("")),e.close();var t=e.parentWindow.Object;return e=null,t},b_=function(){try{v_=new ActiveXObject("htmlfile")}catch{}var e,t,n;b_=typeof document<"u"?document.domain&&v_?tP(v_):(t=JJ("iframe"),n="java"+hx+":",t.style.display="none",XJ.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(eP("document.F=Object")),e.close(),e.F):tP(v_);for(var i=Q2.length;i--;)delete b_[ux][Q2[i]];return b_()};qJ[Z2]=!0;var rf=Object.create||function(e,t){var n;return e!==null?(px[ux]=zJ(e),n=new px,px[ux]=null,n[Z2]=e):n=b_(),t===void 0?n:YJ.f(n,t)},QJ=ln,ZJ=Ud,nP=Error,eQ=R("".replace),tQ=String(new nP("zxcasd").stack),rP=/\n\s*at [^:]*:[^\n]*/,nQ=rP.test(tQ),rQ=bt,sQ=!f(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",rQ(1,7)),e.stack!==7)}),iQ=Ud,oQ=function(e,t){if(nQ&&typeof e=="string"&&!nP.prepareStackTrace)for(;t--;)e=eQ(e,rP,"");return e},aQ=sQ,sP=Error.captureStackTrace,Ch={},cQ=Ch,lQ=or("iterator"),dQ=Array.prototype,iP=function(e){return e!==void 0&&(cQ.Array===e||dQ[lQ]===e)},uQ=bl,oP=nn,hQ=Dt,pQ=Ch,mQ=or("iterator"),S_=function(e){if(!hQ(e))return oP(e,mQ)||oP(e,"@@iterator")||pQ[uQ(e)]},fQ=Re,gQ=pt,_Q=pi,yQ=ae,EQ=S_,vQ=TypeError,mx=function(e,t){var n=arguments.length<2?EQ(e):t;if(gQ(n))return _Q(fQ(n,e));throw new vQ(yQ(e)+" is not iterable")},bQ=Re,aP=pi,SQ=nn,cP=function(e,t,n){var i,o;aP(e);try{if(!(i=SQ(e,"return"))){if(t==="throw")throw n;return n}i=bQ(i,e)}catch(l){o=!0,i=l}if(t==="throw")throw n;if(o)throw i;return aP(i),n},xQ=El,wQ=Re,TQ=pi,CQ=ae,RQ=iP,NQ=vl,lP=N,AQ=mx,IQ=S_,dP=cP,OQ=TypeError,x_=function(e,t){this.stopped=e,this.result=t},uP=x_.prototype,sf=function(e,t,n){var i,o,l,u,p,m,g,y=n&&n.that,b=!(!n||!n.AS_ENTRIES),S=!(!n||!n.IS_RECORD),w=!(!n||!n.IS_ITERATOR),k=!(!n||!n.INTERRUPTED),I=xQ(t,y),O=function(H){return i&&dP(i,"normal"),new x_(!0,H)},W=function(H){return b?(TQ(H),k?I(H[0],H[1],O):I(H[0],H[1])):k?I(H,O):I(H)};if(S)i=e.iterator;else if(w)i=e;else{if(!(o=IQ(e)))throw new OQ(CQ(e)+" is not iterable");if(RQ(o)){for(l=0,u=NQ(e);u>l;l++)if((p=W(e[l]))&&lP(uP,p))return p;return new x_(!1)}i=AQ(e,o)}for(m=S?e.next:i.next;!(g=wQ(m,i)).done;){try{p=W(g.value)}catch(H){dP(i,"throw",H)}if(typeof p=="object"&&p&&lP(uP,p))return p}return new x_(!1)},PQ=mi,DQ=Qt,kQ=N,LQ=ax,w_=wJ,MQ=function(e,t,n){for(var i=MJ(t),o=UJ.f,l=jJ.f,u=0;u<i.length;u++){var p=i[u];X2(e,p)||n&&X2(n,p)||o(e,p,l(t,p))}},hP=rf,fx=Ud,gx=bt,jQ=function(e,t){QJ(t)&&"cause"in t&&ZJ(e,"cause",t.cause)},UQ=function(e,t,n,i){aQ&&(sP?sP(e,t):iQ(e,"stack",oQ(n,i)))},VQ=sf,FQ=function(e,t){return e===void 0?arguments.length<2?"":t:PQ(e)},BQ=or("toStringTag"),T_=Error,$Q=[].push,Rh=function(e,t){var n,i=kQ(_x,this);w_?n=w_(new T_,i?LQ(this):_x):(n=i?this:hP(_x),fx(n,BQ,"Error")),t!==void 0&&fx(n,"message",FQ(t)),UQ(n,Rh,n.stack,1),arguments.length>2&&jQ(n,arguments[2]);var o=[];return VQ(e,$Q,{that:o}),fx(n,"errors",o),n};w_?w_(Rh,T_):MQ(Rh,T_,{name:!0});var _x=Rh.prototype=hP(T_.prototype,{constructor:gx(1,Rh),message:gx(1,""),name:gx(1,"AggregateError")});DQ({global:!0,constructor:!0,arity:2},{AggregateError:Rh});var C_,of,R_,WQ=Ce,pP=j.WeakMap,GQ=WQ(pP)&&/native code/.test(String(pP)),mP=j,HQ=ln,KQ=Ud,yx=cs,Ex=FS,zQ=g_,YQ=y_,fP="Object already initialized",vx=mP.TypeError,qQ=mP.WeakMap;if(GQ||Ex.state){var Ja=Ex.state||(Ex.state=new qQ);Ja.get=Ja.get,Ja.has=Ja.has,Ja.set=Ja.set,C_=function(e,t){if(Ja.has(e))throw new vx(fP);return t.facade=e,Ja.set(e,t),t},of=function(e){return Ja.get(e)||{}},R_=function(e){return Ja.has(e)}}else{var Nh=zQ("state");YQ[Nh]=!0,C_=function(e,t){if(yx(e,Nh))throw new vx(fP);return t.facade=e,KQ(e,Nh,t),t},of=function(e){return yx(e,Nh)?e[Nh]:{}},R_=function(e){return yx(e,Nh)}}var Vd,gP,_P,Fd={set:C_,get:of,has:R_,enforce:function(e){return R_(e)?of(e):C_(e,{})},getterFor:function(e){return function(t){var n;if(!HQ(t)||(n=of(t)).type!==e)throw new vx("Incompatible receiver, "+e+" required");return n}}},bx=Se,XQ=cs,yP=Function.prototype,JQ=bx&&Object.getOwnPropertyDescriptor,Sx=XQ(yP,"name"),EP={EXISTS:Sx,PROPER:Sx&&(function(){}).name==="something",CONFIGURABLE:Sx&&(!bx||bx&&JQ(yP,"name").configurable)},QQ=Ud,Sl=function(e,t,n,i){return i&&i.enumerable?e[t]=n:QQ(e,t,n),e},ZQ=f,eZ=Ce,tZ=ln,nZ=rf,vP=ax,rZ=Sl,xx=or("iterator"),bP=!1;[].keys&&("next"in(_P=[].keys())?(gP=vP(vP(_P)))!==Object.prototype&&(Vd=gP):bP=!0);var sZ=!tZ(Vd)||ZQ(function(){var e={};return Vd[xx].call(e)!==e});eZ((Vd=sZ?{}:nZ(Vd))[xx])||rZ(Vd,xx,function(){return this});var SP={IteratorPrototype:Vd,BUGGY_SAFARI_ITERATORS:bP},iZ=bl,oZ=ex?{}.toString:function(){return"[object "+iZ(this)+"]"},aZ=ex,cZ=To.f,lZ=Ud,dZ=cs,uZ=oZ,xP=or("toStringTag"),Uc=function(e,t,n,i){var o=n?e:e&&e.prototype;o&&(dZ(o,xP)||cZ(o,xP,{configurable:!0,value:t}),i&&!aZ&&lZ(o,"toString",uZ))},hZ=SP.IteratorPrototype,pZ=rf,mZ=bt,fZ=Uc,gZ=Ch,_Z=function(){return this},wx=function(e,t,n,i){var o=t+" Iterator";return e.prototype=pZ(hZ,{next:mZ(+!i,n)}),fZ(e,o,!1,!0),gZ[o]=_Z,e},yZ=Qt,EZ=Re,vZ=EP,bZ=wx,SZ=ax,xZ=Uc,wP=Sl,TP=Ch,wZ=SP,TZ=vZ.PROPER,N_=wZ.BUGGY_SAFARI_ITERATORS,Tx=or("iterator"),CP="keys",A_="values",RP="entries",CZ=function(){return this},NP=function(e,t,n,i,o,l,u){bZ(n,t,i);var p,m,g,y=function(W){if(W===o&&I)return I;if(!N_&&W&&W in w)return w[W];switch(W){case CP:case A_:case RP:return function(){return new n(this,W)}}return function(){return new n(this)}},b=t+" Iterator",S=!1,w=e.prototype,k=w[Tx]||w["@@iterator"]||o&&w[o],I=!N_&&k||y(o),O=t==="Array"&&w.entries||k;if(O&&(p=SZ(O.call(new e)))!==Object.prototype&&p.next&&(xZ(p,b,!0,!0),TP[b]=CZ),TZ&&o===A_&&k&&k.name!==A_&&(S=!0,I=function(){return EZ(k,this)}),o)if(m={values:y(A_),keys:l?I:y(CP),entries:y(RP)},u)for(g in m)(N_||S||!(g in w))&&wP(w,g,m[g]);else yZ({target:t,proto:!0,forced:N_||S},m);return u&&w[Tx]!==I&&wP(w,Tx,I,{name:o}),TP[t]=I,m},I_=function(e,t){return{value:e,done:t}},RZ=Mn,AP=Ch,IP=Fd;To.f;var NZ=NP,O_=I_,OP="Array Iterator",AZ=IP.set,IZ=IP.getterFor(OP);NZ(Array,"Array",function(e,t){AZ(this,{type:OP,target:RZ(e),index:0,kind:t})},function(){var e=IZ(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,O_(void 0,!0);switch(e.kind){case"keys":return O_(n,!1);case"values":return O_(t[n],!1)}return O_([n,t[n]],!1)},"values"),AP.Arguments=AP.Array;var OZ=To,P_=function(e,t,n){return OZ.f(e,t,n)},PZ=Jn,DZ=P_,kZ=Se,PP=or("species"),LZ=N,MZ=TypeError,Cx=function(e,t){if(LZ(t,e))return e;throw new MZ("Incorrect invocation")},jZ=Ce,Rx=FS,UZ=R(Function.toString);jZ(Rx.inspectSource)||(Rx.inspectSource=function(e){return UZ(e)});var DP=Rx.inspectSource,VZ=R,FZ=f,kP=Ce,BZ=bl,$Z=DP,LP=function(){},MP=Jn("Reflect","construct"),Nx=/^\s*(?:class|function)\b/,WZ=VZ(Nx.exec),GZ=!Nx.test(LP),af=function(e){if(!kP(e))return!1;try{return MP(LP,[],e),!0}catch{return!1}},jP=function(e){if(!kP(e))return!1;switch(BZ(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return GZ||!!WZ(Nx,$Z(e))}catch{return!0}};jP.sham=!0;var cf,Ah,UP,Ax,D_=!MP||FZ(function(){var e;return af(af.call)||!af(Object)||!af(function(){e=!0})||e})?jP:af,HZ=D_,KZ=ae,zZ=TypeError,VP=pi,YZ=function(e){if(HZ(e))return e;throw new zZ(KZ(e)+" is not a constructor")},qZ=Dt,XZ=or("species"),Ix=function(e,t){var n,i=VP(e).constructor;return i===void 0||qZ(n=VP(i)[XZ])?t:YZ(n)},xl=R([].slice),JZ=TypeError,Bd=function(e,t){if(e<t)throw new JZ("Not enough arguments");return e},FP=/(?:ipad|iphone|ipod).*applewebkit/i.test(yr),eo=j,QZ=B,ZZ=El,BP=Ce,eee=cs,$P=f,WP=J2,tee=xl,GP=HS,nee=Bd,ree=FP,see=f_,Ox=eo.setImmediate,Px=eo.clearImmediate,iee=eo.process,Dx=eo.Dispatch,oee=eo.Function,HP=eo.MessageChannel,aee=eo.String,kx=0,lf={},KP="onreadystatechange";$P(function(){cf=eo.location});var Lx=function(e){if(eee(lf,e)){var t=lf[e];delete lf[e],t()}},Mx=function(e){return function(){Lx(e)}},zP=function(e){Lx(e.data)},YP=function(e){eo.postMessage(aee(e),cf.protocol+"//"+cf.host)};Ox&&Px||(Ox=function(e){nee(arguments.length,1);var t=BP(e)?e:oee(e),n=tee(arguments,1);return lf[++kx]=function(){QZ(t,void 0,n)},Ah(kx),kx},Px=function(e){delete lf[e]},see?Ah=function(e){iee.nextTick(Mx(e))}:Dx&&Dx.now?Ah=function(e){Dx.now(Mx(e))}:HP&&!ree?(Ax=(UP=new HP).port2,UP.port1.onmessage=zP,Ah=ZZ(Ax.postMessage,Ax)):eo.addEventListener&&BP(eo.postMessage)&&!eo.importScripts&&cf&&cf.protocol!=="file:"&&!$P(YP)?(Ah=YP,eo.addEventListener("message",zP,!1)):Ah=KP in GP("script")?function(e){WP.appendChild(GP("script"))[KP]=function(){WP.removeChild(this),Lx(e)}}:function(e){setTimeout(Mx(e),0)});var k_={set:Ox,clear:Px},qP=j,cee=Se,lee=Object.getOwnPropertyDescriptor,XP=function(e){if(!cee)return qP[e];var t=lee(qP,e);return t&&t.value},JP=function(){this.head=null,this.tail=null};JP.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Ih,jx,Ux,Vx,QP,ZP=JP,dee=/ipad|iphone|ipod/i.test(yr)&&typeof Pebble<"u",uee=/web0s(?!.*chrome)/i.test(yr),Oh=j,hee=XP,eD=El,Fx=k_.set,pee=ZP,mee=FP,fee=dee,gee=uee,Bx=f_,tD=Oh.MutationObserver||Oh.WebKitMutationObserver,nD=Oh.document,rD=Oh.process,L_=Oh.Promise,$x=hee("queueMicrotask");if(!$x){var M_=new pee,j_=function(){var e,t;for(Bx&&(e=rD.domain)&&e.exit();t=M_.get();)try{t()}catch(n){throw M_.head&&Ih(),n}e&&e.enter()};mee||Bx||gee||!tD||!nD?!fee&&L_&&L_.resolve?((Vx=L_.resolve(void 0)).constructor=L_,QP=eD(Vx.then,Vx),Ih=function(){QP(j_)}):Bx?Ih=function(){rD.nextTick(j_)}:(Fx=eD(Fx,Oh),Ih=function(){Fx(j_)}):(jx=!0,Ux=nD.createTextNode(""),new tD(j_).observe(Ux,{characterData:!0}),Ih=function(){Ux.data=jx=!jx}),$x=function(e){M_.head||Ih(),M_.add(e)}}var sD=$x,Ph=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},$d=j.Promise,_ee=j,df=$d,yee=Ce,Eee=I2,vee=DP,bee=or,iD=rx,Wx=os,oD=df&&df.prototype,See=bee("species"),aD=!1,cD=yee(_ee.PromiseRejectionEvent),xee=Eee("Promise",function(){var e=vee(df),t=e!==String(df);if(!t&&Wx===66||!oD.catch||!oD.finally)return!0;if(!Wx||Wx<51||!/native code/.test(e)){var n=new df(function(o){o(1)}),i=function(o){o(function(){},function(){})};if((n.constructor={})[See]=i,!(aD=n.then(function(){})instanceof i))return!0}return!(t||iD!=="BROWSER"&&iD!=="DENO"||cD)}),uf={CONSTRUCTOR:xee,REJECTION_EVENT:cD,SUBCLASSING:aD},Qa={},lD=pt,wee=TypeError,Tee=function(e){var t,n;this.promise=new e(function(i,o){if(t!==void 0||n!==void 0)throw new wee("Bad Promise constructor");t=i,n=o}),this.resolve=lD(t),this.reject=lD(n)};Qa.f=function(e){return new Tee(e)};var Gx,dD,uD,Cee=Qt,U_=f_,wl=j,Ree=vn,hf=Re,Nee=Sl,Aee=Uc,Iee=function(e){var t=PZ(e);kZ&&t&&!t[PP]&&DZ(t,PP,{configurable:!0,get:function(){return this}})},Oee=pt,Hx=Ce,Pee=ln,Dee=Cx,kee=Ix,hD=k_.set,Kx=sD,Lee=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},Mee=Ph,jee=ZP,pD=Fd,zx=$d,mD=uf,fD=Qa,V_="Promise",gD=mD.CONSTRUCTOR,Uee=mD.REJECTION_EVENT,Yx=pD.getterFor(V_),Vee=pD.set,Fee=zx&&zx.prototype,pf=zx,qx=Fee,_D=wl.TypeError,Xx=wl.document,Jx=wl.process,Qx=fD.f,Bee=Qx,$ee=!!(Xx&&Xx.createEvent&&wl.dispatchEvent),yD="unhandledrejection",ED=function(e){var t;return!(!Pee(e)||!Hx(t=e.then))&&t},vD=function(e,t){var n,i,o,l=t.value,u=t.state===1,p=u?e.ok:e.fail,m=e.resolve,g=e.reject,y=e.domain;try{p?(u||(t.rejection===2&&Gee(t),t.rejection=1),p===!0?n=l:(y&&y.enter(),n=p(l),y&&(y.exit(),o=!0)),n===e.promise?g(new _D("Promise-chain cycle")):(i=ED(n))?hf(i,n,m,g):m(n)):g(l)}catch(b){y&&!o&&y.exit(),g(b)}},bD=function(e,t){e.notified||(e.notified=!0,Kx(function(){for(var n,i=e.reactions;n=i.get();)vD(n,e);e.notified=!1,t&&!e.rejection&&Wee(e)}))},SD=function(e,t,n){var i,o;$ee?((i=Xx.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),wl.dispatchEvent(i)):i={promise:t,reason:n},!Uee&&(o=wl["on"+e])?o(i):e===yD&&Lee("Unhandled promise rejection",n)},Wee=function(e){hf(hD,wl,function(){var t,n=e.facade,i=e.value;if(xD(e)&&(t=Mee(function(){U_?Jx.emit("unhandledRejection",i,n):SD(yD,n,i)}),e.rejection=U_||xD(e)?2:1,t.error))throw t.value})},xD=function(e){return e.rejection!==1&&!e.parent},Gee=function(e){hf(hD,wl,function(){var t=e.facade;U_?Jx.emit("rejectionHandled",t):SD("rejectionhandled",t,e.value)})},Dh=function(e,t,n){return function(i){e(t,i,n)}},kh=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,bD(e,!0))},Zx=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new _D("Promise can't be resolved itself");var i=ED(t);i?Kx(function(){var o={done:!1};try{hf(i,t,Dh(Zx,o,e),Dh(kh,o,e))}catch(l){kh(o,l,e)}}):(e.value=t,e.state=1,bD(e,!1))}catch(o){kh({done:!1},o,e)}}};gD&&(qx=(pf=function(e){Dee(this,qx),Oee(e),hf(Gx,this);var t=Yx(this);try{e(Dh(Zx,t),Dh(kh,t))}catch(n){kh(t,n)}}).prototype,(Gx=function(e){Vee(this,{type:V_,done:!1,notified:!1,parent:!1,reactions:new jee,rejection:!1,state:0,value:null})}).prototype=Nee(qx,"then",function(e,t){var n=Yx(this),i=Qx(kee(this,pf));return n.parent=!0,i.ok=!Hx(e)||e,i.fail=Hx(t)&&t,i.domain=U_?Jx.domain:void 0,n.state===0?n.reactions.add(i):Kx(function(){vD(i,n)}),i.promise}),dD=function(){var e=new Gx,t=Yx(e);this.promise=e,this.resolve=Dh(Zx,t),this.reject=Dh(kh,t)},fD.f=Qx=function(e){return e===pf||e===uD?new dD(e):Bee(e)}),Cee({global:!0,constructor:!0,wrap:!0,forced:gD},{Promise:pf}),uD=Ree.Promise,Aee(pf,V_,!1,!0),Iee(V_);var wD=or("iterator"),TD=!1;try{var Hee=0,CD={next:function(){return{done:!!Hee++}},return:function(){TD=!0}};CD[wD]=function(){return this},Array.from(CD,function(){throw 2})}catch{}var Kee=$d,zee=function(e,t){try{if(!t&&!TD)return!1}catch{return!1}var n=!1;try{var i={};i[wD]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch{}return n},F_=uf.CONSTRUCTOR||!zee(function(e){Kee.all(e).then(void 0,function(){})}),Yee=Re,qee=pt,Xee=Qa,Jee=Ph,Qee=sf;Qt({target:"Promise",stat:!0,forced:F_},{all:function(e){var t=this,n=Xee.f(t),i=n.resolve,o=n.reject,l=Jee(function(){var u=qee(t.resolve),p=[],m=0,g=1;Qee(e,function(y){var b=m++,S=!1;g++,Yee(u,t,y).then(function(w){S||(S=!0,p[b]=w,--g||i(p))},o)}),--g||i(p)});return l.error&&o(l.value),n.promise}});var Zee=Qt,ete=uf.CONSTRUCTOR;$d&&$d.prototype,Zee({target:"Promise",proto:!0,forced:ete,real:!0},{catch:function(e){return this.then(void 0,e)}});var tte=Re,nte=pt,rte=Qa,ste=Ph,ite=sf;Qt({target:"Promise",stat:!0,forced:F_},{race:function(e){var t=this,n=rte.f(t),i=n.reject,o=ste(function(){var l=nte(t.resolve);ite(e,function(u){tte(l,t,u).then(n.resolve,i)})});return o.error&&i(o.value),n.promise}});var ote=Qa;Qt({target:"Promise",stat:!0,forced:uf.CONSTRUCTOR},{reject:function(e){var t=ote.f(this);return(0,t.reject)(e),t.promise}});var ate=pi,cte=ln,lte=Qa,RD=function(e,t){if(ate(e),cte(t)&&t.constructor===e)return t;var n=lte.f(e);return(0,n.resolve)(t),n.promise},dte=Qt,ute=$d,hte=uf.CONSTRUCTOR,pte=RD,mte=Jn("Promise"),fte=!hte;dte({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return pte(fte&&this===mte?ute:this,e)}});var gte=Re,_te=pt,yte=Qa,Ete=Ph,vte=sf;Qt({target:"Promise",stat:!0,forced:F_},{allSettled:function(e){var t=this,n=yte.f(t),i=n.resolve,o=n.reject,l=Ete(function(){var u=_te(t.resolve),p=[],m=0,g=1;vte(e,function(y){var b=m++,S=!1;g++,gte(u,t,y).then(function(w){S||(S=!0,p[b]={status:"fulfilled",value:w},--g||i(p))},function(w){S||(S=!0,p[b]={status:"rejected",reason:w},--g||i(p))})}),--g||i(p)});return l.error&&o(l.value),n.promise}});var bte=Re,Ste=pt,xte=Jn,wte=Qa,Tte=Ph,Cte=sf,ND="No one promise resolved";Qt({target:"Promise",stat:!0,forced:F_},{any:function(e){var t=this,n=xte("AggregateError"),i=wte.f(t),o=i.resolve,l=i.reject,u=Tte(function(){var p=Ste(t.resolve),m=[],g=0,y=1,b=!1;Cte(e,function(S){var w=g++,k=!1;y++,bte(p,t,S).then(function(I){k||b||(b=!0,o(I))},function(I){k||b||(k=!0,m[w]=I,--y||l(new n(m,ND)))})}),--y||l(new n(m,ND))});return u.error&&l(u.value),i.promise}});var Rte=Qt,Nte=B,Ate=xl,Ite=Qa,Ote=pt,AD=Ph,ew=j.Promise,ID=!1;Rte({target:"Promise",stat:!0,forced:!ew||!ew.try||AD(function(){ew.try(function(e){ID=e===8},8)}).error||!ID},{try:function(e){var t=arguments.length>1?Ate(arguments,1):[],n=Ite.f(this),i=AD(function(){return Nte(Ote(e),void 0,t)});return(i.error?n.reject:n.resolve)(i.value),n.promise}});var Pte=Qa;Qt({target:"Promise",stat:!0},{withResolvers:function(){var e=Pte.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var Dte=Qt,tw=$d,kte=f,Lte=Jn,Mte=Ce,jte=Ix,OD=RD,Ute=tw&&tw.prototype;Dte({target:"Promise",proto:!0,real:!0,forced:!!tw&&kte(function(){Ute.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=jte(this,Lte("Promise")),n=Mte(e);return this.then(n?function(i){return OD(t,e()).then(function(){return i})}:e,n?function(i){return OD(t,e()).then(function(){throw i})}:e)}});var nw=R,Vte=XS,Fte=mi,Bte=ht,$te=nw("".charAt),PD=nw("".charCodeAt),Wte=nw("".slice),DD=function(e){return function(t,n){var i,o,l=Fte(Bte(t)),u=Vte(n),p=l.length;return u<0||u>=p?e?"":void 0:(i=PD(l,u))<55296||i>56319||u+1===p||(o=PD(l,u+1))<56320||o>57343?e?$te(l,u):i:e?Wte(l,u,u+2):o-56320+(i-55296<<10)+65536}},rw={codeAt:DD(!1),charAt:DD(!0)},Gte=rw.charAt,Hte=mi,kD=Fd,Kte=NP,LD=I_,MD="String Iterator",zte=kD.set,Yte=kD.getterFor(MD);Kte(String,"String",function(e){zte(this,{type:MD,string:Hte(e),index:0})},function(){var e,t=Yte(this),n=t.string,i=t.index;return i>=n.length?LD(void 0,!0):(e=Gte(n,i),t.index+=e.length,LD(e,!1))});var qte=vn.Promise,Xte={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jte=j,Qte=Uc,jD=Ch;for(var sw in Xte)Qte(Jte[sw],sw),jD[sw]=jD.Array;var UD=qte,xe=h(UD),Zte=Qi("Array","values"),ene=bl,tne=cs,nne=N,rne=Zte,iw=Array.prototype,sne={DOMTokenList:!0,NodeList:!0},ine=function(e){var t=e.values;return e===iw||nne(iw,e)&&t===iw.values||tne(sne,ene(e))?rne:t},fi=h(ine),VD=ae,one=TypeError,FD=xl,ane=Math.floor,ow=function(e,t){var n=e.length;if(n<8)for(var i,o,l=1;l<n;){for(o=l,i=e[l];o&&t(e[o-1],i)>0;)e[o]=e[--o];o!==l++&&(e[o]=i)}else for(var u=ane(n/2),p=ow(FD(e,0,u),t),m=ow(FD(e,u),t),g=p.length,y=m.length,b=0,S=0;b<g||S<y;)e[b+S]=b<g&&S<y?t(p[b],m[S])<=0?p[b++]:m[S++]:b<g?p[b++]:m[S++];return e},BD=ow,$D=yr.match(/firefox\/(\d+)/i),cne=!!$D&&+$D[1],lne=/MSIE|Trident/.test(yr),WD=yr.match(/AppleWebKit\/(\d+)\./),dne=!!WD&&+WD[1],une=Qt,GD=R,hne=pt,pne=Xa,HD=vl,mne=function(e,t){if(!delete e[t])throw new one("Cannot delete property "+VD(t)+" of "+VD(e))},KD=mi,aw=f,fne=BD,gne=p_,zD=cne,_ne=lne,YD=os,qD=dne,Tl=[],XD=GD(Tl.sort),yne=GD(Tl.push),Ene=aw(function(){Tl.sort(void 0)}),vne=aw(function(){Tl.sort(null)}),bne=gne("sort"),JD=!aw(function(){if(YD)return YD<70;if(!(zD&&zD>3)){if(_ne)return!0;if(qD)return qD<603;var e,t,n,i,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)Tl.push({k:t+i,v:n})}for(Tl.sort(function(l,u){return u.v-l.v}),i=0;i<Tl.length;i++)t=Tl[i].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return o!=="DGBEFHACIJK"}});une({target:"Array",proto:!0,forced:Ene||!vne||!bne||!JD},{sort:function(e){e!==void 0&&hne(e);var t=pne(this);if(JD)return e===void 0?XD(t):XD(t,e);var n,i,o=[],l=HD(t);for(i=0;i<l;i++)i in t&&yne(o,t[i]);for(fne(o,function(u){return function(p,m){return m===void 0?-1:p===void 0?1:u!==void 0?+u(p,m)||0:KD(p)>KD(m)?1:-1}}(e)),n=HD(o),i=0;i<n;)t[i]=o[i++];for(;i<l;)mne(t,i++);return t}});var Sne=Qi("Array","sort"),xne=N,wne=Sne,cw=Array.prototype,Tne=function(e){var t=e.sort;return e===cw||xne(cw,e)&&t===cw.sort?wne:t},Wd=h(Tne),Cne=Qt,Rne=R,Nne=JS,Ane=RangeError,QD=String.fromCharCode,ZD=String.fromCodePoint,Ine=Rne([].join);Cne({target:"String",stat:!0,arity:1,forced:!!ZD&&ZD.length!==1},{fromCodePoint:function(e){for(var t,n=[],i=arguments.length,o=0;i>o;){if(t=+arguments[o++],Nne(t,1114111)!==t)throw new Ane(t+" is not a valid code point");n[o]=t<65536?QD(t):QD(55296+((t-=65536)>>10),t%1024+56320)}return Ine(n,"")}});var One=f,Pne=or("iterator"),B_=!One(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return e.pathname="c%20d",t.forEach(function(o,l){t.delete("b"),i+=l+o}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[Pne]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||i!=="a1c3"||new URL("https://x",void 0).host!=="x"}),Dne=Sl,lw=Qt,ek=j,dw=XP,kne=Jn,$_=Re,oa=R,mf=Se,tk=B_,nk=Sl,Lne=P_,Mne=function(e,t,n){for(var i in t)n&&n.unsafe&&e[i]?e[i]=t[i]:Dne(e,i,t[i],n);return e},jne=Uc,Une=wx,uw=Fd,rk=Cx,hw=Ce,Vne=cs,Fne=El,Bne=bl,$ne=pi,sk=ln,gi=mi,Wne=rf,ik=bt,ok=mx,Gne=S_,W_=I_,Lh=Bd,Hne=BD,Kne=or("iterator"),Mh="URLSearchParams",ak=Mh+"Iterator",ck=uw.set,Co=uw.getterFor(Mh),zne=uw.getterFor(ak),lk=dw("fetch"),G_=dw("Request"),ff=dw("Headers"),pw=G_&&G_.prototype,dk=ff&&ff.prototype,Yne=ek.TypeError,qne=ek.encodeURIComponent,Xne=String.fromCharCode,Jne=kne("String","fromCodePoint"),Qne=parseInt,H_=oa("".charAt),uk=oa([].join),Cl=oa([].push),hk=oa("".replace),Zne=oa([].shift),pk=oa([].splice),mk=oa("".split),fk=oa("".slice),ere=oa(/./.exec),tre=/\+/g,nre=/^[0-9a-f]+$/i,gk=function(e,t){var n=fk(e,t,t+2);return ere(nre,n)?Qne(n,16):NaN},rre=function(e){for(var t=0,n=128;n>0&&e&n;n>>=1)t++;return t},sre=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},_k=function(e){for(var t=(e=hk(e,tre," ")).length,n="",i=0;i<t;){var o=H_(e,i);if(o==="%"){if(H_(e,i+1)==="%"||i+3>t){n+="%",i++;continue}var l=gk(e,i+1);if(l!=l){n+=o,i++;continue}i+=2;var u=rre(l);if(u===0)o=Xne(l);else{if(u===1||u>4){n+="",i++;continue}for(var p=[l],m=1;m<u&&!(++i+3>t||H_(e,i)!=="%");){var g=gk(e,i+1);if(g!=g){i+=3;break}if(g>191||g<128)break;Cl(p,g),i+=2,m++}if(p.length!==u){n+="";continue}var y=sre(p);y===null?n+="":o=Jne(y)}}n+=o,i++}return n},ire=/[!'()~]|%20/g,ore={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},are=function(e){return ore[e]},yk=function(e){return hk(qne(e),ire,are)},mw=Une(function(e,t){ck(this,{type:ak,target:Co(e).entries,index:0,kind:t})},Mh,function(){var e=zne(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,W_(void 0,!0);var i=t[n];switch(e.kind){case"keys":return W_(i.key,!1);case"values":return W_(i.value,!1)}return W_([i.key,i.value],!1)},!0),Ek=function(e){this.entries=[],this.url=null,e!==void 0&&(sk(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?H_(e,0)==="?"?fk(e,1):e:gi(e)))};Ek.prototype={type:Mh,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,i,o,l,u,p,m=this.entries,g=Gne(e);if(g)for(n=(t=ok(e,g)).next;!(i=$_(n,t)).done;){if(l=(o=ok($ne(i.value))).next,(u=$_(l,o)).done||(p=$_(l,o)).done||!$_(l,o).done)throw new Yne("Expected sequence with length 2");Cl(m,{key:gi(u.value),value:gi(p.value)})}else for(var y in e)Vne(e,y)&&Cl(m,{key:y,value:gi(e[y])})},parseQuery:function(e){if(e)for(var t,n,i=this.entries,o=mk(e,"&"),l=0;l<o.length;)(t=o[l++]).length&&(n=mk(t,"="),Cl(i,{key:_k(Zne(n)),value:_k(uk(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],i=0;i<t.length;)e=t[i++],Cl(n,yk(e.key)+"="+yk(e.value));return uk(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var K_=function(){rk(this,jh);var e=ck(this,new Ek(arguments.length>0?arguments[0]:void 0));mf||(this.size=e.entries.length)},jh=K_.prototype;if(Mne(jh,{append:function(e,t){var n=Co(this);Lh(arguments.length,2),Cl(n.entries,{key:gi(e),value:gi(t)}),mf||this.length++,n.updateURL()},delete:function(e){for(var t=Co(this),n=Lh(arguments.length,1),i=t.entries,o=gi(e),l=n<2?void 0:arguments[1],u=l===void 0?l:gi(l),p=0;p<i.length;){var m=i[p];if(m.key!==o||u!==void 0&&m.value!==u)p++;else if(pk(i,p,1),u!==void 0)break}mf||(this.size=i.length),t.updateURL()},get:function(e){var t=Co(this).entries;Lh(arguments.length,1);for(var n=gi(e),i=0;i<t.length;i++)if(t[i].key===n)return t[i].value;return null},getAll:function(e){var t=Co(this).entries;Lh(arguments.length,1);for(var n=gi(e),i=[],o=0;o<t.length;o++)t[o].key===n&&Cl(i,t[o].value);return i},has:function(e){for(var t=Co(this).entries,n=Lh(arguments.length,1),i=gi(e),o=n<2?void 0:arguments[1],l=o===void 0?o:gi(o),u=0;u<t.length;){var p=t[u++];if(p.key===i&&(l===void 0||p.value===l))return!0}return!1},set:function(e,t){var n=Co(this);Lh(arguments.length,1);for(var i,o=n.entries,l=!1,u=gi(e),p=gi(t),m=0;m<o.length;m++)(i=o[m]).key===u&&(l?pk(o,m--,1):(l=!0,i.value=p));l||Cl(o,{key:u,value:p}),mf||(this.size=o.length),n.updateURL()},sort:function(){var e=Co(this);Hne(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Co(this).entries,i=Fne(e,arguments.length>1?arguments[1]:void 0),o=0;o<n.length;)i((t=n[o++]).value,t.key,this)},keys:function(){return new mw(this,"keys")},values:function(){return new mw(this,"values")},entries:function(){return new mw(this,"entries")}},{enumerable:!0}),nk(jh,Kne,jh.entries,{name:"entries"}),nk(jh,"toString",function(){return Co(this).serialize()},{enumerable:!0}),mf&&Lne(jh,"size",{get:function(){return Co(this).entries.length},configurable:!0,enumerable:!0}),jne(K_,Mh),lw({global:!0,constructor:!0,forced:!tk},{URLSearchParams:K_}),!tk&&hw(ff)){var cre=oa(dk.has),lre=oa(dk.set),vk=function(e){if(sk(e)){var t,n=e.body;if(Bne(n)===Mh)return t=e.headers?new ff(e.headers):new ff,cre(t,"content-type")||lre(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Wne(e,{body:ik(0,gi(n)),headers:ik(0,t)})}return e};if(hw(lk)&&lw({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return lk(e,arguments.length>1?vk(arguments[1]):{})}}),hw(G_)){var fw=function(e){return rk(this,pw),new G_(e,arguments.length>1?vk(arguments[1]):{})};pw.constructor=fw,fw.prototype=pw,lw({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:fw})}}var Ro,dre={URLSearchParams:K_,getState:Co},ure=vn.URLSearchParams,bk=Se,hre=R,pre=Re,mre=f,gw=E_,fre=nf,gre=le,_re=Xa,yre=Jt,Uh=Object.assign,Sk=Object.defineProperty,Ere=hre([].concat),vre=!Uh||mre(function(){if(bk&&Uh({b:1},Uh(Sk({},"a",{enumerable:!0,get:function(){Sk(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach(function(o){t[o]=o}),Uh({},e)[n]!==7||gw(Uh({},t)).join("")!==i})?function(e,t){for(var n=_re(e),i=arguments.length,o=1,l=fre.f,u=gre.f;i>o;)for(var p,m=yre(arguments[o++]),g=l?Ere(gw(m),l(m)):gw(m),y=g.length,b=0;y>b;)p=g[b++],bk&&!pre(u,m,p)||(n[p]=m[p]);return n}:Uh,bre=pi,Sre=cP,xre=Se,wre=To,Tre=bt,_w=function(e,t,n){xre?wre.f(e,t,Tre(0,n)):e[t]=n},Cre=El,Rre=Re,Nre=Xa,Are=function(e,t,n,i){try{return i?t(bre(n)[0],n[1]):t(n)}catch(o){Sre(e,"throw",o)}},Ire=iP,Ore=D_,Pre=vl,xk=_w,Dre=mx,kre=S_,wk=Array,Gd=R,yw=2147483647,Lre=/[^\0-\u007E]/,Tk=/[.\u3002\uFF0E\uFF61]/g,Ck="Overflow: input needs wider integers to process",Rk=RangeError,Mre=Gd(Tk.exec),Vh=Math.floor,Ew=String.fromCharCode,Nk=Gd("".charCodeAt),Ak=Gd([].join),Rl=Gd([].push),jre=Gd("".replace),Ure=Gd("".split),Vre=Gd("".toLowerCase),Ik=function(e){return e+22+75*(e<26)},Fre=function(e,t,n){var i=0;for(e=n?Vh(e/700):e>>1,e+=Vh(e/t);e>455;)e=Vh(e/35),i+=36;return Vh(i+36*e/(e+38))},Bre=function(e){var t=[];e=function(W){for(var H=[],Y=0,Q=W.length;Y<Q;){var Z=Nk(W,Y++);if(Z>=55296&&Z<=56319&&Y<Q){var q=Nk(W,Y++);(64512&q)==56320?Rl(H,((1023&Z)<<10)+(1023&q)+65536):(Rl(H,Z),Y--)}else Rl(H,Z)}return H}(e);var n,i,o=e.length,l=128,u=0,p=72;for(n=0;n<e.length;n++)(i=e[n])<128&&Rl(t,Ew(i));var m=t.length,g=m;for(m&&Rl(t,"-");g<o;){var y=yw;for(n=0;n<e.length;n++)(i=e[n])>=l&&i<y&&(y=i);var b=g+1;if(y-l>Vh((yw-u)/b))throw new Rk(Ck);for(u+=(y-l)*b,l=y,n=0;n<e.length;n++){if((i=e[n])<l&&++u>yw)throw new Rk(Ck);if(i===l){for(var S=u,w=36;;){var k=w<=p?1:w>=p+26?26:w-p;if(S<k)break;var I=S-k,O=36-k;Rl(t,Ew(Ik(k+I%O))),S=Vh(I/O),w+=36}Rl(t,Ew(Ik(S))),p=Fre(u,b,g===m),u=0,g++}}u++,l++}return Ak(t,"")},$re=Qt,vw=Se,Wre=B_,bw=j,Ok=El,No=R,z_=Sl,Ao=P_,Gre=Cx,Sw=cs,xw=vre,Fh=function(e){var t=Nre(e),n=Ore(this),i=arguments.length,o=i>1?arguments[1]:void 0,l=o!==void 0;l&&(o=Cre(o,i>2?arguments[2]:void 0));var u,p,m,g,y,b,S=kre(t),w=0;if(!S||this===wk&&Ire(S))for(u=Pre(t),p=n?new this(u):wk(u);u>w;w++)b=l?o(t[w],w):t[w],xk(p,w,b);else for(p=n?new this:[],y=(g=Dre(t,S)).next;!(m=Rre(y,g)).done;w++)b=l?Are(g,o,[m.value,w],!0):m.value,xk(p,w,b);return p.length=w,p},aa=xl,Hre=rw.codeAt,Kre=function(e){var t,n,i=[],o=Ure(jre(Vre(e),Tk,"."),".");for(t=0;t<o.length;t++)n=o[t],Rl(i,Mre(Lre,n)?"xn--"+Bre(n):n);return Ak(i,".")},Vc=mi,zre=Uc,Yre=Bd,Pk=dre,Dk=Fd,qre=Dk.set,Y_=Dk.getterFor("URL"),Xre=Pk.URLSearchParams,Jre=Pk.getState,gf=bw.URL,ww=bw.TypeError,q_=bw.parseInt,Qre=Math.floor,kk=Math.pow,Io=No("".charAt),ca=No(/./.exec),_f=No([].join),Zre=No(1.1.toString),ese=No([].pop),Bh=No([].push),Tw=No("".replace),tse=No([].shift),nse=No("".split),yf=No("".slice),X_=No("".toLowerCase),rse=No([].unshift),Cw="Invalid scheme",Hd="Invalid host",Lk="Invalid port",Mk=/[a-z]/i,sse=/[\d+-.a-z]/i,Rw=/\d/,ise=/^0x/i,ose=/^[0-7]+$/,ase=/^\d+$/,jk=/^[\da-f]+$/i,cse=/[\0\t\n\r #%/:<>?@[\\\]^|]/,lse=/[\0\t\n\r #/:<>?@[\\\]^|]/,dse=/^[\u0000-\u0020]+/,use=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,hse=/[\t\n\r]/g,Ef=function(e){var t,n,i,o;if(typeof e=="number"){for(t=[],n=0;n<4;n++)rse(t,e%256),e=Qre(e/256);return _f(t,".")}if(typeof e=="object"){for(t="",i=function(l){for(var u=null,p=1,m=null,g=0,y=0;y<8;y++)l[y]!==0?(g>p&&(u=m,p=g),m=null,g=0):(m===null&&(m=y),++g);return g>p?m:u}(e),n=0;n<8;n++)o&&e[n]===0||(o&&(o=!1),i===n?(t+=n?":":"::",o=!0):(t+=Zre(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},J_={},Uk=xw({},J_,{" ":1,'"':1,"<":1,">":1,"`":1}),Vk=xw({},Uk,{"#":1,"?":1,"{":1,"}":1}),Nw=xw({},Vk,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Nl=function(e,t){var n=Hre(e,0);return n>32&&n<127&&!Sw(t,e)?e:encodeURIComponent(e)},Q_={ftp:21,file:null,http:80,https:443,ws:80,wss:443},vf=function(e,t){var n;return e.length===2&&ca(Mk,Io(e,0))&&((n=Io(e,1))===":"||!t&&n==="|")},Fk=function(e){var t;return e.length>1&&vf(yf(e,0,2))&&(e.length===2||(t=Io(e,2))==="/"||t==="\\"||t==="?"||t==="#")},pse=function(e){return e==="."||X_(e)==="%2e"},Aw={},Bk={},Iw={},$k={},Wk={},Ow={},Gk={},Hk={},Z_={},ey={},Pw={},Dw={},kw={},Lw={},Kk={},Mw={},$h={},Za={},zk={},Kd={},Fc={},jw=function(e,t,n){var i,o,l,u=Vc(e);if(t){if(o=this.parse(u))throw new ww(o);this.searchParams=null}else{if(n!==void 0&&(i=new jw(n,!0)),o=this.parse(u,null,i))throw new ww(o);(l=Jre(new Xre)).bindURL(this),this.searchParams=l}};jw.prototype={type:"URL",parse:function(e,t,n){var i,o,l,u,p,m=this,g=t||Aw,y=0,b="",S=!1,w=!1,k=!1;for(e=Vc(e),t||(m.scheme="",m.username="",m.password="",m.host=null,m.port=null,m.path=[],m.query=null,m.fragment=null,m.cannotBeABaseURL=!1,e=Tw(e,dse,""),e=Tw(e,use,"$1")),e=Tw(e,hse,""),i=Fh(e);y<=i.length;){switch(o=i[y],g){case Aw:if(!o||!ca(Mk,o)){if(t)return Cw;g=Iw;continue}b+=X_(o),g=Bk;break;case Bk:if(o&&(ca(sse,o)||o==="+"||o==="-"||o==="."))b+=X_(o);else{if(o!==":"){if(t)return Cw;b="",g=Iw,y=0;continue}if(t&&(m.isSpecial()!==Sw(Q_,b)||b==="file"&&(m.includesCredentials()||m.port!==null)||m.scheme==="file"&&!m.host))return;if(m.scheme=b,t)return void(m.isSpecial()&&Q_[m.scheme]===m.port&&(m.port=null));b="",m.scheme==="file"?g=Lw:m.isSpecial()&&n&&n.scheme===m.scheme?g=$k:m.isSpecial()?g=Hk:i[y+1]==="/"?(g=Wk,y++):(m.cannotBeABaseURL=!0,Bh(m.path,""),g=zk)}break;case Iw:if(!n||n.cannotBeABaseURL&&o!=="#")return Cw;if(n.cannotBeABaseURL&&o==="#"){m.scheme=n.scheme,m.path=aa(n.path),m.query=n.query,m.fragment="",m.cannotBeABaseURL=!0,g=Fc;break}g=n.scheme==="file"?Lw:Ow;continue;case $k:if(o!=="/"||i[y+1]!=="/"){g=Ow;continue}g=Z_,y++;break;case Wk:if(o==="/"){g=ey;break}g=Za;continue;case Ow:if(m.scheme=n.scheme,o===Ro)m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=aa(n.path),m.query=n.query;else if(o==="/"||o==="\\"&&m.isSpecial())g=Gk;else if(o==="?")m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=aa(n.path),m.query="",g=Kd;else{if(o!=="#"){m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=aa(n.path),m.path.length--,g=Za;continue}m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=aa(n.path),m.query=n.query,m.fragment="",g=Fc}break;case Gk:if(!m.isSpecial()||o!=="/"&&o!=="\\"){if(o!=="/"){m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,g=Za;continue}g=ey}else g=Z_;break;case Hk:if(g=Z_,o!=="/"||Io(b,y+1)!=="/")continue;y++;break;case Z_:if(o!=="/"&&o!=="\\"){g=ey;continue}break;case ey:if(o==="@"){S&&(b="%40"+b),S=!0,l=Fh(b);for(var I=0;I<l.length;I++){var O=l[I];if(O!==":"||k){var W=Nl(O,Nw);k?m.password+=W:m.username+=W}else k=!0}b=""}else if(o===Ro||o==="/"||o==="?"||o==="#"||o==="\\"&&m.isSpecial()){if(S&&b==="")return"Invalid authority";y-=Fh(b).length+1,b="",g=Pw}else b+=o;break;case Pw:case Dw:if(t&&m.scheme==="file"){g=Mw;continue}if(o!==":"||w){if(o===Ro||o==="/"||o==="?"||o==="#"||o==="\\"&&m.isSpecial()){if(m.isSpecial()&&b==="")return Hd;if(t&&b===""&&(m.includesCredentials()||m.port!==null))return;if(u=m.parseHost(b))return u;if(b="",g=$h,t)return;continue}o==="["?w=!0:o==="]"&&(w=!1),b+=o}else{if(b==="")return Hd;if(u=m.parseHost(b))return u;if(b="",g=kw,t===Dw)return}break;case kw:if(!ca(Rw,o)){if(o===Ro||o==="/"||o==="?"||o==="#"||o==="\\"&&m.isSpecial()||t){if(b!==""){var H=q_(b,10);if(H>65535)return Lk;m.port=m.isSpecial()&&H===Q_[m.scheme]?null:H,b=""}if(t)return;g=$h;continue}return Lk}b+=o;break;case Lw:if(m.scheme="file",o==="/"||o==="\\")g=Kk;else{if(!n||n.scheme!=="file"){g=Za;continue}switch(o){case Ro:m.host=n.host,m.path=aa(n.path),m.query=n.query;break;case"?":m.host=n.host,m.path=aa(n.path),m.query="",g=Kd;break;case"#":m.host=n.host,m.path=aa(n.path),m.query=n.query,m.fragment="",g=Fc;break;default:Fk(_f(aa(i,y),""))||(m.host=n.host,m.path=aa(n.path),m.shortenPath()),g=Za;continue}}break;case Kk:if(o==="/"||o==="\\"){g=Mw;break}n&&n.scheme==="file"&&!Fk(_f(aa(i,y),""))&&(vf(n.path[0],!0)?Bh(m.path,n.path[0]):m.host=n.host),g=Za;continue;case Mw:if(o===Ro||o==="/"||o==="\\"||o==="?"||o==="#"){if(!t&&vf(b))g=Za;else if(b===""){if(m.host="",t)return;g=$h}else{if(u=m.parseHost(b))return u;if(m.host==="localhost"&&(m.host=""),t)return;b="",g=$h}continue}b+=o;break;case $h:if(m.isSpecial()){if(g=Za,o!=="/"&&o!=="\\")continue}else if(t||o!=="?")if(t||o!=="#"){if(o!==Ro&&(g=Za,o!=="/"))continue}else m.fragment="",g=Fc;else m.query="",g=Kd;break;case Za:if(o===Ro||o==="/"||o==="\\"&&m.isSpecial()||!t&&(o==="?"||o==="#")){if((p=X_(p=b))===".."||p==="%2e."||p===".%2e"||p==="%2e%2e"?(m.shortenPath(),o==="/"||o==="\\"&&m.isSpecial()||Bh(m.path,"")):pse(b)?o==="/"||o==="\\"&&m.isSpecial()||Bh(m.path,""):(m.scheme==="file"&&!m.path.length&&vf(b)&&(m.host&&(m.host=""),b=Io(b,0)+":"),Bh(m.path,b)),b="",m.scheme==="file"&&(o===Ro||o==="?"||o==="#"))for(;m.path.length>1&&m.path[0]==="";)tse(m.path);o==="?"?(m.query="",g=Kd):o==="#"&&(m.fragment="",g=Fc)}else b+=Nl(o,Vk);break;case zk:o==="?"?(m.query="",g=Kd):o==="#"?(m.fragment="",g=Fc):o!==Ro&&(m.path[0]+=Nl(o,J_));break;case Kd:t||o!=="#"?o!==Ro&&(o==="'"&&m.isSpecial()?m.query+="%27":m.query+=o==="#"?"%23":Nl(o,J_)):(m.fragment="",g=Fc);break;case Fc:o!==Ro&&(m.fragment+=Nl(o,Uk))}y++}},parseHost:function(e){var t,n,i;if(Io(e,0)==="["){if(Io(e,e.length-1)!=="]"||(t=function(o){var l,u,p,m,g,y,b,S=[0,0,0,0,0,0,0,0],w=0,k=null,I=0,O=function(){return Io(o,I)};if(O()===":"){if(Io(o,1)!==":")return;I+=2,k=++w}for(;O();){if(w===8)return;if(O()!==":"){for(l=u=0;u<4&&ca(jk,O());)l=16*l+q_(O(),16),I++,u++;if(O()==="."){if(u===0||(I-=u,w>6))return;for(p=0;O();){if(m=null,p>0){if(!(O()==="."&&p<4))return;I++}if(!ca(Rw,O()))return;for(;ca(Rw,O());){if(g=q_(O(),10),m===null)m=g;else{if(m===0)return;m=10*m+g}if(m>255)return;I++}S[w]=256*S[w]+m,++p!=2&&p!==4||w++}if(p!==4)return;break}if(O()===":"){if(I++,!O())return}else if(O())return;S[w++]=l}else{if(k!==null)return;I++,k=++w}}if(k!==null)for(y=w-k,w=7;w!==0&&y>0;)b=S[w],S[w--]=S[k+y-1],S[k+--y]=b;else if(w!==8)return;return S}(yf(e,1,-1)),!t))return Hd;this.host=t}else if(this.isSpecial()){if(e=Kre(e),ca(cse,e)||(t=function(o){var l,u,p,m,g,y,b,S=nse(o,".");if(S.length&&S[S.length-1]===""&&S.length--,(l=S.length)>4)return o;for(u=[],p=0;p<l;p++){if((m=S[p])==="")return o;if(g=10,m.length>1&&Io(m,0)==="0"&&(g=ca(ise,m)?16:8,m=yf(m,g===8?1:2)),m==="")y=0;else{if(!ca(g===10?ase:g===8?ose:jk,m))return o;y=q_(m,g)}Bh(u,y)}for(p=0;p<l;p++)if(y=u[p],p===l-1){if(y>=kk(256,5-l))return null}else if(y>255)return null;for(b=ese(u),p=0;p<u.length;p++)b+=u[p]*kk(256,3-p);return b}(e),t===null))return Hd;this.host=t}else{if(ca(lse,e))return Hd;for(t="",n=Fh(e),i=0;i<n.length;i++)t+=Nl(n[i],J_);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return Sw(Q_,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&vf(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,i=e.password,o=e.host,l=e.port,u=e.path,p=e.query,m=e.fragment,g=t+":";return o!==null?(g+="//",e.includesCredentials()&&(g+=n+(i?":"+i:"")+"@"),g+=Ef(o),l!==null&&(g+=":"+l)):t==="file"&&(g+="//"),g+=e.cannotBeABaseURL?u[0]:u.length?"/"+_f(u,"/"):"",p!==null&&(g+="?"+p),m!==null&&(g+="#"+m),g},setHref:function(e){var t=this.parse(e);if(t)throw new ww(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Wh(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+Ef(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Vc(e)+":",Aw)},getUsername:function(){return this.username},setUsername:function(e){var t=Fh(Vc(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Nl(t[n],Nw)}},getPassword:function(){return this.password},setPassword:function(e){var t=Fh(Vc(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Nl(t[n],Nw)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?Ef(e):Ef(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Pw)},getHostname:function(){var e=this.host;return e===null?"":Ef(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Dw)},getPort:function(){var e=this.port;return e===null?"":Vc(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Vc(e))===""?this.port=null:this.parse(e,kw))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+_f(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,$h))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Vc(e))===""?this.query=null:(Io(e,0)==="?"&&(e=yf(e,1)),this.query="",this.parse(e,Kd)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Vc(e))!==""?(Io(e,0)==="#"&&(e=yf(e,1)),this.fragment="",this.parse(e,Fc)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Wh=function(e){var t=Gre(this,_i),n=Yre(arguments.length,1)>1?arguments[1]:void 0,i=qre(t,new jw(e,!1,n));vw||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},_i=Wh.prototype,Oo=function(e,t){return{get:function(){return Y_(this)[e]()},set:t&&function(n){return Y_(this)[t](n)},configurable:!0,enumerable:!0}};if(vw&&(Ao(_i,"href",Oo("serialize","setHref")),Ao(_i,"origin",Oo("getOrigin")),Ao(_i,"protocol",Oo("getProtocol","setProtocol")),Ao(_i,"username",Oo("getUsername","setUsername")),Ao(_i,"password",Oo("getPassword","setPassword")),Ao(_i,"host",Oo("getHost","setHost")),Ao(_i,"hostname",Oo("getHostname","setHostname")),Ao(_i,"port",Oo("getPort","setPort")),Ao(_i,"pathname",Oo("getPathname","setPathname")),Ao(_i,"search",Oo("getSearch","setSearch")),Ao(_i,"searchParams",Oo("getSearchParams")),Ao(_i,"hash",Oo("getHash","setHash"))),z_(_i,"toJSON",function(){return Y_(this).serialize()},{enumerable:!0}),z_(_i,"toString",function(){return Y_(this).serialize()},{enumerable:!0}),gf){var Yk=gf.createObjectURL,qk=gf.revokeObjectURL;Yk&&z_(Wh,"createObjectURL",Ok(Yk,gf)),qk&&z_(Wh,"revokeObjectURL",Ok(qk,gf))}zre(Wh,"URL"),$re({global:!0,constructor:!0,forced:!Wre,sham:!vw},{URL:Wh});var mse=Qt,Xk=f,fse=Bd,Jk=mi,gse=B_,Uw=Jn("URL"),_se=gse&&Xk(function(){Uw.canParse()}),yse=Xk(function(){return Uw.canParse.length!==1});mse({target:"URL",stat:!0,forced:!_se||yse},{canParse:function(e){var t=fse(arguments.length,1),n=Jk(e),i=t<2||arguments[1]===void 0?void 0:Jk(arguments[1]);try{return!!new Uw(n,i)}catch{return!1}}});var Ese=Qt,vse=Bd,Qk=mi,bse=B_,Sse=Jn("URL");Ese({target:"URL",stat:!0,forced:!bse},{parse:function(e){var t=vse(arguments.length,1),n=Qk(e),i=t<2||arguments[1]===void 0?void 0:Qk(arguments[1]);try{return new Sse(n,i)}catch{return null}}});var ty=h(vn.URL);let Zk=!0,eL=!0;function ny(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function zd(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,o=i.addEventListener;i.addEventListener=function(u,p){if(u!==t)return o.apply(this,arguments);const m=g=>{const y=n(g);y&&(p.handleEvent?p.handleEvent(y):p(y))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(p,m),o.apply(this,[u,m])};const l=i.removeEventListener;i.removeEventListener=function(u,p){if(u!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(p))return l.apply(this,arguments);const m=this._eventMap[t].get(p);return this._eventMap[t].delete(p),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[u,m])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(u){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),u&&this.addEventListener(t,this["_on"+t]=u)},enumerable:!0,configurable:!0})}function xse(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Zk=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function wse(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(eL=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function tL(){if(typeof window=="object"){if(Zk)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Vw(e,t){eL&&console.warn(e+" is deprecated, please use "+t+" instead.")}function nL(e){return Object.prototype.toString.call(e)==="[object Object]"}function rL(e){var t;return nL(e)?Zi(t=Object.keys(e)).call(t,function(n,i){const o=nL(e[i]),l=o?rL(e[i]):e[i],u=o&&!Object.keys(l).length;return l===void 0||u?n:Object.assign(n,{[i]:l})},{}):e}function Fw(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?Fw(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(o=>{Fw(e,e.get(o),n)})}))}function sL(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;const l=[];return e.forEach(u=>{u.type==="track"&&u.trackIdentifier===t.id&&l.push(u)}),l.forEach(u=>{e.forEach(p=>{p.type===i&&p.trackId===u.id&&Fw(e,p,o)})}),o}const iL=tL;function oL(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(u){if(typeof u!="object"||u.mandatory||u.optional)return u;const p={};return Object.keys(u).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;const g=typeof u[m]=="object"?u[m]:{ideal:u[m]};g.exact!==void 0&&typeof g.exact=="number"&&(g.min=g.max=g.exact);const y=function(b,S){return b?b+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(g.ideal!==void 0){p.optional=p.optional||[];let b={};typeof g.ideal=="number"?(b[y("min",m)]=g.ideal,p.optional.push(b),b={},b[y("max",m)]=g.ideal,p.optional.push(b)):(b[y("",m)]=g.ideal,p.optional.push(b))}g.exact!==void 0&&typeof g.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[y("",m)]=g.exact):["min","max"].forEach(b=>{g[b]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[y(b,m)]=g[b])})}),u.advanced&&(p.optional=(p.optional||[]).concat(u.advanced)),p},o=function(u,p){if(t.version>=61)return p(u);if((u=JSON.parse(JSON.stringify(u)))&&typeof u.audio=="object"){const m=function(g,y,b){y in g&&!(b in g)&&(g[b]=g[y],delete g[y])};m((u=JSON.parse(JSON.stringify(u))).audio,"autoGainControl","googAutoGainControl"),m(u.audio,"noiseSuppression","googNoiseSuppression"),u.audio=i(u.audio)}if(u&&typeof u.video=="object"){let m=u.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});const g=t.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||g)){let y;if(delete u.video.facingMode,m.exact==="environment"||m.ideal==="environment"?y=["back","rear"]:m.exact!=="user"&&m.ideal!=="user"||(y=["front"]),y)return n.mediaDevices.enumerateDevices().then(b=>{b=b.filter(w=>w.kind==="videoinput");let S=b.find(w=>y.some(k=>{var I;return fe(I=w.label.toLowerCase()).call(I,k)}));return!S&&b.length&&fe(y).call(y,"back")&&(S=b[b.length-1]),S&&(u.video.deviceId=m.exact?{exact:S.deviceId}:{ideal:S.deviceId}),u.video=i(u.video),iL("chrome: "+JSON.stringify(u)),p(u)})}u.video=i(u.video)}return iL("chrome: "+JSON.stringify(u)),p(u)},l=function(u){return t.version>=64?u:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[u.name]||u.name,message:u.message,constraint:u.constraint||u.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(u,p,m){o(u,g=>{n.webkitGetUserMedia(g,p,y=>{m&&m(l(y))})})}).bind(n),n.mediaDevices.getUserMedia){const u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(p){return o(p,m=>u(m).then(g=>{if(m.audio&&!g.getAudioTracks().length||m.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(y=>{y.stop()}),new DOMException("","NotFoundError");return g},g=>xe.reject(l(g))))}}}function aL(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function cL(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(u=>u.track&&u.track.id===i.track.id):{track:i.track};const l=new Event("track");l.track=i.track,l.receiver=o,l.transceiver={receiver:o},l.streams=[n.stream],this.dispatchEvent(l)}),n.stream.getTracks().forEach(i=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(u=>u.track&&u.track.id===i.id):{track:i};const l=new Event("track");l.track=i,l.receiver=o,l.transceiver={receiver:o},l.streams=[n.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else zd(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function lL(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(o,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=o.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:o}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,p){let m=o.apply(this,arguments);return m||(m=t(this,u),this._senders.push(m)),m};const l=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){l.apply(this,arguments);const p=this._senders.indexOf(u);p!==-1&&this._senders.splice(p,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(l=>{this._senders.push(t(this,l))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(l=>{const u=this._senders.find(p=>p.track===l);u&&this._senders.splice(this._senders.indexOf(u),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function dL(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,o]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const l=function(p){const m={};return p.result().forEach(g=>{const y={id:g.id,timestamp:g.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type};g.names().forEach(b=>{y[b]=g.stat(b)}),m[y.id]=y}),m},u=function(p){return new Map(Object.keys(p).map(m=>[m,p[m]]))};if(arguments.length>=2){const p=function(m){i(u(l(m)))};return t.apply(this,[p,n])}return new xe((p,m)=>{t.apply(this,[function(g){p(u(l(g)))},m])}).then(i,o)}}function uL(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(l=>l._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(l=>sL(l,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i}),zd(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>sL(o,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,o,l;return this.getSenders().forEach(u=>{u.track===n&&(i?l=!0:i=u)}),this.getReceivers().forEach(u=>(u.track===n&&(o?l=!0:o=u),u.track===n)),l||i&&o?xe.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():o?o.getStats():xe.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function hL(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,u){if(!u)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=t.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(p)===-1&&this._shimmedLocalStreams[u.id].push(p):this._shimmedLocalStreams[u.id]=[u,p],p};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(m=>{if(this.getSenders().find(y=>y.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const u=this.getSenders();n.apply(this,arguments);const p=this.getSenders().filter(m=>u.indexOf(m)===-1);this._shimmedLocalStreams[l.id]=[l].concat(p)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],i.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(u=>{const p=this._shimmedLocalStreams[u].indexOf(l);p!==-1&&this._shimmedLocalStreams[u].splice(p,1),this._shimmedLocalStreams[u].length===1&&delete this._shimmedLocalStreams[u]}),o.apply(this,arguments)}}function pL(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return hL(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const m=n.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(g=>this._reverseStreams[g.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(g=>{if(this.getSenders().find(b=>b.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const g=new e.MediaStream(m.getTracks());this._streams[m.id]=g,this._reverseStreams[g.id]=m,m=g}i.apply(this,[m])};const o=e.RTCPeerConnection.prototype.removeStream;function l(m,g){let y=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(b=>{const S=m._reverseStreams[b],w=m._streams[S.id];y=y.replace(new RegExp(w.id,"g"),S.id)}),new RTCSessionDescription({type:g.type,sdp:y})}e.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},e.RTCPeerConnection.prototype.addTrack=function(m,g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const y=[].slice.call(arguments,1);if(y.length!==1||!y[0].getTracks().find(w=>w===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(w=>w.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const S=this._streams[g.id];if(S)S.addTrack(m),xe.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const w=new e.MediaStream([m]);this._streams[g.id]=w,this._reverseStreams[w.id]=g,this.addStream(w)}return this.getSenders().find(w=>w.track===m)},["createOffer","createAnswer"].forEach(function(m){const g=e.RTCPeerConnection.prototype[m],y={[m](){const b=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[S=>{const w=l(this,S);b[0].apply(null,[w])},S=>{b[1]&&b[1].apply(null,S)},arguments[2]]):g.apply(this,arguments).then(S=>l(this,S))}};e.RTCPeerConnection.prototype[m]=y[m]});const u=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,g){let y=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(b=>{const S=m._reverseStreams[b],w=m._streams[S.id];y=y.replace(new RegExp(S.id,"g"),w.id)}),new RTCSessionDescription({type:g.type,sdp:y})}(this,arguments[0]),u.apply(this,arguments)):u.apply(this,arguments)};const p=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const m=p.get.apply(this);return m.type===""?m:l(this,m)}}),e.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let g;this._streams=this._streams||{},Object.keys(this._streams).forEach(y=>{this._streams[y].getTracks().find(b=>m.track===b)&&(g=this._streams[y])}),g&&(g.getTracks().length===1?this.removeStream(this._reverseStreams[g.id]):g.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Bw(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=e.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=o[n]})}function mL(e,t){zd(e,"negotiationneeded",n=>{const i=n.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var fL=Object.freeze({__proto__:null,fixNegotiationNeeded:mL,shimAddTrackRemoveTrack:pL,shimAddTrackRemoveTrackWithNative:hL,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{const o=n.video&&n.video.width,l=n.video&&n.video.height,u=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:u||3}},o&&(n.video.mandatory.maxWidth=o),l&&(n.video.mandatory.maxHeight=l),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:lL,shimGetStats:dL,shimGetUserMedia:oL,shimMediaStream:aL,shimOnTrack:cL,shimPeerConnection:Bw,shimSenderReceiverGetStats:uL});function gL(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(o,l,u){Vw("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(o).then(l,u)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const o=function(u,p,m){p in u&&!(m in u)&&(u[m]=u[p],delete u[p])},l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(u){return typeof u=="object"&&typeof u.audio=="object"&&(u=JSON.parse(JSON.stringify(u)),o(u.audio,"autoGainControl","mozAutoGainControl"),o(u.audio,"noiseSuppression","mozNoiseSuppression")),l(u)},i&&i.prototype.getSettings){const u=i.prototype.getSettings;i.prototype.getSettings=function(){const p=u.apply(this,arguments);return o(p,"mozAutoGainControl","autoGainControl"),o(p,"mozNoiseSuppression","noiseSuppression"),p}}if(i&&i.prototype.applyConstraints){const u=i.prototype.applyConstraints;i.prototype.applyConstraints=function(p){return this.kind==="audio"&&typeof p=="object"&&(p=JSON.parse(JSON.stringify(p)),o(p,"autoGainControl","mozAutoGainControl"),o(p,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[p])}}}}function _L(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function $w(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const l=e.RTCPeerConnection.prototype[o],u={[o](){return arguments[0]=new(o==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};e.RTCPeerConnection.prototype[o]=u[o]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[o,l,u]=arguments;return i.apply(this,[o||null]).then(p=>{if(t.version<53&&!l)try{p.forEach(m=>{m.type=n[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;p.forEach((g,y)=>{p.set(y,Object.assign({},g,{type:n[g.type]||g.type}))})}return p}).then(l,u)}}function yL(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):xe.resolve(new Map)}}function EL(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),zd(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function vL(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){Vw("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&fe(i=t.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function bL(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function SL(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=t.apply(this,arguments);if(i){const{sender:l}=o,u=l.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=n,l.sendEncodings=n,this.setParametersPromises.push(l.setParameters(u).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return o})}function xL(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function wL(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?xe.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function TL(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?xe.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var CL=Object.freeze({__proto__:null,shimAddTransceiver:SL,shimCreateAnswer:TL,shimCreateOffer:wL,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,xe.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:xL,shimGetUserMedia:gL,shimOnTrack:_L,shimPeerConnection:$w,shimRTCDataChannel:bL,shimReceiverGetStats:EL,shimRemoveStream:vL,shimSenderGetStats:yL});function RL(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),fe(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(o=>t.call(this,o,n)),n.getVideoTracks().forEach(o=>t.call(this,o,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,o=new Array(i>1?i-1:0),l=1;l<i;l++)o[l-1]=arguments[l];return o&&o.forEach(u=>{var p;this._localStreams?fe(p=this._localStreams).call(p,u)||this._localStreams.push(u):this._localStreams=[u]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const i=t.getTracks();this.getSenders().forEach(o=>{fe(i).call(i,o.track)&&this.removeTrack(o)})})}}function NL(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(o=>{var l;if(this._remoteStreams||(this._remoteStreams=[]),fe(l=this._remoteStreams).call(l,o))return;this._remoteStreams.push(o);const u=new Event("addstream");u.stream=o,this.dispatchEvent(u)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(o=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(o)>=0)return;n._remoteStreams.push(o);const l=new Event("addstream");l.stream=o,n.dispatchEvent(l)})}),t.apply(n,arguments)}}}function AL(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,o=t.setLocalDescription,l=t.setRemoteDescription,u=t.addIceCandidate;t.createOffer=function(m,g){const y=arguments.length>=2?arguments[2]:arguments[0],b=n.apply(this,[y]);return g?(b.then(m,g),xe.resolve()):b},t.createAnswer=function(m,g){const y=arguments.length>=2?arguments[2]:arguments[0],b=i.apply(this,[y]);return g?(b.then(m,g),xe.resolve()):b};let p=function(m,g,y){const b=o.apply(this,[m]);return y?(b.then(g,y),xe.resolve()):b};t.setLocalDescription=p,p=function(m,g,y){const b=l.apply(this,[m]);return y?(b.then(g,y),xe.resolve()):b},t.setRemoteDescription=p,p=function(m,g,y){const b=u.apply(this,[m]);return y?(b.then(g,y),xe.resolve()):b},t.addIceCandidate=p}function IL(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=o=>i(OL(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,i,o){t.mediaDevices.getUserMedia(n).then(i,o)}).bind(t))}function OL(e){return e&&e.video!==void 0?Object.assign({},e,{video:rL(e.video)}):e}function PL(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const o=[];for(let l=0;l<n.iceServers.length;l++){let u=n.iceServers[l];!u.hasOwnProperty("urls")&&u.hasOwnProperty("url")?(Vw("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,o.push(u)):o.push(n.iceServers[l])}n.iceServers=o}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function DL(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function kL(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const o=this.getTransceivers().find(l=>l.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveVideo!==!0||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function LL(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var ML=Object.freeze({__proto__:null,shimAudioContext:LL,shimCallbacksAPI:AL,shimConstraints:OL,shimCreateOfferLegacy:kL,shimGetUserMedia:IL,shimLocalStreamsAPI:RL,shimRTCIceServerUrls:PL,shimRemoteStreamsAPI:NL,shimTrackEventTransceiver:DL}),jL=`	
\v\f\r \u2028\u2029\uFEFF`,Tse=ht,Cse=mi,Ww=jL,UL=R("".replace),Rse=RegExp("^["+Ww+"]+"),Nse=RegExp("(^|[^"+Ww+"])["+Ww+"]+$"),Gw=function(e){return function(t){var n=Cse(Tse(t));return 1&e&&(n=UL(n,Rse,"")),2&e&&(n=UL(n,Nse,"$1")),n}},Ase={start:Gw(1),end:Gw(2),trim:Gw(3)},Ise=EP.PROPER,Ose=f,VL=jL,Pse=Ase.trim;Qt({target:"String",proto:!0,forced:function(e){return Ose(function(){return!!VL[e]()||""[e]()!==""||Ise&&VL[e].name!==e})}("trim")},{trim:function(){return Pse(this)}});var Dse=Qi("String","trim"),kse=N,Lse=Dse,Hw=String.prototype,Mse=function(e){var t=e.trim;return typeof e=="string"||e===Hw||kse(Hw,e)&&t===Hw.trim?Lse:t},Ts=h(Mse),FL={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(n){return n.split(`
m=`).map((i,o)=>(o>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter(o=>o.indexOf(i)===0)},t.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const o={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let l=8;l<i.length;l+=2)switch(i[l]){case"raddr":o.relatedAddress=i[l+1];break;case"rport":o.relatedPort=parseInt(i[l+1],10);break;case"tcptype":o.tcpType=i[l+1];break;case"ufrag":o.ufrag=i[l+1],o.usernameFragment=i[l+1];break;default:o[i[l]]===void 0&&(o[i[l]]=i[l+1])}return o},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const o=n.component;o==="rtp"?i.push(1):o==="rtcp"?i.push(2):i.push(o),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const l=n.type;return i.push("typ"),i.push(l),l!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let i=n.substring(9).split(" ");const o={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),o.name=i[0],o.clockRate=parseInt(i[1],10),o.channels=i.length===3?parseInt(i[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const o=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const i={};let o;const l=n.substring(n.indexOf(" ")+1).split(";");for(let u=0;u<l.length;u++)o=l[u].trim().split("="),i[o[0].trim()]=o[1];return i},t.writeFmtp=function(n){let i="",o=n.payloadType;if(n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const l=[];Object.keys(n.parameters).forEach(u=>{n.parameters[u]!==void 0?l.push(u+"="+n.parameters[u]):l.push(u)}),i+="a=fmtp:"+o+" "+l.join(";")+`\r
`}return i},t.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",o=n.payloadType;return n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(l=>{i+="a=rtcp-fb:"+o+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),o={ssrc:parseInt(n.substring(7,i),10)},l=n.indexOf(":",i);return l>-1?(o.attribute=n.substring(i+1,l),o.value=n.substring(l+1)):o.attribute=n.substring(i+1),o},t.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(o=>parseInt(o,10))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let o="a=setup:"+i+`\r
`;return n.fingerprints.forEach(l=>{o+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),o},t.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const o=t.matchPrefix(n+i,"a=ice-ufrag:")[0],l=t.matchPrefix(n+i,"a=ice-pwd:")[0];return o&&l?{usernameFragment:o.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(n)[0].split(" ");i.profile=o[2];for(let u=3;u<o.length;u++){const p=o[u],m=t.matchPrefix(n,"a=rtpmap:"+p+" ")[0];if(m){const g=t.parseRtpMap(m),y=t.matchPrefix(n,"a=fmtp:"+p+" ");switch(g.parameters=y.length?t.parseFmtp(y[0]):{},g.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+p+" ").map(t.parseRtcpFb),i.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(g.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(u=>{i.headerExtensions.push(t.parseExtmap(u))});const l=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(u=>{l.forEach(p=>{u.rtcpFeedback.find(m=>m.type===p.type&&m.parameter===p.parameter)||u.rtcpFeedback.push(p)})}),i},t.writeRtpDescription=function(n,i){let o="";o+="m="+n+" ",o+=i.codecs.length>0?"9":"0",o+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=i.codecs.map(u=>u.preferredPayloadType!==void 0?u.preferredPayloadType:u.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(u=>{o+=t.writeRtpMap(u),o+=t.writeFmtp(u),o+=t.writeRtcpFb(u)});let l=0;return i.codecs.forEach(u=>{u.maxptime>l&&(l=u.maxptime)}),l>0&&(o+="a=maxptime:"+l+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(u=>{o+=t.writeExtmap(u)}),o},t.parseRtpEncodingParameters=function(n){const i=[],o=t.parseRtpParameters(n),l=o.fecMechanisms.indexOf("RED")!==-1,u=o.fecMechanisms.indexOf("ULPFEC")!==-1,p=t.matchPrefix(n,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),m=p.length>0&&p[0].ssrc;let g;const y=t.matchPrefix(n,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(w=>parseInt(w,10)));y.length>0&&y[0].length>1&&y[0][0]===m&&(g=y[0][1]),o.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let w={ssrc:m,codecPayloadType:parseInt(S.parameters.apt,10)};m&&g&&(w.rtx={ssrc:g}),i.push(w),l&&(w=JSON.parse(JSON.stringify(w)),w.fec={ssrc:m,mechanism:u?"red+ulpfec":"red"},i.push(w))}}),i.length===0&&m&&i.push({ssrc:m});let b=t.matchPrefix(n,"b=");return b.length&&(b=b[0].indexOf("b=TIAS:")===0?parseInt(b[0].substring(7),10):b[0].indexOf("b=AS:")===0?1e3*parseInt(b[0].substring(5),10)*.95-16e3:void 0,i.forEach(S=>{S.maxBitrate=b})),i},t.parseRtcpParameters=function(n){const i={},o=t.matchPrefix(n,"a=ssrc:").map(p=>t.parseSsrcMedia(p)).filter(p=>p.attribute==="cname")[0];o&&(i.cname=o.value,i.ssrc=o.ssrc);const l=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=l.length>0,i.compound=l.length===0;const u=t.matchPrefix(n,"a=rtcp-mux");return i.mux=u.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},t.parseMsid=function(n){let i;const o=t.matchPrefix(n,"a=msid:");if(o.length===1)return i=o[0].substring(7).split(" "),{stream:i[0],track:i[1]};const l=t.matchPrefix(n,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="msid");return l.length>0?(i=l[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(n){const i=t.parseMLine(n),o=t.matchPrefix(n,"a=max-message-size:");let l;o.length>0&&(l=parseInt(o[0].substring(19),10)),isNaN(l)&&(l=65536);const u=t.matchPrefix(n,"a=sctp-port:");if(u.length>0)return{port:parseInt(u[0].substring(12),10),protocol:i.fmt,maxMessageSize:l};const p=t.matchPrefix(n,"a=sctpmap:");if(p.length>0){const m=p[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:l}}},t.writeSctpDescription=function(n,i){let o=[];return o=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&o.push("a=max-message-size:"+i.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,i,o){let l;const u=i!==void 0?i:2;return l=n||t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+l+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,i){const o=t.splitLines(n);for(let l=0;l<o.length;l++)switch(o[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[l].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=t.splitLines(n);for(let o=0;o<i.length;o++)if(i[o].length<2||i[o].charAt(1)!=="=")return!1;return!0},e.exports=t})(FL);var BL=FL.exports,Gh=h(BL),jse=a({__proto__:null,default:Gh},[BL]);function ry(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),o=Gh.parseCandidate(n.candidate),l=Object.assign(i,o);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,zd(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Kw(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||zd(e,"icecandidate",t=>{if(t.candidate){const n=Gh.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function sy(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(p){if(!p||!p.sdp)return!1;const m=Gh.splitSections(p.sdp);return m.shift(),m.some(g=>{const y=Gh.parseMLine(g);return y&&y.kind==="application"&&y.protocol.indexOf("SCTP")!==-1})},i=function(p){const m=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(m===null||m.length<2)return-1;const g=parseInt(m[1],10);return g!=g?-1:g},o=function(p){let m=65536;return t.browser==="firefox"&&(m=t.version<57?p===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),m},l=function(p,m){let g=65536;t.browser==="firefox"&&t.version===57&&(g=65535);const y=Gh.matchPrefix(p.sdp,"a=max-message-size:");return y.length>0?g=parseInt(y[0].substr(19),10):t.browser==="firefox"&&m!==-1&&(g=2147483637),g},u=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const p=i(arguments[0]),m=o(p),g=l(arguments[0],p);let y;y=m===0&&g===0?Number.POSITIVE_INFINITY:m===0||g===0?Math.max(m,g):Math.min(m,g);const b={};Object.defineProperty(b,"maxMessageSize",{get:()=>y}),this._sctp=b}return u.apply(this,arguments)}}function iy(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,o){const l=i.send;i.send=function(){const u=arguments[0],p=u.length||u.size||u.byteLength;if(i.readyState==="open"&&o.sctp&&p>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return l.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},zd(e,"datachannel",i=>(t(i.channel,i.target),i))}function zw(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const l=o.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const u=new Event("connectionstatechange",o);l.dispatchEvent(u)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Yw(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=i.sdp.split(`
`).filter(l=>Ts(l).call(l)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:o}):i.sdp=o}return n.apply(this,arguments)}}function oy(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?xe.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),xe.resolve())})}function ay(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var Use=Object.freeze({__proto__:null,removeExtmapAllowMixed:Yw,shimAddIceCandidateNullOrEmpty:oy,shimConnectionState:zw,shimMaxMessageSize:sy,shimParameterlessSetLocalDescription:ay,shimRTCIceCandidate:ry,shimRTCIceCandidateRelayProtocol:Kw,shimSendThrowTypeError:iy});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=tL,i=function(l){const u={browser:null,version:null};if(l===void 0||!l.navigator)return u.browser="Not a browser.",u;const{navigator:p}=l;if(p.mozGetUserMedia)u.browser="firefox",u.version=ny(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||l.isSecureContext===!1&&l.webkitRTCPeerConnection)u.browser="chrome",u.version=ny(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!l.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return u.browser="Not a supported browser.",u;u.browser="safari",u.version=ny(p.userAgent,/AppleWebKit\/(\d+)\./,1),u.supportsUnifiedPlan=l.RTCRtpTransceiver&&"currentDirection"in l.RTCRtpTransceiver.prototype}return u}(e),o={browserDetails:i,commonShim:Use,extractVersion:ny,disableLog:xse,disableWarnings:wse,sdp:jse};switch(i.browser){case"chrome":if(!fL||!Bw||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=fL,oy(e,i),ay(e),oL(e,i),aL(e),Bw(e,i),cL(e),pL(e,i),lL(e),dL(e),uL(e),mL(e,i),ry(e),Kw(e),zw(e),sy(e,i),iy(e),Yw(e,i);break;case"firefox":if(!CL||!$w||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=CL,oy(e,i),ay(e),gL(e,i),$w(e,i),_L(e),vL(e),yL(e),EL(e),bL(e),SL(e),xL(e),wL(e),TL(e),ry(e),zw(e),sy(e,i),iy(e);break;case"safari":if(!ML||!t.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=ML,oy(e,i),ay(e),PL(e),kL(e),AL(e),RL(e),NL(e),DL(e),IL(e),LL(e),ry(e),Kw(e),sy(e,i),iy(e),Yw(e,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Vse=f,$L=j.RegExp,Fse=!Vse(function(){var e=!0;try{$L(".","d")}catch{e=!1}var t={},n="",i=e?"dgimsy":"gimsy",o=function(p,m){Object.defineProperty(t,p,{get:function(){return n+=m,!0}})},l={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var u in e&&(l.hasIndices="d"),l)o(u,l[u]);return Object.getOwnPropertyDescriptor($L.prototype,"flags").get.call(t)!==i||n!==i}),Bse=pi,$se=Re,Wse=cs,Gse=N,WL={correct:Fse},Hse=function(){var e=Bse(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Kse=RegExp.prototype,qw=WL.correct?function(e){return e.flags}:function(e){return WL.correct||!Gse(Kse,e)||Wse(e,"flags")?e.flags:$se(Hse,e)},Xw=R,zse=Math.floor,Jw=Xw("".charAt),Yse=Xw("".replace),Qw=Xw("".slice),qse=/\$([$&'`]|\d{1,2})/g,Xse=Qt,Jse=Re,Zw=R,GL=ht,Qse=Ce,Zse=ln,eie=ZS,Hh=mi,tie=nn,nie=qw,rie=function(e,t,n,i,o,l){var u=n+e.length,p=i.length,m=qse;return Yse(l,m,function(g,y){var b;switch(Jw(y,0)){case"$":return"$";case"&":return e;case"`":return Qw(t,0,n);case"'":return Qw(t,u);case"<":b=o[Qw(y,1,-1)];break;default:var S=+y;if(S===0)return g;if(S>p){var w=zse(S/10);return w===0?g:w<=p?i[w-1]===void 0?Jw(y,1):i[w-1]+Jw(y,1):g}b=i[S-1]}return b===void 0?"":b})},sie=or("replace"),iie=TypeError,eT=Zw("".indexOf),oie=Zw("".replace),HL=Zw("".slice),aie=Math.max;Xse({target:"String",proto:!0},{replaceAll:function(e,t){var n,i,o,l,u,p,m,g,y,b,S=GL(this),w=0,k="";if(Zse(e)){if((n=eie(e))&&(i=Hh(GL(nie(e))),!~eT(i,"g")))throw new iie("`.replaceAll` does not allow non-global regexes");if(o=tie(e,sie))return Jse(o,e,S,t);if(n)return oie(Hh(S),e,t)}for(l=Hh(S),u=Hh(e),(p=Qse(t))||(t=Hh(t)),m=u.length,g=aie(1,m),y=eT(l,u);y!==-1;)b=p?Hh(t(u,y,l)):rie(u,l,y,[],void 0,t),k+=HL(l,w,y)+b,w=y+m,y=y+g>l.length?-1:eT(l,u,y+g);return w<l.length&&(k+=HL(l,w)),k}});var cie=Qi("String","replaceAll"),lie=N,die=cie,tT=String.prototype,uie=function(e){var t=e.replaceAll;return typeof e=="string"||e===tT||lie(tT,e)&&t===tT.replaceAll?die:t},hie=h(uie),nT=j;Qt({global:!0,forced:nT.globalThis!==nT},{globalThis:nT});var KL=h(j),rT={exports:{}};(function(e,t){(function(n,i){var o="function",l="undefined",u="object",p="string",m="major",g="model",y="name",b="type",S="vendor",w="version",k="architecture",I="console",O="mobile",W="tablet",H="smarttv",Y="wearable",Q="embedded",Z="Amazon",q="Apple",ee="ASUS",ce="BlackBerry",me="Browser",Oe="Chrome",ot="Firefox",it="Google",wt="Honor",yt="Huawei",Kt="LG",An="Microsoft",he="Motorola",Ee="Nvidia",je="OnePlus",pe="Opera",A="OPPO",z="Samsung",X="Sharp",_e="Sony",mt="Xiaomi",gn="Zebra",wr="Facebook",uo="Chromium OS",Xl="Mac OS",sv=" Browser",Bp=function(lr){for(var mr={},Tn=0;Tn<lr.length;Tn++)mr[lr[Tn].toUpperCase()]=lr[Tn];return mr},iv=function(lr,mr){return typeof lr===p&&Iu(mr).indexOf(Iu(lr))!==-1},Iu=function(lr){return lr.toLowerCase()},Tg=function(lr,mr){if(typeof lr===p)return lr=lr.replace(/^\s\s*/,""),typeof mr===l?lr:lr.substring(0,500)},Ou=function(lr,mr){for(var Tn,ni,Na,Yn,Qc,Vt,Aa=0;Aa<mr.length&&!Qc;){var Pu=mr[Aa],yc=mr[Aa+1];for(Tn=ni=0;Tn<Pu.length&&!Qc&&Pu[Tn];)if(Qc=Pu[Tn++].exec(lr))for(Na=0;Na<yc.length;Na++)Vt=Qc[++ni],typeof(Yn=yc[Na])===u&&Yn.length>0?Yn.length===2?typeof Yn[1]==o?this[Yn[0]]=Yn[1].call(this,Vt):this[Yn[0]]=Yn[1]:Yn.length===3?typeof Yn[1]!==o||Yn[1].exec&&Yn[1].test?this[Yn[0]]=Vt?Vt.replace(Yn[1],Yn[2]):i:this[Yn[0]]=Vt?Yn[1].call(this,Vt,Yn[2]):i:Yn.length===4&&(this[Yn[0]]=Vt?Yn[3].call(this,Vt.replace(Yn[1],Yn[2])):i):this[Yn]=Vt||i;Aa+=2}},Jl=function(lr,mr){for(var Tn in mr)if(typeof mr[Tn]===u&&mr[Tn].length>0){for(var ni=0;ni<mr[Tn].length;ni++)if(iv(mr[Tn][ni],lr))return Tn==="?"?i:Tn}else if(iv(mr[Tn],lr))return Tn==="?"?i:Tn;return mr.hasOwnProperty("*")?mr["*"]:lr},D6={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},k6={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[w,[y,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[w,[y,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[y,w],[/opios[\/ ]+([\w\.]+)/i],[w,[y,pe+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[w,[y,pe+" GX"]],[/\bopr\/([\w\.]+)/i],[w,[y,pe]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[w,[y,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[w,[y,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[y,w],[/quark(?:pc)?\/([-\w\.]+)/i],[w,[y,"Quark"]],[/\bddg\/([\w\.]+)/i],[w,[y,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[w,[y,"UC"+me]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[w,[y,"WeChat"]],[/konqueror\/([\w\.]+)/i],[w,[y,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[w,[y,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[w,[y,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[w,[y,"Smart Lenovo "+me]],[/(avast|avg)\/([\w\.]+)/i],[[y,/(.+)/,"$1 Secure "+me],w],[/\bfocus\/([\w\.]+)/i],[w,[y,ot+" Focus"]],[/\bopt\/([\w\.]+)/i],[w,[y,pe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[w,[y,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[w,[y,"Dolphin"]],[/coast\/([\w\.]+)/i],[w,[y,pe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[w,[y,"MIUI"+sv]],[/fxios\/([\w\.-]+)/i],[w,[y,ot]],[/\bqihoobrowser\/?([\w\.]*)/i],[w,[y,"360"]],[/\b(qq)\/([\w\.]+)/i],[[y,/(.+)/,"$1Browser"],w],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[y,/(.+)/,"$1"+sv],w],[/samsungbrowser\/([\w\.]+)/i],[w,[y,z+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[w,[y,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[y,"Sogou Mobile"],w],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[y,w],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[y],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[w,y],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[y,wr],w],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[y,w],[/\bgsa\/([\w\.]+) .*safari\//i],[w,[y,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[w,[y,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[w,[y,Oe+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[y,Oe+" WebView"],w],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[w,[y,"Android "+me]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[y,w],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[w,[y,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[w,y],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[y,[w,Jl,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[y,w],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[y,"Netscape"],w],[/(wolvic|librewolf)\/([\w\.]+)/i],[y,w],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[w,[y,ot+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[y,[w,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[y,[w,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[k,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[k,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[k,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[k,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[k,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[k,/ower/,"",Iu]],[/ sun4\w[;\)]/i],[[k,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[k,Iu]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[g,[S,z],[b,W]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[g,[S,z],[b,O]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[g,[S,q],[b,O]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[g,[S,q],[b,W]],[/(macintosh);/i],[g,[S,q]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[g,[S,X],[b,O]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[g,[S,wt],[b,W]],[/honor([-\w ]+)[;\)]/i],[g,[S,wt],[b,O]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[g,[S,yt],[b,W]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[g,[S,yt],[b,O]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[g,/_/g," "],[S,mt],[b,W]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[g,/_/g," "],[S,mt],[b,O]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[g,[S,A],[b,O]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[g,[S,Jl,{OnePlus:["304","403","203"],"*":A}],[b,W]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[g,[S,"Vivo"],[b,O]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[g,[S,"Realme"],[b,O]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[g,[S,he],[b,O]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[g,[S,he],[b,W]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[g,[S,Kt],[b,W]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[g,[S,Kt],[b,O]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[g,[S,"Lenovo"],[b,W]],[/(nokia) (t[12][01])/i],[S,g,[b,W]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[g,/_/g," "],[b,O],[S,"Nokia"]],[/(pixel (c|tablet))\b/i],[g,[S,it],[b,W]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[g,[S,it],[b,O]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[g,[S,_e],[b,O]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[g,"Xperia Tablet"],[S,_e],[b,W]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[g,[S,je],[b,O]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[g,[S,Z],[b,W]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[g,/(.+)/g,"Fire Phone $1"],[S,Z],[b,O]],[/(playbook);[-\w\),; ]+(rim)/i],[g,S,[b,W]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[g,[S,ce],[b,O]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[g,[S,ee],[b,W]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[g,[S,ee],[b,O]],[/(nexus 9)/i],[g,[S,"HTC"],[b,W]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[g,/_/g," "],[b,O]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[g,[S,"TCL"],[b,W]],[/(itel) ((\w+))/i],[[S,Iu],g,[b,Jl,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[g,[S,"Acer"],[b,W]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[g,[S,"Meizu"],[b,O]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[g,[S,"Ulefone"],[b,O]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[g,[S,"Energizer"],[b,O]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[g,[S,"Cat"],[b,O]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[g,[S,"Smartfren"],[b,O]],[/droid.+; (a(?:015|06[35]|142p?))/i],[g,[S,"Nothing"],[b,O]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[g,[S,"Archos"],[b,W]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[g,[S,"Archos"],[b,O]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[S,g,[b,W]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[S,g,[b,O]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,g,[b,W]],[/(surface duo)/i],[g,[S,An],[b,W]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[g,[S,"Fairphone"],[b,O]],[/(u304aa)/i],[g,[S,"AT&T"],[b,O]],[/\bsie-(\w*)/i],[g,[S,"Siemens"],[b,O]],[/\b(rct\w+) b/i],[g,[S,"RCA"],[b,W]],[/\b(venue[\d ]{2,7}) b/i],[g,[S,"Dell"],[b,W]],[/\b(q(?:mv|ta)\w+) b/i],[g,[S,"Verizon"],[b,W]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[g,[S,"Barnes & Noble"],[b,W]],[/\b(tm\d{3}\w+) b/i],[g,[S,"NuVision"],[b,W]],[/\b(k88) b/i],[g,[S,"ZTE"],[b,W]],[/\b(nx\d{3}j) b/i],[g,[S,"ZTE"],[b,O]],[/\b(gen\d{3}) b.+49h/i],[g,[S,"Swiss"],[b,O]],[/\b(zur\d{3}) b/i],[g,[S,"Swiss"],[b,W]],[/\b((zeki)?tb.*\b) b/i],[g,[S,"Zeki"],[b,W]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],g,[b,W]],[/\b(ns-?\w{0,9}) b/i],[g,[S,"Insignia"],[b,W]],[/\b((nxa|next)-?\w{0,9}) b/i],[g,[S,"NextBook"],[b,W]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],g,[b,O]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],g,[b,O]],[/\b(ph-1) /i],[g,[S,"Essential"],[b,O]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[g,[S,"Envizen"],[b,W]],[/\b(trio[-\w\. ]+) b/i],[g,[S,"MachSpeed"],[b,W]],[/\btu_(1491) b/i],[g,[S,"Rotor"],[b,W]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[g,[S,Ee],[b,W]],[/(sprint) (\w+)/i],[S,g,[b,O]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[S,An],[b,O]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[g,[S,gn],[b,W]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[g,[S,gn],[b,O]],[/smart-tv.+(samsung)/i],[S,[b,H]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[S,z],[b,H]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,Kt],[b,H]],[/(apple) ?tv/i],[S,[g,q+" TV"],[b,H]],[/crkey/i],[[g,Oe+"cast"],[S,it],[b,H]],[/droid.+aft(\w+)( bui|\))/i],[g,[S,Z],[b,H]],[/(shield \w+ tv)/i],[g,[S,Ee],[b,H]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[g,[S,X],[b,H]],[/(bravia[\w ]+)( bui|\))/i],[g,[S,_e],[b,H]],[/(mi(tv|box)-?\w+) bui/i],[g,[S,mt],[b,H]],[/Hbbtv.*(technisat) (.*);/i],[S,g,[b,H]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[S,Tg],[g,Tg],[b,H]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[g,[b,H]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[b,H]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,g,[b,I]],[/droid.+; (shield)( bui|\))/i],[g,[S,Ee],[b,I]],[/(playstation \w+)/i],[g,[S,_e],[b,I]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[g,[S,An],[b,I]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[g,[S,z],[b,Y]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[S,g,[b,Y]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[g,[S,A],[b,Y]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[g,[S,q],[b,Y]],[/(opwwe\d{3})/i],[g,[S,je],[b,Y]],[/(moto 360)/i],[g,[S,he],[b,Y]],[/(smartwatch 3)/i],[g,[S,_e],[b,Y]],[/(g watch r)/i],[g,[S,Kt],[b,Y]],[/droid.+; (wt63?0{2,3})\)/i],[g,[S,gn],[b,Y]],[/droid.+; (glass) \d/i],[g,[S,it],[b,Y]],[/(pico) (4|neo3(?: link|pro)?)/i],[S,g,[b,Y]],[/; (quest( \d| pro)?)/i],[g,[S,wr],[b,Y]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[b,Q]],[/(aeobc)\b/i],[g,[S,Z],[b,Q]],[/(homepod).+mac os/i],[g,[S,q],[b,Q]],[/windows iot/i],[[b,Q]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[g,[b,O]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[g,[b,W]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[b,W]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[b,O]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[g,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[w,[y,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[y,w],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[w,[y,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[y,w],[/ladybird\//i],[[y,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[w,y]],os:[[/microsoft (windows) (vista|xp)/i],[y,w],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[y,[w,Jl,D6]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[w,Jl,D6],[y,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[w,/_/g,"."],[y,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[y,Xl],[w,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[w,y],[/(ubuntu) ([\w\.]+) like android/i],[[y,/(.+)/,"$1 Touch"],w],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[y,w],[/\(bb(10);/i],[w,[y,ce]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[w,[y,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[w,[y,ot+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[w,[y,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[w,[y,"watchOS"]],[/crkey\/([\d\.]+)/i],[w,[y,Oe+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[y,uo],w],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[y,w],[/(sunos) ?([\w\.\d]*)/i],[[y,"Solaris"],w],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[y,w]]},Ra=function(lr,mr){if(typeof lr===u&&(mr=lr,lr=i),!(this instanceof Ra))return new Ra(lr,mr).getResult();var Tn=typeof n!==l&&n.navigator?n.navigator:i,ni=lr||(Tn&&Tn.userAgent?Tn.userAgent:""),Na=Tn&&Tn.userAgentData?Tn.userAgentData:i,Yn=mr?function(Vt,Aa){var Pu={};for(var yc in Vt)Aa[yc]&&Aa[yc].length%2==0?Pu[yc]=Aa[yc].concat(Vt[yc]):Pu[yc]=Vt[yc];return Pu}(k6,mr):k6,Qc=Tn&&Tn.userAgent==ni;return this.getBrowser=function(){var Vt={};return Vt[y]=i,Vt[w]=i,Ou.call(Vt,ni,Yn.browser),Vt[m]=function(Aa){return typeof Aa===p?Aa.replace(/[^\d\.]/g,"").split(".")[0]:i}(Vt[w]),Qc&&Tn&&Tn.brave&&typeof Tn.brave.isBrave==o&&(Vt[y]="Brave"),Vt},this.getCPU=function(){var Vt={};return Vt[k]=i,Ou.call(Vt,ni,Yn.cpu),Vt},this.getDevice=function(){var Vt={};return Vt[S]=i,Vt[g]=i,Vt[b]=i,Ou.call(Vt,ni,Yn.device),Qc&&!Vt[b]&&Na&&Na.mobile&&(Vt[b]=O),Qc&&Vt[g]=="Macintosh"&&Tn&&typeof Tn.standalone!==l&&Tn.maxTouchPoints&&Tn.maxTouchPoints>2&&(Vt[g]="iPad",Vt[b]=W),Vt},this.getEngine=function(){var Vt={};return Vt[y]=i,Vt[w]=i,Ou.call(Vt,ni,Yn.engine),Vt},this.getOS=function(){var Vt={};return Vt[y]=i,Vt[w]=i,Ou.call(Vt,ni,Yn.os),Qc&&!Vt[y]&&Na&&Na.platform&&Na.platform!="Unknown"&&(Vt[y]=Na.platform.replace(/chrome os/i,uo).replace(/macos/i,Xl)),Vt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ni},this.setUA=function(Vt){return ni=typeof Vt===p&&Vt.length>500?Tg(Vt,500):Vt,this},this.setUA(ni),this};Ra.VERSION="0.7.41",Ra.BROWSER=Bp([y,w,m]),Ra.CPU=Bp([k]),Ra.DEVICE=Bp([g,S,b,I,O,H,W,Y,Q]),Ra.ENGINE=Ra.OS=Bp([y,w]),e.exports&&(t=e.exports=Ra),t.UAParser=Ra;var $p=typeof n!==l&&(n.jQuery||n.Zepto);if($p&&!$p.ua){var ov=new Ra;$p.ua=ov.getResult(),$p.ua.get=function(){return ov.getUA()},$p.ua.set=function(lr){ov.setUA(lr);var mr=ov.getResult();for(var Tn in mr)$p.ua[Tn]=mr[Tn]}}})(typeof window=="object"?window:c)})(rT,rT.exports);var pie=h(rT.exports),zL=k_.clear;Qt({global:!0,bind:!0,enumerable:!0,forced:j.clearImmediate!==zL},{clearImmediate:zL});var YL=j,mie=B,fie=Ce,gie=rx,_ie=yr,yie=xl,Eie=Bd,vie=YL.Function,bie=/MSIE .\./.test(_ie)||gie==="BUN"&&function(){var e=YL.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),Sie=Qt,qL=j,XL=k_.set,xie=function(e,t){var n=1;return bie?function(i,o){var l=Eie(arguments.length,1)>n,u=fie(i)?i:vie(i),p=l?yie(arguments,n):[],m=l?function(){mie(u,this,p)}:u;return e(m)}:e},JL=qL.setImmediate?xie(XL):XL;Sie({global:!0,bind:!0,enumerable:!0,forced:qL.setImmediate!==JL},{setImmediate:JL});var QL=h(vn.setImmediate),wie=j,Tie=sD,Cie=pt,Rie=Bd,Nie=Se;Qt({global:!0,enumerable:!0,dontCallGetSet:!0,forced:f(function(){return Nie&&Object.getOwnPropertyDescriptor(wie,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){Rie(arguments.length,1),Tie(Cie(e))}});var ZL=h(vn.queueMicrotask);function eM(e,t){return function(){return e.apply(t,arguments)}}const{toString:Aie}=Object.prototype,{getPrototypeOf:sT}=Object,{iterator:cy,toStringTag:tM}=Symbol,ly=(iT=Object.create(null),e=>{const t=Aie.call(e);return iT[t]||(iT[t]=t.slice(8,-1).toLowerCase())});var iT;const la=e=>(e=e.toLowerCase(),t=>ly(t)===e),dy=e=>t=>typeof t===e,{isArray:Kh}=Array,zh=dy("undefined");function bf(e){return e!==null&&!zh(e)&&e.constructor!==null&&!zh(e.constructor)&&Oi(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const nM=la("ArrayBuffer"),Iie=dy("string"),Oi=dy("function"),rM=dy("number"),Sf=e=>e!==null&&typeof e=="object",uy=e=>{if(ly(e)!=="object")return!1;const t=sT(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||tM in e||cy in e)},Oie=la("Date"),Pie=la("File"),Die=la("Blob"),kie=la("FileList"),Lie=la("URLSearchParams"),[Mie,jie,Uie,Vie]=["ReadableStream","Request","Response","Headers"].map(la);function xf(e,t){let n,i,{allOwnKeys:o=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Kh(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{if(bf(e))return;const l=o?Object.getOwnPropertyNames(e):Object.keys(e),u=l.length;let p;for(n=0;n<u;n++)p=l[n],t.call(null,e[p],p,e)}}function sM(e,t){if(bf(e))return null;t=t.toLowerCase();const n=Object.keys(e);let i,o=n.length;for(;o-- >0;)if(i=n[o],t===i.toLowerCase())return i;return null}const Yd=KL!==void 0?KL:typeof self<"u"?self:typeof window<"u"?window:cv,iM=e=>!zh(e)&&e!==Yd,Fie=(oT=typeof Uint8Array<"u"&&sT(Uint8Array),e=>oT&&e instanceof oT);var oT;const Bie=la("HTMLFormElement"),oM=(e=>{let{hasOwnProperty:t}=e;return(n,i)=>t.call(n,i)})(Object.prototype),$ie=la("RegExp"),aM=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};xf(n,(o,l)=>{let u;(u=t(o,l,e))!==!1&&(i[l]=u||o)}),Object.defineProperties(e,i)},Wie=la("AsyncFunction"),cM=(lM=typeof QL=="function",dM=Oi(Yd.postMessage),lM?QL:dM?(aT="axios@".concat(Math.random()),hy=[],Yd.addEventListener("message",e=>{let{source:t,data:n}=e;t===Yd&&n===aT&&hy.length&&hy.shift()()},!1),e=>{hy.push(e),Yd.postMessage(aT,"*")}):e=>setTimeout(e));var lM,dM,aT,hy;const Gie=ZL!==void 0?ZL.bind(Yd):typeof process<"u"&&process.nextTick||cM;var Te={isArray:Kh,isArrayBuffer:nM,isBuffer:bf,isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Oi(e.append)&&((t=ly(e))==="formdata"||t==="object"&&Oi(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&nM(e.buffer),t},isString:Iie,isNumber:rM,isBoolean:e=>e===!0||e===!1,isObject:Sf,isPlainObject:uy,isEmptyObject:e=>{if(!Sf(e)||bf(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},isReadableStream:Mie,isRequest:jie,isResponse:Uie,isHeaders:Vie,isUndefined:zh,isDate:Oie,isFile:Pie,isBlob:Die,isRegExp:$ie,isFunction:Oi,isStream:e=>Sf(e)&&Oi(e.pipe),isURLSearchParams:Lie,isTypedArray:Fie,isFileList:kie,forEach:xf,merge:function e(){const{caseless:t,skipUndefined:n}=iM(this)&&this||{},i={},o=(l,u)=>{const p=t&&sM(i,u)||u;uy(i[p])&&uy(l)?i[p]=e(i[p],l):uy(l)?i[p]=e({},l):Kh(l)?i[p]=l.slice():n&&zh(l)||(i[p]=l)};for(let l=0,u=arguments.length;l<u;l++)arguments[l]&&xf(arguments[l],o);return i},extend:function(e,t,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return xf(t,(o,l)=>{n&&Oi(o)?e[l]=eM(o,n):e[l]=o},{allOwnKeys:i}),e},trim:e=>Ts(e)?Ts(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let o,l,u;const p={};if(t=t||{},e==null)return t;do{for(o=Object.getOwnPropertyNames(e),l=o.length;l-- >0;)u=o[l],i&&!i(u,e,t)||p[u]||(t[u]=e[u],p[u]=!0);e=n!==!1&&sT(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:ly,kindOfTest:la,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const i=e.indexOf(t,n);return i!==-1&&i===n},toArray:e=>{if(!e)return null;if(Kh(e))return e;let t=e.length;if(!rM(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[cy]).call(e);let i;for(;(i=n.next())&&!i.done;){const o=i.value;t.call(e,o[0],o[1])}},matchAll:(e,t)=>{let n;const i=[];for(;(n=e.exec(t))!==null;)i.push(n);return i},isHTMLForm:Bie,hasOwnProperty:oM,hasOwnProp:oM,reduceDescriptors:aM,freezeMethods:e=>{aM(e,(t,n)=>{if(Oi(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=e[n];Oi(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},i=o=>{o.forEach(l=>{n[l]=!0})};return Kh(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:sM,global:Yd,isContextDefined:iM,isSpecCompliantForm:function(e){return!!(e&&Oi(e.append)&&e[tM]==="FormData"&&e[cy])},toJSONObject:e=>{const t=new Array(10),n=(i,o)=>{if(Sf(i)){if(t.indexOf(i)>=0)return;if(bf(i))return i;if(!("toJSON"in i)){t[o]=i;const l=Kh(i)?[]:{};return xf(i,(u,p)=>{const m=n(u,o+1);!zh(m)&&(l[p]=m)}),t[o]=void 0,l}}return i};return n(e,0)},isAsyncFn:Wie,isThenable:e=>e&&(Sf(e)||Oi(e))&&Oi(e.then)&&Oi(e.catch),setImmediate:cM,asap:Gie,isIterable:e=>e!=null&&Oi(e[cy])};function dn(e,t,n,i,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),o&&(this.response=o,this.status=o.status?o.status:null)}Te.inherits(dn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Te.toJSONObject(this.config),code:this.code,status:this.status}}});const uM=dn.prototype,hM={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{hM[e]={value:e}}),Object.defineProperties(dn,hM),Object.defineProperty(uM,"isAxiosError",{value:!0}),dn.from=(e,t,n,i,o,l)=>{const u=Object.create(uM);Te.toFlatObject(e,u,function(g){return g!==Error.prototype},g=>g!=="isAxiosError");const p=e&&e.message?e.message:"Error",m=t==null&&e?e.code:t;return dn.call(u,p,m,n,i,o),e&&u.cause==null&&Object.defineProperty(u,"cause",{value:e,configurable:!0}),u.name=e&&e.name||"Error",l&&Object.assign(u,l),u};function cT(e){return Te.isPlainObject(e)||Te.isArray(e)}function pM(e){return Te.endsWith(e,"[]")?e.slice(0,-2):e}function mM(e,t,n){return e?e.concat(t).map(function(i,o){return i=pM(i),!n&&o?"["+i+"]":i}).join(n?".":""):t}const Hie=Te.toFlatObject(Te,{},null,function(e){return/^is[A-Z]/.test(e)});function py(e,t,n){if(!Te.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const i=(n=Te.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,w){return!Te.isUndefined(w[S])})).metaTokens,o=n.visitor||g,l=n.dots,u=n.indexes,p=(n.Blob||typeof Blob<"u"&&Blob)&&Te.isSpecCompliantForm(t);if(!Te.isFunction(o))throw new TypeError("visitor must be a function");function m(S){if(S===null)return"";if(Te.isDate(S))return S.toISOString();if(Te.isBoolean(S))return S.toString();if(!p&&Te.isBlob(S))throw new dn("Blob is not supported. Use a Buffer instead.");return Te.isArrayBuffer(S)||Te.isTypedArray(S)?p&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function g(S,w,k){let I=S;if(S&&!k&&typeof S=="object"){if(Te.endsWith(w,"{}"))w=i?w:w.slice(0,-2),S=JSON.stringify(S);else if(Te.isArray(S)&&function(O){return Te.isArray(O)&&!O.some(cT)}(S)||(Te.isFileList(S)||Te.endsWith(w,"[]"))&&(I=Te.toArray(S)))return w=pM(w),I.forEach(function(O,W){!Te.isUndefined(O)&&O!==null&&t.append(u===!0?mM([w],W,l):u===null?w:w+"[]",m(O))}),!1}return!!cT(S)||(t.append(mM(k,w,l),m(S)),!1)}const y=[],b=Object.assign(Hie,{defaultVisitor:g,convertValue:m,isVisitable:cT});if(!Te.isObject(e))throw new TypeError("data must be an object");return function S(w,k){if(!Te.isUndefined(w)){if(y.indexOf(w)!==-1)throw Error("Circular reference detected in "+k.join("."));y.push(w),Te.forEach(w,function(I,O){(!(Te.isUndefined(I)||I===null)&&o.call(t,I,Te.isString(O)?Ts(O).call(O):O,k,b))===!0&&S(I,k?k.concat(O):[O])}),y.pop()}}(e),t}function fM(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function lT(e,t){this._pairs=[],e&&py(e,this,t)}const gM=lT.prototype;function Kie(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function _M(e,t,n){if(!t)return e;const i=n&&n.encode||Kie;Te.isFunction(n)&&(n={serialize:n});const o=n&&n.serialize;let l;if(l=o?o(t,n):Te.isURLSearchParams(t)?t.toString():new lT(t,n).toString(i),l){const u=e.indexOf("#");u!==-1&&(e=e.slice(0,u)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}gM.append=function(e,t){this._pairs.push([e,t])},gM.toString=function(e){const t=e?function(n){return e.call(this,n,fM)}:fM;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var yM=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Te.forEach(this.handlers,function(t){t!==null&&e(t)})}},EM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},vM={exports:{}},zie=Qt,Yie=Se,bM=To.f;zie({target:"Object",stat:!0,forced:Object.defineProperty!==bM,sham:!Yie},{defineProperty:bM});var SM=vn.Object,qie=vM.exports=function(e,t,n){return SM.defineProperty(e,t,n)};SM.defineProperty.sham&&(qie.sham=!0);var xM=h(vM.exports),Xie=TypeError,wM=tf,Jie=D_,Qie=ln,Zie=or("species"),TM=Array,eoe=function(e){var t;return wM(e)&&(t=e.constructor,(Jie(t)&&(t===TM||wM(t.prototype))||Qie(t)&&(t=t[Zie])===null)&&(t=void 0)),t===void 0?TM:t},CM=function(e,t){return new(eoe(e))(t===0?0:t)},toe=f,noe=os,roe=or("species"),RM=function(e){return noe>=51||!toe(function(){var t=[];return(t.constructor={})[roe]=function(){return{foo:1}},t[e](Boolean).foo!==1})},soe=Qt,ioe=f,ooe=tf,aoe=ln,coe=Xa,loe=vl,NM=function(e){if(e>9007199254740991)throw Xie("Maximum allowed index exceeded");return e},AM=_w,doe=CM,uoe=RM,hoe=os,IM=or("isConcatSpreadable"),poe=hoe>=51||!ioe(function(){var e=[];return e[IM]=!1,e.concat()[0]!==e}),moe=function(e){if(!aoe(e))return!1;var t=e[IM];return t!==void 0?!!t:ooe(e)};soe({target:"Array",proto:!0,arity:1,forced:!poe||!uoe("concat")},{concat:function(e){var t,n,i,o,l,u=coe(this),p=doe(u,0),m=0;for(t=-1,i=arguments.length;t<i;t++)if(moe(l=t===-1?u:arguments[t]))for(o=loe(l),NM(m+o),n=0;n<o;n++,m++)n in l&&AM(p,m,l[n]);else NM(m+1),AM(p,m++,l);return p.length=m,p}});var OM={},foe=se,goe=Mn,PM=__.f,_oe=xl,DM=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];OM.f=function(e){return DM&&foe(e)==="Window"?function(t){try{return PM(t)}catch{return _oe(DM)}}(e):PM(goe(e))};var Yh={},yoe=or;Yh.f=yoe;var kM=vn,Eoe=cs,voe=Yh,boe=To.f,Ur=function(e){var t=kM.Symbol||(kM.Symbol={});Eoe(t,e)||boe(t,e,{value:voe.f(e)})},Soe=Re,xoe=Jn,woe=or,Toe=Sl,LM=function(){var e=xoe("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,i=woe("toPrimitive");t&&!t[i]&&Toe(t,i,function(o){return Soe(n,this)},{arity:1})},Coe=El,Roe=Jt,Noe=Xa,Aoe=vl,Ioe=CM,MM=R([].push),Al=function(e){var t=e===1,n=e===2,i=e===3,o=e===4,l=e===6,u=e===7,p=e===5||l;return function(m,g,y,b){for(var S,w,k=Noe(m),I=Roe(k),O=Aoe(I),W=Coe(g,y),H=0,Y=b||Ioe,Q=t?Y(m,O):n||u?Y(m,0):void 0;O>H;H++)if((p||H in I)&&(w=W(S=I[H],H,k),e))if(t)Q[H]=w;else if(w)switch(e){case 3:return!0;case 5:return S;case 6:return H;case 2:MM(Q,S)}else switch(e){case 4:return!1;case 7:MM(Q,S)}return l?-1:i||o?o:Q}},jM={forEach:Al(0),map:Al(1),filter:Al(2),some:Al(3),every:Al(4),find:Al(5),findIndex:Al(6),filterReject:Al(7)},my=Qt,wf=j,dT=Re,Ooe=R,qh=Se,Xh=De,Poe=f,Cs=cs,Doe=N,uT=pi,fy=Mn,hT=WS,koe=mi,pT=bt,Jh=rf,UM=E_,Loe=__,VM=OM,Moe=nf,FM=tt,BM=To,joe=dx,$M=le,WM=Sl,Uoe=P_,mT=Sh,GM=y_,HM=BS,Voe=or,Foe=Yh,Boe=Ur,$oe=LM,Woe=Uc,KM=Fd,gy=jM.forEach,Pi=g_("hidden"),_y="Symbol",Tf="prototype",Goe=KM.set,zM=KM.getterFor(_y),da=Object[Tf],qd=wf.Symbol,yy=qd&&qd[Tf],Hoe=wf.RangeError,Koe=wf.TypeError,fT=wf.QObject,YM=FM.f,Xd=BM.f,qM=VM.f,zoe=$M.f,XM=Ooe([].push),Bc=mT("symbols"),Cf=mT("op-symbols"),Yoe=mT("wks"),gT=!fT||!fT[Tf]||!fT[Tf].findChild,JM=function(e,t,n){var i=YM(da,t);i&&delete da[t],Xd(e,t,n),i&&e!==da&&Xd(da,t,i)},_T=qh&&Poe(function(){return Jh(Xd({},"a",{get:function(){return Xd(this,"a",{value:7}).a}})).a!==7})?JM:Xd,yT=function(e,t){var n=Bc[e]=Jh(yy);return Goe(n,{type:_y,tag:e,description:t}),qh||(n.description=t),n},Ey=function(e,t,n){e===da&&Ey(Cf,t,n),uT(e);var i=hT(t);return uT(n),Cs(Bc,i)?(n.enumerable?(Cs(e,Pi)&&e[Pi][i]&&(e[Pi][i]=!1),n=Jh(n,{enumerable:pT(0,!1)})):(Cs(e,Pi)||Xd(e,Pi,pT(1,Jh(null))),e[Pi][i]=!0),_T(e,i,n)):Xd(e,i,n)},ET=function(e,t){uT(e);var n=fy(t),i=UM(n).concat(tj(n));return gy(i,function(o){qh&&!dT(QM,n,o)||Ey(e,o,n[o])}),e},QM=function(e){var t=hT(e),n=dT(zoe,this,t);return!(this===da&&Cs(Bc,t)&&!Cs(Cf,t))&&(!(n||!Cs(this,t)||!Cs(Bc,t)||Cs(this,Pi)&&this[Pi][t])||n)},ZM=function(e,t){var n=fy(e),i=hT(t);if(n!==da||!Cs(Bc,i)||Cs(Cf,i)){var o=YM(n,i);return!o||!Cs(Bc,i)||Cs(n,Pi)&&n[Pi][i]||(o.enumerable=!0),o}},ej=function(e){var t=qM(fy(e)),n=[];return gy(t,function(i){Cs(Bc,i)||Cs(GM,i)||XM(n,i)}),n},tj=function(e){var t=e===da,n=qM(t?Cf:fy(e)),i=[];return gy(n,function(o){!Cs(Bc,o)||t&&!Cs(da,o)||XM(i,Bc[o])}),i};Xh||(qd=function(){if(Doe(yy,this))throw new Koe("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?koe(arguments[0]):void 0,t=HM(e),n=function(i){var o=this===void 0?wf:this;o===da&&dT(n,Cf,i),Cs(o,Pi)&&Cs(o[Pi],t)&&(o[Pi][t]=!1);var l=pT(1,i);try{_T(o,t,l)}catch(u){if(!(u instanceof Hoe))throw u;JM(o,t,l)}};return qh&&gT&&_T(da,t,{configurable:!0,set:n}),yT(t,e)},WM(yy=qd[Tf],"toString",function(){return zM(this).tag}),WM(qd,"withoutSetter",function(e){return yT(HM(e),e)}),$M.f=QM,BM.f=Ey,joe.f=ET,FM.f=ZM,Loe.f=VM.f=ej,Moe.f=tj,Foe.f=function(e){return yT(Voe(e),e)},qh&&Uoe(yy,"description",{configurable:!0,get:function(){return zM(this).description}})),my({global:!0,constructor:!0,wrap:!0,forced:!Xh,sham:!Xh},{Symbol:qd}),gy(UM(Yoe),function(e){Boe(e)}),my({target:_y,stat:!0,forced:!Xh},{useSetter:function(){gT=!0},useSimple:function(){gT=!1}}),my({target:"Object",stat:!0,forced:!Xh,sham:!qh},{create:function(e,t){return t===void 0?Jh(e):ET(Jh(e),t)},defineProperty:Ey,defineProperties:ET,getOwnPropertyDescriptor:ZM}),my({target:"Object",stat:!0,forced:!Xh},{getOwnPropertyNames:ej}),$oe(),Woe(qd,_y),GM[Pi]=!0;var nj=De&&!!Symbol.for&&!!Symbol.keyFor,qoe=Qt,Xoe=Jn,Joe=cs,Qoe=mi,rj=Sh,Zoe=nj,vT=rj("string-to-symbol-registry"),eae=rj("symbol-to-string-registry");qoe({target:"Symbol",stat:!0,forced:!Zoe},{for:function(e){var t=Qoe(e);if(Joe(vT,t))return vT[t];var n=Xoe("Symbol")(t);return vT[t]=n,eae[n]=t,n}});var tae=Qt,nae=cs,rae=Rt,sae=ae,iae=nj,sj=Sh("symbol-to-string-registry");tae({target:"Symbol",stat:!0,forced:!iae},{keyFor:function(e){if(!rae(e))throw new TypeError(sae(e)+" is not a symbol");if(nae(sj,e))return sj[e]}});var ij=tf,oae=Ce,oj=se,aae=mi,aj=R([].push),cae=Qt,cj=Jn,lj=B,lae=Re,Rf=R,dj=f,uj=Ce,hj=Rt,pj=xl,dae=function(e){if(oae(e))return e;if(ij(e)){for(var t=e.length,n=[],i=0;i<t;i++){var o=e[i];typeof o=="string"?aj(n,o):typeof o!="number"&&oj(o)!=="Number"&&oj(o)!=="String"||aj(n,aae(o))}var l=n.length,u=!0;return function(p,m){if(u)return u=!1,m;if(ij(this))return m;for(var g=0;g<l;g++)if(n[g]===p)return m}}},uae=De,hae=String,Il=cj("JSON","stringify"),vy=Rf(/./.exec),mj=Rf("".charAt),pae=Rf("".charCodeAt),mae=Rf("".replace),fae=Rf(1.1.toString),gae=/[\uD800-\uDFFF]/g,fj=/^[\uD800-\uDBFF]$/,gj=/^[\uDC00-\uDFFF]$/,_j=!uae||dj(function(){var e=cj("Symbol")("stringify detection");return Il([e])!=="[null]"||Il({a:e})!=="{}"||Il(Object(e))!=="{}"}),yj=dj(function(){return Il("\uDF06\uD834")!=='"\\udf06\\ud834"'||Il("\uDEAD")!=='"\\udead"'}),_ae=function(e,t){var n=pj(arguments),i=dae(t);if(uj(i)||e!==void 0&&!hj(e))return n[1]=function(o,l){if(uj(i)&&(l=lae(i,this,hae(o),l)),!hj(l))return l},lj(Il,null,n)},yae=function(e,t,n){var i=mj(n,t-1),o=mj(n,t+1);return vy(fj,e)&&!vy(gj,o)||vy(gj,e)&&!vy(fj,i)?"\\u"+fae(pae(e,0),16):e};Il&&cae({target:"JSON",stat:!0,arity:3,forced:_j||yj},{stringify:function(e,t,n){var i=pj(arguments),o=lj(_j?_ae:Il,null,i);return yj&&typeof o=="string"?mae(o,gae,yae):o}});var Ej=nf,Eae=Xa;Qt({target:"Object",stat:!0,forced:!De||f(function(){Ej.f(1)})},{getOwnPropertySymbols:function(e){var t=Ej.f;return t?t(Eae(e)):[]}}),Ur("asyncDispose"),Ur("asyncIterator"),Ur("dispose"),Ur("hasInstance"),Ur("isConcatSpreadable"),Ur("iterator"),Ur("match"),Ur("matchAll"),Ur("replace"),Ur("search"),Ur("species"),Ur("split");var vae=LM;Ur("toPrimitive"),vae();var bae=Jn,Sae=Uc;Ur("toStringTag"),Sae(bae("Symbol"),"Symbol"),Ur("unscopables"),Uc(j.JSON,"JSON",!0);var xae=vn.Symbol,wae=or,Tae=To.f,vj=wae("metadata"),bj=Function.prototype;bj[vj]===void 0&&Tae(bj,vj,{value:null}),Ur("metadata");var Cae=xae,Rae=R,bT=Jn("Symbol"),Nae=bT.keyFor,Aae=Rae(bT.prototype.valueOf),Sj=bT.isRegisteredSymbol||function(e){try{return Nae(Aae(e))!==void 0}catch{return!1}};Qt({target:"Symbol",stat:!0},{isRegisteredSymbol:Sj});for(var Iae=Sh,xj=Jn,Oae=R,Pae=Rt,Dae=or,by=xj("Symbol"),wj=by.isWellKnownSymbol,Tj=xj("Object","getOwnPropertyNames"),kae=Oae(by.prototype.valueOf),Cj=Iae("wks"),ST=0,Rj=Tj(by),Lae=Rj.length;ST<Lae;ST++)try{var Nj=Rj[ST];Pae(by[Nj])&&Dae(Nj)}catch{}var Aj=function(e){if(wj&&wj(e))return!0;try{for(var t=kae(e),n=0,i=Tj(Cj),o=i.length;n<o;n++)if(Cj[i[n]]==t)return!0}catch{}return!1};Qt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Aj}),Ur("customMatcher"),Ur("observable"),Qt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:Sj}),Qt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:Aj}),Ur("matcher"),Ur("metadataKey"),Ur("patternMatch"),Ur("replaceAll");var Qh=h(Cae),Ij=h(Yh.f("iterator"));function Nf(e){return Nf=typeof Qh=="function"&&typeof Ij=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Qh=="function"&&t.constructor===Qh&&t!==Qh.prototype?"symbol":typeof t},Nf(e)}var Mae=h(Yh.f("toPrimitive"));function jae(e){var t=function(n,i){if(Nf(n)!="object"||!n)return n;var o=n[Mae];if(o!==void 0){var l=o.call(n,i||"default");if(Nf(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(e,"string");return Nf(t)=="symbol"?t:t+""}function D(e,t,n){return(t=jae(t))in e?xM(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Oj=h(ure),Uae={isBrowser:!0,classes:{URLSearchParams:Oj!==void 0?Oj:lT,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const xT=typeof window<"u"&&typeof document<"u",wT=typeof navigator=="object"&&navigator||void 0,Vae=xT&&(!wT||["ReactNative","NativeScript","NS"].indexOf(wT.product)<0),Fae=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Bae=xT&&window.location.href||"http://localhost";function Pj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Dj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Pj(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pj(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var Js=Dj(Dj({},Object.freeze({__proto__:null,hasBrowserEnv:xT,hasStandardBrowserEnv:Vae,hasStandardBrowserWebWorkerEnv:Fae,navigator:wT,origin:Bae})),Uae);function kj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function $ae(e,t){return py(e,new Js.classes.URLSearchParams,function(n){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?kj(Object(o),!0).forEach(function(l){D(n,l,o[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):kj(Object(o)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(o,l))})}return n}({visitor:function(n,i,o,l){return Js.isNode&&Te.isBuffer(n)?(this.append(i,n.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},t))}var Wae=rw.charAt,Lj=Re,Gae=pi,Hae=Ce,Kae=se,zae=/./.exec,Yae=TypeError,qae=Qt,Mj=Re,jj=de,Xae=wx,Sy=I_,Uj=ht,Vj=k2,Af=mi,Jae=pi,Qae=ln,Zae=se,ece=ZS,Fj=qw,tce=nn,nce=f,rce=Ix,sce=function(e,t,n){return t+(n?Wae(e,t).length:1)},ice=function(e,t){var n=e.exec;if(Hae(n)){var i=Lj(n,e,t);return i!==null&&Gae(i),i}if(Kae(e)==="RegExp")return Lj(zae,e,t);throw new Yae("RegExp#exec called on incompatible receiver")},Bj=Fd,oce=or("matchAll"),$j="RegExp String",Wj=$j+" Iterator",ace=Bj.set,cce=Bj.getterFor(Wj),lce=TypeError,TT=jj("".indexOf),xy=jj("".matchAll),CT=!!xy&&!nce(function(){xy("a",/./)}),dce=Xae(function(e,t,n,i){ace(this,{type:Wj,regexp:e,string:t,global:n,unicode:i,done:!1})},$j,function(){var e=cce(this);if(e.done)return Sy(void 0,!0);var t=e.regexp,n=e.string,i=ice(t,n);return i===null?(e.done=!0,Sy(void 0,!0)):e.global?(Af(i[0])===""&&(t.lastIndex=sce(n,Vj(t.lastIndex),e.unicode)),Sy(i,!1)):(e.done=!0,Sy(i,!1))}),Gj=function(e){var t,n,i,o=Jae(this),l=Af(e),u=rce(o,RegExp),p=Af(Fj(o));return t=new u(u===RegExp?o.source:o,p),n=!!~TT(p,"g"),i=!!~TT(p,"u"),t.lastIndex=Vj(o.lastIndex),new dce(t,l,n,i)};qae({target:"String",proto:!0,forced:CT},{matchAll:function(e){var t,n,i,o,l=Uj(this);if(Qae(e)){if(ece(e)&&(t=Af(Uj(Fj(e))),!~TT(t,"g")))throw new lce("`.matchAll` does not allow non-global regexes");if(CT)return xy(l,e);if((i=tce(e,oce))===void 0&&Zae(e)==="RegExp"&&(i=Gj),i)return Mj(i,e,l)}else if(CT)return xy(l,e);return n=Af(l),o=new RegExp(e,"g"),Mj(Gj,o,n)}});var uce=Qi("String","matchAll"),hce=N,pce=uce,RT=String.prototype,mce=function(e){var t=e.matchAll;return typeof e=="string"||e===RT||hce(RT,e)&&t===RT.matchAll?pce:t},fce=h(mce);function Hj(e){function t(n,i,o,l){let u=n[l++];if(u==="__proto__")return!0;const p=Number.isFinite(+u),m=l>=n.length;return u=!u&&Te.isArray(o)?o.length:u,m?(Te.hasOwnProp(o,u)?o[u]=[o[u],i]:o[u]=i,!p):(o[u]&&Te.isObject(o[u])||(o[u]=[]),t(n,i,o[u],l)&&Te.isArray(o[u])&&(o[u]=function(g){const y={},b=Object.keys(g);let S;const w=b.length;let k;for(S=0;S<w;S++)k=b[S],y[k]=g[k];return y}(o[u])),!p)}if(Te.isFormData(e)&&Te.isFunction(e.entries)){const n={};return Te.forEachEntry(e,(i,o)=>{t(function(l){return fce(Te).call(Te,/\w+|\[(\w*)]/g,l).map(u=>u[0]==="[]"?"":u[1]||u[0])}(i),o,n,0)}),n}return null}const NT={transitional:EM,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,o=Te.isObject(e);if(o&&Te.isHTMLForm(e)&&(e=new FormData(e)),Te.isFormData(e))return i?JSON.stringify(Hj(e)):e;if(Te.isArrayBuffer(e)||Te.isBuffer(e)||Te.isStream(e)||Te.isFile(e)||Te.isBlob(e)||Te.isReadableStream(e))return e;if(Te.isArrayBufferView(e))return e.buffer;if(Te.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return $ae(e,this.formSerializer).toString();if((l=Te.isFileList(e))||n.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return py(l?{"files[]":e}:e,u&&new u,this.formSerializer)}}return o||i?(t.setContentType("application/json",!1),function(u,p,m){if(Te.isString(u))try{return(p||JSON.parse)(u),Ts(Te).call(Te,u)}catch(g){if(g.name!=="SyntaxError")throw g}return(0,JSON.stringify)(u)}(e)):e}],transformResponse:[function(e){const t=this.transitional||NT.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(Te.isResponse(e)||Te.isReadableStream(e))return e;if(e&&Te.isString(e)&&(n&&!this.responseType||i)){const o=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e,this.parseReviver)}catch(l){if(o)throw l.name==="SyntaxError"?dn.from(l,dn.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Js.classes.FormData,Blob:Js.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Te.forEach(["delete","get","head","post","put","patch"],e=>{NT.headers[e]={}});var AT=NT;const gce=Te.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Kj=Symbol("internals");function If(e){var t;return e&&Ts(t=String(e)).call(t).toLowerCase()}function wy(e){return e===!1||e==null?e:Te.isArray(e)?e.map(wy):String(e)}function IT(e,t,n,i,o){return Te.isFunction(i)?i.call(this,t,n):(o&&(t=n),Te.isString(t)?Te.isString(i)?t.indexOf(i)!==-1:Te.isRegExp(i)?i.test(t):void 0:void 0)}class Ty{constructor(t){t&&this.set(t)}set(t,n,i){const o=this;function l(m,g,y){const b=If(g);if(!b)throw new Error("header name must be a non-empty string");const S=Te.findKey(o,b);(!S||o[S]===void 0||y===!0||y===void 0&&o[S]!==!1)&&(o[S||g]=wy(m))}const u=(m,g)=>Te.forEach(m,(y,b)=>l(y,b,g));if(Te.isPlainObject(t)||t instanceof this.constructor)u(t,n);else if(Te.isString(t)&&(t=Ts(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ts(p=t).call(p)))u((m=>{const g={};let y,b,S;return m&&m.split(`
`).forEach(function(w){var k,I;S=w.indexOf(":"),y=Ts(k=w.substring(0,S)).call(k).toLowerCase(),b=Ts(I=w.substring(S+1)).call(I),!y||g[y]&&gce[y]||(y==="set-cookie"?g[y]?g[y].push(b):g[y]=[b]:g[y]=g[y]?g[y]+", "+b:b)}),g})(t),n);else if(Te.isObject(t)&&Te.isIterable(t)){let m,g,y={};for(const b of t){if(!Te.isArray(b))throw TypeError("Object iterator must return a key-value pair");y[g=b[0]]=(m=y[g])?Te.isArray(m)?[...m,b[1]]:[m,b[1]]:b[1]}u(y,n)}else t!=null&&l(n,t,i);var p;return this}get(t,n){if(t=If(t)){const i=Te.findKey(this,t);if(i){const o=this[i];if(!n)return o;if(n===!0)return function(l){const u=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let m;for(;m=p.exec(l);)u[m[1]]=m[2];return u}(o);if(Te.isFunction(n))return n.call(this,o,i);if(Te.isRegExp(n))return n.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=If(t)){const i=Te.findKey(this,t);return!(!i||this[i]===void 0||n&&!IT(0,this[i],i,n))}return!1}delete(t,n){const i=this;let o=!1;function l(u){if(u=If(u)){const p=Te.findKey(i,u);!p||n&&!IT(0,i[p],p,n)||(delete i[p],o=!0)}}return Te.isArray(t)?t.forEach(l):l(t),o}clear(t){const n=Object.keys(this);let i=n.length,o=!1;for(;i--;){const l=n[i];t&&!IT(0,this[l],l,t,!0)||(delete this[l],o=!0)}return o}normalize(t){const n=this,i={};return Te.forEach(this,(o,l)=>{var u;const p=Te.findKey(i,l);if(p)return n[p]=wy(o),void delete n[l];const m=t?function(g){return Ts(g).call(g).toLowerCase().replace(/([a-z\d])(\w*)/g,(y,b,S)=>b.toUpperCase()+S)}(l):Ts(u=String(l)).call(u);m!==l&&delete n[l],n[m]=wy(o),i[m]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return Te.forEach(this,(i,o)=>{i!=null&&i!==!1&&(n[o]=t&&Te.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,i]=t;return n+": "+i}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var i=arguments.length,o=new Array(i>1?i-1:0),l=1;l<i;l++)o[l-1]=arguments[l];return o.forEach(u=>n.set(u)),n}static accessor(t){const n=(this[Kj]=this[Kj]={accessors:{}}).accessors,i=this.prototype;function o(l){const u=If(l);n[u]||(function(p,m){const g=Te.toCamelCase(" "+m);["get","set","has"].forEach(y=>{Object.defineProperty(p,y+g,{value:function(b,S,w){return this[y].call(this,m,b,S,w)},configurable:!0})})}(i,l),n[u]=!0)}return Te.isArray(t)?t.forEach(o):o(t),this}}Ty.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Te.reduceDescriptors(Ty.prototype,(e,t)=>{let{value:n}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(o){this[i]=o}}}),Te.freezeMethods(Ty);var ua=Ty;function OT(e,t){const n=this||AT,i=t||n,o=ua.from(i.headers);let l=i.data;return Te.forEach(e,function(u){l=u.call(n,l,o.normalize(),t?t.status:void 0)}),o.normalize(),l}function zj(e){return!(!e||!e.__CANCEL__)}function Zh(e,t,n){dn.call(this,e??"canceled",dn.ERR_CANCELED,t,n),this.name="CanceledError"}function Yj(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new dn("Request failed with status code "+n.status,[dn.ERR_BAD_REQUEST,dn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Te.inherits(Zh,dn,{__CANCEL__:!0});const Cy=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const o=function(l,u){l=l||10;const p=new Array(l),m=new Array(l);let g,y=0,b=0;return u=u!==void 0?u:1e3,function(S){const w=Date.now(),k=m[b];g||(g=w),p[y]=S,m[y]=w;let I=b,O=0;for(;I!==y;)O+=p[I++],I%=l;if(y=(y+1)%l,y===b&&(b=(b+1)%l),w-g<u)return;const W=k&&w-k;return W?Math.round(1e3*O/W):void 0}}(50,250);return function(l,u){let p,m,g=0,y=1e3/u;const b=function(S){g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),p=null,m&&(clearTimeout(m),m=null),l(...S)};return[function(){const S=Date.now(),w=S-g;for(var k=arguments.length,I=new Array(k),O=0;O<k;O++)I[O]=arguments[O];w>=y?b(I,S):(p=I,m||(m=setTimeout(()=>{m=null,b(p)},y-w)))},()=>p&&b(p)]}(l=>{const u=l.loaded,p=l.lengthComputable?l.total:void 0,m=u-i,g=o(m);i=u,e({loaded:u,total:p,progress:p?u/p:void 0,bytes:m,rate:g||void 0,estimated:g&&p&&u<=p?(p-u)/g:void 0,event:l,lengthComputable:p!=null,[t?"download":"upload"]:!0})},n)},qj=(e,t)=>{const n=e!=null;return[i=>t[0]({lengthComputable:n,total:e,loaded:i}),t[1]]},Xj=e=>function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Te.asap(()=>e(...n))};var _ce=Js.hasStandardBrowserEnv?((e,t)=>n=>(n=new ty(n,Js.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new ty(Js.origin),Js.navigator&&/(msie|trident)/i.test(Js.navigator.userAgent)):()=>!0,yce=Js.hasStandardBrowserEnv?{write(e,t,n,i,o,l,u){if(typeof document>"u")return;const p=["".concat(e,"=").concat(encodeURIComponent(t))];Te.isNumber(n)&&p.push("expires=".concat(new Date(n).toUTCString())),Te.isString(i)&&p.push("path=".concat(i)),Te.isString(o)&&p.push("domain=".concat(o)),l===!0&&p.push("secure"),Te.isString(u)&&p.push("SameSite=".concat(u)),document.cookie=p.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function Jj(e,t,n){let i=!function(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}(t);return e&&(i||n==0)?function(o,l){return l?o.replace(/\/?\/$/,"")+"/"+l.replace(/^\/+/,""):o}(e,t):t}function Qj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function PT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Qj(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qj(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Zj=e=>e instanceof ua?PT({},e):e;function Jd(e,t){t=t||{};const n={};function i(g,y,b,S){return Te.isPlainObject(g)&&Te.isPlainObject(y)?Te.merge.call({caseless:S},g,y):Te.isPlainObject(y)?Te.merge({},y):Te.isArray(y)?y.slice():y}function o(g,y,b,S){return Te.isUndefined(y)?Te.isUndefined(g)?void 0:i(void 0,g,0,S):i(g,y,0,S)}function l(g,y){if(!Te.isUndefined(y))return i(void 0,y)}function u(g,y){return Te.isUndefined(y)?Te.isUndefined(g)?void 0:i(void 0,g):i(void 0,y)}function p(g,y,b){return b in t?i(g,y):b in e?i(void 0,g):void 0}const m={url:l,method:l,data:l,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:p,headers:(g,y,b)=>o(Zj(g),Zj(y),0,!0)};return Te.forEach(Object.keys(PT(PT({},e),t)),function(g){const y=m[g]||o,b=y(e[g],t[g],g);Te.isUndefined(b)&&y!==p||(n[g]=b)}),n}var e5=e=>{const t=Jd({},e);let{data:n,withXSRFToken:i,xsrfHeaderName:o,xsrfCookieName:l,headers:u,auth:p}=t;if(t.headers=u=ua.from(u),t.url=_M(Jj(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),p&&u.set("Authorization","Basic "+btoa((p.username||"")+":"+(p.password?unescape(encodeURIComponent(p.password)):""))),Te.isFormData(n)){if(Js.hasStandardBrowserEnv||Js.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if(Te.isFunction(n.getHeaders)){const m=n.getHeaders(),g=["content-type","content-length"];Object.entries(m).forEach(y=>{let[b,S]=y;fe(g).call(g,b.toLowerCase())&&u.set(b,S)})}}if(Js.hasStandardBrowserEnv&&(i&&Te.isFunction(i)&&(i=i(t)),i||i!==!1&&_ce(t.url))){const m=o&&l&&yce.read(l);m&&u.set(o,m)}return t},Ece=typeof XMLHttpRequest<"u"&&function(e){return new xe(function(t,n){const i=e5(e);let o=i.data;const l=ua.from(i.headers).normalize();let u,p,m,g,y,{responseType:b,onUploadProgress:S,onDownloadProgress:w}=i;function k(){g&&g(),y&&y(),i.cancelToken&&i.cancelToken.unsubscribe(u),i.signal&&i.signal.removeEventListener("abort",u)}let I=new XMLHttpRequest;function O(){if(!I)return;const H=ua.from("getAllResponseHeaders"in I&&I.getAllResponseHeaders());Yj(function(Y){t(Y),k()},function(Y){n(Y),k()},{data:b&&b!=="text"&&b!=="json"?I.response:I.responseText,status:I.status,statusText:I.statusText,headers:H,config:e,request:I}),I=null}I.open(i.method.toUpperCase(),i.url,!0),I.timeout=i.timeout,"onloadend"in I?I.onloadend=O:I.onreadystatechange=function(){I&&I.readyState===4&&(I.status!==0||I.responseURL&&I.responseURL.indexOf("file:")===0)&&setTimeout(O)},I.onabort=function(){I&&(n(new dn("Request aborted",dn.ECONNABORTED,e,I)),I=null)},I.onerror=function(H){const Y=new dn(H&&H.message?H.message:"Network Error",dn.ERR_NETWORK,e,I);Y.event=H||null,n(Y),I=null},I.ontimeout=function(){let H=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const Y=i.transitional||EM;i.timeoutErrorMessage&&(H=i.timeoutErrorMessage),n(new dn(H,Y.clarifyTimeoutError?dn.ETIMEDOUT:dn.ECONNABORTED,e,I)),I=null},o===void 0&&l.setContentType(null),"setRequestHeader"in I&&Te.forEach(l.toJSON(),function(H,Y){I.setRequestHeader(Y,H)}),Te.isUndefined(i.withCredentials)||(I.withCredentials=!!i.withCredentials),b&&b!=="json"&&(I.responseType=i.responseType),w&&([m,y]=Cy(w,!0),I.addEventListener("progress",m)),S&&I.upload&&([p,g]=Cy(S),I.upload.addEventListener("progress",p),I.upload.addEventListener("loadend",g)),(i.cancelToken||i.signal)&&(u=H=>{I&&(n(!H||H.type?new Zh(null,e,I):H),I.abort(),I=null)},i.cancelToken&&i.cancelToken.subscribe(u),i.signal&&(i.signal.aborted?u():i.signal.addEventListener("abort",u)));const W=function(H){const Y=/^([-+\w]{1,25})(:?\/\/|:)/.exec(H);return Y&&Y[1]||""}(i.url);W&&Js.protocols.indexOf(W)===-1?n(new dn("Unsupported protocol "+W+":",dn.ERR_BAD_REQUEST,e)):I.send(o||null)})},vce=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let i,o=new AbortController;const l=function(g){if(!i){i=!0,p();const y=g instanceof Error?g:this.reason;o.abort(y instanceof dn?y:new Zh(y instanceof Error?y.message:y))}};let u=t&&setTimeout(()=>{u=null,l(new dn("timeout ".concat(t," of ms exceeded"),dn.ETIMEDOUT))},t);const p=()=>{e&&(u&&clearTimeout(u),u=null,e.forEach(g=>{g.unsubscribe?g.unsubscribe(l):g.removeEventListener("abort",l)}),e=null)};e.forEach(g=>g.addEventListener("abort",l));const{signal:m}=o;return m.unsubscribe=()=>Te.asap(p),m}},DT=h(UD),t5=Yh.f("asyncIterator"),bce=h(t5);function kT(e,t){this.v=e,this.k=t}function Ls(e){return function(){return new Of(e.apply(this,arguments))}}function Of(e){var t,n;function i(l,u){try{var p=e[l](u),m=p.value,g=m instanceof kT;DT.resolve(g?m.v:m).then(function(y){if(g){var b=l==="return"?"return":"next";if(!m.k||y.done)return i(b,y);y=e[b](y).value}o(p.done?"return":"normal",y)},function(y){i("throw",y)})}catch(y){o("throw",y)}}function o(l,u){switch(l){case"return":t.resolve({value:u,done:!0});break;case"throw":t.reject(u);break;default:t.resolve({value:u,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(l,u){return new DT(function(p,m){var g={key:l,arg:u,resolve:p,reject:m,next:null};n?n=n.next=g:(t=n=g,i(l,u))})},typeof e.return!="function"&&(this.return=void 0)}function Tt(e){return new kT(e,0)}function ep(e){var t={},n=!1;function i(o,l){return n=!0,l=new DT(function(u){u(e[o](l))}),{done:!1,value:new kT(l,1)}}return t[Qh!==void 0&&Ij||"@@iterator"]=function(){return this},t.next=function(o){return n?(n=!1,o):i("next",o)},typeof e.throw=="function"&&(t.throw=function(o){if(n)throw n=!1,o;return i("throw",o)}),typeof e.return=="function"&&(t.return=function(o){return n?(n=!1,o):i("return",o)}),t}Of.prototype[typeof Qh=="function"&&bce||"@@asyncIterator"]=function(){return this},Of.prototype.next=function(e){return this._invoke("next",e)},Of.prototype.throw=function(e){return this._invoke("throw",e)},Of.prototype.return=function(e){return this._invoke("return",e)};var Ry=h(t5);function LT(e){var t,n,i,o=2;for(typeof Symbol<"u"&&(n=Ry,i=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new Ny(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Ny(e){function t(n){if(Object(n)!==n)return xe.reject(new TypeError(n+" is not an object."));var i=n.done;return xe.resolve(n.value).then(function(o){return{value:o,done:i}})}return Ny=function(n){this.s=n,this.n=n.next},Ny.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?xe.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?xe.reject(n):t(i.apply(this.s,arguments))}},new Ny(e)}const Sce=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let i,o=0;for(;o<n;)i=o+t,yield e.slice(o,i),o=i},xce=function(){var e=Ls(function*(t,n){var i,o=!1,l=!1;try{for(var u,p=LT(wce(t));o=!(u=yield Tt(p.next())).done;o=!1){const m=u.value;yield*ep(LT(Sce(m,n)))}}catch(m){l=!0,i=m}finally{try{o&&p.return!=null&&(yield Tt(p.return()))}finally{if(l)throw i}}});return function(t,n){return e.apply(this,arguments)}}(),wce=function(){var e=Ls(function*(t){if(t[Ry])return void(yield*ep(LT(t)));const n=t.getReader();try{for(;;){const{done:i,value:o}=yield Tt(n.read());if(i)break;yield o}}finally{yield Tt(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),n5=(e,t,n,i)=>{const o=xce(e,t);let l,u=0,p=m=>{l||(l=!0,i&&i(m))};return new ReadableStream({async pull(m){try{const{done:g,value:y}=await o.next();if(g)return p(),void m.close();let b=y.byteLength;if(n){let S=u+=b;n(S)}m.enqueue(new Uint8Array(y))}catch(g){throw p(g),g}},cancel:m=>(p(m),o.return())},{highWaterMark:2})};function r5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function s5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?r5(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r5(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const{isFunction:Ay}=Te,Tce=(e=>{let{Request:t,Response:n}=e;return{Request:t,Response:n}})(Te.global),{ReadableStream:i5,TextEncoder:o5}=Te.global,a5=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return!!e(...n)}catch{return!1}},Cce=e=>{e=Te.merge.call({skipUndefined:!0},Tce,e);const{fetch:t,Request:n,Response:i}=e,o=t?Ay(t):typeof fetch=="function",l=Ay(n),u=Ay(i);if(!o)return!1;const p=o&&Ay(i5),m=o&&(typeof o5=="function"?(g=new o5,k=>g.encode(k)):async k=>new Uint8Array(await new n(k).arrayBuffer()));var g;const y=l&&p&&a5(()=>{let k=!1;const I=new n(Js.origin,{body:new i5,method:"POST",get duplex(){return k=!0,"half"}}).headers.has("Content-Type");return k&&!I}),b=u&&p&&a5(()=>Te.isReadableStream(new i("").body)),S={stream:b&&(k=>k.body)};o&&["text","arrayBuffer","blob","formData","stream"].forEach(k=>{!S[k]&&(S[k]=(I,O)=>{let W=I&&I[k];if(W)return W.call(I);throw new dn("Response type '".concat(k,"' is not supported"),dn.ERR_NOT_SUPPORT,O)})});const w=async(k,I)=>{const O=Te.toFiniteNumber(k.getContentLength());return O??(async W=>W==null?0:Te.isBlob(W)?W.size:Te.isSpecCompliantForm(W)?(await new n(Js.origin,{method:"POST",body:W}).arrayBuffer()).byteLength:Te.isArrayBufferView(W)||Te.isArrayBuffer(W)?W.byteLength:(Te.isURLSearchParams(W)&&(W+=""),Te.isString(W)?(await m(W)).byteLength:void 0))(I)};return async k=>{let{url:I,method:O,data:W,signal:H,cancelToken:Y,timeout:Q,onDownloadProgress:Z,onUploadProgress:q,responseType:ee,headers:ce,withCredentials:me="same-origin",fetchOptions:Oe}=e5(k),ot=t||fetch;ee=ee?(ee+"").toLowerCase():"text";let it=vce([H,Y&&Y.toAbortSignal()],Q),wt=null;const yt=it&&it.unsubscribe&&(()=>{it.unsubscribe()});let Kt;try{if(q&&y&&O!=="get"&&O!=="head"&&(Kt=await w(ce,W))!==0){let A,z=new n(I,{method:"POST",body:W,duplex:"half"});if(Te.isFormData(W)&&(A=z.headers.get("content-type"))&&ce.setContentType(A),z.body){const[X,_e]=qj(Kt,Cy(Xj(q)));W=n5(z.body,65536,X,_e)}}Te.isString(me)||(me=me?"include":"omit");const An=l&&"credentials"in n.prototype,he=s5(s5({},Oe),{},{signal:it,method:O.toUpperCase(),headers:ce.normalize().toJSON(),body:W,duplex:"half",credentials:An?me:void 0});wt=l&&new n(I,he);let Ee=await(l?ot(wt,Oe):ot(I,he));const je=b&&(ee==="stream"||ee==="response");if(b&&(Z||je&&yt)){const A={};["status","statusText","headers"].forEach(mt=>{A[mt]=Ee[mt]});const z=Te.toFiniteNumber(Ee.headers.get("content-length")),[X,_e]=Z&&qj(z,Cy(Xj(Z),!0))||[];Ee=new i(n5(Ee.body,65536,X,()=>{_e&&_e(),yt&&yt()}),A)}ee=ee||"text";let pe=await S[Te.findKey(S,ee)||"text"](Ee,k);return!je&&yt&&yt(),await new xe((A,z)=>{Yj(A,z,{data:pe,headers:ua.from(Ee.headers),status:Ee.status,statusText:Ee.statusText,config:k,request:wt})})}catch(An){throw yt&&yt(),An&&An.name==="TypeError"&&/Load failed|fetch/i.test(An.message)?Object.assign(new dn("Network Error",dn.ERR_NETWORK,k,wt),{cause:An.cause||An}):dn.from(An,An&&An.code,k,wt)}}},Rce=new Map,c5=e=>{let t=e&&e.env||{};const{fetch:n,Request:i,Response:o}=t,l=[i,o,n];let u,p,m=l.length,g=Rce;for(;m--;)u=l[m],p=g.get(u),p===void 0&&g.set(u,p=m?new Map:Cce(t)),g=p;return p};c5();const MT={http:null,xhr:Ece,fetch:{get:c5}};Te.forEach(MT,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const l5=e=>"- ".concat(e),Nce=e=>Te.isFunction(e)||e===null||e===!1;var d5={getAdapter:function(e,t){e=Te.isArray(e)?e:[e];const{length:n}=e;let i,o;const l={};for(let u=0;u<n;u++){let p;if(i=e[u],o=i,!Nce(i)&&(o=MT[(p=String(i)).toLowerCase()],o===void 0))throw new dn("Unknown adapter '".concat(p,"'"));if(o&&(Te.isFunction(o)||(o=o.get(t))))break;l[p||"#"+u]=o}if(!o){const u=Object.entries(l).map(p=>{let[m,g]=p;return"adapter ".concat(m," ")+(g===!1?"is not supported by the environment":"is not available in the build")});throw new dn("There is no suitable adapter to dispatch the request "+(n?u.length>1?`since :
`+u.map(l5).join(`
`):" "+l5(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:MT};function jT(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Zh(null,e)}function u5(e){return jT(e),e.headers=ua.from(e.headers),e.data=OT.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),d5.getAdapter(e.adapter||AT.adapter,e)(e).then(function(t){return jT(e),t.data=OT.call(e,e.transformResponse,t),t.headers=ua.from(t.headers),t},function(t){return zj(t)||(jT(e),t&&t.response&&(t.response.data=OT.call(e,e.transformResponse,t.response),t.response.headers=ua.from(t.response.headers))),xe.reject(t)})}const h5="1.13.2",Iy={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Iy[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const p5={};Iy.transitional=function(e,t,n){function i(o,l){return"[Axios v"+h5+"] Transitional option '"+o+"'"+l+(n?". "+n:"")}return(o,l,u)=>{if(e===!1)throw new dn(i(l," has been removed"+(t?" in "+t:"")),dn.ERR_DEPRECATED);return t&&!p5[l]&&(p5[l]=!0,console.warn(i(l," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(o,l,u)}},Iy.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var Oy={assertOptions:function(e,t,n){if(typeof e!="object")throw new dn("options must be an object",dn.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let o=i.length;for(;o-- >0;){const l=i[o],u=t[l];if(u){const p=e[l],m=p===void 0||u(p,l,e);if(m!==!0)throw new dn("option "+l+" must be "+m,dn.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new dn("Unknown option "+l,dn.ERR_BAD_OPTION)}},validators:Iy};const ec=Oy.validators;let Py=class{constructor(e){this.defaults=e||{},this.interceptors={request:new yM,response:new yM}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const o=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Jd(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:o}=t;n!==void 0&&Oy.assertOptions(n,{silentJSONParsing:ec.transitional(ec.boolean),forcedJSONParsing:ec.transitional(ec.boolean),clarifyTimeoutError:ec.transitional(ec.boolean)},!1),i!=null&&(Te.isFunction(i)?t.paramsSerializer={serialize:i}:Oy.assertOptions(i,{encode:ec.function,serialize:ec.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Oy.assertOptions(t,{baseUrl:ec.spelling("baseURL"),withXsrfToken:ec.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let l=o&&Te.merge(o.common,o[t.method]);o&&Te.forEach(["delete","get","head","post","put","patch","common"],w=>{delete o[w]}),t.headers=ua.concat(l,o);const u=[];let p=!0;this.interceptors.request.forEach(function(w){typeof w.runWhen=="function"&&w.runWhen(t)===!1||(p=p&&w.synchronous,u.unshift(w.fulfilled,w.rejected))});const m=[];let g;this.interceptors.response.forEach(function(w){m.push(w.fulfilled,w.rejected)});let y,b=0;if(!p){const w=[u5.bind(this),void 0];for(w.unshift(...u),w.push(...m),y=w.length,g=xe.resolve(t);b<y;)g=g.then(w[b++],w[b++]);return g}y=u.length;let S=t;for(;b<y;){const w=u[b++],k=u[b++];try{S=w(S)}catch(I){k.call(this,I);break}}try{g=u5.call(this,S)}catch(w){return xe.reject(w)}for(b=0,y=m.length;b<y;)g=g.then(m[b++],m[b++]);return g}getUri(e){return _M(Jj((e=Jd(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Te.forEach(["delete","get","head","options"],function(e){Py.prototype[e]=function(t,n){return this.request(Jd(n||{},{method:e,url:t,data:(n||{}).data}))}}),Te.forEach(["post","put","patch"],function(e){function t(n){return function(i,o,l){return this.request(Jd(l||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}Py.prototype[e]=t(),Py.prototype[e+"Form"]=t(!0)});var Dy=Py;class UT{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new xe(function(o){n=o});const i=this;this.promise.then(o=>{if(!i._listeners)return;let l=i._listeners.length;for(;l-- >0;)i._listeners[l](o);i._listeners=null}),this.promise.then=o=>{let l;const u=new xe(p=>{i.subscribe(p),l=p}).then(o);return u.cancel=function(){i.unsubscribe(l)},u},t(function(o,l,u){i.reason||(i.reason=new Zh(o,l,u),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=i=>{t.abort(i)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new UT(function(i){t=i}),cancel:t}}}var Ace=UT;const VT={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(VT).forEach(e=>{let[t,n]=e;VT[n]=t});var Ice=VT;const ls=function e(t){const n=new Dy(t),i=eM(Dy.prototype.request,n);return Te.extend(i,Dy.prototype,n,{allOwnKeys:!0}),Te.extend(i,n,null,{allOwnKeys:!0}),i.create=function(o){return e(Jd(t,o))},i}(AT);ls.Axios=Dy,ls.CanceledError=Zh,ls.CancelToken=Ace,ls.isCancel=zj,ls.VERSION=h5,ls.toFormData=py,ls.AxiosError=dn,ls.Cancel=ls.CanceledError,ls.all=function(e){return xe.all(e)},ls.spread=function(e){return function(t){return e.apply(null,t)}},ls.isAxiosError=function(e){return Te.isObject(e)&&e.isAxiosError===!0},ls.mergeConfig=Jd,ls.AxiosHeaders=ua,ls.formToJSON=e=>Hj(Te.isHTMLForm(e)?new FormData(e):e),ls.getAdapter=d5.getAdapter,ls.HttpStatusCode=Ice,ls.default=ls;var Ms=ls;const Oce=()=>{};function Pf(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Oce};return e.promise=new xe((t,n)=>{e.resolve=i=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(i),e.value=i)},e.reject=i=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(i))}}),e}const ky=new Map,Ly=new Map,tc=new Map;let Er=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Ht=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const m5=new pie;let ha=m5.getResult(),FT=null;function Ft(e){if(!FT){ha=m5.getResult();const t=function(p){if(p.engine.name==="Blink"&&p.browser.name!=="WeChat")return Ht.CHROME;switch(p.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ht.CHROME;case"Safari":case"Mobile Safari":return Ht.SAFARI;case"Edge":return Ht.EDGE;case"Firefox":return Ht.FIREFOX;case"QQ":case"QQBrowser":return Ht.QQ;case"Opera":return Ht.OPERA;case"WeChat":return Ht.WECHAT;default:return p.browser.name||""}}(ha),n=f5(ha),i=function(p){return p.os.name==="Windows"?p.os.version?p.os.name+" "+p.os.version:p.os.name:p.os.name||""}(ha),o=ha.os.version,l=f5(ha,!1),u=ha.device.type;if(!(t&&n&&i&&o))return{name:t,version:n,os:i,osVersion:o,browserVersion:l,deviceType:u};FT={name:t,version:n,os:i,osVersion:o,browserVersion:l,deviceType:u}}return FT}function f5(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function My(){return Ft().os}function g5(){const e=Ft();return"".concat(e.os," ").concat(e.osVersion)}function jy(){const e=Ft();return!!(ha.engine.name==="WebKit"&&e.os===Er.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Ht.SAFARI||ds()&&e.name!==Ht.SAFARI)}function $c(){return Ft().name===Ht.CHROME}function Nr(){return Ft().name===Ht.SAFARI}function _5(){const e=Ft();if(e.name!==Ht.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function y5(){return Ft().name===Ht.EDGE}function Sn(){return Ft().name===Ht.FIREFOX}function ds(){return Ft().os===Er.IOS}function pa(e){const t=Ft();return!(t.name!==Ht.CHROME||!t.osVersion)&&Number(t.version)>=e}function E5(e){const t=Ft();return!(t.name!==Ht.CHROME||!t.osVersion)&&Number(t.version)<e}function BT(e,t,n){const i=Ft();return!(i.name!==e||!i.osVersion)&&(n?Number(i.version)>=t&&Number(i.version)<=n:Number(i.version)===t)}function Ol(e){const t=Ft();return!(t.name!==Ht.EDGE||!t.osVersion)&&Number(t.version)>=e}function $T(e){const t=Ft();return!(t.name!==Ht.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function v5(e){const t=Ft();return!(t.name!==Ht.SAFARI||!t.osVersion)&&Number(t.version)>=e}function b5(e,t,n){const i=Ft();if(i.os!==Er.IOS||!i.osVersion)return!1;const o=i.osVersion.split(".");return t?Number(o[0])===e&&Number(o[1])>=t||Number(o[0])>e:Number(o[0])>=e}function S5(e,t,n){const i=Ft();if(i.os!==Er.IOS||!i.osVersion)return!1;const o=i.osVersion.split(".");return t&&Number(o[0])===e&&Number(o[1])<t||Number(o[0])<e}function WT(e,t,n){const i=Ft();if(i.name!==Ht.SAFARI||!i.osVersion||!i.browserVersion)return!1;const o=i.browserVersion.split(".");return t&&Number(o[0])===e&&Number(o[1])<t||Number(o[0])<e}function Qd(e){const t=Ft();return!(t.name!==Ht.OPERA||!t.osVersion)&&Number(t.version)>=e}function x5(){const e=Ft();if(e.os!==Er.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function tp(){const e=Ft();if(e.os!==Er.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function GT(){const e=Ft();if(e.os!==Er.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function w5(){const e=Ft();if(e.os!==Er.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Po(){return Nr()&&navigator.maxTouchPoints>0}function T5(){return Ft().name===Ht.WECHAT}function C5(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function R5(){const e=My();return function(){const{deviceType:t}=Ft();return t==="mobile"||t==="tablet"}()||e===Er.ANDROID||e===Er.IOS||e===Er.HARMONY_OS}function nc(){const e=Ft();return e.name!==Ht.EDGE&&e.name!==Ht.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Df(){return My()===Er.ANDROID}function kf(){const e=Ft();return Df()&&(e.name===Ht.CHROME||e.name===Ht.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function gt(e,t,n){return(t=function(i){var o=function(l,u){if(typeof l!="object"||!l)return l;var p=l[Symbol.toPrimitive];if(p!==void 0){var m=p.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(i);return typeof o=="symbol"?o:o+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function ye(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?N5(Object(n),!0).forEach(function(i){gt(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N5(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let G=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),oe=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),gt(this,"code",void 0),gt(this,"message",void 0),gt(this,"data",void 0),gt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Do(e,t){if(typeof e!="boolean")throw new oe(G.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Qn(e,t,n){if(!fe(n).call(n,e))throw new oe(G.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function un(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(o){return typeof o=="number"&&o%1==0}(e))throw new oe(G.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function HT(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new oe(G.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&un(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&un(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&un(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&un(e.ideal,"".concat(t,".ideal"),1,1/0)}else un(e,t,1,1/0)}function Vr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new oe(G.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!A5(e,n,i,o))throw new oe(G.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(o?" ASCII characters only.":""))}function Wc(e,t){if(!Array.isArray(e))throw new oe(G.INVALID_PARAMS,"".concat(t," should be an array"))}function jn(e){return e==null}function A5(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!i||function(o){if(typeof o!="string")return!1;for(let l=0;l<o.length;l+=1){const u=o.charCodeAt(l);if(u<0||u>255)return!1}return!0}(e))}function I5(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const i=e.getUint32(t,n),o=e.getUint32(t+4,n),l=+!!n,u=+!n;return BigInt(i*u+o*l)<<BigInt(32)|BigInt(i*l+o*u)}function O5(e,t,n,i){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,i);const o=Number(n>>BigInt(32)),l=Number(n&BigInt(4294967295));e.setUint32(t,o,i),e.setUint32(t+4,l,i)}var Lf=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Lf||{}),KT=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(KT||{});const P5=new class{constructor(){gt(this,"_clientSize",null),gt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),gt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),gt(this,"getStyle",e=>window.getComputedStyle(e,null)),gt(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const i=this.getStyle(e),{display:o,visibility:l,opacity:u,filter:p}=i;return(o==="none"||fe(t=["hidden","collapse"]).call(t,l)||Number(u)<.1)&&(n=!1),!!n&&(p&&p.split(" ").filter(m=>{var g;const y=m.split("(")[0];return fe(g=["brightness","blur","opacity"]).call(g,y)}).map(m=>{const[g,y]=m.split(/\(|\)/);return[g,Number(y.match(/^[0-9\.]+/))]}).forEach(m=>{const[g,y]=m;switch(g){case"brightness":(y<.1||y>3)&&(n=!1);break;case"blur":y>3&&(n=!1);break;case"opacity":y<.1&&(n=!1)}}),n)}),gt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,i=!0;const o=u=>t(u);let l=e;for(;l&&i;)o(l)||(n=!1,i=!1),l=l.parentElement,l||(i=!1);return n}),gt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),gt(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:i,right:o,top:l,bottom:u}=e.getBoundingClientRect(),p=this.getClientWidth(),m=this.getClientHeight();return{width:t,height:n,left:i,right:o,top:l,bottom:u,clientWidth:p,clientHeight:m,clientMin:Math.min(p,m)}}),gt(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),gt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),gt(this,"checkCoverForAPoint",(e,t,n)=>{const i=this.elementFromPoint(e,t);return i!==null&&i!==n}),gt(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:i}=this._clientSize,o=e/6,l=t/6,u=[],p=10**6;for(let m=0;m<5;m++)for(let g=0;g<5;g++){const y=(n*p+(m===0?.1:m===4?(o*m*p-1e5)/p:o*m)*p)/p,b=(i*p+(g===0?.1:g===4?(l*g*p-1e5)/p:l*g)*p)/p;u.push({x:y,y:b})}return[...u]}),gt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),gt(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),gt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:i,clientHeight:o,clientWidth:l,clientMin:u}=this._clientSize;let p,m,g,y;if(e<0)p=0;else{if(!(e<l))return!1;p=e}if(t<0)return!1;if(m=t<l?t:l,n<0)g=0;else{if(!(n<o))return!1;g=n}if(i<0)return!1;y=i<o?i:o;const b=m-p,S=y-g;return this.checkSizeIsVisible(b,S,u)}),gt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),gt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Lf.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(Lf.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Lf.SIZE)}}return this.returnHiddenResult(Lf.STYLE)}return this.returnHiddenResult(KT.UNMOUNTED)}return this.returnHiddenResult(KT.INVALID_HTML_ELEMENT)}),gt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function zT(e){return new TextEncoder().encode(e)}const D5=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},YT=async e=>function(t,n){let i="";return new Uint8Array(t).forEach(o=>{i+=o.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",zT(e)),16);let On=class{constructor(){gt(this,"_events",{}),gt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],i=this._indexOfListener(n,t);i!==-1&&n.splice(i,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(l=>l);for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];for(let l=0;l<t.length;l+=1){const u=t[l];u.once&&this.off(e,u.listener),u.listener.apply(this,i||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];[...this._events[e]||[]].forEach(o=>{o.once&&this.off(e,o.listener);try{o.listener.apply(this,n)}catch(l){console.error("safeEmit event:".concat(e," error ").concat(l==null?void 0:l.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},Mf=null;function k5(){if(Mf)return Mf;if(window.electron)return Mf=window.electron;if(!window.require)return null;try{return Mf=window.require("electron"),Mf}catch{return null}}let Rn=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e.VOS_FALLBACK_CN="vosFallbackCN",e.DATACHANNEL_FAILBACK="datachannelFailback",e}({}),hn=function(e){return e.TRACER="tracer",e}({});function L5(e){return un(e.timeout,"config.timeout",0,1e5),un(e.timeoutFactor,"config.timeoutFactor",0,100,!1),un(e.maxRetryCount,"config.maxRetryConfig",0,1/0),un(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Pce=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),kt=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.FALLBACK_TO_HLS="FALLBACK_TO_HLS",e.UID_CONFLICT="UID_CONFLICT",e}({});function Zd(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function M5(e){return Vr(e.turnServerURL,"turnServerURL"),Vr(e.username,"username"),Vr(e.password,"password"),e.udpport&&un(e.udpport,"udpport",1,99999,!0),e.forceturn&&Do(e.forceturn,"forceturn"),e.security&&Do(e.security,"security"),e.tcpport&&un(e.tcpport,"tcpport",1,99999,!0),!0}let np=function(e){return e[e.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",e[e.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",e[e.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",e}({});function qT(e){return e.level!==void 0&&Qn(e.level,"level",[1,2,3]),e.delay!==void 0&&un(e.delay,"delay",0,3e3,!0),!0}let Nt=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e.FALLBACK_TO_HLS="fallback-to-hls",e.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",e.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",e.AV1_DECODABLE_RESULT="av1-decodable-result",e}({}),XT=function(e){return e.CONFIG="config",e.VOSERROR="vos_error",e.AP_ERROR="ap_error",e}({}),Yr=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Rs=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),eu=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function ar(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return e.getListeners(t).length===0?xe.reject(new oe(G.UNEXPECTED_ERROR,"can not emit promise")):new xe((l,u)=>{e.emit(t,...i,l,u)})}function mn(e,t){if(e.getListeners(t).length===0)return xe.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return ar(e,t,...i)}function yi(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return tu(e,t,...i)}function tu(e,t){let n=null,i=null;for(var o=arguments.length,l=new Array(o>2?o-2:0),u=2;u<o;u++)l[u-2]=arguments[u];if(e.emit(t,...l,p=>{n=p},p=>{i=p}),i!==null)throw i;if(n===null)throw new oe(G.UNEXPECTED_ERROR,"handler is not sync");return n}const Un=new class extends On{set networkState(e){this.emit(eu.NETWORK_STATE_CHANGE,e,this._networkState),e===Rs.ONLINE?this.emit(eu.ONLINE):e===Rs.OFFLINE&&(this.onlineWaiter=new xe(t=>{this.once(eu.ONLINE,()=>{this.onlineWaiter=void 0,t(Rs.ONLINE)})}),this.emit(eu.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Rs.ONLINE}constructor(){super(),gt(this,"_moduleName","network-indicator"),gt(this,"_networkState",Rs.ONLINE),gt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Rs.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Rs.OFFLINE})}},js=[];for(let e=0;e<256;++e)js.push((e+256).toString(16).slice(1));const j5=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);let JT;const Dce=new Uint8Array(16);function kce(){return j5?j5():function(n,i,o){var l,u,p,m;const g=(l=(u=(n=n||{}).random)!==null&&u!==void 0?u:(p=(m=n).rng)===null||p===void 0?void 0:p.call(m))!==null&&l!==void 0?l:function(){if(!JT){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");JT=crypto.getRandomValues.bind(crypto)}return JT(Dce)}();if(g.length<16)throw new Error("Random bytes length must be >= 16");if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,i){if((o=o||0)<0||o+16>i.length)throw new RangeError("UUID byte range ".concat(o,":").concat(o+15," is out of buffer bounds"));for(let y=0;y<16;++y)i[o+y]=g[y];return i}return function(y){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(js[y[b+0]]+js[y[b+1]]+js[y[b+2]]+js[y[b+3]]+"-"+js[y[b+4]]+js[y[b+5]]+"-"+js[y[b+6]]+js[y[b+7]]+"-"+js[y[b+8]]+js[y[b+9]]+"-"+js[y[b+10]]+js[y[b+11]]+js[y[b+12]]+js[y[b+13]]+js[y[b+14]]+js[y[b+15]]).toLowerCase()}(g)}(e,t,void 0);var e,t}function Uy(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function rp(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function Vy(e){xe!==void 0?xe.resolve().then(e):setTimeout(e,0)}function xn(e){return JSON.parse(JSON.stringify(e))}function nu(e){try{return xn(e)}catch{return e}}const U5={};function Pl(e,t){U5[t]||(U5[t]=!0,e())}function ru(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)n[i]=t.charCodeAt(i);return n}function Dl(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function V5(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const i=new Uint8Array(t);i.set(n),n=i}return n}function F5(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=Zi(t).call(t,(u,p)=>u+p.length,0),o=new Uint8Array(new ArrayBuffer(i));let l=0;return t.forEach(u=>{o.set(u,l),l+=u.length}),o}function rc(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function B5(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?rc(n):n.size}),t+138}function Lce(e){const t=new oe(G.TIMEOUT,"timeout");return new xe((n,i)=>{window.setTimeout(()=>i(t),e)})}function vr(e){return new xe(t=>{window.setTimeout(t,e)})}function Zt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+Zt(e-n.length,"")}function su(){let e,t=!1;try{var n;e=hie(n=kce()).call(n,"-","")}catch{t=!0}return!t&&e&&e.length===32||(e=Zt(32,"")),e.toUpperCase()}const jf=()=>{},$5=new class{constructor(){gt(this,"fnMap",new Map)}throttleByKey(e,t,n,i){for(var o=arguments.length,l=new Array(o>4?o-4:0),u=4;u<o;u++)l[u-4]=arguments[u];if(this.fnMap.has(t)){const p=this.fnMap.get(t);if(p.threshold!==n){p.fn(...p.args),clearTimeout(p.timer);const m=window.setTimeout(()=>{const g=this.fnMap.get(t);g&&g.fn(...g.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:m,args:l,skipFn:i})}else p.skipFn&&p.skipFn(...p.args),this.fnMap.set(t,ye(ye({},p),{},{fn:e,args:l,skipFn:i}))}else{const p=window.setTimeout(()=>{const m=this.fnMap.get(t);m&&m.fn(...m.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:p,args:l,skipFn:i})}}},W5=$5.throttleByKey.bind($5);function G5(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function QT(e,t){if(!G5(e)||!G5(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let i=0;i<t.length;i++)n[i]=QT(e[i],t[i]);return n}{const n=ye({},e);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?n[i]=QT(e[i],t[i]):n[i]=t[i]);return n}}function H5(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let i=0;for(;e>0&&(n[i]=255&e,e>>=8,i++,i!==t););return n}function sp(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function ZT(e,t){try{return typeof e=="object"&&typeof t=="object"&&JSON.stringify(e)===JSON.stringify(t)}catch{return!1}}function eC(e){return Zi(e).call(e,(t,n)=>t+n,0)}function K5(e){const t="0123456789abcdef";function n(Y){let Q,Z="";for(Q=0;Q<=3;Q++)Z+=t.charAt(Y>>8*Q+4&15)+t.charAt(Y>>8*Q&15);return Z}function i(Y,Q){const Z=(65535&Y)+(65535&Q);return(Y>>16)+(Q>>16)+(Z>>16)<<16|65535&Z}function o(Y,Q,Z,q,ee,ce){return i(function(me,Oe){return me<<Oe|me>>>32-Oe}(i(i(Q,Y),i(q,ce)),ee),Z)}function l(Y,Q,Z,q,ee,ce,me){return o(Q&Z|~Q&q,Y,Q,ee,ce,me)}function u(Y,Q,Z,q,ee,ce,me){return o(Q&q|Z&~q,Y,Q,ee,ce,me)}function p(Y,Q,Z,q,ee,ce,me){return o(Q^Z^q,Y,Q,ee,ce,me)}function m(Y,Q,Z,q,ee,ce,me){return o(Z^(Q|~q),Y,Q,ee,ce,me)}const g=function(Y){let Q;const Z=1+(Y.length+8>>6),q=new Array(16*Z);for(Q=0;Q<16*Z;Q++)q[Q]=0;for(Q=0;Q<Y.length;Q++)q[Q>>2]|=Y.charCodeAt(Q)<<Q%4*8;return q[Q>>2]|=128<<Q%4*8,q[16*Z-2]=8*Y.length,q}(e);let y,b,S,w,k,I=1732584193,O=-271733879,W=-1732584194,H=271733878;for(y=0;y<g.length;y+=16)b=I,S=O,w=W,k=H,I=l(I,O,W,H,g[y+0],7,-680876936),H=l(H,I,O,W,g[y+1],12,-389564586),W=l(W,H,I,O,g[y+2],17,606105819),O=l(O,W,H,I,g[y+3],22,-1044525330),I=l(I,O,W,H,g[y+4],7,-176418897),H=l(H,I,O,W,g[y+5],12,1200080426),W=l(W,H,I,O,g[y+6],17,-1473231341),O=l(O,W,H,I,g[y+7],22,-45705983),I=l(I,O,W,H,g[y+8],7,1770035416),H=l(H,I,O,W,g[y+9],12,-1958414417),W=l(W,H,I,O,g[y+10],17,-42063),O=l(O,W,H,I,g[y+11],22,-1990404162),I=l(I,O,W,H,g[y+12],7,1804603682),H=l(H,I,O,W,g[y+13],12,-40341101),W=l(W,H,I,O,g[y+14],17,-1502002290),O=l(O,W,H,I,g[y+15],22,1236535329),I=u(I,O,W,H,g[y+1],5,-165796510),H=u(H,I,O,W,g[y+6],9,-1069501632),W=u(W,H,I,O,g[y+11],14,643717713),O=u(O,W,H,I,g[y+0],20,-373897302),I=u(I,O,W,H,g[y+5],5,-701558691),H=u(H,I,O,W,g[y+10],9,38016083),W=u(W,H,I,O,g[y+15],14,-660478335),O=u(O,W,H,I,g[y+4],20,-405537848),I=u(I,O,W,H,g[y+9],5,568446438),H=u(H,I,O,W,g[y+14],9,-1019803690),W=u(W,H,I,O,g[y+3],14,-187363961),O=u(O,W,H,I,g[y+8],20,1163531501),I=u(I,O,W,H,g[y+13],5,-1444681467),H=u(H,I,O,W,g[y+2],9,-51403784),W=u(W,H,I,O,g[y+7],14,1735328473),O=u(O,W,H,I,g[y+12],20,-1926607734),I=p(I,O,W,H,g[y+5],4,-378558),H=p(H,I,O,W,g[y+8],11,-2022574463),W=p(W,H,I,O,g[y+11],16,1839030562),O=p(O,W,H,I,g[y+14],23,-35309556),I=p(I,O,W,H,g[y+1],4,-1530992060),H=p(H,I,O,W,g[y+4],11,1272893353),W=p(W,H,I,O,g[y+7],16,-155497632),O=p(O,W,H,I,g[y+10],23,-1094730640),I=p(I,O,W,H,g[y+13],4,681279174),H=p(H,I,O,W,g[y+0],11,-358537222),W=p(W,H,I,O,g[y+3],16,-722521979),O=p(O,W,H,I,g[y+6],23,76029189),I=p(I,O,W,H,g[y+9],4,-640364487),H=p(H,I,O,W,g[y+12],11,-421815835),W=p(W,H,I,O,g[y+15],16,530742520),O=p(O,W,H,I,g[y+2],23,-995338651),I=m(I,O,W,H,g[y+0],6,-198630844),H=m(H,I,O,W,g[y+7],10,1126891415),W=m(W,H,I,O,g[y+14],15,-1416354905),O=m(O,W,H,I,g[y+5],21,-57434055),I=m(I,O,W,H,g[y+12],6,1700485571),H=m(H,I,O,W,g[y+3],10,-1894986606),W=m(W,H,I,O,g[y+10],15,-1051523),O=m(O,W,H,I,g[y+1],21,-2054922799),I=m(I,O,W,H,g[y+8],6,1873313359),H=m(H,I,O,W,g[y+15],10,-30611744),W=m(W,H,I,O,g[y+6],15,-1560198380),O=m(O,W,H,I,g[y+13],21,1309151649),I=m(I,O,W,H,g[y+4],6,-145523070),H=m(H,I,O,W,g[y+11],10,-1120210379),W=m(W,H,I,O,g[y+2],15,718787259),O=m(O,W,H,I,g[y+9],21,-343485551),I=i(I,b),O=i(O,S),W=i(W,w),H=i(H,k);return n(I)+n(O)+n(W)+n(H)}let Mce=1,z5=console,Ar=class{static setLogger(e){z5=e}constructor(e,t){gt(this,"id",void 0),gt(this,"lockingPromise",xe.resolve()),gt(this,"locks",0),gt(this,"name",""),gt(this,"lockId",void 0),this.lockId=Mce++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");z5.debug("".concat(n," ").concat(i))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new xe(o=>{t=()=>{this.locks-=1,this.logger("unlocked",e),o()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function ip(e,t){return function(n,i,o){const l=o.value;if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const u=this[t];if(!u)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const p=await u.lock("From ".concat(e,".").concat(i));try{for(var m=arguments.length,g=new Array(m),y=0;y<m;y++)g[y]=arguments[y];return await l.apply(this,g)}finally{p()}},o}}const Zn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Fy(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function ma(e,t,n,i){const o=Object.assign({},Zn,i);let l=o.timeout;const u=async()=>{await function(g){return new xe(y=>{window.setTimeout(y,g)})}(l),l*=o.timeoutFactor,l=Math.min(o.maxRetryTimeout,l)};let p=!1;const m=new xe(async(g,y)=>{t=t||(()=>!1),n=n||(()=>!0);for(let b=0;b<o.maxRetryCount;b+=1){if(p)return y(new oe(G.OPERATION_ABORTED));try{const S=await e();if(!t(S,b)||b+1===o.maxRetryCount)return g(S);await u()}catch(S){if(!n(S,b)||b+1===o.maxRetryCount)return y(S);await u()}}});return m.cancel=()=>p=!0,m}let By,tC=class{constructor(e){gt(this,"input",[]),gt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Zi(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},$y=0,nC=0;function rC(e,t,n,i){return new xe((o,l)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),$y+=rc(t.data)):n&&(t.data.size?$y+=t.data.size:t.data instanceof FormData?$y+=B5(t.data):$y+=rc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Ms.request(t).then(u=>{typeof u.data=="string"?nC+=rc(u.data):u.data instanceof ArrayBuffer||u.data instanceof Uint8Array?nC+=u.data.byteLength:nC+=rc(JSON.stringify(u.data)),o(u.data)}).catch(u=>{Ms.isCancel(u)?l(new oe(G.OPERATION_ABORTED,"cancel token canceled")):u.code==="ECONNABORTED"?l(new oe(G.NETWORK_TIMEOUT,u.message)):u.response?l(new oe(G.NETWORK_RESPONSE_ERROR,u.response.status)):l(new oe(G.NETWORK_ERROR,u.message))})})}async function jce(e,t){const n=new Blob([t.data],{type:"buffer"});return await rC(e,ye(ye({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const Y5=()=>window.isSecureContext!==void 0;function ko(e){if(Array.isArray(e))return e.map(n=>n);if(!q5(e))return e;const t={};for(const n in e){const i=e[n];q5(i)||Array.isArray(i)?t[n]=ko(i):t[n]=i}return t}function q5(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let sC=class{constructor(e){gt(this,"input",[]),gt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Lo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Uf={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:Lo,remoteCandidate:Lo},updateInterval:0},X5={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},J5={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},Q5={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},Z5={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let iC=class{constructor(e,t){gt(this,"onFirstVideoReceived",void 0),gt(this,"onFirstVideoDecoded",void 0),gt(this,"onFirstAudioReceived",void 0),gt(this,"onFirstVideoDecodedTimeout",void 0),gt(this,"onFirstAudioDecoded",void 0),gt(this,"onSelectedLocalCandidateChanged",void 0),gt(this,"onSelectedRemoteCandidateChanged",void 0),gt(this,"videoIsReady",!1),gt(this,"videoIsReady2",{}),gt(this,"pc",void 0),gt(this,"options",void 0),gt(this,"intervalTimer",void 0),gt(this,"stats",ko(Uf)),gt(this,"isFirstVideoReceived",{}),gt(this,"isFirstVideoDecoded",{}),gt(this,"isFirstAudioReceived",{}),gt(this,"isFirstAudioDecoded",{}),gt(this,"isFirstVideoDecodedTimeout",{}),gt(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new xe(e=>{e({local:ye({},Lo),remote:ye({},Lo)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,o=0,l=0,u=0;for(const p of n)e[p].forEach((m,g)=>{if(!this.lossRateWindowStats[t-1][p][g]||!this.lossRateWindowStats[0][p][g])return;const y=this.lossRateWindowStats[t-1][p][g].packets-this.lossRateWindowStats[0][p][g].packets,b=this.lossRateWindowStats[t-1][p][g].packetsLost-this.lossRateWindowStats[0][p][g].packetsLost;p==="videoSend"||p==="audioSend"?(i+=y,l+=b):(o+=y,u+=b),Number.isNaN(y)||Number.isNaN(y)?m.packetLostRate=0:m.packetLostRate=y<=0||b<=0?0:b/(y+b)});e.sendPacketLossRate=i<=0||l<=0?0:l/(i+l),e.recvPacketLossRate=o<=0||u<=0?0:u/(o+u)}},Uce=class extends iC{constructor(){super(...arguments),gt(this,"_stats",Uf),gt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=ko(Uf);const n=t.filter(o=>o.type==="ssrc");this.processSSRCStats(n);const i=t.find(o=>o.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const i=fe(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const o=ko(J5);o.codec=t.googCodecName,o.adaptionChangeReason="none",t.googCpuLimitedResolution&&(o.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(o.adaptionChangeReason="bandwidth"),o.avgEncodeMs=Number(t.googAvgEncodeMs),o.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},o.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},o.firsCount=Number(t.googFirReceived),o.nacksCount=Number(t.googNacksReceived),o.plisCount=Number(t.googPlisReceived),o.frameCount=Number(t.framesEncoded),o.bytes=Number(t.bytesSent),o.packets=Number(t.packetsSent),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(o),this._stats.rtt=o.rttMs;break}case"video_recv":{const o=ko(X5),l=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(o.codec=t.googCodecName,o.targetDelayMs=Number(t.googTargetDelayMs),o.renderDelayMs=Number(t.googRenderDelayMs),o.currentDelayMs=Number(t.googCurrentDelayMs),o.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),o.decodeMs=Number(t.googDecodeMs),o.maxDecodeMs=Number(t.googMaxDecodeMs),o.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},o.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},o.decodeFrameRate=Number(t.googFrameRateDecoded),o.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},o.jitterBufferMs=Number(t.googJitterBufferMs),o.firsCount=Number(t.googFirsSent),o.nacksCount=Number(t.googNacksSent),o.plisCount=Number(t.googPlisSent),o.framesDecodeCount=Number(t.framesDecoded),o.bytes=Number(t.bytesReceived),o.packets=Number(t.packetsReceived),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame.width,o.decodedFrame.height),this.isFirstVideoDecoded[o.ssrc]=!0),l){const u=l.stats,p=Date.now()-l.lts;o.framesDecodeFreezeTime=u.framesDecodeFreezeTime,o.framesDecodeInterval=u.framesDecodeInterval,o.framesDecodeCount>u.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(l.lts=Date.now(),o.framesDecodeInterval=p,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):o.framesDecodeCount<l.stats.framesDecodeCount&&(o.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:ye({},o),lts:Date.now()}),this._stats.videoRecv.push(o);break}case"audio_recv":{const o=ko(Z5);o.codec=t.googCodecName,o.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,o.decodingCNG=Number(t.googDecodingCNG),o.decodingCTN=Number(t.googDecodingCTN),o.decodingCTSG=Number(t.googDecodingCTSG),o.decodingNormal=Number(t.googDecodingNormal),o.decodingPLC=Number(t.googDecodingPLC),o.decodingPLCCNG=Number(t.googDecodingPLCCNG),o.expandRate=Number(t.googExpandRate),o.accelerateRate=Number(t.googAccelerateRate),o.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),o.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),o.speechExpandRate=Number(t.googSpeechExpandRate),o.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),o.jitterBufferMs=Number(t.googJitterBufferMs),o.jitterMs=Number(t.googJitterReceived),o.bytes=Number(t.bytesReceived),o.packets=Number(t.packetsReceived),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),o.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.decodingNormal>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),this._stats.audioRecv.push(o);break}case"audio_send":{const o=ko(Q5);o.codec=t.googCodecName,o.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,o.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),o.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),o.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),o.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),o.bytes=Number(t.bytesSent),o.packets=Number(t.packetsSent),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.rttMs=Number(t.googRtt||0),this._stats.rtt=o.rttMs,this._stats.audioSend.push(o);break}}})}_getStats(){return new xe((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(o=>{i[o]=n.stat(o)}),t.push(i)}),t}},op=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),Wy=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),oC=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Di=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var ap=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(ap||{});function Vf(e,t,n,i){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:ap.kNone;if(!t)return;const l=Number(t[n]);if(typeof l!="number")return;const u=Number(t[i]);if(typeof u!="number")return;if(!e)return u?l/u*o:void 0;const p=Number(e[n]);if(typeof p!="number")return;const m=Number(e[i]);if(typeof m!="number")return;const g=u-m;return g?(l-p)/g*o:void 0}let eU=class extends iC{constructor(){super(...arguments),gt(this,"_stats",Uf),gt(this,"report",void 0),gt(this,"lastDecodeVideoReceiverStats",new Map),gt(this,"lastVideoFramesRecv",new Map),gt(this,"lastVideoFramesSent",new Map),gt(this,"lastVideoFramesDecode",new Map),gt(this,"lastVideoFramesOutput",new Map),gt(this,"lastVideoJBDelay",new Map),gt(this,"lastAudioJBDelay",new Map),gt(this,"mediaBytesSent",new Map),gt(this,"mediaBytesRetransmit",new Map),gt(this,"mediaBytesTargetEncode",new Map),gt(this,"lastDecodeAudioReceiverStats",new Map),gt(this,"lastAudioConcealment",new Map),gt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ko(Uf),this.report.forEach(e=>{switch(e.type){case Di.OUTBOUND:case Di.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,i=!t&&!("frameWidth"in e);e.type===Di.OUTBOUND?t==="audio"||i?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===Di.INBOUND&&(t==="audio"||i?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case Di.TRANSPORT:{this.processTransportStats(e);const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Di.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:ye({},Lo),remote:ye({},Lo)};return e.forEach(n=>{let i;if(n.type===Di.TRANSPORT&&(i=e.get(n.selectedCandidatePairId)),n.type===Di.CANDIDATE_PAIR&&n.selected&&(i=n),i){const o=(l,u)=>{l.type=u.type,l.id=u.id,u.address&&(l.address=u.address),u.candidateType&&(l.candidateType=u.candidateType),u.port&&(l.port=u.port),u.priority&&(l.priority=u.priority),u.protocol&&(l.protocol=u.protocol),u.relayProtocol&&(l.relayProtocol=u.relayProtocol)};if(i.localCandidateId){const l=e.get(i.localCandidateId);l&&o(t.local,l)}if(i.remoteCandidateId){const l=e.get(i.remoteCandidateId);l&&o(t.remote,l)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Di.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Di.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Di.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ye({},t),ye({},this.stats.selectedCandidatePair.localCandidate)),e.type===Di.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ye({},t),ye({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(i=>i.ssrc===e.ssrc);t||(t=ko(Z5),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Vf(n,t,"totalProcessingDelay","jitterBufferEmittedCount",ap.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,ye({},t))}calculateAudioFreeze(e,t,n){const i=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&i!=null){const o=i.lts,l=n.timestamp,u=l-o;if(u<=0)return;const p=e.concealedSamples-t.concealedSamples-0,m=i.nonSilent+p,g=e.totalSamplesReceived-t.totalSamplesReceived;if(g<=0)return;const y=80*g/u,b=200*g/u,S=u/g;let w=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,m>y&&(i.plc80>0?(e.freezeSamples80+=p,e.freezeMs80+=Math.round(p*S)):(e.freezeSamples80+=m,e.freezeMs80+=Math.round(m*S)),w=i.plc80+1);let k=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,m>b&&(i.plc200>0?(e.freezeSamples200+=p,e.freezeMs200+=Math.round(p*S)):(e.freezeSamples200+=m,e.freezeMs200+=Math.round(m*S)),k=i.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:p,lts:l,plc80:w,plc200:k})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(u=>u.ssrc===e.ssrc);t||(t=ko(X5),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),i=this.lastVideoFramesDecode.get(t.ssrc),o=this.lastVideoFramesOutput.get(t.ssrc),l=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const u=t.decodedFrame?t.decodedFrame.width:0,p=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,u,p),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const u=n.stats,p=l-n.lts;t.framesDecodeFreezeTime=u.framesDecodeFreezeTime,t.framesDecodeInterval=u.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&p>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>u.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=p,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<u.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Vf(n==null?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Vf(n==null?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",ap.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Vf(n==null?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",ap.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Vf(n==null?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",ap.kMillisecondsFromSeconds),i&&l-i.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-i.count)/((l-i.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:t.decodeFrameRate})):i?t.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:0}),t.framesDroppedCount&&e.framesReceived&&(o&&l-o.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-o.count)/((l-o.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:Math.max(t.outputFrameRate,0)})):o?t.outputFrameRate=o.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:ye({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(i=>i.ssrc===e.ssrc);t||(t=ko(J5),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const i=new sC(10);i.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,i)}if(e.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{const o=new sC(10);o.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,o)}}if(e.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(e.ssrc);if(i)i.add(e.totalEncodedBytesTarget);else{const o=new sC(10);o.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,o)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const i=this.lastEncoderMs.get(e.ssrc);if(!i||i.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const o=e.framesEncoded-i.lastFrameCount,l=e.totalEncodeTime-i.lastEncoderTime;t.avgEncodeMs=1e3*l/o}}if(e.framesEncoded&&e.qpSum){const i=this.lastEncoderMs.get(e.ssrc);!i||i.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-i.lastQpSum)/(e.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const i=this.findRemoteStatsId(e.ssrc,Di.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=ko(Q5),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,Di.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processTransportStats(e){this._stats.transport.bytesReceived=e.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=e.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=e.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=e.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(e,t){var n;const i=Array.from(fi(n=this.report).call(n)).find(o=>o.type===t&&o.ssrc===e);return i?i.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var i,o,l,u;const p=t?this.report.get(t):void 0,m=(i=p==null?void 0:p.framesSent)!==null&&i!==void 0?i:e.framesSent;if(typeof m!="number")return;let g=(o=p==null?void 0:p.frameWidth)!==null&&o!==void 0?o:e.frameWidth,y=(l=p==null?void 0:p.frameHeight)!==null&&l!==void 0?l:e.frameHeight,b=(u=p==null?void 0:p.framesPerSecond)!==null&&u!==void 0?u:e.framesPerSecond;if(typeof g=="number"&&typeof y=="number"||(g=0,y=0),b==null){const S=Date.now(),w=this.lastVideoFramesSent.get(n.ssrc);w&&S-w.lts>=800?(b=Math.round((m-w.count)/((S-w.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:m,lts:S,rate:b})):w?b=w.rate:this.lastVideoFramesSent.set(n.ssrc,{count:m,lts:S,rate:0})}n.sentFrame={width:g,height:y,frameRate:Math.max(0,b)}}processVideoTrackReceiverStats(e,t,n){var i,o,l,u,p;const m=t?this.report.get(t):void 0,g=(i=m==null?void 0:m.framesReceived)!==null&&i!==void 0?i:e.framesReceived,y=(o=m==null?void 0:m.frameWidth)!==null&&o!==void 0?o:e.frameWidth,b=(l=m==null?void 0:m.frameHeight)!==null&&l!==void 0?l:e.frameHeight,S=(u=m==null?void 0:m.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,w=(p=m==null?void 0:m.jitterBufferEmittedCount)!==null&&p!==void 0?p:e.jitterBufferEmittedCount;if(typeof g=="number"){const k=this.lastVideoFramesRecv.get(n.ssrc),I=Date.now();n.framesReceivedCount=g;let O=0;k&&I-k.lts>=800?(O=Math.round((g-k.count)/((I-k.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:g,lts:I,rate:O})):k?O=k.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:g,lts:I,rate:0}),n.receivedFrame={width:y||0,height:b||0,frameRate:O||0},n.decodedFrame={width:y||0,height:b||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:y||0,height:b||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(S&&w){const k=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let I=k.jitterBufferMs;const O=w-k.jitterBufferEmittedCount;O>0&&(I=1e3*(S-k.jitterBufferDelay)/O),n.jitterBufferMs=I,n.currentDelayMs=Math.round(I),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:w,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var i,o,l,u;const p=t?this.report.get(t):void 0,m=(i=(o=p==null?void 0:p.echoReturnLoss)!==null&&o!==void 0?o:e.echoReturnLoss)!==null&&i!==void 0?i:0,g=(l=(u=p==null?void 0:p.echoReturnLossEnhancement)!==null&&u!==void 0?u:e.echoReturnLossEnhancement)!==null&&l!==void 0?l:0;n.aecReturnLoss=m,n.aecReturnLossEnhancement=g}processAudioTrackReceiverStats(e,t,n){var i,o,l,u,p,m,g,y,b;const S=t?this.report.get(t):void 0,w=(i=S==null?void 0:S.removedSamplesForAcceleration)!==null&&i!==void 0?i:e.removedSamplesForAcceleration,k=(o=S==null?void 0:S.totalSamplesReceived)!==null&&o!==void 0?o:e.totalSamplesReceived,I=(l=S==null?void 0:S.jitterBufferDelay)!==null&&l!==void 0?l:e.jitterBufferDelay,O=(u=S==null?void 0:S.jitterBufferEmittedCount)!==null&&u!==void 0?u:e.jitterBufferEmittedCount,W=(p=S==null?void 0:S.audioLevel)!==null&&p!==void 0?p:e==null?void 0:e.audioLevel,H=(m=S==null?void 0:S.totalSamplesDuration)!==null&&m!==void 0?m:e==null?void 0:e.totalSamplesDuration,Y=(g=S==null?void 0:S.concealedSamples)!==null&&g!==void 0?g:e.concealedSamples,Q=(y=S==null?void 0:S.silentConcealedSamples)!==null&&y!==void 0?y:e.silentConcealedSamples,Z=(b=S==null?void 0:S.concealmentEvents)!==null&&b!==void 0?b:e.concealmentEvents;if(typeof k=="number"&&(n.totalSamplesReceived=k),typeof Q=="number"&&(n.silentConcealedSamples=Q),typeof Z=="number"&&(n.concealmentEvents=Z),typeof Y=="number"&&(n.concealedSamples=Y),w&&k&&(n.accelerateRate=w/k),I&&O){const ee=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ce=ee.jitterBufferMs;const me=O-ee.jitterBufferEmittedCount;me>0&&(ce=1e3*(I-ee.jitterBufferDelay)/me),n.jitterBufferMs=Math.round(ce),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:O,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=W;let q=1920;H&&k&&(q=k/H/50,n.receivedFrames=Math.round(k/q)),Y&&(n.droppedFrames=Math.round(Y/q))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(o=>{e+=o.diffMean()}),this.mediaBytesRetransmit.forEach(o=>{t=t===null?o.diffMean():t+o.diffMean()}),this.mediaBytesTargetEncode.forEach(o=>{n=n===null?o.diffMean():n+o.diffMean()});const i=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},Vce=class extends iC{updateStats(){return xe.resolve()}};function Gy(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const l=function(){const u=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return u&&u[0]?Number(u[0].split("/")[1]):null}();return l?l<76?new Uce(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):new eU(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):function(u){if(!window.RTCStatsReport)return!1;const p=u.getStats();return!!(p instanceof xe||function(m){return!!m&&(typeof m=="object"||typeof m=="function")&&typeof m.then=="function"}(p))}(e)?new eU(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):new Vce(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o})}const tU="websdk_ng_install_id";function aC(){try{if($("INSTALL_ID"))return $("INSTALL_ID");let e=window.localStorage.getItem(tU);return e||(e=su(),window.localStorage.setItem(tU,e)),on("INSTALL_ID",e),e}catch{return}}const to=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],i=t[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.24.2"),cC=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let iu=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const qr=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),o=[];for(let p=0;p<6;p++)o.push("1");const l=o.join(""),u={};return u[e]=i,u[t]=l,Object.assign(u,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=qr;const Hy={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},lC={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},dC="v4.24.2-0-g002485b1-dirty(12/12/2025, 5:26:54 PM)",uC={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},en=ye(ye(ye(ye({},uC),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:lC,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Hy),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1,FORBID_MODIFY_LOCAL_OFFER_SDP:!1,RESERVE_MID_1_MLINE:!1});function on(e,t,n){var i,o,l;fe(i=Object.keys(en)).call(i,e)&&(!n&&fe(o=Object.keys(ki)).call(o,e)||(en[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(en.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(l=!!t,en.USE_NEW_NETWORK_CONFIG=l,l&&(en.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],en.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],en.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],en.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],en.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",en.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",en.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(en.ENABLE_INSTANT_VIDEO=!0,en.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(en.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(en.NEW_TURN_MODE||(en.NEW_TURN_MODE=4))))}function $(e){if(e==="TURN_DOMAINS"){const t=en.TURN_DOMAINS;return fe(t).call(t,$("TURN_DOMAIN"))?t:[$("TURN_DOMAIN")].concat(t)}return en[e]}cC||(en.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],en.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],en.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],en.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],en.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],en.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],en.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",en.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",en.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",en.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",en.AREAS=["NORTH_AMERICA","OVERSEA"]);let nU=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const ki={};var ct=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_RTE_URL="SET_RTE_URL",e.SET_RTE_SID="SET_RTE_SID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ct||{});let ou=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const rU=128,Fce=96,sU=1e3,cp=10;let Bce=0;var iU=(()=>{var e={8:(i,o,l)=>{l.r(o),l.d(o,{Parser:()=>me,Printer:()=>yt,parse:()=>Ee,print:()=>je});const u=`
`,p="".concat("\r").concat(u),m=" ";let g;function y(pe){return pe>="0"&&pe<="9"}function b(pe){return pe>="!"&&pe<="~"}function S(pe){return b(pe)||pe>=""&&pe<=""}function w(pe){return pe==="!"||pe>="#"&&pe<="'"||pe>="*"&&pe<="+"||pe>="-"&&pe<="."||pe>="0"&&pe<="9"||pe>="A"&&pe<="Z"||pe>="^"&&pe<="~"}function k(pe){return pe>="1"&&pe<="9"}function I(pe){return pe>="A"&&pe<="Z"||pe>="a"&&pe<="z"}function O(pe){return pe==="d"||pe==="h"||pe==="m"||pe==="s"}function W(pe){return pe>""&&pe<"	"||pe>"\v"&&pe<"\f"||pe>""&&pe<""}function H(pe){return I(pe)||y(pe)||pe==="+"||pe==="/"}function Y(pe){return y(pe)||I(pe)||pe==="+"||pe==="/"||pe==="-"||pe==="_"}function Q(pe){return I(pe)||y(pe)||pe==="+"||pe==="/"}function Z(pe,A){var z=Object.keys(pe);if(Object.getOwnPropertySymbols){var X=Object.getOwnPropertySymbols(pe);A&&(X=X.filter(function(_e){return Object.getOwnPropertyDescriptor(pe,_e).enumerable})),z.push.apply(z,X)}return z}function q(pe){for(var A=1;A<arguments.length;A++){var z=arguments[A]!=null?arguments[A]:{};A%2?Z(Object(z),!0).forEach(function(X){ee(pe,X,z[X])}):Object.getOwnPropertyDescriptors?Object.defineProperties(pe,Object.getOwnPropertyDescriptors(z)):Z(Object(z)).forEach(function(X){Object.defineProperty(pe,X,Object.getOwnPropertyDescriptor(z,X))})}return pe}function ee(pe,A,z){return A in pe?Object.defineProperty(pe,A,{value:z,enumerable:!0,configurable:!0,writable:!0}):pe[A]=z,pe}(function(pe){pe.VERSION="v",pe.ORIGIN="o",pe.SESSION_NAME="s",pe.INFORMATION="i",pe.URI="u",pe.EMAIL="e",pe.PHONE="p",pe.CONNECTION="c",pe.BANDWIDTH="b",pe.TIME="t",pe.REPEAT="r",pe.ZONE_ADJUSTMENTS="z",pe.KEY="k",pe.ATTRIBUTE="a",pe.MEDIA="m"})(g||(g={}));class ce{consumeText(A,z){let X=z;for(;X<A.length;){const _e=A[X];if(_e==="\0"||_e==="\r"||_e===u)break;X+=1}if(X-z==0)throw new Error("Invalid text, at ".concat(A));return X}consumeUnicastAddress(A,z,X){return this.consumeTill(A,z,m)}consumeOneOrMore(A,z,X){let _e=z;for(;X(A[_e]);)_e++;if(_e-z==0)throw new Error("Invalid rule at ".concat(z,"."));return _e}consumeSpace(A,z){if(A[z]===m)return z+1;throw new Error("Invalid space at ".concat(z,"."))}consumeIP4Address(A,z){let X=z;for(let _e=0;_e<4;_e++)if(X=this.consumeDecimalUChar(A,X),_e!==3){if(A[X]!==".")throw new Error("Invalid IP4 address.");X++}return X}consumeDecimalUChar(A,z){let X=z;for(let mt=0;mt<3&&y(A[X]);mt++,X++);if(X-z==0)throw new Error("Invalid decimal uchar.");const _e=parseInt(A.slice(z,X));if(_e>=0&&_e<=255)return X;throw new Error("Invalid decimal uchar")}consumeIP6Address(A,z){let X=this.consumeHexpart(A,z);return A[X]===":"&&(X+=1,X=this.consumeIP4Address(A,X)),X}consumeHexpart(A,z){let X=z;if(A[X]===":"&&A[X+1]===":"){X+=2;try{X=this.consumeHexseq(A,X)}catch{}return X}if(X=this.consumeHexseq(A,X),A[X]===":"&&A[X+1]===":"){X+=2;try{X=this.consumeHexseq(A,X)}catch{}return X}return X}consumeHexseq(A,z){let X=z;for(;X=this.consumeHex4(A,X),A[X]===":"&&A[X+1]!==":";)X+=1;return X}consumeHex4(A,z){let X=0;for(;X<4;X++)if(!((_e=A[z+X])>="0"&&_e<="9"||_e>="a"&&_e<="f"||_e>="A"&&_e<="F")){if(X===0)throw new Error("Invalid hex 4");break}var _e;return z+X}consumeFQDN(A,z){let X=z;for(;y(A[X])||I(A[X])||A[X]==="-"||A[X]===".";)X+=1;if(X-z<4)throw new Error("Invalid FQDN");return X}consumeExtnAddr(A,z){return this.consumeOneOrMore(A,z,S)}consumeMulticastAddress(A,z,X){switch(X){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(A,z);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(A,z);default:try{return this.consumeFQDN(A,z)}catch{return this.consumeExtnAddr(A,z)}}}consumeIP6MulticastAddress(A,z){const X=this.consumeHexpart(A,z);return A[X]==="/"?this.consumeInteger(A,X+1):X}consumeIP4MulticastAddress(A,z){let X=z+3;const _e=A.slice(z,X),mt=parseInt(_e);if(mt<224||mt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let gn=0;gn<3;gn++){if(A[X]!==".")throw new Error("Invalid IP4 multicast address.");X+=1,X=this.consumeDecimalUChar(A,X)}return A[X]==="/"&&(X+=1),X=this.consumeTTL(A,X),A[X]==="/"&&(X=this.consumeInteger(A,X)),X}consumeInteger(A,z){if(!k(A[z]))throw new Error("Invalid integer.");for(z+=1;y(A[z]);)z+=1;return z}consumeTTL(A,z){if(A[z]==="0")return z+1;if(!k(A[z]))throw new Error("Invalid TTL.");z+=1;for(let X=0;X<2&&y(A[z]);X++)z+=1;return z}consumeToken(A,z){return this.consumeOneOrMore(A,z,w)}consumeTime(A,z){let X=z;if(A[X]==="0")return X+1;for(k(A[X])&&(X+=1);y(A[X]);)X++;if(X-z<10)throw new Error("Invalid time");return X}consumeAddress(A,z){return this.consumeTill(A,z,m)}consumeTypedTime(A,z){let X=z;return X=this.consumeOneOrMore(A,X,y),O(A[X])?X+1:X}consumeRepeatInterval(A,z){if(!k(A[z]))throw new Error("Invalid repeat interval");for(z+=1;y(A[z]);)z+=1;return O(A[z])&&(z+=1),z}consumePort(A,z){return this.consumeOneOrMore(A,z,y)}consume(A,z,X){for(let _e=0;_e<X.length;_e++){if(z+_e>=A.length)throw new Error("consume exceeding value length");if(A[z+_e]!==X[_e])throw new Error("consume ".concat(X," failed at ").concat(_e))}return z+X.length}consumeTill(A,z,X){let _e=z;for(;_e<A.length&&(typeof X!="string"||A[_e]!==X)&&(typeof X!="function"||!X(A[_e]));)_e++;return _e}}class me extends ce{constructor(){super(),ee(this,"records",[]),ee(this,"currentLine",0)}parse(A){const z=this.probeEOL(A);this.records=A.split(z).filter(Jl=>!!Ts(Jl).call(Jl)).map(this.parseLine),this.currentLine=0;const X=this.parseVersion(),_e=this.parseOrigin(),mt=this.parseSessionName(),gn=this.parseInformation(),wr=this.parseUri(),uo=this.parseEmail(),Xl=this.parsePhone(),sv=this.parseConnection(),Bp=this.parseBandWidth(),iv=this.parseTimeFields(),Iu=this.parseKey(),Tg=this.parseSessionAttribute(),Ou=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:X,origin:_e,sessionName:mt,information:gn,uri:wr,emails:uo,phones:Xl,connection:sv,bandwidths:Bp,timeFields:iv,key:Iu,attributes:Tg,mediaDescriptions:Ou}}getCurrentRecord(){const A=this.records[this.currentLine];if(!A)throw new Error("Record doesn't exit.");return A}probeEOL(A){for(let z=0;z<A.length;z++)if(A[z]===u)return A[z-1]==="\r"?p:u;throw new Error("Invalid newline character.")}parseLine(A,z){if(A.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const X=A[0];if(A[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:X,value:A.slice(2),line:z,cur:0}}parseSessionAttribute(){const A=new ot;for(;this.currentLine<this.records.length;){const z=this.getCurrentRecord();if(z.type!==g.ATTRIBUTE)break;const X={attField:this.extractOneOrMore(z,_e=>w(_e)&&_e!==":"),_cur:0};z.value[z.cur]===":"&&(z.cur+=1,X.attValue=this.extractOneOrMore(z,W)),A.parse(X),this.currentLine++}return A.digest()}parseMediaAttributes(A){const z=new it(A);for(;this.currentLine<this.records.length;){const X=this.getCurrentRecord();if(X.type!==g.ATTRIBUTE)break;const _e={attField:this.extractOneOrMore(X,mt=>w(mt)&&mt!==":"),_cur:0};X.value[X.cur]===":"&&(X.cur+=1,_e.attValue=this.extractOneOrMore(X,W)),z.parse(_e),this.currentLine++}return z.digest()}parseKey(){const A=this.getCurrentRecord();if(A.type===g.KEY){if(A.value==="prompt"||A.value==="clear:"||A.value==="base64:"||A.value==="uri:")return A.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const A=this.getCurrentRecord();if(A.type===g.ZONE_ADJUSTMENTS){const z=[];for(;;)try{const X=this.extract(A,this.consumeTime);this.consumeSpaceForRecord(A);let _e=!1;A.value[A.cur]==="-"&&(_e=!0,A.cur+=1);const mt=this.extract(A,this.consumeTypedTime);z.push({time:X,typedTime:mt,back:_e})}catch{break}if(z.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,z}return[]}parseRepeat(){const A=[];for(;;){const z=this.getCurrentRecord();if(z.type!==g.REPEAT)break;{const X=this.extract(z,this.consumeRepeatInterval),_e=this.parseTypedTime(z);A.push({repeatInterval:X,typedTimes:_e}),this.currentLine++}}return A}parseTypedTime(A){const z=[];for(;;)try{this.consumeSpaceForRecord(A),z.push(this.extract(A,this.consumeTypedTime))}catch{break}if(z.length===0)throw new Error("Invalid typed time.");return z}parseTime(){const A=this.getCurrentRecord(),z=this.extract(A,this.consumeTime);this.consumeSpaceForRecord(A);const X=this.extract(A,this.consumeTime);return this.currentLine++,{startTime:z,stopTime:X}}parseBandWidth(){const A=[];for(;this.currentLine<this.records.length;){const z=this.getCurrentRecord();if(z.type!==g.BANDWIDTH)break;{const X=this.extractOneOrMore(z,w);if(z.value[z.cur]!==":")throw new Error("Invalid bandwidth field.");z.cur++;const _e=this.extractOneOrMore(z,y);A.push({bwtype:X,bandwidth:_e}),this.currentLine++}}return A}parseVersion(){const A=this.getCurrentRecord();if(A.type!==g.VERSION)throw new Error("first sdp record must be version");const z=A.value.slice(0,this.consumeOneOrMore(A.value,0,y));if(z.length!==A.value.length)throw new Error('invalid proto version, "v='.concat(A.value,'"'));return this.currentLine++,z}parseOrigin(){const A=this.getCurrentRecord();if(A.type!==g.ORIGIN)throw new Error("second line of sdp must be origin");const z=this.extractOneOrMore(A,S);this.consumeSpaceForRecord(A);const X=this.extractOneOrMore(A,y);this.consumeSpaceForRecord(A);const _e=this.extractOneOrMore(A,y);this.consumeSpaceForRecord(A);const mt=this.extractOneOrMore(A,w);this.consumeSpaceForRecord(A);const gn=this.extractOneOrMore(A,w);this.consumeSpaceForRecord(A);const wr=this.extract(A,this.consumeUnicastAddress);return this.currentLine++,{username:z,sessId:X,sessVersion:_e,nettype:mt,addrtype:gn,unicastAddress:wr}}parseSessionName(){const A=this.getCurrentRecord();if(A.type===g.SESSION_NAME){const z=this.extract(A,this.consumeText);return this.currentLine++,z}}parseInformation(){const A=this.getCurrentRecord();if(A.type!==g.INFORMATION)return;const z=this.extract(A,this.consumeText);return this.currentLine++,z}parseUri(){const A=this.getCurrentRecord();if(A.type===g.URI)return this.currentLine++,A.value}parseEmail(){const A=[];for(;;){const z=this.getCurrentRecord();if(z.type!==g.EMAIL)break;A.push(z.value),this.currentLine++}return A}parsePhone(){const A=[];for(;;){const z=this.getCurrentRecord();if(z.type!==g.PHONE)break;A.push(z.value),this.currentLine++}return A}parseConnection(){const A=this.getCurrentRecord();if(A.type===g.CONNECTION){const z=this.extractOneOrMore(A,w);this.consumeSpaceForRecord(A);const X=this.extractOneOrMore(A,w);this.consumeSpaceForRecord(A);const _e=this.extract(A,this.consumeAddress);return this.currentLine++,{nettype:z,addrtype:X,address:_e}}}parseMedia(){const A=this.getCurrentRecord(),z=this.extract(A,this.consumeToken);this.consumeSpaceForRecord(A);let X=this.extract(A,this.consumePort);A.value[A.cur]==="/"&&(A.cur+=1,X+=this.extract(A,this.consumeInteger)),this.consumeSpaceForRecord(A);const _e=[];for(_e.push(this.extract(A,this.consumeToken));A.value[A.cur]==="/";)A.cur+=1,_e.push(this.extract(A,this.consumeToken));if(_e.length===0)throw new Error("Invalid proto");const mt=this.parseFmt(A);return this.currentLine++,{mediaType:z,port:X,protos:_e,fmts:mt}}parseTimeFields(){const A=[];for(;this.getCurrentRecord().type===g.TIME;){const z=this.parseTime(),X=this.parseRepeat(),_e=this.parseZone();A.push({time:z,repeats:X,zones:_e})}return A}parseMediaDescription(){const A=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===g.MEDIA;){const z=this.parseMedia(),X=this.parseInformation(),_e=this.parseConnections(),mt=this.parseBandWidth(),gn=this.parseKey(),wr=this.parseMediaAttributes(z);A.push({media:z,information:X,connections:_e,bandwidths:mt,key:gn,attributes:wr})}return A}parseConnections(){const A=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===g.CONNECTION;)A.push(this.parseConnection());return A}parseFmt(A){const z=[];for(;;)try{this.consumeSpaceForRecord(A),z.push(this.extract(A,this.consumeToken))}catch{break}if(z.length===0)throw new Error("Invalid fmts");return z}extract(A,z){for(var X=arguments.length,_e=new Array(X>2?X-2:0),mt=2;mt<X;mt++)_e[mt-2]=arguments[mt];const gn=z.call(this,A.value,A.cur,..._e),wr=A.value.slice(A.cur,gn);return A.cur=gn,wr}extractOneOrMore(A,z){const X=this.consumeOneOrMore(A.value,A.cur,z),_e=A.value.slice(A.cur,X);return A.cur=X,_e}consumeSpaceForRecord(A){if(A.value[A.cur]!==m)throw new Error("Invalid space at ".concat(A.cur,"."));A.cur+=1}}class Oe extends ce{constructor(){super(...arguments),ee(this,"attributes",void 0),ee(this,"digested",!1)}extractOneOrMore(A,z,X){const _e=this.consumeOneOrMore(A.attValue,A._cur,z),mt=A.attValue.slice(A._cur,_e),[gn,wr]=X||[];if(typeof gn=="number"&&mt.length<gn)throw new Error("error in length, should be more or equal than ".concat(gn," characters."));if(typeof wr=="number"&&mt.length>wr)throw new Error("error in length, should be less or equal than ".concat(wr," characters."));return A._cur=_e,mt}consumeAttributeSpace(A){if(A.attValue[A._cur]!==m)throw new Error("Invalid space at ".concat(A._cur,"."));A._cur+=1}extract(A,z){if(!A.attValue)throw new Error("Nothing to extract from attValue.");for(var X=arguments.length,_e=new Array(X>2?X-2:0),mt=2;mt<X;mt++)_e[mt-2]=arguments[mt];const gn=z.call(this,A.attValue,A._cur,..._e),wr=A.attValue.slice(A._cur,gn);return A._cur=gn,wr}atEnd(A){if(!A.attValue)throw new Error;return A._cur>=A.attValue.length}peekChar(A){if(!A.attValue)throw new Error;return A.attValue[A._cur]}peek(A,z){if(!A.attValue)throw new Error;for(let X=0;X<z.length;X++)if(z[X]!==A.attValue[A._cur+X])return!1;return!0}parseIceUfrag(A){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(A,H,[4,256])}parseIcePwd(A){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(A,H,[22,256])}parseIceOptions(A){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const z=[];for(;!this.atEnd(A);){z.push(this.extractOneOrMore(A,H));try{this.consumeAttributeSpace(A)}catch(X){if(this.atEnd(A))break;throw X}}this.attributes.iceOptions=z}parseFingerprint(A){const z=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);const X=this.extract(A,this.consumeTill);this.attributes.fingerprints.push({hashFunction:z,fingerprint:X})}parseExtmap(A){const z=this.extractOneOrMore(A,y);let X;this.peekChar(A)==="/"&&(this.extract(A,this.consume,"/"),X=this.extract(A,this.consumeToken)),this.consumeAttributeSpace(A);const _e=this.extract(A,this.consumeTill,m),mt=q(q({entry:parseInt(z,10)},X&&{direction:X}),{},{extensionName:_e});this.peekChar(A)===m&&(this.consumeAttributeSpace(A),mt.extensionAttributes=this.extract(A,this.consumeTill)),this.attributes.extmaps.push(mt)}parseSetup(A){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const z=this.extract(A,this.consumeTill);if(z!=="active"&&z!=="passive"&&z!=="actpass"&&z!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=z}}class ot extends Oe{constructor(){super(...arguments),ee(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(A){if(this.digested)throw new Error("already digested");try{switch(A.attField){case"group":this.parseGroup(A);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(A);break;case"ice-pwd":this.parseIcePwd(A);break;case"ice-options":this.parseIceOptions(A);break;case"fingerprint":this.parseFingerprint(A);break;case"setup":this.parseSetup(A);break;case"tls-id":this.parseTlsId(A);break;case"identity":this.parseIdentity(A);break;case"extmap":this.parseExtmap(A);break;case"msid-semantic":this.parseMsidSemantic(A);break;default:A.ignored=!0,this.attributes.unrecognized.push(A)}}catch(z){throw console.error("parsing session attribute ".concat(A.attField,' error, "a=').concat(A.attField,":").concat(A.attValue,'"')),z}if(!A.ignored&&A.attValue&&!this.atEnd(A))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(A){const z=this.extract(A,this.consumeToken),X=[];for(;!this.atEnd(A)&&this.peekChar(A)===m;)this.consumeAttributeSpace(A),X.push(this.extract(A,this.consumeToken));this.attributes.groups.push({semantic:z,identificationTag:X})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(A){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(A,Y)}parseIdentity(A){const z=this.extractOneOrMore(A,Q),X=[];for(;!this.atEnd(A)&&this.peekChar(A)===m;){this.consumeAttributeSpace(A);const _e=this.extract(A,this.consumeToken);this.extract(A,this.consume,"=");const mt=this.extractOneOrMore(A,gn=>gn!==m&&W(gn));X.push({name:_e,value:mt})}this.attributes.identities.push({assertionValue:z,extensions:X})}parseMsidSemantic(A){this.peekChar(A)===m&&this.consumeAttributeSpace(A);const z={semantic:this.extract(A,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(A)}catch{break}if(this.peekChar(A)==="*"){this.extract(A,this.consume,"*"),z.applyForAll=!0;break}{const X=this.extract(A,this.consumeTill,m);z.identifierList.push(X)}}this.attributes.msidSemantic=z}}class it extends Oe{constructor(A){super(),ee(this,"attributes",void 0),A.protos.indexOf("RTP")!==-1||A.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(A){if(this.digested)throw new Error("already digested");try{switch(A.attField){case"extmap":this.parseExtmap(A);break;case"setup":this.parseSetup(A);break;case"ice-ufrag":this.parseIceUfrag(A);break;case"ice-pwd":this.parseIcePwd(A);break;case"ice-options":this.parseIceOptions(A);break;case"candidate":this.parseCandidate(A);break;case"remote-candidate":this.parseRemoteCandidate(A);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(A);break;case"rtpmap":this.parseRtpmap(A);break;case"ptime":this.parsePtime(A);break;case"maxptime":this.parseMaxPtime(A);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(A);break;case"ssrc":this.parseSSRC(A);break;case"fmtp":this.parseFmtp(A);break;case"rtcp-fb":this.parseRtcpFb(A);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(A);break;case"mid":this.parseMid(A);break;case"msid":this.parseMsid(A);break;case"imageattr":this.parseImageAttr(A);break;case"rid":this.parseRid(A);break;case"simulcast":this.parseSimulcast(A);break;case"sctp-port":this.parseSctpPort(A);break;case"max-message-size":this.parseMaxMessageSize(A);break;case"ssrc-group":this.parseSSRCGroup(A);break;default:A.ignored=!0,this.attributes.unrecognized.push(A)}}catch(z){throw console.error("parsing media attribute ".concat(A.attField,' error, "a=').concat(A.attField,":").concat(A.attValue,'"')),z}if(!A.ignored&&A.attValue&&!this.atEnd(A))throw new Error("attribute parsing error")}parseCandidate(A){const z=this.extractOneOrMore(A,H,[1,32]);this.consumeAttributeSpace(A);const X=this.extractOneOrMore(A,y,[1,5]);this.consumeAttributeSpace(A);const _e=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);const mt=this.extractOneOrMore(A,y,[1,10]);this.consumeAttributeSpace(A);const gn=this.extract(A,this.consumeAddress);this.consumeAttributeSpace(A);const wr=this.extract(A,this.consumePort);this.consumeAttributeSpace(A),this.extract(A,this.consume,"typ"),this.consumeAttributeSpace(A);const uo={foundation:z,componentId:X,transport:_e,priority:mt,connectionAddress:gn,port:wr,type:this.extract(A,this.consumeToken),extension:{}};for(this.peek(A," raddr")&&(this.extract(A,this.consume," raddr"),this.consumeAttributeSpace(A),uo.relAddr=this.extract(A,this.consumeAddress)),this.peek(A," rport")&&(this.extract(A,this.consume," rport"),this.consumeAttributeSpace(A),uo.relPort=this.extract(A,this.consumePort));this.peekChar(A)===m;){this.consumeAttributeSpace(A);const Xl=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A),uo.extension[Xl]=this.extractOneOrMore(A,b)}this.attributes.candidates.push(uo)}parseRemoteCandidate(A){const z=[];for(;;){const X=this.extractOneOrMore(A,y,[1,5]);this.consumeAttributeSpace(A);const _e=this.extract(A,this.consumeAddress);this.consumeAttributeSpace(A);const mt=this.extract(A,this.consumePort);z.push({componentId:X,connectionAddress:_e,port:mt});try{this.consumeAttributeSpace(A)}catch{break}}this.attributes.remoteCandidatesList.push(z)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(A){const z=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);const X=this.extract(A,this.consumeTill,"/");this.extract(A,this.consume,"/");const _e={encodingName:X,clockRate:this.extractOneOrMore(A,y)};this.atEnd(A)||this.peekChar(A)!=="/"||(this.extract(A,this.consume,"/"),_e.encodingParameters=parseInt(this.extract(A,this.consumeTill),10));const mt=this.attributes.payloads.find(gn=>gn.payloadType===parseInt(z,10));mt?mt.rtpMap=_e:this.attributes.payloads.push({payloadType:parseInt(z,10),rtpMap:_e,rtcpFeedbacks:[]})}parsePtime(A){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(A,this.consumeTill)}parseMaxPtime(A){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(A,this.consumeTill)}parseDirection(A){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=A.attField}parseSSRC(A){const z=this.extractOneOrMore(A,y);this.consumeAttributeSpace(A);const X=this.extract(A,this.consumeTill,":");let _e;this.peekChar(A)===":"&&(this.extract(A,this.consume,":"),_e=this.extract(A,this.consumeTill));const mt=this.attributes.ssrcs.find(gn=>gn.ssrcId===parseInt(z,10));mt?mt.attributes[X]=_e:this.attributes.ssrcs.push({ssrcId:parseInt(z,10),attributes:{[X]:_e}})}parseFmtp(A){const z=this.extract(A,this.consumeTill,m);this.consumeAttributeSpace(A);const X=this.extract(A,this.consumeTill),_e={};X.split(";").forEach(gn=>{let[wr,uo]=gn.split("=");wr=Ts(wr).call(wr);const Xl=typeof uo=="string"?Ts(uo).call(uo):null;typeof wr=="string"&&wr.length>0&&(_e[wr]=Xl)});const mt=this.attributes.payloads.find(gn=>gn.payloadType===parseInt(z,10));mt?mt.fmtp={parameters:_e}:this.attributes.payloads.push({payloadType:parseInt(z,10),rtcpFeedbacks:[],fmtp:{parameters:_e}})}parseFmtParameters(A){const z={},X=this.extract(A,this.consumeTill,"=");A._cur++;const _e=this.extract(A,this.consumeTill,";");for(z[X]=_e;A.attValue[A._cur]===";";){const mt=this.extract(A,this.consumeTill,"=");A._cur++;const gn=this.extract(A,this.consumeTill,";");z[mt]=gn}return z}parseRtcpFb(A){let z="";z=this.peekChar(A)==="*"?this.extract(A,this.consume,"*"):this.extract(A,this.consumeTill,m),this.consumeAttributeSpace(A);const X=this.extract(A,this.consumeTill,m);let _e;if(X==="trr-int")_e={type:X,interval:this.extract(A,this.consumeTill)};else{const mt={type:X};this.peekChar(A)===m&&(this.consumeAttributeSpace(A),mt.parameter=this.extract(A,this.consumeToken),this.peekChar(A)===m&&(mt.additional=this.extract(A,this.consumeTill))),_e=mt}if(z==="*")this.attributes.rtcpFeedbackWildcards.push(_e);else{const mt=this.attributes.payloads.find(gn=>gn.payloadType===parseInt(z,10));mt?mt.rtcpFeedbacks.push(_e):this.attributes.payloads.push({payloadType:parseInt(z,10),rtcpFeedbacks:[_e]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(A){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const z={port:this.extract(A,this.consumePort)};this.peekChar(A)===m&&(this.consumeAttributeSpace(A),z.netType=this.extractOneOrMore(A,w),this.consumeAttributeSpace(A),z.addressType=this.extractOneOrMore(A,w),this.consumeAttributeSpace(A),z.address=this.extract(A,this.consumeAddress)),this.attributes.rtcp=z}parseMsid(A){const z={id:this.extractOneOrMore(A,w,[1,64])};this.peekChar(A)===m&&(this.consumeAttributeSpace(A),z.appdata=this.extractOneOrMore(A,w,[1,64])),this.attributes.msids.push(z)}parseImageAttr(A){this.attributes.imageattr.push(A.attValue)}parseRid(A){const z=this.extractOneOrMore(A,_e=>I(_e)||y(_e)||_e==="_"||_e==="-");this.consumeAttributeSpace(A);const X={id:z,direction:this.extract(A,this.consumeToken),params:[]};if(this.peekChar(A)===m){if(this.consumeAttributeSpace(A),this.peek(A,"pt=")){this.extract(A,this.consume,"pt=");const _e=[];for(;;){const mt=this.extract(A,this.consumeToken);_e.push(mt);try{this.extract(A,this.consume,",")}catch{break}}X.payloads=_e,this.peekChar(A)===m&&this.extract(A,this.consume,m)}for(;;){const _e=this.extract(A,this.consumeToken);switch(_e){case"depend":{const mt={type:_e,rids:this.extract(A,this.consume,"=").split(",")};X.params.push(mt);break}default:{const mt={type:_e};this.peekChar(A)==="="&&(this.extract(A,this.consume,"="),mt.val=this.extract(A,this.consumeTill,";")),X.params.push(mt)}}try{this.extract(A,this.consume,";")}catch{break}}}this.attributes.rids.push(X)}parseSimulcast(A){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=A.attValue,this.extract(A,this.consumeTill)}parseSctpPort(A){this.attributes.sctpPort=this.extractOneOrMore(A,y,[1,5])}parseMaxMessageSize(A){this.attributes.maxMessageSize=this.extractOneOrMore(A,y,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(A){this.attributes.mid=this.extract(A,this.consumeToken)}parseSSRCGroup(A){const z=this.extract(A,this.consumeToken),X=[];for(;;)try{this.consumeAttributeSpace(A);const _e=this.extract(A,this.consumeInteger);X.push(parseInt(_e,10))}catch{break}this.attributes.ssrcGroups.push({semantic:z,ssrcIds:X})}}function wt(pe,A,z){return A in pe?Object.defineProperty(pe,A,{value:z,enumerable:!0,configurable:!0,writable:!0}):pe[A]=z,pe}class yt{constructor(){wt(this,"eol",p)}print(A,z){let X="";return z&&(this.eol=z),X+=this.printVersion(A.version),X+=this.printOrigin(A.origin),X+=this.printSessionName(A.sessionName),X+=this.printInformation(A.information),X+=this.printUri(A.uri),X+=this.printEmail(A.emails),X+=this.printPhone(A.phones),X+=this.printConnection(A.connection),X+=this.printBandwidth(A.bandwidths),X+=this.printTimeFields(A.timeFields),X+=this.printKey(A.key),X+=this.printSessionAttributes(A.attributes),X+=this.printMediaDescription(A.mediaDescriptions),X}printVersion(A){return"v=".concat(A).concat(this.eol)}printOrigin(A){return"o=".concat(A.username," ").concat(A.sessId," ").concat(A.sessVersion," ").concat(A.nettype," ").concat(A.addrtype," ").concat(A.unicastAddress).concat(this.eol)}printSessionName(A){return A?"s=".concat(A).concat(this.eol):""}printInformation(A){return A?"i=".concat(A).concat(this.eol):""}printUri(A){return A?"u=".concat(A).concat(this.eol):""}printEmail(A){let z="";for(const X of A)z+="e=".concat(X).concat(this.eol);return z}printPhone(A){let z="";for(const X of A)z+="e=".concat(X).concat(this.eol);return z}printConnection(A){return A?"c=".concat(A.nettype," ").concat(A.addrtype," ").concat(A.address).concat(this.eol):""}printBandwidth(A){let z="";for(const X of A)z+="b=".concat(X.bwtype,":").concat(X.bandwidth).concat(this.eol);return z}printTimeFields(A){let z="";for(const X of A){z+="t=".concat(X.time.startTime," ").concat(X.time.startTime).concat(this.eol);for(const _e of X.repeats)z+="r=".concat(_e.repeatInterval," ").concat(_e.typedTimes.join(" ")).concat(this.eol);X.zoneAdjustments&&(z+="z=",z+="z=".concat(X.zoneAdjustments.map(_e=>"".concat(_e.time," ").concat(_e.back?"-":""," ").concat(_e.typedTime)).join(" ")).concat(this.eol),z+=this.eol)}return z}printKey(A){return A?"k=".concat(A).concat(this.eol):""}printAttributes(A){let z="";for(const X of A)z+="a=".concat(X.attField).concat(X.attValue?":".concat(X.attValue):"").concat(this.eol);return z}printMediaDescription(A){let z="";for(const X of A)z+=this.printMedia(X.media),z+=this.printInformation(X.information),z+=this.printConnections(X.connections),z+=this.printBandwidth(X.bandwidths),z+=this.printKey(X.key),z+=this.printMediaAttributes(X);return z}printConnections(A){let z="";for(const X of A)z+=this.printConnection(X);return z}printMedia(A){return"m=".concat(A.mediaType," ").concat(A.port," ").concat(A.protos.join("/")," ").concat(A.fmts.join(" ")).concat(this.eol)}printSessionAttributes(A){return new An(this.eol).print(A)}printMediaAttributes(A){return new he(this.eol).print(A)}}class Kt{constructor(A){wt(this,"eol",void 0),this.eol=A}printIceUfrag(A){return A===void 0?"":"a=ice-ufrag:".concat(A).concat(this.eol)}printIcePwd(A){return A===void 0?"":"a=ice-pwd:".concat(A).concat(this.eol)}printIceOptions(A){return A===void 0?"":"a=ice-options:".concat(A.join(m)).concat(this.eol)}printFingerprints(A){return A.length>0?A.map(z=>"a=fingerprint:".concat(z.hashFunction).concat(m).concat(z.fingerprint)).join(this.eol)+this.eol:""}printExtmap(A){return A.map(z=>"a=extmap:".concat(z.entry).concat(z.direction?"/".concat(z.direction):"").concat(m).concat(z.extensionName).concat(z.extensionAttributes?"".concat(m).concat(z.extensionAttributes):"").concat(this.eol)).join("")}printSetup(A){return A===void 0?"":"a=setup:".concat(A).concat(this.eol)}printUnrecognized(A){return A.map(z=>"a=".concat(z.attField).concat(z.attValue?":".concat(z.attValue):"").concat(this.eol)).join("")}}class An extends Kt{print(A){let z="";return z+=this.printGroups(A.groups),z+=this.printMsidSemantic(A.msidSemantic),z+=this.printIceLite(A.iceLite),z+=this.printIceUfrag(A.iceUfrag),z+=this.printIcePwd(A.icePwd),z+=this.printIceOptions(A.iceOptions),z+=this.printFingerprints(A.fingerprints),z+=this.printSetup(A.setup),z+=this.printTlsId(A.tlsId),z+=this.printIdentity(A.identities),z+=this.printExtmap(A.extmaps),z+=this.printUnrecognized(A.unrecognized),z}printGroups(A){let z="";return A.length>0&&(z+=A.map(X=>"a=group:".concat(X.semantic).concat(X.identificationTag.map(_e=>"".concat(m).concat(_e)).join("")).concat(this.eol)).join("")),z}printIceLite(A){return A===void 0?"":"a=ice-lite"+this.eol}printTlsId(A){return A?"a=tls-id:".concat(A).concat(this.eol):""}printIdentity(A){return A.length===0?"":A.map(z=>"a=identity:".concat(z.assertionValue).concat(z.extensions.map(X=>"".concat(m).concat(X.name).concat(X.value?"=".concat(X.value):"")))).join(this.eol)+this.eol}printMsidSemantic(A){if(!A)return"";let z="a=msid-semantic:".concat(A.semantic);return A.applyForAll?z+="".concat(m,"*"):A.identifierList.length>0&&(z+=A.identifierList.map(X=>"".concat(m).concat(X))),z+this.eol}}class he extends Kt{print(A){const z=A.attributes;let X="";return X+=this.printRTCP(z.rtcp),X+=this.printIceUfrag(z.iceUfrag),X+=this.printIcePwd(z.icePwd),X+=this.printIceOptions(z.iceOptions),X+=this.printCandidates(z.candidates),X+=this.printRemoteCandidatesList(z.remoteCandidatesList),X+=this.printEndOfCandidates(z.endOfCandidates),X+=this.printFingerprints(z.fingerprints),X+=this.printSetup(z.setup),X+=this.printMid(z.mid),X+=this.printExtmap(z.extmaps),X+=this.printRTPRelated(z),X+=this.printPtime(z.ptime),X+=this.printMaxPtime(z.maxPtime),X+=this.printDirection(z.direction),X+=this.printSSRCGroups(z.ssrcGroups),X+=this.printSSRC(z.ssrcs),X+=this.printRTCPMux(z.rtcpMux),X+=this.printRTCPMuxOnly(z.rtcpMuxOnly),X+=this.printRTCPRsize(z.rtcpRsize),X+=this.printMSId(z.msids),X+=this.printImageattr(z.imageattr),X+=this.printRid(z.rids),X+=this.printSimulcast(z.simulcast),X+=this.printSCTPPort(z.sctpPort),X+=this.printMaxMessageSize(z.maxMessageSize),X+=this.printUnrecognized(z.unrecognized),X}printCandidates(A){return A.map(z=>"a=candidate:".concat(z.foundation).concat(m).concat(z.componentId).concat(m).concat(z.transport).concat(m).concat(z.priority).concat(m).concat(z.connectionAddress).concat(m).concat(z.port).concat(m,"typ").concat(m).concat(z.type).concat(z.relAddr?"".concat(m,"raddr").concat(m).concat(z.relAddr):"").concat(z.relPort?"".concat(m,"rport").concat(m).concat(z.relPort):"").concat(Object.keys(z.extension).map(X=>"".concat(m).concat(X).concat(m).concat(z.extension[X])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(A){return A.map(z=>"a=remote-candidates:".concat(z.join(m)).concat(this.eol)).join("")}printEndOfCandidates(A){return A===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(A){if(!A.payloads)return"";const z=A.payloads;let X="";X+=A.rtcpFeedbackWildcards.map(_e=>this.printRTCPFeedback("*",_e)).join("");for(const _e of z)X+=this.printRtpMap(_e.payloadType,_e.rtpMap),X+=this.printFmtp(_e.payloadType,_e.fmtp),X+=_e.rtcpFeedbacks.map(mt=>this.printRTCPFeedback(_e.payloadType,mt)).join("");return X}printFmtp(A,z){if(!z)return"";const X=Object.keys(z.parameters);return X.length===1&&z.parameters[X[0]]===null?"a=fmtp:".concat(A).concat(m).concat(X[0]).concat(this.eol):"a=fmtp:".concat(A).concat(m).concat(Object.keys(z.parameters).map(_e=>"".concat(_e,"=").concat(z.parameters[_e])).join(";")).concat(this.eol)}printRtpMap(A,z){return z?"a=rtpmap:".concat(A).concat(m).concat(z.encodingName,"/").concat(z.clockRate).concat(z.encodingParameters?"/".concat(z.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(A,z){let X="a=rtcp-fb:".concat(A).concat(m),_e=z;return _e.type==="trr-int"?X+="ttr-int".concat(m).concat(_e.interval):(X+="".concat(_e.type),_e.parameter&&(X+="".concat(m).concat(_e.parameter),_e.additional&&(X+="".concat(m).concat(_e.additional)))),X+this.eol}printPtime(A){return A===void 0?"":"a=ptime:".concat(A).concat(this.eol)}printMaxPtime(A){return A===void 0?"":"a=maxptime:".concat(A).concat(this.eol)}printDirection(A){return A===void 0?"":"a=".concat(A).concat(this.eol)}printSSRC(A){return A.map(z=>Object.keys(z.attributes).map(X=>"a=ssrc:".concat(z.ssrcId.toString(10)).concat(m).concat(X).concat(z.attributes[X]?":".concat(z.attributes[X]):"").concat(this.eol)).join("")).join("")}printRTCPMux(A){return A===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(A){return A===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(A){return A===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(A){if(A===void 0)return"";let z="a=rtcp:".concat(A.port);return A.netType&&(z+="".concat(m).concat(A.netType)),A.addressType&&(z+="".concat(m).concat(A.addressType)),A.address&&(z+="".concat(m).concat(A.address)),z+this.eol}printMSId(A){return A.map(z=>"a=msid:".concat(z.id).concat(z.appdata?"".concat(m).concat(z.appdata):"").concat(this.eol)).join("")}printImageattr(A){return A.map(z=>"a=imageattr:".concat(z).concat(this.eol)).join("")}printRid(A){return A.map(z=>{let X="a=rid:".concat(z.id).concat(m).concat(z.direction);return z.payloads&&(X+="".concat(m,"pt=").concat(z.payloads.join(","))),z.params.length>0&&(X+="".concat(m).concat(z.params.map(_e=>_e.type==="depend"?"depend=".concat(_e.rids.join(",")):"".concat(_e.type,"=").concat(_e.val)).join(";"))),X+this.eol}).join("")}printSimulcast(A){return A===void 0?"":"a=simulcast:".concat(A).concat(this.eol)}printSCTPPort(A){return A===void 0?"":"a=sctp-port:".concat(A).concat(this.eol)}printMaxMessageSize(A){return A===void 0?"":"a=max-message-size:".concat(A).concat(this.eol)}printMid(A){return A===void 0?"":"a=mid:".concat(A).concat(this.eol)}printSSRCGroups(A){return A.map(z=>"a=ssrc-group:".concat(z.semantic).concat(z.ssrcIds.map(X=>"".concat(m).concat(X.toString(10))).join("")).concat(this.eol)).join("")}}function Ee(pe){return new me().parse(pe)}function je(pe,A){return new yt().print(pe,A)}}},t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}return n.d=(i,o)=>{for(var l in o)n.o(o,l)&&!n.o(i,l)&&Object.defineProperty(i,l,{enumerable:!0,get:o[l]})},n.o=(i,o)=>Object.prototype.hasOwnProperty.call(i,o),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function Ns(e){return iU.parse(e)}function Gc(e,t){return iU.print(e,t)}var $ce=Qi("Array","keys"),Wce=bl,Gce=cs,Hce=N,Kce=$ce,hC=Array.prototype,zce={DOMTokenList:!0,NodeList:!0},Yce=function(e){var t=e.keys;return e===hC||Hce(hC,e)&&t===hC.keys||Gce(zce,Wce(e))?Kce:t},us=h(Yce);function Vn(e,t,n){return(t=function(i){var o=function(l,u){if(typeof l!="object"||!l)return l;var p=l[Symbol.toPrimitive];if(p!==void 0){var m=p.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(i);return typeof o=="symbol"?o:o+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function St(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oU(Object(n),!0).forEach(function(i){Vn(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Ky(e,t){return Ky=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Ky(e,t)}function pC(){pC=function(o,l){return new n(o,void 0,l)};var e=RegExp.prototype,t=new WeakMap;function n(o,l,u){var p=RegExp(o,l);return t.set(p,u||t.get(o)),Ky(p,n.prototype)}function i(o,l){var u,p=t.get(l);return Zi(u=Object.keys(p)).call(u,function(m,g){var y=p[g];if(typeof y=="number")m[g]=o[y];else{for(var b=0;o[y[b]]===void 0&&b+1<y.length;)b++;m[g]=o[y[b]]}return m},Object.create(null))}return function(o,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(l&&l.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),Object.defineProperty(o,"prototype",{writable:!1}),l&&Ky(o,l)}(n,RegExp),n.prototype.exec=function(o){var l=e.exec.call(this,o);if(l){l.groups=i(l,this);var u=l.indices;u&&(u.groups=i(u,this))}return l},n.prototype[Symbol.replace]=function(o,l){if(typeof l=="string"){var u=t.get(this);return e[Symbol.replace].call(this,o,l.replace(/\$<([^>]+)(>|$)/g,function(m,g,y){if(y==="")return m;var b=u[g];return Array.isArray(b)?"$"+b.join("$"):typeof b=="number"?"$"+b:""}))}if(typeof l=="function"){var p=this;return e[Symbol.replace].call(this,o,function(){var m=arguments;return typeof m[m.length-1]!="object"&&(m=[].slice.call(m)).push(i(m,p)),l.apply(this,m)})}return e[Symbol.replace].call(this,o,l)},pC.apply(this,arguments)}const aU=new class extends On{constructor(){super(...arguments),Vn(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class qce{constructor(t){Vn(this,"logger",void 0),Vn(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function mC(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function cU(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const no={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},zy=Date.now(),Ff=e=>{for(const t in no)if(Object.prototype.hasOwnProperty.call(no,t)&&no[t]===e)return t;return"DEFAULT"},C=new class{constructor(){Vn(this,"proxyServerURL",void 0),Vn(this,"logLevel",no.DEBUG),Vn(this,"uploadState","collecting"),Vn(this,"uploadLogWaitingList",[]),Vn(this,"uploadLogUploadingList",[]),Vn(this,"uploadErrorCount",0),Vn(this,"currentLogID",0),Vn(this,"url",void 0),Vn(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[no.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[no.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[no.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[no.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[no.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){on("UPLOAD_LOG",!0)}disableLogUpload(){on("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new qce(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-zy<100)return void setTimeout(()=>{this.log(...t)},Date.now()-zy);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=mC()+" Agora-SDK [".concat(Ff(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const o=mC()+" %cAgora-SDK [".concat(Ff(i),"]:");let l=[];if(!$("USE_NEW_LOG"))switch(i){case no.DEBUG:l=[o,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,l);break;case no.INFO:l=[o,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,l);break;case no.WARNING:l=[o,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,l);break;case no.ERROR:l=[o,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,l)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-zy<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-zy);const i=Math.max(0,Math.min(4,t[0]));t[0]=mC()+" Agora-SDK [".concat(Ff(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!$("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=cU()+" Agora-SDK [".concat(Ff(e),"]:"):n[0]=cU()+" Agora-SDK [".concat(Ff(e),"]:");let o="";n.forEach(l=>{typeof l=="object"&&(l=JSON.stringify(l)),o+="".concat(l," ")}),this.uploadLogWaitingList.push({payload_str:o,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:to,process_id:$("PROCESS_ID"),payload:JSON.stringify(e)};return ma(async()=>{const n=await Ms.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat($("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat($("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:e.map(o=>o.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),aU.reportLogUploadError(i),!0},{timeout:$("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:$("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,$("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var lU;function Xce(e){return Vr(e.reportId,"params.reportId",0,100,!1),Vr(e.category,"params.category",0,100,!1),Vr(e.event,"params.event",0,100,!1),Vr(e.label,"params.label",0,100,!1),un(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(lU={}).FREE="free",lU.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const Jce={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let dr=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.RTE_DETAIL="rte_detail_stats",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Nn=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Qce=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function nt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,i){const o=i.value;if(typeof o=="function"){const l=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var u,p=arguments.length,m=new Array(p),g=0;g<p;g++)m[g]=arguments[g];let y=m;if(e.argsMap)try{y=e.argsMap(this,...m)}catch(S){C.warning(S),y=[]}try{JSON.stringify(y)}catch{C.warning("arguments for method ".concat(l,".").concat(String(n)," not serializable for apiInvoke.")),y=[]}const b=(e.report||Ue).reportApiInvoke(this._sessionId||null,{id:this._clientId||((u=this.store)===null||u===void 0?void 0:u.clientId)||this._ID,name:"".concat(l,".").concat(String(n)),options:y,tag:hn.TRACER,reportResult:e.reportResult},e.throttleTime);try{const S=o.apply(this,m);return S instanceof xe?S.then(w=>(b.onSuccess(e.reportResult&&w),w)).catch(w=>{throw b.onError(w),w}):(b.onSuccess(e.reportResult&&S),S)}catch(S){throw b.onError(S),S}}}return i}}const Ue=new class{constructor(){Vn(this,"baseInfoMap",new Map),Vn(this,"proxyServer",void 0),Vn(this,"eventUploadTimer",void 0),Vn(this,"setSessionIdTimer",void 0),Vn(this,"url",void 0),Vn(this,"sids",new Set),Vn(this,"backupUrl",void 0),Vn(this,"_appId",void 0),Vn(this,"_aid",0),Vn(this,"keyEventUploadPendingItems",[]),Vn(this,"normalEventUploadPendingItems",[]),Vn(this,"apiInvokeUploadPendingItems",[]),Vn(this,"apiInvokeCount",0),Vn(this,"apiInvokeLoggedCount",0),Vn(this,"ltsList",[]),Vn(this,"lastSendNormalEventTime",Date.now()),Vn(this,"customReportCounterTimer",void 0),Vn(this,"customReportCount",0),Vn(this,"extApiInvoke",async e=>{for(const t of e){const n=St(St({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:hn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),$("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),$("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,i]=t;return n+i}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const i=Date.now();this.apiInvokeCount+=1;const o=this.apiInvokeCount,l=!!$("SHOW_REPORT_INVOKER_LOG"),u=!!$("SHOW_REPORT_USER_INVOKER_LOG"),p=l||u&&t.id;p&&(this.apiInvokeLoggedCount+=1);const m=this.apiInvokeLoggedCount;function g(w,k){if(p){let I="[apiInvoke-".concat(m,"]");if(t.id&&(I+="[".concat(t.id,"]")),t.name&&(I+="[".concat(t.name,"]"),t.name===Rn.JOIN))return C.info("".concat(I," ").concat(w));C.info("".concat(I," ").concat(w),w==="start"?t.options:k||"")}}const y=()=>({tag:t.tag,invokeId:o,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null});g("start");let b=!1;vr(t.timeout).then(()=>{b||(this.sendApiInvoke(St(St({},y()),{},{error:G.API_INVOKE_TIMEOUT,success:!1})),g("timeout"))});const S=new oe(G.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:w=>{const k=()=>{if(b)throw S;return b=!0,this.sendApiInvoke(St(St({},y()),{},{success:!0},t.reportResult&&{result:w})),g("onSuccess"),w};return n?W5(k,t.name+"Success",n,()=>b=!0):k()},onError:w=>{const k=()=>{if(b)throw w;b=!0,this.sendApiInvoke(St(St({},y()),{},{success:!1,error:w})),g("onFailure",w.toString())};return n?W5(k,t.name+"Error",n,()=>b=!0):k()}}}_send(e,t,n){this.send({type:e,data:t},n)}_sendApiInvoke(e){return this.sendApiInvoke(e)}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),i=this.createBaseInfo(e,n);i.cname=t.cname,i.rteUrl=t.rteUrl;const o=Object.assign({},{willUploadConsoleLog:$("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:cC?"global":"oversea",areas:$("AREAS")&&$("AREAS").join(",")},t.extend),{stringUid:l,channelProfile:u,channelMode:p,isABTestSuccess:m,lsid:g,clientRole:y}=t,b=Date.now(),S=St(St({},i),{},{eventType:dr.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:dC,lts:b,elapse:b-n,extend:JSON.stringify(o),mode:t.mode,process:$("PROCESS_ID"),appType:$("APP_TYPE"),success:!0,version:to,stringUid:l,channelProfile:u,channelMode:p,isABTestSuccess:m,lsid:g,clientType:fe(w=window.navigator.userAgent).call(w,"AgoraWebView")?42:20,clientRole:y,serviceId:$("PROCESS_ID"),extensionID:$("PLUGIN_INFO").join(",")||"",rteUrl:t.rteUrl,rteSid:t.rteSid});var w;this.send({type:Nn.SESSION,data:S},!0)}reportRteDetail(e){const t=this.baseInfoMap.get(e);if(!t)return;const n=t.info,i=Date.now(),o=St(St({},n),{},{eventType:dr.RTE_DETAIL,lts:i,success:!0,elapse:i-t.startTime,vid:n.vid===void 0?0:Number(n.vid),ua:navigator.userAgent});this.send({type:Nn.RTE_DETAIL,data:o},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid);const o=Date.now(),l=St(St({},i),{},{role:t.role,eventType:dr.JOIN_CHOOSE_SERVER,lts:o,eventElapse:t.elapse||o-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:o-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:Nn.JOIN_CHOOSE_SERVER,data:l},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=St(St({},i),{},{eventType:dr.REQ_USER_ACCOUNT,lts:o,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||o-n.startTime,eventElapse:o-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Nn.REQ_USER_ACCOUNT,data:l},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const o=Date.now(),{firstSuccess:l,addr:u,isProxy:p}=t,m=o-n.startTime,g=St(St({},i),{},{eventType:dr.JOIN_GATEWAY,lts:o,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:m,eventElapse:o-t.lts,firstSuccess:l,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:aC(),isABTestSuccess:t.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:p?1:0}),y=g.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=o),u)if(g.signalChannel==="1"){const b=pC(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),S=u.match(b);g.gatewayIp=S&&S.groups?S.groups.ip:"",g.gatewayPort=S&&S.groups?S.groups.port:""}else if(p){const b=u.match(/h=(\d{1,3}-){3}\d{1,3}/g),S=u.match(/p=[0-9]{1,6}/g);g.gatewayIp=b&&b.length?b[0].split("=")[1].replace(/-/g,"."):"",g.gatewayPort=S&&S.length?S[0].split("=")[1]:""}else{const b=u.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),S=u.match(/(:|p=)[0-9]{1,6}/g);g.gatewayIp=b&&b.length?b[0].split("//")[1].replace(/-/g,"."):"",g.gatewayPort=S&&S.length?S[0].split(/:|p=/g)[1]:""}if(l)this.send({type:Nn.JOIN_GATEWAY,data:g},!0);else{let b={isSuccess:y,port:g.gatewayPort};delete g.success,delete g.eventType,delete g.firstSuccess,delete g.gatewayPort,g.vid=Number(g.vid);const S=Object.assign({},g,b,{eventType:dr.REJOIN_GATEWAY});this.send({type:Nn.RE_JOIN_GATEWAY,data:S},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=Date.now(),o=St(St({},n.info),{},{lts:i,timeout:t,elapse:i-n.startTime});this.send({type:Nn.JOIN_CHANNEL_TIMEOUT,data:o},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=St(St({},i),{},{eventType:dr.PUBLISH,lts:o,eventElapse:t.eventElapse,elapse:o-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Nn.PUBLISH,data:l},!0)}subscribe(e,t,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,l=Date.now(),u=St(St({},o),{},{eventType:dr.SUBSCRIBE,lts:l,eventElapse:t.eventElapse,elapse:l-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?u.peerSuid=t.peerid:u.peer=t.peerid,this.send({type:Nn.SUBSCRIBE,data:u},!0)}wsCompressorInit(e){var t;const n=[...us(t=this.baseInfoMap).call(t)],i=n.length?n[0]:"UnableToGetSid",o=this.baseInfoMap.get(i);if(!o)return;const l=o.info,u=Date.now(),p=St(St({},l),{},{eventType:dr.WS_COMPRESSOR_INIT,lts:u,eventElapse:e.eventElapse,elapse:u-o.startTime,status:e.status?1:2});this.send({type:Nn.WS_COMPRESSOR_INIT,data:p},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=t.peerPubStatusMs-(n.lastJoinSuccessTime||o),u=St(St({},i),{},{elapse:o-n.startTime,eventType:dr.XLA_PEER_FIRST_VIDEO_FRAME,lts:o,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:l,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>l?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0,firstReceivedEncodedFrame:t.firstReceivedEncodedFrame?Math.max(t.firstReceivedEncodedFrame-t.joinChannelStart,0):void 0,frameType:t.frameType||"",rtpTimestamp:t.rtpTimestamp||0,framePayloadType:t.framePayloadType||0,frameDataLength:t.frameDataLength||0,mimeType:t.mimeType||""});this.send({type:Nn.XLA_PEER_FIRST_VIDEO_FRAME,data:u},!0)}firstRemoteVideoDecode(e,t,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const l=o.info,u=Date.now(),p=St(St(St({},l),i),{},{elapse:u-o.startTime,eventType:t,lts:u,firstDecodeFrame:Math.max((i.firstFrame||u)-o.startTime,0),apEnd:Math.max(i.apEnd-o.startTime,0),apStart:Math.max(i.apStart-o.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-o.startTime,0),joinGwStart:Math.max(i.joinGwStart-o.startTime,0),pcEnd:Math.max(i.pcEnd-o.startTime,0),pcStart:Math.max(i.pcStart-o.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-o.startTime,0),subscriberStart:Math.max(i.subscriberStart-o.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-o.startTime,0)});this.send({type:n,data:p},!0)}firstRemoteFrame(e,t,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const l=o.info,u=Date.now(),p=St(St(St({},l),i),{},{elapse:u-o.startTime,eventType:t,lts:u});this.send({type:n,data:p},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=St(St(St({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:o-n.startTime,eventType:dr.AB_TEST,lts:o});this.send({type:Nn.AB_TEST,data:l},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=St(St(St({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:o-n.startTime,eventType:dr.PC_STATS,lts:o,preallocation:t.preallocation?1:0});this.send({type:Nn.PC_STATS,data:l},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=St(St(St({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:dr.UPDATE_REMOTE_RTPCAPABILITIES,lts:o});this.send({type:Nn.UPDATE_REMOTE_RTPCAPABILITIES,data:l},!0)}}onGatewayStream(e,t,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const l=o.info,u=Date.now(),p=St(St(St({},l),i),{},{eventType:t,lts:u});this.send({type:n,data:p},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=St(St({},i),{},{eventType:dr.STREAM_SWITCH,lts:o,isDual:t.isdual,elapse:o-n.startTime,success:t.succ});this.send({type:Nn.STREAM_SWITCH,data:l},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=St(St({},i),{},{eventType:dr.REQUEST_PROXY_APPCENTER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Nn.REQUEST_PROXY_APPCENTER,data:l},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=St(St({},i),{},{eventType:dr.REQUEST_PROXY_WORKER_MANAGER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Nn.REQUEST_PROXY_WORKER_MANAGER,data:l},!0)}setProxyServer(e){this.proxyServer=e,e?C.debug("reportProxyServerurl: ".concat(e)):C.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=St(St({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:o,elapse:o-n.startTime,joinChannelSuccessElapse:o-(n.lastJoinSuccessTime||o),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Nn.PEER_PUBLISH_STATUS,data:l},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now();(function(l,u,p){const m=l[u];if(!m||typeof m!="string")return[l];l[u]="";const g=rc(JSON.stringify(l));let y=0;const b=[];let S=0;for(let w=0;w<m.length;w++)S+=m.charCodeAt(w)<=127?1:3,S<=p-g||(b[b.length]=ye(ye({},l),{},{[u]:m.substring(y,w)}),y=w,S=m.charCodeAt(w)<=127?1:3);return y!==m.length-1&&(b[b.length]=ye(ye({},l),{},{[u]:m.substring(y)})),b})(St(St(St({},i),t),{},{elapse:o-n.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach(l=>this.send({type:Nn.WORKER_EVENT,data:l},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=St(St(St({},i),t),{},{elapse:o-n.startTime,lts:o});this.send({type:Nn.AP_WORKER_EVENT,data:l},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=St(St(St({},i),t),{},{elapse:o-n.startTime,lts:o,extend:t.extend||void 0});this.send({type:Nn.JOIN_WEB_PROXY_AP,data:l},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),l=St(St(St({},i),t),{},{elapse:o-n.startTime,lts:o});this.send({type:Nn.WEBSOCKET_QUIT,data:l},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>$("CUSTOM_REPORT_LIMIT"))throw new oe(G.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=t.map(o=>({type:Nn.USER_ANALYTICS,data:St(St({sid:e},o),{},{lts:n})}));try{$("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(o){throw C.error("send custom report message failed",o.toString()),new oe(G.CUSTOM_REPORT_SEND_FAILED,o.message)}}sendApiInvoke(e){const t=$("NOT_REPORT_EVENT");if(e.tag&&fe(t)&&fe(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:o,cid:l}=n.info;let u;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof oe){const{code:m,message:g}=e.error;u=m||g||e.error.toString()}else u=e.error.toString();const p={invokeId:e.invokeId,sid:e.sid,cname:i,cid:l,uid:o,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?u:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Nn.API_INVOKE,data:p},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>$("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],i=[];for(;e.length;){const l=e.shift();n.length<20?n.push(l):i.push(l)}e.push(...i);for(const l of[...n]){var o;this.ltsList.indexOf(l.data.lts)!==-1?(l.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(l.data.lts)):(this.ltsList.push(l.data.lts),Wd(o=this.ltsList).call(o,(u,p)=>u-p))}return t||(this.lastSendNormalEventTime=Date.now()),$("ENABLE_EVENT_REPORT")&&n.length&&($("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((l=>u=>{$("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(l):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(l),this.normalEventUploadPendingItems.length>$("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-$("NORMAL_EVENT_QUEUE_CAPACITY")),C.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Un.networkState===Rs.OFFLINE&&await xe.race([Un.onlineWaiter,vr(2*Zn.maxRetryTimeout)]);const t=o=>{let l=new Uint8Array;return o.forEach(u=>{const p=zT(JSON.stringify(u.data)),m=new ArrayBuffer(5),g=(b=>{let S=0;return Object.entries(Nn).forEach(w=>{let[k,I]=w;I===b.type&&(S=Qce[k])}),S})(u),y=new DataView(m);y.setUint16(0,p.byteLength,!0),y.setUint8(2,255&g),y.setUint8(3,g>>>8&255),y.setUint8(4,g>>>16&255),l=D5(l,new Uint8Array(m)),l=D5(l,p)}),l},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat($("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let o=0;o<2;o+=1){o===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat($("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await rC(i,{timeout:1e4,data:t(e),headers:St(St({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(l){if(o===1)throw l;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(p=>{const m=p&&p.data.sid&&this.baseInfoMap.get(p.data.sid);return m&&m.info.vid&&+m.info.vid||0})(e[0]),i=n?void 0:this._aid,o={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(p=>JSON.stringify(p)),vid:n,aid:i};Un.networkState===Rs.OFFLINE&&await xe.race([Un.onlineWaiter,vr(2*Zn.maxRetryTimeout)]);const l=t?"/events/proto-raws":"/events/messages";let u=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("EVENT_REPORT_DOMAIN"),"&p=").concat($("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat($("EVENT_REPORT_DOMAIN"),":").concat($("STATS_COLLECTOR_PORT")).concat(l));for(let p=0;p<2;p+=1){p===1&&(u=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat($("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat($("EVENT_REPORT_BACKUP_DOMAIN"),":").concat($("STATS_COLLECTOR_PORT")).concat(l)));try{t?await jce(u,{timeout:1e4,data:o}):await rC(u,{timeout:1e4,data:o})}catch(m){if(p===1)throw m;continue}return}}createBaseInfo(e,t){const n=Object.assign({},Jce);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),i=n[n.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:hn.TRACER}).onSuccess()}};aU.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Un.networkState,Ue.reportApiInvoke(null,{name:"logUploadError",options:e,tag:hn.TRACER}).onSuccess("logUploadError")});let ne=class extends oe{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Vn(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,C)}throw(){super.throw(C)}};const br={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function It(){return br}function dU(){return"setSinkId"in HTMLAudioElement.prototype&&(!$("RESTRICTION_SET_PLAYBACK_DEVICE")||($c()||y5())&&!R5())}function Yy(){return!br.supportUnifiedPlan||$("CHROME_FORCE_PLAN_B")&&nc()}function Bf(e){return!(Sn()||E5(87)||Yy()||!$("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||$("FORCE_DISABLE_AUTO_SUB")))}function uU(e){return $("ENABLE_INSTANT_VIDEO")?$("ENABLE_INSTANT_VIDEO"):!(e==null||!e.autoSubscribe||$("FORCE_DISABLE_AUTO_SUB"))}function hU(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function pU(){if(hU()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in e)||!e.suppressLocalAudioPlayback)}return pa(141)||Ol(141)||Qd(141)}function mU(){if(hU()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in e)||!e.restrictOwnAudio)}return pa(141)||Ol(141)||Qd(125)}let Fr=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function lp(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Bt(e,t,n,i,o){return{width:e,height:t,frameRate:n,bitrateMin:i,bitrateMax:o}}function Mo(e,t,n,i,o){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:i,bitrateMax:o}}function fC(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const Zce={"90p":Bt(160,90),"90p_1":Bt(160,90),"120p":Bt(160,120,15,30,65),"120p_1":Bt(160,120,15,30,65),"120p_3":Bt(120,120,15,30,50),"120p_4":Bt(212,120),"180p":Bt(320,180,15,30,140),"180p_1":Bt(320,180,15,30,140),"180p_3":Bt(180,180,15,30,100),"180p_4":Bt(240,180,15,30,120),"240p":Bt(320,240,15,40,200),"240p_1":Bt(320,240,15,40,200),"240p_3":Bt(240,240,15,40,140),"240p_4":Bt(424,240,15,40,220),"360p":Bt(640,360,15,80,400),"360p_1":Bt(640,360,15,80,400),"360p_3":Bt(360,360,15,80,260),"360p_4":Bt(640,360,30,80,600),"360p_6":Bt(360,360,30,80,400),"360p_7":Bt(480,360,15,80,320),"360p_8":Bt(480,360,30,80,490),"360p_9":Bt(640,360,15,80,800),"360p_10":Bt(640,360,24,80,800),"360p_11":Bt(640,360,24,80,1e3),"480p":Bt(640,480,15,100,500),"480p_1":Bt(640,480,15,100,500),"480p_2":Bt(640,480,30,100,1e3),"480p_3":Bt(480,480,15,100,400),"480p_4":Bt(640,480,30,100,750),"480p_6":Bt(480,480,30,100,600),"480p_8":Bt(848,480,15,100,610),"480p_9":Bt(848,480,30,100,930),"480p_10":Bt(640,480,10,100,400),"720p":Bt(1280,720,15,120,1130),"720p_auto":Bt(1280,720,30,900,3e3),"720p_1":Bt(1280,720,15,120,1130),"720p_2":Bt(1280,720,30,120,2e3),"720p_3":Bt(1280,720,30,120,1710),"720p_5":Bt(960,720,15,120,910),"720p_6":Bt(960,720,30,120,1380),"1080p":Bt(1920,1080,15,120,2080),"1080p_1":Bt(1920,1080,15,120,2080),"1080p_2":Bt(1920,1080,30,120,3e3),"1080p_3":Bt(1920,1080,30,120,3150),"1080p_5":Bt(1920,1080,60,120,4780),"1440p":Bt(2560,1440,30,120,4850),"1440p_1":Bt(2560,1440,30,120,4850),"1440p_2":Bt(2560,1440,60,120,7350),"4k":Bt(3840,2160,30,120,8910),"4k_1":Bt(3840,2160,30,120,8910),"4k_3":Bt(3840,2160,60,120,13500)},ele={"480p":Mo(640,480,5),"480p_1":Mo(640,480,5),"480p_2":Mo(640,480,30),"480p_3":Mo(640,480,15),"720p":Mo(1280,720,5),"720p_auto":Bt(1280,720,30,900,3e3),"720p_1":Mo(1280,720,5),"720p_2":Mo(1280,720,30),"720p_3":Mo(1280,720,15),"1080p":Mo(1920,1080,5),"1080p_1":Mo(1920,1080,5),"1080p_2":Mo(1920,1080,30),"1080p_3":Mo(1920,1080,15)},tle={"1SL1TL":fC(1,1),"3SL3TL":fC(3,3),"2SL3TL":fC(2,3)};function jo(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Zce[e]):e}function gC(e){return typeof e=="string"?Object.assign({},ele[e]):e}function qy(e){return typeof e=="string"?Object.assign({},tle[e]):e}const nle={speech_low_quality:lp(16e3,!1),speech_standard:lp(32e3,!1,18),music_standard:lp(48e3,!1),standard_stereo:lp(48e3,!0,56),high_quality:lp(48e3,!1,128),high_quality_stereo:lp(48e3,!0,192)};function Xy(e){return typeof e=="string"?Object.assign({},nle[e]):e}const au=[];function fU(e){return Qn(e,"mediaSource",["screen","window","application"]),!0}let Ve=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Xt=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),dp=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),rle=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),sle=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),cu=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),up=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),ro=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),hp=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Li=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const _C={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},yC={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},gU={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},ile={uplinkNetworkQuality:0,downlinkNetworkQuality:0},_U={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let As=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Mi=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),$f=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),lu=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),ts=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),sc=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const EC={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Jy=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Mt(e,t,n,i,o){var l,u,p={};return Object.keys(i).forEach(function(m){p[m]=i[m]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=Zi(l=H2(u=n.slice()).call(u)).call(l,function(m,g){return g(e,t,m)||m},p),o&&p.initializer!==void 0&&(p.value=p.initializer?p.initializer.call(o):void 0,p.initializer=void 0),p.initializer===void 0?(Object.defineProperty(e,t,p),null):p}function re(e,t,n){return(t=function(i){var o=function(l,u){if(typeof l!="object"||!l)return l;var p=l[Symbol.toPrimitive];if(p!==void 0){var m=p.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(i);return typeof o=="symbol"?o:o+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function En(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yU(Object(n),!0).forEach(function(i){re(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class EU extends On{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(cu.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),re(this,"trackMediaType",void 0),re(this,"_ID",void 0),re(this,"_rtpTransceiver",void 0),re(this,"_lowRtpTransceiver",void 0),re(this,"_hints",[]),re(this,"_isClosed",!1),re(this,"_originMediaStreamTrack",void 0),re(this,"mediaStreamTrack",void 0),re(this,"_external",{}),this._ID=n||Zt(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(i){fe(au).call(au,i)||au.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Pl(()=>{var n;Ue.reportApiInvoke(null,{name:Rn.GET_MEDIA_STREAM_TRACK,options:[],tag:hn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===dp.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=au.indexOf(t);n!==-1&&au.splice(n,1)}(this),this.emit(up.CLOSED),this.removeAllListeners(cu.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===dp.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(cu.TRANSCEIVER_UPDATED,t,n)}}class pp extends EU{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),re(this,"_enabled",!0),re(this,"_muted",!1),re(this,"_isExternalTrack",!1),re(this,"_isClosed",!1),re(this,"_enabledMutex",void 0),re(this,"processor",void 0),re(this,"_processorContext",void 0),re(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ar("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,C.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ve.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await mn(this,Ve.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){C.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(up.TRACK_ENDED)}stateCheck(t,n){if(C.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),Do(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new oe(G.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",C);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new oe(G.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",C)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():xe.resolve([])}}const vU=window.AudioContext||window.webkitAudioContext;let vC,ji=null;const an=new class extends On{constructor(){super(...arguments),re(this,"prevState",void 0),re(this,"curState",void 0),re(this,"currentTime",void 0),re(this,"currentTimeStuckAt",void 0),re(this,"interruptDetectorTrack",void 0),re(this,"onLocalAudioTrackMute",()=>{C.info("ios15-interruption-start"),this.emit(Fr.IOS_15_16_INTERRUPTION_START)}),re(this,"onLocalAudioTrackUnmute",async()=>{C.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?C.info("ios15-interruption-end-canceled"):(ji&&await ji.suspend(),this.emit(Fr.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){C.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){C.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function mp(){if(!ji){if(function(){if(!vU)return void C.error("your browser is not support web audio");C.info("create audio context");const e=En({},$("WEBAUDIO_INIT_OPTIONS"));C.debug("audio context init option:",JSON.stringify(e)),ji=new vU(e),an.curState=ji.state,ji.onstatechange=()=>{an.prevState=an.curState,an.curState=ji?ji.state:void 0;const{prevState:t,curState:n}=an,i=n==="running",o=n==="interrupted",l=t==="running",u=t==="suspended",p=t==="interrupted",m=Ft().osVersion;(ds()||Po())&&l&&o&&(C.info("ios".concat(m,"-interruption-start")),an.emit(Fr.IOS_INTERRUPTION_START)),(ds()||Po())&&(u||p)&&i&&(C.info("ios".concat(m,"-interruption-end")),an.emit(Fr.IOS_INTERRUPTION_END)),t!==n&&an.emit(Fr.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=ji)===null||t===void 0?void 0:t.currentTime;an.currentTime!==n?(an.currentTimeStuckAt&&(C.debug("AudioContext current time resume at ".concat(n)),an.currentTimeStuckAt=void 0),an.currentTime=n):(n!==an.currentTimeStuckAt&&(Ue.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:hn.TRACER}).onSuccess(),C.warning("AudioContext current time stuck at ".concat(n))),an.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,o,l=!1,u=!1,p=!1;function m(W){t.state==="running"?g(!1):ds()||Po()?t.state==="suspended"&&(g(!0),W&&t.resume().then(y,y)):t.state!=="closed"&&(g(!0),W&&t.resume().then(y,y))}function g(W){if(l!==W){l=W;for(let H=0,Y=n;H<Y.length;H+=1){const Q=Y[H];W?window.addEventListener(Q,b,{capture:!0,passive:!0}):window.removeEventListener(Q,b,{capture:!0,passive:!0})}}}function y(){m(!1)}function b(){m(!0)}function S(){let W;try{W=i.play(),W?W.then(I,I):(i.addEventListener("playing",I),i.addEventListener("abort",I),i.addEventListener("error",I))}catch{I()}}function w(W){p||(i.paused?W?(k(!1),p=!0,S()):k(!0):k(!1))}function k(W){if(u!==W){u=W;for(let H=0,Y=n;H<Y.length;H++){const Q=Y[H];W?window.addEventListener(Q,O,{capture:!0,passive:!0}):window.removeEventListener(Q,O,{capture:!0,passive:!0})}}}function I(){i.removeEventListener("playing",I),i.removeEventListener("abort",I),i.removeEventListener("error",I),p=!1,w(!1)}function O(){w(!0)}if(ds()&&$("IOS_BG_TAG")){const W=t.createMediaStreamDestination(),H=document.createElement("div");H.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=H.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=W.stream,o=()=>{if($("IOS_AUTO_RESTART_BG_TAG")&&i&&i.srcObject&&!p&&(!i.paused||u!==!0)){i.paused||i.pause();try{p=!0,S()}catch{p=!1}return!0}},w(!0)}return an.on(Fr.STATE_CHANGE,function(){m(!0)}),m(!1),o}(ji).then(t=>{vC=t})}(),!ji)throw new oe(G.NOT_SUPPORTED,"can not create audio context");return ji}return ji}function du(e){if(function(){if(bC!==null)return bC;const i=mp(),o=i.createBufferSource(),l=i.createGain(),u=i.createGain();o.connect(l),o.connect(u),o.disconnect(l);let p=!1;try{o.disconnect(l)}catch{p=!0}return o.disconnect(),bC=p,p}())return;const t=e.connect,n=e.disconnect;e.connect=(i,o,l)=>{var u;return e._inputNodes||(e._inputNodes=[]),fe(u=e._inputNodes).call(u,i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,o,l)):t.call(e,i,o)),e},e.disconnect=(i,o,l)=>{n.call(e),i?Uy(e._inputNodes,i):e._inputNodes=[];for(const u of e._inputNodes)t.call(e,u)}}let bC=null;function SC(e,t){let n=!1;const i=1/t;if($("DISABLE_WEBAUDIO")){const o=window.setInterval(()=>{n?window.clearInterval(o):e(performance.now()/1e3)},1e3*i)}else{const o=mp();let l=o.createGain();l.gain.value=0,l.connect(o.destination);const u=()=>{if(n)return void(l=null);const p=o.createOscillator();p.onended=u,p.connect(l),p.start(0),p.stop(o.currentTime+i),e(o.currentTime)};u()}return()=>{n=!0}}class bU{constructor(){re(this,"context",void 0),re(this,"analyserNode",void 0),re(this,"sourceNode",void 0),this.context=mp(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ds()||Po()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let o=0;o<t.length;++o)t[o]=i[o]/128-1}const n=Zi(t).call(t,(i,o)=>i+o*o,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{C.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class SU extends On{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),re(this,"outputNode",void 0),re(this,"outputTrack",void 0),re(this,"isPlayed",!1),re(this,"sourceNode",void 0),re(this,"context",void 0),re(this,"audioBufferNode",void 0),re(this,"destNode",void 0),re(this,"audioOutputLevel",0),re(this,"volumeLevelAnalyser",void 0),re(this,"_processedNode",void 0),re(this,"playNode",void 0),re(this,"isDestroyed",!1),re(this,"onNoAudioInput",void 0),re(this,"isNoAudioInput",!1),re(this,"_noAudioInputCount",0),this.context=mp(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),du(this.outputNode),this.volumeLevelAnalyser=new bU}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Li.ON_AUDIO_BUFFER,function(i){for(let o=0;o<i.outputBuffer.numberOfChannels;o+=1){const l=i.outputBuffer.getChannelData(o);for(let u=0;u<l.length;u+=1)l[u]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!It().webAudioMediaStreamDest)throw new oe(G.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&Vy(()=>{an.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ds()||Po()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let o=!1;for(let l=0;l<i.length;l++)i[l]!==0&&(o=!0);return o?(this.isNoAudioInput=!1,!0):(await vr(200),await this.checkHasAudioInput(t?t+1:1)&&o)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class xC extends SU{get isFreeze(){return!1}constructor(t,n,i){var o;if(super(),re(this,"sourceNode",void 0),re(this,"track",void 0),re(this,"clonedTrack",void 0),re(this,"audioElement",void 0),re(this,"isCurrentTrackCloned",!1),re(this,"isRemoteTrack",!1),re(this,"originVolumeLevelAnalyser",void 0),re(this,"rebuildWebAudio",async()=>{if(C.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void C.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>C.info("resume success")),C.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const p=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?p.stop():this.isCurrentTrackCloned=!0;const m=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(m),du(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const g=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(g,this.context.currentTime),du(this.outputNode),this.emit(Li.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=m,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new oe(G.UNEXPECTED_ERROR);this.track=t;const l=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(l),du(this.sourceNode),i){const p=i.clone();p.enabled=!0,this.clonedTrack=p,C.debug("create an unmuted track ".concat(p.id," from the original track ").concat(i.id," to get the volume"));const m=this.context.createMediaStreamSource(new MediaStream([p]));du(m),this.originVolumeLevelAnalyser=new bU,this.originVolumeLevelAnalyser.updateSource(m)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=l;const u=Ft();n&&u.os===Er.IOS&&Number((o=u.osVersion)===null||o===void 0?void 0:o.split(".")[0])<15&&(an.on(Fr.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(p=>{p||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),du(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Li.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),an.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),C.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));du(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function xU(e,t,n){const i=(l,u)=>l?typeof l!="number"?l.max||l.exact||l.ideal||l.min||u:l:u,o={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(o.video.mandatory.maxFrameRate=t.frameRate.max,o.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(o.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(o)}async function ole(e,t){const n=await wU(e.mediaSource),{sourceId:i,audio:o}=await function(l){let u=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new xe((p,m)=>{const g=document.createElement("div");g.innerText="share screen",g.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const y=document.createElement("div");y.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const b=document.createElement("div");b.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",b.setAttribute("style","height: 12%;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const w=document.createElement("div");w.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const k=document.createElement("button");k.innerHTML="cancel",k.setAttribute("style","width: 85px;"),k.onclick=()=>{document.body.removeChild(W);const H=new Error("NotAllowedError");H.name="NotAllowedError",m(H)};let I=u;const O=document.createElement("div");if(u){const H=document.createElement("input");H.setAttribute("type","checkbox");const Y=document.createElement("span");H.setAttribute("style","margin-right: 6px;"),Y.innerText="Share audio",H.checked=I,H.onchange=()=>{I=H.checked},O.appendChild(H),O.appendChild(Y)}w.appendChild(O),w.appendChild(k),y.appendChild(b),y.appendChild(S),y.appendChild(w);const W=document.createElement("div");W.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),W.appendChild(g),W.appendChild(y),document.body.appendChild(W),l.map(H=>{if(H.id){const Y=document.createElement("div");Y.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Q=H.thumbnail;try{const{width:Z}=Q.getSize();Z>1920&&(Q=Q.resize({width:1920}))}catch(Z){throw Z&&Z.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Z}Y.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Q.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+H.name.replace(/[\u00A0-\u9999<>\&]/g,function(Z){return"&#"+Z.charCodeAt(0)+";"})+"</span>",Y.onclick=()=>{document.body.removeChild(W),p({sourceId:H.id,audio:I})},S.appendChild(Y)}})})}(n,t);return await xU(i,e,o)}async function wU(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=k5();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new oe(G.ELECTRON_IS_NULL);let i=null;try{var o;i=((o=n.desktopCapturer)===null||o===void 0?void 0:o.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new xe((l,u)=>{n.desktopCapturer.getSources({types:t},(p,m)=>{p?u(p):l(m)})}));try{return await i}catch(l){throw new oe(G.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,l.toString())}}const wC=new Ar("safari");let TU=!1,CU=!1;async function Ui(e,t){let n=0,i=null;for(;n<2;)try{i=await ale(e,t,n>0);break}catch(o){if(o instanceof oe)throw C.error("[".concat(t,"] ").concat(o.toString())),o;const l=Qy(o.name||o.code||o,o.message);if(l.code===G.MEDIA_OPTION_INVALID){C.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await vr(500);continue}throw C.error("[".concat(t,"] ").concat(l.toString())),l}if(!i)throw new oe(G.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function ale(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new oe(G.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const i=It(),o=new MediaStream;if(e.audioSource&&o.addTrack(e.audioSource),e.videoSource&&o.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return C.debug("Using Video Source/ Audio Source"),o;if(e.screen)if(k5())e.screen.sourceId?fp(o,await xU(e.screen.sourceId,e.screen,!!e.screenAudio)):fp(o,await ole(e.screen,!!e.screenAudio));else if($c()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new oe(G.NOT_SUPPORTED,"This browser does not support screen sharing");C.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const S=await(u=e.screen.extensionId,p=t,new xe((w,k)=>{try{chrome.runtime.sendMessage(u,{getStream:!0},I=>{if(!I||!I.streamId)return C.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),I),void k(new oe(G.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));w(I.streamId)})}catch(I){C.error("[".concat(p,"] AgoraRTC screensharing plugin is not accessible(").concat(u,")"),I.toString()),k(new oe(G.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=S,fp(o,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var l;e.screen.mediaSource&&fU(e.screen.mediaSource);const S={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(l=e.screen.displaySurface)!==null&&l!==void 0?l:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:w,surfaceSwitching:k,systemAudio:I,preferCurrentTab:O,windowAudio:W,monitorTypeSurfaces:H}=e.screen,Y={selfBrowserSurface:w,surfaceSwitching:k,systemAudio:I,preferCurrentTab:O,windowAudio:W,monitorTypeSurfaces:H};!w&&delete Y.selfBrowserSurface,!k&&delete Y.surfaceSwitching,!I&&delete Y.systemAudio,!O&&delete Y.preferCurrentTab,!W&&delete Y.windowAudio,!H&&delete Y.monitorTypeSurfaces,C.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:S,audio:e.screenAudio,controls:Y})),fp(o,await navigator.mediaDevices.getDisplayMedia(En({video:S,audio:e.screenAudio},Y)))}else{if(!Sn())throw C.error("[".concat(t,"] This browser does not support screenSharing")),new oe(G.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&fU(e.screen.mediaSource);const S={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};C.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(S))),fp(o,await navigator.mediaDevices.getUserMedia(S))}}var u,p;if(!e.video&&!e.audio)return o;let m={video:e.video,audio:e.audio},g=$("MEDIA_DEVICE_CONSTRAINTS");if(g)try{typeof g=="string"&&(g=JSON.parse(g)),m=QT(m,g)}catch{}C.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(m)),Ft();let y,b=null;(Nr()||ds()||jy())&&(b=await wC.lock());try{y=await navigator.mediaDevices.getUserMedia(m)}catch(S){throw b&&b(),S}return m.audio&&(TU=!0),m.video&&(CU=!0),fp(o,y),b&&b(),o}function Qy(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new oe(G.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new oe(G.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new oe(G.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new oe(G.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new oe(G.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new oe(G.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return C.error("getUserMedia unexpected error",e),new oe(G.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function fp(e,t){const n=e.getVideoTracks()[0],i=e.getAudioTracks()[0],o=t.getVideoTracks()[0],l=t.getAudioTracks()[0];l&&(i&&e.removeTrack(i),e.addTrack(l)),o&&(n&&e.removeTrack(n),e.addTrack(o))}const Vi=new class extends On{get state(){return this._state}set state(e){e!==this._state&&(this.emit(lu.STATE_CHANGE,e),this._state=e)}constructor(){super(),re(this,"_state",$f.IDLE),re(this,"isAccessMicrophonePermission",!1),re(this,"isAccessCameraPermission",!1),re(this,"lastAccessMicrophonePermission",!1),re(this,"lastAccessCameraPermission",!1),re(this,"checkdeviceMatched",!1),re(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{($("ENUMERATE_DEVICES_INTERVAL")||(Df()||My()===Er.HARMONY_OS)&&nc())&&this.updateDevicesInfo()},$("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>C.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new oe(G.NOT_SUPPORTED,"enumerateDevices() not supported.");const i=await navigator.mediaDevices.enumerateDevices(),o=this.checkMediaDeviceInfoIsOk(i);let l=!this.isAccessMicrophonePermission&&e,u=!this.isAccessCameraPermission&&t;o.audio&&(l=!1),o.video&&(u=!1);let p=null,m=null,g=null;if(!n&&(l||u)){if(wC.isLocked&&(C.debug("[device manager] wait GUM lock"),(await wC.lock())(),C.debug("[device manager] GUM unlock")),TU&&(l=!1,this.isAccessMicrophonePermission=!0),CU&&(u=!1,this.isAccessCameraPermission=!0),C.debug("[device manager] check media device permissions",e,t,l,u),l&&u){try{g=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(y){const b=Qy(y.name||y.code||y,y.message);if(b.code===G.PERMISSION_DENIED)throw b;C.warning("getUserMedia failed in getDevices",b)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(l){try{p=await navigator.mediaDevices.getUserMedia({audio:e})}catch(y){const b=Qy(y.name||y.code||y,y.message);if(b.code===G.PERMISSION_DENIED)throw b;C.warning("getUserMedia failed in getDevices",b)}this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({video:t})}catch(y){const b=Qy(y.name||y.code||y,y.message);if(b.code===G.PERMISSION_DENIED)throw b;C.warning("getUserMedia failed in getDevices",b)}this.isAccessCameraPermission=!0}C.debug("[device manager] mic permission",e,"cam permission",t)}try{const y=await navigator.mediaDevices.enumerateDevices();return p&&p.getTracks().forEach(b=>b.stop()),m&&m.getTracks().forEach(b=>b.stop()),g&&g.getTracks().forEach(b=>b.stop()),p=null,m=null,g=null,y}catch(y){return p&&p.getTracks().forEach(b=>b.stop()),m&&m.getTracks().forEach(b=>b.stop()),g&&g.getTracks().forEach(b=>b.stop()),p=null,m=null,g=null,new oe(G.ENUMERATE_DEVICES_FAILED,y.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new oe(G.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=$f.INITING;try{await this.updateDevicesInfo(),this.state=$f.INITEND}catch(e){throw this.state=$f.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(C.warning("Device Detection functionality cannot start properly.",e.toString()),e):new oe(G.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const o=e.find(u=>u.kind==="audioinput"&&u.deviceId==="default"),l=e.find(u=>u.kind==="audiooutput"&&u.deviceId==="default");o&&l?l.groupId===o.groupId?C.debug("[device-check] default input ".concat(o.label," and output ").concat(l.label," is the same group")):C.debug("[device-check] default input ".concat(o.label," and output ").concat(l.label," is not the same group")):C.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(o=>{if(!o.deviceId)return;const l=this.deviceInfoMap.get("".concat(o.kind,"_").concat(o.deviceId));if((l?l.state:"INACTIVE")!=="ACTIVE"){const u={initAt:t,updateAt:t,device:o,state:"ACTIVE"};this.deviceInfoMap.set("".concat(o.kind,"_").concat(o.deviceId),u),n.push(u)}l&&(l.updateAt=t)}),this.deviceInfoMap.forEach((o,l)=>{o.state==="ACTIVE"&&o.updateAt!==t&&(o.state="INACTIVE",n.push(o))}),this.state!==$f.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(o=>{switch(o.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(lu.RECORDING_DEVICE_CHANGED,o);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(lu.CAMERA_DEVICE_CHANGED,o);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(lu.PLAYOUT_DEVICE_CHANGED,o)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(o=>o.kind==="audioinput"),n=e.filter(o=>o.kind==="videoinput"),i={audio:!1,video:!1};for(const o of t)if(o.label&&o.deviceId){i.audio=!0;break}for(const o of n)if(o.label&&o.deviceId){i.video=!0;break}return i}};let TC=!1;const Us=new class extends On{constructor(){super(...arguments),re(this,"onAutoplayFailed",void 0),re(this,"onAudioAutoplayFailed",void 0)}};function RU(){if(TC)return $("FLS_AUTOPLAY_EMITS")?(Us.onAutoplayFailed&&Us.onAutoplayFailed(),Us.emit("autoplay-failed")):void 0;{const e=t=>{t.preventDefault(),TC=!1,kf()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};TC=!0,kf()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),C.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Us.onAutoplayFailed?Us.onAutoplayFailed():Us.onAudioAutoplayFailed?C.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):C.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Us.emit("autoplay-failed")}}function NU(e,t,n,i){if(!e)return;const o=Ue.getBaseInfoBySessionId(e);if(!o)return;const l=o.info,u=Date.now(),p=En(En({},l),{},{vid:l.vid===void 0?0:Number(l.vid),lts:u,elapse:u-o.startTime,cbRegistered:Us.onAutoplayFailed||Us.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:i,extend:void 0});Ue.send({type:Nn.AUTOPLAY_FAILED,data:p},!0)}const cle=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],gs=new class{constructor(){re(this,"onAutoplayFailed",void 0),re(this,"elementMap",new Map),re(this,"elementStateMap",new Map),re(this,"elementsNeedToResume",[]),re(this,"sinkIdMap",new Map),re(this,"autoResumeAfterInterruption",e=>xe.all(Array.from(this.elementMap.entries()).map(async t=>{let[n,i]=t;const o=this.elementStateMap.get(n),l=i.srcObject.getAudioTracks()[0],u=l&&l.readyState;if(C.debug("resume after interrupted, ele: ".concat(o," audio: ").concat(u," ").concat(e)),u==="live"){if(e)return i.pause(),i.play();if(an.curState==="running")return tp()?(i.pause(),i.play()):o&&o==="paused"?i.play():void 0}}))),re(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(C.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),an.on(Fr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),an.on(Fr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),an.on(Fr.STATE_CHANGE,()=>{ds()&&an.prevState==="suspended"&&an.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(i){throw new oe(G.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,n,i){if(this.elementMap.has(t))return;const o=document.createElement("audio");o.autoplay=!0,o.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,o),this.elementMap.set(t,o),this.elementStateMap.set(t,ts.INIT),this.setVolume(t,n);const l=this.sinkIdMap.get(t);if(l)try{o.setSinkId(l).catch(p=>{C.warning("[".concat(t,"] set sink id failed"),p.toString())})}catch(p){C.warning("[".concat(t,"] set sink id failed"),p.toString())}const u=o.play();u&&u.then&&u.catch(p=>{i&&NU(i,"audio",p.message,t),C.warning("audio element play warning",p.toString()),this.elementMap.has(t)&&p.name==="NotAllowedError"&&(C.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(o),Vy(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),RU()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}getVolume(e){const t=this.elementMap.get(e);return t?t.volume:0}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){cle.forEach(n=>{t.addEventListener(n,i=>{const o=this.elementStateMap.get(e),l=i.type==="pause"?"paused":i.type;if(C.debug("[".concat(e,"] audio-element-status change ").concat(o," => ").concat(l)),i.type==="error"){const u=t==null?void 0:t.error;u&&C.error("[".concat(e,"] media error, code: ").concat(u.code,", message: ").concat(u.message))}this.elementStateMap.set(e,l)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{C.debug("Auto resume audio element success")}).catch(n=>{C.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new xe(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{kf()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function $n(){return function(e,t,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new oe(G.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",C);for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];const p=i.apply(this,l);return p instanceof xe?new xe((m,g)=>{p.then(m).catch(g)}):p}),n}}class AU extends On{constructor(t){super(),re(this,"name","VideoProcessorDestination"),re(this,"ID","0"),re(this,"_source",void 0),re(this,"videoContext",void 0),re(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new oe(G.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new oe(G.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(As.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(As.ON_TRACK,void 0)}}class IU extends On{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),re(this,"constraintsMap",new Map),re(this,"statsRegistry",[]),re(this,"usageRegistry",[]),re(this,"trackId",void 0),re(this,"direction",void 0),re(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await ar(this,Mi.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var i;return C.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),mn(this,Mi.REQUEST_UPDATE_CONSTRAINTS,Array.from(fi(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return C.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),mn(this,Mi.REQUEST_UPDATE_CONSTRAINTS,Array.from(fi(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:o,cb:l}of this.statsRegistry)try{const u=l();t.push({processorID:n,processorName:i,type:o,stats:u})}catch(u){C.error(new oe(G.UNEXPECTED_ERROR,u.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof xe&&(i=await i),t.push(En(En({},i),{},{direction:this.direction}))}catch(i){C.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class OU extends On{constructor(t){super(),re(this,"name","AudioProcessorDestination"),re(this,"ID","0"),re(this,"inputTrack",void 0),re(this,"inputNode",void 0),re(this,"audioProcessorContext",void 0),re(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new oe(G.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new oe(G.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(As.ON_TRACK,void 0),this.emit(As.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(As.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(As.ON_NODE,this.inputNode))}}class PU extends On{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,i){super(),re(this,"constraintsMap",new Map),re(this,"statsRegistry",[]),re(this,"audioContext",void 0),re(this,"trackId",void 0),re(this,"direction",void 0),re(this,"usageRegistry",[]),re(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=i}async getConstraints(){return ar(this,Mi.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var i;return C.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),mn(this,Mi.REQUEST_UPDATE_CONSTRAINTS,Array.from(fi(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),mn(this,Mi.REQUEST_UPDATE_CONSTRAINTS,Array.from(fi(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:o,cb:l}of this.statsRegistry)try{const u=l();t.push({processorID:n,processorName:i,type:o,stats:u})}catch(u){C.error(new oe(G.UNEXPECTED_ERROR,u.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof xe&&(i=await i),t.push(En(En({},i),{},{direction:this.direction}))}catch(i){C.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class CC extends On{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),re(this,"context",void 0),re(this,"processSourceNode",void 0),re(this,"outputTrack",void 0),re(this,"processedNode",void 0),re(this,"clonedTrack",void 0),re(this,"outputNode",void 0),this.outputNode=new lle}setVolume(){}createOutputTrack(){throw new oe(G.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class lle{disconnect(){}connect(){}}function DU(e){return new xe((t,n)=>{let i=!1;const o=document.createElement("video");o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.muted=!0,o.autoplay=!0,o.setAttribute("playsinline",""),o.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(o);const l=ds()?"canplay":"playing";o.addEventListener(l,()=>{const u=o.videoWidth,p=o.videoHeight;!u&&Sn()||(i=!0,o.srcObject=null,o.remove(),t([u,p]))}),o.srcObject=new MediaStream([e]),o.play().catch(jf),setTimeout(()=>{i||(o.srcObject=null,o.remove(),t([o.videoWidth,o.videoHeight]))},4e3)})}function Zy(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=jo(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!C5()&&n.frameRate&&(t.frameRate=n.frameRate),y5()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Sn()&&(t.frameRate={ideal:30,max:30}),t}function kU(e){const t={};return C5()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,$c()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function LU(e){const t=kU(e);if(e.encoderConfig){const n=Xy(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Df()&&(t.sampleRate=void 0),t}const MU=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:i,height:o}=e.getMediaStreamTrackSettings();let{frameRate:l=n,width:u=i,height:p=o}=t;if(!l||!u||!p)return;u=sp(u),p=sp(p),l=sp(l);const{max:m,min:g}=function(w,k,I){const O=200*Math.pow(I/15,.6)*Math.pow(w*k/640/360,.75);return{min:Math.floor(O),max:Math.floor(4*O)}}(u,p,l),{bitrateMax:y,bitrateMin:b}=t||{};y||C.debug("calculate bitrate: [w: ".concat(u,", h: ").concat(p,", fps: ").concat(l,"] => [brMax: ").concat(y,", brMin: ").concat(b,"]"));const{maxFramerate:S}=$("ENCODER_CONFIG_LIMIT");return S&&typeof S=="number"&&(l=Math.min(l,S)),{frameRate:l,bitrateMax:y||m,bitrateMin:b||g,scaleResolutionDownBy:1,scale:0}},jU=async(e,t,n)=>await(async(i,o,l)=>{const u=function(g){const y=[];for(let b=0;b<g.length;b+=2)y.push(parseInt(g.slice(b,b+2),16));return Uint8Array.from(y)}(K5(""+o+l)).slice(0,16),p=u.slice(0,12),m=await window.crypto.subtle.importKey("raw",u,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:p},m,i))})(e.buffer,t,n),RC=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new xe((n,i)=>{t.toBlob(async o=>{if(t.remove(),o){const l=await UU(o);n({buffer:l,width:t.width,height:t.height})}else i(new oe(G.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},UU=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var VU,FU,BU,$U,WU,GU,HU,KU,zU,YU,qU,XU,JU,QU,ZU,e3,t3,n3,kn,r3,s3,i3,o3,a3,c3,ic,l3,d3,u3,h3,p3,m3,f3,g3,_3,y3,E3,v3,b3,Xr;let Wn=(VU=nt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),FU=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),BU=$n(),$U=ip("LocalAudioTrack","_enabledMutex"),WU=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),GU=$n(),HU=ip("LocalAudioTrack","_enabledMutex"),KU=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),zU=$n(),YU=$n(),qU=$n(),XU=nt({argsMap:e=>[e.getTrackId()]}),JU=$n(),QU=nt({argsMap:e=>[e.getTrackId()]}),ZU=$n(),e3=nt({argsMap:e=>[e.getTrackId()]}),t3=nt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),n3=nt({argsMap:e=>[e.getTrackId()]}),Mt((kn=class extends pp{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?gs.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,i){super(e,n),re(this,"trackMediaType",hp.AUDIO),re(this,"_encoderConfig",void 0),re(this,"_trackSource",void 0),re(this,"metadata",[]),re(this,"_enabled",!0),re(this,"_volume",100),re(this,"_useAudioElement",!0),re(this,"_bypassWebAudio",!1),re(this,"processor",void 0),re(this,"_processorContext",void 0),re(this,"_processorDestination",void 0),re(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new CC,$("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),$("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Nr()&&!ji?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){un(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&gs.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void C.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,mn(this,Ve.NEED_REPLACE_TRACK,this).then(()=>{C.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{C.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!dU())throw new oe(G.NOT_SUPPORTED,"your browser does not support setting the audio output device");await gs.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await mn(this,Ve.NEED_ENABLE_TRACK,this),C.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(i){throw n||(this._enabled=!1),C.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await mn(this,Ve.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),C.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,C.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await mn(this,Ve.NEED_MUTE_TRACK,this):await mn(this,Ve.NEED_UNMUTE_TRACK,this))}getStats(){return Pl(()=>{C.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),yi(this,Ve.GET_STATS)||En({},_C)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Li.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Li.ON_AUDIO_BUFFER),this._source.on(Li.ON_AUDIO_BUFFER,n=>e(n))}play(){C.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(C.debug("[".concat(this.getTrackId(),"] start audio playback in element")),gs.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){C.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?gs.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];C.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&gs.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await mn(this,Ve.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return xe.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new oe(G.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new oe(G.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(As.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await mn(this,Ve.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await mn(this,Ve.NEED_REPLACE_TRACK,this))}),e.on(As.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(As.ON_TRACK),e.removeAllListeners(As.ON_NODE)}bindProcessorContextEvents(e){e.on(Mi.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Mi.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof CC&&(this._trackSource=new xC(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new PU(this._source.context,this.getTrackId(),"local"),t=new OU(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Li.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(gs.stop(this.getTrackId()),this._source.play()),mn(this,Ve.NEED_REPLACE_MIXING_TRACK,this).then(()=>{C.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{C.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[VU],Object.getOwnPropertyDescriptor(kn.prototype,"setVolume"),kn.prototype),Mt(kn.prototype,"setPlaybackDevice",[FU,BU],Object.getOwnPropertyDescriptor(kn.prototype,"setPlaybackDevice"),kn.prototype),Mt(kn.prototype,"setEnabled",[$U,WU,GU],Object.getOwnPropertyDescriptor(kn.prototype,"setEnabled"),kn.prototype),Mt(kn.prototype,"setMuted",[HU,KU,zU],Object.getOwnPropertyDescriptor(kn.prototype,"setMuted"),kn.prototype),Mt(kn.prototype,"getStats",[YU],Object.getOwnPropertyDescriptor(kn.prototype,"getStats"),kn.prototype),Mt(kn.prototype,"setAudioFrameCallback",[qU],Object.getOwnPropertyDescriptor(kn.prototype,"setAudioFrameCallback"),kn.prototype),Mt(kn.prototype,"play",[XU,JU],Object.getOwnPropertyDescriptor(kn.prototype,"play"),kn.prototype),Mt(kn.prototype,"stop",[QU,ZU],Object.getOwnPropertyDescriptor(kn.prototype,"stop"),kn.prototype),Mt(kn.prototype,"close",[e3],Object.getOwnPropertyDescriptor(kn.prototype,"close"),kn.prototype),Mt(kn.prototype,"pipe",[t3],Object.getOwnPropertyDescriptor(kn.prototype,"pipe"),kn.prototype),Mt(kn.prototype,"unpipe",[n3],Object.getOwnPropertyDescriptor(kn.prototype,"unpipe"),kn.prototype),kn),Wf=(r3=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),s3=$n(),i3=ip("MicrophoneAudioTrack","_enabledMutex"),o3=nt({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),a3=$n(),c3=nt({argsMap:e=>[e.getTrackId()]}),Mt((ic=class extends Wn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,i){super(e,t.encoderConfig?Xy(t.encoderConfig):{},i,$("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),re(this,"_config",void 0),re(this,"_deviceName","default"),re(this,"_constraints",void 0),re(this,"_originalConstraints",void 0),re(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(tp()||GT())&&an.bindInterruptDetectorTrack(this)}async setDevice(e){if(C.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await Vi.getDeviceById(e),n={};n.audio=En({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await Ui(n,this.getTrackId())}catch(o){throw C.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),i=await Ui({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Vi.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}C.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return C.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),e),$("AUTO_RESET_AUDIO_ROUTE")&&(ds()||Po())){const u=navigator.audioSession;u&&(e||(u.type="playback"),u.type="auto")}if(!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await mn(this,Ve.NEED_DISABLE_TRACK,this)}catch(u){throw C.error("[".concat(this.getTrackId(),"] setEnabled false failed"),u.toString()),u}return}const o=En({},this._constraints),l=Vi.searchDeviceIdByName(this._deviceName);l&&!o.deviceId&&(o.deviceId=l);try{n||(this._enabled=!0);const u=await Ui({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!1),await mn(this,Ve.NEED_ENABLE_TRACK,this)}catch(u){throw n||(this._enabled=!1),C.error("[".concat(this.getTrackId(),"] setEnabled true failed"),u.toString()),u}C.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(tp()||GT())&&an.unbindInterruptDetectorTrack(this),au.some(e=>function(t){return"__className__"in t&&t.__className__==="MicrophoneAudioTrack"}(e))||vC&&vC()&&(Ue.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:hn.TRACER}).onSuccess(),C.debug("restart background audio tag success"))}onTrackEnded(){if((ds()||Po())&&this._enabled&&!this._isClosed&&an.duringInterruption){const e=async()=>{an.off(Fr.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(C.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};an.on(Fr.IOS_INTERRUPTION_END,e)}else C.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(up.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=Vi.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const i=await Ui({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Mi.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const o=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(o),n()}catch(o){i(o)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Mi.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[r3,s3],Object.getOwnPropertyDescriptor(ic.prototype,"setDevice"),ic.prototype),Mt(ic.prototype,"setEnabled",[i3,o3,a3],Object.getOwnPropertyDescriptor(ic.prototype,"setEnabled"),ic.prototype),Mt(ic.prototype,"close",[c3],Object.getOwnPropertyDescriptor(ic.prototype,"close"),ic.prototype),ic),dle=(l3=nt({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),d3=$n(),u3=nt({argsMap:e=>[e.getTrackId()]}),h3=$n(),p3=nt({argsMap:e=>[e.getTrackId()]}),m3=$n(),f3=nt({argsMap:e=>[e.getTrackId()]}),g3=$n(),_3=nt({argsMap:e=>[e.getTrackId()]}),y3=$n(),E3=nt({argsMap:e=>[e.getTrackId()]}),v3=nt({argsMap:e=>[e.getTrackId()]}),b3=$n(),Mt((Xr=class extends Wn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,i){super(t.createOutputTrack(),n,i),re(this,"source",void 0),re(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Li.AUDIO_SOURCE_STATE_CHANGE,o=>{this.safeEmit(up.SOURCE_STATE_CHANGE,o)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){un(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[l3,d3],Object.getOwnPropertyDescriptor(Xr.prototype,"startProcessAudioBuffer"),Xr.prototype),Mt(Xr.prototype,"pauseProcessAudioBuffer",[u3,h3],Object.getOwnPropertyDescriptor(Xr.prototype,"pauseProcessAudioBuffer"),Xr.prototype),Mt(Xr.prototype,"seekAudioBuffer",[p3,m3],Object.getOwnPropertyDescriptor(Xr.prototype,"seekAudioBuffer"),Xr.prototype),Mt(Xr.prototype,"resumeProcessAudioBuffer",[f3,g3],Object.getOwnPropertyDescriptor(Xr.prototype,"resumeProcessAudioBuffer"),Xr.prototype),Mt(Xr.prototype,"stopProcessAudioBuffer",[_3,y3],Object.getOwnPropertyDescriptor(Xr.prototype,"stopProcessAudioBuffer"),Xr.prototype),Mt(Xr.prototype,"close",[E3],Object.getOwnPropertyDescriptor(Xr.prototype,"close"),Xr.prototype),Mt(Xr.prototype,"setAudioBufferPlaybackSpeed",[v3,b3],Object.getOwnPropertyDescriptor(Xr.prototype,"setAudioBufferPlaybackSpeed"),Xr.prototype),Xr);class ur extends Wn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=mp().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Zt(8,"track-mix-")),re(this,"trackList",void 0),re(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(C.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):C.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){C.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}Uy(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof ur?n.emit(cu.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class ule extends SU{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Li.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),re(this,"audioBuffer",void 0),re(this,"sourceNode",void 0),re(this,"startPlayTime",0),re(this,"startPlayOffset",0),re(this,"pausePlayTime",0),re(this,"options",void 0),re(this,"currentLoopCount",0),re(this,"currentPlaybackSpeed",100),re(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):C.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const S3=new Map;function x3(e,t){if(e.length===0||t.length===0)return 1/0;const n=eC(e),i=eC(t);return Math.floor(i/n)}class NC{get rendFrameRate(){const t=Math.max(1,x3(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:ts.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(C.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){re(this,"trackId",void 0),re(this,"config",void 0),re(this,"onFirstVideoFrameDecoded",void 0),re(this,"onFirstVideoFrameRender",void 0),re(this,"onVideoBufferReady",void 0),re(this,"onVideoStateChanged",void 0),re(this,"freezeTimeCounterList",[]),re(this,"renderFreezeAccTime",0),re(this,"renderFreezeAccTime2",0),re(this,"isKeepLastFrame",!1),re(this,"isDestroyed",!1),re(this,"timeUpdatedCount",0),re(this,"freezeTime",0),re(this,"playbackTime",0),re(this,"lastTimeUpdatedTime",0),re(this,"autoplayFailed",!1),re(this,"videoTrack",void 0),re(this,"videoElement",void 0),re(this,"cacheVideoElement",void 0),re(this,"cancelRVFId",void 0),re(this,"internal",!1),re(this,"_render_interframe_delays",[]),re(this,"_render_interframe_delays_sizes",[]),re(this,"_videoState",sc.VideoStateStopped),re(this,"videoElementCheckInterval",void 0),re(this,"videoElementFreezeTimeout",void 0),re(this,"_videoElementStatus",ts.NONE),re(this,"_isInPage",!0),re(this,"isGettingVideoDimensions",!1),re(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return C.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),re(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&an.curState==="running"&&(C.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(g5())),w5()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),re(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":n.type==="play"&&C.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=ts.PLAYING;break;case"loadeddata":if(this.videoState=sc.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=ts.CANPLAY;break;case"stalled":this.videoElementStatus=ts.STALLED;break;case"suspend":this.videoElementStatus=ts.SUSPEND;break;case"pause":this.videoElementStatus=ts.PAUSED,ds()||Po()||Nr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(C.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=ts.WAITING;break;case"abort":this.videoElementStatus=ts.ABORT;break;case"ended":this.videoElementStatus=ts.ENDED;break;case"emptied":this.videoElementStatus=ts.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=ts.ERROR,C.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>$("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const o=i-this.lastTimeUpdatedTime,l=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,Ei.lastVisibleTime<Ei.lastHiddenTime||l<Ei.lastHiddenTime||l<Ei.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(o>$("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=o),this.playbackTime+=o;this.playbackTime>=6e3;){this.playbackTime-=6e3;const u=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(u),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),re(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(C.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(g5())),w5()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),an.on(Fr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),an.on(Fr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(o=>{t&&NU(t,"video",o.message,this.trackId),o.name==="NotAllowedError"?(C.warning("detected video element autoplay failed",o),this.autoplayFailed=!0,this.handleAutoPlayFailed()):C.warning("[".concat(this.trackId,"] play warning: "),o)});const i=Ft();if((i.name==="Safari"&&Number(i.version)===15||tp())&&n&&n.then){const o=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(o).catch(o)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return C.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const o=i.getContext("2d");return o?(o.drawImage(this.videoElement,0,0,i.width,i.height),new xe((l,u)=>{i.toBlob(async p=>{if(i.remove(),p){const m=await UU(p);l({buffer:m,width:i.width,height:i.height})}else u(new oe(G.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await RC(t)}destroy(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,an.off(Fr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),an.off(Fr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),t?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=sc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=ts.INIT,!this.videoElementCheckInterval&&(w3.forEach(l=>{this.videoElement.addEventListener(l,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(l){return l!==document.body&&document.body.contains(l)}(this.videoElement)},1e3),$("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let l;const u=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",u),this.videoElementFreezeTimeout=window.setTimeout(p,$("VIDEO_FREEZE_DURATION")))},p=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===sc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=sc.VideoStateFrozen:document.addEventListener("visibilitychange",u))},m=(g,y)=>{if(this.videoElementStatus===ts.PLAYING){if(l){const w=y.presentationTime-l.presentationTime,k=y.presentedFrames-l.presentedFrames;this._render_interframe_delays_sizes.push(k),this._render_interframe_delays.push(w);const I=eC(this._render_interframe_delays_sizes),O=I-this._render_interframe_delays_sizes[0];if(I>30&&O>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===sc.VideoStateStarting&&(this.videoState=sc.VideoStateDecoding),this.videoState===sc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(p,$("VIDEO_FREEZE_DURATION"))),w<$("VIDEO_FREEZE_DURATION")&&this.videoState===sc.VideoStateFrozen&&(this.videoState=sc.VideoStateDecoding),w>$("VIDEO_FREEZE_DURATION")&&Ei.lastVisibleTime>=Ei.lastHiddenTime&&l.timestamp>Ei.lastVisibleTime&&l.timestamp>Ei.lastHiddenTime){const W=Math.min(66,x3(this._render_interframe_delays_sizes,this._render_interframe_delays)),H=Math.max(0,w-(k-1)*W);this.renderFreezeAccTime2+=H>W?H:0,this.renderFreezeAccTime+=w}}l=En(En({},y),{},{timestamp:g})}else this.isSkipCalcRenderFreezeTime()&&(l=En(En({},y),{},{timestamp:g}));var b,S;$("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(b=(S=this.videoElement).requestVideoFrameCallback)===null||b===void 0?void 0:b.call(S,m))};this.cancelRVFId=(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0?void 0:t.call(n,m)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Df()&&!$("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=Ft();this.config.noStyle||(i.name==="Safari"&&Number(i.version)===15||tp()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Sn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Sn()&&this.videoElement.load());const o=this.videoElement.play();o!==void 0&&o.catch(l=>{C.debug("[".concat(this.trackId,"] playback interrupted"),l.toString())})}resetVideoElement(){var t,n;w3.forEach(i=>{this.videoElement&&this.videoElement.removeEventListener(i,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((t=(n=this.videoElement).cancelVideoFrameCallback)===null||t===void 0||t.call(n,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=ts.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===ts.DESTROYED||this.internal}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{C.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{C.error(i)}),this.autoplayFailed=!1,kf()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};kf()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),RU()}}const w3=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class eE extends NC{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),re(this,"container",void 0),re(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;var i;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(i=this.slot)===null||i===void 0||i.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await RC(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",$("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var T3,C3,R3,N3,A3,I3,O3,P3,D3,k3,L3,M3,j3,U3,V3,F3,B3,$3,W3,G3,H3,K3,z3,Y3,q3,X3,J3,Q3,Ot,Z3,eV,tV,nV,rV,sV,iV,oV,Fi;let pn=(T3=nt({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),C3=$n(),R3=nt({argsMap:e=>[e.getTrackId()]}),N3=ip("LocalVideoTrack","_enabledMutex"),A3=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),I3=$n(),O3=ip("LocalVideoTrack","_enabledMutex"),P3=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),D3=$n(),k3=nt({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),L3=$n(),M3=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),j3=$n(),U3=$n(),V3=nt({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),F3=$n(),B3=$n(),$3=$n(),W3=nt({argsMap:e=>[e.getTrackId()]}),G3=$n(),H3=$n(),K3=$n(),z3=$n(),Y3=$n(),q3=nt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),X3=nt({argsMap:e=>[e.getTrackId()]}),J3=nt({argsMap:e=>[e.getTrackId()]}),Q3=nt({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),Ot=class KY extends pp{get videoHeight(){if(Nr()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Nr()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ts.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,i,o,l,u){if(super(t,l),re(this,"trackMediaType",hp.VIDEO),re(this,"_player",void 0),re(this,"isUseScaleResolutionDownBy",!1),re(this,"_videoVisibleTimer",null),re(this,"_previousVideoVisibleStatus",void 0),re(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),re(this,"_encoderConfig",void 0),re(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),re(this,"_optimizationMode",void 0),re(this,"_saveEncodeBitrateRatio",1),re(this,"_videoHeight",void 0),re(this,"_videoWidth",void 0),re(this,"_forceBitrateLimit",void 0),re(this,"_enabled",!0),re(this,"_processorDestination",void 0),re(this,"_processorContext",void 0),Nr()){const{width:p,height:m}=t.getSettings();this._videoWidth=p,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=i,this._optimizationMode=o,this._hints=u||[],n&&this._hints.indexOf(Xt.CUSTOM_TRACK)!==-1?this._encoderConfig=xn(n):this._encoderConfig=n,this._hints.indexOf(Xt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(BT(Ht.CHROME,115)&&My().indexOf("Windows")!==-1){const p=function(m,g){if("VideoFrame"in window&&"TransformStream"in window&&It().supportWebRTCInsertableStream){const y=new MediaStreamTrackProcessor(m),b=new MediaStreamTrackGenerator({kind:"video"});let S,w,k=Date.now();const I=()=>{O&&(clearInterval(O),O=void 0),S&&(S.close(),S=void 0),m.stop(),w=void 0,b.removeEventListener("ended",I)};let O=window.setInterval(()=>{if(w&&S&&Date.now()-k>1e3)try{b.readyState==="live"?w.enqueue(S.clone()):I()}catch{I()}},1e3);const W=new TransformStream({transform:(H,Y)=>{b.readyState==="live"?(w=Y,k=Date.now(),S===void 0?(S=H,Y.enqueue(H.clone())):(Y.enqueue(S),S=H)):H.close()}});return b.addEventListener("ended",I),y.readable.pipeThrough(W).pipeTo(b.writable),b}}(t);p&&(C.info("local screen video track begin to inject frame"),this._mediaStreamTrack=p)}n&&this._hints.indexOf(Xt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new IU(this.getTrackId(),"local"),this._processorDestination=new AU(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const o=document.getElementById(t);o?t=o:(C.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}C.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=En(En(En({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new NC(i):this._player=new eE(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(up.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},$("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,C.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await mn(this,Ve.NEED_DISABLE_TRACK,this)}catch(i){throw C.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void C.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await mn(this,Ve.NEED_ENABLE_TRACK,this)}catch(i){throw C.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}C.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,C.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await mn(this,Ve.NEED_MUTE_TRACK,this):await mn(this,Ve.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),C.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await mn(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(C)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new oe(G.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=jo(t),$("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const i=Zy({encoderConfig:t});(Nr()||ds()||Po())&&(i.deviceId=void 0),C.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(o){const l=new oe(G.UNEXPECTED_ERROR,o.toString());throw C.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}}this._encoderConfig=t,this._hints.indexOf(Xt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await mn(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(C)}}getStats(){return Pl(()=>{C.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),yi(this,Ve.GET_STATS)||En({},yC)}async setBeautyEffect(t){C.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await RC(t)}async findClosestProfile(){const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings(),{width:o,height:l,frameRate:u}=this._encoderConfig||{},p=sp(this._videoWidth||t||o||0),m=sp(this._videoHeight||n||l||0),g=function(y,b,S){if(!Array.isArray($("VIDEO_ENCODER_CONFIG_LIST"))||$("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const w=Math.min(y,b);return!(w>=480)&&En(En({},$("VIDEO_ENCODER_CONFIG_LIST").find(k=>k.height>w)),{},{frameRate:S})}(p,m,sp(i||u||15));if(g)return C.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(p,"x").concat(m," => ").concat(JSON.stringify(g))),this.setEncoderConfiguration(g)}async setBitrateLimit(t){C.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void C.error(G.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await mn(this,Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,C.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}C.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return C.error(G.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,C.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){DU(this._originMediaStreamTrack).then(t=>{let[n,i]=t;this._videoHeight=i,this._videoWidth=n}).catch(jf)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new oe(G.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");C.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=jo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Xt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await mn(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(C)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!n||!i)return;const{bitrateMax:o,bitrateMin:l}=this._encoderConfig;if(l==null||o==null){const{max:u,min:p}=function(m,g,y,b,S){const w=$("BITRATE_ADAPTER_TYPE");if(w==="DEFAULT_BITRATE")return{min:b,max:S};if(S===void 0){const k=Math.floor(200*Math.pow(y/15,.6)*Math.pow(m*g/640/360,.75));S=w==="STANDARD_BITRATE"?4*k:2*k,b=b??k}else b=b??Math.floor(S/10);return{min:b,max:S}}(t,n,i,l,o);if(this._encoderConfig.bitrateMin=p,this._encoderConfig.bitrateMax=u,$("VIDEO_STANDARD_BITRATE_VERSION")&&l==null&&o==null){const[m,g]=function(y,b,S){const w=4*Math.floor(2e5*Math.pow(S/15,.6)*Math.pow(y*b/230400,.75)),k=y*b,I=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),O=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let W=fi(I).call(I).next().value,H=1;if(I.has(k))W=I.get(k);else{var Y;const Oe=Wd(Y=Array.from(I.entries())).call(Y,(it,wt)=>{let[yt]=it,[Kt]=wt;return yt-Kt}),ot=Oe.find(it=>{let[wt]=it;return wt>k});if(ot){const it=Oe.indexOf(ot);if(it>0){const wt=Oe[it-1],yt=(k-wt[0])/(ot[0]-wt[0]);W=wt[1]+yt*(ot[1]-wt[1])}else W=ot[1]}else W=Oe[Oe.length-1][1]}if(O.has(k))H=O.get(k);else{var Q;const Oe=Wd(Q=Array.from(O.entries())).call(Q,(it,wt)=>{let[yt]=it,[Kt]=wt;return yt-Kt}),ot=Oe.find(it=>{let[wt]=it;return wt>k});if(ot){const it=Oe.indexOf(ot);if(it>0){const wt=Oe[it-1],yt=(k-wt[0])/(ot[0]-wt[0]);H=wt[1]+yt*(ot[1]-wt[1])}else H=ot[1]}else H=Oe[Oe.length-1][1]}const Z=$("VIDEO_NEW_BITRATE_RATIO");Z&&Z>0&&(W=Z/100);const q=Math.floor(w*W),ee=Math.floor(65e4*Math.pow(y*b/230400,.5)*Math.pow(S/15,.69));let ce=q;const me=$("VIDEO_STANDARD_BITRATE_VERSION");return me&&me>0&&(me===1?ce=w:me===2?ce=q:me===3&&(ce=ee)),[Math.floor(ce/1e3),H]}(t,n,i);this._encoderConfig.bitrateMax=m,this._encoderConfig.bitrateMin=p?Math.min(p,m):m,this._saveEncodeBitrateRatio=g,C.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else C.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(u,", brMin: ").concat(p,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:l,slot:u}=o;if(this.isPlaying&&l instanceof HTMLVideoElement&&u instanceof HTMLElement){const p=P5.checkOneElementVisible(l),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const g=Ue.reportApiInvoke(null,{tag:hn.TRACER,name:Rn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(i){throw new oe(G.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new oe(G.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=En(En({},i),jo(t))),i=nu(i);const o=Zt(8,"track-video-cloned-"),l=new KY(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,nu(this._scalabilityMode),this._optimizationMode,o,nu(this._hints));return t&&i&&l.setEncoderConfiguration(i),C.debug("clone video track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(n)),l}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new oe(G.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new oe(G.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Pl(()=>{Ue.reportApiInvoke(null,{name:Rn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:hn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!$("ENABLE_VIDEO_SEI")||!$("ENABLE_ENCODED_TRANSFORM"))return void C.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new oe(G.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void C.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const o=i.codecs[0].mimeType.toLocaleLowerCase();o==="video/h264"||o==="video/h265"?this.safeEmit("sei-to-send",t):C.warning("SEI is not supported by ".concat(o))}bindProcessorDestinationEvents(){this.processorDestination.on(As.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await mn(this,Ve.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await mn(this,Ve.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(As.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Mi.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Mi.REQUEST_CONSTRAINTS)}},Mt(Ot.prototype,"play",[T3,C3],Object.getOwnPropertyDescriptor(Ot.prototype,"play"),Ot.prototype),Mt(Ot.prototype,"stop",[R3],Object.getOwnPropertyDescriptor(Ot.prototype,"stop"),Ot.prototype),Mt(Ot.prototype,"setEnabled",[N3,A3,I3],Object.getOwnPropertyDescriptor(Ot.prototype,"setEnabled"),Ot.prototype),Mt(Ot.prototype,"setMuted",[O3,P3,D3],Object.getOwnPropertyDescriptor(Ot.prototype,"setMuted"),Ot.prototype),Mt(Ot.prototype,"setSaveEncodeBitrateRatio",[k3,L3],Object.getOwnPropertyDescriptor(Ot.prototype,"setSaveEncodeBitrateRatio"),Ot.prototype),Mt(Ot.prototype,"setEncoderConfiguration",[M3,j3],Object.getOwnPropertyDescriptor(Ot.prototype,"setEncoderConfiguration"),Ot.prototype),Mt(Ot.prototype,"getStats",[U3],Object.getOwnPropertyDescriptor(Ot.prototype,"getStats"),Ot.prototype),Mt(Ot.prototype,"setBeautyEffect",[V3,F3],Object.getOwnPropertyDescriptor(Ot.prototype,"setBeautyEffect"),Ot.prototype),Mt(Ot.prototype,"getCurrentFrameData",[B3],Object.getOwnPropertyDescriptor(Ot.prototype,"getCurrentFrameData"),Ot.prototype),Mt(Ot.prototype,"getCurrentFrameImage",[$3],Object.getOwnPropertyDescriptor(Ot.prototype,"getCurrentFrameImage"),Ot.prototype),Mt(Ot.prototype,"findClosestProfile",[W3,G3],Object.getOwnPropertyDescriptor(Ot.prototype,"findClosestProfile"),Ot.prototype),Mt(Ot.prototype,"setBitrateLimit",[H3],Object.getOwnPropertyDescriptor(Ot.prototype,"setBitrateLimit"),Ot.prototype),Mt(Ot.prototype,"setOptimizationMode",[K3],Object.getOwnPropertyDescriptor(Ot.prototype,"setOptimizationMode"),Ot.prototype),Mt(Ot.prototype,"setScalabiltyMode",[z3],Object.getOwnPropertyDescriptor(Ot.prototype,"setScalabiltyMode"),Ot.prototype),Mt(Ot.prototype,"updateMediaStreamTrackResolution",[Y3],Object.getOwnPropertyDescriptor(Ot.prototype,"updateMediaStreamTrackResolution"),Ot.prototype),Mt(Ot.prototype,"pipe",[q3],Object.getOwnPropertyDescriptor(Ot.prototype,"pipe"),Ot.prototype),Mt(Ot.prototype,"unpipe",[X3],Object.getOwnPropertyDescriptor(Ot.prototype,"unpipe"),Ot.prototype),Mt(Ot.prototype,"close",[J3],Object.getOwnPropertyDescriptor(Ot.prototype,"close"),Ot.prototype),Mt(Ot.prototype,"replaceTrack",[Q3],Object.getOwnPropertyDescriptor(Ot.prototype,"replaceTrack"),Ot.prototype),Ot),tE=(Z3=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),eV=$n(),tV=ip("CameraVideoTrack","_enabledMutex"),nV=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),rV=$n(),sV=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),iV=$n(),oV=nt({argsMap:e=>[e.getTrackId()]}),Fi=class zY extends pn{get __className__(){return"CameraVideoTrack"}constructor(t,n,i,o,l,u){super(t,jo(n.encoderConfig),o,l,u),re(this,"_config",void 0),re(this,"_originalConstraints",void 0),re(this,"_constraints",void 0),re(this,"_enabled",!0),re(this,"_deviceName","default"),re(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(tp()||GT())&&!function(){const p=Ft();if(p.os!==Er.IOS||!p.osVersion)return!1;const m=p.osVersion.split(".");return Number(m[0])===15&&Number(m[1])>=2}()&&T5()&&this._enabled&&!this._isClosed&&(C.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=jo(this._config.encoderConfig),an.on(Fr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),an.on(Fr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(C.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await Vi.getDeviceById(t),i={};i.video=En({},this._constraints),i.video.deviceId={exact:t},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let o=null;try{o=await Ui(i,this.getTrackId())}catch(l){throw C.error("[".concat(this.getTrackId(),"] setDevice failed"),l.toString()),o=await Ui({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),l}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await Vi.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}C.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){C.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:En(En({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await Ui(n,this.getTrackId())}catch(o){throw C.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),o.toString()),i=await Ui({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=En({},n.video),C.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await Ui({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await mn(this,Ve.NEED_ENABLE_TRACK,this)}catch(i){throw C.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),C.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await mn(this,Ve.NEED_DISABLE_TRACK,this)}catch(i){throw C.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}C.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new oe(G.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=jo(t),$("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const i=xn(this._config);i.encoderConfig=t;const o=Zy(i);(Nr()||ds()||Po())&&(o.deviceId=void 0),C.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(l){const u=new oe(G.UNEXPECTED_ERROR,l.toString());throw C.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}this._config=i,this._constraints=o,this._originalConstraints=o,this._encoderConfig=t,this._hints.indexOf(Xt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await mn(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(l){return l.throw(C)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ds()||Po())&&this._enabled&&!this._isClosed&&an.duringInterruption){const t=async()=>{an.off(Fr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(C.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};an.on(Fr.IOS_INTERRUPTION_END,t)}else C.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(up.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,i=Vi.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const o=await Ui({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),an.off(Fr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),an.off(Fr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=En(En({},i),jo(t))),i=nu(i);const o=Zt(8,"track-cam-cloned-"),l=new zY(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,nu(En(En({},this._config),{},{encoderConfig:i})),nu(this._constraints),nu(this._scalabilityMode),this._optimizationMode,o);return t&&i&&l.setEncoderConfiguration(i),C.debug("clone track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(n)),l}bindProcessorContextEvents(){this.processorContext.on(Mi.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const o=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(o),n()}catch(o){i(o)}}),this.processorContext.on(Mi.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Mt(Fi.prototype,"setDevice",[Z3,eV],Object.getOwnPropertyDescriptor(Fi.prototype,"setDevice"),Fi.prototype),Mt(Fi.prototype,"setEnabled",[tV,nV,rV],Object.getOwnPropertyDescriptor(Fi.prototype,"setEnabled"),Fi.prototype),Mt(Fi.prototype,"setEncoderConfiguration",[sV,iV],Object.getOwnPropertyDescriptor(Fi.prototype,"setEncoderConfiguration"),Fi.prototype),Mt(Fi.prototype,"close",[oV],Object.getOwnPropertyDescriptor(Fi.prototype,"close"),Fi.prototype),Fi);function aV(e){const t=Zt(8,"track-cus-"),n=Ue.reportApiInvoke(null,{id:t,tag:hn.TRACER,name:Rn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new Wn(e.mediaStreamTrack,e.encoderConfig?Xy(e.encoderConfig):{},t,!1);return C.info("create custom audio track success with config",e,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i}function AC(e,t,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=En(En({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?C.debug("[".concat(e,"] set content hint to"),n.optimizationMode):C.debug("[".concat(e,"] set content hint failed")))):C.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var cV,lV,dV,uV,so,hV,pV,mV,fV,gV,_V,yV,Jr;class EV extends EU{getUserId(){return this._userId}constructor(t,n,i,o){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(o.clientId,"_").concat(Zt(5,""))),re(this,"_userId",void 0),re(this,"_uintId",void 0),re(this,"_isDestroyed",!1),re(this,"store",void 0),re(this,"processor",void 0),re(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=o}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,C.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let gp=(cV=nt({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),lV=nt({argsMap:e=>[e.getTrackId()]}),dV=nt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),uV=nt({argsMap:e=>[e.getTrackId()]}),Mt((so=class extends EV{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ts.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,i,o){super(e,t,n,i),re(this,"_videoVisibleTimer",null),re(this,"_previousVideoVisibleStatus",void 0),re(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),re(this,"trackMediaType",hp.VIDEO),re(this,"_videoWidth",void 0),re(this,"_videoHeight",void 0),re(this,"_player",void 0),re(this,"_prePlayer",void 0),re(this,"processorDestination",void 0),re(this,"processorContext",void 0),this._prePlayer=o,this.updateMediaStreamTrackResolution(),this.processorContext=new IU(this.getTrackId(),"remote"),this.processorDestination=new AU(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Pl(()=>{C.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),yi(this,Ve.GET_STATS)||En({},_U)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(ro.PLAY_START),typeof e=="string"){const i=document.getElementById(e);i?e=i:(C.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}C.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=En(En({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let i=!1,o=!1;e instanceof HTMLVideoElement?(this._player=new NC(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,o=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,i=this._player.videoState>0,this._player.updateConfig(n)):this._player=new eE(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(ro.FIRST_FRAME_DECODED),o&&this.safeEmit(ro.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=l=>{this.safeEmit(ro.VIDEO_STATE_CHANGED,l)},i&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(ro.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},$("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(ro.PLAY_END)}stop(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(e),this._player=void 0,C.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){DU(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(jf)}_updatePlayerSource(){C.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:o,slot:l}=i;if(this.isPlaying&&o instanceof HTMLVideoElement&&l instanceof HTMLElement){const u=P5.checkOneElementVisible(o),p=Object.assign({},u);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;const m=Ue.reportApiInvoke(null,{tag:hn.TRACER,name:Rn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?m.onSuccess("Video is visible"):m.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(n){throw new oe(G.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new oe(G.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(As.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(As.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(cu.SEI_RECEIVED,e)}}).prototype,"play",[cV],Object.getOwnPropertyDescriptor(so.prototype,"play"),so.prototype),Mt(so.prototype,"stop",[lV],Object.getOwnPropertyDescriptor(so.prototype,"stop"),so.prototype),Mt(so.prototype,"pipe",[dV],Object.getOwnPropertyDescriptor(so.prototype,"pipe"),so.prototype),Mt(so.prototype,"unpipe",[uV],Object.getOwnPropertyDescriptor(so.prototype,"unpipe"),so.prototype),so),_p=(hV=nt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),pV=nt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),mV=nt({argsMap:(e,t)=>[e.getTrackId(),t]}),fV=nt({argsMap:e=>[e.getTrackId()]}),gV=nt({argsMap:e=>[e.getTrackId()]}),_V=nt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),yV=nt({argsMap:e=>[e.getTrackId()]}),Mt((Jr=class extends EV{get isPlaying(){return this._useAudioElement?gs.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,i){super(e,t,n,i),re(this,"trackMediaType",hp.AUDIO),re(this,"_source",void 0),re(this,"_useAudioElement",!0),re(this,"_volume",100),re(this,"processorContext",void 0),re(this,"processorDestination",void 0),re(this,"_played",!1),re(this,"_bypassWebAudio",!1),$("DISABLE_WEBAUDIO")?(this._source=new CC,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new xC(e,!0),$("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Li.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(ro.FIRST_FRAME_DECODED)}),this.processorContext=new PU(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new OU(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Li.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Li.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Li.ON_AUDIO_BUFFER),this._source.on(Li.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?gs.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}setAmplifiedVolume(e){this._useAudioElement&&this._played&&(gs.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,e=Math.min(e,$("MAX_WEBAUDIO_VOLUME")),this._volume=e,this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!dU())throw new oe(G.NOT_SUPPORTED,"your browser does not support setting the audio output device");await gs.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?gs.getVolume(this.getTrackId()):this._source instanceof xC?this._source.getAudioVolume():0}getStats(){return Pl(()=>{C.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),yi(this,Ve.GET_STATS)||En({},gU)}play(){C.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(C.debug("[".concat(this.getTrackId(),"] use audio element to play")),gs.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(C.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){C.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?gs.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];C.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&gs.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new oe(G.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new oe(G.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new oe(G.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(As.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(As.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(As.ON_TRACK),this.processorDestination.removeAllListeners(As.ON_NODE)}}).prototype,"setVolume",[hV],Object.getOwnPropertyDescriptor(Jr.prototype,"setVolume"),Jr.prototype),Mt(Jr.prototype,"setAmplifiedVolume",[pV],Object.getOwnPropertyDescriptor(Jr.prototype,"setAmplifiedVolume"),Jr.prototype),Mt(Jr.prototype,"setPlaybackDevice",[mV],Object.getOwnPropertyDescriptor(Jr.prototype,"setPlaybackDevice"),Jr.prototype),Mt(Jr.prototype,"play",[fV],Object.getOwnPropertyDescriptor(Jr.prototype,"play"),Jr.prototype),Mt(Jr.prototype,"stop",[gV],Object.getOwnPropertyDescriptor(Jr.prototype,"stop"),Jr.prototype),Mt(Jr.prototype,"pipe",[_V],Object.getOwnPropertyDescriptor(Jr.prototype,"pipe"),Jr.prototype),Mt(Jr.prototype,"unpipe",[yV],Object.getOwnPropertyDescriptor(Jr.prototype,"unpipe"),Jr.prototype),Jr);const Ei=new class extends On{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),re(this,"_lastHiddenTime",0),re(this,"_lastVisibleTime",0),re(this,"needUploadStats",[]),re(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),C.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class vV extends On{constructor(t,n){super(),re(this,"trackMediaType",hp.DATA),re(this,"_version",1),re(this,"_type",3),re(this,"_config",void 0),re(this,"_originDataChannel",void 0),re(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),re(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),re(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return $("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new xe((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const i=setTimeout(()=>{var o;n(new oe(G.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((o=this._originDataChannel)===null||o===void 0?void 0:o.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new oe(G.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new oe(G.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[Jy.OPEN,Jy.CLOSE,Jy.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),t.addEventListener(n,i)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,o]=n;t.removeEventListener(i,o)}),this._datachannelEventMap.clear()}}class hle extends vV{constructor(t){super(t),re(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),o=new DataView(i).getUint8(3);if(o!==this.id)return void($("SHOW_DATASTREAM2_LOG")&&C.debug("invalid datachannel id: ".concat(o," !== ").concat(this.id)));let l=n.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(Jy.MESSAGE,l)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class ple extends vV{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function nE(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>ty.revokeObjectURL(e),0),new Worker(ty.createObjectURL(e))}const bV=71,IC=1,OC=2,PC=1,SV=2;var kl=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(kl||{});function DC(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==bV)return;const i=e.getUint16(1),o=IC+OC+i,l=new Uint8Array(e.byteLength-o);l.set(new Uint8Array(e.buffer,o,e.byteLength-o));const u={m:n,tlvLen:i,tlv:[],frame:l};let p=IC+OC;for(;p<o;){const m=e.getUint8(p),g=e.getUint16(p+PC),y=PC+SV;if(m===kl.AUDIO_LEVEL){let b=e.getUint8(p+y);for(let S=1;S<g;S++)b=b<<8|e.getUint8(p+y+S);u.tlv.push({tag:m,length:g,value:t?127^b>>1:127&b})}else if(m===kl.METADATA||m===kl.AUDIO_64_BIT_PTS){const b=new Uint8Array(g);for(let S=0;S<g;S++)b[S]=e.getUint8(p+y+S);u.tlv.push({tag:m,length:g,value:b})}p+=y+g}return u}const rE=new Map,sE=127,uu=1e-10,kC=139/13,iE=new Map;function LC(e,t,n){const i="".concat(e,"-").concat(t,"-").concat(n);let o=0;return iE.has(i)?o=iE.get(i):(o=Math.log(function(u,p){const m=u-p;p<m&&(p=m);let g=1;for(let y=u,b=1;y>p;y--,b++)g=g*y/b;return g}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,iE.set(i,o)),o<uu&&(o=uu),o}function xV(e,t,n){const i=t.length,o=e.length/i;let l=!1;for(let u=0,p=0;u<i;u++){let m=0;for(let g=p+o;p<g;p++)e[p]>n&&m++;t[u]!==m&&(t[u]=m,l=!0)}return l}window.cache=iE;let mle=0;class wV{constructor(t){re(this,"id",void 0),re(this,"immediates",[]),re(this,"lastNonSilence",-1),re(this,"immediateSpeechActivityScore",uu),re(this,"lastLevelChangedTime",Date.now()),re(this,"levels",[]),re(this,"longs",[]),re(this,"longSpeechActivityScore",uu),re(this,"mediums",[]),re(this,"mediumSpeechActivityScore",uu),re(this,"minLevel",0),re(this,"nextMinLevel",0),re(this,"nextMinLevelWindowLength",0),re(this,"energyScore",0),this.id=t||"".concat(mle++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,i=this.minLevel+kC;let o=!1;for(let l=0;l<t.length;++l){let u=n[l];u<i&&(u=0);const p=Math.floor(u/kC);t[l]!==p&&(t[l]=p,o=!0)}return o}computeLongs(){return xV(this.mediums,this.longs,4)}computeMediums(){return xV(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=LC(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=LC(this.longs[0],10,47),this.longSpeechActivityScore>uu&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=LC(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(H2(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=t;return t<0&&(i=0),t>sE&&(i=sE),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+kC?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>sE&&(n=sE),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class fle{constructor(t){re(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class MC{constructor(t,n,i){re(this,"isDominant",void 0),re(this,"energyRanking",void 0),re(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=i}}class gle extends On{constructor(t){super(),re(this,"dominantId",null),re(this,"lastDecisionTime",0),re(this,"lastLevelChangedTime",0),re(this,"lastLevelIdleTime",0),re(this,"relativeSpeechActivities",[]),re(this,"speakers",new Map),re(this,"enableSilence",!1),re(this,"timeoutToSilenceInterval",0),re(this,"decisionMaker",null),re(this,"loudest",[]),re(this,"numLoudestToTrack",3),re(this,"energyExpireTimeMs",250),re(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const i=Date.now(),o=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const l=o.levelChanged(n,i);return this.updateLoudestList(o,l,i)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new wV(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,i){const o=t.id===this.dominantId;if(n<0){let m=0;for(;m<this.loudest.length&&this.loudest[m]!==t;)++m;return new MC(o,m,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new MC(o,0,t.energyScore);const l=i-this.energyExpireTimeMs;let u=0;for(;u<this.loudest.length;){const m=this.loudest[u];if(m.getLastLevelChangedTime()<l&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(u,1);else if(m.id!==t.id)++u;else if(this.loudest.splice(u,1),this.loudest.length<this.numLoudestToTrack)break}let p=0;for(;p<this.loudest.length&&!(this.loudest[p].energyScore<t.energyScore);)++p;return p<this.numLoudestToTrack&&(this.loudest.splice(p,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new MC(o,p,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new fle(this),this.decisionMaker.execute())}makeDecision(t){let n=null,i=null;const o=this.speakers.size;let l=null;if(o===0)l=null;else if(o===1){var u;const p=fi(u=this.speakers).call(u).next().value;this.enableSilence&&p&&(l=p.id,p.evaluateSpeechActivityScores(t),t-p.lastNonSilence>this.timeoutToSilenceInterval&&(l=null))}else{let p=this.dominantId==null?null:this.speakers.get(this.dominantId);if(p==null){const y=this.speakers.entries().next();y.value&&(l=y.value[0],p=y.value[1])}else l=p.id;p!=null&&p.evaluateSpeechActivityScores(t);const m=this.relativeSpeechActivities;let g=2;for(const y of this.speakers.entries()){const[b,S]=y;if(S===p)continue;S.evaluateSpeechActivityScores(t);for(let O=0;O<m.length;++O){const W=p==null?uu:p.getSpeechActivityScore(O);m[O]=Math.log(S.getSpeechActivityScore(O)/W)}const w=m[0],k=m[1],I=m[2];w>3&&k>2&&I>0&&k>g&&(g=k,l=b)}this.enableSilence&&p!=null&&l===p.id&&t-p.lastNonSilence>this.timeoutToSilenceInterval&&(l=null)}l==null&&!this.enableSilence||l===this.dominantId||(n=this.dominantId,this.dominantId=l,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):i=n;let o=300-(t-this.lastDecisionTime);return o<=0&&(this.lastDecisionTime=t,this.makeDecision(t),o=300-(Date.now()-t)),o>0&&i>o&&(i=o),i}timeoutIdleLevels(t){const n=[];for(const o of fi(i=this.speakers).call(i)){var i;const l=t-o.getLastLevelChangedTime();36e5<l&&(this.dominantId==null||o.id!==this.dominantId)?n.push(o.id):300<l&&o.levelTimedOut()}n.forEach(o=>this.speakers.delete(o))}}const yp=new Map;let fa=null,oE=null;const TV=3;let hu=[];const ga=new Map,aE=new Map;class _le{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){re(this,"id",void 0),re(this,"track",void 0),re(this,"score",0),re(this,"active",!0),re(this,"muted",!1),re(this,"timer",0),re(this,"actives",0),re(this,"inactives",0),this.id=t,this.track=n,this.setActive(ga.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const o=[],l=[];return Array.from(fi(ga).call(ga)).forEach(u=>{u.active?o.push(u):l.push(u)}),{actives:o,inactives:l}}();if(n.length>3){let o;n.forEach(l=>{(!o||o.score>l.score)&&(o=l)}),o&&o.setActive(!1)}if(n.length<3&&i.length>0){let o;i.forEach(l=>{(!o||o.score<l.score)&&l.id!==this.id&&(o=l)}),o&&t&&!this.active&&(o.samples>40&&o.activeRate-this.activeRate>.4?o.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let i;return Array.from(fi(ga).call(ga)).forEach(o=>{!o.active||o.id===n||o.samples<40||(!i||o.score<i.score)&&(i=o)}),i}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let i;return Array.from(fi(ga).call(ga)).forEach(o=>{o.active||o.id===n||o.samples<40||(!i||o.score>i.score)&&(i=o)}),i}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let cE;function CV(e){const t=ga.get(e);t&&(ga.delete(e),t.clearTimer())}const lE=new Map,yle=new Map,jC="video/h264",UC="video/h265";function RV(e,t,n){let i=new Uint8Array(e,t,n),o=[],l=0;for(;o.length<n;)l+3<n&&i[l]===0&&i[l+1]===0&&i[l+2]===3&&(i[l+3]===0||i[l+3]===1||i[l+3]===2||i[l+3]===3)?(o.push(i[l],i[l+1],i[l+3]),l+=4):(o.push(i[l]),l++);return new Uint8Array(o)}function NV(e){const t=e.length;let n=[],i=0;for(;i<t;)i+2<t&&e[i]===0&&e[i+1]===0&&(e[i+2]===0||e[i+2]===1||e[i+2]===2||e[i+2]===3)?(n.push(e[i],e[i+1],3,e[i+2]),i+=3):(n.push(e[i]),i++);return new Uint8Array(n)}function AV(e){if(e.length<5)return"";let t=-1;for(let o=0;o<e.length-3;o++){if(e[o]===0&&e[o+1]===0&&e[o+2]===1){t=o;break}if(o<e.length-4&&e[o]===0&&e[o+1]===0&&e[o+2]===0&&e[o+3]===1){t=o;break}}if(t===-1)return"";const n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";const i=e[n];return 128&i?"":(i>>1&63)>=32||n+1<e.length&&!(248&e[n+1])?UC:(31&i)<=31?jC:""}const dE=new Map,Gf=new Map;(function(){const e=Ft();br.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),br.getStreamFromExtension=e.name===Ht.CHROME&&Number(e.version)>34,br.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),br.supportMinBitrate=e.name===Ht.CHROME||e.name===Ht.EDGE,br.supportSetRtpSenderParameters=function(){const t=Ft();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!nc()||!(!Nr()&&!jy())||t.name===Ht.FIREFOX&&Number(t.version)>=64)}(),e.name===Ht.SAFARI&&(Number(e.version)>=14?br.supportDualStream=!0:br.supportDualStream=!1),br.webAudioMediaStreamDest=function(){const t=Ft();return!(t.name===Ht.SAFARI&&Number(t.version)<12)}(),br.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",br.supportWebGL=typeof WebGLRenderingContext<"u",br.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,nc()||(br.webAudioWithAEC=!0),br.supportShareAudio=function(){const t=Ft();return(t.os===Er.WIN_10||t.os===Er.WIN_81||t.os===Er.WIN_7||t.os===Er.LINUX||t.os===Er.MAC_OS||t.os===Er.CHROMIUM_OS)&&t.name===Ht.CHROME&&Number(t.version)>=74}(),br.supportDataChannel=!!(pa(76)||$T(68)||v5(14)),br.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!Sn()&&!!t&&t.prototype.setConfiguration instanceof Function}(),br.supportWebRTCEncodedTransform=pa(87)||_5()||$T(117),br.supportWebRTCInsertableStream=function(){const t=Ft();return(t.name===Ht.CHROME||t.name===Ht.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),br.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,br.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,br.supportSuppressLocalAudioPlayback=pU(),br.supportRestrictOwnAudio=mU(),Vy(()=>{br.supportDualStreamEncoding=function(){const t=Ft();return!!$("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&$("CHROME_DUAL_STREAM_USE_ENCODING"))}(),C.debug("browser ua: ",navigator.userAgent),C.info("browser info: ",e),C.info("browser compatibility: ",br)})})();const Ele=["CHINA","GLOBAL"],IV=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],pu=[],Ep=[];function mu(e,t){return!!t&&pu.some(n=>n.uid===e&&n.channelName===t)}function VC(){return Ep.length>0}var vle=jM.forEach,OV=p_("forEach")?[].forEach:function(e){return vle(this,e,arguments.length>1?arguments[1]:void 0)};Qt({target:"Array",proto:!0,forced:[].forEach!==OV},{forEach:OV});var ble=Qi("Array","forEach"),Sle=bl,xle=cs,wle=N,Tle=ble,FC=Array.prototype,Cle={DOMTokenList:!0,NodeList:!0},Rle=function(e){var t=e.forEach;return e===FC||wle(FC,e)&&t===FC.forEach||xle(Cle,Sle(e))?Tle:t},Nle=h(Rle),Ale=Xa,PV=E_;Qt({target:"Object",stat:!0,forced:f(function(){PV(1)})},{keys:function(e){return PV(Ale(e))}});var Ile=h(vn.Object.keys),Ole=h($2),Ple=h(G2),Dle=Qt,DV=tf,kle=D_,Lle=ln,kV=JS,Mle=vl,jle=Mn,Ule=_w,Vle=or,Fle=xl,Ble=RM("slice"),$le=Vle("species"),BC=Array,Wle=Math.max;Dle({target:"Array",proto:!0,forced:!Ble},{slice:function(e,t){var n,i,o,l=jle(this),u=Mle(l),p=kV(e,u),m=kV(t===void 0?u:t,u);if(DV(l)&&(n=l.constructor,(kle(n)&&(n===BC||DV(n.prototype))||Lle(n)&&(n=n[$le])===null)&&(n=void 0),n===BC||n===void 0))return Fle(l,p,m);for(i=new(n===void 0?BC:n)(Wle(m-p,0)),o=0;p<m;p++,o++)p in l&&Ule(i,o,l[p]);return i.length=o,i}});var Gle=Qi("Array","slice"),Hle=N,Kle=Gle,$C=Array.prototype,zle=function(e){var t=e.slice;return e===$C||Hle($C,e)&&t===$C.slice?Kle:t},Yle=h(zle);function we(e,t,n,i,o){var l,u,p,m={};return Nle(l=Ile(i)).call(l,function(g){m[g]=i[g]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Ole(u=Ple(p=Yle(n).call(n)).call(p)).call(u,function(g,y){return y(e,t,g)||g},m),o&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(o):void 0,m.initializer=void 0),m.initializer===void 0?(xM(e,t,m),null):m}let uE=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),WC=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),io=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e[e.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",e}({}),Is=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Je=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Lt=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Fe=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e.VOS_FALLBACK="vos_fallback",e.VOS_FALLBACK_PROMISE="vos_fallback_promise",e}({}),He=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SET_DUAL_STREAM_MODE="set_dual_stream_mode",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.CONFIGURE="configure",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),fu=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),lt=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e.ENABLE_MULTI_STREAM="enable_multi_stream",e}({}),Os=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Et=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e.ON_FALLBACK="websocket:on_fallback",e}({});function hE(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw C.error("Invalid Channel Name ".concat(e)),new ne(G.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function pE(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||A5(e,1,255)))throw new ne(G.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&C.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Hc=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const qle={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},GC={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function HC(e,t){Vr(e.url,"".concat(t,".url"),1,1e3,!1),jn(e.x)||un(e.x,"".concat(t,".x"),0,1e4),jn(e.y)||un(e.y,"".concat(t,".y"),0,1e4),jn(e.width)||un(e.width,"".concat(t,".width"),0,1e4),jn(e.height)||un(e.height,"".concat(t,".height"),0,1e4),jn(e.zOrder)||un(e.zOrder,"".concat(t,".zOrder"),0,255),jn(e.alpha)||un(e.alpha,"".concat(t,".alpha"),0,1,!1)}const Xle={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Ll=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),KC=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),hr=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function LV(e){if(!e.channelName)throw new ne(G.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new ne(G.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Vr(e.token,"info.token",1,2047),pE(e.uid),hE(e.channelName),!0}let Vs=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Kc=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Qs=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),vp=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),tn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Kn=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e.VOS_FALLBACK="vos-fallback",e.VOS_FALLBACK_PROMISE="vos-fallback-promise",e.RESET_SIGNAL="reset-signal",e.DATACHANNEL_FAILBACK="datachannel-failback",e}({}),mE=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Sr=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),zt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const MV=[zt.AFRICA,zt.ASIA,zt.CHINA,zt.EUROPE,zt.GLOBAL,zt.INDIA,zt.JAPAN,zt.NORTH_AMERICA,zt.OCEANIA,zt.OVERSEA,zt.SOUTH_AMERICA];let ns=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const fE={CHINA:{},ASIA:{CODE:ns.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ns.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ns.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ns.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ns.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ns.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ns.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ns.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ns.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ns.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ns.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ns.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ns.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};cC&&(fE.CHINA={CODE:ns.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let _a=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",e.FALLBACK_TO_HLS="fallback_to_hls",e.UPDATE_VOS_CONFIGURE="update_vos_configure",e}({});function jV(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class UV extends On{constructor(t,n){super(),D(this,"onICEConnectionStateChange",void 0),D(this,"onConnectionStateChange",void 0),D(this,"onDTLSTransportStateChange",void 0),D(this,"onDTLSTransportError",void 0),D(this,"onICETransportStateChange",void 0),D(this,"onFirstAudioReceived",void 0),D(this,"onFirstVideoReceived",void 0),D(this,"onFirstAudioDecoded",void 0),D(this,"onFirstVideoDecoded",void 0),D(this,"onFirstVideoRender",void 0),D(this,"onFirstVideoBufferReady",void 0),D(this,"onFirstVideoDecodedTimeout",void 0),D(this,"onSelectedLocalCandidateChanged",void 0),D(this,"onSelectedRemoteCandidateChanged",void 0),D(this,"onICECandidateError",void 0),D(this,"getLocalVideoStats",void 0)}}class gE extends UV{constructor(t,n){super(t,n),D(this,"establishPromise",void 0)}}let Me=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Ir=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),zc=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const VV=["disconnected","failed"];let ge=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),qt=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Ke=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e.FirstVideoPreRender="FirstVideoPreRender",e.FirstVideoBufferReady="FirstVideoBufferReady",e}({}),Uo=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Vo=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Or=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Ml=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),pr=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),oc=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),oo=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),ya=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),bp=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),zn=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Sp=function(e){return e.ABORT="abort",e}({}),jl=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Jle=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Qle={[uE.ACCESS_POINT]:{[Is.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Is.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Is.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Is.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Is.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Is.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Is.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Is.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Is.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Is.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Is.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Is.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Is.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Is.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Is.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Is.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Is.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Is.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[uE.UNILBS]:{[io.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[io.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[io.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[io.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[io.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[io.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[io.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[io.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[io.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[io.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[io.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[io.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[io.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[uE.STRING_UID_ALLOCATOR]:{[WC.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[WC.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[WC.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function xp(e){const t=Qle[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===uE.ACCESS_POINT){const i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const Zle={[Je.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Je.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Je.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Je.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Je.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Je.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Je.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Je.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Je.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Je.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Je.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Je.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Je.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Je.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[Je.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Je.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Je.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Je.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Je.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Je.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Je.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Je.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Je.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Je.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Je.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Je.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Je.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Je.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Je.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Je.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Je.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Je.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Je.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Je.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Je.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Je.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Je.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Je.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Je.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Je.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Je.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Je.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Je.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Je.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Je.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Je.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Je.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Je.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Je.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Je.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Je.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Je.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Je.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Je.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Je.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Je.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Je.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Je.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Je.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Je.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Je.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Je.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Je.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Je.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Je.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function gu(e){return Zle[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function FV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function zC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?FV(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function YC(e,t){if(typeof e=="string")return e;const{proxy:n,host:i,port:o}=e;if(t){const l=$("JOIN_GATEWAY_FALLBACK_PORT")||443;return l===443?"wss://".concat(i,"/ws/?p=").concat(Number(o)+150):"wss://".concat(i,":").concat(l,"/ws/?p=").concat(Number(o)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(o):"wss://".concat(i,":").concat(o)}const ede=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,tde=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,nde=/wss:\/\/(.+):([0-9]+)\/?/,rde=/wss:\/\/(.[^\/]+)\/?/;let sde=0;class ide{constructor(t,n){D(this,"id",0),D(this,"store",void 0),D(this,"recordIndex",void 0),D(this,"websockets",[]),D(this,"try443PortDuration",2e3),D(this,"forceCloseWSDuration",5e3),D(this,"try443PortTimeout",null),D(this,"forceCloseTimeout",null),D(this,"isTry443PortFailed",!1),D(this,"isNormalPortFailed",!1),D(this,"useDoubleDomain",!1),D(this,"useProxy",!1),D(this,"startTime",Date.now()),this.id=++sde,this.try443PortDuration=$("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];C.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...o)}createWebSocket(t,n,i){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:i});const o=$("GATEWAY_DOMAINS"),l=Date.now(),u=[],p=o.find(S=>{var w;return fe(w=t.host).call(w,S)});p||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)o.forEach(S=>{m.push(YC(zC(zC({},t),{},{host:t.host.replace(p,S)}),n))});else{const S=zC({},t);if(n&&p){const w=o.find(k=>k!==p);w&&(S.host=S.host.replace(p,w))}m.push(YC(S,n))}try{m.forEach(S=>{const w=new WebSocket(S);w.binaryType="arraybuffer",u.push(w),this.logger("ws is connecting:",w.url)})}catch(S){if(this.logger("ws create failed"),u.forEach(w=>w.close()),u.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,i);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,i);throw new ne(G.WS_ERR,"init websocket failed! Error: ".concat(S.toString()))}const g=Pf();this.store&&this.store.recordJoinChannelService({urls:u.map(S=>S.url),service:"gateway"},this.recordIndex),u.forEach(S=>{S.onopen=()=>{this.logger("onopen: ws ".concat(S.url," open cost ").concat(Date.now()-l,"ms")),this.websockets.forEach(w=>{w!==S&&(w.onopen=null,w.onclose=null,w.onmessage=null,w.close(),this.logger("close backup websocket: ".concat(w.url)))}),this.websockets.length=0,g.resolve(S)},S.onclose=w=>{this.logger("onclose: ws ".concat(S.url," closed cost ").concat(Date.now()-l,"ms state: ").concat(S.readyState));const k=u.every(I=>I.readyState===WebSocket.CLOSED||I.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(k)),k&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(w.reason)),g.reject({code:w.code,reason:mE.A_ROUND_WS_FAILED})):!n&&k&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),b()),n?this.isTry443PortFailed=k:this.isNormalPortFailed=k},S.onmessage=w=>this.logger("".concat(S.url," onmessage: ").concat(w.data))}),this.websockets.push(...u);const y=()=>{this.websockets.forEach(S=>S.readyState!==WebSocket.OPEN&&S.close())},b=()=>{if(g.isResolved)return y();Ft().os===Er.MAC_OS&&Sn()&&y(),this.createWebSocket(t,!0,!0).then(S=>{g.resolve(S)}).catch(S=>{this.isNormalPortFailed&&g.reject(S),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",g.isResolved),this.forceCloseTimeout=null,y()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,y()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",g.isResolved),this.try443PortTimeout=null,b()},this.try443PortDuration)})(),g.promise}chooseBestWebsocket(t,n,i,o){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(l){let u,p,m;return[,u,p,m]=l.match(ede)||[],u||([,p,m]=l.match(tde)||[]),p&&m||([,p,m]=l.match(nde)||[]),p&&m||([,p]=l.match(rde)||[]),p||C.warning("un-destructible url: ",l),{proxy:u,host:p,port:m||"443"}}(t)),this.recordIndex=o,this.useProxy=!!t.proxy,i&&this.useProxy&&(C.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(t,!!i,!1).finally(()=>this.clearTimeout())}}function BV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}class $V extends On{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;fe(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Et.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Et.CONNECTED):this._state==="closed"?this.emit(Et.CLOSED):this._state==="failed"&&this.emit(Et.FAILED))}resetReconnectCount(t){C.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3],l=arguments.length>4&&arguments[4]!==void 0&&arguments[4],u=arguments.length>5?arguments[5]:void 0;super(),D(this,"_websocketUrl",null),D(this,"connectionID",0),D(this,"currentURLIndex",0),D(this,"urls",[]),D(this,"_reconnectMode","tryNext"),D(this,"reconnectReason",void 0),D(this,"_initMutex",void 0),D(this,"name",void 0),D(this,"_state","closed"),D(this,"reconnectInterrupter",void 0),D(this,"websocket",void 0),D(this,"retryConfig",void 0),D(this,"reconnectCount",0),D(this,"forceCloseTimeout",5e3),D(this,"onlineReconnectListener",void 0),D(this,"useCompress",void 0),D(this,"tryDoubleDomain",!1),D(this,"use443PortOnly",!1),D(this,"wsInflateLength",0),D(this,"wsDeflateLength",0),D(this,"closeEstablishingWs",()=>{}),D(this,"store",void 0),D(this,"joinGatewayRecordIndex",void 0),this.store=u,this.name=t,this.retryConfig=function(b){for(var S=1;S<arguments.length;S++){var w=arguments[S]!=null?arguments[S]:{};S%2?BV(Object(w),!0).forEach(function(k){D(b,k,w[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(w)):BV(Object(w)).forEach(function(k){Object.defineProperty(b,k,Object.getOwnPropertyDescriptor(w,k))})}return b}({},n),this.useCompress=i,this.tryDoubleDomain=o,this.use443PortOnly=l,this._initMutex=new Ar("websocket",u?u.clientId:void 0);const{timeout:p,timeoutFactor:m}=n,g=Math.max(300,Math.floor(3*p/5)),y=Math.max(1.2,Math.floor(8*m)/10);Rs.ONLINE&&(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=y),Un.on(eu.NETWORK_STATE_CHANGE,(b,S)=>{b!==S&&(this.resetReconnectCount("network state change: ".concat(S," -> ").concat(b)),b===Rs.ONLINE?(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=y):(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{var o;const l=Pf(),u=this.urls[this.currentURLIndex];(o=this.store)===null||o===void 0||o.beforeConnect(),function(p){return!(Yy()||$("USE_NEW_TOKEN")||!$("ENABLE_PREALLOC_PC")&&(p==null||!p.autoSubscribe||$("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(pr.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(l.resolve).catch(l.reject),this.once(Et.CLOSED,()=>{l.reject(new oe(G.WS_DISCONNECT))}),this.once(Et.CONNECTED,l.resolve),await l.promise}catch{}finally{i()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void C.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),C.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new oe(G.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new oe(G.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const i=Pf();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const o=y=>{var b;(b=this.store)===null||b===void 0||b.signalChannelOpen(),C.debug("[".concat(this.name,"] websocket opened:"),y),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},l=async y=>{var b;if(C.debug("[".concat(this.name,"] websocket close ").concat((b=this.websocket)===null||b===void 0?void 0:b.url,", code: ").concat(y.code,", reason: ").concat(y.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new oe(G.WS_DISCONNECT,"websocket close: ".concat(y.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=y.reason,this.state="reconnecting");const S=yi(this,Et.WILL_RECONNECT,this.reconnectMode,y.reason)||this.reconnectMode,w=await this.reconnectWithAction(S);if(this.state==="closed")return void C.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!w)return i.reject(new oe(G.WS_DISCONNECT,"websocket reconnect failed: ".concat(y.code))),this.close(!0);i.resolve()}},u=y=>{this.emit(Et.ON_MESSAGE,y)},p=y=>{C.warn("[".concat(this.connectionID,"] ws open error ").concat(y))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),$("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=$("GATEWAY_WSS_ADDRESS")),C.debug("[".concat(this.name,"] start connect, url:"),t);const m=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var g;this._websocketUrl=YC(t);const y=await this.chooseBestWebsocketConnection(t);this.websocket=y,o&&o(this.websocket.url),this.websocket.onclose=l,this.websocket.onmessage=u,this.websocket.onerror=p,(g=this.store)===null||g===void 0||g.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this.joinGatewayRecordIndex=m}catch(y){const b=this.state==="closed",S=y instanceof oe,w=S&&y.code===G.WS_ABORT,k=S&&y.code===G.WS_ERR,I=S?y.message:y&&(y.reason||y.toString());C.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(I)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:w?"aborted":"error",errors:[y]},m),b||k?(i.reject(b?new oe(G.WS_DISCONNECT,"websocket is closed: ".concat(I)):new oe(G.WS_ERR,"init websocket failed: ".concat(I))),k&&C.error("[".concat(this.name,"] init websocket failed: ").concat(I))):l&&l(y)}return i.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;C.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Un.isOnline||!Un.onlineWaiter||(this.onlineReconnectListener=Un.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const u=Fy(this.reconnectCount,this.retryConfig);C.debug("[".concat(this.name,"] wait ").concat(u,"ms to reconnect websocket, mode: ").concat(t)),await xe.race([vr(u),this.onlineReconnectListener||new xe(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const o=async(u,p)=>{this.emit(Et.RECONNECT_CREATE_CONNECTION,p),await this.createWebSocketConnection(u)};try{if(t==="retry")await o(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);C.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await o(this.urls[this.currentURLIndex],t)}else t==="recover"&&(C.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ar(this,Et.REQUEST_NEW_URLS),this.currentURLIndex=0,await o(this.urls[this.currentURLIndex],t))}catch(u){var l;C.error("[".concat(this.name,"] reconnect failed ").concat(u&&u.toString()));const p=u==null||(l=u.data)===null||l===void 0?void 0:l.desc;if(Array.isArray(p)){if(fe(p).call(p,"dynamic key expired"))return this.emit(Et.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(fe(p).call(p,"request downgrade fallback"))return this.emit(Et.ON_FALLBACK),!1}return this.reconnectWithAction(t,n)}return!0}}class qC extends $V{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const i=Pf(),o=function(u,p){return new ide(u,p)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{C.debug("[choose-best-ws] close establishing websockets"),o.closeAllWebsockets(),i.reject(new oe(G.WS_ABORT,"choose best websocket aborted"))};const l=$("GATEWAY_DOMAINS");return C.debug("[choose-best-ws] currentDomain: ",t,", domains: ",l,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),o.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Hf extends $V{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new xe((i,o)=>{let l=!1;const u=[];this.closeEstablishingWs=()=>{C.debug("[choose-best-ws] close establishing websockets"),u.forEach(k=>{k.onclose=null,k.onopen=null,k.onmessage=null,k.close()}),o(new oe(G.WS_ABORT,"choose best websocket aborted"))};const p=$("GATEWAY_DOMAINS");let m;const g=t.indexOf("?h="),y=p.find(k=>g!==-1?fe(t).call(t,k,g):fe(t).call(t,k));C.debug("[choose-best-ws] currentDomain: ",y,", domains: ",p);let b=!this.tryDoubleDomain||!y;if(!b&&y){var S;const k=Date.now();try{p.forEach(I=>{const O=g===-1?t.replace(y,I):t.substr(0,g)+t.substr(g).replace(y,I),W=new WebSocket(O);W.binaryType="arraybuffer",u.push(W),C.debug("[choose-best-ws] ws is connecting:",W.url)})}catch{for(C.debug("[choose-best-ws] ws create failed, fallback to single url"),u.forEach(O=>O.close());u.length;)u.pop();b=!0}(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:u.map(I=>I.url),service:"gateway"},n),u.forEach(I=>{I.onopen=()=>{if(l)return;const O=Date.now()-k;C.debug("[choose-best-ws] ws open cost ".concat(O,"ms")),u.filter(W=>W!==I).forEach(W=>{C.debug("[choose-best-ws]close backup websocket: ".concat(W.url)),W.close()}),l=!0,i(I)},I.onclose=O=>{m=O,!l&&(u.find(W=>!(W.readyState===WebSocket.CLOSED||W.readyState===WebSocket.CLOSING))||(C.debug("[choose-best-ws] all websocket is closed"),l=!0,o(m)))},I.onmessage=O=>{C.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(O.data))}}),vr(this.forceCloseTimeout).then(()=>{u.forEach(I=>{I.readyState!==WebSocket.OPEN&&I.close()})})}if(b){var w;let k;C.debug("[choose-best-ws] use single url: ",t),(w=this.store)===null||w===void 0||w.recordJoinChannelService({urls:[t],service:"gateway"},n);try{k=new WebSocket(t),u.push(k),k.binaryType="arraybuffer"}catch(I){const O=new oe(G.WS_ERR,"init websocket failed! Error: ".concat(I.toString()));return C.error("[".concat(this.name,"]").concat(O)),void o(O)}k.onopen=()=>{i(k)},k.onclose=I=>{o(I)},k.onmessage=I=>{C.debug("[choose-best-ws]".concat(k.url," onmessage: ").concat(I.data))},vr(this.forceCloseTimeout).then(()=>{k&&k.readyState!==WebSocket.OPEN&&k.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class WV extends On{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Lt.CONNECTED?this.emit(Fe.WS_CONNECTED):t===Lt.RECONNECTING?this.emit(Fe.WS_RECONNECTING,this._websocketReconnectReason):t===Lt.CLOSED&&this.emit(Fe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),D(this,"__name__","AgoraRTCSignal"),D(this,"_disconnectedReason",void 0),D(this,"_websocketReconnectReason",void 0),D(this,"_connectionState",Lt.CLOSED),D(this,"reconnectToken",void 0),D(this,"websocket",void 0),D(this,"openConnectionTime",void 0),D(this,"clientId",void 0),D(this,"lastMsgTime",Date.now()),D(this,"uploadCache",[]),D(this,"uploadCacheInterval",void 0),D(this,"rttRolling",new tC(5)),D(this,"pingpongTimer",void 0),D(this,"wsInflateDataTimer",void 0),D(this,"pingpongTimeoutCount",0),D(this,"ortc",void 0),D(this,"joinResponse",void 0),D(this,"multiIpOption",void 0),D(this,"initError",void 0),D(this,"spec",void 0),D(this,"store",void 0),D(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Fe.ON_BINARY_DATA,i.data);const o=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const l="res-@".concat(o._id);this.emit(l,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){if(this.emit(o._type,o._message),o._type===lt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===lt.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(kt.UID_BANNED);break;case 15:this.close(kt.IP_BANNED);break;case 16:this.close(kt.CHANNEL_BANNED)}if(o._type===lt.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case Je.ERR_LICENSE_MISSING:this.close(kt.LICENSE_MISSING);break;case Je.ERR_LICENSE_EXPIRED:this.close(kt.LICENSE_EXPIRED);break;case Je.ERR_LICENSE_MINUTES_EXCEEDED:this.close(kt.LICENSE_MINUTES_EXCEEDED);break;case Je.ERR_LICENSE_PERIOD_INVALID:this.close(kt.LICENSE_PERIOD_INVALID);break;case Je.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(kt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Je.ERR_LICENSE_ILLEGAL:this.close(kt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new qC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Lt.CONNECTED&&this.reconnect("retry",Yr.OFFLINE)})}async request(t,n,i,o){const l=Zt(6,""),u={_id:l,_type:t,_message:n},p=this.websocket.connectionID,m=()=>new xe((k,I)=>{if(this.connectionState===Lt.CONNECTED)return k();const O=()=>{this.off(Fe.WS_CLOSED,W),k()},W=()=>{this.off(Fe.WS_CONNECTED,O),I(new ne(G.WS_ABORT))};this.once(Fe.WS_CONNECTED,O),this.once(Fe.WS_CLOSED,W),t!==He.PUBLISH&&t!==He.PUBLISH_DATASTREAM&&t!==He.SUBSCRIBE&&t!==He.SUBSCRIBE_DATASTREAM&&t!==He.UNSUBSCRIBE&&t!==He.UNSUBSCRIBE_DATASTREAM&&t!==He.UNPUBLISH&&t!==He.UNPUBLISH_DATASTREAM&&t!==He.CONTROL&&t!==He.RESTART_ICE||this.once(Fe.DISCONNECT_P2P,()=>{I(new ne(G.DISCONNECT_P2P))}),t!==He.PUBLISH&&t!==He.RESTART_ICE||this.once(Fe.ABORT_P2P_EXECUTION,()=>{I(new ne(G.DISCONNECT_P2P))})});if(this.connectionState!==Lt.CONNECTING&&this.connectionState!==Lt.RECONNECTING||t===He.JOIN||t===He.REJOIN||await m(),this.websocket.sendMessage(u,!0),o)return;const g=new xe((k,I)=>{let O=!1;const W=(Y,Q)=>{O=!0,k({isSuccess:Y==="success",message:Q||{}}),this.off(Fe.WS_CLOSED,H),this.off(Fe.WS_RECONNECTING,H),this.emit(Fe.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(l),W);const H=()=>{I(new ne(G.WS_ABORT,"type: ".concat(t))),this.off(Fe.WS_CLOSED,H),this.off(Fe.WS_RECONNECTING,H),this.off("res-@".concat(l),W)};this.once(Fe.WS_CLOSED,H),this.once(Fe.WS_RECONNECTING,H),vr($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||O||(C.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Fe.REQUEST_TIMEOUT,t,n))})});let y=null;try{y=await g}catch(k){if(this.connectionState===Lt.CLOSED||t===He.LEAVE)throw new ne(G.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?k.throw():t===He.JOIN||t===He.REJOIN?null:(await m(),await this.request(t,n))}if(y.isSuccess)return y.message;const b=Number(y.message.error_code||y.message.code),S=gu(b),w=new ne(G.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(y.message.error_str),{code:b,data:y.message,desc:S.desc});return S.action==="success"?y.message:(C.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(b,", message: ").concat(S.desc,", action: ").concat(S.action)),b===Je.ERR_TOO_MANY_BROADCASTERS?((t===He.JOIN||t===He.REJOIN)&&(this.initError=w,this.close()),w.throw()):S.action==="failed"?w.throw():S.action==="quit"?(this.initError=w,this.close(),w.throw()):(b===Je.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=y.message.option,C.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Yr.MULTI_IP)):this.reconnect(S.action,Yr.SERVER_ERROR),t===He.JOIN||t===He.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new xe(i=>{const o=l=>{(!n||n(l))&&(this.off(t,o),i(l))};this.on(t,o)})}uploadWRTCStats(t){if(!this.store.sessionId)return void C.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(fu.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const l=$("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Lt.CONNECTED)return;const u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},$("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new xe((n,i)=>{this.once(Fe.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Fe.WS_CLOSED,o=>i(this.initError||new ne(G.WS_ABORT,o))),this.connectionState=Lt.CONNECTING,this.websocket.init(t).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||kt.LEAVE,this.connectionState=Lt.CLOSED,C.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Fe.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await ar(this,Fe.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(He.JOIN,t);if(this.ortc=t==null?void 0:t.ortc,this.store.joinRep(),!n)return this.emit(Fe.REPORT_JOIN_GATEWAY,mE.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Fe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Lt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ne(G.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=tu(this,Fe.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(He.REJOIN,t);return!!n&&(this.connectionState=Lt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(lt.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(lt.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(lt.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(lt.MUTE_AUDIO,{uid:i.uid}):this.emit(lt.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(lt.MUTE_VIDEO,{uid:i.uid}):this.emit(lt.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(lt.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(lt.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(lt.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(lt.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(lt.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(He.DOWNGRADE_CODEC,n)}handleNotification(t){C.debug("[".concat(this.clientId,"] receive notification: "),t);const n=gu(t.code);if(t.code===28&&"detail"in t&&(C.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(Fe.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?t.code===Je.ERR_REPEAT_JOIN_CHANNEL&&$("IGNORE_UID_CHECK")?void this.close(kt.UID_CONFLICT):(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(kt.UID_BANNED),void this.close()):t.code===Je.K_VOS_FALLBACK&&"detail"in t?(C.info("[".concat(this.clientId,"] receive vos fallback notification: "),t.detail),t.detail==="FALLBACKCN"&&$("ENABLE_QUALITY_FALLBACK")?void ar(this,Fe.VOS_FALLBACK_PROMISE,t.detail).then(()=>{this.reconnect("recover",n.desc)}).catch(i=>{C.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),i)}):t.detail==="fallback_hls"&&$("ENABLE_FALLBACK_TO_HLS")?(this.emit(Fe.VOS_FALLBACK,t.detail),void this.close(kt.FALLBACK_TO_HLS)):this.reconnect(n.action,n.desc)):void this.reconnect(n.action,Yr.SERVER_ERROR);C.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=$("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(C.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>$("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Yr.TIMEOUT):this.request(He.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),$("REPORT_STATS")&&this.send(He.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(fu.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Et.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Fe.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Et.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Et.CLOSED,()=>{this.connectionState=Lt.CLOSED}),this.websocket.on(Et.FAILED,()=>{this._disconnectedReason=kt.NETWORK_ERROR,this.connectionState=Lt.CLOSED}),this.websocket.on(Et.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Lt.CONNECTED?this.connectionState=Lt.RECONNECTING:this.connectionState=Lt.CONNECTING}),this.websocket.on(Et.WILL_RECONNECT,(t,n,i)=>{const o=tu(this,Fe.IS_P2P_DISCONNECTED),l=o||t!=="retry";o&&t==="retry"&&(C.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=mE.P2P_DISCONNECTED),l&&(C.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Fe.REPORT_JOIN_GATEWAY,n||mE.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Fe.DISCONNECT_P2P)),i(t)}),this.websocket.on(Et.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{C.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Yr.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Fe.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ne){if(t.code===G.UNEXPECTED_RESPONSE&&t.data.code===Je.ERR_NO_AUTHORIZED)return this.initError=new ne(G.TOKEN_EXPIRE,"dynamic key expired"),void this.close(kt.TOKEN_EXPIRE);C.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Yr.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(Et.REQUEST_NEW_URLS,(t,n)=>{ar(this,Fe.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Et.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(lt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(pr.PRE_CONNECT_PC,()=>{this.emit(Fe.PRE_CONNECT_PC)}),this.websocket.on(Et.ON_FALLBACK,()=>{$("ENABLE_FALLBACK_TO_HLS")&&this.emit(Fe.VOS_FALLBACK,"fallback_hls")})}}let ode=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),er=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function GV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function _E(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?GV(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let XC=0;function Fo(e){const t=$("TURN_DOMAINS");XC=(XC+1)%t.length;const n=t[XC]||"edge.agora.io";return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(n):(C.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function yE(e){try{const t=$("TURN_DOMAINS"),n=$("GATEWAY_DOMAINS").concat(t).find(i=>fe(e).call(e,i));return n?e.split(".".concat(n))[0].replace(/-/g,"."):e}catch{return C.debug("serverUrlToIp error, fallback to url",e),e}}function JC(e,t){e.addresses||(e.addresses=[]);const n=function(p,m){if($("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return p.map(b=>{let{ip:S,port:w}=b;return{address:"".concat(S,":").concat(w)}});const g=$("GATEWAY_DOMAINS");let y=g[1]&&fe(m).call(m,g[1])?1:0;return p.map(b=>{let{domain_prefix:S,port:w,ip:k}=b;if(S)return{address:"".concat(S,".").concat(g[y++%g.length],":").concat(w)};const I=/^[\.\:\d]+$/.test(k),O=I?"".concat(k.replace(/[^\d]/g,"-"),".").concat(g[y++%g.length],":").concat(w):"".concat(k,":").concat(w);return I||C.debug("Cannot recognized as ip address: ".concat(k,", use as host3")),{ip:k,port:w,address:O}})}(e.addresses,t),i=Array.isArray(e.detail)&&e.detail[18];if(i&&typeof i=="string"){const p=i.split(";");for(let m=0;m<p.length;m++){var o;const g=Ts(o=p[m]).call(o);n[m]&&g&&(n[m].ip6=g)}}const l=e.detail&&e.detail.candidate;let u;if(l){const[p,m]=l.split(":");p&&m&&(u={port:Number(m),ip:p,address:"".concat(p,":").concat(m)})}return{gatewayAddrs:n,apGatewayAddress:u,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Fs(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function HV(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Fs(t.width),"x").concat(Fs(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function EE(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Kf(e,t){let n,i,o;switch(t){case er.CHOOSE_SERVER:i=4096,o="choose server";break;case er.CLOUD_PROXY:i=1048576,o="proxy";break;case er.CLOUD_PROXY_5:i=4194304,o="proxy5";break;case er.CLOUD_PROXY_FALLBACK:i=4194310,o="proxy fallback";break;default:throw new ne(G.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(l=>{l.buffer&&l.buffer.flag===i&&(n={code:l.buffer.code,addresses:(l.buffer.edges_services||[]).map(u=>_E(_E({},u),{},{ticket:l.buffer.cert})),server_ts:e.enter_ts,uid:l.buffer.uid,cid:l.buffer.cid,cname:l.buffer.cname,detail:_E(_E({},l.buffer.detail),e.detail),flag:l.buffer.flag,opid:e.opid,cert:l.buffer.cert})}),!n)throw new ne(G.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(o," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function KV(e,t){return await xe.all(e.addresses.map(async n=>({address:Fo(n.ip),tcpport:n.port,udpport:n.port,username:t&&$("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():qr.username,password:t&&$("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await YT(t.toString()):qr.password})))}function QC(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||n.height,o=t.videoWidth||n.width;return i&&o?Math.max(Math.min(i,o)/Math.min(Fs(e.height),Fs(e.width)),1):(C.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Ul(e){let{candidateType:t,relayProtocol:n,type:i,address:o,port:l,protocol:u}=e;const p={candidateType:t,relayProtocol:n,protocol:u};if(i!=="local-candidate"){const m=o.split(".");m.length>=4&&(m[1]="*",m[2]="*"),p.address=m.join("."),p.port=l}return p}function ac(e){const t=e.split(":"),n=e.split(/[-.]/),i=fe(e).call(e,"-")?"-":".";let o=e;return t.length>1?n.length>1?(n[1]="**",o=n[0]+i+"**:"+t[t.length-1]):o=t.length>2?t[0]+i+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(o=n[0]+i+"**"),o}function zV(e,t){return e.getTransceivers().find(n=>n.sender.track===t||n.receiver.track===t)}function zf(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$("SVC_MODE");if($("ENABLE_SVC"))return function(t){return t in Wy}(e)?e:Wy.L1T3}const YV={[Me.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Me.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function qV(e){e.send&&(wp(Me.VIDEO,e.send.videoExtensions),wp(Me.AUDIO,e.send.audioExtensions)),e.recv&&(wp(Me.VIDEO,e.recv.videoExtensions),wp(Me.AUDIO,e.recv.audioExtensions)),e.sendrecv&&(wp(Me.VIDEO,e.sendrecv.videoExtensions),wp(Me.AUDIO,e.sendrecv.audioExtensions))}function XV(e,t){e.send&&(vE(Me.VIDEO,e.send.videoExtensions,t.send.videoExtensions),vE(Me.AUDIO,e.send.audioExtensions,t.send.audioExtensions)),e.recv&&(vE(Me.VIDEO,e.recv.videoExtensions,t.recv.videoExtensions),vE(Me.AUDIO,e.recv.audioExtensions,t.recv.audioExtensions))}function vE(e,t,n){t.forEach(i=>{var o;const l=YV[e].find(p=>{var m;let{key:g}=p;return fe(m=i.extensionName).call(m,g)});if(!l)return;const u=n.find(p=>{let{extensionName:m}=p;return fe(m).call(m,l.key)});u&&fe(o=u.extensionName).call(o,"gdpr_forbidden")&&(i.extensionName=u.extensionName)})}function wp(e,t){t.forEach(n=>{var i;const o=YV[e].find(l=>{var u;let{key:p}=l;return fe(u=n.extensionName).call(u,p)});fe(i=n.extensionName).call(i,"gdpr_forbidden")&&o&&(n.extensionName=o.extensionName)})}function JV(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||fe(e).call(e,"abs-send-time")}function bE(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||fe(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function QV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function ZV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?QV(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Yf(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:o,filterVideoFec:l,filterAudioFec:u,filterAudioCodec:p,filterVideoCodec:m,unsupportedVideoUplinkCodec:g,unsupportedVideoDownlinkCodec:y}=t,{useXR:b}=n;let S=[],w=[],k=[],I=[],O=!1,W=!1;if(Ns(e).mediaDescriptions.forEach(Y=>{i&&i!==Y.attributes.direction||(Y.media.mediaType!=="video"||O||(w=Y.attributes.payloads,I=Y.attributes.extmaps,O=!0),Y.media.mediaType!=="audio"||W||(S=Y.attributes.payloads,k=Y.attributes.extmaps,W=!0))}),!I||w.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!k||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(w.forEach(Y=>{var Q;(Q=Y.rtpMap)!==null&&Q!==void 0&&Q.clockRate&&(Y.rtpMap.clockRate=parseInt(Y.rtpMap.clockRate)),b&&Y.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(Y=>{var Q;(Q=Y.rtpMap)!==null&&Q!==void 0&&Q.clockRate&&(Y.rtpMap.clockRate=parseInt(Y.rtpMap.clockRate)),b&&Y.rtcpFeedbacks.push({type:"rrtr"})}),o&&(S=S.filter(Y=>{var Q;return((Q=Y.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLowerCase())!=="rtx"}),w=w.filter(Y=>{var Q;return((Q=Y.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLowerCase())!=="rtx"})),l){const Y=w.filter(q=>{var ee;return/(red)|(ulpfec)|(flexfec)/i.test(((ee=q.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")}),Q=Vl(Y,w).map(q=>q.payloadType),Z=[...Y.map(q=>q.payloadType),...Q];w=w.filter(q=>!fe(Z).call(Z,q.payloadType))}if(u&&(S=S.filter(Y=>{var Q;return!/(red)|(ulpfec)|(flexfec)/i.test(((Q=Y.rtpMap)===null||Q===void 0?void 0:Q.encodingName)||"")})),p&&(p==null?void 0:p.length)>0&&(S=S.filter(Y=>{var Q;return fe(p).call(p,((Q=Y.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLowerCase())||"")})),m&&(m==null?void 0:m.length)>0){const Y=w.filter(Q=>{var Z;return fe(m).call(m,((Z=Q.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())||"")});w=Y.concat(o?[]:Vl(Y,w))}const H=$("UNSUPPORTED_VIDEO_CODEC");if(H&&H.length>0){const Y=w.filter(q=>q.rtpMap&&fe(H).call(H,q.rtpMap.encodingName.toLowerCase())),Q=Vl(Y,w),Z=Y.concat(Q).map(q=>q.payloadType);w=w.filter(q=>!fe(Z).call(Z,q.payloadType)),C.debug("unsupportedVideoCodec: ".concat(H,", toBeRemoved: ").concat(Z))}if(g&&g.length>0&&i==="sendonly"){const Y=w.filter(q=>q.rtpMap&&fe(g).call(g,q.rtpMap.encodingName.toLowerCase())),Q=Vl(Y,w),Z=Y.concat(Q).map(q=>q.payloadType);w=w.filter(q=>!fe(Z).call(Z,q.payloadType)),C.debug("unsupportedVideoUplinkCodec: ".concat(g,", toBeRemoved: ").concat(Z))}if(y&&y.length>0&&i==="recvonly"){const Y=w.filter(q=>q.rtpMap&&fe(y).call(y,q.rtpMap.encodingName.toLowerCase())),Q=Vl(Y,w),Z=Y.concat(Q).map(q=>q.payloadType);w=w.filter(q=>!fe(Z).call(Z,q.payloadType)),C.debug("unsupportedVideoDownlinkCodec: ".concat(y,", toBeRemoved: ").concat(Z))}return{audioCodecs:S,videoCodecs:w,audioExtensions:k,videoExtensions:I}}function cc(e){const t=Ns(e);let n,i;for(const o of t.mediaDescriptions){if(!n){const l=o.attributes.iceUfrag,u=o.attributes.icePwd;if(!l||!u)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:l,icePwd:u}}if(!i){const l=o.attributes.fingerprints;l.length>0&&(i={fingerprints:l})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function ZC(e,t){const n=[],i=e.attributes.ssrcGroups.filter(u=>u.semantic==="FID"),o=e.attributes.ssrcGroups.find(u=>u.semantic==="SIM"),l=e.attributes.ssrcs;if(o)o.ssrcIds.forEach(u=>{var p;const m=(p=i.find(g=>g.ssrcIds[0]===u))===null||p===void 0?void 0:p.ssrcIds[1];n.push({ssrcId:u,rtx:t?m:void 0})});else if(i.length>0){const u=i[0].ssrcIds[0],p=i[0].ssrcIds[1];n.push({ssrcId:u,rtx:t?p:void 0})}else{if(l.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:l[0].ssrcId})}return n}function e4(e,t,n){const{cname:i}=e;let o=[];t&&(o=t4(t)),o.length===0&&(o=e.iceParameters.candidates.map(y=>({foundation:y.foundation,componentId:"1",transport:y.protocol,priority:y.priority.toString(),connectionAddress:y.ip,port:y.port.toString(),type:y.type,extension:{}})),C.debug("Using candidates from gateway."));const l={fingerprints:e.dtlsParameters.fingerprints.map(y=>({hashFunction:y.algorithm,fingerprint:y.fingerprint}))},u={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let p;switch(e.dtlsParameters.role){case"server":p="passive";break;case"client":p="active";break;case"auto":p="actpass"}const m=Xf(e.rtpCapabilities),g=[];return Array.isArray(n)&&n.length>0&&n.forEach(y=>{g.push({kind:Me.VIDEO,ssrcMsg:[{ssrcId:y.v,rtx:y.v_rtx}],mslabel:"".concat(y.v,"_").concat(y.a)},{kind:Me.AUDIO,ssrcMsg:[{ssrcId:y.a}],mslabel:"".concat(y.v,"_").concat(y.a)})}),{dtlsParameters:l,iceParameters:u,candidates:o,rtpCapabilities:m,setup:p,cname:i,preSSRCs:g}}function t4(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],C.debug("Using remote candidate from AP ".concat(ac(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),C.debug("Using IPV6 remote candidate from AP ".concat(ac(e.ip6),":").concat(e.port)))),t}function qf(e,t,n){const i=[],o=[];return e.forEach(l=>{let{ssrcId:u,rtx:p}=l;const m=Zt(8,"track-"),g={ssrcId:u,attributes:ZV({label:m,mslabel:n=n||Zt(10,""),msid:"".concat(n," ").concat(m)},t&&{cname:t})};if(i.push(g),p!==void 0){const y={ssrcId:p,attributes:ZV({label:m,mslabel:n,msid:"".concat(n," ").concat(m)},t&&{cname:t})};i.push(y),o.push({semantic:"FID",ssrcIds:[u,p]})}}),e.length>1&&o.push({semantic:"SIM",ssrcIds:e.map(l=>{let{ssrcId:u}=l;return u})}),{ssrcs:i,ssrcGroups:o}}function _u(e,t){t instanceof Wn&&e.attributes.payloads.forEach(n=>{var i;const o=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!o||["opus","pcmu","pcma","g722"].indexOf(o)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),o==="opus"&&typeof $("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=$("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const l=t._encoderConfig;l&&(o!=="pcmu"&&o!=="pcma"&&o!=="g722"&&(l.bitrate&&!Sn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*l.bitrate))),l.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(l.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(l.sampleRate)),l.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof Wf&&o==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function eR(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function tR(e,t){var n;if(e.attributes.payloads.forEach(o=>{var l;((l=o.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())==="h264"&&o.fmtp&&o.fmtp.parameters&&$("ENABLE_UP_SPS_PPS")&&(o.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(t instanceof pn&&t._encoderConfig&&t._hints.indexOf(Xt.SCREEN_TRACK)===-1))return;const i=t._encoderConfig;It().supportMinBitrate&&i.bitrateMin&&e.attributes.payloads.forEach(o=>{var l,u;fe(l=["h264","h265","vp8","vp9","av1"]).call(l,((u=o.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),It().supportMinBitrate&&!fe(n=t._hints).call(n,Xt.LOW_STREAM)&&i.bitrateMax&&e.attributes.payloads.forEach(o=>{var l,u;fe(l=["h264","h265","vp8","vp9","av1"]).call(l,((u=o.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-start-bitrate"]="".concat($("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function n4(e){if(e.media.mediaType!=="video")return;const t=Ft();if(t.name!==Ht.SAFARI&&t.os!==Er.IOS)return;const n=e.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function SE(e,t,n){if(!t)return;let i,o;if(e.media.mediaType==="video"?(i=n.videoExtensions,o=n.videoCodecs):(i=n.audioExtensions,o=n.audioCodecs),t.twcc===!0){const l=i.find(u=>bE(u.extensionName));if(l){const u=l.extensionName;e.attributes.extmaps.find(m=>bE(m.extensionName))||e.attributes.extmaps.push({entry:l.entry,extensionName:u}),function(m,g){return g.filter(y=>!!m.find(b=>b.payloadType===y.payloadType&&!!b.rtcpFeedbacks.find(S=>S.type==="transport-cc")))}(o,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(g=>g.type==="transport-cc")||m.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const l=e.attributes.extmaps.findIndex(u=>bE(u.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(u=>{const p=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");p!==-1&&u.rtcpFeedbacks.splice(p,1)})}if(t.remb===!0){const l=i.find(u=>JV(u.extensionName));if(l){const u=l.extensionName;e.attributes.extmaps.find(m=>m.extensionName===u)||e.attributes.extmaps.push({entry:l.entry,extensionName:u}),function(m,g){return g.filter(y=>!!m.find(b=>b.payloadType===y.payloadType&&!!b.rtcpFeedbacks.find(S=>S.type==="goog-remb")))}(o,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(g=>g.type==="goog-remb")||m.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const l=e.attributes.extmaps.findIndex(u=>JV(u.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(u=>{const p=u.rtcpFeedbacks.findIndex(m=>m.type==="goog-remb");p!==-1&&u.rtcpFeedbacks.splice(p,1)})}}function nR(e,t,n){if(Sn()||e.media.mediaType!=="video"||!(t instanceof pn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!$("SIMULCAST")||n==="vp9"&&$("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,o=e.attributes.ssrcs[0],l=e.attributes.ssrcGroups.find(p=>p.semantic==="FID"&&p.ssrcIds[0]===o.ssrcId),u={semantic:"SIM",ssrcIds:[o.ssrcId]};for(let p=1;p<i;p++)e.attributes.ssrcs.push({ssrcId:o.ssrcId+p,attributes:xn(o.attributes)}),u.ssrcIds.push(o.ssrcId+p),l&&(e.attributes.ssrcs.push({ssrcId:l.ssrcIds[1]+p,attributes:xn(o.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[o.ssrcId+p,l.ssrcIds[1]+p]}));e.attributes.ssrcGroups.unshift(u)}async function r4(){try{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Wy.L1T3}]});const t=await e.createOffer();if(!t.sdp)return void e.close();const n=Ns(t.sdp).mediaDescriptions[0];if(!n)return;const i=n.attributes.extmaps.find(o=>o.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return e.close(),i}catch{return}}async function rR(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:o,recv:l,sendrecv:u}=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;const y=Yf(g,p,m,"sendonly"),b=Yf(g,p,m,"recvonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bo(y,b,"videoExtensions",S,w,k),Bo(y,b,"videoCodecs",S,w,k),Bo(y,b,"audioExtensions",S,w,k),Bo(y,b,"audioCodecs",S,w,k),$("RAISE_H264_BASELINE_PRIORITY")){const I=[],O=[];if(k.videoCodecs.forEach((W,H)=>{var Y;if(((Y=W.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"){var Q,Z;const q=k.videoCodecs[H+1],ee=q&&a4(W,q),ce=(Q=W.fmtp)===null||Q===void 0?void 0:Q.parameters["profile-level-id"],me=(Z=W.fmtp)===null||Z===void 0?void 0:Z.parameters["packetization-mode"];!ce||ce!==$("FIRST_H264_PROFILE_LEVEL_ID")||$("FIRST_PACKETIZATION_MODE")&&me!==$("FIRST_PACKETIZATION_MODE")?ee?O.push([W,q]):O.push([W]):ee?I.push([W,q]):I.push([W])}}),I.length>0&&O.length>0){C.debug("raising H264 baseline profile priority"),k.videoCodecs.forEach((H,Y)=>{var Q;if(((Q=H.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLocaleLowerCase())==="h264"){const Z=a4(H,k.videoCodecs[Y+1]),q=I.shift()||O.shift()||[];q.length>0&&(Z?k.videoCodecs.splice(Y,2,...q):k.videoCodecs.splice(Y,1,...q))}});const W=w.videoCodecs.filter(H=>{var Y,Q;return((Y=H.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((Q=H.fmtp)===null||Q===void 0?void 0:Q.parameters["profile-level-id"])!==$("FIRST_H264_PROFILE_LEVEL_ID")});if(W.length>0){const H=Vl(W,w.videoCodecs).map(Q=>Q.payloadType),Y=[...W.map(Q=>Q.payloadType),...H];w.videoCodecs=w.videoCodecs.filter(Q=>!fe(Y).call(Y,Q.payloadType))}$("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(H=>{var Y,Q;return!(((Y=H.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((Q=H.fmtp)===null||Q===void 0?void 0:Q.parameters["profile-level-id"])!==$("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:S,recv:w,sendrecv:k}}return{send:S,recv:w,sendrecv:k}}(e,t,i);try{n.close()}catch{}return{send:o,recv:l,sendrecv:u}}function s4(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Yf(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bo(e,t,"videoExtensions",n,i,o),Bo(e,t,"videoCodecs",n,i,o),Bo(e,t,"audioExtensions",n,i,o),Bo(e,t,"audioCodecs",n,i,o),$("RAISE_H264_BASELINE_PRIORITY")){const l=o.videoCodecs.findIndex(u=>u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&u.fmtp&&u.fmtp.parameters["profile-level-id"]==="42001f");if(l!==-1){const u=o.videoCodecs.findIndex(p=>p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(u<l){C.debug("raising H264 baseline profile priority");const p=o.videoCodecs[l];o.videoCodecs.splice(l,1),o.videoCodecs.splice(u,0,p)}u!==-1&&(i.videoCodecs=i.videoCodecs.filter(p=>!(p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&p.fmtp&&p.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:o}}function Bo(e,t,n,i,o,l){if(n==="videoExtensions"||n==="audioExtensions"){const u=[];return e[n].forEach(p=>{t[n].some((m,g)=>{if(p.entry===m.entry&&p.extensionName===m.extensionName)return u.push(g),!0})?l[n].push(p):i[n].push(p)}),void t[n].forEach((p,m)=>{u.indexOf(m)===-1&&o[n].push(p)})}if(n==="videoCodecs"||n==="audioCodecs"){const u=[];return e[n].forEach(p=>{t[n].some((m,g)=>{if(p.payloadType===m.payloadType&&JSON.stringify(p)===JSON.stringify(m))return u.push(g),!0})?l[n].push(p):i[n].push(p)}),void t[n].forEach((p,m)=>{u.indexOf(m)===-1&&o[n].push(p)})}}function Xf(e){const{send:t,recv:n,sendrecv:i}=e;if(!i){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let o,l;return t?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...t.audioCodecs,...i.audioCodecs],o.videoCodecs=[...t.videoCodecs,...i.videoCodecs],o.audioExtensions=[...t.audioExtensions,...i.audioExtensions],o.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):o=xn(i),n?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...n.audioCodecs,...i.audioCodecs],l.videoCodecs=[...n.videoCodecs,...i.videoCodecs],l.audioExtensions=[...n.audioExtensions,...i.audioExtensions],l.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):l=xn(i),{send:o,recv:l}}function Tp(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Jf(e,t,n,i){let o=[];if(e===Me.VIDEO){if($("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(o=t.videoCodecs.filter(l=>{var u;return fe(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,i)&&l&&l.fmtp&&l.fmtp.parameters["profile-level-id"]===$("H264_PROFILE_LEVEL_ID")})),!Array.isArray(o)||o.length===0){let l=[];const u=[],p=[],m=[];if(n.videoCodecs.forEach(g=>{const y=g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"";fe(y).call(y,i)?l.push(g):fe(y).call(y,"vp9")?u.push(g):fe(y).call(y,"vp8")?p.push(g):fe(y).call(y,"h264")&&m.push(g)}),l.length===0){let g="";u.length!==0?(l=u,g="vp9"):p.length!==0?(l=p,g="vp8"):m.length!==0&&(l=m,g="h264"),C.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(g))}l.length!==0&&(o=t.videoCodecs.filter(g=>l.some(y=>y.payloadType===g.payloadType)))}if(o.length===0&&(C.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),o=t.videoCodecs),$("USE_PUB_RTX")||$("USE_SUB_RTX")){const l=Vl(o,t.videoCodecs);o=[...o,...l]}}else{o=t.audioCodecs.filter(u=>{var p;return fe(p=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(p,i)});const l=t.audioCodecs.filter(u=>{var p;return fe(p=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(p,"red")});o.length===0&&(C.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),o=t.audioCodecs.filter(u=>{var p;return fe(p=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(p,"opus")})),$("ENABLE_AUDIO_RED")&&l.length!==0&&(o=[...l,...o])}return o}function Vl(e,t){const n=e.map(i=>i.payloadType.toString());return t.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&fe(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function Zs(e,t,n){const i=t.toString(),o=i4(i,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:i});const l=await e.createAnswer();if(!l.sdp)throw new Error("cannot get answer sdp");let u=l.sdp;u=sR(u,n||{}),o==null||o(u||""),await e.setLocalDescription({type:"answer",sdp:u})}function sR(e,t,n){if($("FORBID_MODIFY_LOCAL_OFFER_SDP"))return e;const i=Ns(e),{useXR:o}=t;return i.mediaDescriptions.forEach(l=>{var u;l.attributes.mid&&(Array.isArray(n)&&!fe(n).call(n,l.attributes.mid)||(l.media.mediaType==="audio"&&Tp(l),l.media.mediaType==="video"&&function(p){p.media.mediaType==="video"&&$("ENABLE_DOWN_SPS_PPS")&&p.attributes.payloads.filter(m=>{var g;return((g=m.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())==="h264"}).forEach(m=>{m.fmtp||(m.fmtp={parameters:{}}),m.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})}(l),o&&fe(u=["audio","video"]).call(u,l.media.mediaType)&&l.attributes.payloads.forEach(p=>{p.rtcpFeedbacks.findIndex(m=>m.type==="rrtr")===-1&&p.rtcpFeedbacks.push({type:"rrtr"})})))}),Gc(i)}function i4(e,t,n,i){if($("SDP_LOGGING"))return C.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(i,`
`),e),t==="offer"?o=>{i4(o,"answer",n==="local"?"remote":"local",i)}:void 0}async function o4(e,t,n){try{var i;if(!It().supportSetRtpSenderParameters||!function(m){return m==="vp9"||m==="av1"}(e)||!$("ENABLE_SVC"))return;const o={},l={},u=t.getParameters(),p=(i=u.encodings)===null||i===void 0?void 0:i[0];l.scalabilityMode=zf(n),p&&Object.assign(p,l),Object.assign(u,o),await t.setParameters(u),C.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(u.encodings)))}catch(o){C.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",o)}}function xE(e){const t=$("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>fe(e).call(e,n))}function a4(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function c4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function vi(e,t){return typeof $(e)===t?$(e):void 0}function ade(){try{const e=$("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?c4(Object(i),!0).forEach(function(o){D(t,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):c4(Object(i)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(i,o))})}return t}({},e)}catch(e){return C.debug("handle gateway attributes failed: ",e),{}}}const l4={};function lc(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&C.debug("install service ".concat(e.name)),l4[e.name]=e}function Ea(e){const t=l4[e];if(!t)throw new oe(G.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function d4(e,t){return Ea("DataStream").create(e,t)}function wE(){return Ea("InterceptFrame").create()}function u4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Pr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?u4(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u4(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const iR=new Map;class cde extends On{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Kn.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(Kn.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){C.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var i,o,l;super(),D(this,"store",void 0),D(this,"joinInfo",void 0),D(this,"key",void 0),D(this,"ntpOffset",0),D(this,"usingProxy",!1),D(this,"signal",void 0),D(this,"role",void 0),D(this,"isPreallocation",void 0),D(this,"isPreSub",void 0),D(this,"inChannelInfo",{joinAt:null,duration:0}),D(this,"spec",void 0),D(this,"_state","DISCONNECTED"),D(this,"_statsCollector",void 0),D(this,"_disconnectedReason",void 0),D(this,"isSignalRecover",!1),D(this,"hasChangeBGPAddress",!1),D(this,"trafficStatsInterval",void 0),D(this,"networkQualityInterval",void 0),D(this,"_joinGatewayStartTime",0),D(this,"_signalTimeout",!1),D(this,"_clientRoleOptions",void 0),D(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(i={spec:Pr(Pr({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(o=(l=Ea("P2PChannel")).createSubmodule)===null||o===void 0?void 0:o.call(l,i)):this.store.useDcSignal?function(u){return Ea("DataChannelSignal").create(u)}({spec:Pr(Pr({},n),{},{retryConfig:n.websocketRetryConfig}),store:t}):new WV(Pr(Pr({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(t){this.usingProxy=t}async join(t,n,i){if(this.store.useDcSignal){let y=!1;t.cloudProxyServer!=="disabled"?(C.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),y=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(C.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),y=!0):t.apResponse.addresses.some(b=>b.fingerprint)||$("FINGERPRINT")||(C.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),y=!0),y&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const o=Date.now();let l=iR.get(t.cname);if(l||(l=new Map,iR.set(t.cname,l)),this._isProactiveJoin=!0,l.has(t.uid)){const y=new ne(G.UID_CONFLICT);throw Ue.joinGateway(t.sid,{lts:o,succ:!1,ec:y.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:t.preload}),y}l.set(t.uid,!0),this.joinInfo=t,this.key=n;let u=0;this.joinGatewayStartTime=o;const p=t.proxyServer,m=this.store.useDcSignal?"datachannel":"websocket";try{C.debug("[".concat(this.store.clientId,"] use ").concat(m," join uid ").concat(u));const y=t.gatewayAddrs.map(S=>{let{address:w}=S;const[k,I]=w.split(":"),O={host:k,port:I};return t.proxyServer&&(O.proxy=t.proxyServer),O});let b;b=this.store.useDcSignal?await this.signal.init(t.apResponse.addresses):await this.signal.init(y),u=b.uid,C.debug("[".concat(this.store.clientId,"] ").concat(m," join uid ").concat(u," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(y){var g;throw y.code===G.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||Ue.joinGateway(t.sid,{lts:o,succ:!1,ec:((g=y.data)===null||g===void 0?void 0:g.desc)||y.code,errorMsg:y.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!p||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:t.preload}),y&&y.code===G.INIT_DATACHANNEL_TIMEOUT?(C.warning("[".concat(this.store.clientId,"] User join datachannel failed"),y.toString()),this.resetSignal(),y):(C.error("[".concat(this.store.clientId,"] User join failed"),y.toString()),l.delete(t.uid),this.signal.close(),y)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),C.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(y=>{C.warning("[".concat(this.store.clientId,"] get traffic stats error"),y.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Kn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Kn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Kn.NETWORK_QUALITY,{uplinkNetworkQuality:EE(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:EE(this._statsCollector.trafficStats.B_dnq)}):this.emit(Kn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),u}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==kt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Lt.CONNECTED||await function(i,o){return o===1/0?i:xe.race([i,Lce(o)])}(this.signal.request(He.LEAVE,void 0,!0),3e3)}catch(i){C.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==kt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:$("PUB_EXTEND"),twcc:!!$("PUBLISH_TWCC"),rtx:!!$("USE_PUB_RTX")};try{return(await this.signal.request(He.PUBLISH,o,!0))._message}catch(l){if(i&&l.data&&l.data.code===Je.ERR_PUBLISH_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),l.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw l}}async publishDataChannel(t,n,i){var o;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const l={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(o=n.maxRetransmits)!==null&&o!==void 0?o:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(He.PUBLISH_DATASTREAM,l,!0)}catch(u){if(i&&u.data&&u.data.code===Je.ERR_PUBLISH_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),u.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw u}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(He.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(i){C.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await xe.all(t.map(n=>this.signal.request(He.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){C.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const o={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!$("SUBSCRIBE_TWCC"),rtx:!!$("USE_SUB_RTX")||void 0,extend:$("SUB_EXTEND"),svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return await this.signal.request(He.PRE_SUBSCRIBE,o,!0)}catch(l){if(i&&l.data&&l.data.code===Je.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),l.toString()),this.presubscribe(t,n,!1);throw l}}async subscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const o={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!$("SUBSCRIBE_TWCC"),rtx:!!$("USE_SUB_RTX"),extend:$("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return(await this.signal.request(He.SUBSCRIBE,o,!0))._message}catch(l){if(i&&l.data&&l.data.code===Je.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),l.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw l}}async subscribeDataChannel(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const o={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(He.SUBSCRIBE_DATASTREAM,o,!0)}catch(l){if(i&&l.data&&l.data.code===Je.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),l.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw l}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!$("USE_SUB_RTX"),twcc:!!$("SUBSCRIBE_TWCC"),svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return await this.signal.request(He.SUBSCRIBE_STREAMS,i,!0)}catch(o){if(n&&o.data&&o.data.code===Je.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),o.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw o}}async setVideoProfile(t){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let o=i.frameRate,l=i.width,u=i.height,p=!0;return typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(p=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,l||(p=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,o||(p=!1)),p?{stream_type:0,width:l,height:u,fps:o,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(n)return this.signal.request(He.SET_VIDEO_PROFILE,n);C.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(He.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(i){C.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await xe.all(t.map(i=>this.signal.request(He.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){C.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(t){try{await this.signal.request(He.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){C.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}=t;return{gatewayEstablishParams:await this.signal.request(He.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(He.GATEWAY_INFO)}async renewToken(t){await this.signal.request(He.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),$("CLIENT_ROLE_OPTIONS")&&(C.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify($("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},$("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),$("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},$("CLIENT_ROLE_OPTIONS")),C.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify($("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let i,o=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,o=1):o=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:o=0;const l=Object.assign({},n);delete l.delay,delete l.level,await this.signal.request(He.SET_CLIENT_ROLE,Pr(Pr({role:t,level:o,delay:i},l),{},{client_ts:Date.now()})),this.role=t}async setDualStreamMode(t,n,i){await this.signal.request(He.SET_DUAL_STREAM_MODE,{mode:t},i,n)}async setRemoteVideoStreamType(t,n){await this.signal.request(He.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(He.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(He.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(He.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(He.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Pr({},this.inChannelInfo)}async setConfigure(t){if(t&&Array.isArray(t)&&t.length!==0)return this.signal.request(He.CONFIGURE,t)}async getGatewayVersion(){return(await this.signal.request(He.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=iR.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:qr.username,password:qr.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Pr(Pr({},qr),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(He.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(o=>o.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&Vy(()=>{this.emit(Kn.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n,i,o,l;if(!this.joinInfo||!this.key)throw new ne(G.UNEXPECTED_ERROR,"can not generate join message, no join info");const u=Object.assign({},this.joinInfo.apResponse);let p=$("REPORT_APP_SCENARIO");if(typeof p!="string")try{p=JSON.stringify(p)}catch{p=void 0}var m;p&&p.length>128&&(p=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Kn.UPDATE_GATEWAY_CONFIG),m=this.store.clientId,fe(Ep).call(Ep,m)||Ep.push(m);const g=Bf(this.store),y=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),b=uU(this.store),S=ade(),w=pa(87)||_5()||$T(117),k=(function(){const H=Ft();if(H.name!==Ht.SAFARI||!H.browserVersion)return!1;const Y=H.browserVersion.split(".");return Number(Y[0])>18||Number(Y[0])===18&&Number(Y[1])>=4}()||b5(18,4))&&WT(18,6)&&this.spec.codec==="h264"&&$("ENABLE_ABSSENDTIME_AS_SENTTS"),I=!(((i=u.detail)===null||i===void 0?void 0:i[3])!=="CN"||!$("ENABLE_QUALITY_FALLBACK"))&&$("ENABLE_QUALITY_FALLBACK"),O=!!$("ENABLE_AP_MULTI_IP")&&((o=u.detail)===null||o===void 0?void 0:o[5])==="multi-ip",W=Pr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:to,browser:navigator.userAgent,process_id:$("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:O||this.hasChangeBGPAddress,ap_response:u,extend:$("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:p,attributes:{userAttributes:Pr(Pr({enableEncodedTransform:(!!$("ENABLE_AUDIO_METADATA")||!!$("ENABLE_AUDIO_PTS"))&&w||!!$("ENABLE_AUDIO_TOPN")&&BT(Ht.CHROME,87,116)||void 0,enableAudioMetadata:!!$("ENABLE_AUDIO_METADATA")&&w,enableAudioPts:!!$("ENABLE_AUDIO_PTS")&&w,topnSmoothLevel:$("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:$("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:$("TOPN_SWITCH_HOLD_MS"),topnAudioGain:$("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:$("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:$("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:vi("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:vi("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:vi("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:$("USE_PUB_RTX")===!0||$("USE_SUB_RTX")===!0||void 0,disableFEC:$("DISABLE_FEC"),enableNTPReport:!!$("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:b,enableFulllinkAvSync:!!$("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:vi("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!$("FORCE_ENABLE_AUT_CC")||!Yy()&&(!!$("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!$("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:vi("USE_XR","boolean"),enableLossbasedBwe:vi("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!$("FORCE_ENABLE_AUT_CC")||!Yy()&&(!!$("ENABLE_AUT_CC")||void 0),enableCCFallback:vi("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:y,preSubNum:g?vi("PRE_SUB_NUM","number"):void 0,enablePubTWCC:vi("PUBLISH_TWCC","boolean"),enableSubTWCC:vi("SUBSCRIBE_TWCC","boolean"),enablePubRTX:vi("USE_PUB_RTX","boolean"),enableSubRTX:vi("USE_SUB_RTX","boolean"),enableSubSVC:$("ENABLE_SVC")?$("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0,enableSvcExtended:$("ENABLE_SVC")&&Array.isArray($("SVC_EXTENDED"))&&$("SVC_EXTENDED").length!==0?$("SVC_EXTENDED"):void 0,enableVosFallback:$("ENABLE_VOS_FALLBACK"),enableQualityFallback:I},S),{},{audioDuplicate:vi("ENABLE_AUDIO_RED","boolean")?(l=vi("AUDIO_DUPLICATE_NUM","number"))!==null&&l!==void 0?l:2:void 0,senttsUsesAbsSendTime:!!k||void 0,enableDualStreamFlag:vi("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(W.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(W.aes_mode=this.joinInfo.aesmode,$("ENCRYPT_AES")?(W.aes_secret=this.joinInfo.aespassword,W.aes_encrypt=!0):W.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(W.aes_salt=this.joinInfo.aessalt)),u.addresses[this.signal.websocket.currentURLIndex]&&(W.ap_response.ticket=u.addresses[this.signal.websocket.currentURLIndex].ticket,delete u.addresses),this.joinInfo.defaultVideoStream!==void 0&&(W.default_video_stream=this.joinInfo.defaultVideoStream),W}getRejoinMessage(){if(!this.joinInfo)throw new ne(G.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Fe.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Fe.WS_RECONNECTING,t=>{this.joinInfo&&Ue.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Yr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Ue.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Fe.WS_CLOSED,t=>{let n;switch(t){case kt.LEAVE:n=Yr.LEAVE;break;case kt.UID_BANNED:case kt.IP_BANNED:case kt.CHANNEL_BANNED:case kt.SERVER_ERROR:n=Yr.SERVER_ERROR;break;case kt.FALLBACK:n=Yr.FALLBACK;break;case kt.LICENSE_MISSING:case kt.LICENSE_EXPIRED:case kt.LICENSE_MINUTES_EXCEEDED:case kt.LICENSE_PERIOD_INVALID:case kt.LICENSE_MULTIPLE_SDK_SERVICE:case kt.LICENSE_ILLEGAL:case kt.TOKEN_EXPIRE:n=t;break;default:n=Yr.NETWORK_ERROR}C.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Yr.NETWORK_ERROR)),this.joinInfo&&Ue.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===kt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==kt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Fe.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=$("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(C.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(Ue.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void C.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));on("EVENT_REPORT_DOMAIN",t[1]),on("EVENT_REPORT_BACKUP_DOMAIN",t[1]),on("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(lt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Fe.REQUEST_RECOVER,(t,n,i)=>{if(!this.joinInfo)return i(new ne(G.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ar(this,Kn.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(Fe.REQUEST_JOIN_INFO,async(t,n,i)=>{var o,l,u;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const p=xn((o=this.joinInfo)===null||o===void 0?void 0:o.turnServer);if($("NEW_TURN_MODE")&&p&&((l=this.joinInfo)===null||l===void 0?void 0:l.cloudProxyServer)==="disabled"){var m;let S=p.servers.map(I=>"turnServerURL"in I&&$("USE_TURN_IP")?Pr(Pr({},I),{},{turnServerURL:yE(I.turnServerURL)}):I),w=(m=p.serversFromGateway)===null||m===void 0?void 0:m.map(I=>$("USE_TURN_IP")?Pr(Pr({},I),{},{turnServerURL:yE(I.turnServerURL)}):I);const k=this.signal.currentURLIndex;S.length>0&&(S=[S[k%S.length]],p.servers=S),Array.isArray(w)&&w.length>0&&(w=[w[0]],p.serversFromGateway=w),C.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(k))}const{iceParameters:g,dtlsParameters:y,rtpCapabilities:b}=await ar(this,Kn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:p,cloudProxyServer:(u=this.joinInfo)===null||u===void 0?void 0:u.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:g,dtlsParameters:y,rtpCapabilities:b,version:"2"}}))}catch(S){n(S)}}),this.signal.on(Fe.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Fe.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let i,o="";var l;t instanceof ne?(i=((l=t.data)===null||l===void 0?void 0:l.desc)||t.code,o=t.message):i=t,Ue.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:o,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on(Fe.IS_P2P_DISCONNECTED,t=>{t(tu(this,Kn.IS_P2P_DISCONNECTED))}),this.signal.on(Fe.DISCONNECT_P2P,()=>{this.emit(Kn.DISCONNECT_P2P)}),this.signal.on(Fe.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Fe.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Fe.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(Kn.JOIN_RESPONSE,t,n)}),this.signal.on(Fe.PRE_CONNECT_PC,async(t,n)=>{if(this.joinInfo){var i,o;this.updateTurnConfigFromSignal();const u=this.getCurrentGatewayAddress(),p=xn((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if($("NEW_TURN_MODE")&&p&&((o=this.joinInfo)===null||o===void 0?void 0:o.cloudProxyServer)==="disabled"){var l;let g=p.servers.map(S=>"turnServerURL"in S&&$("USE_TURN_IP")?Pr(Pr({},S),{},{turnServerURL:yE(S.turnServerURL)}):S),y=(l=p.serversFromGateway)===null||l===void 0?void 0:l.map(S=>$("USE_TURN_IP")?Pr(Pr({},S),{},{turnServerURL:yE(S.turnServerURL)}):S);const b=this.signal.currentURLIndex;g.length>0&&(g=[g[b%g.length]],p.servers=g),Array.isArray(y)&&y.length>0&&(y=[y[0]],p.serversFromGateway=y),C.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(b,",in pre pc"))}const m=$("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(u&&m){const g=t4(u);ar(this,Kn.PRE_CONNECT_PC,{candidates:g,fingerprint:m,turnServer:p}).then(y=>{t==null||t(y)}).catch(n||(()=>{}))}}}),this.signal.on(Fe.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof $("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat($("AP_REQUEST_DETAIL"),";").concat(t))}),this.signal.on(Fe.VOS_FALLBACK,t=>{this.emit(Kn.VOS_FALLBACK,t)}),this.signal.on(Fe.DATACHANNEL_FAILBACK,t=>{C.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Kn.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(He.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(i){throw C.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(He.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw C.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(He.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(i){throw C.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(He.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw C.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(t){const n={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(He.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw C.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,n){const i={action:t.find(o=>o.stream_type===tn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(He.CONTROL,i,!0,!0)}catch(o){throw C.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),o),o}}async unmuteLocal(t,n){const i={action:t.find(o=>o.stream_type===tn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(He.CONTROL,i,!0,!0)}catch(o){throw C.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),o),o}}async muteRemote(t,n){const i={action:t===Me.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(He.CONTROL,i,!0,!0)}catch(o){throw C.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),o),o}}async unmuteRemote(t,n){const i={action:t===Me.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(He.CONTROL,i,!0,!0)}catch(o){throw C.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),o),o}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(He.RESTART_ICE,n,!0)}catch(i){throw C.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||Yr.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!$("GATEWAY_WSS_ADDRESS"))return $("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(C.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(He.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(kt.FALLBACK)),this.store.useDcSignal=!1,this.signal=new WV(Pr(Pr({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Kn.RESET_SIGNAL)}}let TE=0,oR=0;function va(e,t,n,i){return new xe((o,l)=>{t.timeout=t.timeout||$("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),TE+=rc(t.data)):n&&(t.data.size?TE+=t.data.size:t.data instanceof FormData?TE+=B5(t.data):TE+=rc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Ms.request(t).then(u=>{typeof u.data=="string"?oR+=rc(u.data):u.data instanceof ArrayBuffer||u.data instanceof Uint8Array?oR+=u.data.byteLength:oR+=rc(JSON.stringify(u.data)),i&&o({data:u.data,headers:u.headers}),o(u.data)}).catch(u=>{Ms.isCancel(u)?l(new ne(G.OPERATION_ABORTED,"cancel token canceled")):u.code==="ECONNABORTED"?l(new ne(G.NETWORK_TIMEOUT,u.message)):u.response?l(new ne(G.NETWORK_RESPONSE_ERROR,u.response.status)):l(new ne(G.NETWORK_ERROR,u.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(he){var Ee=0;return function(){return Ee<he.length?{done:!1,value:he[Ee++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(he,Ee,je){return he==Array.prototype||he==Object.prototype||(he[Ee]=je.value),he},i,o=function(he){he=[typeof globalThis=="object"&&globalThis,he,typeof window=="object"&&window,typeof self=="object"&&self,typeof c=="object"&&c];for(var Ee=0;Ee<he.length;++Ee){var je=he[Ee];if(je&&je.Math==Math)return je}throw Error("Cannot find global object")}(this);function l(he,Ee){if(Ee)e:{var je=o;he=he.split(".");for(var pe=0;pe<he.length-1;pe++){var A=he[pe];if(!(A in je))break e;je=je[A]}(Ee=Ee(pe=je[he=he[he.length-1]]))!=pe&&Ee!=null&&n(je,he,{configurable:!0,writable:!0,value:Ee})}}function u(he){return(he={next:he})[Symbol.iterator]=function(){return this},he}function p(he){var Ee=typeof Symbol<"u"&&Symbol.iterator&&he[Symbol.iterator];return Ee?Ee.call(he):{next:t(he)}}if(l("Symbol",function(he){function Ee(A,z){this.A=A,n(this,"description",{configurable:!0,writable:!0,value:z})}if(he)return he;Ee.prototype.toString=function(){return this.A};var je="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",pe=0;return function A(z){if(this instanceof A)throw new TypeError("Symbol is not a constructor");return new Ee(je+(z||"")+"_"+pe++,z)}}),l("Symbol.iterator",function(he){if(he)return he;he=Symbol("Symbol.iterator");for(var Ee="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),je=0;je<Ee.length;je++){var pe=o[Ee[je]];typeof pe=="function"&&typeof pe.prototype[he]!="function"&&n(pe.prototype,he,{configurable:!0,writable:!0,value:function(){return u(t(this))}})}return he}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var m;e:{var g={};try{g.__proto__={a:!0},m=g.a;break e}catch{}m=!1}i=m?function(he,Ee){if(he.__proto__=Ee,he.__proto__!==Ee)throw new TypeError(he+" is not extensible");return he}:null}var y=i;function b(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function S(he){if(he.m)throw new TypeError("Generator is already running");he.m=!0}function w(he,Ee){return he.h=3,{value:Ee}}function k(he){this.g=new b,this.G=he}function I(he,Ee,je,pe){try{var A=Ee.call(he.g.j,je);if(!(A instanceof Object))throw new TypeError("Iterator result "+A+" is not an object");if(!A.done)return he.g.m=!1,A;var z=A.value}catch(X){return he.g.j=null,he.g.s(X),O(he)}return he.g.j=null,pe.call(he.g,z),O(he)}function O(he){for(;he.g.h;)try{var Ee=he.G(he.g);if(Ee)return he.g.m=!1,{value:Ee.value,done:!1}}catch(je){he.g.v=void 0,he.g.s(je)}if(he.g.m=!1,he.g.l){if(Ee=he.g.l,he.g.l=null,Ee.F)throw Ee.D;return{value:Ee.return,done:!0}}return{value:void 0,done:!0}}function W(he){this.next=function(Ee){return he.o(Ee)},this.throw=function(Ee){return he.s(Ee)},this.return=function(Ee){return function(je,pe){S(je.g);var A=je.g.j;return A?I(je,"return"in A?A.return:function(z){return{value:z,done:!0}},pe,je.g.return):(je.g.return(pe),O(je))}(he,Ee)},this[Symbol.iterator]=function(){return this}}function H(he,Ee){return Ee=new W(new k(Ee)),y&&he.prototype&&y(Ee,he.prototype),Ee}if(b.prototype.o=function(he){this.v=he},b.prototype.s=function(he){this.l={D:he,F:!0},this.h=this.C||this.u},b.prototype.return=function(he){this.l={return:he},this.h=this.u},k.prototype.o=function(he){return S(this.g),this.g.j?I(this,this.g.j.next,he,this.g.o):(this.g.o(he),O(this))},k.prototype.s=function(he){return S(this.g),this.g.j?I(this,this.g.j.throw,he,this.g.o):(this.g.s(he),O(this))},l("Array.prototype.entries",function(he){return he||function(){return function(Ee,je){Ee instanceof String&&(Ee+="");var pe=0,A=!1,z={next:function(){if(!A&&pe<Ee.length){var X=pe++;return{value:je(X,Ee[X]),done:!1}}return A=!0,{done:!0,value:void 0}}};return z[Symbol.iterator]=function(){return z},z}(this,function(Ee,je){return[Ee,je]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var Y=function(he,Ee){for(var je=0;je<he.length;je++)Ee(he[je])},Q=function(he){return he.replace(/\r?\n|\r/g,`\r
`)},Z=function(he,Ee,je){return Ee instanceof Blob?(je=je!==void 0?je+"":typeof Ee.name=="string"?Ee.name:"blob",Ee.name===je&&Object.prototype.toString.call(Ee)!=="[object Blob]"||(Ee=new File([Ee],je)),[String(he),Ee]):[String(he),String(Ee)]},q=function(he,Ee){if(he.length<Ee)throw new TypeError(Ee+" argument required, but only "+he.length+" present.")},ee=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ce=ee.FormData,me=ee.XMLHttpRequest&&ee.XMLHttpRequest.prototype.send,Oe=ee.Request&&ee.fetch,ot=ee.navigator&&ee.navigator.sendBeacon,it=ee.Element&&ee.Element.prototype,wt=ee.Symbol&&Symbol.toStringTag;wt&&(Blob.prototype[wt]||(Blob.prototype[wt]="Blob"),"File"in ee&&!File.prototype[wt]&&(File.prototype[wt]="File"));try{new File([],"")}catch{ee.File=function(Ee,je,pe){return Ee=new Blob(Ee,pe||{}),Object.defineProperties(Ee,{name:{value:je},lastModified:{value:+(pe&&pe.lastModified!==void 0?new Date(pe.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),wt&&Object.defineProperty(Ee,wt,{value:"File"}),Ee}}var yt=function(he){return he.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Kt=function(he){this.i=[];var Ee=this;he&&Y(he.elements,function(je){if(je.name&&!je.disabled&&je.type!=="submit"&&je.type!=="button"&&!je.matches("form fieldset[disabled] *"))if(je.type==="file"){var pe=je.files&&je.files.length?je.files:[new File([],"",{type:"application/octet-stream"})];Y(pe,function(A){Ee.append(je.name,A)})}else je.type==="select-multiple"||je.type==="select-one"?Y(je.options,function(A){!A.disabled&&A.selected&&Ee.append(je.name,A.value)}):je.type==="checkbox"||je.type==="radio"?je.checked&&Ee.append(je.name,je.value):(pe=je.type==="textarea"?Q(je.value):je.value,Ee.append(je.name,pe))})};if((e=Kt.prototype).append=function(he,Ee,je){q(arguments,2),this.i.push(Z(he,Ee,je))},e.delete=function(he){q(arguments,1);var Ee=[];he=String(he),Y(this.i,function(je){je[0]!==he&&Ee.push(je)}),this.i=Ee},e.entries=function he(){var Ee,je=this;return H(he,function(pe){if(pe.h==1&&(Ee=0),pe.h!=3)return Ee<je.i.length?pe=w(pe,je.i[Ee]):(pe.h=0,pe=void 0),pe;Ee++,pe.h=2})},e.forEach=function(he,Ee){q(arguments,1);for(var je=p(this),pe=je.next();!pe.done;pe=je.next()){var A=p(pe.value);pe=A.next().value,A=A.next().value,he.call(Ee,A,pe,this)}},e.get=function(he){q(arguments,1);var Ee=this.i;he=String(he);for(var je=0;je<Ee.length;je++)if(Ee[je][0]===he)return Ee[je][1];return null},e.getAll=function(he){q(arguments,1);var Ee=[];return he=String(he),Y(this.i,function(je){je[0]===he&&Ee.push(je[1])}),Ee},e.has=function(he){q(arguments,1),he=String(he);for(var Ee=0;Ee<this.i.length;Ee++)if(this.i[Ee][0]===he)return!0;return!1},e.keys=function he(){var Ee,je,pe,A,z=this;return H(he,function(X){if(X.h==1&&(Ee=p(z),je=Ee.next()),X.h!=3)return je.done?void(X.h=0):(pe=je.value,A=p(pe),w(X,A.next().value));je=Ee.next(),X.h=2})},e.set=function(he,Ee,je){q(arguments,2),he=String(he);var pe=[],A=Z(he,Ee,je),z=!0;Y(this.i,function(X){X[0]===he?z&&(z=!pe.push(A)):pe.push(X)}),z&&pe.push(A),this.i=pe},e.values=function he(){var Ee,je,pe,A,z=this;return H(he,function(X){if(X.h==1&&(Ee=p(z),je=Ee.next()),X.h!=3)return je.done?void(X.h=0):(pe=je.value,(A=p(pe)).next(),w(X,A.next().value));je=Ee.next(),X.h=2})},Kt.prototype._asNative=function(){for(var he=new ce,Ee=p(this),je=Ee.next();!je.done;je=Ee.next()){var pe=p(je.value);je=pe.next().value,pe=pe.next().value,he.append(je,pe)}return he},Kt.prototype._blob=function(){var he="----formdata-polyfill-"+Math.random(),Ee=[],je="--"+he+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(pe,A){return typeof pe=="string"?Ee.push(je+yt(Q(A))+`"\r
\r
`+Q(pe)+`\r
`):Ee.push(je+yt(Q(A))+'"; filename="'+yt(pe.name)+`"\r
Content-Type: `+(pe.type||"application/octet-stream")+`\r
\r
`,pe,`\r
`)}),Ee.push("--"+he+"--"),new Blob(Ee,{type:"multipart/form-data; boundary="+he})},Kt.prototype[Symbol.iterator]=function(){return this.entries()},Kt.prototype.toString=function(){return"[object FormData]"},it&&!it.matches&&(it.matches=it.matchesSelector||it.mozMatchesSelector||it.msMatchesSelector||it.oMatchesSelector||it.webkitMatchesSelector||function(he){for(var Ee=(he=(this.document||this.ownerDocument).querySelectorAll(he)).length;0<=--Ee&&he.item(Ee)!==this;);return-1<Ee}),wt&&(Kt.prototype[wt]="FormData"),me){var An=ee.XMLHttpRequest.prototype.setRequestHeader;ee.XMLHttpRequest.prototype.setRequestHeader=function(he,Ee){An.call(this,he,Ee),he.toLowerCase()==="content-type"&&(this.B=!0)},ee.XMLHttpRequest.prototype.send=function(he){he instanceof Kt?(he=he._blob(),this.B||this.setRequestHeader("Content-Type",he.type),me.call(this,he)):me.call(this,he)}}Oe&&(ee.fetch=function(he,Ee){return Ee&&Ee.body&&Ee.body instanceof Kt&&(Ee.body=Ee.body._blob()),Oe.call(this,he,Ee)}),ot&&(ee.navigator.sendBeacon=function(he,Ee){return Ee instanceof Kt&&(Ee=Ee._asNative()),ot.call(this,he,Ee)}),ee.FormData=Kt}})();const Qf=()=>{const e=$("AREAS");return e.length===0&&e.push(zt.GLOBAL),Zi(e).call(e,(t,n,i)=>{const o=h4(n);return o?i===0?o:"".concat(t,",").concat(o):t},"")},h4=e=>e===zt.OVERSEA?"".concat(ns.ASIA,",").concat(ns.EUROPE,",").concat(ns.AFRICA,",").concat(ns.NORTH_AMERICA,",").concat(ns.SOUTH_AMERICA,",").concat(ns.OCEANIA):ns[e],lde=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const i=fE[n],o=Object.keys(i);o&&o.map(l=>{l!=="CODE"&&(t[l]=t[l].concat(i[l]))})}),t},CE={GLOBAL:{ASIA:[zt.CHINA,zt.JAPAN,zt.INDIA,zt.KOREA,zt.HKMC],EUROPE:[],NORTH_AMERICA:[zt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},RE=Object.keys(CE[zt.GLOBAL]),aR=[zt.CHINA,zt.NORTH_AMERICA,zt.EUROPE,zt.ASIA,zt.JAPAN,zt.INDIA,zt.OCEANIA,zt.SOUTH_AMERICA,zt.AFRICA,zt.KOREA,zt.HKMC,zt.US],dde=function(e,t){let n=[];if(fe(e).call(e,zt.GLOBAL)){const l=[zt.GLOBAL,zt.OVERSEA],u=Object.keys(fE);if(t===zt.GLOBAL)throw new ne(G.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===zt.CHINA)n=[zt.OVERSEA];else if(o=t,fe(RE).call(RE,o)){const p=(i=t,CE[zt.GLOBAL][i]||[]),m=[...l,t,...p];n=u.filter(g=>!fe(m).call(m,g))}else if(function(p){let m=!1;return RE.forEach(g=>{var y;fe(y=CE[zt.GLOBAL][g]).call(y,p)&&(m=!0)}),m}(t)){const p=function(g){let y;return RE.forEach(b=>{var S;fe(S=CE[zt.GLOBAL][b]).call(S,g)&&(y=b)}),y}(t),m=[...l,p,t];n=u.filter(g=>!fe(m).call(m,g))}else n=e;n=function(p){const m=[];return aR.forEach(g=>{fe(p).call(p,g)&&m.push(g)}),m.concat(p.filter(g=>!fe(aR).call(aR,g)))}(n)}else n=e;var i,o;return n};function p4(e){var t,n;if(!e&&fe(t=$("AREAS")).call(t,zt.EXTENSIONS))return C.debug("update area from ap : reset"),void cR(Ele,!0);if(!fe(n=$("AREAS")).call(n,zt.GLOBAL)||!e)return;let i=fE.EXTENSIONS;i&&(i={CODE:h4(zt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},C.debug("update area from ap success: ".concat(e,",config is "),i),on("AREAS",[zt.EXTENSIONS],!0),Object.keys(i).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?on(o,i[o][0]):on(o,i[o])}))}function cR(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Ue.reportApiInvoke(null,{name:Rn.SET_AREA,options:e,tag:hn.TRACER});try{let i=[];if(typeof e=="string"&&(i=[e]),Array.isArray(e)&&(e.forEach(l=>{if(!fe(MV).call(MV,l))throw new ne(G.INVALID_PARAMS,"invalid area code")}),i=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:l,excludedArea:u}=e;if(!l)throw new ne(G.INVALID_PARAMS,"area code is needed");let p=l;typeof l=="string"&&(p=[l]),i=u?dde(p,u):p}if(!t){if(ki.AREAS){const l=new ne(G.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(l),void C.warning("setArea is prohibited because of config-distribute")}if(fe(i).call(i,zt.GLOBAL)&&$("AREAS")===zt.EXTENSIONS){const l=new ne(G.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(l),void C.warning("setArea is prohibited because of ap extensions")}}on("AREAS",i,t);const o=lde(i);Object.keys(o).map(l=>{l==="LOG_UPLOAD_SERVER"||l==="EVENT_REPORT_DOMAIN"||l==="EVENT_REPORT_BACKUP_DOMAIN"||l==="PROXY_SERVER_TYPE3"?on(l,o[l][0]):on(l,o[l])}),C.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function m4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function dc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?m4(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m4(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let lR=1;function ude(e,t,n,i,o){lR+=1;const l={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:lR,requestId:lR,version:to,cname:n.cname},u={service_name:t,json_body:JSON.stringify(l)};let p,m,g=e[0];return ma(async()=>{p=Date.now();const y=await va(g,{data:u,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-p,y.code!==0){const w=new ne(G.UNEXPECTED_RESPONSE,"live streaming ap error, code"+y.code,{retry:!0,responseTime:m});throw C.error(w.toString()),w}const b=JSON.parse(y.json_body);if(b.code!==200){const w=new ne(G.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(b.code,", reason: ").concat(b.reason),{code:b.code,responseTime:m});throw C.error(w.toString()),w}if(!b.servers||b.servers.length===0){const w=new ne(G.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:b.code,responseTime:m});throw C.error(w.toString()),w}const S=function(w,k){return{addressList:w.servers.map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat($("WORKER_DOMAIN"),":").concat(I.wss,"?serviceName=").concat(encodeURIComponent(k))),workerToken:w.workerToken,vid:w.vid}}(b,t);return $("LIVE_STREAMING_ADDRESS")&&(S.addressList=$("LIVE_STREAMING_ADDRESS")instanceof Array?$("LIVE_STREAMING_ADDRESS"):[$("LIVE_STREAMING_ADDRESS")]),dc(dc({},S),{},{responseTime:m})},(y,b)=>(Ue.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(y.addressList),firstSuccess:b===0,responseTime:m,serverIp:e[b%e.length]}),!1),(y,b)=>(Ue.apworkerEvent(n.sid,{success:!1,sc:y.data&&y.data.code||200,serviceName:t,responseTime:m,serverIp:e[b%e.length]}),!!(y.code!==G.OPERATION_ABORTED&&y.code!==G.UNEXPECTED_RESPONSE||y.data&&y.data.retry)&&(g=e[(b+1)%e.length],!0)),o)}let dR=1;function f4(e,t,n,i){let{url:o,areaCode:l}=e;const{clientId:u,sid:p}=t,m=Date.now();let g;const y=t.role,[b,S]=hR(t,l,[er.CHOOSE_SERVER]);let w=Un.networkState;return ma(async()=>{w&&Un.networkState===Rs.OFFLINE&&Un.onlineWaiter&&await xe.race([Un.onlineWaiter,vr(i&&i.maxRetryTimeout||Zn.maxRetryTimeout)]),w=Un.networkState;const{data:k,headers:I}=await va(o,{data:b,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=I.http3==="1"?1:-1,Ue.reportResourceTiming(o,p),_4(k,o,t,m,[er.CHOOSE_SERVER],g);const O=Kf(k,er.CHOOSE_SERVER);return uR(O),JC(O,o)},k=>(k&&Ue.joinChooseServer(p,{role:y,lts:m,succ:!0,csAddr:o,opid:S,serverList:k.gatewayAddrs.map(I=>I.address),ec:null,cid:k.cid.toString(),uid:k.uid.toString(),csIp:k.csIp,unilbsServerIds:[er.CHOOSE_SERVER].toString(),isHttp3:g,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:k.res.detail&&k.res.detail[38],vid:k.vid}),!1),k=>k.code!==G.OPERATION_ABORTED&&(k.code===G.CAN_NOT_GET_GATEWAY_SERVER?k.data.retry:(Ue.joinChooseServer(p,{role:y,lts:m,succ:!1,csAddr:o,serverList:null,opid:S,ec:k.code,csIp:k.data&&k.data.csIp,unilbsServerIds:[er.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:w}),isHttp3:g,corssRegionTagReq:t.apRequestDetail}),C.warning("[".concat(u||"sid-".concat(p.slice(0,6)),"] Choose server network error, retry"),k),!0)),i)}function g4(e,t,n,i){let o,{url:l,areaCode:u,serviceIds:p}=e;const m=Date.now(),g=t.role,[y,b]=hR(t,u,p);let S;return ma(async()=>{S&&Un.networkState===Rs.OFFLINE&&Un.onlineWaiter&&await xe.race([Un.onlineWaiter,vr(i&&i.maxRetryTimeout||Zn.maxRetryTimeout)]),S=Un.networkState;const{data:w,headers:k}=await va(l,{data:y,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o=k.http3==="1"?1:-1,Ue.reportResourceTiming(l,t.sid),_4(w,l,t,m,p,o);const I=Kf(w,er.CHOOSE_SERVER),O=Kf(w,t.cloudProxyServer==="proxy5"?er.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?er.CLOUD_PROXY:er.CLOUD_PROXY_FALLBACK),W=performance.getEntriesByName(l),H=W[W.length-1];let Y;return H&&(Y={name:H.name,protocol:"nextHopProtocol"in H?H.nextHopProtocol:"",dnscost:"domainLookupEnd"in H&&"domainLookupStart"in H&&typeof H.domainLookupEnd=="number"&&typeof H.domainLookupStart=="number"?H.domainLookupEnd-H.domainLookupStart:-1,tcpTlsCost:"connectEnd"in H&&"connectStart"in H&&typeof H.connectEnd=="number"&&typeof H.connectStart=="number"?H.connectEnd-H.connectStart:-1,reqCost:"requestStart"in H&&typeof H.requestStart=="number"&&"responseEnd"in H&&typeof H.responseEnd=="number"?H.responseEnd-H.requestStart:-1,handleCost:"leave_ts"in w&&"enter_ts"in w&&typeof w.leave_ts=="number"&&typeof w.enter_ts=="number"?w.leave_ts-w.enter_ts:-1}),uR(I),{gatewayInfo:JC(I,l),proxyInfo:O,url:l,resourceTimingInfo:Y}},w=>{var k;return w.gatewayInfo&&Ue.joinChooseServer(t.sid,{role:g,lts:m,succ:!0,csAddr:l,serverList:w.gatewayInfo.gatewayAddrs.map(I=>I.address),ec:null,opid:b,cid:w.gatewayInfo.cid.toString(),uid:w.gatewayInfo.uid.toString(),csIp:w.gatewayInfo.csIp,unilbsServerIds:p.toString(),isHttp3:o,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:w.gatewayInfo.res.detail&&w.gatewayInfo.res.detail[38],vid:(k=w.gatewayInfo)===null||k===void 0?void 0:k.vid,resourceTimingInfo:w.resourceTimingInfo?JSON.stringify(w.resourceTimingInfo):void 0}),w.proxyInfo&&Ue.joinWebProxyAP(t.sid,{lts:m,sucess:1,apServerAddr:l,turnServerAddrList:w.proxyInfo.addresses.map(I=>I.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:p.toString()}),!1},w=>w.code!==G.OPERATION_ABORTED&&(w.code===G.CAN_NOT_GET_GATEWAY_SERVER?w.data.retry:(Ue.joinWebProxyAP(t.sid,{lts:m,sucess:0,apServerAddr:l,turnServerAddrList:null,errorCode:w.code,eventType:t.cloudProxyServer,unilbsServerIds:p.toString(),extend:JSON.stringify({networkState:S})}),C.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),w),!0)),i)}const _4=(e,t,n,i,o,l)=>{const{sid:u,clientId:p,cloudProxyServer:m}=n,g=[],y=b=>{b.flag===4096?Ue.joinChooseServer(u,{role:n.role,lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:b.error.message,csIp:b.error.data&&b.error.data.csIp,unilbsServerIds:o.toString(),isHttp3:l,corssRegionTagReq:n.apRequestDetail}):b.flag!==1048576&&b.flag!==4194304&&b.flag!==4194310||Ue.joinWebProxyAP(u,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:b.error.code,eventType:m,unilbsServerIds:o.toString()})};if(e.response_body.forEach(b=>{const S=b.buffer.code;if(b.uri===23&&S===0&&!b.buffer.edges_services)if(b.buffer.flag===4194310)C.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),b.buffer.edges_services=[];else{const w={error:new ne(G.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:$("NO_EDGES_RETRY"),csIp:e.detail[502]}),flag:b.buffer.flag};g.push(w),y(w)}if(S!==0){const w=xp(S),k={error:new ne(G.CAN_NOT_GET_GATEWAY_SERVER,w.desc,{desc:w.desc,retry:w.retry,csIp:e.detail[502]}),flag:b.buffer.flag};b.buffer.flag===4194310?C.warning(k.error.toString()):g.push(k),y(k)}}),g.length)throw C.warning("[".concat(p||"sid-".concat(u.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(g.map(b=>"flag: ".concat(b.flag,", message: ").concat(b.error.message,", retry: ").concat(b.error.data.retry)).join(" | "))),new ne(G.CAN_NOT_GET_GATEWAY_SERVER,g.map(b=>"flag: ".concat(b.flag,", message: ").concat(b.error.message)).join(" | "),{retry:!!g.find(b=>b.error.data.retry),csIp:e.detail[502],desc:[...new Set(g.map(b=>{var S;return b==null||(S=b.error)===null||S===void 0||(S=S.data)===null||S===void 0?void 0:S.desc}).filter(b=>!!b))]})},uR=e=>{var t,n,i,o;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new ne(G.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if($("AP_AREA")&&((i=e.detail)!==null&&i!==void 0&&i[23]&&typeof((o=e.detail)===null||o===void 0?void 0:o[23])=="string"?p4(e.detail[23].toLowerCase()):p4()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const u=e.detail[19],p=u==null?void 0:u.split(";");for(let m=0;m<p.length;m++){var l;const g=Ts(l=p[m]).call(l);e.addresses[m]&&p&&(e.addresses[m].fingerprint=g)}}if($("GATEWAY_ADDRESS")&&$("GATEWAY_ADDRESS").length>0){C.debug("assign gateway address to",$("GATEWAY_ADDRESS"));const u=$("GATEWAY_ADDRESS").map(p=>{var m,g;const y=(m=(g=e.addresses.find(b=>b.ip===p.ip&&b.port===p.port))===null||g===void 0?void 0:g.fingerprint)!==null&&m!==void 0?m:"";return{ip:p.ip,port:p.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:p.fingerprint||y}});e.addresses=u}},hde=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const i=xp(n.buffer.code);throw new ne(G.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw C.debug("update ticket request received ap response without response body:",t),new ne(G.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},hR=(e,t,n)=>{const i=Math.floor(Math.random()*1e12),o=e.role==="host"?"1":e.role==="audience"?"2":void 0,l={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:dc(dc(dc({6:e.stringUid,11:t,12:$("USE_NEW_TOKEN")?"1":void 0},o?{17:o}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};l.request_bodies.forEach(p=>{e.multiIP&&e.multiIP.gateway_ip&&(p.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const u=new FormData;return u.append("request",JSON.stringify(l)),[u,i]},pde=(e,t)=>{const n=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(l=>({ip:l.ip,port:l.port}))}}]},o=new FormData;return o.append("request",JSON.stringify(i)),[o,n]};let Cp=0;function Rp(e){return xe.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const Zf=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:i,allFailedhandler:o,promisesCollector:l}=e,u=0;const p=t;let m,g=0;const y=async()=>{const b=(()=>{const S=u*p,w=S+p;return n.slice(S,w).map(i)})();l&&l.push(...b);try{m=await Rp(b)}catch(S){if(g+=p,u++,!(g>=n.length))return void await y();o(S)}b.forEach(S=>S.cancel())};return await y(),m},y4=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:i}=e;const o=t.length;let l=0;const u=async()=>{const p=n(t.shift());try{return await p}catch(m){if(l++,l>=o||i!=null&&i(m))throw m;return u()}};return u()};async function mde(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],o=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],l=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],u=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new xe((m,g)=>{let y;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:S=>{S.close(),clearTimeout(y),m(!0)},error:S=>{clearTimeout(y),m(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const b=[t,n,i,o,l,u];for(let S=0;S<b.length;S++){const w=new EncodedVideoChunk({type:S==0?"key":"delta",timestamp:33333*S,duration:33333,data:new Uint8Array(b[S])});try{await e.decode(w)}catch{return void m(!1)}}})(),y=setTimeout(()=>{m(!1)},5e3)})}async function NE(e,t,n,i){return{gatewayInfo:await async function(l,u,p,m){let g=null;const y=[],b=async()=>{const w=$("WEBCS_DOMAIN").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(O=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:Qf()})),k=m.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:w.map(O=>O.url)}),I=await Zf({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:w,asyncMapHandler:O=>(C.debug("[".concat(l.clientId,"] Connect to choose_server:"),O.url),f4(O,l,u,p)),allFailedhandler:O=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},k),O[0]},promisesCollector:y});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},k),I},S=async()=>{if(await vr(1e3),g!==null)return g;const w=$("WEBCS_DOMAIN_BACKUP_LIST").map(O=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:Qf()})),k=m.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:w.map(O=>O.url)}),I=await Zf({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:w,asyncMapHandler:O=>(C.debug("[".concat(l.clientId,"] Connect to backup choose_server:"),O.url),f4(O,l,u,p)),allFailedhandler:O=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},k),O[0]},promisesCollector:y});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},k),I};try{return g=await Rp([b(),S()]),y.length&&y.forEach(w=>w.cancel&&typeof w.cancel=="function"&&w.cancel()),g}catch(w){throw w[0]}}(e,t,n,i)}}async function E4(e,t,n,i,o){const l=e.cloudProxyServer;if(l==="disabled"){if(e.useLocalAccessPoint)return await NE(e,t,n,o);if($("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:S,proxyInfo:w}=await S4(e,t,n,o);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:S};const k=w.map(I=>({turnServerURL:I.address,tcpport:I.tcpport||qr.tcpport,udpport:I.udpport||qr.udpport,username:I.username||qr.username,password:I.password||qr.password,forceturn:!1,security:!0}));if(o.useP2P){var u;const I=(u=e.uid)!==null&&u!==void 0?u:S.uid,O="glb:".concat(I.toString()),W=await YT(O),H=w.map(Y=>({turnServerURL:Y.address,tcpport:Y.tcpport||qr.tcpport,udpport:Y.udpport||qr.udpport,username:O,password:W,forceturn:!1,security:!0}));k.push(...H)}return e.turnServer={mode:"manual",servers:k},{gatewayInfo:S}}return await NE(e,t,n,o)}const{proxyInfo:p,gatewayInfo:m}=await S4(e,t,n,o),g={gatewayInfo:m},y=p.map(S=>({turnServerURL:S.address,tcpport:l==="proxy3"?void 0:S.tcpport?S.tcpport:qr.tcpport,udpport:l==="proxy4"?void 0:S.udpport?S.udpport:qr.udpport,username:S.username||qr.username,password:S.password||qr.password,forceturn:l!=="proxy4",security:l==="proxy5"}));if(o.useP2P){var b;const S=(b=e.uid)!==null&&b!==void 0?b:m.uid,w="glb:".concat(S.toString()),k=await YT(w),I=p.map(O=>({turnServerURL:O.address,tcpport:l==="proxy3"?void 0:O.tcpport||qr.tcpport,udpport:l==="proxy4"?void 0:O.udpport||qr.udpport,username:w,password:k,forceturn:l!=="proxy4",security:l==="proxy5"}));y.push(...I)}return e.turnServer={mode:"manual",servers:y},C.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(l)),g}async function v4(e,t,n,i,o){const l=$("ACCOUNT_REGISTER").slice(0,$("AJAX_REQUEST_CONCURRENT"));let u=[];u=t.proxyServer?l.map(m=>"https://".concat(t.proxyServer,"/ap/?url=").concat(m+"/api/v1")):l.map(m=>"https://".concat(m,"/api/v1"));const p=o==null?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:u});try{const m=await async function(g,y,b,S,w){const k=Date.now(),I={sid:b.sid,opid:10,appid:b.appId,string_uid:y};let O=g[0];const W=await ma(()=>va(O+"".concat(O.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(H,Y)=>{if(H.code===0){if(H.uid<=0||H.uid>=Math.pow(2,32))throw C.error("Invalid Uint Uid ".concat(y," => ").concat(H.uid),H),Ue.reqUserAccount(I.sid,{lts:k,success:!1,serverAddr:O,stringUid:I.string_uid,uid:H.uid,errorCode:G.INVALID_UINT_UID_FROM_STRING_UID,extend:I}),new ne(G.INVALID_UINT_UID_FROM_STRING_UID);return Ue.reqUserAccount(I.sid,{lts:k,success:!0,serverAddr:O,stringUid:I.string_uid,uid:H.uid,errorCode:null,extend:I}),!1}const Q=xp(H.code);return Q.retry&&(O=g[(Y+1)%g.length]),Ue.reqUserAccount(I.sid,{lts:k,success:!1,serverAddr:O,stringUid:I.string_uid,uid:H.uid,errorCode:Q.desc,extend:I}),Q.retry},(H,Y)=>H.code!==G.OPERATION_ABORTED&&(Ue.reqUserAccount(I.sid,{lts:k,success:!1,serverAddr:O,stringUid:I.string_uid,uid:null,errorCode:H.code,extend:I}),O=g[(Y+1)%g.length],!0),w);if(W.code!==0){const H=xp(W.code);throw new ne(G.UNEXPECTED_RESPONSE,H.desc)}return W}(u,e,t,n,i);return o==null||o.recordJoinChannelService({status:"success",endTs:Date.now()},p),m.uid}catch(m){throw o==null||o.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},p),m}}async function fde(e,t,n){const i=$("ACCOUNT_REGISTER");let o=[];o=t.proxyServer?i.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):i.map(l=>"https://".concat(l,"/api/v1"));try{return await y4({referenceList:o,asyncMapHandler:u=>async function(p,m,g,y){const b=Date.now(),S={sid:g.sid,opid:10,appid:g.appId,string_uid:m};try{const w=await va(p+"".concat(p.indexOf("?")===-1?"?":"&","action=stringuid"),{data:S,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(w.code!==0){const k=xp(w.code);throw new ne(G.UNEXPECTED_RESPONSE,"preload sua error:".concat(k.desc),k)}if(w.uid<=0||w.uid>=Math.pow(2,32))throw new ne(G.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:b,url:p,req:S,uid:w.uid,elapse:Date.now()-b}}catch(w){throw w}}(u,e,t,n),closeFn:u=>u.code===G.OPERATION_ABORTED||u.code===G.UNEXPECTED_RESPONSE&&!u.data.retry})}catch(l){throw l}}async function gde(e,t,n){const i=$("CDS_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1?action=config")),o=i.map(m=>function(g,y,b,S){const w=Ft(),k={flag:64,cipher_method:0,features:dc(dc(dc(dc(dc({install_id:aC(),device:w.name,system:w.os,system_general:navigator.userAgent,vendor:y.appId,version:to,cname:y.cname,session_id:y.sid,proxyServer:y.proxyServer,sdk_type:ode.WEB_RTC,browser_name:w.name,browser_version:w.version,user_agent:navigator.userAgent,channel_name:y.cname},y.stringUid&&{string_uid:y.stringUid}),y.uid&&{uid:y.uid+""}),w.os&&{os_name:w.os}),w.osVersion&&{os_version:w.osVersion}),{},{detail:""})};return ma(()=>va(g,{data:k,timeout:1e3,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,I=>I.code!==G.OPERATION_ABORTED,S)}(m,e,t,n));let l=null,u=null,p={};try{l=await Rp(o)}catch(m){if(m.code===G.OPERATION_ABORTED)throw m;u=m}if(o.forEach(m=>m.cancel()),Ue.reportApiInvoke(e.sid,{name:Rn.REQUEST_CONFIG_DISTRIBUTE,options:{error:u,res:l}}).onSuccess(),l&&l.test_tags)try{p=function(m){if(!m.test_tags)return{};const g=m.test_tags,y=Object.keys(g),b={};return y.forEach(S=>{var w;const k=Ts(w=S.slice(4)).call(w),I=JSON.parse(g[S]),O=I[1];b[k]={tag:I[0]||"",value:O}}),b}(l)}catch{}return p}async function b4(e,t){const n=$("WEBCS_DOMAIN").concat($("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:Qf(),serviceIds:[er.CHOOSE_SERVER,er.CLOUD_PROXY_FALLBACK]}));try{return await y4({referenceList:n,asyncMapHandler:o=>async function(l,u,p){let m,{url:g,areaCode:y,serviceIds:b}=l;const S=Date.now(),[w,k]=hR(u,y,b);let I=Un.networkState;try{I&&Un.networkState===Rs.OFFLINE&&Un.onlineWaiter&&await xe.race([Un.onlineWaiter,vr(Zn.maxRetryTimeout)]),I=Un.networkState;const{data:O,headers:W}=await va(g,{data:w,cancelToken:p,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);m=W.http3==="1"?1:-1,(Z=>{const q=[];if(Z.response_body.forEach(ee=>{const ce=ee.buffer.code;if(ee.uri===23&&ce===0&&!ee.buffer.edges_services)if(ee.buffer.flag===4194310)ee.buffer.edges_services=[];else{const me={error:new ne(G.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:$("NO_EDGES_RETRY"),csIp:Z.detail[502]}),flag:ee.buffer.flag};q.push(me)}if(ce!==0){const me=xp(ce),Oe={error:new ne(G.CAN_NOT_GET_GATEWAY_SERVER,me.desc,{desc:me.desc,retry:me.retry,csIp:Z.detail[502]}),flag:ee.buffer.flag};ee.buffer.flag===4194310?C.warning(Oe.error.toString()):q.push(Oe)}}),q.length)throw new ne(G.CAN_NOT_GET_GATEWAY_SERVER,q.map(ee=>"flag: ".concat(ee.flag,", message: ").concat(ee.error.message)).join(" | "),{retry:!!q.find(ee=>ee.error.data.retry),csIp:Z.detail[502],desc:[...new Set(q.map(ee=>{var ce;return ee==null||(ce=ee.error)===null||ce===void 0||(ce=ce.data)===null||ce===void 0?void 0:ce.desc}).filter(ee=>!!ee))]})})(O);const Y=Kf(O,er.CHOOSE_SERVER),Q=Kf(O,er.CLOUD_PROXY_FALLBACK);return uR(Y),{gatewayInfo:JC(Y,g),proxyInfo:Q,opid:k,requestTime:S,url:g,isHttp3:m,elapse:Date.now()-S}}catch(O){throw O}}(o,e,t),closeFn:o=>o.code===G.OPERATION_ABORTED||o.code===G.CAN_NOT_GET_GATEWAY_SERVER&&!o.data.retry})}catch(i){throw i}}async function S4(e,t,n,i){const o=$("PROXY_SERVER_TYPE3"),l=(w,k,I)=>{let O=I||o;return Array.isArray(O)&&(O=k%2==0&&o[1]||o[0]),"https://".concat(O,"/ap/?url=").concat(w)};let u=null;const p=[],m=async()=>{const w=$("WEBCS_DOMAIN").slice(0,$("AJAX_REQUEST_CONCURRENT")).map((O,W)=>{let H;return H=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(O,"/api/v2/transpond/webrtc?v=2"),W,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):l("".concat(O,"/api/v2/transpond/webrtc?v=2"),W),{url:H,areaCode:Qf(),serviceIds:[er.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?er.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?er.CLOUD_PROXY:er.CLOUD_PROXY_FALLBACK]}}),k=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:w.map(O=>O.url)}),I=await Zf({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:w,asyncMapHandler:O=>(C.debug("[".concat(e.clientId,"] Connect to choose_server:"),O.url),g4(O,e,t,n)),allFailedhandler:O=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},k),O[0]},promisesCollector:p});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},k),I},g=async()=>{if(await vr(1e3),u!==null)return u;const w=$("WEBCS_DOMAIN_BACKUP_LIST").map((O,W)=>{let H;return H=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(O,"/api/v2/transpond/webrtc?v=2"),W,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):l("".concat(O,"/api/v2/transpond/webrtc?v=2"),W),{url:H,areaCode:Qf(),serviceIds:[er.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?er.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?er.CLOUD_PROXY:er.CLOUD_PROXY_FALLBACK]}}),k=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:w.map(O=>O.url)}),I=await Zf({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:w,asyncMapHandler:O=>(C.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),O.url),g4(O,e,t,n)),allFailedhandler:O=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},k),O[0]},promisesCollector:p});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},k),I};let y,b,S;try{({gatewayInfo:y,proxyInfo:b,url:S}=await Rp([m(),g()]))}catch(w){throw w[0]}if(p.length&&p.forEach(w=>w.cancel&&typeof w.cancel=="function"&&w.cancel()),!y||!b)throw new ne(G.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=S,e.cloudProxyServer!=="disabled"&&Array.isArray(o)&&S){const w=/^https?:\/\/(.+?)(\/.*)?$/.exec(S)[1];fe(o).call(o,w)&&(e.proxyServer=w,C.setProxyServer(w),Ue.setProxyServer(w))}return u={gatewayInfo:y,proxyInfo:await KV(b,y.uid)},u}async function _de(e,t,n){const i=$("UAP_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap")),o=i.map(l=>function(u,p,m,g){const y={command:"convergeAllocateEdge",sid:p.sid,appId:p.appId,token:p.token,ts:Date.now(),version:to,cname:p.cname,uid:p.uid.toString(),requestId:dR,seq:dR};dR+=1;const b={service_name:"tele_channel",json_body:JSON.stringify(y)};return ma(async()=>{const S=await va(u,{data:b,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(S.code!==0){const k=new ne(G.UNEXPECTED_RESPONSE,"cross channel ap error, code"+S.code,{retry:!0});throw C.error(k.toString()),k}const w=JSON.parse(S.json_body);if(w.code!==200){const k=new ne(G.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(w.code,", reason: ").concat(w.reason));throw C.error(k.toString()),k}if(!w.servers||w.servers.length===0){const k=new ne(G.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw C.error(k.toString()),k}return{vid:w.vid,workerToken:w.workerToken,addressList:($("CHANNEL_MEDIA_RELAY_SERVERS")||w.servers).map(k=>"wss://".concat(k.address.replace(/\./g,"-"),".").concat($("WORKER_DOMAIN"),":").concat(k.wss))}},void 0,S=>!!(S.code!==G.OPERATION_ABORTED&&S.code!==G.UNEXPECTED_RESPONSE||S.data&&S.data.retry),g)}(l,e,t,n));try{const l=await Rp(o);return o.forEach(u=>u.cancel()),l}catch(l){throw l[0]}}async function yde(e,t,n){let i=null;const o=[],l=async u=>{const p=$(u?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v2/transpond/webrtc?v=2"):"https://".concat(m,"/api/v2/transpond/webrtc?v=2"));return u&&(await vr(1e3),i!==null)?i:await Zf({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:m=>(C.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(u?"backup":""," choose_server:"),m),function(g,y,b,S){const[w]=pde(y,[er.CHOOSE_SERVER]);let k=Un.networkState;return ma(async()=>{k&&Un.networkState===Rs.OFFLINE&&Un.onlineWaiter&&await xe.race([Un.onlineWaiter,vr(S&&S.maxRetryTimeout||Zn.maxRetryTimeout)]),k=Un.networkState;const I=await va(g,{data:w,cancelToken:b,headers:{"Content-Type":"multipart/form-data;"}},!0);return hde(I,g)},()=>!1,I=>I.code!==G.OPERATION_ABORTED&&(I.code===G.UPDATE_TICKET_FAILED?I.data.retry:(C.warning("[".concat(y.clientId,"] update ticket network error, retry"),I),!0)),S)}(m,e,t,n)),allFailedhandler:m=>{throw m[0]},promisesCollector:o})};try{return i=await Rp([l(!1),l(!0)]),o.length&&o.forEach(u=>u.cancel&&typeof u.cancel=="function"&&u.cancel()),i}catch(u){throw u[0]}}function x4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function pR(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?x4(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x4(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Ede extends On{get isSuccess(){return!!this.configs}constructor(t,n){super(),D(this,"configs",void 0),D(this,"store",void 0),D(this,"joinInfo",void 0),D(this,"cancelToken",void 0),D(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),D(this,"interval",void 0),D(this,"mutex",void 0),D(this,"mutableParamsRead",!1),D(this,"configCache",{}),D(this,"limit_bitrate",void 0),this.mutex=new Ar("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),$("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},$("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Ue.reportApiInvoke(null,{options:void 0,name:Rn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:hn.TRACER}).onSuccess(JSON.stringify(ki))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void C.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await gde(this.joinInfo,this.cancelToken,this.retryConfig),C.debug("[config-distribute] get config distribute",JSON.stringify(t));const i=function(o){var l;const u=Wd(l=Object.keys(o).filter(g=>/^webrtc_ng_global_parameter/.test(g))).call(l);for(let g=0;g<u.length;g++)for(let y=u.length-1;y>g;y--){const b=u[y],S=o[b].value;if(typeof S.__priority=="number"){const w=S.__priority,k=u[y-1],I=o[k].value;if(typeof I.__priority=="number"){if(!(w>I.__priority))continue;{const O=b;u[y]=u[y-1],u[y-1]=O}}else{const O=b;u[y]=u[y-1],u[y-1]=O}}}const p=Date.now(),m={};return u.forEach(g=>{const y=o[g].value.__expires;y&&y<=p||(m[g]=o[g])}),m}(t);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const o=new ne(G.NETWORK_RESPONSE_ERROR,i);C.warning("[config-distribute] ".concat(o.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){jV(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(_a.UPDATE_BITRATE_LIMIT,t):this.emit(_a.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&pR({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},i=Object.keys(t),o=[];i.forEach(l=>{const u=t[l].value;n[l]=u;const p=u.__id;if(p&&this.configCache[l]&&this.configCache[l].__id===p)return;const m=u.__type,g=t[l].value,y=t[l].tag;let b=0;m?m===nU.REALTIME&&(b=1):Object.keys(g).some(S=>Object.prototype.hasOwnProperty.call(uC,S)||!VC()&&Object.prototype.hasOwnProperty.call(Hy,S)?(b=1,!0):void 0),o.push({tag:y,isApplied:b,feature:l,params:JSON.stringify(u)})}),o.forEach(l=>{let{tag:u,feature:p,params:m,isApplied:g}=l;this.store.sessionId&&Ue.abTest(this.store.sessionId,{intSucc:1,isApplied:g,tag:u,feature:p,params:m,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){C.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(o){const l={};return Object.keys(o).forEach(u=>{const p=o[u].value,m=p.__expires,g=p.__type;Object.keys(p).forEach(y=>{y==="__id"||y==="__type"||y==="__priority"||y==="__expires"||Object.prototype.hasOwnProperty.call(l,y)||(l[y]=pR(pR({value:p[y]},m&&{expires:m}),g&&{type:g}))})}),l}(t);try{var i;const o=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,o&&jV(o)&&this.handleBitrateLimit(o),this.limit_bitrate=o,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(p){try{const m=Date.now();Object.keys(p).forEach(g=>{const{value:y,type:b,expires:S}=p[g];S&&S<=m||((b===nU.REALTIME||Object.prototype.hasOwnProperty.call(uC,g))&&(ki[g]=y,en[g]=y,C.debug("Update realtime parameters from config distribute",g,y)),b||VC()||!Object.prototype.hasOwnProperty.call(Hy,g)||(ki[g]=y,en[g]=y,C.debug("Update gateway parameters from config distribute",g,y)))})}catch(m){C.error("Error update config immediately: ".concat(p),m.message)}}(n);const l=JSON.stringify(n),u=window.btoa(l);window.localStorage.setItem("websdk_ng_global_parameter",u),C.debug("Caching global parameters ".concat(l))}catch(o){C.error("Error caching global parameters:",o.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(i=>{switch(i){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(en,i)){const{value:l,expires:u}=t[i];if(u&&u<=n)return;ZT(en[i],l)||(ki[i]=l,en[i]=l,this.emit(_a.UPDATE_CLIENT_ROLE_OPTIONS,l),C.debug("Updating client role options: ".concat(JSON.stringify(l))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(en,i)){var o;const{value:l,expires:u}=t[i];if(u&&u<=n)return;typeof l=="number"&&fe(o=[0,1,4,5,6,7,8,9]).call(o,l)&&(ki[i]={value:l},en[i]=l,this.emit(_a.UPDATE_REMOTE_VIDEO_STREAM_TYPE,l),C.debug("Updating client remote stream type: ".concat(JSON.stringify(l))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(en,i)){const{value:l,expires:u}=t[i];if(u&&u<=n)return;ZT(en[i],l)||(ki[i]=l,en[i]=l,this.emit(_a.FALLBACK_TO_HLS,l),C.debug("Updating enable force hls: ".concat(JSON.stringify(l))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(en,i)){const{value:l,expires:u}=t[i];if(u&&u<=n)return;ZT(en[i],l)||(ki[i]=l,en[i]=l,this.emit(_a.UPDATE_VOS_CONFIGURE,l),C.debug("Updating vos configure: ".concat(JSON.stringify(l))))}}})}catch(n){C.error("Error handling global parameter config:",n.message)}}}class vde extends On{constructor(){super(...arguments),D(this,"resultStorage",new Map)}setLocalAudioStats(t,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(t,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(i))}setRemoteAudioStats(t,n){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(t,n,i){if($("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const o=this.resultStorage.get(t);if(!o)return;o.result.push(i);const l=t==="VIDEO_ENCODE_FAILED"?$("ENCODE_EXCEPTION_TIMES"):5;if(o.result.length>=l){var u;const p=fe(u=o.result).call(u,!0);o.isPrevNormal&&!p&&this.emit("exception",mR[t],t,n),!o.isPrevNormal&&p&&this.emit("exception",mR[t]+2e3,t+"_RECOVER",n),o.isPrevNormal=p,o.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof ur&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=Fs(n._encoderConfig.frameRate));const o=t.captureFrameRate;return!i||!o||!(i>10&&o<5||i<10&&i>=5&&o<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||fe(n=$("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof ur&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const mR={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},rs=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function w4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function yu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?w4(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w4(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class eg{constructor(t){D(this,"store",void 0),D(this,"onStatsException",void 0),D(this,"onUploadPublishDuration",void 0),D(this,"onStatsChanged",void 0),D(this,"onVideoCodecChanged",void 0),D(this,"localStats",new Map),D(this,"remoteStats",new Map),D(this,"updateStatsInterval",void 0),D(this,"trafficStats",void 0),D(this,"trafficStatsPeerList",[]),D(this,"uplinkStats",void 0),D(this,"exceptionMonitor",void 0),D(this,"p2pChannel",void 0),D(this,"scalabilityMode",Wy.L1T1),D(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new vde,this.exceptionMonitor.on("exception",(n,i,o)=>{this.onStatsException&&this.onStatsException(n,i,o)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ge.LocalAudioTrack)||yu({},_C)}getLocalVideoTrackStats(){return this.localStats.get(ge.LocalVideoTrack)||yu({},yC)}getRemoteAudioTrackStats(t){const n=(l,u)=>{if(!this.trafficStats)return u;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===l);return p&&(u.publishDuration=p.B_ppad+(Date.now()-this.trafficStats.timestamp)),u},i={};if(t){var o;const l=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.audioStats;l&&(i[t]=n(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[u,{audioStats:p}]=l;p&&(i[u]=n(u,p))});return i}getRemoteNetworkQualityStats(t){const n={};if(t){var i;const o=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;o&&(n[t]=o)}else Array.from(this.remoteStats.entries()).forEach(o=>{let[l,{networkStats:u}]=o;u&&(n[l]=u)});return n}getNetworkQuality(){let t=0,n=0;return this.trafficStats&&(t=EE(this.trafficStats.B_unq),n=EE(this.trafficStats.B_dnq)),{uplinkNetworkQuality:t,downlinkNetworkQuality:n}}getRemoteVideoTrackStats(t){const n=(l,u)=>{if(!this.trafficStats)return u;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===l);return p&&(u.publishDuration=p.B_ppvd+(Date.now()-this.trafficStats.timestamp)),u},i={};if(t){var o;const l=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.videoStats;l&&(i[t]=n(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[u,{videoStats:p}]=l;p&&(i[u]=n(u,p))});return i}getRTCStats(){let t=0,n=0,i=0,o=0;const l=this.localStats.get(ge.LocalAudioTrack);l&&(t+=l.sendBytes,n+=l.sendBitrate);const u=this.localStats.get(ge.LocalVideoTrack);u&&(t+=u.sendBytes,n+=u.sendBitrate);const p=this.localStats.get(ge.LocalVideoLowTrack);p&&(t+=p.sendBytes,n+=p.sendBitrate),this.remoteStats.forEach(g=>{let{audioStats:y,videoStats:b}=g;y&&(i+=y.receiveBytes,o+=y.receiveBitrate),b&&(i+=b.receiveBytes,o+=b.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:n,SendBytes:t,RecvBytes:i,RecvBitrate:o,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const o=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),l=o!=null&&o.videoSSRC?rs.measureFromSubscribeStart(this.store.clientId,o.videoSSRC):0,u=o!=null&&o.audioSSRC?rs.measureFromSubscribeStart(this.store.clientId,o.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,l>u?l:u),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&C.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,i){if(!t)return!1;const o=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,l=!i||n.framesDecodeCount>i.framesDecodeCount;return o||!l}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[i,o]=n;switch(i){case ge.LocalVideoTrack:case ge.LocalVideoLowTrack:{const p=o,m=yu({},yC),g=t.getStats(),y=t.getLocalMedia(i);if(g){const b=g.videoSend.find(S=>S.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(b){const S=t.getLocalVideoSize(),w=t.getEncoderConfig(ge.LocalVideoTrack);var l;(b.codec==="H264"||b.codec==="H265"||b.codec==="VP8"||b.codec==="VP9"||b.codec==="AV1X"||b.codec==="AV1")&&(m.codecType=b.codec,(p==null?void 0:p.codecType)!==b.codec&&((l=this.onVideoCodecChanged)===null||l===void 0||l.call(this,b.codec.toLocaleLowerCase()))),m.sendBytes=b.bytes,m.sendBitrate=p?8*Math.max(0,m.sendBytes-p.sendBytes):0,b.inputFrame?(m.captureFrameRate=b.inputFrame.frameRate,m.captureResolutionHeight=b.inputFrame.height,m.captureResolutionWidth=b.inputFrame.width):S&&(m.captureResolutionWidth=S.width,m.captureResolutionHeight=S.height),b.sentFrame?(m.sendFrameRate=b.sentFrame.frameRate,m.sendResolutionHeight=b.sentFrame.height,m.sendResolutionWidth=b.sentFrame.width):S&&(m.sendResolutionWidth=S.width,m.sendResolutionHeight=S.height),b.avgEncodeMs&&(m.encodeDelay=b.avgEncodeMs),w&&w.bitrateMax?m.targetSendBitrate=1e3*w.bitrateMax:b.targetBitrate&&(m.targetSendBitrate=b.targetBitrate),m.sendPackets=b.packets,m.sendPacketsLost=b.packetsLost,m.sendJitterMs=b.jitterMs,m.sendRttMs=b.rttMs,m.totalDuration=p?p.totalDuration+1:1,m.totalFreezeTime=p?p.totalFreezeTime:0,this.isLocalVideoFreeze(b)&&(m.totalFreezeTime+=1),b.scalabilityMode&&this.scalabilityMode!==b.scalabilityMode&&(C.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(b.scalabilityMode)),this.scalabilityMode=b.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(i,m),((p==null?void 0:p.sendResolutionWidth)!==m.sendResolutionWidth||(p==null?void 0:p.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&y&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,y.track,m);break}case ge.LocalAudioTrack:{const p=o,m=yu({},_C),g=t.getStats(),y=t.getLocalMedia(i);if(g){const b=g.audioSend.find(S=>S.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(b){if(b.codec!=="opus"&&b.codec!=="aac"&&b.codec!=="PCMU"&&b.codec!=="PCMA"&&b.codec!=="G722"||(m.codecType=b.codec),b.inputLevel)m.sendVolumeLevel=Math.round(32767*b.inputLevel);else{const S=t.getLocalAudioVolume();S&&(m.sendVolumeLevel=Math.round(32767*S))}m.sendBytes=b.bytes,m.sendPackets=b.packets,m.sendPacketsLost=b.packetsLost,m.sendJitterMs=b.jitterMs,m.sendRttMs=b.rttMs,m.sendBitrate=p?8*Math.max(0,m.sendBytes-p.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ge.LocalAudioTrack,m),m&&y&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,y.track,m);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var i,o;let[l,{videoStats:u,audioStats:p,videoPcStats:m}]=n;const g=p,y=u,b=m,S=yu({},gU),w=yu({},_U),k=yu({},ile),{audioTrack:I,videoTrack:O,audioSSRC:W,videoSSRC:H}=t.getRemoteMedia(l);let Y;Y=this.store.useP2P?t.getStats(!0):t.getStats();const Q=(i=Y)===null||i===void 0?void 0:i.audioRecv.find(ce=>ce.ssrc===W),Z=(o=Y)===null||o===void 0?void 0:o.videoRecv.find(ce=>ce.ssrc===H),q=this.trafficStats&&this.trafficStats.peer_delay.find(ce=>ce.peer_uid===l);if(Q&&(Q.codec!=="opus"&&Q.codec!=="aac"&&Q.codec!=="PCMU"&&Q.codec!=="PCMA"&&Q.codec!=="G722"||(S.codecType=Q.codec),Q.outputLevel?S.receiveLevel=Math.round(32767*Q.outputLevel):I&&(S.receiveLevel=Math.round(32767*I.getVolumeLevel())),S.receiveBytes=Q.bytes,S.receivePackets=Q.packets,S.receivePacketsLost=Q.packetsLost,S.receivePacketsDiscarded=Q.packetsDiscarded,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost),S.receiveBitrate=g?8*Math.max(0,S.receiveBytes-g.receiveBytes):0,S.totalDuration=g?g.totalDuration+1:1,S.totalFreezeTime=g?g.totalFreezeTime:0,S.freezeRate=S.totalFreezeTime/S.totalDuration,S.receiveDelay=Q.jitterBufferMs,S.totalDuration>10&&eg.isRemoteAudioFreeze(I)&&(S.totalFreezeTime+=1)),Z){var ee;Z.codec!=="H264"&&Z.codec!=="H265"&&Z.codec!=="VP8"&&Z.codec!=="VP9"&&Z.codec!=="AV1X"&&Z.codec!=="AV1"||(w.codecType=Z.codec),w.receiveBytes=Z.bytes,w.receiveBitrate=y?8*Math.max(0,w.receiveBytes-y.receiveBytes):0,w.decodeFrameRate=Z.decodeFrameRate<0?0:Z.decodeFrameRate,w.renderFrameRate=Z.decodeFrameRate<0?0:Z.decodeFrameRate,Z.outputFrame&&(w.renderFrameRate=Z.outputFrame.frameRate),Z.receivedFrame?(w.receiveFrameRate=Z.receivedFrame.frameRate,w.receiveResolutionHeight=Z.receivedFrame.height,w.receiveResolutionWidth=Z.receivedFrame.width):O&&(w.receiveResolutionHeight=O._videoHeight||0,w.receiveResolutionWidth=O._videoWidth||0),Z.framesRateFirefox!==void 0&&(w.receiveFrameRate=Math.round(Z.framesRateFirefox)),w.receivePackets=Z.packets,w.receivePacketsLost=Z.packetsLost,w.packetLossRate=w.receivePacketsLost/(w.receivePackets+w.receivePacketsLost);const ce=y?y.totalFreezeTime:0,me=y?y.totalDuration:0;w.totalDuration=y?y.totalDuration+1:1,w.totalFreezeTime=(ee=Z.totalFreezesDuration)!==null&&ee!==void 0?ee:ce||0,w.receiveDelay=Z.jitterBufferMs||0;const Oe=!!H&&t.getRemoteVideoIsReady(H);Z.totalFreezesDuration===void 0&&O&&Oe&&eg.isRemoteVideoFreeze(O,Z,b)&&(w.totalFreezeTime+=1),w.freezeRate=Math.max(0,Math.min((w.totalFreezeTime-ce)/(w.totalDuration-me),1))}q&&(S.end2EndDelay=q.B_ad,w.end2EndDelay=q.B_vd,S.transportDelay=q.B_ed,w.transportDelay=q.B_ed,S.currentPacketLossRate=q.B_ealr4/100,w.currentPacketLossRate=q.B_evlr4/100,k.uplinkNetworkQuality=q.B_punq?q.B_punq:0,k.downlinkNetworkQuality=q.B_pdnq?q.B_pdnq:0),this.remoteStats.set(l,{audioStats:S,videoStats:w,videoPcStats:Z,networkStats:k}),I&&this.exceptionMonitor.setRemoteAudioStats(I,S),O&&this.exceptionMonitor.setRemoteVideoStats(O,w)})}}class T4{constructor(){D(this,"destChannelMediaInfos",new Map),D(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){LV(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){LV(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){hE(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function C4(e){if(!(e instanceof T4))return new ne(G.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new ne(G.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new ne(G.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Fl{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){D(this,"uid",void 0),D(this,"_uintid",void 0),D(this,"_trust_in_room_",!0),D(this,"_trust_audio_enabled_state_",!0),D(this,"_trust_video_enabled_state_",!0),D(this,"_trust_audio_mute_state_",!0),D(this,"_trust_video_mute_state_",!0),D(this,"_audio_muted_",!1),D(this,"_video_muted_",!1),D(this,"_audio_enabled_",!0),D(this,"_video_enabled_",!0),D(this,"_audio_added_",!1),D(this,"_video_added_",!1),D(this,"_is_pre_created",!1),D(this,"_video_pre_subscribed",!1),D(this,"_audio_pre_subscribed",!1),D(this,"_trust_video_stream_added_state_",!0),D(this,"_trust_audio_stream_added_state_",!0),D(this,"_audioTrack",void 0),D(this,"_videoTrack",void 0),D(this,"_dataChannels",[]),D(this,"_audioSSRC",void 0),D(this,"_videoSSRC",void 0),D(this,"_audioOrtc",void 0),D(this,"_videoOrtc",void 0),D(this,"_cname",void 0),D(this,"_rtxSsrcId",void 0),D(this,"_videoMid",void 0),D(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function R4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function fR(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?R4(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R4(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const bde=e=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(e?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),AE="9",gR=2e4,IE=4e4;let N4=class{get localCapabilities(){return xn(this._localCapabilities)}get rtpCapabilities(){return xn(this._rtpCapabilities)}get candidates(){return xn(this._candidates)}get iceParameters(){return xn(this._iceParameters)}get dtlsParameters(){return xn(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3];D(this,"sessionDesc",void 0),D(this,"_localCapabilities",void 0),D(this,"_rtpCapabilities",void 0),D(this,"_candidates",void 0),D(this,"_originCandidates",void 0),D(this,"_iceParameters",void 0),D(this,"_isUseExtmapAllowMixed",void 0),D(this,"_isUseLocalCodecs",void 0),D(this,"_isUseDataChannel",void 0),D(this,"_dtlsParameters",void 0),D(this,"setup",void 0),D(this,"currentMidIndex",void 0),D(this,"cname",void 0),D(this,"useLocalCodecsMids",[]),D(this,"preloadSsrcs",[]),D(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=n,this._isUseDataChannel=i,e=xn(e);const{iceParameters:o,dtlsParameters:l,candidates:u,rtpCapabilities:p,setup:m,localCapabilities:g,cname:y}=e;this._rtpCapabilities=p,this._candidates=u,this._originCandidates=xn(u),this._iceParameters=o,this._dtlsParameters=l,this._localCapabilities=g,this.setup=m,this.cname=y,[this.sessionDesc]=this.updateRemoteRTPCapabilities(p),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every(t=>{var n;return fe(n=this.preloadSsrcs).call(n,t)})}preloadRemoteMedia(e){let t=0;const n=[],i=[];for(;e>0;){const o=[fR({ssrcId:IE+t},$("USE_SUB_RTX")?{rtx:IE+t+1}:{})],l="".concat(IE+t,"_").concat(gR+t),{ssrcs:u,ssrcGroups:p}=qf(o,this.cname,$("SYNC_GROUP")?l:void 0),m=this.preCreateOrRecycleSendMedia("video",u,p,void 0),g=[{ssrcId:gR+t}],y="".concat(IE+t,"_").concat(gR+t),{ssrcs:b,ssrcGroups:S}=qf(g,this.cname,$("SYNC_GROUP")?y:void 0),w=this.preCreateOrRecycleSendMedia("audio",b,S,void 0);e--,t+=2,n.push(m,w),i.push(u[0].ssrcId,b[0].ssrcId)}return this.useLocalCodecsMids.push(...n),this.preloadSsrcs=i,{mids:n,preSSRCs:i,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,n,i){const o=this.rtpCapabilities.send.videoCodecs,l=this._isUseLocalCodecs||o.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;C.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);const u=e===Me.VIDEO?l.videoCodecs:l.audioCodecs,p=e===Me.VIDEO?l.videoExtensions:l.audioExtensions;this.currentMidIndex+=1;const m="".concat(this.currentMidIndex);let g={media:{mediaType:e,port:AE,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};return g=this.mungSendMediaDesc(g,i),this.sessionDesc.mediaDescriptions.push(g),this.updateBundleMids(),m}toString(){return Gc(this.sessionDesc)}send(e,t,n,i){const{ssrcs:o,ssrcGroups:l}=qf(t,this.cname,$("SYNC_GROUP")?n:void 0),u=this.findPreloadMediaDesc(o);if(u){if(Sn()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,u.attributes.mid),i&&(i.twcc||i.remb)){const p=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(u,i),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{const p=this.findAvailableMediaIndex(e,o);let m;return p===-1||p===1&&(Nr()||function(){const g=Ft();return!(g.name!==Ht.CHROME||!g.osVersion)&&Number(g.version)<=90}()||pa(143)||Ol(143)||$("RESERVE_MID_1_MLINE")||$("ENABLE_ENCODED_TRANSFORM")&&$c())||p===0&&!function(g){const y=Ft();return!(y.name!==Ht.FIREFOX||!y.osVersion)&&Number(y.version)===g}(138)&&$("USE_SUB_RTX")||x5()?(m=this.createOrRecycleSendMedia(e,o,l,"sendonly",i),this.updateBundleMids()):(m=xn(this.sessionDesc.mediaDescriptions[p]),m.attributes.direction="sendonly",m.attributes.ssrcs=o,m.attributes.ssrcGroups=l,this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(m,i)),Sn()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,m.attributes.mid),{mid:m.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map(o=>{let{kind:l,ssrcMsg:u,mslabel:p}=o;return this.send(l,u,p)}),n=[];let i=!1;return t.forEach(o=>{let{mid:l,needExchangeSDP:u}=o;u&&(i=!0),n.push(l)}),{mids:n,needExchangeSDP:i}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.mid==="0"||Sn()||x5()?n.attributes.ssrcs=[]:(n.attributes.ssrcs=[],n.attributes.direction="inactive",n.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>fe(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>fe(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}receive(e,t,n,i){e.forEach((o,l)=>{this.createOrRecycleRecvMedia(o,[],"recvonly",t,n,i[l])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||Ns((n=this._isUseExtmapAllowMixed,this._isUseDataChannel?bde(n):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(n?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var n;this._rtpCapabilities=e;let i=!1;const o=this.rtpCapabilities.send,l=this.localCapabilities.send,u=this.localCapabilities.recv,p=u.videoCodecs,m=u.audioCodecs,g=u.videoExtensions,y=u.audioExtensions;for(const k of t.mediaDescriptions){var b;if(k.attributes.direction!=="sendonly"||typeof k.attributes.mid!="string"||!fe(b=this.useLocalCodecsMids).call(b,k.attributes.mid)){if(i=!0,k.attributes.iceUfrag=this._iceParameters.iceUfrag,k.attributes.icePwd=this._iceParameters.icePwd,k.attributes.fingerprints=this._dtlsParameters.fingerprints,k.attributes.candidates=this._candidates,k.attributes.setup=this.setup,k.media.mediaType==="application"&&(k.attributes.sctpPort="5000"),k.media.mediaType==="video")if(this._isUseLocalCodecs&&k.attributes.direction==="sendonly"){var S;k.media.fmts=p.map(O=>O.payloadType.toString(10)),k.attributes.payloads=p,k.attributes.extmaps=g;const I=k.attributes.mid;typeof I!="string"||fe(S=this.useLocalCodecsMids).call(S,I)||this.useLocalCodecsMids.push(I)}else if(o.videoCodecs.length===0){const I=l.videoCodecs.filter(O=>{var W,H;return(W=O.rtpMap)===null||W===void 0?void 0:fe(H=W.encodingName.toLowerCase()).call(H,"vp8")});I.length===0&&I.push(l.videoCodecs[0]),k.media.fmts=I.map(O=>O.payloadType.toString(10)),k.attributes.payloads=I,k.attributes.extmaps=[]}else k.media.fmts=o.videoCodecs.map(I=>I.payloadType.toString(10)),k.attributes.payloads=o.videoCodecs,k.attributes.extmaps=o.videoExtensions;if(k.media.mediaType==="audio")if(this._isUseLocalCodecs&&k.attributes.direction==="sendonly"){var w;k.media.fmts=m.map(O=>O.payloadType.toString(10)),k.attributes.payloads=m,k.attributes.extmaps=y;const I=k.attributes.mid;typeof I!="string"||fe(w=this.useLocalCodecsMids).call(w,I)||this.useLocalCodecsMids.push(I)}else if(o.audioCodecs.length===0){const I=l.audioCodecs.filter(O=>{var W,H;return(W=O.rtpMap)===null||W===void 0?void 0:fe(H=W.encodingName.toLowerCase()).call(H,"opus")})||[l.audioCodecs[0]];k.media.fmts=I.map(O=>O.payloadType.toString(10)),k.attributes.payloads=I,k.attributes.extmaps=[]}else k.media.fmts=o.audioCodecs.map(I=>I.payloadType.toString(10)),k.attributes.payloads=o.audioCodecs,k.attributes.extmaps=o.audioExtensions,Tp(k)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,i]}updateCandidates(e){const t=this._originCandidates.filter(i=>i.transport==="udp"),n=[];if(t.forEach(i=>{n.push(fR(fR({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),t.length!==0){switch(e){case Ir.TCP_RELAY:this._candidates=n;break;case Ir.UDP_TCP_RELAY:case Ir.RELAY:this._candidates=[...t,...n];break;default:this._candidates=t}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(e){e=xn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(Sn()){if(i){const o=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(o||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!o||o!==n.attributes.mid)}return!1}return i})}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if(n.media.mediaType==="application")return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:AE,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,i,o,l){const u=e._mediaStreamTrack.kind,p=this.rtpCapabilities.recv,m=Jf(u,p,this.localCapabilities.send,u===Me.VIDEO?i:o),g=u===Me.VIDEO?p.videoExtensions:p.audioExtensions;this.currentMidIndex+=1;const y="".concat(this.currentMidIndex);let b={media:{mediaType:u,port:AE,protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};b=this.mungRecvMediaDsec(b,e,l);const S=this.findFirstClosedMedia(u);if(S){const w=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[w]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}updateRemoteDtlsParameters(e){const t=new Set(this._dtlsParameters.fingerprints.map(o=>o.fingerprint)),n=new Set(e.map(o=>o.fingerprint));let i=!1;t.size!==n.size&&(i=!0);for(const o of t)n.has(o)||(i=!0);return i}updateRemoteCodec(e,t,n){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(b=>b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").filter(b=>{var S;return fe(S=Object.keys(ou)).call(S,b)}))],o=new Set(t);if(i.every(b=>o.has(b)))return C.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const l=this._rtpCapabilities.recv.videoCodecs.filter(b=>t.some(S=>{var w;return fe(w=b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").call(w,S)}));if(l.length===0)return C.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(t)),!1;const u=[...new Set(l.map(b=>b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||""))];let p;if(C.debug("updateRemoteCodec, from ".concat(i," to ").concat(u)),e.length===0)p=this.sessionDesc.mediaDescriptions.filter(b=>b.media.mediaType==="video"&&b.attributes.direction==="recvonly");else if(p=this.sessionDesc.mediaDescriptions.filter(b=>b.attributes.mid&&b.media.mediaType==="video"&&fe(e).call(e,b.attributes.mid)&&b.attributes.direction==="recvonly"),p.length!==e.length)return C.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if($("USE_PUB_RTX")||$("USE_SUB_RTX")){const b=Vl(l,this.rtpCapabilities.recv.videoCodecs);l.push(...b)}this._rtpCapabilities.recv.videoCodecs=l;const m=this.localCapabilities.send,g=this.rtpCapabilities.recv,y=Jf(Me.VIDEO,g,m,n);return p.forEach(b=>{const S=y.map(w=>w.payloadType.toString(10));C.debug("updateRemoteCodec mid: ".concat(b.attributes.mid,", from"),b.attributes.payloads,"to",y),b.attributes.payloads=y,b.media.fmts=S}),C.debug("updateRemoteCodec success, mids: ".concat(e,", codecs: ").concat(t,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(e,t,n,i,o){const l=this.rtpCapabilities.send.videoCodecs,u=this._isUseLocalCodecs||l.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,p=e===Me.VIDEO?u.videoCodecs:u.audioCodecs,m=e===Me.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const g="".concat(this.currentMidIndex);let y={media:{mediaType:e,port:AE,protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};y=this.mungSendMediaDesc(y,o);const b=this.findFirstClosedMedia(e);if(b){const S=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[S]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,n){const i=xn(e);return eR(i),_u(i,t),tR(i,t),n4(i),SE(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=xn(e);return n.attributes&&n.attributes.payloads&&Array.isArray(n.attributes.payloads)&&n.attributes.payloads.length>0&&n.attributes.payloads.forEach(i=>{i.rtpMap&&i.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&$("ENABLE_DOWN_SPS_PPS")&&(i.fmtp&&i.fmtp.parameters||(i.fmtp={parameters:{}}),i.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),SE(n,t,this.localCapabilities.recv),Tp(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Sn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function A4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Yc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?A4(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A4(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var Np=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Np||{});const OE=new Map;function I4(e,t,n,i){let{scale:o}=e;if(o===0&&i===Np.UP||o>=t.length-1&&i===Np.DOWN)return e;let l=Yc(Yc({},e),{},{scale:i===Np.DOWN?++o:--o});switch(n){case"maintain-framerate":l=Yc(Yc({},l),t[o].motion);break;case"maintain-resolution":l=Yc(Yc({},l),t[o].detail);break;case"balanced":l=Yc(Yc({},l),t[o].balanced)}return l}function O4(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:P4(t)};OE.set(e,n)}else OE.delete(e)}function P4(e){const t=Yc({},e),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:o,bitrateMin:l}=t,{MIN_FRAME_RATE:u,MAX_THRESHOLD_FRAMERATE:p,MAX_SCALE:m,BITRATE_MIN_THRESHOLD:g,BITRATE_MAX_THRESHOLD:y,BWE_SCALE_UP_THRESHOLD:b,BWE_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_DOWN_THRESHOLD:w,PERF_SCALE_UP_THRESHOLD:k,BALANCE_BITRATE_FACTOR:I,BALANCE_FRAMERATE_FACTOR:O,BALANCE_RESOLUTION_FACTOR:W,MOTION_RESOLUTION_FACTOR:H,MOTION_BITRATE_FACTOR:Y,DETAIL_FRAMERATE_FACTOR:Q,DETAIL_BITRATE_FACTOR:Z}=lC,q=Math.min(t.frameRate,p),ee=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(S,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(w,1)*q),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:l},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:l},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:l}}];for(let ce=1;ce<=m;ce++){const me={bwe_up:Math.round(Math.pow(b,ce)*n),bwe_down:Math.round(Math.pow(S,ce+1)*n),fps_up:Math.round(Math.pow(k,ce)*q),fps_down:Math.round(Math.pow(w,ce+1)*q)},Oe={scaleResolutionDownBy:o/Math.pow(W,ce),frameRate:Math.max(Math.round(Math.pow(O,ce)*i),u),bitrateMax:Math.max(Math.round(Math.pow(I,ce)*n),y),bitrateMin:Math.max(Math.round(Math.pow(I,ce)*l),g)},ot={scaleResolutionDownBy:o/Math.pow(H,ce),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(Y,ce)*n),y),bitrateMin:Math.max(Math.round(Math.pow(Y,ce)*l),g)},it={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Q,ce)*i),u),bitrateMax:Math.max(Math.round(Math.pow(Z,ce)*n),y),bitrateMin:Math.max(Math.round(Math.pow(Z,ce)*l),g)};ee.push({scale:ce,threshold:me,balanced:Oe,motion:ot,detail:it})}return ee}function Sde(e,t,n,i,o,l){const u=OE.get(e)||{overUse:0,underUse:0,adaptationList:P4(o)},{adaptationList:p}=u;OE.set(e,u);const{OVERUSE_TIMES_THRESHOLD:m,UNDERUSE_TIMES_THRESHOLD:g}=lC,{scale:y}=i;let b,S;return typeof t=="number"&&t>0&&function(w,k,I,O){if(k>=I.length)return!1;let{threshold:{fps_down:W}}=I[k];return $("FORCE_AG_HIGH_FRAMERATE")&&O==="maintain-framerate"&&(W=I[0].threshold.fps_down),w<W}(t,y,p,l)&&(u.overUse++,S=op.CPU,u.overUse>m)||typeof n=="number"&&n>0&&function(w,k,I){if(k>=I.length)return!1;const{threshold:{bwe_down:O}}=I[k];return w<O}(n,y,p)&&(u.overUse++,S=op.BANDWIDTH,u.overUse>m)?(u.overUse=0,u.underUse=0,b=I4(i,p,l,Np.DOWN),[b,S]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(w,k,I,O){if(k===0)return;let{threshold:{fps_up:W}}=I[k];return $("FORCE_AG_HIGH_FRAMERATE")&&O==="maintain-framerate"&&(W=I[1].threshold.fps_up),w>W}(t,y,p,l)&&function(w,k,I){if(k===0)return;const{threshold:{bwe_up:O}}=I[k];return w>O}(n,y,p)&&(u.underUse++,u.underUse>g&&(u.overUse=0,u.underUse=0,b=I4(i,p,l,Np.UP),b.scale===0&&(S=op.NONE))),[b,S])}function D4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function _R(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?D4(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D4(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function k4(e){var t;return!!$("ENABLE_AG_ADAPTATION")&&!!(e instanceof tE||fe(t=e._hints).call(t,Xt.CUSTOM_TRACK))&&(!!$("FORCE_SUPPORT_AG_ADAPTATION")||!!(b5(14,0)&&S5(17,4)||v5(14)&&WT(17,4)))}const PE=new Map;function L4(e,t,n,i,o,l){if(Ap(e,n),o(t),i!=="balanced"&&i!=="maintain-framerate"&&i!=="maintain-resolution")return;let u=-1;O4(e,t);const p=window.setInterval(()=>{const g=PE.get(e);if(!$("ENABLE_AG_ADAPTATION")||!g)return Ap(e,n),void o(t);const y=l();if(y.sendPackets>0&&y.OutgoingAvailableBandwidth>0){if(u===-1)return void(u=Date.now());if(Date.now()-u<1e3)return;const b=y.sendFrameRate,S=y.OutgoingAvailableBandwidth,[w,k]=Sde(e,b,S,g.adaptationConfig,t,i);k&&(n.qualityLimitationReason=k),w&&g.adaptationConfig.scale!==w.scale&&(C.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,`
           sendFps `).concat(b,", bwe ").concat(S,", switch from ").concat(g.adaptationConfig.scale," to ").concat(w.scale," ")),g.adaptationConfig=_R(_R({},g.adaptationConfig),w),o(w))}},$("CHECK_LOCAL_STATS_INTERVAL")),m=_R({},t);PE.set(e,{timer:p,adaptationConfig:m,originConfig:t,adaptationFunc:o}),C.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(i))}function Ap(e,t){const n=PE.get(e);if(n){const{timer:i}=n;window.clearTimeout(i),PE.delete(e)}t.qualityLimitationReason=op.NONE,O4(e)}function xde(e,t){var n;let i;switch(t){case ge.LocalAudioTrack:i=tn.Audio;break;case ge.LocalVideoTrack:i=fe(n=e._hints).call(n,Xt.SCREEN_TRACK)?tn.Screen:tn.High;break;case ge.LocalVideoLowTrack:i=tn.Low}return i}function yR(e){const t=It();if(e.some(n=>n._bypassWebAudio))throw new oe(G.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new oe(G.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function ER(e,t){yR(e);const n=new ur;return e.forEach(i=>n.addAudioTrack(i)),n}const wde=!It().supportUnifiedPlan||$("CHROME_FORCE_PLAN_B")&&nc();function tg(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.useDcSignal)return n={spec:t,store:e},Ea("DataChannelConnection").create(n);var n;return wde?function(o){return Ea("PlanBConnection").create(o)}({spec:t,store:e}):new Bi(t,e)}function vR(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function bR(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Zd(e.turnServer.servers))return!1;if($("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var jt;function M4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function ba(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?M4(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M4(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Bi=(jt=class Vu extends gE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return fe(n=Object.keys(ou)).call(n,t)}))]}constructor(t,n){super(t,n),D(this,"id",Zt(5,"connection-")),D(this,"store",void 0),D(this,"peerConnection",void 0),D(this,"forceTurn",!1),D(this,"remoteSDP",void 0),D(this,"initialOffer",void 0),D(this,"transportEventReceiver",void 0),D(this,"statsFilter",void 0),D(this,"extension",{useXR:$("USE_XR")}),D(this,"localCapabilities",void 0),D(this,"remoteCodecs",void 0),D(this,"localCandidateCount",0),D(this,"allCandidatesReceived",!1),D(this,"isPreallocation",!1),D(this,"isPreRender",!1),D(this,"preMediaMap",new Map),D(this,"dataStreamChannelMap",new Map),D(this,"establishPromise",void 0),D(this,"recoveredDataChannelIds",[]),D(this,"currentDataChannelId",1),D(this,"supportAV1RtpSpec",!1),D(this,"mutex",void 0),D(this,"qualityLimitationReason",op.NONE),D(this,"isFirstConnected",!1),this.store=n,this.forceTurn=bR(t),this.mutex=new Ar("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Vu.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=Gy(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,Sn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void C.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const l=this.remoteSDP.toString();o==null||o(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else C.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=cc(n.sdp),o=await rR({filterRTX:!$("USE_PUB_RTX")&&!$("USE_SUB_RTX"),filterVideoFec:$("FILTER_VIDEO_FEC"),filterAudioFec:$("FILTER_AUDIO_FEC"),filterVideoCodec:$("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:$("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:$("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Xf(o),this.initialOffer=n,$("ENABLE_SVC")&&this.store.codec=="av1"){const u=await r4();var t;u&&(this.supportAV1RtpSpec=!0,(t=o.send)===null||t===void 0||t.videoExtensions.push(u))}let l;return n.sdp&&xE(n.sdp)&&(l=xn(o),qV(l)),ba(ba({},i),{},{rtpCapabilities:l||o,offerSDP:n.sdp})}catch(n){throw new oe(G.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&xE(this.initialOffer.sdp)&&XV(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new N4(ba(ba({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!$("ENABLE_PRE_SUB_WITH_PRE_PC")||!$("PRE_USE_LOCAL_CODECS"))&&Bf(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const n=this.remoteSDP.toString(),i=sR(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(i||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o==null||o(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),Bf(this.store))if(t.preallocation&&$("ENABLE_PRE_SUB_WITH_PRE_PC")){const u=$("PRE_SUB_NUM"),{mids:p,preSSRCs:m}=this.remoteSDP.preloadRemoteMedia(u);await Zs(this.peerConnection,this.remoteSDP,this.extension),C.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(m)),this.presetMedia(p,m)}else{const{preSSRCs:u=[]}=t,p=u.map(g=>g.ssrcMsg[0].ssrcId);if(u.length===0)return;const{mids:m}=this.remoteSDP.batchSend(u.map(g=>Object.assign({},g)));await Zs(this.peerConnection,this.remoteSDP,this.extension),C.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(p)),this.presetMedia(m,p)}}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}presetMedia(t,n){t.forEach((i,o)=>{this.peerConnection.getTransceivers().forEach(l=>{if(l.mid!=null&&i===l.mid&&l.receiver.track){const u=l.receiver.track;let p;u.kind==="video"&&$("ENABLE_PRE_RENDER")&&(p=new eE({trackId:"track-".concat(u.kind,"-unknown-").concat(this.store.clientId,"_").concat(Zt(5,""))},!0),p.updateVideoTrack(u),p.onFirstVideoFrameRender=()=>{var m;const g=this.preMediaMap.get(n[o]);g&&(g.firstVideoRender=Date.now()),(m=this.onFirstVideoRender)===null||m===void 0||m.call(this,n[o])},p.onVideoBufferReady=()=>{var m;(m=this.onFirstVideoBufferReady)===null||m===void 0||m.call(this,n[o])},p.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(n[o],{mid:i,track:u,player:p,transceiver:l})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:i}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const u=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||u}const{preSSRCs:o=[]}=t,l=o.map(u=>u.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(l)){const u=[],p=[];if(Array.from(this.preMediaMap.entries()).every(m=>{let[g,{mid:y,player:b,track:S}]=m;return u.push(y),p.push(g),this.preMediaMap.delete(g),b&&b.destroy(),!0}),u.length>0&&(this.remoteSDP.stopSending(u),await Zs(this.peerConnection,this.remoteSDP,this.extension),C.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(p)),Ue.reportApiInvoke(this.store.sessionId,{name:Rn.PRELOAD_MEDIA_FAILED,options:[o,p],tag:hn.TRACER}).onSuccess()),o.length>0){const{mids:m}=this.remoteSDP.batchSend(o.map(g=>Object.assign({},g)));await Zs(this.peerConnection,this.remoteSDP,this.extension),C.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(l)),this.presetMedia(m,l)}}n?(await Zs(this.peerConnection,this.remoteSDP,this.extension),C.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):C.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,i){var o=this;return Ls(function*(){const l=yield Tt(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=[],p=zf();t.forEach(O=>{const W=o.peerConnection.addTransceiver(O._mediaStreamTrack,ba({direction:"sendonly"},O.trackMediaType==="video"&&o.supportAV1RtpSpec&&p?{sendEncodings:[{scalabilityMode:p}]}:{}));u.push(W),O._updateRtpTransceiver(W)}),Sn()&&$("SIMULCAST")===!0&&(yield Tt(o.applySimulcastForFirefox(u,t)));const m=yield Tt(o.peerConnection.createOffer()),g=o.remoteSDP.predictReceivingMids(t.length),y=o.mungSendOfferSDP(m.sdp,t,g),b=Ns(y),S=g.map(O=>{const W=b.mediaDescriptions.find(H=>H.attributes.mid===O);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return ZC(W,$("USE_PUB_RTX"))});let w;try{w=yield S}catch(O){w=[],o.remoteSDP.receive(t,n,i,w);const W=o.remoteSDP.toString();throw yield Tt(o.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield Tt(o.peerConnection.setRemoteDescription({type:"answer",sdp:W})),yield Tt(o.stopSending(g,!0)),O}o.remoteSDP.receive(t,n,i,w);const k=o.remoteSDP.toString(),I=o.logSDPExchange(y,"offer","local","send");return yield Tt(o.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield Tt(o.applySimulcastEncodings(u,t)),yield Tt(o.applySendEncodings(u,t)),I==null||I(k),yield Tt(o.peerConnection.setRemoteDescription({type:"answer",sdp:k})),u.map((O,W)=>{const H=g[W];return{localSSRC:S[W],id:H,transceiver:O}})}catch(u){throw u instanceof oe?u:new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{l()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")C.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:$("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}n.forEach(l=>{l._updateOriginDataChannel(i)});const{needExchangeSDP:o}=this.remoteSDP.sendDataChannel();if(o){const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const u=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(u),C.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else C.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof oe?i:new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof oe?n:new oe(G.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map(m=>{var g;Ap(this.id+m.mid,this),m.direction="inactive",(g=m.stop)===null||g===void 0||g.call(m)});const l=await this.peerConnection.createOffer(),u=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const p=this.remoteSDP.toString();u==null||u(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(o){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:u}=this.remoteSDP.send(t,n,i,o);u&&(await Zs(this.peerConnection,this.remoteSDP,this.extension),C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const p=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!p)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,id:l,transceiver:p}}catch(l){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);return i&&(await Zs(this.peerConnection,this.remoteSDP,this.extension),C.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(o=>{const l=this.peerConnection.getTransceivers().find(u=>u.mid===o);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:o,transceiver:l}})}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(l=>{Array.from(this.preMediaMap.entries()).some(u=>{let[p,{mid:m,player:g}]=u;if(m===l)return this.preMediaMap.delete(p),g&&g.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(u=>{u.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();o==null||o(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(u,p)=>{u.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString();o==null||o(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Ls(function*(){const i=yield Tt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const o=It().supportPCSetConfiguration,l=$("FORCE_TURN_TCP")||n.forceTurn;if(t===Ir.RELAY&&!o)return;if(o&&!l){const b=t===Ir.RELAY?"relay":"all",S=n.peerConnection.getConfiguration();S.iceTransportPolicy!==b&&(C.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(b,"]")),S.iceTransportPolicy=b,n.peerConnection.setConfiguration(S))}n.remoteSDP.updateCandidates(t);const u=yield Tt(n.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const p=cc(u.sdp),{remoteIceParameters:m}=yield p.iceParameters;n.remoteSDP.restartICE(m);const g=n.remoteSDP.toString(),y=n.logSDPExchange(u.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Tt(n.peerConnection.setLocalDescription(u)),y==null||y(g),yield Tt(n.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(o){C.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ir.TCP_RELAY),await Zs(this.peerConnection,this.remoteSDP,this.extension)}catch(n){C.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{Ap(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:i}=n;i&&i.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return ba(ba({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const l=this.remoteSDP.toString(),u=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),u==null||u(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new oe(G.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===t);i.length===1&&(this.isVP8Simulcast(n)?Sn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(o=>o.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:o}=n.getSelectedCandidatePair();return{local:ba(ba({},Lo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:ba(ba({},Lo),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const i="code: ".concat(t.errorCode,", message: ").concat(t.errorText),o=t.port?"local: ".concat(t.port):"",l=ac(t.url||"");C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(l||"",", host_candidate:").concat(o)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},$("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},i=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(Zd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:$("NEW_TURN_MODE")&&n.iceServers&&i==="disabled"?($("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...Vu.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...Vu.newTurnServerConfigToIceServers(t.turnServer.servers)),$("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Vu.turnServerConfigToIceServers(t.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Vu.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),$("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(n.iceTransportPolicy="relay")}))),$("ENABLE_ENCODED_TRANSFORM")&&It().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Fo(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!$("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{const o=$("NEW_TURN_MODE");o===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):o===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):o===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Fo(i.turnServerURL),":443?transport=tcp")}):o===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Fo(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in o?o.error:o)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const o=n==null?void 0:n.iceTransport.state;var l;o&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:l}=i.getSelectedCandidatePair()||{};if(o&&l){const u=o.address+":"+o.port,p=l.address+":"+l.port;C.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(ac(u)),", remote ").concat(JSON.stringify(ac(p))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i,o;if(n||(n=this.peerConnection.getSenders().find(O=>O.track===t._mediaStreamTrack)),!n)return C.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return C.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!It().supportSetRtpSenderParameters)return C.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},u={};switch(t._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}const p=zV(this.peerConnection,t._mediaStreamTrack),m=MU(t);if(k4(t)&&p&&n&&m&&this.getLocalVideoStats&&fe(i=["vp8","vp9"]).call(i,this.store.codec)){var g;const I=l.degradationPreference||(fe(g=t._hints).call(g,Xt.CUSTOM_TRACK)?$("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");L4(this.id+p.mid,m,this,I,O=>{n&&this.updateAdaptation(n,O)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var y;const{bitrateMax:I,frameRate:O,scaleResolutionDownBy:W}=t._encoderConfig;I&&(u.maxBitrate=1e3*I),(fe(y=t._hints).call(y,Xt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(O&&(u.maxFramerate=Fs(O)),W&&W>=1&&(u.scaleResolutionDownBy=W))}const{maxFramerate:b}=$("ENCODER_CONFIG_LIMIT");if(b&&typeof b=="number"&&(u.maxFramerate=u.maxFramerate?Math.min(u.maxFramerate,b):b),$("DSCP_TYPE")&&nc()){var S;const I=$("DSCP_TYPE");fe(S=["very-low","low","medium","high"]).call(S,I)&&(u.networkPriority=I)}const w=n.getParameters(),k=(o=w.encodings)===null||o===void 0?void 0:o[0];Sn()&&!k&&(l.encodings=[u]),k&&Object.assign(k,u),Object.assign(w,l),C.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(w.encodings))),await n.setParameters(w),await o4(this.store.codec,n,$("SVC_MODE"))}async updateAdaptation(t,n){var i,o;if(!t)return C.debug("[updateAdaptation] no rtpSender found");if(!It().supportSetRtpSenderParameters)return C.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const l={},{bitrateMax:u,frameRate:p,scaleResolutionDownBy:m}=n;u&&(l.maxBitrate=1e3*u),p&&(l.maxFramerate=Fs(p)),m&&m>=1&&fe(i=["vp8","vp9"]).call(i,this.store.codec)&&(l.scaleResolutionDownBy=m);const g=t.getParameters(),y=(o=g.encodings)===null||o===void 0?void 0:o[0];y&&Object.assign(y,l),Object.assign(g,{});try{await t.setParameters(g),C.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(g.encodings)))}catch(b){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?C.debug("[updateAdaptation] peerConnection not connected}"):C.debug("[updateAdaptation] updateRtpSenderEncodings failed",b):C.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!It().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const o=t[i],l=n[i];l instanceof pn&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,o.sender)}}catch{C.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){if($("FORBID_MODIFY_LOCAL_OFFER_SDP"))return t;const o=Ns(t);return n.forEach((l,u)=>{const p=i[u],m=o.mediaDescriptions.find(g=>g.attributes.mid===p);m&&(_u(m,l),nR(m,l,this.store.codec))}),Gc(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let m=0;m<t.length;m++){var i,o,l,u,p;const g=t[m],y=n[m];if(y instanceof pn&&!fe(i=y._hints).call(i,Xt.LOW_STREAM)&&(o=y._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((l=y._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(u=y._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((p=y._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){const b={},S={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const w=g.sender.getParameters();await g.sender.setParameters(Object.assign(w,b))}}}async applySimulcastEncodings(t,n){if(!Sn()&&t.length===n.length)for(let i=0;i<t.length;i++){const o=n[i];if(o instanceof pn&&this.isVP8Simulcast(o)){const l=t[i],u={},p={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];const m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,u))}}}isVP8Simulcast(t){var n,i,o,l,u;return!!(t instanceof pn&&$("SIMULCAST")&&this.store.codec==="vp8"&&!fe(n=t._hints).call(n,Xt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=t._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(t,n,i,o){if($("SDP_LOGGING"))return C.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",i==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(It().supportPCSetConfiguration){const n=Vu.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},we(jt.prototype,"updateRemoteRTPCapabilities",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"updateRemoteRTPCapabilities"),jt.prototype),we(jt.prototype,"connect",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"connect"),jt.prototype),we(jt.prototype,"updateRemoteConnect",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"updateRemoteConnect"),jt.prototype),we(jt.prototype,"createDataChannels",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"createDataChannels"),jt.prototype),we(jt.prototype,"receive",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"receive"),jt.prototype),we(jt.prototype,"batchReceive",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"batchReceive"),jt.prototype),we(jt.prototype,"stopReceiving",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"stopReceiving"),jt.prototype),we(jt.prototype,"muteRemote",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"muteRemote"),jt.prototype),we(jt.prototype,"unmuteRemote",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"unmuteRemote"),jt.prototype),we(jt.prototype,"muteLocal",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"muteLocal"),jt.prototype),we(jt.prototype,"unmuteLocal",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"unmuteLocal"),jt.prototype),we(jt.prototype,"close",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"close"),jt.prototype),we(jt.prototype,"updateEncoderConfig",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"updateEncoderConfig"),jt.prototype),we(jt.prototype,"updateSendParameters",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"updateSendParameters"),jt.prototype),we(jt.prototype,"replaceTrack",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"replaceTrack"),jt.prototype),we(jt.prototype,"updateAdaptation",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"updateAdaptation"),jt.prototype),we(jt.prototype,"getRemoteSSRC",[Bs],Object.getOwnPropertyDescriptor(jt.prototype,"getRemoteSSRC"),jt.prototype),jt);function Bs(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("From P2PConnection.".concat(t));try{for(var u=arguments.length,p=new Array(u),m=0;m<u;m++)p[m]=arguments[m];return await i.apply(this,p)}finally{l()}},n}function SR(e,t){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=Fs(t.width),i.height=Fs(t.height);const o=Fs(t.framerate||15);document.body.append(n),document.body.append(i);let l=e._mediaStreamTrack;n.srcObject=new MediaStream([l]),n.play().catch(jf);const u=i.getContext("2d");if(!u)throw new ne(G.UNEXPECTED_ERROR,"can not get canvas context");const p=It(),m=i.captureStream(p.supportRequestFrame?0:o).getVideoTracks()[0];m.canvas||(m.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const y=n.videoWidth,b=n.videoHeight/y,S=i.width*b;Math.abs(S-i.height)>=2&&(C.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(S)),i.height=S)}u.drawImage(n,0,0,i.width,i.height),m.requestFrame&&m.requestFrame(),l!==e._mediaStreamTrack&&(l=e._mediaStreamTrack,n.srcObject=new MediaStream([l]))},i.stopCapture=SC(()=>i.startCapture&&i.startCapture(),o);const g=m.stop;return m.stop=()=>{g.call(m),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),C.debug("clean low stream renderer")},m}var j4=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(j4||{}),Sa=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(Sa||{}),_t=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(_t||{}),xr=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e[e.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",e}(xr||{}),Br=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(Br||{}),Ip=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e[e.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",e}(Ip||{}),xR=function(e){return e[e.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",e[e.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",e}(xR||{});const Eu=1e3,DE=6,ng=3,Tde=Math.max(DE,ng,60);function st(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function U4(e){const t={[Br.CONN_TYPE]:0,[Br.RTT]:e.rtt,[Br.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[Br.CONN_TYPE]=1),n==="tcp"&&(t[Br.CONN_TYPE]=3),n==="tls"&&(t[Br.CONN_TYPE]=4);break}case"srflx":t[Br.CONN_TYPE]=2;break;case"unknown":t[Br.CONN_TYPE]=5;break;default:t[Br.CONN_TYPE]=0}return t}function V4(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class F4 extends On{constructor(t){super(),D(this,"store",void 0),D(this,"uploadWRTCStatsTimer",void 0),D(this,"uploadOutboundDenoiserStatsTimer",void 0),D(this,"uploadExtStatsTimer",void 0),D(this,"uploadExtUsageStatsTimer",void 0),D(this,"uploadInboundExtStatsTimer",void 0),D(this,"requestStats",void 0),D(this,"requestTransportStats",void 0),D(this,"requestLocalMedia",void 0),D(this,"requestRemoteMedia",void 0),D(this,"requestAllTracks",void 0),D(this,"requestVideoIsReady",void 0),D(this,"requestUploadStats",void 0),D(this,"requestUpload",void 0),D(this,"uploadOutboundStarted",!1),D(this,"uploadInboundStarted",!1),D(this,"uploadTransportStarted",!1),D(this,"uploadBaseStatsStarted",!1),D(this,"uploadExtensionUsageStarted",!1),D(this,"lastRecvStats",void 0),D(this,"lastSendStats",void 0),D(this,"lastRefRecvStats",void 0),D(this,"lastRefSendStats",void 0),D(this,"lastNormalRecvStats",void 0),D(this,"lastNormalSendStats",void 0),D(this,"lastExtendStats",{}),D(this,"needUploadStats",{}),D(this,"needUploadRenderFreezeTime",!0),D(this,"lastUploadCompensateTime",-1),D(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%ng==0,i=t%DE==0,o=t%60==0;let l,u;if(this.uploadTransportStarted&&(l=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!l&&this.uploadOutboundStarted&&(l=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),l||u){var p;const m={};if(this.uploadTransportStarted&&l){const y=this.getTransportStats(l,n?this.lastRefSendStats:void 0,u,n);y&&(m.misc=[y])}if(this.uploadOutboundStarted&&l){const y=this.getOutboundStats(l,i?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,o);y&&(m.outbound=[y])}if(this.uploadInboundStarted&&u){this.uploadCompensateStats(t);const y=this.getInboundStats(u,i?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);y&&(m.inbound=y)}const g=(p=this.requestTransportStats)===null||p===void 0?void 0:p.call(this).connectState;if(g&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[Ip.RTC_PEER_CONNECTION_STATE]=oC[g]):m.misc=[{addition:{[Ip.RTC_PEER_CONNECTION_STATE]:oC[g]}}]),Ei.needUploadStats.length>0||i){const y=Ei.needUploadStats.shift()||(Ei.visibility==="visible"?1:0);Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[Ip.PAGE_VISIBILITY]=y):m.misc=[{addition:{[Ip.PAGE_VISIBILITY]:y}}]}this.needUploadStats.sendType&&(Array.isArray(m.outbound)&&m.outbound[0]&&m.outbound[0].high&&(m.outbound[0].high[j4.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=l,i&&(this.lastNormalRecvStats=u,this.lastNormalSendStats=l),n&&(this.lastRefRecvStats=u,this.lastRefSendStats=l)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,Ei.startCollectStats();let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const o=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(o&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[Ip.RTC_PEER_CONNECTION_STATE]:oC[o.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===Tde+1&&(t=1)},Eu)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%ng==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const i=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=i,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const o=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*o;const l=this.requestStats(!0);new Array(o).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const u={};if(this.uploadInboundStarted&&l){const p=this.requestRemoteMedia()||[],m=[];p.forEach(g=>{let[y,b]=g;const S={peer:y.uid};if(y._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(y._videoSSRC)&&b.has(Me.VIDEO)&&y.videoTrack){const w=function(k,I,O){if(!I.videoRecv.find(H=>H.ssrc===k))return;const W={};if(O&&O._player){const H=O._player,{renderFreezeAccTime2:Y,videoElementStatus:Q}=H;if(Ei.visibility==="visible"&&Q===ts.PLAYING&&It().supportRequestVideoFrameCallback){const Z=Math.min(6e3,Y);H.renderFreezeAccTime2=Math.max(0,Y-Z),st(W,Sa.Video_Render_Freeze_Time_Render2,Z),$("USE_NEW_RENDER_FREEZE_TIME")&&st(W,Sa.Video_Render_Freeze_Time_Render,Z)}}return W}(y._videoSSRC,l,y.videoTrack);w&&(S.video=w)}S.video&&m.push(S)}),m.length>0&&(u.inbound=m,this.requestUploadStats(u))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,i,o){if(!this.requestStats)return;if(!o)return t.rtt==null?void 0:{addition:{[Br.RTT]:t.rtt,[Br.CONN_TYPE]:void 0,[Br.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const l=U4(t);if(this.store.useP2P){if(i){const u=U4(i);l[Br.CONN_TYPE]&&u[Br.CONN_TYPE]&&(l[Br.CONN_TYPE]+=u[Br.CONN_TYPE]<<3)}l[Br.CONN_TYPE]?l[Br.CONN_TYPE]+=110:l[Br.CONN_TYPE]=110}else{l[Br.CONN_TYPE]?l[Br.CONN_TYPE]+=100:l[Br.CONN_TYPE]=100;const u=function(p,m){return m?[Math.ceil(8*(p.transport.bytesSent-m.transport.bytesSent)/(p.timestamp-m.timestamp)),Math.ceil(8*(p.transport.bytesReceived-m.transport.bytesReceived)/(p.timestamp-m.timestamp))]:[0,0]}(t,n);l[xR.Transport_Send_Bitrate]=u[0],l[xR.Transport_Recv_Bitrate]=u[1]}return{addition:l}}getOutboundStats(t,n,i,o,l){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let p,m,g;return u.forEach(y=>{let[b,{track:S,ssrcs:w}]=y;switch(b){case ge.LocalVideoLowTrack:case ge.LocalVideoTrack:if(b===ge.LocalVideoTrack){var k;const I=function(Y,Q,Z,q,ee,ce){const me=Q.videoSend.find(wt=>wt.ssrc===Y);if(!me)return;const Oe={},{sentFrame:ot,inputFrame:it}=me;if(q&&(st(Oe,Sa.Video_Send_Qp_Sum,me.qpSumPerFrame),it&&ot)){const wt=it.frameRate,yt=ot.frameRate;Oe[Sa.Video_Send_Freeze]=function(Kt,An){let he=!0;return he=!(Kt<=5)&&(Kt<=10?An<3:Kt<=20?An<4:An<5),he}(wt,yt)?1:0}if(ee){switch(ot&&(st(Oe,_t.Video_Send_Height,ot.height),st(Oe,_t.Video_Send_Width,ot.width),st(Oe,_t.Video_Send_Frame_Rate,ot.frameRate)),Oe[_t.Video_Send_Disabled]=Z._originMediaStreamTrack&&!Z._originMediaStreamTrack.enabled||Z._mediaStreamTrack&&!Z._mediaStreamTrack.enabled?1:0,me.adaptionChangeReason){case"none":Oe[_t.Video_Send_Adaptation]=0;break;case"cpu":Oe[_t.Video_Send_Adaptation]=1;break;case"bandwidth":Oe[_t.Video_Send_Adaptation]=2;break;case"other":Oe[_t.Video_Send_Adaptation]=3}let wt=0;me.adaptionChangeReason&&(wt+=V4(me.adaptionChangeReason)),Q.qualityLimitationReason&&(wt+=V4(Q.qualityLimitationReason)<<3),Oe[_t.Video_Send_Adaptation]=wt,Oe[_t.Video_Send_Player_Status]=EC[Z._player?Z._player.videoElementStatus:"uninit"],st(Oe,_t.Video_Send_Nacks,me.nacksCount),st(Oe,_t.Video_Send_Plis,me.plisCount),st(Oe,_t.Video_Send_Firs,me.firsCount),st(Oe,_t.Video_Send_Avg_Encode,me.avgEncodeMs),st(Oe,_t.Video_Send_Huge_Frame_Sent,me.hugeFramesSent),st(Oe,_t.Video_Send_Bytes_Retransmit,me.retransmittedBytesSent),st(Oe,_t.Video_Send_Packages_Retransmit,me.retransmittedPacketsSent),st(Oe,_t.Video_Send_Key_Frames_Encoded,me.keyFramesEncoded);const yt=ee.videoSend.find(Kt=>Kt.ssrc===Y);if(yt){let Kt=Eu*ng;yt.timestamp&&me.timestamp&&(Kt=me.timestamp-yt.timestamp),yt.packets!=null&&me.packets!=null&&st(Oe,_t.Video_Send_Package_Rate,1e3*(me.packets-yt.packets)/Kt),me.packetsLost!=null&&yt.packetsLost!=null&&st(Oe,_t.Video_Send_Package_Lost,me.packetsLost-yt.packetsLost),yt.bytes!=null&&me.bytes!=null&&st(Oe,_t.Video_Send_Bitrate,8*(me.bytes-yt.bytes)/Kt)}}return Oe}(w[0].ssrcId,t,S,n,i),O=S.__className__==="CameraVideoTrack"?3:fe(k=S._hints).call(k,Xt.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==O||l)&&(this.needUploadStats={sendType:O},this.lastExtendStats.sendType=O);const W=S&&function(Y,Q,Z,q){const ee=Q.videoSend.find(me=>me.ssrc===Y);if(!ee)return null;const ce={};if(q){const me=ee.inputFrame,Oe=me&&me.height||Z.videoHeight||0,ot=me&&me.width||Z.videoWidth||0,it=me&&me.frameRate||0;st(ce,_t.Video_Capture_Height,Oe),st(ce,_t.Video_Capture_Width,ot),st(ce,_t.Video_Capture_Frame_Rate,it)}return ce}(w[0].ssrcId,t,S,!!i),H=function(Y,Q){const Z={};return Q&&(st(Z,_t.Video_Send_Retransmit,Y.bitrate.retransmit),st(Z,_t.Video_Send_Target_Encoded,Y.bitrate.targetEncoded),st(Z,_t.Video_Send_Actual_Encoded,Y.bitrate.actualEncoded),st(Z,_t.Video_Send_Transmit,Y.bitrate.transmit),st(Z,_t.Video_Send_Bandwidth,Y.sendBandwidth)),Z}(t,!!i);m=Object.assign({},I,W,H)}else g=function(I,O,W,H,Y){const Q=O.videoSend.find(q=>q.ssrc===I);if(!Q)return;const Z={};if(H){const q=Q.sentFrame;q&&(st(Z,_t.Video_Send_Low_Height,q.height),st(Z,_t.Video_Send_Low_Width,q.width),st(Z,_t.Video_Send_Low_Frame_Rate,q.frameRate));const ee=H.videoSend.find(ce=>ce.ssrc===I);if(ee){let ce=Eu*DE;ee.timestamp&&Q.timestamp&&(ce=Q.timestamp-ee.timestamp),ee.packets!=null&&Q.packets!=null&&st(Z,_t.Video_Send_Low_Package_Rate,1e3*(Q.packets-ee.packets)/ce),Q.packetsLost!=null&&ee.packetsLost!=null&&st(Z,_t.Video_Send_Low_Package_Lost,Q.packetsLost-ee.packetsLost),ee.bytes!=null&&Q.bytes!=null&&st(Z,_t.Video_Send_Low_Bitrate,8*(Q.bytes-ee.bytes)/ce)}}return Z}(w[0].ssrcId,t,0,i);break;case ge.LocalAudioTrack:p=S&&function(I,O,W,H,Y,Q){const Z=O.audioSend.find(ee=>ee.ssrc===I);if(!Z)return;const q={};if(Y){q[_t.Audio_Send_Disabled]=W._originMediaStreamTrack&&!W._originMediaStreamTrack.enabled||W._mediaStreamTrack&&!W._mediaStreamTrack.enabled?1:0;const ee=100*W._source.getAccurateVolumeLevel(),ce=Z.inputLevel;if(ce!=null){const Oe=Math.ceil(50*Math.log10(100*ce+1));st(q,_t.Audio_Send_Level,Oe)}st(q,_t.Audio_Capture_PCM_Level,ee),st(q,_t.Audio_Send_AEC_Return_Loss,Z.aecReturnLoss),st(q,_t.Audio_Send_AEC_Return_Loss_Enhancement,Z.aecReturnLossEnhancement),st(q,_t.Audio_Send_Bytes_Retransmit,Z.retransmittedBytesSent),st(q,_t.Audio_Send_Packages_Retransmit,Z.retransmittedPacketsSent),q[_t.Audio_Send_Freeze]=0;const me=Y.audioSend.find(Oe=>Oe.ssrc===I);if(me){let Oe=Eu*DE;me.timestamp&&Z.timestamp&&(Oe=Z.timestamp-me.timestamp),me.bytes!=null&&Z.bytes!=null&&st(q,_t.Audio_Send_Bitrate,8*(Z.bytes-me.bytes)/Oe),me.packets!=null&&Z.packets!=null&&st(q,_t.Audio_Send_Package_Rate,1e3*(Z.packets-me.packets)/Oe)}}return q}(w[0].ssrcId,t,S,0,i)}}),{high:m,low:g,audio:p}}getInboundStats(t,n,i,o){if(!this.requestRemoteMedia)return;const l=this.requestRemoteMedia()||[],u=[];return l.forEach(p=>{let[m,g]=p;const y={peer:m.uid};let b;if(g.has(Me.VIDEO)&&m.videoTrack){const S=m._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(m._videoSSRC)||!1,w=m.videoTrack?function(k,I,O,W,H,Y,Q,Z){const q=I.videoRecv.find(yt=>yt.ssrc===k);if(!q)return;const ee={},{receivedFrame:ce,outputFrame:me,decodeFrameRate:Oe}=q;st(ee,xr.Video_Render_Frame_Rate_Decode,Oe),q.framesRateFirefox&&st(ee,xr.Video_Recv_Frame_Rate,q.framesRateFirefox),ce&&st(ee,xr.Video_Recv_Frame_Rate,ce.frameRate),st(ee,xr.Video_Recv_Frame_Dropped,q.framesDroppedCount),st(ee,xr.Video_Recv_Bytes_Retransmit,q.retransmittedBytesReceived),st(ee,xr.Video_Recv_Packages_Retransmit,q.retransmittedPacketsReceived),st(ee,xr.Video_Recv_Packages_Discarded,q.packetsDiscarded),st(ee,xr.Video_Recv_Avg_Decode,q.avgDecodeMs),st(ee,xr.Video_Recv_Avg_Processing_Delay,q.avgProcessingDelayMs),st(ee,xr.Video_Recv_Avg_Assembly_Time,q.avgFramesAssembledFromMultiplePacketsMs),st(ee,xr.Video_Recv_Avg_Inter_Frame_Delay,q.avgInterFrameDelayMs),st(ee,xr.Video_Recv_Key_Frames_Decoded,q.keyFramesDecoded);const ot=Z&&Z.videoRecv.find(yt=>yt.ssrc===k);if(ot){const yt=I.timestamp-Z.timestamp||Eu;q.packetsLost!=null&&ot.packetsLost!=null&&st(ee,xr.Video_Recv_Package_Lost,q.packetsLost-ot.packetsLost),ot.bytes!=null&&q.bytes!=null&&st(ee,xr.Video_Recv_Bitrate,8*(q.bytes-ot.bytes)/yt),ot.packets!=null&&q.packets!=null&&st(ee,xr.Video_Recv_Package_Rate,1e3*(q.packets-ot.packets)/yt)}const it=Y&&Y.videoRecv.find(yt=>yt.ssrc===k);if(it&&(st(ee,Sa.Video_Recv_Qp_Sum,q.qpSumPerFrame),ee[Sa.Video_Recv_Freeze]=W&&eg.isRemoteVideoFreeze(O,q,it)?1:0),Q){var wt;const yt=Q.videoRecv.find(An=>An.ssrc===k);ce?(st(ee,_t.Video_Recv_Height,ce.height),st(ee,_t.Video_Recv_Width,ce.width)):O&&(st(ee,_t.Video_Recv_Height,O._videoHeight||0),st(ee,_t.Video_Recv_Width,O._videoWidth||0)),me&&st(ee,_t.Video_Recv_Frame_Rate_Output,me.frameRate);const Kt=(wt=O._player)===null||wt===void 0?void 0:wt.rendFrameRate.toFixed(0);if(Kt&&st(ee,_t.Video_Render_Frame_Rate_Render,+Kt),st(ee,_t.Video_Recv_Jitter_Buffer,q.jitterBufferMs),st(ee,_t.Video_Recv_Current_Delay,q.currentDelayMs),st(ee,_t.Video_Recv_Firs,q.firsCount),st(ee,_t.Video_Recv_Nacks,q.nacksCount),st(ee,_t.Video_Recv_Plis,q.plisCount),O){ee[_t.Video_Recv_Disabled]=O._originMediaStreamTrack.enabled&&O._mediaStreamTrack.enabled?0:1;const An=O._player;if(An){const{freezeTimeCounterList:he,renderFreezeAccTime:Ee,renderFreezeAccTime2:je,videoElementStatus:pe}=An;if(he&&he.length>0&&st(ee,Sa.Video_Render_Freeze_Time,he.splice(0,1)[0]),H&&Ei.visibility==="visible"&&pe===ts.PLAYING&&It().supportRequestVideoFrameCallback){const A=Math.min(6e3,je);An.renderFreezeAccTime2=Math.max(0,je-A),st(ee,Sa.Video_Render_Freeze_Time_Render2,A);const z=Math.min(6e3,Ee);An.renderFreezeAccTime=Math.max(0,Ee-z),st(ee,Sa.Video_Render_Freeze_Time_Render,$("USE_NEW_RENDER_FREEZE_TIME")?A:z)}if(typeof q.totalFreezesDuration=="number"){const A=yt&&yt.totalFreezesDuration?q.totalFreezesDuration-yt.totalFreezesDuration:q.totalFreezesDuration;st(ee,_t.Video_Render_Freeze_Duration,1e3*A)}}}if(ee[_t.Video_Recv_Player_Status]=EC[O._player?O._player.videoElementStatus:"uninit"],yt&&q.totalInterFrameDelay!==void 0&&q.totalSquaredInterFrameDelay!==void 0&&yt.totalInterFrameDelay!==void 0&&yt.totalSquaredInterFrameDelay!==void 0){const An=q.totalInterFrameDelay-yt.totalInterFrameDelay,he=q.totalSquaredInterFrameDelay-yt.totalSquaredInterFrameDelay,Ee=q.framesDecodeCount-yt.framesDecodeCount,je=An/Ee*1e3,pe=Math.round(1e3*Math.sqrt((he-Math.pow(An,2)/Ee)/Ee));!isNaN(pe)&&je+pe>Math.max(3*je,je+150)&&(ee[_t.Video_Recv_I_Frame_Delay]=pe)}}return ee}(m._videoSSRC,t,m.videoTrack,S===!0,this.needUploadRenderFreezeTime,n,i,o):void 0;if(w&&(y.video=w),m.videoTrack){const k=t.videoRecv.find(I=>I.ssrc===m._videoSSRC);k&&k.estimatedPlayoutTimestamp&&(b=k.estimatedPlayoutTimestamp)}}if(g.has(Me.AUDIO)&&m.audioTrack){const S=m.audioTrack?function(w,k,I,O,W,H){const Y=k.audioRecv.find(ee=>ee.ssrc===w);if(!Y)return;const Q={};st(Q,xr.Audio_Recv_Jitter,Y.jitterMs),st(Q,xr.Audio_Recv_Bytes_Retransmit,Y.retransmittedBytesReceived),st(Q,xr.Audio_Recv_Packages_Retransmit,Y.retransmittedPacketsReceived),st(Q,xr.Audio_Recv_Packages_Discarded,Y.packetsDiscarded),st(Q,xr.Audio_Recv_Avg_Processing_Delay,Y.avgProcessingDelayMs);const Z=H&&H.audioRecv.find(ee=>ee.ssrc===w);if(Z){const ee=Eu;Y.packets!=null&&Z.packets!=null&&st(Q,xr.Audio_Recv_Package_Rate,1e3*(Y.packets-Z.packets)/ee),Y.packetsLost!=null&&Z.packetsLost!=null&&st(Q,xr.Audio_Recv_Package_Lost,Y.packetsLost-Z.packetsLost)}if(O){const{receivedFrames:ee,droppedFrames:ce}=Y;ee!=null&&ce!=null&&(Q[Sa.Audio_Recv_Freeze]=(q=ee)===0||100*ce/q>20?1:0)}var q;if(W){const ee=100*I._source.getAccurateVolumeLevel(),ce=Y.outputLevel;if(ce!=null){const Oe=Math.ceil(50*Math.log10(100*ce+1));st(Q,_t.Audio_Render_Level,Oe)}st(Q,_t.Audio_Recv_PCM_Level,ee),I&&(Q[_t.Audio_Recv_Disabled]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1),st(Q,_t.Audio_Recv_Jitter_Buffer,Y.jitterBufferMs),st(Q,_t.Audio_Recv_Current_Delay,Y.jitterBufferMs),Q[_t.Audio_Recv_Player_Status]=EC[gs.getPlayerState(I.getTrackId())];const me=W.audioRecv.find(Oe=>Oe.ssrc===w);if(me){me.bytes!=null&&Y.bytes!=null&&st(Q,_t.Audio_Recv_Bitrate,8*(Y.bytes-me.bytes)/(Eu*ng));const Oe=Y.concealedSamples-me.concealedSamples;Oe>0&&st(Q,_t.Audio_Recv_Concealed_Samples,Oe);const ot=Y.totalSamplesReceived-me.totalSamplesReceived;ot>0&&st(Q,_t.Audio_Recv_Total_Samples_Received,ot);const it=Y.freezeSamples80-me.freezeSamples80;it>0&&st(Q,_t.Audio_Render_Freeze_Samples_80ms,it);const wt=Y.freezeSamples200-me.freezeSamples200;wt>0&&st(Q,_t.Audio_Render_Freeze_Samples_200ms,wt);const yt=Y.freezeMs80-me.freezeMs80;st(Q,_t.Audio_Render_Freeze_Time_80ms,yt<0?0:yt);const Kt=Y.freezeMs200-me.freezeMs200;st(Q,_t.Audio_Render_Freeze_Time_200ms,Kt<0?0:Kt)}}return Q}(m._audioSSRC,t,m.audioTrack,n,i,o):void 0;if(S&&(y.audio=S),m.audioTrack&&b){const w=t.audioRecv.find(k=>k.ssrc===m._audioSSRC);if(w&&w.estimatedPlayoutTimestamp){const k=w.estimatedPlayoutTimestamp-b;y.audio?y.audio[xr.Audio_Recv_AV_Sync_TIME]=k:y.audio={[xr.Audio_Recv_AV_Sync_TIME]:k}}}}(y.video||y.audio)&&u.push(y)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,u}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof Wf);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(fu.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,i]=t;i.has(Me.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)}),i.has(Me.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:$("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let o=[];const l=this.requestAllTracks&&this.requestAllTracks()||[];for(const g of l)!g.muted&&g.enabled&&(o=o.concat(await g.getProcessorUsage()));const u=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[g,y]of u)y.has(Me.VIDEO)&&g.videoTrack&&(o=o.concat(await g.videoTrack.getProcessorUsage())),y.has(Me.AUDIO)&&g.audioTrack&&(o=o.concat(await g.audioTrack.getProcessorUsage()));if(o.length===0)return;i.details=function(g,y){const b={};for(const{id:I,value:O,level:W,direction:H}of g){var S;const Y=(S=y.get(I))!==null&&S!==void 0?S:0,Q=O===2?Y+$("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:Y;var w,k;y.set(I,Q),b[I]?(O===2&&(b[I].value=O),W>b[I].level&&(b[I].level=W),H==="remote"&&(b[I].remoteUidCount+=1),b[I].totalTs=(w=y.get(I))!==null&&w!==void 0?w:0):b[I]={value:O,level:W,remoteUidCount:H==="local"?0:1,totalTs:(k=y.get(I))!==null&&k!==void 0?k:0}}return Object.keys(b).map(I=>{const{level:O,value:W,totalTs:H}=b[I];return{id:I,level:O,value:W,totalTs:H}})}(o,t);const p=Date.now(),m=p>n?p:n+1;this.requestUpload&&this.requestUpload(fu.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:m})},$("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,Ei.stopCollectStats()}}const Cde=$("ICE_RESTART_INTERVAL");let kE=new Map,Op=new Map,Bl=[Ir.UDP_TCP_RELAY,Ir.TCP_RELAY,Ir.RELAY],wR=$("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&It().supportPCSetConfiguration;function B4(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=kE.get(e.id);n&&(window.clearTimeout(n),kE.delete(e.id));const i=Op.get(e.id);t&&i&&i.index===Bl.length-1&&(C.debug("[".concat(e.id,"] reset ICE restart policy")),Op.delete(e.id))}function $4(e,t,n){if(kE.size===0&&Op.size===0&&(Array.isArray($("RESTART_SEQUENCE"))&&$("RESTART_SEQUENCE").length>0&&!function(p,m){if(p.length!==m.length)return!1;for(let g=0;g<p.length;g+=1){const y=p[g];if(p.filter(b=>b===y).length!==m.filter(b=>b===y).length)return!1}return!0}(Bl,$("RESTART_SEQUENCE"))&&(Bl=$("RESTART_SEQUENCE").filter(p=>{var m;if(fe(m=Object.values(Ir)).call(m,p))return!0}),C.debug("use reconnection policy from config distribution, queues: ".concat(Bl.join(" => ")))),wR=$("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&It().supportPCSetConfiguration),Bl.length===0)return void n();let i,{index:o=0,type:l}=Op.get(e.id)||{};if(wR&&l===Ir.RELAY)return void n();let u=l&&o>=Bl.length-1;if(wR)l=Ir.RELAY;else{if(u)return void n();l?(o++,l=Bl[o]):(l=Bl[0],o=0)}C.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(l,", index: ").concat(o)),t(l),Op.set(e.id,{index:o,type:l}),i=window.setTimeout(()=>$4(e,t,n),Cde),kE.set(e.id,i)}var Pt;function W4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function uc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?W4(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W4(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function G4(e){var t,n,i,o=2;for(typeof Symbol<"u"&&(n=Ry,i=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new LE(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function LE(e){function t(n){if(Object(n)!==n)return xe.reject(new TypeError(n+" is not an object."));var i=n.done;return xe.resolve(n.value).then(function(o){return{value:o,done:i}})}return LE=function(n){this.s=n,this.n=n.next},LE.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?xe.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?xe.reject(n):t(i.apply(this.s,arguments))}},new LE(e)}let vu=(Pt=class extends On{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Ke.StateChange,t,this._state)}constructor(e,t){super(),D(this,"isPlanB",void 0),D(this,"store",void 0),D(this,"statsUploader",void 0),D(this,"connection",void 0),D(this,"localTrackMap",new Map),D(this,"remoteUserMap",new Map),D(this,"localDataChannels",[]),D(this,"remoteDataChannelMap",new Map),D(this,"pendingLocalTracks",[]),D(this,"pendingRemoteTracks",[]),D(this,"pendingLocalDataChannels",[]),D(this,"pendingRemoteDataChannels",[]),D(this,"statsCollector",void 0),D(this,"shouldForwardP2PCreation",void 0),D(this,"iceFailedCount",0),D(this,"dtlsFailedCount",0),D(this,"mutex",void 0),D(this,"_state",qt.Disconnected),D(this,"_pcStatsUploadType",$("NEW_ICE_RESTART")?zc.FIRST_CONNECTION:zc.OLD_FIRST_CONNECTION),D(this,"_isStartRestartIce",!1),D(this,"_restartTimer",void 0),D(this,"_isTryConnecting",!1),D(this,"_iceError",null),D(this,"_forceTurn",!1),D(this,"_isWaitPcToRePub",!1),D(this,"handleMuteLocalTrack",async(n,i,o)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==qt.Connected)return void o(new oe(G.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const u=this.filterTobeMutedTracks(n);if(u.length===0)return void i();const p=u.find(g=>g[0]==="videoLowTrack");if(p){const g=p[1];this.store.enableInstantMuteRestore?(g.track._originMediaStreamTrack.enabled=!1,C.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):g.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?C.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(u.map(g=>{let[,{id:y}]=g;return y}));const m=this.createMuteMessage(u);await mn(this,Ke.RequestMuteLocal,m),i()}catch(u){o(u)}finally{l()}}),D(this,"handleUnmuteLocalTrack",async(n,i,o)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==qt.Connected)return void o(new oe(G.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const u=this.filterTobeUnmutedTracks(n);if(u.length===0)return void i();const p=u.find(g=>g[0]==="videoLowTrack");if(p){const g=p[1];if(this.store.enableInstantMuteRestore)g.track._originMediaStreamTrack.enabled=!0,C.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(g.track._originMediaStreamTrack.stop(),!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding){const y=n._mediaStreamTrack.clone();g.track._mediaStreamTrack=y,g.track._originMediaStreamTrack=y}else{const y=SR(n,tu(this,Ke.RequestLowStreamParameter));g.track._mediaStreamTrack=y,g.track._originMediaStreamTrack=y}await new xe((y,b)=>{this.handleReplaceTrack(g.track,y,b,!0)})}}this.store.enableInstantMuteRestore?C.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(u.map(g=>{let[,{id:y}]=g;return y}));const m=this.createUnmuteMessage(u);await mn(this,Ke.RequestUnmuteLocal,m),i()}catch(u){o(u)}finally{l()}}),D(this,"handleUpdateVideoEncoder",async(n,i,o,l)=>{let u;l||(u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const m=this.localTrackMap.get(ge.LocalVideoTrack);if(!this.connection||!m||m.track!==n||this.state!==qt.Connected)return void i();const{id:g,track:y}=m;await this.connection.updateSendParameters(g,y),await this.connection.updateEncoderConfig(g,y),this.emit(Ke.UpdateVideoEncoder,y),i()}catch(m){o(m)}finally{var p;(p=u)===null||p===void 0||p()}}),D(this,"handleUpdateVideoSendParameters",async(n,i,o)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const u=this.localTrackMap.get(ge.LocalVideoTrack);if(!this.connection||!u||u.track!==n||this.state!==qt.Connected)return void i();const{id:p,track:m}=u;await this.connection.updateSendParameters(p,m),i()}catch(u){o(u)}finally{l()}}),D(this,"handleReplaceMixingTrack",async(n,i,o,l)=>{if(!this.connection||this.state!==qt.Connected)return void i();const u=ER([n]);let p;C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(u.getTrackId(),"]")),typeof l=="boolean"&&l||(p=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,u),i()}catch(g){o(g)}finally{var m;(m=p)===null||m===void 0||m()}}),D(this,"handleReplaceTrack",async(n,i,o,l)=>{let u;C.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof l=="boolean"&&l||(u=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var p;const g=Array.from(this.localTrackMap.entries()).find(y=>{let[,{track:b}]=y;return n===b});if(!this.connection||!g||this.state!==qt.Connected)return void i();if(await((p=this.connection)===null||p===void 0?void 0:p.replaceTrack(n,g[1].id)),this.isPlanB){const y=g[1];y.id=n._mediaStreamTrack.id,this.localTrackMap.set(g[0],y)}if(g[0]===ge.LocalVideoTrack&&!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding){const y=this.localTrackMap.get(ge.LocalVideoLowTrack);if(y){const b=n._mediaStreamTrack.clone();y.track._originMediaStreamTrack.stop(),y.track._mediaStreamTrack=b,y.track._originMediaStreamTrack=b,await new xe((S,w)=>{this.handleReplaceTrack(y.track,S,w,!0)})}}i()}catch(g){o(g)}finally{var m;(m=u)===null||m===void 0||m()}}),D(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),D(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),D(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),D(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),D(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new F4(this.store),this.bindStatsUploaderEvents(),this.mutex=new Ar("P2PChannel-mutex",this.store.clientId),this.isPlanB=!It().supportUnifiedPlan||$("CHROME_FORCE_PLAN_B")&&nc(),this.shouldForwardP2PCreation=$("FORWARD_P2P_CREATION")&&It().supportPCSetConfiguration&&R5(),this.shouldForwardP2PCreation&&(this.connection=tg(this.store),this.emit(Ke.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=qt.New,this._forceTurn=bR(e),C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||i||t)&&((i||t)&&this.connection&&(C.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=tg(this.store,e),this.emit(Ke.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new oe(G.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=$("NEW_ICE_RESTART")?zc.FIRST_CONNECTION:zc.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new oe(G.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==qt.Connected){this.store.peerConnectionStart();const t=await this.connection.connect(e);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=qt.Connected,t}if(this.connection instanceof Bi&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),Ue.reportApiInvoke(this.store.sessionId,{name:Rn.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:hn.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Ke.RequestReconnect)});await this.connection.updateRemoteConnect(e)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(o=>{var l;let[u]=o;return fe(l=[ge.LocalVideoLowTrack,ge.LocalVideoTrack]).call(l,u)}),n=t.map(o=>{let[,{id:l}]=o;return l}),i=t.map(o=>{let[l]=o;return l});if(this.connection instanceof Bi||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if(Ue.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!fe(e).call(e,this.store.codec)){const o=["vp9","vp8","h264"].find(l=>fe(e).call(e,l));o&&(this.store.codec=o,C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(o,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Bi&&this.connection.peerConnectionState!=="closed"&&fe(e=[qt.New,qt.Connected]).call(e,this.state)?this.connection.establishPromise:void 0}async publishDataChannel(e){if(!this.connection||this.state!==qt.Connected){if(this.state===qt.Disconnected)throw new oe(G.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var i;fe(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var i=this;return Ls(function*(){const o=yield Tt(i.mutex.lock("From P2PChannel.publish"));try{var l;const u=i.connection&&fe(l=["disconnected","failed"]).call(l,i.connection.peerConnectionState);if(!i.connection||i.state!==qt.Connected||u){if(i.state===qt.Disconnected)throw new oe(G.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);const m=e.filter(g=>i.pendingLocalTracks.indexOf(g)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(m),void(u&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,rs.markPublishStart(i.store.clientId,i.store.pubId);const p=i.filterTobePublishedTracks(e,t,n);if(p.length===0)return void(yield Tt(i.tryToUnmuteAudio(e)));yield*ep(G4(i.doPublish(i.connection,p)))}finally{o()}})()}doPublish(e,t){var n=this;return Ls(function*(){t.forEach(S=>{let{track:w,type:k}=S;const I=Date.now();n.store.publish(w.getTrackId(),k===ge.LocalAudioTrack?"audio":"video",I)}),n.bindLocalTrackEvents(t);const i=t.map(S=>{let{track:w}=S;return w}),o=yield Tt(e.send(i,n.store.codec,n.store.audioCodec)),l=(yield Tt(o.next())).value,u=n.createGatewayPublishMessage(t,l);let p;try{p=yield u}catch(S){throw o.throw(S),(S==null?void 0:S.code)===G.WS_ABORT&&t.forEach(w=>{let{track:k}=w;n.pendingLocalTracks.indexOf(k)===-1&&n.pendingLocalTracks.push(k)}),n.unbindLocalTrackEvents(t),S}const m=n.mapPubResToRemoteConfig(u,p,i),g=(yield Tt(o.next(m))).value;if(n.state===qt.Disconnected)throw new oe(G.UNEXPECTED_ERROR,"PeerConnection already disconnected.");$("ENABLE_VIDEO_SEI");const y=$("ENABLE_ENCODED_TRANSFORM"),b=$("ENABLE_AUDIO_METADATA");i.forEach(async S=>{const w=S.getRTCRtpTransceiver();if(!w||!y)return;const{interceptLocalVideoFrame:k,interceptLocalAudioFrame:I}=wE();S.trackMediaType===Me.VIDEO?await k(w.sender,S):S.trackMediaType===Me.AUDIO&&await I(w.sender,{metadata:b?()=>{const O=S.metadata.shift();return O&&O.value}:void 0})}),t.forEach(S=>{let{type:w}=S;n.statsCollector.addLocalStats(w)}),n.assignLocalTracks(t,g),n.statsUploader.startUploadOutboundStats(),t.forEach(S=>{let{track:w,type:k}=S;const I=Date.now();n.store.publish(w.getTrackId(),k===ge.LocalAudioTrack?"audio":"video",void 0,I)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof pn))return C.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,o=function(l,u){const p={};return l.height&&l.width&&(p.scaleResolutionDownBy=QC(l,u)),p.maxFramerate=l.framerate?Fs(l.framerate):void 0,p.maxBitrate=l.bitrate?1e3*l.bitrate:void 0,p}(e,i);if(i._encoderConfig||(i._encoderConfig={}),t!==ge.LocalVideoLowTrack||!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding)o.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=o.scaleResolutionDownBy);else{const l=i._originMediaStreamTrack;if(!l.canvas)return C.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(u,p){const m=u.canvas;p.width&&(m.width=Fs(p.width)),p.height&&(m.height=Fs(p.height)),p.framerate&&(m.stopCapture&&m.stopCapture(),m.stopCapture=SC(()=>{!m.startCapture&&m.stopCapture&&m.stopCapture(),m.startCapture&&m.startCapture()},Fs(p.framerate)))})(l,e)}o.maxBitrate!=null&&(i._encoderConfig.bitrateMax=o.maxBitrate/1e3),o.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=o.maxFramerate:i._encoderConfig.frameRate={max:o.maxFramerate}),C.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(e){var t=this;return Ls(function*(){if(!t.connection||t.state!==qt.Connected)return;const n=yield Tt(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const o=t.localTrackMap.get(ge.LocalVideoTrack);if(!o)throw new oe(G.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(ge.LocalVideoLowTrack))throw new oe(G.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const l=[{track:t.getLowVideoTrack(o.track,e),type:ge.LocalVideoLowTrack}];if(yield*ep(G4(t.doPublish(t.connection,l))),o.track.muted||!o.track.enabled){var i;const u=(i=t.localTrackMap.get(ge.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;u!==void 0&&(yield Tt(t.connection.muteLocal([u])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(C.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ar(this,Ke.RequestRePublish,this.pendingLocalTracks),this.emit(Ke.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(C.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ar(this,Ke.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:i}=this.pendingRemoteTracks[t];(i!==Me.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==Me.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await ar(this,Ke.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===Me.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Ke.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==qt.Connected)return void e.forEach(i=>{const o=this.pendingLocalTracks.indexOf(i);o!==-1&&this.pendingLocalTracks.splice(o,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==qt.Connected)return void e.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==qt.Connected)return;const e=this.localTrackMap.get(ge.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[ge.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(i=>{let[,{id:o}]=i;return o})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[o,{track:l}]=i;return{type:o,track:l}})),t.forEach(i=>{let[o]=i;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==qt.Connected)throw new oe(G.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(i=>{var o;return!((o=this.remoteDataChannelMap.get(e))!==null&&o!==void 0&&o.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(i=>{var o;this.remoteDataChannelMap.has(e)?(o=this.remoteDataChannelMap.get(e))===null||o===void 0||o.set(i.id,i):this.remoteDataChannelMap.set(e,new Map([[i.id,i]]));const l=this.pendingRemoteDataChannels.findIndex(u=>{let{user:p,id:m}=u;return p.uid===e.uid&&m===i.id});l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),n.map(i=>i.id)}async subscribe(e,t,n,i,o){var l;if(!this.connection||this.state!==qt.Connected)throw new oe(G.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((l=this.remoteUserMap.get(e))!==null&&l!==void 0&&l.has(t))return;let u,p,m,g;const y=this.connection.getPreMedia(n);if(y)C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),m=y.transceiver,u=y.track,p=y.mid,g=y.player,y.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:y.firstVideoRender});else if(o){const w=o.find(I=>{let{stream_type:O}=I;return O===t});if(!w)throw new oe(G.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const k=await this.connection.receive(t,w.ssrcs,String(e._uintid),w.attributes);(this.connection instanceof Bi||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(m=k.transceiver),u=k.track,p=k.id}else{const w=await this.connection.receive(t,[{ssrcId:n,rtx:i}],String(e._uintid),void 0);(this.connection instanceof Bi||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(m=w.transceiver),u=w.track,p=w.id}if(t===Me.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new _p(u,e.uid,e._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new gp(u,e.uid,e._uintid,this.store,g),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(ro.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(ro.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),g?e._videoTrack.once(ro.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(ro.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack)),m&&$("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:w,interceptRemoteAudioFrame:k}=wE();t==Me.VIDEO?await w(m.receiver,{onSei:$("ENABLE_VIDEO_SEI")&&(I=>{var O;return(O=e._videoTrack)===null||O===void 0?void 0:O._onSei(I)}),onFirstFrame:I=>{var O;const W=Array.from(us(O=this.remoteUserMap).call(O)).find(H=>H._videoSSRC===I.ssrc);W&&this.store.firstVideoFrameDecoded(W.uid,{firstReceivedEncodedFrame:Date.now(),frameType:I.type,rtpTimestamp:I.rtpTimestamp,framePayloadType:I.payloadType,frameDataLength:I.length,mimeType:I.mimeType})}}):t==Me.AUDIO&&await k(m.receiver,{enableTopn:!!$("ENABLE_AUDIO_TOPN"),enableMetadata:!!$("ENABLE_AUDIO_METADATA"),enablePts:!!$("ENABLE_AUDIO_PTS"),onMetadata:I=>{this.safeEmit(Ke.AudioMetadata,I)},onPts:I=>{this.safeEmit(Ke.AudioPts,I)}})}const b=this.remoteUserMap.get(e);b?b.set(t,p):this.remoteUserMap.set(e,new Map([[t,p]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const S=this.pendingRemoteTracks.findIndex(w=>{let{user:k,kind:I}=w;return k.uid===e.uid&&t===I});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(Ke.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==qt.Connected)throw new oe(G.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(o=>{var l;let{user:u,mediaType:p}=o;return!((l=this.remoteUserMap.get(u))!==null&&l!==void 0&&l.has(p))});const t=[],n=new Map;e.forEach(o=>{if(!this.connection)return;const l=this.connection.getPreMedia(o.ssrcId);if(l){const{track:u,mid:p,transceiver:m,player:g}=l;n.set(o.ssrcId,{track:u,id:p,transceiver:m,player:g})}else t.push(o)});const i=await this.connection.batchReceive(t.map(o=>{let{user:l,mediaType:u,ssrcId:p,rtxSsrcId:m}=o;return{kind:u,ssrcMsg:[{ssrcId:p,rtx:m}],mslabel:String(l._uintid)}}));t.forEach((o,l)=>{n.set(o.ssrcId,i[l])});for(const{user:o,mediaType:l,ssrcId:u}of e){const p=n.get(u);if(!p)return void C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(o.uid," subscribe data,").concat(l,", ").concat(u));const{track:m,id:g,transceiver:y,player:b}=p;if(y&&$("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:I}=wE();l==Me.VIDEO?await k(y.receiver,{onSei:$("ENABLE_VIDEO_SEI")&&(O=>{var W;return(W=o._videoTrack)===null||W===void 0?void 0:W._onSei(O)}),onFirstFrame:O=>{var W;const H=Array.from(us(W=this.remoteUserMap).call(W)).find(Y=>Y._videoSSRC===O.ssrc);H&&this.store.firstVideoFrameDecoded(H.uid,{firstReceivedEncodedFrame:Date.now(),frameType:O.type,rtpTimestamp:O.rtpTimestamp,framePayloadType:O.payloadType,frameDataLength:O.length,mimeType:O.mimeType})}}):l==Me.AUDIO&&await I(y.receiver,{enableTopn:!!$("ENABLE_AUDIO_TOPN"),enableMetadata:!!$("ENABLE_AUDIO_METADATA"),enablePts:!!$("ENABLE_AUDIO_PTS"),onMetadata:O=>{this.safeEmit(Ke.AudioMetadata,O)},onPts:O=>{this.safeEmit(Ke.AudioPts,O)}})}if(l===Me.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(m):(o._audioTrack=new _p(m,o.uid,o._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),y&&o._audioTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(m):(o._videoTrack=new gp(m,o.uid,o._uintid,this.store,b),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),y&&o._videoTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(o,o._videoTrack)),$("ENABLE_VIDEO_SEI")&&y){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:I}=wE();l==Me.VIDEO?await k(y.receiver,{onSei:O=>{var W;(W=o._videoTrack)===null||W===void 0||W._onSei(O)},onFirstFrame:O=>{var W;const H=Array.from(us(W=this.remoteUserMap).call(W)).find(Y=>Y._videoSSRC===O.ssrc);H&&this.store.firstVideoFrameDecoded(H.uid,{firstReceivedEncodedFrame:Date.now(),frameType:O.type,rtpTimestamp:O.rtpTimestamp,framePayloadType:O.payloadType,frameDataLength:O.length,mimeType:O.mimeType})}}):l==Me.AUDIO&&await I(y.receiver)}const S=this.remoteUserMap.get(o);S?S.set(l,g):this.remoteUserMap.set(o,new Map([[l,g]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadInboundStats();const w=this.pendingRemoteTracks.findIndex(k=>{let{user:I,kind:O}=k;return I.uid===o.uid&&l===O});w!==-1&&(this.pendingRemoteTracks.splice(w,1),this.emit(Ke.MediaReconnectEnd,o.uid))}}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(u=>{let{user:p,kind:m}=u;return t!==void 0?p.uid===e.uid&&t===m:p.uid===e.uid});if(i.forEach(u=>{const p=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(p,1)}),this.connection&&this.state===qt.Connected||n||i.forEach(u=>{let{kind:p}=u;var m;if(p===Me.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(p===Me.VIDEO){var g;(g=e._videoTrack)===null||g===void 0||g._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==qt.Connected)return;const o=this.filterTobeUnSubscribedTracks(e,t);if(o.length===0)return;await this.connection.stopReceiving(o.map(u=>{let[,{id:p}]=u;return p}));const l=this.createUnsubscribeMessage(o);return this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),o.forEach(u=>{let[p,{kind:m}]=u;var g,y;if(m===Me.VIDEO&&p._videoSSRC&&((g=this.connection)===null||g===void 0||g.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),m===Me.VIDEO)this.unbindRemoteTrackEvents(p._videoTrack),n||((y=p._videoTrack)===null||y===void 0||y._destroy(),p._videoTrack=void 0);else if(m===Me.AUDIO){var b;this.unbindRemoteTrackEvents(p._audioTrack),!n&&((b=p._audioTrack)===null||b===void 0||b._destroy(),p._audioTrack=void 0)}}),l}async unsubscribeDataChannel(e,t){if(t.forEach(o=>{const l=this.pendingRemoteDataChannels.findIndex(u=>u.id===o.id);l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(o=>{o._close()});const i=this.remoteDataChannelMap.get(e);return n.forEach(o=>{i&&i.delete(o.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(o=>o.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:o,mediaType:l}of e){const u=this.pendingRemoteTracks.filter(p=>{let{user:m,kind:g}=p;return l!==void 0?m.uid===o.uid&&l===g:m.uid===o.uid});u.forEach(p=>{const m=this.pendingRemoteTracks.indexOf(p);this.pendingRemoteTracks.splice(m,1)}),t=t.concat(u)}if(!this.connection||this.state!==qt.Connected)return void t.forEach(o=>{let{user:l,kind:u}=o;var p;if(u===Me.AUDIO)(p=l._audioTrack)===null||p===void 0||p._destroy(),l._audioTrack=void 0;else if(u===Me.VIDEO){var m;(m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0}});const n=Zi(e).call(e,(o,l)=>{let{user:u,mediaType:p}=l;const m=this.filterTobeUnSubscribedTracks(u,p);return o.concat(m)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(o=>{let[,{id:l}]=o;return l}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(o=>{let[l,{kind:u}]=o;var p,m;if(u===Me.VIDEO&&l._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===Me.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),(m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0;else if(u===Me.AUDIO){var g;this.unbindRemoteTrackEvents(l._audioTrack),(g=l._audioTrack)===null||g===void 0||g._destroy(),l._audioTrack=void 0}}),i}isPreSubScribe(e){return!this.connection||this.state!==qt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void C.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void C.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===Me.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void C.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||C.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(ge.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(ge.LocalAudioTrack);if((t==null?void 0:t.track)instanceof ur){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return o!==ge.LocalAudioTrack}).filter(i=>{let[o]=i;return!(e&&o===ge.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===ge.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,i,o){if(e){const u=this.localTrackMap.get(ge.LocalAudioTrack),p=i?this.localTrackMap.get(ge.LocalVideoLowTrack):this.localTrackMap.get(ge.LocalVideoTrack);Ue.publish(this.store.sessionId,{eventElapse:rs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(Xt.SCREEN_TRACK))!==-1,audio:!!u,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var l;n||(n=[]);const u=n.find(m=>m instanceof Wn),p=i?(l=this.localTrackMap.get(ge.LocalVideoTrack))===null||l===void 0?void 0:l.track:n.find(m=>m instanceof pn);Ue.publish(this.store.sessionId,{eventElapse:rs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(Xt.SCREEN_TRACK))!==-1,audio:!!u,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,i){const o=i===Me.VIDEO?n._videoSSRC:n._audioSSRC;o&&Ue.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Me.VIDEO,audio:i===Me.AUDIO,peerid:n.uid,subscribeRequestid:o,p2pid:this.store.p2pId,eventElapse:rs.measureFromSubscribeStart(this.store.clientId,o),preSsrc:this.isPreSubScribe(o)})}reset(){C.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ar("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=tg(this.store),this.emit(Ke.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ge.LocalAudioTrack);if((e==null?void 0:e.track)instanceof ur){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=qt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ge.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ge.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof pn||t&&t.track instanceof Wn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(us(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ge.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Wd(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.connection&&(C.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=qt.Reconnecting,$("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=tg(this.store),this.emit(Ke.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case ge.LocalVideoTrack:fe(t=i._hints).call(t,Xt.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ge.LocalAudioTrack:i instanceof ur?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ge.LocalVideoLowTrack:}}),this.emit(Ke.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(us(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Ke.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(us(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(t,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),C.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:i,id:o}=n;if((e instanceof Fl?e.uid:e)===i.uid&&o===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:o}=n;if((e instanceof Fl?e.uid:e)===i.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Ls(function*(){if(!t.connection||t.state!==qt.Connected)return;const n=yield Tt(t.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield Tt(t.connection.restartICE(e));const l=yield Tt(i.next());if(l.done)return;const u=l.value,p=yield u;switch(vR(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Ir.UDP_TCP_RELAY:t._pcStatsUploadType=zc.UDP_TCP_RESTART;break;case Ir.TCP_RELAY:t._pcStatsUploadType=zc.TCP_RESTART;break;case Ir.RELAY:t._pcStatsUploadType=zc.RELAY_RESTART;break;default:t._pcStatsUploadType=zc.OLD_RESTART}t._isTryConnecting=!0,i.next(p)}catch(l){var o;(o=i)===null||o===void 0||o.throw(l)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(ge.LocalVideoTrack),n=this.localTrackMap.get(ge.LocalAudioTrack),i=e.videoSend.find(w=>w.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),o=e.audioSend.find(w=>w.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!o)return 1;const l=yi(this,Ke.NeedSignalRTT),u=i?i.rttMs:void 0,p=o?o.rttMs:void 0,m=u&&p?(u+p)/2:u||p,g=(m&&l?(m+l)/2:m||l)||0,y=100*e.sendPacketLossRate*.7/50+.3*g/1500,b=y<.17?1:y<.36?2:y<.59?3:y<.1?4:5,S=t==null?void 0:t.track;if(S&&S._encoderConfig&&S._hints.indexOf(Xt.SCREEN_TRACK)===-1){const w=S._encoderConfig.bitrateMax,k=e.bitrate.actualEncoded;if(w&&k){const I=(1e3*w-k)/(1e3*w);return IV[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][b]}}return b}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const o=i._audioSSRC,l=i._videoSSRC,u=e.audioRecv.find(k=>k.ssrc===o),p=e.videoRecv.find(k=>k.ssrc===l);if(!u&&!p)return void(t+=1);const m=yi(this,Ke.NeedSignalRTT),g=e.rtt,y=(g&&m?(g+m)/2:g||m)||0,b=u?u.jitterMs:void 0,S=e.recvPacketLossRate;let w=.7*S*100/50+.3*y/1500;b&&(w=.6*S*100/50+.2*y/1500+.2*b/400),t+=w<.1?1:w<.17?2:w<.36?3:w<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new xe((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(C.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==qt.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:u}]=l;return e===u});if(!i)return;const o=i[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:o}]),this.bindLocalTrackEvents([{track:t,type:o}]),i[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,i[1].id)),this.isPlanB){const l=i[1];l.id=t._mediaStreamTrack.id,this.localTrackMap.set(o,l)}if(o===ge.LocalVideoTrack&&!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding){const l=this.localTrackMap.get(ge.LocalVideoLowTrack);if(l){const u=e._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=u,l.track._originMediaStreamTrack=u,await new xe((p,m)=>{this.handleReplaceTrack(l.track,p,m,!0)})}}}filterTobePublishedTracks(e,t,n){const i=[],o=this.getAllTracks();e=rp(e=e.filter(m=>o.indexOf(m)===-1));let l,u=!1;const p=this.localTrackMap.get(ge.LocalAudioTrack);for(const m of e){if(m instanceof pn&&(this.localTrackMap.has(ge.LocalVideoTrack)||u?new oe(G.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:m,type:ge.LocalVideoTrack}),u=!0),t)){const g=this.getLowVideoTrack(m,n);i.push({track:g,type:ge.LocalVideoLowTrack})}if(m instanceof Wn)if(p){const g=p.track;if(g instanceof ur)yR([m]),g.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0);else{const y=ER([g,m]);C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(y.getTrackId(),"]")),this.replaceTrack(g,y)}}else l instanceof ur?(yR([m]),l.addAudioTrack(m)):l||!m._useAudioElement&&It().webAudioMediaStreamDest&&!m._bypassWebAudio?l=ER(l?[m,l]:[m]):l=m}return l&&(C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(l.getTrackId(),"]")),i.push({track:l,type:ge.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=rp(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof Wn){const o=this.localTrackMap.get(ge.LocalAudioTrack);if(!o)continue;o.track instanceof ur?(o.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),o.track.trackList.length===0&&(t.push([ge.LocalAudioTrack,o]),o.track.close())):t.push([ge.LocalAudioTrack,o])}if(i instanceof pn){const o=this.localTrackMap.get(ge.LocalVideoTrack);if(!o)continue;t.push([ge.LocalVideoTrack,o]);const l=this.localTrackMap.get(ge.LocalVideoLowTrack);l&&t.push([ge.LocalVideoLowTrack,l])}}return t}filterTobePublishedDataChannels(e){return e=(e=rp(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=rp(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ge.LocalVideoTrack:n.addListener(Ve.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ve.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ge.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ge.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof ur?e.trackList.forEach(n=>{n.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Ve.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ge.LocalVideoTrack:n.off(Ve.GET_STATS,this.handleGetLocalVideoStats),n.off(Ve.GET_RTC_STATS,this.handleGetRTCStats),n.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ge.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ge.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof ur?e.trackList.forEach(t=>{t.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ve.GET_STATS,this.handleGetLocalAudioStats),t.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ve.GET_STATS,this.handleGetLocalAudioStats),e.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ve.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof gp&&t.addListener(Ve.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof _p&&t.addListener(Ve.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ve.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Me.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Me.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var o;let l,u,{track:p,type:m}=n;switch(m){case ge.LocalAudioTrack:l=tn.Audio,u={dtx:p instanceof Wf&&p._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ge.LocalVideoTrack:l=fe(o=p._hints).call(o,Xt.SCREEN_TRACK)?tn.Screen:tn.High,u=uc(uc({},HV(p)),{},{codec:this.store.codec,svc_mode:zf()});break;case ge.LocalVideoLowTrack:l=tn.Low,u=uc(uc({},HV(p)),{},{codec:this.store.codec,svc_mode:zf()})}return{stream_type:l,attributes:u,ssrcs:t[i]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[o,{track:l,ssrcs:u,id:p}]=t;switch(o){case ge.LocalVideoTrack:i=fe(n=l._hints).call(n,Xt.SCREEN_TRACK)?tn.Screen:tn.High;break;case ge.LocalAudioTrack:i=tn.Audio;break;case ge.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:u,mid:p}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:o,type:l}=n;this.localTrackMap.set(l,{track:o,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Ke.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Bi&&!Sn()&&$("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},$("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Bi&&B4(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=zc.DISCONNECTED_OR_FAILED,yi(this,Ke.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(o=>o.getTrackId()),i=this.pendingLocalDataChannels.map(o=>"dc_".concat(o.id));Ue.reportApiInvoke(this.store.sessionId,{name:Rn.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:hn.TRACER}).onSuccess(),this.republish()}if($("NEW_ICE_RESTART")&&e instanceof Bi&&!Sn()&&!this._forceTurn&&!this.store.useDcSignal){if(fe(VV).call(VV,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=o=>{vR(e)&&(C.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(o)),yi(this,Ke.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ke.RequestRestartICE,o))},i=()=>{vR(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),C.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ke.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{$4(e,n,i)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&$("ICE_RESTART")&&yi(this,Ke.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ke.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Ke.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Ke.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Ue.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:hn.TRACER}).onSuccess(),this.emit(Ke.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(us(n=this.remoteUserMap).call(n)).find(l=>l._audioSSRC===t);var o;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(o=i.audioTrack)===null||o===void 0||o.emit(ro.FIRST_FRAME_DECODED),Ue.firstRemoteFrame(this.store.sessionId,dr.FIRST_AUDIO_DECODE,Nn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:rs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(us(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);i&&Ue.firstRemoteFrame(this.store.sessionId,dr.FIRST_AUDIO_RECEIVED,Nn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:rs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{var o;const l=Array.from(us(o=this.remoteUserMap).call(o)).find(u=>u._videoSSRC===t);l&&this.store.firstVideoFrameDecoded(l.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoRender=t=>{var n;const i=Array.from(us(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(i),this.emit(Ke.FirstVideoPreRender,i.uid,t))},e.onFirstVideoReceived=t=>{var n;const i=Array.from(us(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstReceived:Date.now()}),Ue.firstRemoteFrame(this.store.sessionId,dr.FIRST_VIDEO_RECEIVED,Nn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:rs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstVideoBufferReady=t=>{var n;const i=Array.from(us(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);i&&this.emit(Ke.FirstVideoBufferReady,i.uid,t)},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&i===o||this.emit(Ke.ConnectionTypeChange,i),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ul(n))," -> ").concat(JSON.stringify(Ul(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ul(n))," -> ").concat(JSON.stringify(Ul(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return uc(uc({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}fallbackConnection(){C.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===qt.Connected?(C.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=tg(this.store),this.emit(Ke.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(e){e instanceof Bi&&function(t){Op.delete(t.id),B4(t)}(e),e.close(),this.emit(Ke.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ge.LocalAudioTrack);if(e instanceof Wn&&(n==null?void 0:n.track)instanceof ur)return n.track.isActive||t.push([ge.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:l}]=o;return e===l});if(i&&(t.push(i),i[0]===ge.LocalVideoTrack)){const o=this.localTrackMap.get(ge.LocalVideoLowTrack);o&&t.push([ge.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ge.LocalAudioTrack);if(e instanceof Wn&&(n==null?void 0:n.track)instanceof ur)return n.track.isActive&&t.push([ge.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:l}]=o;return e===l});if(i)if(i[0]===ge.LocalVideoTrack){t.push(i);const o=this.localTrackMap.get(ge.LocalVideoLowTrack);o&&t.push([ge.LocalVideoLowTrack,o])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[o,{track:l,ssrcs:u,id:p}]=t;switch(o){case ge.LocalAudioTrack:i=tn.Audio;break;case ge.LocalVideoTrack:i=fe(n=l._hints).call(n,Xt.SCREEN_TRACK)?tn.Screen:tn.High;break;case ge.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:u,mid:p}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[o,{track:l,ssrcs:u,id:p}]=t;switch(o){case ge.LocalAudioTrack:i=tn.Audio;break;case ge.LocalVideoTrack:i=fe(n=l._hints).call(n,Xt.SCREEN_TRACK)?tn.Screen:tn.High;break;case ge.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:u,mid:p}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const o=i.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(i.entries()).forEach(o=>{let[l,u]=o;n.push([e,{kind:l,id:u}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(i=>{var o;(o=this.remoteDataChannelMap.get(e))!==null&&o!==void 0&&o.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:o,id:l}]=n;switch(o){case Me.VIDEO:return void(i._videoSSRC&&t.push({stream_type:Me.VIDEO,ssrcId:i._videoSSRC}));case Me.AUDIO:return void(i._audioSSRC&&t.push({stream_type:Me.AUDIO,ssrcId:i._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[i,{kind:o}]=n;if(t.has(i)){let l=t.get(i);o===Me.VIDEO?l|=Sr.Video:l|=Sr.Audio,t.set(i,l)}else o===Me.VIDEO?t.set(i,Sr.Video):t.set(i,Sr.Audio)}),{users:Array.from(t.entries()).map(n=>{let[i,o]=n;return{stream_id:i.uid,stream_type:o}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const o=this.remoteUserMap.get(n);o&&(o.delete(i),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ge.LocalVideoTrack),n=this.localTrackMap.get(ge.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new xe((i,o)=>{this.handleUpdateVideoEncoder(t.track,i,o,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new xe((i,o)=>{this.handleUpdateVideoEncoder(n.track,i,o,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof Bi&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Bi)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof Bi&&this.connection.isPreRender}mapPubResToRemoteConfig(e,t,n){return e.map((i,o)=>{var l;let{stream_type:u}=i;const p=(l=t.find(m=>{let{stream_type:g}=m;return u===g}))===null||l===void 0?void 0:l.attributes;if(p&&$("DISABLE_SCREEN_SHARE_REMB")){const m=n[o]._hints;(fe(m).call(m,Xt.SCREEN_TRACK)||fe(m).call(m,Xt.SCREEN_LOW_TRACK))&&(p.remb=!1,C.debug("disable remb for screen share, hints:",m))}return p})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Wn){var t;const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(i.map(l=>{let[,{id:u}]=l;return u})));const o=this.createUnmuteMessage(i);return void await mn(this,Ke.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ke.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Ke.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await vr(Fy(this.dtlsFailedCount,Zn)),this.emit(Ke.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await ar(this,Ke.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Ke.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ge.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof pn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof pn).length>1)throw new oe(G.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Wn).length>1&&(e.some(t=>t instanceof Wn&&t._bypassWebAudio)||!It().webAudioMediaStreamDest))throw new oe(G.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof pn&&this.pendingLocalTracks.some(n=>n instanceof pn))throw new oe(G.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Wn&&this.pendingLocalTracks.some(n=>n instanceof Wn)&&(!It().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Wn&&n._bypassWebAudio)))throw new oe(G.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const i=!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding,o=uc(uc({},{width:160,height:120,framerate:15,bitrate:50}),t);let l;l=i?e._mediaStreamTrack.clone():SR(e,o);const u=Zt(8,"track-low-"),p=new pn(l,uc(uc({},i&&{scaleResolutionDownBy:QC(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return p.on(cu.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,dp.LOW_STREAM)}),p._hints.push(Xt.LOW_STREAM),fe(n=e._hints).call(n,Xt.SCREEN_TRACK)&&p._hints.push(Xt.SCREEN_LOW_TRACK),e.on("sei-to-send",m=>{p.emit("sei-to-send",m)}),e.addListener(Ve.NEED_CLOSE,()=>{p.close()}),p}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Bi){var o,l,u,p;const m=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:g,dtlsTransportState:y,peerConnectionState:b}=this.connection,{local:S,remote:w}=await this.connection.getSelectedCandidatePair();Ue.pcStats(this.store.sessionId,{startTime:m,eventElapse:e-m||0,iceconnectionsate:g,dtlsstate:y,connectionstate:b,intSucc:t?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(o=S==null?void 0:S.protocol)!==null&&o!==void 0?o:"",selectedLocalCandidateType:(l=S.candidateType)!==null&&l!==void 0?l:"",selectedLocalCandidateAddress:"".concat(S.address,":").concat(S.port),selectedRemoteCandidateProtocol:(u=w.protocol)!==null&&u!==void 0?u:"",selectedRemoteCandidateType:(p=w.candidateType)!==null&&p!==void 0?p:"",selectedRemoteCandidateAddress:"".concat(w.address,":").concat(w.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(y=>y.userId===e.uid);if(!n)return;const{isInternalUpload:i,isExternalUpload:o}=n;if(i&&o)return;const{subscribeEnd:l,firstPreRender:u,peerPublishDuration:p,peerPubStatusMs:m}=n;let{firstRender:g=0}=n;if(l&&(g||u)&&p&&m){n.isInternalUpload=!0;const{playEnd:y}=n;y&&(n.isExternalUpload=!0);const{firstPreRender:b=0}=n;g=b||g;const S=e.videoTrack,w={peer:e._uintid,width:(S==null?void 0:S._videoWidth)||0,height:(S==null?void 0:S._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:p,peerPubStatusMs:m,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:b||0,firstRender:y?Math.max(g,y):Math.max(g,l),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:uU(this.store),firstReceivedEncodedFrame:n.firstReceivedEncodedFrame||0,frameType:n.frameType||"",rtpTimestamp:n.rtpTimestamp||0,framePayloadType:n.framePayloadType||0,frameDataLength:n.frameDataLength||0,mimeType:n.mimeType||""};Ue.firstXLAPeerFirstVideoFrame(this.store.sessionId,w)}}reportVideoFirstFrameDecoded(e,t,n,i){var o;const l=Array.from(us(o=this.remoteUserMap).call(o)).find(u=>u._videoSSRC===e);if(l){i||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const u=this.store.keyMetrics,p=u.subscribe.find(m=>m.userId===l.uid&&m.type==="video");Ue.firstRemoteVideoDecode(this.store.sessionId,dr.FIRST_VIDEO_DECODE,Nn.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:n,subscribeElapse:rs.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:u.requestAPEnd||0,apStart:u.requestAPStart||0,joinGwEnd:u.joinGatewayEnd||0,joinGwStart:u.joinGatewayStart||0,pcEnd:u.peerConnectionEnd||0,pcStart:u.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:i?1:0,firstFrame:(p==null?void 0:p.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const o=i.get(t);if(!o)return!1;const l=await this.connection.getRemoteSSRC(o);return l!==void 0&&l!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ge.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,dp.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},we(Pt.prototype,"startP2PConnection",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"startP2PConnection"),Pt.prototype),we(Pt.prototype,"connect",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"connect"),Pt.prototype),we(Pt.prototype,"updateRemoteRTPCapabilities",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"updateRemoteRTPCapabilities"),Pt.prototype),we(Pt.prototype,"publishDataChannel",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"publishDataChannel"),Pt.prototype),we(Pt.prototype,"unpublish",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"unpublish"),Pt.prototype),we(Pt.prototype,"unpublishDataChannel",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"unpublishDataChannel"),Pt.prototype),we(Pt.prototype,"unpublishLowStream",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"unpublishLowStream"),Pt.prototype),we(Pt.prototype,"subscribeDataChannel",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"subscribeDataChannel"),Pt.prototype),we(Pt.prototype,"subscribe",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"subscribe"),Pt.prototype),we(Pt.prototype,"massSubscribe",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"massSubscribe"),Pt.prototype),we(Pt.prototype,"unsubscribe",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"unsubscribe"),Pt.prototype),we(Pt.prototype,"unsubscribeDataChannel",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"unsubscribeDataChannel"),Pt.prototype),we(Pt.prototype,"massUnsubscribe",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"massUnsubscribe"),Pt.prototype),we(Pt.prototype,"muteRemote",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"muteRemote"),Pt.prototype),we(Pt.prototype,"unmuteRemote",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"unmuteRemote"),Pt.prototype),we(Pt.prototype,"hasRemoteMediaWithLock",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"hasRemoteMediaWithLock"),Pt.prototype),we(Pt.prototype,"disconnectForReconnect",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"disconnectForReconnect"),Pt.prototype),we(Pt.prototype,"updateBitrateLimit",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"updateBitrateLimit"),Pt.prototype),we(Pt.prototype,"remoteMediaSsrcChanged",[_s],Object.getOwnPropertyDescriptor(Pt.prototype,"remoteMediaSsrcChanged"),Pt.prototype),Pt);function _s(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("From P2PChannel.".concat(t));try{for(var u=arguments.length,p=new Array(u),m=0;m<u;m++)p[m]=arguments[m];return await i.apply(this,p)}finally{l()}},n}function H4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function K4(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?H4(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H4(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Rde=Date.now(),Nde=20,TR=new Map,ME=new Map;async function z4(e){const t=TR.get(e),n=Array.isArray(t)&&t[t.length-1],i=ME.get(e);if(!n)return void(i.isSyncing=!1);const o={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const l=n.sendTs-i.firstSendTs,u=l-(Date.now()-i.firstRecvTs);u>0&&(i.firstRecvTs=Date.now()-l);let p=n.mediaDelay+u;p<=0?(t.pop(),Y4(n.context,o),p=0):p=Math.min(p,Nde),setTimeout(()=>t.length&&z4(e),p)}function Y4(e,t){e.safeEmit(Nt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function Ade(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return Y4(n,{uid:e.uid,payload:e.payload});const i="".concat(n.id,"-").concat(e.uid),o=TR.get(i)||[],l=o.findIndex(g=>e.sendTs>=g.sendTs),u=K4(K4({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});l===-1?o.push(u):o.splice(l,0,u),TR.set(i,o);let p=!1;var m;ME.has(i)?p=!((m=ME.get(i))===null||m===void 0||!m.isSyncing):ME.set(i,{isSyncing:p,firstRecvTs:0,firstSendTs:0}),p||z4(i)}const Ide=Ft().name;function q4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function X4(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?q4(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q4(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Pp="websdk_ng_cache_parameter",Ode=$("MAX_PRELOAD_ASYNC_LENGTH"),Pde=1e4,bu=new Map,Su=[];let CR=null,RR=0,NR=0;const jE=new Map,J4=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),Dde=function(e,t){const n=[];let i=0;const o=async()=>{const l=n.shift();l&&await l(),n.length>0&&i<t?o():i--};return async function(){for(var l=arguments.length,u=new Array(l),p=0;p<l;p++)u[p]=arguments[p];return new xe(async(m,g)=>{n.push(async()=>{try{const y=await e(...u);m(y)}catch(y){g(y)}}),i<t&&(i++,o())})}}(IR,Ode),AR=Ms.CancelToken.source();class kde{constructor(){D(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;const t=this._audioContext.sampleRate,n=10*t,i=this._audioContext.createBuffer(2,n,t),o=this._audioContext.createBufferSource();o.buffer=i;const l=this._audioContext.createMediaStreamDestination();return o.connect(l),o.start(),l.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}async function IR(e,t,n,i,o,l,u){try{if(!$("ENABLE_PRELOAD"))return;if(!It().supportWebCrypto)return void Pl(()=>{C.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new oe(G.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Vr(n,"token",1,2047),Vr(e,"appid",1,2047),hE(t),i&&pE(i);const p=su();C.debug("preload channel ".concat(t,", uid is ").concat(i));const m={appId:e,cname:t,token:n||e,uid:typeof i!="string"?i:null,sid:p,proxyServer:o,role:u};let g,y;typeof i=="string"?(m.stringUid=i,[y,g]=await xe.all([fde(i,{sid:p,appId:e},AR.token),b4(X4(X4({},m),{},{token:n||e,uid:0}),AR.token)]),m.uid=y.uid,g.gatewayInfo.uid=m.uid,g.gatewayInfo.res.uid=m.uid):(l&&(m.stringUid=l),g=await b4(m,AR.token));const b={sid:p,appId:e,cname:t,token:n||e,uid:m.stringUid||i,intUid:m.uid||g.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:y,ap:g};await PR(b),RR++}catch(p){throw NR++,function(m){CR||(CR=window.setTimeout(()=>{let y="";jE.forEach((b,S)=>{y+="".concat(S,": ").concat(b," ;")}),Ue.reportApiInvoke(null,{name:Rn.PRELOAD,options:{success:RR,failed:NR,err:y}}).onError(m),RR=0,NR=0,jE.clear(),CR=null},Pde));const g=jE.get(m.code)||0;jE.set(m.code,g+1)}(p),p}}async function OR(e){try{if($("AP_REQUEST_DETAIL")||$("ENABLE_ROLE_SELECT_EDGE"))return;const t=Q4(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(i,o){try{const l=await window.crypto.subtle.importKey("raw",V5(o),"AES-GCM",!1,["decrypt"]),u=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:J4},l,ru(i));return JSON.parse(window.atob(Dl(new Uint8Array(u))))}catch{return}}(t,e.token||e.appId);if(!n||!function(i,o){return i.cname===o.cname&&i.appId===o.appId&&i.token===o.token?o.stringUid?i.stringUid===o.stringUid:typeof o.uid=="number"?i.uid===o.uid:i.uid==o.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<$("AP_CACHE_LIFETIME"))return n}catch(t){C.warn("Error get preloadInfo",t.message)}}function Q4(e){let t;try{if(t=tF(Pp),!t)return;const n=JSON.parse(t),i=nF(e),o=function(u,p){for(let m=u.length-1;m>=0;m--)if(p(u[m]))return m;return-1}(n,u=>i in u);if(o===-1)return;const l=n.splice(o,1)[0];return UE(Pp,JSON.stringify(n)),l[i]}catch(n){C.warn("Error delete preload info: ".concat(t),n.message),UE(Pp,"")}}async function PR(e){let t;try{e.uid&&Q4({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const n=nF(e),i=await async function(l,u){try{const p=await window.crypto.subtle.importKey("raw",V5(u),"AES-GCM",!1,["encrypt"]),m=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:J4},p,ru(window.btoa(JSON.stringify(l))));return Dl(new Uint8Array(m))}catch{return}}(e,e.token||e.appId);if(!i)return;t=tF(Pp);const o=t?JSON.parse(t):[];o.push({[n]:i}),o.length>$("AP_CACHE_NUM")&&o.shift(),UE(Pp,JSON.stringify(o))}catch(n){C.warn("Error caching server parameters:",n.message),UE(Pp,"")}}function DR(e){if(e){let t=bu.get(e);t&&(window.clearTimeout(t),t=null,bu.delete(e)),fe(Su).call(Su,e)||e.cloudProxyServer!=="disabled"||Su.push(e)}if(bu.size<$("AP_CACHE_NUM")&&Su.length>0){const t=Su.shift();bu.set(t,window.setTimeout(async()=>{const{appId:n,cname:i,token:o,stringUid:l,uid:u,proxyServer:p,role:m}=t;try{await Dde(n,i,o,u,p,l,m),bu.has(t)&&DR(t)}catch(g){C.warn("update preload failed",g.message),Z4(t)}},$("AP_UPDATE_INTERVAL")))}}function Z4(e){const t=Su.indexOf(e);t!==-1&&Su.splice(t,1);let n=bu.get(e);n&&(window.clearTimeout(n),n=null,bu.delete(e),DR())}function eF(e,t){const n=e.sua,i=e.ap;t&&n&&Ue.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),Ue.reportResourceTiming(e.ap.url,e.sid),Ue.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(o=>o.ip).join(","),eventType:"disabled",unilbsServerIds:[er.CHOOSE_SERVER,er.CLOUD_PROXY_FALLBACK].toString()}),Ue.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(o=>o.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[er.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function tF(e){return window.atob(window.localStorage.getItem(e)||"")}function UE(e,t){window.localStorage.setItem(e,window.btoa(t))}function nF(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),K5(t)}function Lde(e){let t=function(){const n=Ude.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let o=n.appId;o!==void 0&&(tr(i,10),$l(i,o));let l=n.cid;l!==void 0&&(tr(i,16),tr(i,l));let u=n.cname;u!==void 0&&(tr(i,26),$l(i,u));let p=n.deviceId;p!==void 0&&(tr(i,34),$l(i,p));let m=n.elapse;m!==void 0&&(tr(i,40),Wl(i,m));let g=n.fileSize;g!==void 0&&(tr(i,48),Wl(i,Dp(g)));let y=n.height;y!==void 0&&(tr(i,56),Wl(i,Dp(y)));let b=n.jpg;b!==void 0&&(tr(i,66),tr(i,b.length),sF(i,b));let S=n.networkType;S!==void 0&&(tr(i,72),Wl(i,Dp(S)));let w=n.osType;w!==void 0&&(tr(i,80),Wl(i,Dp(w)));let k=n.requestId;k!==void 0&&(tr(i,90),$l(i,k));let I=n.sdkVersion;I!==void 0&&(tr(i,98),$l(i,I));let O=n.sequence;O!==void 0&&(tr(i,104),Wl(i,Dp(O)));let W=n.sid;W!==void 0&&(tr(i,114),$l(i,W));let H=n.timestamp;H!==void 0&&(tr(i,120),Wl(i,H));let Y=n.uid;Y!==void 0&&(tr(i,128),tr(i,Y));let Q=n.vid;Q!==void 0&&(tr(i,136),tr(i,Q));let Z=n.width;Z!==void 0&&(tr(i,144),Wl(i,Dp(Z)));let q=n.service;q!==void 0&&(tr(i,152),tr(i,q));let ee=n.callbackData;ee!==void 0&&(tr(i,162),tr(i,ee.length),sF(i,ee));let ce=n.ticket;ce!==void 0&&(tr(i,170),$l(i,ce));let me=n.vendorConfigs;me!==void 0&&(tr(i,178),$l(i,me))}(e,t),function(n){let i=n.bytes,o=n.limit;return i.length===o?i:i.subarray(0,o)}(t)}function Mde(e){return function(n){let i={};e:for(;!Vde(n);){let o=rg(n);switch(o>>>3){case 0:break e;case 1:i.code=rg(n);break;case 2:i.msg=iF(n,rg(n));break;case 3:i.requestId=iF(n,rg(n));break;case 4:i.timestamp=Fde(n,!1);break;default:jde(n,7&o)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function jde(e,t){switch(t){case 0:for(;128&$o(e););break;case 2:kR(e,rg(e));break;case 5:kR(e,4);break;case 1:kR(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Dp(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Ude=[];function kR(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Vde(e){return e.offset>=e.limit}function VE(e,t){let n=e.bytes,i=e.offset,o=e.limit,l=i+t;if(l>n.length){let u=new Uint8Array(2*l);u.set(n),e.bytes=u}return e.offset=l,l>o&&(e.limit=l),i}function rF(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function sF(e,t){let n=VE(e,t.length);e.bytes.set(t,n)}function iF(e,t){let n=rF(e,t),i=String.fromCharCode,o=e.bytes,l="",u="";for(let p=0;p<t;p++){let m,g,y,b,S=o[p+n];128&S?(224&S)==192?p+1>=t?u+=l:(m=o[p+n+1],(192&m)!=128?u+=l:(b=(31&S)<<6|63&m,b<128?u+=l:(u+=i(b),p++))):(240&S)==224?p+2>=t?u+=l:(m=o[p+n+1],g=o[p+n+2],(49344&(m|g<<8))!=32896?u+=l:(b=(15&S)<<12|(63&m)<<6|63&g,b<2048||b>=55296&&b<=57343?u+=l:(u+=i(b),p+=2))):(248&S)==240?p+3>=t?u+=l:(m=o[p+n+1],g=o[p+n+2],y=o[p+n+3],(12632256&(m|g<<8|y<<16))!=8421504?u+=l:(b=(7&S)<<18|(63&m)<<12|(63&g)<<6|63&y,b<65536||b>1114111?u+=l:(b-=65536,u+=i(55296+(b>>10),56320+(1023&b)),p+=3))):u+=l:u+=i(S)}return u}function $l(e,t){let n=t.length,i=0;for(let u=0;u<n;u++){let p=t.charCodeAt(u);p>=55296&&p<=56319&&u+1<n&&(p=(p<<10)+t.charCodeAt(++u)-56613888),i+=p<128?1:p<2048?2:p<65536?3:4}tr(e,i);let o=VE(e,i),l=e.bytes;for(let u=0;u<n;u++){let p=t.charCodeAt(u);p>=55296&&p<=56319&&u+1<n&&(p=(p<<10)+t.charCodeAt(++u)-56613888),p<128?l[o++]=p:(p<2048?l[o++]=p>>6&31|192:(p<65536?l[o++]=p>>12&15|224:(l[o++]=p>>18&7|240,l[o++]=p>>12&63|128),l[o++]=p>>6&63|128),l[o++]=63&p|128)}}function $o(e){return e.bytes[rF(e,1)]}function oF(e,t){let n=VE(e,1);e.bytes[n]=t}function rg(e){let t,n=0,i=0;do t=$o(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function tr(e,t){for(t>>>=0;t>=128;)oF(e,127&t|128),t>>>=7;oF(e,t)}function Fde(e,t){let n,i=0,o=0,l=0;return n=$o(e),i=127&n,128&n&&(n=$o(e),i|=(127&n)<<7,128&n&&(n=$o(e),i|=(127&n)<<14,128&n&&(n=$o(e),i|=(127&n)<<21,128&n&&(n=$o(e),o=127&n,128&n&&(n=$o(e),o|=(127&n)<<7,128&n&&(n=$o(e),o|=(127&n)<<14,128&n&&(n=$o(e),o|=(127&n)<<21,128&n&&(n=$o(e),l=127&n,128&n&&(n=$o(e),l|=(127&n)<<7))))))))),{low:i|o<<28,high:o>>>4|l<<24,unsigned:t}}function Wl(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,l=o===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:o<128?9:10,u=VE(e,l),p=e.bytes;switch(l){case 10:p[u+9]=o>>>7&1;case 9:p[u+8]=l!==9?128|o:127&o;case 8:p[u+7]=l!==8?i>>>21|128:i>>>21&127;case 7:p[u+6]=l!==7?i>>>14|128:i>>>14&127;case 6:p[u+5]=l!==6?i>>>7|128:i>>>7&127;case 5:p[u+4]=l!==5?128|i:127&i;case 4:p[u+3]=l!==4?n>>>21|128:n>>>21&127;case 3:p[u+2]=l!==3?n>>>14|128:n>>>14&127;case 2:p[u+1]=l!==2?n>>>7|128:n>>>7&127;case 1:p[u]=l!==1?128|n:127&n}}const aF={},cF={},FE=4294967296,Bde=FE*FE,lF=Bde/2;uF(0,!0);const dF=uF(0),$de=sg(0,-2147483648,!1),Wde=sg(-1,2147483647,!1);function uF(e,t){let n,i,o;return t?(o=0<=(e>>>=0)&&e<256)&&(i=cF[e],i)?i:(n=sg(e,0,!0),o&&(cF[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(i=aF[e],i)?i:(n=sg(e,e<0?-1:0,!1),o&&(aF[e]=n),n)}function sg(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function hF(e,t){if(isNaN(e))return dF;{if(e<=-lF)return $de;if(e+1>=lF)return Wde}return e<0?dF:sg(e%FE|0,e/FE|0,t)}function pF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}class LR extends On{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(ya.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),D(this,"name","AgoraRTCImageModeration"),D(this,"_connectionState",oo.CONNECTING),D(this,"_sequence",0),D(this,"_moderationStartTime",void 0),D(this,"_workerConnection",void 0),D(this,"_workerMessageLengthLimit",void 0),D(this,"_qualityRatio",void 0),D(this,"_connectInfo",void 0),D(this,"_cancelTokenSource",Ms.CancelToken.source()),D(this,"_retryConfig",void 0),D(this,"_moderationInterval",void 0),D(this,"_moderationTimer",null),D(this,"_moderationMode",1),D(this,"_quality",1),D(this,"_qualityTimer",null),D(this,"_ticket",void 0),D(this,"_moderationIntervalMinimum",void 0),D(this,"_uploadFailedNum",0),D(this,"_uploadNum",0),D(this,"_uploadTimer",null),D(this,"_extraInfo",void 0),D(this,"_vendor",""),D(this,"_encoder",new TextEncoder),D(this,"_moderationId",void 0),D(this,"inspectImage",()=>{if(this.connectionState!==oo.CONNECTED)throw new ne(G.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===oo.CONNECTED?this.requestToInspectImage():C.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Zt(5,"image-moderation-"),this._workerMessageLengthLimit=$("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=$("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=$("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Hf("worker-"+this._moderationId,Zn),this.on(ya.STATE_CHANGE,(i,o)=>{C.debug("[".concat(this._moderationId,"] Moderation operation :").concat(bp[i]," ").concat(o||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(ya.STATE_CHANGE,bp.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new xe((o,l)=>{this.on(ya.CONNECTION_STATE_CHANGE,(u,p)=>{u===oo.CONNECTED&&o()}),this.requestAP(t,i,n).then(u=>{this.connectWorker(u)}).catch(u=>{l(u)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),C.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===oo.CONNECTED&&this.inspectImage()}async requestAP(t,n,i){const o=$("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),l=await function(m,g,y,b){let{appId:S,areaCode:w,cname:k,sid:I,token:O,uid:W}=g;Cp++;const H="moderation_plugin",Y={service_name:H,json_body:JSON.stringify({appId:S,areaCode:w,cname:k,command:"allocateEdge",requestId:Cp,seq:Cp,sid:I,appToken:O,ts:Date.now(),uid:W+""})};let Q,Z,q=m[0];return ma(async()=>{Q=Date.now();const ee=await va(q,{data:Y,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Z=Date.now()-Q,ee.code!==0){const it=new ne(G.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ee.code,{retry:!0,responseTime:Z});throw C.error(it.toString()),it}const ce=JSON.parse(ee.json_body);if(ce.code!==200){const it=new ne(G.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(ce.code,", reason: ").concat(ce.reason),{code:ce.code,responseTime:Z});throw C.error(it.toString()),it}if(!ce.servers||!Array.isArray(ce.servers)||ce.servers.length===0){const it=new ne(G.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:ce.code,responseTime:Z});throw C.error(it.toString()),it}if(!ce.servers.some(it=>!!it.wss)){const it=new ne(G.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:ce.code,responseTime:Z});throw C.error(it.toString()),it}const me=$("IMAGE_MODERATION_WORKER_WSS");if(me)return{addressList:[me],workerToken:ce.workerToken,vid:ce.vid,responseTime:Z};const Oe=$("IMAGE_MODERATION_WORKER_HOST");return{addressList:ce.servers.map(it=>{let{address:wt,wss:yt}=it;if(wt&&yt)return"wss://".concat(wt.replace(/\./g,"-"),".").concat(Oe,":").concat(yt,"/moderation")}).filter(it=>!!it),workerToken:ce.workerToken,vid:ce.vid,ticket:ce.appTicket,responseTime:Z}},(ee,ce)=>(Ue.apworkerEvent(I,{success:!0,sc:200,serviceName:H,responseDetail:JSON.stringify(ee.addressList),firstSuccess:ce===0,responseTime:Z,serverIp:m[ce%m.length]}),!1),(ee,ce)=>(Ue.apworkerEvent(I,{success:!1,sc:ee.data&&ee.data.code||200,serviceName:H,responseTime:Z,serverIp:m[ce%m.length]}),!!(ee.code!==G.OPERATION_ABORTED&&ee.code!==G.UNEXPECTED_RESPONSE||ee.data&&ee.data.retry)&&(q=m[(ce+1)%m.length],!0)),b)}(o,t,n,i);this.emit(ya.STATE_CHANGE,bp.AP_CONNECTED);const{addressList:u,ticket:p}=l;return this._ticket=p,u}async connectWorker(t){this.emit(ya.STATE_CHANGE,bp.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Et.CONNECTED,async()=>{this.emit(ya.STATE_CHANGE,bp.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=oo.CONNECTED}),this._workerConnection.on(Et.CLOSED,()=>{this.connectionState=oo.CLOSED}),this._workerConnection.on(Et.FAILED,()=>{this.connectionState=oo.CLOSED}),this._workerConnection.on(Et.RECONNECTING,()=>{this.connectionState=this.connectionState===oo.CONNECTED?oo.RECONNECTING:oo.CONNECTING}),this._workerConnection.on(Et.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=Mde(new Uint8Array(t.data));$("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&C.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,C.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Ue.reportApiInvoke(this._connectInfo.sid||null,{name:Rn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:hn.TRACER}).onError(new ne(G.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},$("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else C.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Et.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this._workerConnection.on(Et.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=yi(this,ya.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void($("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&C.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(t,n);this._workerConnection.sendMessage(i,!0,!0)}else $("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&C.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:i,cname:o,cid:l,vid:u,sid:p,uid:m}=n;const g=Date.now(),y=await t.getCurrentFrameImage("image/jpeg",this.quality),b=await jU(y,i,o),S=this._sequence+"-"+l+"-"+m+"-"+g+"-"+Zt(12,""),w={appId:i,cid:l,cname:o,deviceId:"",elapse:LR.intToLong(Number(g-this._moderationStartTime)),fileSize:y.buffer.byteLength,height:y.height,width:y.width,jpg:b,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.2",sequence:this._sequence,sid:p,timestamp:hF(g),uid:m,vid:u,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete w.callbackData;const k=Lde(w);if(k.byteLength<this._workerMessageLengthLimit){if($("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const I=function(O){for(var W=1;W<arguments.length;W++){var H=arguments[W]!=null?arguments[W]:{};W%2?pF(Object(H),!0).forEach(function(Y){D(O,Y,H[Y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(H)):pF(Object(H)).forEach(function(Y){Object.defineProperty(O,Y,Object.getOwnPropertyDescriptor(H,Y))})}return O}({},w);delete I.jpg,C.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(I))}return k}{const I=this.quality*this._qualityRatio;return this.quality=I,await this.generateRequestData(t,{appId:i,cname:o,cid:l,vid:u,sid:p,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ms.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=oo.CLOSED,this.emit(ya.STATE_CHANGE,bp.CLOSED)}}function mF(e){if(un(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new ne(G.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new ne(G.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Gde={name:"ImageModeration",create:function(e){let{config:t}=e;return mF(t),new LR(t)}};var fF,gF,_F,yF,EF,vF,bF,SF,xF,wF,TF,CF,RF,NF,AF,IF,OF,PF,DF,kF,LF,MF,jF,UF,VF,FF,BF,$F,WF,GF,HF,KF,zF,YF,qF,XF,JF,QF,ZF,eB,tB,nB,ke;function rB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Wo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?rB(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rB(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}Ar.setLogger(C);let Hde=(fF=nt(),gF=nt({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof pp))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),_F=nt({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==hp.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),yF=nt({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),EF=nt({argsMap:(e,t,n)=>[t,n]}),vF=nt({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:o}=n;return[i==null?void 0:i.uid,o]})}),bF=nt({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),SF=nt({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:o}=n;return{uid:i==null?void 0:i.uid,mediaType:o}})}),xF=nt(),wF=nt(),TF=nt(),CF=nt(),RF=nt(),NF=nt(),AF=nt(),IF=nt(),OF=nt(),PF=nt(),DF=nt(),kF=nt(),LF=nt(),MF=nt(),jF=nt(),UF=nt(),VF=nt({argsMap:(e,t)=>[t]}),FF=nt(),BF=nt(),$F=nt(),WF=nt(),GF=nt(),HF=nt(),KF=nt(),zF=nt(),YF=nt({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),qF=nt(),XF=nt(),JF=nt(),QF=nt(),ZF=nt(),eB=nt(),tB=nt({reportResult:!0}),nB=nt(),ke=class extends On{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),D(this,"store",void 0),D(this,"_uid",void 0),D(this,"_channelName",void 0),D(this,"_uintUid",void 0),D(this,"_users",[]),D(this,"_config",void 0),D(this,"_clientId",void 0),D(this,"_appId",void 0),D(this,"_sessionId",null),D(this,"_key",void 0),D(this,"_rtmConfig",{}),D(this,"_joinInfo",void 0),D(this,"_gateway",void 0),D(this,"_statsCollector",void 0),D(this,"_configDistribute",void 0),D(this,"_leaveMutex",void 0),D(this,"_publishMutex",void 0),D(this,"_renewTokenMutex",void 0),D(this,"_subscribeMutex",void 0),D(this,"_encryptionMode","none"),D(this,"_encryptionSecret",null),D(this,"_encryptionSalt",null),D(this,"_encryptDataStream",!1),D(this,"_encryptDataStreamKey",null),D(this,"_encryptDataStreamIv",null),D(this,"_proxyServer",void 0),D(this,"_turnServer",{servers:[],mode:"auto"}),D(this,"_cloudProxyServerMode","disabled"),D(this,"_isDualStreamEnabled",!1),D(this,"_defaultStreamFallbackType",void 0),D(this,"_lowStreamParameter",void 0),D(this,"_streamFallbackTypeCacheMap",new Map),D(this,"_remoteStreamTypeCacheMap",new Map),D(this,"_axiosCancelSource",Ms.CancelToken.source()),D(this,"_audioVolumeIndicationInterval",void 0),D(this,"_networkQualityInterval",void 0),D(this,"_userOfflineTimeout",void 0),D(this,"_streamRemovedTimeout",void 0),D(this,"_rteDetailInterval",void 0),D(this,"_liveTranscodeStreamingClient",void 0),D(this,"_liveRawStreamingClient",void 0),D(this,"_channelMediaRelayClient",void 0),D(this,"_networkQualitySensitivity","normal"),D(this,"_p2pChannel",void 0),D(this,"_useLocalAccessPoint",!1),D(this,"_setLocalAPVersion",void 0),D(this,"_joinAndNotLeaveYet",!1),D(this,"_numberOfJoinCount",0),D(this,"_joinResponse",null),D(this,"_remoteDefaultVideoStreamType",void 0),D(this,"_inspect",void 0),D(this,"_moderation",void 0),D(this,"_license",void 0),D(this,"_pendingPublishedUsers",[]),D(this,"ntpAlignErrorCount",0),D(this,"remoteInboundOffset",0),D(this,"_peerConnectionState",void 0),D(this,"_pendingRtpCapabilityChange",void 0),D(this,"_fallbackServerInfo",void 0),D(this,"_dualStreamMode",void 0),D(this,"_handleLocalTrackEnable",(o,l,u)=>{this.publish(o,!1).then(l).catch(u)}),D(this,"_handleLocalTrackDisable",(o,l,u)=>{this.unpublish(o).then(l).catch(u)}),D(this,"_handleUserOnline",o=>{if($("BLOCK_LOCAL_CLIENT")&&mu(o.uid,this.channelName))return void C.debug("[".concat(o.uid,"] will be ignored in local"));this.isStringUID&&typeof o.uid!="string"&&C.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const l=this._users.find(u=>u.uid===o.uid);if(l)l._trust_in_room_=!0,l._is_pre_created&&(l._is_pre_created=!1,this.safeEmit(Nt.USER_JOINED,l));else{const u=new Fl(o.uid,o.uint_id||o.uid);this._users.push(u),C.debug("[".concat(this._clientId,"] user online"),o.uid),this.store.firstVideoFrameDecoded(u.uid,{userJoinNotify:Date.now()}),this.safeEmit(Nt.USER_JOINED,u)}}),D(this,"_handleUserOffline",o=>{if($("BLOCK_LOCAL_CLIENT")&&mu(o.uid,this.channelName))return;const l=this._users.find(u=>u.uid===o.uid);l&&(this._handleRemoveStream(o),this._handleRemoveDataChannels(o),l._audio_pre_subscribed||l._video_pre_subscribed?l._is_pre_created=!0:Uy(this._users,l),this._remoteStreamTypeCacheMap.delete(l.uid),this._streamFallbackTypeCacheMap.delete(l.uid),C.debug("[".concat(this._clientId,"] user offline"),o.uid,"reason:",o.reason),this.safeEmit(Nt.USER_LEAVED,l,o.reason))}),D(this,"_handleAddAudioOrVideoStream",(o,l,u,p,m,g,y,b)=>{if($("BLOCK_LOCAL_CLIENT")&&mu(l,this.channelName))return;const S=this._users.find(I=>I.uid===l);if(!S)return void C.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));C.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(o)),this.store.subscribe(S.uid,o,void 0,void 0,void 0,Date.now()),o==="video"&&this.store.firstVideoFrameDecoded(S.uid,{videoAddNotify:Date.now()});const w=o==="audio"?S.hasAudio:S.hasVideo;S._uintid||(S._uintid=g||l),o==="audio"?S._trust_audio_stream_added_state_=!0:S._trust_video_stream_added_state_=!0,o==="audio"?(S._audio_added_=!0,u!==void 0&&(S._audioSSRC=u),p!==void 0&&(S._cname=p),y&&(S._audioOrtc=y)):(S._video_added_=!0,u!==void 0&&(S._videoSSRC=u),p!==void 0&&(S._cname=p),b!==void 0&&(S._rtxSsrcId=b),y&&(S._videoOrtc=y)),(o==="audio"?S.hasAudio:S.hasVideo)&&!w&&(C.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published ").concat(o)),this.safeEmit(Nt.USER_PUBLISHED,S,o)),o==="video"?Ue.onGatewayStream(this._sessionId,dr.ON_ADD_VIDEO_STREAM,Nn.ON_ADD_VIDEO_STREAM,{peer:g||l,ssrc:S._videoSSRC}):Ue.onGatewayStream(this._sessionId,dr.ON_ADD_AUDIO_STREAM,Nn.ON_ADD_AUDIO_STREAM,{peer:g||l,ssrc:S._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(S,o,u).then(I=>{if(I&&(C.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(S.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof vu))return this._p2pChannel.unsubscribe(S,o,!0).then(()=>this._subscribe(S,o,!0).catch(O=>{C.error("[".concat(this._clientId,"] resubscribe error"),O.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(S,o)&&(C.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(S.uid," after reconnect.")),this._subscribe(S,o,!0).catch(I=>{C.error("[".concat(this._clientId,"] resubscribe error"),I.toString())}));const k=this._getEncodingName(m);o==="video"&&(k==="unknown"?this.safeEmit(Nt.AV1_DECODABLE_RESULT,!1):Nr()||ds()||(k==null?void 0:k.toLocaleLowerCase())!==ou.av1||mde().then(I=>{$("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(Nt.AV1_DECODABLE_RESULT,I),I||this._gateway.downgradeCodec(k)}))}),D(this,"_handleRemoveStream",o=>{if($("BLOCK_LOCAL_CLIENT")&&mu(o.uid,this.channelName))return;const l=this._users.find(p=>p.uid===o.uid);if(!l)return void C.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));C.debug("[".concat(this._clientId,"] stream removed with uid ").concat(o.uid));let u=()=>{};l.hasAudio&&l.hasVideo?u=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(Nt.USER_UNPUBLISHED,l,"audio"),C.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(Nt.USER_UNPUBLISHED,l,"video")}:l.hasVideo?u=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(Nt.USER_UNPUBLISHED,l,"video")}:l.hasAudio&&(u=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(Nt.USER_UNPUBLISHED,l,"audio")}),l._video_pre_subscribed||l._audio_pre_subscribed||(l._trust_audio_stream_added_state_=!0,l._trust_video_stream_added_state_=!0,l._audio_added_=!1,l._video_added_=!1,this._p2pChannel instanceof vu&&this._p2pChannel.unsubscribe(l).then(p=>{if(p)return this._gateway.unsubscribe(p,l.uid)}),l._audioSSRC=void 0,l._videoSSRC=void 0,l._audioOrtc=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),Ue.onGatewayStream(this._sessionId,dr.ON_REMOVE_STREAM,Nn.ON_REMOVE_STREAM,{peer:o.uint_id||o.uid}),u()}),D(this,"_handleSetStreamLocalEnable",(o,l,u)=>{if($("BLOCK_LOCAL_CLIENT")&&mu(l,this.channelName))return;const p=this._users.find(y=>y.uid===l);if(!p)return void C.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));C.debug("[".concat(this._clientId,"] local ").concat(o," ").concat(u?"enabled":"disabled"," with uid ").concat(l));const m=o==="audio"?p.hasAudio:p.hasVideo;if(o==="audio"){p._trust_audio_enabled_state_=!0;const y=p._audio_enabled_;if(p._audio_enabled_=u,p._audio_enabled_===y)return;{const b=p._audio_enabled_?"enable-local-audio":"disable-local-audio";C.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(l,", msg: ").concat(b)),this.safeEmit(Nt.USER_INFO_UPDATED,l,b)}}else{p._trust_video_enabled_state_=!0;const y=p._video_enabled_;if(p._video_enabled_=u,p._video_enabled_===y)return;{const b=p._video_enabled_?"enable-local-video":"disable-local-video";C.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(b)),this.safeEmit(Nt.USER_INFO_UPDATED,l,b)}}const g=o==="audio"?p.hasAudio:p.hasVideo;return m!==g?!m&&g?(C.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(o)),void this.safeEmit(Nt.USER_PUBLISHED,p,o)):(o==="video"&&p._videoTrack&&p._videoTrack._destroy(),o==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,o),C.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(o)),void this.safeEmit(Nt.USER_UNPUBLISHED,p,o)):void 0}),D(this,"_handleMuteStream",(o,l,u)=>{if($("BLOCK_LOCAL_CLIENT")&&mu(o,this.channelName))return;C.debug("[".concat(this._clientId,"] receive mute message"),o,l,u);const p=this._users.find(y=>y.uid===o);if(!p)return void C.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o));const m=l==="audio"?p.hasAudio:p.hasVideo;if(l==="audio"){p._trust_audio_mute_state_=!0;const y=p._audio_muted_;if(p._audio_muted_=u,p._audio_muted_===y)return;{const b=p._audio_muted_?"mute-audio":"unmute-audio";C.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(b)),this.safeEmit(Nt.USER_INFO_UPDATED,o,b)}}else{p._trust_video_mute_state_=!0;const y=p._video_muted_;if(p._video_muted_=u,p._video_muted_===y)return;{const b=p._video_muted_?"mute-video":"unmute-video";C.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(b)),this.safeEmit(Nt.USER_INFO_UPDATED,o,b)}}const g=l==="audio"?p.hasAudio:p.hasVideo;if(m!==g){if(!m&&g)return(l==="audio"?p._audioSSRC:p._videoSSRC)?(C.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(l)),void this.safeEmit(Nt.USER_PUBLISHED,p,l)):void C.warning("[".concat(this._clientId,"] remote user ").concat(o," receive ").concat(l," unmute message  before add stream message, ").concat(l," SSRC doesn't exist yet."));l==="video"&&p._videoTrack&&!p._video_pre_subscribed&&p._videoTrack._destroy(),l==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,l),C.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(l)),this.safeEmit(Nt.USER_UNPUBLISHED,p,l)}}),D(this,"_handleP2PLost",async o=>{C.debug("[".concat(this._clientId,"] receive p2p lost"),o),parseInt(o.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():C.warning("[".concat(this._clientId,"] P2PLost stream not found"),o)}),D(this,"_handleTokenWillExpire",()=>{C.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Nt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),D(this,"_handleBeforeUnload",o=>{o.type==="beforeunload"&&o.returnValue!==void 0&&o.returnValue!==""||(this.leave(),C.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),D(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Nt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const o={downlinkNetworkQuality:0,uplinkNetworkQuality:0};o.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),o.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Nt.NETWORK_QUALITY,o)}),D(this,"_handleP2PAddAudioOrVideoStream",(o,l,u,p)=>{const m=this._users.find(y=>y.uid===l);if(!m)return void C.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));C.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(o)),this.store.subscribe(m.uid,o,void 0,void 0,void 0,Date.now());const g=o==="audio"?m.hasAudio:m.hasVideo;o==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,o==="audio"?(m._audio_added_=!0,u!==void 0&&(m._audioSSRC=u),p!==void 0&&(m._audioMid=p)):(m._video_added_=!0,u!==void 0&&(m._videoSSRC=u),p!==void 0&&(m._videoMid=p)),(o==="audio"?m.hasAudio:m.hasVideo)&&!g&&(C.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(o)),this.safeEmit(Nt.USER_PUBLISHED,m,o)),this._p2pChannel.hasPendingRemoteMedia(m,o)&&(C.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,o,!0).catch(y=>{C.error("[".concat(this._clientId,"] resubscribe error"),y.toString())}))}),this._config=e,this._clientId=t||Zt(5,"client-"),this.store=new class{constructor(o,l,u,p,m){gt(this,"state",void 0),this.state={codec:o,audioCodec:l,mode:u,clientId:p,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:iu.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!m}}dispatch(o){this.state=function(l,u){switch(u.type){case ct.SET_SESSION_ID:return ye(ye({},l),{},{sessionId:u.sessionId});case ct.SET_P2P_ID:return ye(ye({},l),{},{p2pId:u.p2pId});case ct.SET_UID:return ye(ye({},l),{},{uid:u.uid});case ct.SET_INT_UID:return ye(ye({},l),{},{intUid:u.intUid});case ct.SET_PUB_ID:return ye(ye({},l),{},{pubId:u.pubId});case ct.KEY_METRIC_CLIENT_CREATED:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{clientCreated:u.metric})});case ct.KEY_METRIC_JOIN_START:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{joinStart:u.metric})});case ct.KEY_METRIC_PRELOAD_START:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{preloadStart:u.metric})});case ct.KEY_METRIC_PRELOAD_END:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{preloadEnd:u.metric})});case ct.KEY_METRIC_JOIN_END:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{joinEnd:u.metric})});case ct.KEY_METRIC_REQUEST_AP_START:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{requestAPStart:u.metric})});case ct.KEY_METRIC_REQUEST_AP_END:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{requestAPEnd:u.metric})});case ct.KEY_METRIC_REQUEST_SUA_END:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{requestSUAEnd:u.metric})});case ct.KEY_METRIC_BEFORE_CONNECT:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{beforeConnect:u.metric})});case ct.KEY_METRIC_PEER_RECEIVER:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{peerReceiver:u.metric})});case ct.KEY_METRIC_SIGNAL_CONNECTED:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{signalConnected:u.metric})});case ct.KEY_METRIC_JOIN_REQ:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{joinReq:u.metric})});case ct.KEY_METRIC_JOIN_REP:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{joinRep:u.metric})});case ct.KEY_METRIC_JOIN_GATEWAY_START:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{joinGatewayStart:u.metric})});case ct.KEY_METRIC_JOIN_GATEWAY_END:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{joinGatewayEnd:u.metric})});case ct.KEY_METRIC_PEER_CONNECTION_START:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{peerConnectionStart:u.metric})});case ct.KEY_METRIC_PEER_CONNECTION_END:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{peerConnectionEnd:u.metric})});case ct.KEY_METRIC_DESCRIPTION_START:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{descriptionStart:u.metric})});case ct.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{signalChannelOpen:u.metric})});case ct.KEY_METRIC_ICE_CONNECTION_END:return ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{iceConnectionEnd:u.metric})});case ct.KEY_METRIC_PUBLISH:{const p=l.keyMetrics.publish,m=p.findIndex(g=>g.trackId===u.metric.trackId);return m!==-1?(p[m]=ye(ye({},p[m]),u.metric),ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{publish:[...p]})})):ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{publish:[...l.keyMetrics.publish,u.metric]})})}case ct.KEY_METRIC_SUBSCRIBE:{const p=l.keyMetrics.subscribe,m=p.findIndex(g=>g.userId===u.metric.userId&&g.type===u.metric.type);return m!==-1?(p[m]=ye(ye({},p[m]),u.metric),ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{subscribe:[...p]})})):ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{subscribe:[...l.keyMetrics.subscribe,u.metric]})})}case ct.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const p=l.keyMetrics.firstVideoFrameDecoded,m=p.findIndex(g=>g.userId===u.metric.userId);return m!==-1?(p[m]=ye(ye({},p[m]),u.metric),ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{firstVideoFrameDecoded:[...p]})})):ye(ye({},l),{},{keyMetrics:ye(ye({},l.keyMetrics),{},{firstVideoFrameDecoded:[...l.keyMetrics.firstVideoFrameDecoded,u.metric]})})}case ct.RESET_FIRST_VIDEO_FRAME_DECODED:return l.keyMetrics.firstVideoFrameDecoded=[],l;case ct.SET_CLOUD_PROXY_SERVER_MODE:return l.cloudProxyServerMode=u.mode,l;case ct.RECORD_JOIN_CHANNEL_SERVICE:return typeof u.index!="number"?l.joinChannelServiceRecords=[...l.joinChannelServiceRecords,u.record]:(l.joinChannelServiceRecords[u.index]=ye(ye({},l.joinChannelServiceRecords[u.index]),u.record),l.joinChannelServiceRecords=[...l.joinChannelServiceRecords]),l;case ct.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return l.joinChannelServiceRecords=[],l;case ct.RESET_KEY_METRICS:return l.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},l;case ct.SET_USE_P2P:return ye(ye({},l),{},{useP2P:u.val});case ct.SET_TRANSPORT_TYPE:return ye(ye({},l),{},{p2pTransport:u.val});case ct.SET_RTE_URL:return ye(ye({},l),{},{rteUrl:u.rteUrl});case ct.SET_RTE_SID:return ye(ye({},l),{},{rteSid:u.rteSid});default:return l}}(this.state,o)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(o){this.state.useDcSignal=o}set autoSubscribe(o){this.state.autoSubscribe=o}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(o){this.state.enableInstantMuteRestore=o}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(o){this.state.networkQualityProbe=o}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(o){this.dispatch({type:ct.SET_SESSION_ID,sessionId:o})}get sessionId(){return this.state.sessionId}set rteUrl(o){this.dispatch({type:ct.SET_RTE_URL,rteUrl:o})}get rteUrl(){return this.state.rteUrl}set rteSid(o){this.dispatch({type:ct.SET_RTE_SID,rteSid:o})}get rteSid(){return this.state.rteSid}set cid(o){this.state.cid=o}get cid(){return this.state.cid}set codec(o){this.state.codec=o}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(o){this.dispatch({type:ct.SET_P2P_ID,p2pId:o})}get p2pId(){return this.state.p2pId}set dcId(o){this.dispatch({type:ct.SET_DC_ID,dcId:o})}get dcId(){return this.state.dcId}set uid(o){this.dispatch({type:ct.SET_UID,uid:o})}get uid(){return this.state.uid}set intUid(o){this.dispatch({type:ct.SET_INT_UID,intUid:o})}get intUid(){return this.state.intUid}set pubId(o){this.dispatch({type:ct.SET_PUB_ID,pubId:o})}get pubId(){return this.state.pubId}set cloudProxyServerMode(o){this.dispatch({type:ct.SET_CLOUD_PROXY_SERVER_MODE,mode:o})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(o){this.dispatch({type:ct.SET_USE_P2P,val:o})}get useP2P(){return this.state.useP2P}set p2pTransport(o){this.dispatch({type:ct.SET_TRANSPORT_TYPE,val:o})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(o){this.state.hasStartJoinChannel=o}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(o){this.state.isABTestSuccess=o}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:ct.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ct.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:ct.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:ct.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:ct.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ct.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ct.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:ct.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:ct.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:ct.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:ct.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:ct.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:ct.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ct.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ct.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ct.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ct.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(o,l){this.dispatch({type:ct.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:ye({userId:o},l)})}descriptionStart(){this.dispatch({type:ct.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ct.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ct.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(o,l,u,p){this.dispatch({type:ct.KEY_METRIC_PUBLISH,metric:ye(ye({trackId:o,type:l},u&&{publishStart:u}),p&&{publishEnd:p})})}subscribe(o,l,u,p,m,g,y){this.dispatch({type:ct.KEY_METRIC_SUBSCRIBE,metric:ye(ye(ye(ye(ye({userId:o,type:l},u&&{subscribeStart:u}),p&&{subscribeEnd:p}),m&&{firstFrame:m}),g&&{streamAdded:g}),y&&{firstDecoded:y})})}massSubscribe(o,l,u,p){o.forEach(m=>{this.dispatch({type:ct.KEY_METRIC_SUBSCRIBE,metric:ye(ye(ye({userId:m.userId,type:m.type},l&&{subscribeStart:l}),u&&{subscribeEnd:u}),p&&{firstFrame:p})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(o,l){o.service==="gateway"&&Array.isArray(o.urls)&&(o.urls=o.urls.map(u=>u.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof l!="number"?(this.dispatch({type:ct.RECORD_JOIN_CHANNEL_SERVICE,record:ye(ye({},o),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(l<0||l>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ct.RECORD_JOIN_CHANNEL_SERVICE,record:o,index:l}),l)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ct.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ct.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:ct.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId,$("SIGNAL_CHANNEL")===1),this._leaveMutex=new Ar("client-leave",this._clientId),this._publishMutex=new Ar("client-publish",this._clientId),this._renewTokenMutex=new Ar("client-renewtoken",this._clientId),this._subscribeMutex=new Ar("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),C.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(to," build: ").concat(dC,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{qT(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(o){C.warning("[".concat(this._clientId,"] ").concat(o.toString()))}var i;this._statsCollector=new eg(this.store),this._statsCollector.onStatsException=(o,l,u)=>{C.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(o,", msg: ").concat(l,", uid: ").concat(u)),o===mR.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(p=>{p instanceof tE&&$("ENABLE_ENCODE_EXCEPTION")&&p.findClosestProfile()}),this.safeEmit(Nt.EXCEPTION,{code:o,msg:l,uid:u})},this._statsCollector.onUploadPublishDuration=(o,l,u,p)=>{const m=this._users.find(g=>g.uid===o);m&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(m.uid,{peerPublishDuration:u,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(m)),Ue.peerPublishStatus(this._sessionId,{subscribeElapse:p,audioPublishDuration:l,videoPublishDuration:u,peer:m._uintid}))},this._statsCollector.onVideoCodecChanged=o=>{if($("VIDEO_STANDARD_BITRATE_VERSION")&&(o==="av1"||o==="h265"||o==="h264")){const l=this.localTracks.find(u=>u instanceof pn);l&&l._saveEncodeBitrateRatio!==1&&l.setSaveEncodeBitrateRatio(o==="h264"?$("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new cde(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Zn,httpRetryConfig:e.httpRetryConfig||Zn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new Ede(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},Ea("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new vu(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,i,o){let l=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],u=arguments.length>6&&arguments[6]!==void 0&&arguments[6];on("JOIN_GATEWAY_USE_443PORT_ONLY",l),on("JOIN_GATEWAY_USE_DUAL_DOMAIN",u);const p=this._gateway.signal.websocket;return p instanceof qC&&(p.use443PortOnly=l,p.tryDoubleDomain=u),async function(m,g,y){ky.get(m)||ky.set(m,[]),Ly.get(m)||Ly.set(m,g),tc.get(m)||tc.set(m,0);const b=ky.get(m),S=Ly.get(m);if(!b||!S)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(tc.get(m)===S){const W=Pf();b.push(W),await W.promise}tc.set(m,tc.get(m)+1);for(var w=arguments.length,k=new Array(w>3?w-3:0),I=3;I<w;I++)k[I-3]=arguments[I];const O=await y(...k);return tc.set(m,tc.get(m)-1),tc.get(m)===S-1&&b.length>0&&(b[0].resolve(),b.shift()),tc.get(m)===0&&(ky.set(m,[]),Ly.set(m,0),tc.set(m,0)),O}("client.join",$("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,i,o)}async join(e,t,n,i,o){const l=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const u=(By||By||(By=(window.location.protocol.split(":")[0]||"").toUpperCase(),By))==="HTTPS",p=Y5()?window.isSecureContext:"Browser Not Support";(!Y5()&&!u||!window.isSecureContext)&&C.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let m;Ue.setAppId(e);try{if(!n&&n!==null)throw new ne(G.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&Vr(n,"token",1,2047),Vr(e,"appid",1,2047),hE(t),i&&pE(i),o)if(typeof o=="string")Vr(o,"optionalInfo",1,256),m=o;else{if(typeof o!="object")throw new ne(G.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:O,enableInstantMuteRestore:W,networkQualityProbe:H}=o;O&&(Do(O,"autoSubscribe"),C.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(O)),this.store.autoSubscribe=O),W&&(Do(W,"enableInstantMuteRestore"),C.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(W)),this.store.enableInstantMuteRestore=W),H&&(Do(H,"networkQualityProbe"),C.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(H)),this.store.networkQualityProbe=H)}}}catch(O){throw Ue.reportApiInvoke(su(),{name:Rn.JOIN,options:[e,t,n,i],states:{isHttps:u,isSecureContext:p},tag:hn.TRACER}).onError(O),O}if(this._leaveMutex.isLocked&&(C.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),C.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const O=new ne(G.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Ue.reportApiInvoke(su(),{name:Rn.JOIN,options:[e,t,n,i],states:{isHttps:u,isSecureContext:p},tag:hn.TRACER}).onError(O),O}this._gateway.state="CONNECTING",this.store.preloadStart();const g=await OR({appId:e,cname:t,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new ne(G.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const y=(g==null?void 0:g.sid)||su();C.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(l)),this._sessionId||(this._sessionId=y,this.store.sessionId=this._sessionId);const b=Ue.reportApiInvoke(this._sessionId,{id:this._clientId,name:Rn.JOIN,options:[e,t,n,i],states:{isHttps:u,isSecureContext:p},tag:hn.TRACER}),S=Wo(Wo(Wo({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:m,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!g},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:$("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(S.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(S.stringUid=i,this._uintUid?(S.uid=this._uintUid,this._uintUid=void 0):S.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(S.aesmode=this._encryptionMode,S.aespassword=await(async O=>{const W=function(Z){const q=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ee=new Uint8Array(new ArrayBuffer(q.length));for(let ce=0;ce<q.length;ce+=1)ee[ce]=q.charCodeAt(ce);return ee}(),H=await window.crypto.subtle.importKey("spki",W,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Y=zT(O),Q=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},H,Y);return function(Z){let q="";for(let ee=0;ee<Z.length;ee+=1)q+=String.fromCharCode(Z[ee]);return window.btoa(q)}(new Uint8Array(Q))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ne(G.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(S.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const O=new TextEncoder,W=$("USE_PURE_ENCRYPTION_MASTER_KEY")?O.encode(S.appId+this._encryptionSecret+this._encryptionSecret):O.encode(S.appId+S.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(H,Y,Q){const Z=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),q=H==="aes-128-gcm2"?128:256,ee=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:sU,hash:"SHA-256",salt:Q},Z,q+Fce);return new Uint8Array(ee).subarray(q/8)}(this._encryptionMode,W,ru(this._encryptionSalt)),this._encryptDataStreamKey=await async function(H,Y,Q){const Z=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),q=H==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:sU,hash:"SHA-256",salt:Q},Z,{name:"AES-GCM",length:q},!0,["encrypt","decrypt"])}(this._encryptionMode,W,ru(this._encryptionSalt))}else p?C.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):C.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,C.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:S.stringUid});const w=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&w===this._sessionId&&Ue.joinChannelTimeout(this._sessionId,5)},5e3);try{var k;let O;const W=S.cloudProxyServer;if(fe(k=["proxy3","proxy4","proxy5"]).call(k,W)){const q=$("PROXY_SERVER_TYPE3");Array.isArray(q)?S.proxyServer=q[0]:S.proxyServer=q}if(Ue.setProxyServer(S.proxyServer),C.setProxyServer(S.proxyServer),this.store.requestAPStart(),g){if(C.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(S.stringUid?", ".concat(S.stringUid," => ").concat(g.intUid):""," ")),S.stringUid&&!S.uid&&(S.uid=g.intUid),O={gatewayInfo:g.ap.gatewayInfo},$("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&S.turnServer.mode==="auto")if(g.ap.proxyInfo.addresses.length===0)C.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const q=(await KV(g.ap.proxyInfo,g.ap.gatewayInfo.uid)).map(ee=>({turnServerURL:ee.address,tcpport:ee.tcpport||qr.tcpport,udpport:ee.udpport||qr.udpport,username:ee.username||qr.username,password:ee.password||qr.password,forceturn:!1,security:!0}));S.turnServer={mode:"manual",servers:q}}eF(g,S.stringUid)}else{if(S.stringUid&&!S.uid){let q;[q,O]=await xe.all([v4(S.stringUid,S,this._axiosCancelSource.token,this._config.httpRetryConfig||Zn,this.store).finally(()=>{this.store.requestSUAEnd()}),E4(S,this._axiosCancelSource.token,this._config.httpRetryConfig||Zn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),C.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(S.stringUid," => ").concat(q)),S.uid=q,O.gatewayInfo.uid=q,O.gatewayInfo.res.uid=q}else O=await E4(S,this._axiosCancelSource.token,this._config.httpRetryConfig||Zn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ne(G.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(S,this._axiosCancelSource.token),this._configDistribute.on(_a.UPDATE_BITRATE_LIMIT,q=>{this._p2pChannel.updateBitrateLimit(q)}),this._configDistribute.on(_a.UPDATE_CLIENT_ROLE_OPTIONS,q=>{this._setClientRoleOptions(q)}),this._configDistribute.on(_a.UPDATE_REMOTE_VIDEO_STREAM_TYPE,q=>{var ee;fe(ee=[0,1,4,5,6,7,8,9]).call(ee,q)&&(this.remoteUsers.forEach(ce=>{this._remoteStreamTypeCacheMap.get(ce.uid)!==q&&this.setRemoteVideoStreamType(ce.uid,q)}),this.setRemoteDefaultVideoStreamType(q))}),this._configDistribute.on(_a.FALLBACK_TO_HLS,q=>{q&&this.safeEmit(Nt.FALLBACK_TO_HLS,XT.CONFIG)}),this._configDistribute.on(_a.UPDATE_VOS_CONFIGURE,q=>{this._gateway.setConfigure(q).catch(ee=>{C.debug("[".concat(this._clientId,"] auto set vos config failed"),ee)})})},0),this._key=n||e;const H=O.gatewayInfo,Y=S.uid?S.uid:H.uid;this._joinInfo=Wo(Wo({},S),{},{cid:H.cid,uid:Y,vid:H.vid,apResponse:H.res,apGatewayAddress:H.apGatewayAddress,uni_lbs_ip:H.uni_lbs_ip,gatewayAddrs:H.gatewayAddrs}),this.store.intUid=Y,this.store.cid=H.cid;const Q=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ne(G.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));b.onSuccess(Q),this._appId=e,this._channelName=S.cname,this._uid=Q,this.store.uid=Q,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!Nr()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Nr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Z=S.stringUid?"string uid: ".concat(S.stringUid,",uid: ").concat(S.uid):"uid: ".concat(this._uid);return C.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(Z)),setTimeout(()=>{C.startUpload()},5e3),this.store.joinEnd(),I=this,fe(pu).call(pu,I)||pu.push(I),this._cloudProxyServerMode==="disabled"&&It().supportWebCrypto&&$("ENABLE_PRELOAD")&&DR(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&Ue.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&Ue.reportRteDetail(this._sessionId)},$("RTE_DETAIL_REPORT_INTERVAL")||6e4),Q}catch(O){const W=Array.isArray(O)?O[0]:O;throw W&&W.code===G.OPERATION_ABORTED?C.warning("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),W):C.error("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),W),W.code!==G.OPERATION_ABORTED&&this._numberOfJoinCount===l&&(this._gateway.state="DISCONNECTED",this._reset()),b.onError(W),W}var I}async _joinGateway(){if(!this._joinInfo||!this._key)throw new ne(G.INVALID_OPERATION);try{return await this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!$("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(e){if(e.code===G.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,kt.FALLBACK),C.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new ne(G.INVALID_OPERATION);return Ue.reportApiInvoke(this._sessionId,{name:Rn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:hn.TRACER}).onSuccess(),await this._joinGateway()}throw e}}async leave(){C.info("[".concat(this._clientId,"] Leaving channel"));const e=()=>{!Nr()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Nr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(n){const i=pu.indexOf(n);i!==-1&&pu.splice(i,1)}(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||e();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return C.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",kt.LEAVE),C.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t(),this.store.useDcSignal&&e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof pp))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new ne(G.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new ne(G.INVALID_OPERATION,"audience can not publish stream");for(const o of n){if(!(o instanceof pp))throw new ne(G.INVALID_PARAMS,"parameter is not local track");if(!o._enabled&&t)throw new ne(G.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(o.getTrackId()))}C.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(o=>"".concat(o.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(o=>{const l=this._configDistribute.getBitrateLimit();o instanceof pn&&l&&o.setBitrateLimit(l.uplink)});try{await this._publishHighStream(n),C.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(o=>"".concat(o.getTrackId()," "))))}catch(o){throw C.error("[".concat(this._clientId,"] publish error"),o.toString()),o}finally{i()}}async _publishDataChannel(e){if(e==null)throw new ne(G.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));un(e.id,"id",0,65535,!0),Do(e.ordered,"ordered"),Vr(e.metadata,"metadata",0,512),C.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(o=>o.id===e.id)!==-1)throw new ne(G.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new ne(G.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&$("FORCE_TURN")&&!$("TURN_ENABLE_TCP")&&!$("TURN_ENABLE_UDP"))throw new ne(G.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(o){return d4(o,!1)}(e),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw C.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new ne(G.CREATE_DATACHANNEL_ERROR);try{await xe.all(i.map(o=>this._uid&&this._gateway.publishDataChannel(this._uid,o,!0))),await n._waitTillOpen()}catch(o){if(o.code!==G.DISCONNECT_P2P)throw o}}return C.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw C.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new ne(G.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof pp))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);C.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.sendExtensionMessage(zn.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.unpublish(i,this._uid),C.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(o=>"".concat(o.getTrackId()))))}}catch(i){throw C.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),C.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),C.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(i=>"".concat(i.id))))}catch(n){throw C.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Fl)){const i=this.remoteUsers.find(o=>o.uid===e);if(!i)throw new ne(G.INVALID_REMOTE_USER,"user is not in the channel");e=i}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(Qn(t,"mediaType",["audio","video"]),this.store.useP2P)throw new ne(G.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new ne(G.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===Me.AUDIO,i=t===Me.VIDEO,o=await this._subscribeMutex.lock();try{const{ssrcId:l,ortc:u,rtxSsrcId:p,cname:m,uint_id:g}=await this._gateway.presubscribe(e,t,!0);if(l==null)throw new ne(G.UNEXPECTED_RESPONSE,"no ssrc id");let y=this._users.find(S=>S.uid===e);y||(y=new Fl(e,g||e),y._is_pre_created=!0,this._users.push(y)),m&&(y._cname=m),y._uintid||(y._uintid=g||e),n&&(y._audioSSRC=l,y._audio_pre_subscribed=!0,u&&(y._audioOrtc=u)),i&&(y._videoSSRC=l,y._video_pre_subscribed=!0,u&&(y._videoOrtc=u),p!=null&&(y._rtxSsrcId=p)),C.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(l)),await this._p2pChannel.subscribe(y,t,l,p,u);const b=n?y._audioTrack:y._videoTrack;if(!b)throw new ne(G.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(y._trust_audio_stream_added_state_=!0,y._audio_added_=!0),i&&(y._trust_video_stream_added_state_=!0,y._video_added_=!0),b}catch(l){throw C.error("[".concat(this._clientId,"] presub user ").concat(e," error"),l),l}finally{o()}}async _subscribeDataChannel(e,t){var n;if(un(t,"channelId",0,65535,!0),!this._joinInfo)throw new ne(G.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===e))throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new ne(G.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new ne(G.INVALID_REMOTE_USER,"user is not published");const o=(n=e._dataChannels)===null||n===void 0?void 0:n.find(p=>p.id===t);if(!o)throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new ne(G.REMOTE_USER_IS_NOT_PUBLISHED);const l=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const p=await this._p2pChannel.subscribeDataChannel(e,[o]);if(p&&fe(p).call(p,o.id))try{var u;if(typeof o._originDataChannelId!="number")throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ne(G.CREATE_DATACHANNEL_ERROR);const m={id:o.id,datachannelId:o._originDataChannelId,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:(u=o.metadata)!==null&&u!==void 0?u:""};await this._gateway.subscribeDataChannel(e.uid,m,!0),await o._waitTillOpen()}catch(m){if((m==null?void 0:m.code)!==G.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[o]),m;await this._p2pChannel.unsubscribeDataChannel(e,[o]),this._p2pChannel.setPendingRemoteDataChannel(e,o.id)}return C.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),o}finally{l()}}async _p2pSubscribe(e,t,n){if(Qn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ne(G.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===e)){const l=new ne(G.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),l}if(!e.hasAudio&&!e.hasVideo){const l=new ne(G.INVALID_REMOTE_USER,"user is not published");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),l}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const l=new ne(G.REMOTE_USER_IS_NOT_PUBLISHED);throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),l}const o=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const u=t==="audio"?e._audioSSRC:e._videoSSRC,p=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,u,p)}catch(u){throw u}C.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(u=>{C.warning("[".concat(this._clientId,"] auto set fallback failed"),u)});const l=t==="audio"?e._audioTrack:e._videoTrack;if(!l)throw new ne(G.UNEXPECTED_ERROR,"can not find remote track in user object");return l}catch(l){throw C.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),l),l}finally{o()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(Qn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ne(G.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(g=>g===e)){const g=new ne(G.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),g}if(!e.hasAudio&&!e.hasVideo){const g=new ne(G.INVALID_REMOTE_USER,"user is not published");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),g}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const g=new ne(G.REMOTE_USER_IS_NOT_PUBLISHED);throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),g}let o=t==="audio"?e._audioSSRC:e._videoSSRC,l=t==="audio"?e._audioOrtc:e._videoOrtc,u=t==="video"?e._rtxSsrcId:void 0,p={stream_type:t==="audio"?Me.AUDIO:Me.VIDEO,ssrcId:o};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const m=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const y=t==="audio"?e._audioSSRC:e._videoSSRC;y!==void 0&&y!==o&&(o=y,l=t==="audio"?e._audioOrtc:e._videoOrtc,u=t==="video"?e._rtxSsrcId:void 0,p={stream_type:t==="audio"?Me.AUDIO:Me.VIDEO,ssrcId:o}),rs.markSubscribeStart(this.store.clientId,o),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,o,u,l);try{this._p2pChannel.isPreSubScribe(o)||await this._gateway.subscribe(e.uid,p,!0)}catch(b){if((b==null?void 0:b.code)!==G.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),b;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(y){throw this._p2pChannel.reportSubscribeEvent(!1,y==null?void 0:y.code,e,t),y}C.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(y=>{C.warning("[".concat(this._clientId,"] auto set fallback failed"),y)});const g=t==="audio"?e._audioTrack:e._videoTrack;if(!g)throw new ne(G.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),g}catch(g){throw C.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),g),g}finally{m()}}async massSubscribe(e){if(Wc(e,"subscribeList"),!this._joinInfo)throw new ne(G.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,i=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(p=>{let{user:m,mediaType:g}=p;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(g)}).join("; ")));const o=(e=[...e]).map(p=>{let{user:m,mediaType:g}=p;return{user:m,mediaType:g}}),l=await this._p2pChannel.globalLock();try{var u;for(let m=e.length-1;m>=0;m--){const g=e[m],{user:y,mediaType:b}=g;if(Qn(b,"mediaType",["audio","video"]),!y){const I=new ne(G.INVALID_PARAMS,"user property does not exist in subscribeList item");throw C.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),I}if(!this._users.find(I=>I===y)){const I=new ne(G.INVALID_REMOTE_USER,"user is not in the channel");C.error("[".concat(this._clientId,"] can not massSubscribe ").concat(y.uid,", this user is not in the channel")),o[m].error=I,e.splice(m,1);continue}if(b==="audio"&&(!y.hasAudio||y._audioSSRC===void 0)||b==="video"&&(!y.hasVideo||y._videoSSRC===void 0)){const I=new ne(G.REMOTE_USER_IS_NOT_PUBLISHED);C.error("[".concat(this._clientId,"] can not subscribe ").concat(y.uid," with mediaType ").concat(b,", remote user is not published")),o[m].error=I,e.splice(m,1);continue}const w=Sr.Video|Sr.LwoVideo,k=n.get(y);if(k){if(b==="video"?k&w:k&Sr.Audio){e.splice(m,1),C.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(y.uid,", mediaType:").concat(b," twice"));continue}n.set(y,k|(b==="video"?w:Sr.Audio))}else n.set(y,b==="video"?w:Sr.Audio)}for(let m=e.length-1;m>=0;m--){const g=e[m],{user:y,mediaType:b}=g,S=Sr.Video|Sr.LwoVideo;if(this._p2pChannel.hasRemoteMedia(y,b)){await this._p2pChannel.unmuteRemoteNoLock(y,b);const w=n.get(y);n.set(y,b==="video"?w^S:w^Sr.Audio),e.splice(m,1)}}this.store.massSubscribe(e.map(m=>({userId:m.user.uid,type:m.mediaType})),t);let p=Zi(u=Array.from(n.entries())).call(u,(m,g)=>{let[y,b]=g;if(b===0)return m;const S={stream_id:y.uid,stream_type:b};return b&Sr.Audio&&(S.audio_ssrc=y._audioSSRC),b&Sr.Video&&(S.video_ssrc=y._videoSSRC),m.push(S),m},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(g=>{let{user:y,mediaType:b}=g;return{user:y,mediaType:b,ssrcId:b===Me.VIDEO?y._videoSSRC:y._audioSSRC,rtxSsrcId:b===Me.VIDEO?y._rtxSsrcId:void 0}}));const m=new Map;if(p=p.filter(g=>g.video_ssrc&&!this._p2pChannel.isPreSubScribe(g.video_ssrc)||g.audio_ssrc&&!this._p2pChannel.isPreSubScribe(g.audio_ssrc)||!g.video_ssrc&&!g.audio_ssrc),p.length>0){const g=await this._gateway.subscribeAll(p,!0);((g==null?void 0:g.users)||[]).forEach(y=>{let{stream_id:b,video_error_code:S,audio_error_code:w,error_code:k}=y;(S||w||k)&&m.set(b,{video_error_code:S,audio_error_code:w,error_code:k})})}if(Array.from(m.entries()).length>0){const g=[];Array.from(m.entries()).forEach(y=>{let[b,S]=y;const w=this.remoteUsers.find(k=>k.uid===b);if(w){let k;S.error_code||S.video_error_code&&S.audio_error_code?k=void 0:S.video_error_code?k=Me.VIDEO:S.audio_error_code&&(k=Me.AUDIO),g.push({user:w,mediaType:k})}}),g.length>0&&await this._p2pChannel.massUnsubscribeNoLock(g)}for(const g of o){const y=m.get(g.user.uid);if(y){const b=y.error_code||g.mediaType==="audio"&&y.audio_error_code||g.mediaType==="video"&&y.video_error_code;if(b){const S=gu(b);C.error("user:".concat(g.user.uid," mediaType:").concat(g.mediaType," has massSubscribe error ").concat(S.desc)),g.error=new ne(G.SUBSCRIBE_FAILED,"code ".concat(b,": ").concat(S.desc))}}g.error||(g.mediaType==="video"?g.track=g.user.videoTrack:g.track=g.user.audioTrack)}return this.store.massSubscribe(o.filter(g=>!g.error).map(g=>({userId:g.user.uid,type:g.mediaType})),void 0,Date.now()),o.forEach(g=>{var y;Ue.subscribe(this.store.sessionId,{succ:!!g.error,ec:((y=g.error)===null||y===void 0?void 0:y.code)||null,video:g.mediaType===Me.VIDEO,audio:g.mediaType===Me.AUDIO,peerid:g.user.uid,subscribeRequestid:g.mediaType===Me.VIDEO?g.user._videoSSRC:g.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(g.user._videoSSRC)},!0)}),C.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(g=>{let{user:y,mediaType:b}=g;return"user: ".concat(y==null?void 0:y.uid,", mediaType: ").concat(b)}).join("; "))),o}catch(m){throw await this._p2pChannel.massUnsubscribeNoLock(e),m}}finally{l(),i()}}async unsubscribe(e,t,n){if(!(e instanceof Fl)){const l=this.remoteUsers.find(u=>u.uid===e);if(!l)throw new ne(G.INVALID_REMOTE_USER,"user is not in the channel");e=l}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&Qn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ne(G.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(l=>l===e)){const l=new ne(G.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),l}C.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const o=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const l=await this._p2pChannel.unsubscribe(e,t);l&&await this._gateway.unsubscribe(l,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&Uy(this._users,e),C.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(l){if(l.code===G.DISCONNECT_P2P)return void C.warning("disconnecting p2p, abort unsubscribe request.");throw C.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),l.toString()),l}finally{o()}}async _unsubscribeDataChannel(e,t){if(t&&un(t,"id",0,65535,!0),!this._joinInfo)throw new ne(G.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(o=>o===e)){const o=new ne(G.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),o}let i;if(typeof t=="number"){const o=e._dataChannels.find(l=>l.id===t);o&&(i=[o])}else i=e._dataChannels;if(i===void 0){const o=new ne(G.REMOTE_USER_IS_NOT_PUBLISHED);throw C.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),o}C.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(o=>o.id)));try{const o=await this._p2pChannel.unsubscribeDataChannel(e,i);o&&await this._gateway.unsubscribeDataChannel(o,e.uid),C.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o))}catch(o){if(o.code===G.DISCONNECT_P2P)return void C.warning("disconnecting p2p, abort unsubscribe request.");throw C.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),o.toString()),o}}async massUnsubscribe(e){if(Wc(e,"unsubscribeList"),!this._joinInfo)throw new ne(G.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");C.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:i,mediaType:o}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(o,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:i,mediaType:o}=e[n];if(!i){const p=new ne(G.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw C.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),p}if(Qn(o,"mediaType",["video","audio",void 0]),!this._users.find(p=>p===i)){C.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(n,1);continue}const u=Sr.Video|Sr.LwoVideo;if(t.has(i)){const p=t.get(i);let m;switch(o){case"video":m=p&u;break;case"audio":m=p&Sr.Audio;break;default:m=p&(Sr.Audio|u)}if(m){C.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(o," twice.")),e.splice(n,1);continue}o?o==="audio"?t.set(i,p|Sr.Audio):o==="video"&&t.set(i,p|u):t.set(i,p|Sr.Audio|u)}else o?o==="audio"?t.set(i,Sr.Audio):o==="video"&&t.set(i,u):t.set(i,Sr.Audio|u)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),C.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(i=>{let{user:o,mediaType:l}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(l,";")}).join()))}catch(n){if(n.code===G.DISCONNECT_P2P)return void C.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw C.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new oe(G.INVALID_PARAMS);jn(n.width)||HT(n.width,"streamParameter.width"),jn(n.height)||HT(n.height,"streamParameter.height"),jn(n.framerate)||HT(n.framerate,"streamParameter.framerate"),jn(n.bitrate)||un(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&C.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),C.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,ge.LocalVideoLowTrack)}async setDualStreamMode(e,t){Qn(e,"mode",[0,1,-1]);try{switch(t&&await this.setLowStreamParameter(t),this._dualStreamMode=e,this._joinInfo?this._gateway.setDualStreamMode(e).catch(n=>{C.warning("[".concat(this._clientId,"] set dual stream mode failed"),n.toString())}):C.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(e)),e){case np.AUTO_SIMULCAST_STREAM:C.info("[".concat(this._clientId,"] set dual stream mode to ").concat(e));break;case np.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case np.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(n){throw C.error("[".concat(this._clientId,"] set dual stream mode error"),n.toString()),n}}async enableDualStream(){if(!It().supportDualStream)throw Ue.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ne(G.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ne(G.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Ue.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,this._dualStreamMode=np.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{C.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),Ue.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),C.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void C.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(ge.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Ue.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,this._dualStreamMode=np.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{C.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),Ue.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),C.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(i){Qn(i,"role",["audience","host"])}(e),t&&qT(t),this.mode==="rtc"||this.mode==="p2p")throw C.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new ne(G.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new ne(G.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new ne(G.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;if(this._joinInfo&&(this._joinInfo.role=e),e!==n&&$("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Yr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),C.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level)),n==="audience"&&e!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof vu){const{video_codec:i}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(i.map(o=>o.toLowerCase()).filter(o=>{var l;return fe(l=Object.keys(ou)).call(l,o)}))}}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&qT(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{C.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Vr(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new ne(G.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ne(G.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Ue.setProxyServer(this._proxyServer),C.setProxyServer(this._proxyServer),C.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new ne(G.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ne(G.INVALID_OPERATION,"You have already set the proxy")}if(Zd(e))return this._turnServer={servers:e,mode:"original-manual"},void C.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>M5(n)),this._turnServer={servers:e,mode:"manual"},C.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new ne(G.INVALID_OPERATION,"you should set license before join channel");if(Vr(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new ne(G.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,C.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new ne(G.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ne(G.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new ne(G.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new ne(G.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,C.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ne(G.INVALID_OPERATION,"Stop proxy server after leave channel");Ue.setProxyServer(),C.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",C.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new ne(G.INVALID_PARAMS,"accessPoints is required.");Wc(e.accessPoints.serverList,"accessPoints.serverList"),Vr(e.accessPoints.domain,"accessPoints.domain");const t=(S,w)=>{un(S,w,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ne(G.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");$("CLOSE_AFB_FOR_LOCAL_AP")&&(on("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),on("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,o=e.accessPoints.domain,l=e.accessPoints.serverList.map(S=>i.test(S)?"".concat(S.replace(/\./g,"-"),".").concat(o):S),u=l.map(S=>"".concat(S,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,on("WEBCS_DOMAIN",u),on("WEBCS_DOMAIN_BACKUP_LIST",u),on("GATEWAY_DOMAINS",[o]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Wc(e.report.hostname,"report.hostname"),on("EVENT_REPORT_DOMAIN",e.report.hostname[0]),on("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(on("EVENT_REPORT_DOMAIN",l[0]),on("EVENT_REPORT_BACKUP_DOMAIN",l[1]||l[0]));let p=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),p=e.report.port),on("STATS_COLLECTOR_PORT",p),e.report?on("ENABLE_EVENT_REPORT",!0):on("ENABLE_EVENT_REPORT",!1);let m="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Wc(e.log.hostname,"log.hostname"),m=e.log.hostname[0]):m=l[0];let g=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),g=e.log.port),on("LOG_UPLOAD_SERVER","".concat(m,":").concat(g));let y=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Wc(e.cds.hostname,"cds.hostname"),y=e.cds.hostname):y=l;let b=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),b=e.cds.port),on("CDS_AP",y.map(S=>"".concat(S,":").concat(b))),e.cds?on("ENABLE_CONFIG_DISTRIBUTE",!0):on("ENABLE_CONFIG_DISTRIBUTE",!1),C.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Wc(e,"serverList"),Vr(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ne(G.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,on("WEBCS_DOMAIN",e),on("WEBCS_DOMAIN_BACKUP_LIST",e),on("GATEWAY_DOMAINS",[t]),on("EVENT_REPORT_DOMAIN",e[0]),on("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),on("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),C.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Qn(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw C.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else C.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Qn(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(i=>i.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw C.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}C.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Qn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw C.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}C.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,i){(function(l){Qn(l,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Vr(t,"secret");const o=["aes-128-gcm2","aes-256-gcm2"];if(fe(o).call(o,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new ne(G.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new ne(G.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(Do(i,"encryptDataStream"),!fe(o).call(o,e))throw new ne(G.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||C.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Dl(n))}async renewToken(e){if(Vr(e,"token",1,2047),!this._key||!this._joinInfo)throw new ne(G.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if($("USE_NEW_TOKEN")){C.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await yde(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Zn);C.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:i})}else C.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});C.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=t,this._joinInfo.token=t,C.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?C.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Nt.VOLUME_INDICATOR,e)},$("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new ne(G.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ne(G.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new ne(G.LIVE_STREAMING_TASK_CONFLICT);const n=t?Hc.TRANSCODE:Hc.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Hc.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new ne(G.INVALID_PARAMS,"can not find live streaming url to stop");await xe.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){C4(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){C4(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof vu&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ne(G.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const o=new TextEncoder;e.payload=o.encode(e.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&fe(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(i=!0,e.payload=await async function(o,l,u){var p;const m=Zi(p=Array.from(u)).call(p,(I,O)=>I+O,0),g={serverTs:0,seq:Bce++,length:u.length,checkSum:m},y=new Uint8Array(H5(m,2)),b=new ArrayBuffer(cp),S=new DataView(b);S.setUint32(0,g.serverTs),S.setUint16(4,g.seq),S.setUint16(6,g.length),S.setUint16(8,g.checkSum);const w=16-u.length%16;u=F5(u,new Uint8Array(w));const k=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o,tagLength:rU,additionalData:y},l,u);return F5(new Uint8Array(b),new Uint8Array(k))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new ne(G.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(He.DATA_STREAM,{payload:Dl(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Rde},!n)}sendMetadata(e){if(!this._joinInfo)throw new ne(G.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new ne(G.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(He.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Dl(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Xce),!this._joinInfo)throw new ne(G.INVALID_OPERATION,"can not send custom report, not joined");await Ue.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if($("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(n=>n.uid+"");Object.keys(e).forEach(n=>{fe(t).call(t,n)||delete e[n]})}return e}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}async pickSVCLayer(e,t){Qn(t.spatialLayer,"spatialLayer",[0,1,2,3]),Qn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw C.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(Do(t,"apRTM"),un(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,C.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(C.debug("[".concat(this._clientId,"] reset client")),function(e){const t=Ep.indexOf(e);t!==-1&&Ep.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=Ms.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&Z4(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&Ue.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Ue.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ar("client-publish",this._clientId),this._subscribeMutex=new Ar("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const i=e||su();e?C.debug("[".concat(this._clientId,"] new Session ").concat(i)):C.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const o=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,Ue.addSid(i);const l={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:o,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};Ue.sessionInit(this._sessionId,Wo({cname:t.channel,appid:t.appId},l)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new ne(G.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&$("FORCE_TURN")&&!$("TURN_ENABLE_TCP")&&!$("TURN_ENABLE_UDP"))throw new ne(G.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");C.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(zn.PUBLISH,i,!0)}catch(o){throw n.throw(o),o}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var t;let o;try{o=await this._gateway.publish(this._uid,i,!0)}catch(l){if(l.code!==G.DISCONNECT_P2P)throw n.throw(l),l}await n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const o of e)o instanceof pn&&o._encoderConfig&&this._gateway.setVideoProfile(o._encoderConfig).catch(l=>{C.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!o.muted&&o.enabled||await this._p2pChannel.muteLocalTrack(o)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===G.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ne(G.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ne(G.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));C.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var t;let o;try{o=await this._gateway.publish(this._uid,i,!0)}catch(l){if(l.code!==G.DISCONNECT_P2P)throw n.throw(l),l}n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===G.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new ne(G.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Ea("LiveStreaming").create(i));var i;return n.onLiveStreamError=(o,l)=>{Ue.reportApiInvoke(this._sessionId,{name:Rn.ON_LIVE_STREAM_ERROR,options:[o,l],tag:hn.TRACER}).onSuccess(),this.safeEmit(Nt.LIVE_STREAMING_ERROR,o,l)},n.onLiveStreamWarning=(o,l)=>{Ue.reportApiInvoke(this._sessionId,{name:Rn.ON_LIVE_STREAM_WARNING,options:[o,l],tag:hn.TRACER}).onSuccess(),this.safeEmit(Nt.LIVE_STREAMING_WARNING,o,l)},n.on(KC.REQUEST_WORKER_MANAGER_LIST,(o,l,u)=>{if(!this._joinInfo)return u(new ne(G.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(p,m,g,y){const b=$("UAP_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(S=>m.proxyServer?"https://".concat(m.proxyServer,"/ap/?url=").concat(S+"/api/v1?action=uap"):"https://".concat(S,"/api/v1?action=uap"));return await ude(b,p,m,g,y)})(o,this._joinInfo,this._axiosCancelSource.token,Zn).then(l).catch(u)}),n};return e===Hc.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ne(G.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},Ea("ChannelMediaRelay").create(e));i.on("state",o=>{o===Qs.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(Nt.CHANNEL_MEDIA_RELAY_STATE,o)}),i.on("event",o=>{this.safeEmit(Nt.CHANNEL_MEDIA_RELAY_EVENT,o)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(o,l)=>{var u;o==="resolution"&&((u=this._channelMediaRelayClient)===null||u===void 0||u.setVideoProfile(l))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:i}=e,o=[];if(t){const l=[];this._users.forEach(u=>{u._dataChannels.forEach(p=>{n.every(m=>m.uid!==u._uintid||m.stream_id!==p.id)&&l.push({uid:u._uintid,stream_id:p.id,ordered:p.ordered,max_retrans_times:p.maxRetransmits,metadata:p.metadata})})}),l.length>0&&this._handleUpdateDataChannel({added:[],deleted:l})}Array.isArray(n)&&n.length>0&&n.forEach(l=>{const{uid:u,stream_id:p,ordered:m,max_retrans_times:g,metadata:y}=l,b=this._users.find(S=>S._uintid===u);if(!b)return void C.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(C.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(u)),fe(o).call(o,b)||o.push(b),b._uintid||(b._uintid=u),b._dataChannels.findIndex(S=>S.id===l.stream_id)===-1){const S={id:p,ordered:!!m,maxRetransmits:g,metadata:y},w=function(k){return d4(k,!0)}(S);b._dataChannels.push(w),C.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published datachannel")),t||this.safeEmit(Nt.USER_PUBLISHED,b,"datachannel",S)}this._p2pChannel.hasPendingRemoteDataChannel(b,l.stream_id)&&(C.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(b.uid," after reconnect.")),this._subscribeDataChannel(b,l.stream_id).catch(S=>{C.error("[".concat(this._clientId,"] resubscribe datachannel error"),S.toString())}))}),t&&(this.safeEmit(Nt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(l=>{const{uid:u,stream_id:p}=l,m=this._users.find(y=>y._uintid===u);if(!m)return void C.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const g=m._dataChannels.find(y=>y.id===l.stream_id);g&&(C.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(u)),this._p2pChannel.unsubscribeDataChannel(m,[g]).then(y=>{if(m._dataChannels=m._dataChannels.filter(b=>b!==g),y)return this._gateway.unsubscribeDataChannel(y,m.uid)}),C.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished datachannel ,id:").concat(g.id)),this.safeEmit(Nt.USER_UNPUBLISHED,m,"datachannel",g._config))})}_getEncodingName(e){var t,n;if(!this._joinResponse)return;const i=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(!i)return;for(const p of i){var o;if(p.payloadType===e)return p==null||(o=p.rtpMap)===null||o===void 0?void 0:o.encodingName}const l=(n=this._joinResponse.ortc.rtpCapabilities.recv)===null||n===void 0?void 0:n.videoCodecs;if(l)for(const p of l){var u;if(p.payloadType===e)return p==null||(u=p.rtpMap)===null||u===void 0?void 0:u.encodingName}return e===0?"unknown":void 0}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){C.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(i=>{this.safeEmit(Nt.USER_UNPUBLISHED,t,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,t.uid)}),n()}}else C.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Kn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void C.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(i=>{const{value:o,type:l,expires:u}=t[i];u&&u<=n||l||VC()||!Object.prototype.hasOwnProperty.call(Hy,i)||(ki[i]=o,en[i]=o,C.debug("Update gateway parameters from config distribute",i,o))})}catch(t){C.error("Error update config from local cache",t.message)}})()}),this._gateway.on(Kn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Kn.CONNECTION_STATE_CHANGE,(e,t,n)=>{var i;if(n===kt.FALLBACK)return;const o=()=>{this.safeEmit(Nt.CONNECTION_STATE_CHANGE,e,t,n)};if(Ue.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:Rn.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:hn.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),C.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void o();if(e==="RECONNECTING")this._users.forEach(u=>{u._trust_in_room_=!1,u._trust_audio_enabled_state_=!1,u._trust_video_enabled_state_=!1,u._trust_audio_mute_state_=!1,u._trust_video_mute_state_=!1,u._trust_audio_stream_added_state_=!1,u._trust_video_stream_added_state_=!1,u._is_pre_created||(u._audio_pre_subscribed||(u._audioSSRC=void 0,u._audioOrtc=void 0),u._video_pre_subscribed||(u._videoSSRC=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),u._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var l;this._streamFallbackTypeCacheMap.forEach((u,p)=>{this._gateway.setStreamFallbackOption(p,u).catch(m=>{C.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),m)})}),this._remoteStreamTypeCacheMap.forEach((u,p)=>{this._gateway.setRemoteVideoStreamType(p,u).catch(m=>{C.warning("[".concat(this._clientId,"] auto set remote stream type failed"),m)})}),$("VOS_CONFIGURE")&&Array.isArray($("VOS_CONFIGURE"))&&$("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure($("VOS_CONFIGURE")).catch(u=>{C.debug("[".concat(this._clientId,"] auto set vos config failed"),u)}),C.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((l=this._joinInfo)===null||l===void 0?void 0:l.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{C.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(u=>{C.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(u))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(u=>{C.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),u)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(u=>!u._trust_in_room_).forEach(u=>{C.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(u.uid)),this._handleUserOffline({uid:u.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(u=>{u._trust_audio_mute_state_||(C.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(u.uid)),this._handleMuteStream(u.uid,Me.AUDIO,!1)),u._trust_video_mute_state_||(C.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(u.uid)),this._handleMuteStream(u.uid,Me.VIDEO,!1)),u._trust_audio_enabled_state_||(C.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(u.uid)),this._handleSetStreamLocalEnable("audio",u.uid,!0)),u._trust_video_enabled_state_||(C.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(u.uid)),this._handleSetStreamLocalEnable("video",u.uid,!0)),u._trust_video_stream_added_state_||(C.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(u.uid)),this._handleResetAddStream(u,"video")),u._trust_audio_stream_added_state_||(C.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(u.uid)),this._handleResetAddStream(u,"audio")),u._video_added_||u._audio_added_||(C.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(u.uid)),this._handleRemoveStream({uid:u.uid,uint_id:u._uintid}))}))},1e3))}o()}),this._gateway.on(Kn.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new ne(G.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;if(this._fallbackServerInfo)n=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,Ue.reportApiInvoke(this._sessionId,{name:Rn.VOS_FALLBACK_CN,options:{cur:n.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:hn.TRACER}).onSuccess(),C.info("[".concat(this._clientId,"] use fallback cn server info"));else{const o=await OR(Wo(Wo({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(n=o.ap,eF(o),this._joinInfo.preload=!0):(n=await NE(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Zn,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const i=[];n.gatewayInfo.gatewayAddrs.forEach(o=>{let{address:l}=o;const[u,p]=l.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:u,port:p}):i.push({host:u,port:p})}),e(i)}catch(n){t(n)}}),this._gateway.on(Kn.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Nt.NETWORK_QUALITY,e)}),this._gateway.on(Kn.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Nt.STREAM_TYPE_CHANGED,e,t),Ue.reportApiInvoke(this._sessionId,{name:Rn.STREAM_TYPE_CHANGE,options:[e,t],tag:hn.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Kn.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Kn.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let i=await this._p2pChannel.getEstablishParams();i&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(i=await this._p2pChannel.startP2PConnection(e)),t(i)}catch(i){n(i)}}),this._gateway.on(Kn.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:C.debug("no attributes in joinResponse");const i=e4(e.ortc,t,n);this._p2pChannel.connect(i)}),this._gateway.on(Kn.PRE_CONNECT_PC,async(e,t,n)=>{const{candidates:i,fingerprint:o,turnServer:l}=e;if(this._joinInfo&&i.length>0&&!this._p2pChannel.isPlanB){const{cert:p,cid:m}=this._joinInfo.apResponse,g="".concat(m,"_").concat(p);if(g.length<4||g.length>256)return void C.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(g.length));await this._p2pChannel.startP2PConnection({turnServer:l,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var u;t(await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(m,"_").concat(p),icePwd:"".concat(m,"_").concat(p)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(u=$("FINGERPRINT"))!==null&&u!==void 0?u:o}]},candidates:i,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(y){y.code&&y.code===G.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:l,cloudProxyServer:this._joinInfo.cloudProxyServer},!0),n(y)}}}),this._gateway.on(Kn.VOS_FALLBACK,e=>{e==="fallback_hls"&&this.safeEmit(Nt.FALLBACK_TO_HLS,XT.VOSERROR)}),this._gateway.on(Kn.RESET_SIGNAL,()=>{this._p2pChannel instanceof vu&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on(Kn.DATACHANNEL_FAILBACK,()=>{Ue.reportApiInvoke(this._sessionId,{name:Rn.DATACHANNEL_FAILBACK,options:{},tag:hn.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(lt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(lt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(lt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(lt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(lt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(lt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(lt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(lt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(lt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Me.AUDIO,!0)),this._gateway.signal.on(lt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Me.AUDIO,!1)),this._gateway.signal.on(lt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Me.VIDEO,!0)),this._gateway.signal.on(lt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Me.VIDEO,!1)),this._gateway.signal.on(lt.RECEIVE_METADATA,e=>{const t=ru(e.metadata);this.safeEmit(Nt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(lt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=ru(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&fe(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<cp)throw new ne(G.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(cp));n=await async function(l,u,p){const m=p.subarray(0,cp),g=m.slice(8,cp),y=(g[0]<<8)+g[1],b=(m[6]<<8)+m[7],S=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:l,tagLength:rU,additionalData:new Uint8Array(H5(y,2))},u,p.subarray(cp));return new Uint8Array(S).subarray(0,b)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(e.ordered||e.syncWithAudio){const o=this._p2pChannel.getStats(),l=this.remoteUsers.find(p=>p.uid===e.uid),u=o==null?void 0:o.audioRecv.find(p=>p.ssrc===(l==null?void 0:l._audioSSRC));i=u==null?void 0:u.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),Ade(Wo(Wo({},e),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(lt.ON_CRYPT_ERROR,()=>{Pl(()=>{C.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Nt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(lt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(lt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{C.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,kt.TOKEN_EXPIRE),this.safeEmit(Nt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(lt.ON_STREAM_FALLBACK_UPDATE,e=>{C.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Nt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(lt.ENABLE_MULTI_STREAM,e=>{this._dualStreamMode===np.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(t=>{C.debug("[".concat(this._clientId,"] set dual stream mode error"),t.toString())})}),this._gateway.signal.on(lt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),C.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(lt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(lt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Fe.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case He.PUBLISH:{if(!t)return;const o=t.ortc;if(o){var n,i;const l=o.some(m=>{let{stream_type:g}=m;return g===tn.Audio}),u=o.some(m=>{let{stream_type:g}=m;return g!==tn.Audio}),p=o.some(m=>{let{stream_type:g}=m;return g===tn.Screen||g===tn.ScreenLow});t.state==="offer"&&Ue.publish(this._joinInfo.sid,{eventElapse:rs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:G.TIMEOUT,audio:l,video:u,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:p,audioName:l?(n=o.find(m=>{let{stream_type:g}=m;return g===tn.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:u?(i=o.find(m=>{let{stream_type:g}=m;return g!==tn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case He.SUBSCRIBE:t&&Ue.subscribe(this._joinInfo.sid,{succ:!1,ec:G.TIMEOUT,audio:t.stream_type===Me.AUDIO,video:t.stream_type===Me.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:rs.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(lt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(lt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;$("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(i=>!mu(i.string_id||i.stream_id,this.channelName)));const t=[],n=[];for(const i of e.users){let o=this._users.find(y=>y._uintid===i.stream_id);o?o._trust_in_room_=!0:(o=new Fl(i.string_id||i.stream_id,i.stream_id),this._users.push(o),this.store.firstVideoFrameDecoded(o.uid,{userJoinNotify:Date.now()}),this.getListeners(Nt.PUBLISHED_USER_LIST).length===0&&(C.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(Nt.USER_JOINED,o)));const l=Sr.Audio&i.stream_type,u=(Sr.Video|Sr.LwoVideo)&i.stream_type,p=(65280&i.stream_type)!=0,m=l&&o.hasAudio,g=u&&o.hasVideo;u&&(o._trust_video_stream_added_state_=!0,o._video_added_=!0,o._videoSSRC=i.video_ssrc,o._rtxSsrcId=i.video_rtx),l&&(o._trust_audio_stream_added_state_=!0,o._audio_added_=!0,o._audioSSRC=i.audio_ssrc),l&&!m&&this.getListeners(Nt.PUBLISHED_USER_LIST).length===0&&(C.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published audio")),this.safeEmit(Nt.USER_PUBLISHED,o,"audio")),u&&!g&&this.getListeners(Nt.PUBLISHED_USER_LIST).length===0&&(C.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published video")),this.safeEmit(Nt.USER_PUBLISHED,o,"video")),(l&&!m||u&&!g||p)&&t.push(o),u&&this._p2pChannel.hasPendingRemoteMedia(o,"video")&&n.push({user:o,mediaType:"video"}),l&&this._p2pChannel.hasPendingRemoteMedia(o,"audio")&&n.push({user:o,mediaType:"audio"})}n.length>0&&(C.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{C.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(Nt.PUBLISHED_USER_LIST).length>0?$("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(C.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(i=>i.uid).join(", "))),this.safeEmit(Nt.PUBLISHED_USER_LIST,t)):C.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(lt.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;if(this._p2pChannel instanceof vu){if(this.role==="audience"&&$("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=e,void C.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(e)));this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var i;return fe(i=Object.keys(ou)).call(i,n)}))}}),this._gateway.signal.on(Fe.VOS_FALLBACK_PROMISE,async(e,t,n)=>{if(e==="FALLBACKCN"&&$("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return n(new ne(G.UNEXPECTED_ERROR,"can not recover, no join info"));C.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));const o=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=e;const l=await NE(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Zn,this.store);if($("QUALITY_FALLBACK_REHEARSAL"))return Ue.reportApiInvoke(this._sessionId,{name:Rn.VOS_FALLBACK_CN,options:{cur:l.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:hn.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=o,void n();this._fallbackServerInfo=l,t()}catch(l){var i;const u=l==null||(i=l.data)===null||i===void 0?void 0:i.desc;$("QUALITY_FALLBACK_REHEARSAL")?(Ue.reportApiInvoke(this._sessionId,{name:Rn.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+u||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:hn.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=o):Array.isArray(u)&&fe(u).call(u,"request downgrade fallback")&&this.safeEmit(Nt.FALLBACK_TO_HLS,XT.AP_ERROR),n(l)}}else n()})}_handleP2PEvents(){this._gateway.signal.on(lt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(zn.PUBLISH,(e,t,n)=>{const{uid:i}=e;e.forEach(o=>{const{kind:l,ssrcs:u,mid:p,isMuted:m}=o;this._handleP2PAddAudioOrVideoStream(l,i,u[0].ssrcId,p);const g=this._users.find(y=>y.uid===i);return g&&this.store.useP2P?this._p2pChannel.mockSubscribe(g,l,u[0].ssrcId,p).then(()=>{t()}).catch(n):t(),this._handleMuteStream(i,l,!!m)})}),this._gateway.signal.on(zn.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var i;t(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},e))}catch(o){n(o)}}),this._gateway.signal.on(Fe.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(zn.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:o}=e,l=this._users.find(u=>u.uid===o);if(!l)return C.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o)),void t();try{i.forEach(async u=>{let{stream_type:p}=u;const m=p===tn.Audio?Me.AUDIO:Me.VIDEO;await this._p2pChannel.unsubscribe(l,m),this._handleMuteStream(o,m,!0)}),t()}catch(u){n(u)}}}),this._gateway.signal.on(zn.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case jl.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Me.VIDEO,!0);break;case jl.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Me.AUDIO,!0);break;case jl.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Me.VIDEO,!1);break;case jl.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Me.AUDIO,!1)}}),this._gateway.signal.on(zn.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:o}=e;i!==Os.SEND_ONLY||o?t(await this._p2pChannel.restartICE(i,o)):(this._p2pChannel.handleDisconnect(i),t())}catch(i){n(i)}}),this._gateway.signal.on(zn.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(Ke.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:i}=e;t(await this._gateway.sendExtensionMessage(zn.RESTART_ICE,e,i===Os.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(Ke.LocalCandidate,e=>{this._gateway.sendExtensionMessage(zn.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Ke.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(zn.CONTROL,e,!0),t()}catch(i){n(i)}}),this._p2pChannel.on(Ke.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===G.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Ke.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===G.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Ke.StateChange,(e,t)=>{t===qt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Ke.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(Nt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Ke.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===G.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Ke.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===G.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Ke.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Ke.RequestRePublishDataChannel,(e,t,n)=>{xe.all(e.map(async i=>{const o=await this._p2pChannel.publishDataChannel([i]);try{o.forEach(l=>{this._uid&&this._gateway.publishDataChannel(this._uid,l,!0)})}catch(l){if(l.code!==G.DISCONNECT_P2P)throw l}})).then(t).catch(n)}),this._p2pChannel.on(Ke.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:i,kind:o}of e)o===Me.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");t()}catch(i){n(i)}}),this._p2pChannel.on(Ke.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Ke.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Ke.MediaReconnectStart,e=>{this.safeEmit(Nt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Ke.MediaReconnectEnd,e=>{this.safeEmit(Nt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Ke.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ke.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const i=n.value;let o;try{o=await this._gateway.restartICE({iceParameters:i})}catch(u){return void t.throw(u)}const{iceParameters:l}=function(u){const p=u.iceParameters;return{iceParameters:{iceUfrag:p.iceUfrag,icePwd:p.icePwd}}}(o);await t.next({remoteIceParameters:l})}),this._p2pChannel.on(Ke.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ke.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:o,gatewayAddress:l}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:i}),u=e4(o,l);await this._p2pChannel.connect(u),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ke.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Ke.P2PLost,()=>{this.safeEmit(Nt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ke.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Ke.ConnectionTypeChange,e=>{this.safeEmit(Nt.IS_USING_CLOUD_PROXY,e),this._gateway.setUsingProxy(e)}),this._p2pChannel.on(Ke.FirstVideoBufferReady,(e,t)=>{this.safeEmit(Nt.FIRST_VIDEO_BUFFER_READY,e,t)}),this._p2pChannel.on(Ke.FirstVideoPreRender,(e,t)=>{this.safeEmit(Nt.FIRST_VIDEO_PRE_RENDER,e,t)}),this._p2pChannel.on(Ke.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ke.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Ke.AudioMetadata,e=>{this.safeEmit(Nt.AUDIO_METADATA,e)}),this._p2pChannel.on(Ke.AudioPts,e=>{this.safeEmit(Nt.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new ne(G.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new ne(G.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},Ea("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:o,sid:l,token:u,uid:p,cid:m,vid:g}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:o,sid:l,token:u,uid:p,cid:m,vid:g?Number(g):0},Zn)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(Or.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Nt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Uo.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Nt.CONTENT_INSPECT_ERROR,new ne(G.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Or.INSPECT_RESULT,(t,n)=>{var i;if((n==null?void 0:n.code)===G.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return C.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(Nt.CONTENT_INSPECT_RESULT,t,n)}),e.on(Or.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new ne(G.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Do(e,"enabled"),e){if(!t)throw new ne(G.INVALID_PARAMS,"config is required");if(mF(t),!this._joinInfo)throw new ne(G.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const i=(n={config:t},Ea("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:o,cname:l,sid:u,token:p,uid:m,cid:g,vid:y}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:l,sid:u,token:p,uid:m,cid:g,vid:y?Number(y):0},Zn)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new ne(G.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(e){e.on(ya.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Nt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===oo.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ne(G.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(ya.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){Qn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new ne(G.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,C.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return C.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Do(e,"enabled"),on("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_setRteInfo(e,t){this.store.rteUrl=e,this.store.rteSid=t}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},we(ke.prototype,"leave",[fF],Object.getOwnPropertyDescriptor(ke.prototype,"leave"),ke.prototype),we(ke.prototype,"publish",[gF],Object.getOwnPropertyDescriptor(ke.prototype,"publish"),ke.prototype),we(ke.prototype,"unpublish",[_F],Object.getOwnPropertyDescriptor(ke.prototype,"unpublish"),ke.prototype),we(ke.prototype,"subscribe",[yF],Object.getOwnPropertyDescriptor(ke.prototype,"subscribe"),ke.prototype),we(ke.prototype,"presubscribe",[EF],Object.getOwnPropertyDescriptor(ke.prototype,"presubscribe"),ke.prototype),we(ke.prototype,"massSubscribe",[vF],Object.getOwnPropertyDescriptor(ke.prototype,"massSubscribe"),ke.prototype),we(ke.prototype,"unsubscribe",[bF],Object.getOwnPropertyDescriptor(ke.prototype,"unsubscribe"),ke.prototype),we(ke.prototype,"massUnsubscribe",[SF],Object.getOwnPropertyDescriptor(ke.prototype,"massUnsubscribe"),ke.prototype),we(ke.prototype,"setLowStreamParameter",[xF],Object.getOwnPropertyDescriptor(ke.prototype,"setLowStreamParameter"),ke.prototype),we(ke.prototype,"setDualStreamMode",[wF],Object.getOwnPropertyDescriptor(ke.prototype,"setDualStreamMode"),ke.prototype),we(ke.prototype,"enableDualStream",[TF],Object.getOwnPropertyDescriptor(ke.prototype,"enableDualStream"),ke.prototype),we(ke.prototype,"disableDualStream",[CF],Object.getOwnPropertyDescriptor(ke.prototype,"disableDualStream"),ke.prototype),we(ke.prototype,"setClientRole",[RF],Object.getOwnPropertyDescriptor(ke.prototype,"setClientRole"),ke.prototype),we(ke.prototype,"_setClientRoleOptions",[NF],Object.getOwnPropertyDescriptor(ke.prototype,"_setClientRoleOptions"),ke.prototype),we(ke.prototype,"setProxyServer",[AF],Object.getOwnPropertyDescriptor(ke.prototype,"setProxyServer"),ke.prototype),we(ke.prototype,"setTurnServer",[IF],Object.getOwnPropertyDescriptor(ke.prototype,"setTurnServer"),ke.prototype),we(ke.prototype,"setLicense",[OF],Object.getOwnPropertyDescriptor(ke.prototype,"setLicense"),ke.prototype),we(ke.prototype,"startProxyServer",[PF],Object.getOwnPropertyDescriptor(ke.prototype,"startProxyServer"),ke.prototype),we(ke.prototype,"stopProxyServer",[DF],Object.getOwnPropertyDescriptor(ke.prototype,"stopProxyServer"),ke.prototype),we(ke.prototype,"setLocalAccessPointsV2",[kF],Object.getOwnPropertyDescriptor(ke.prototype,"setLocalAccessPointsV2"),ke.prototype),we(ke.prototype,"setLocalAccessPoints",[LF],Object.getOwnPropertyDescriptor(ke.prototype,"setLocalAccessPoints"),ke.prototype),we(ke.prototype,"setRemoteDefaultVideoStreamType",[MF],Object.getOwnPropertyDescriptor(ke.prototype,"setRemoteDefaultVideoStreamType"),ke.prototype),we(ke.prototype,"setRemoteVideoStreamType",[jF],Object.getOwnPropertyDescriptor(ke.prototype,"setRemoteVideoStreamType"),ke.prototype),we(ke.prototype,"setStreamFallbackOption",[UF],Object.getOwnPropertyDescriptor(ke.prototype,"setStreamFallbackOption"),ke.prototype),we(ke.prototype,"setEncryptionConfig",[VF],Object.getOwnPropertyDescriptor(ke.prototype,"setEncryptionConfig"),ke.prototype),we(ke.prototype,"renewToken",[FF],Object.getOwnPropertyDescriptor(ke.prototype,"renewToken"),ke.prototype),we(ke.prototype,"enableAudioVolumeIndicator",[BF],Object.getOwnPropertyDescriptor(ke.prototype,"enableAudioVolumeIndicator"),ke.prototype),we(ke.prototype,"startLiveStreaming",[$F],Object.getOwnPropertyDescriptor(ke.prototype,"startLiveStreaming"),ke.prototype),we(ke.prototype,"setLiveTranscoding",[WF],Object.getOwnPropertyDescriptor(ke.prototype,"setLiveTranscoding"),ke.prototype),we(ke.prototype,"stopLiveStreaming",[GF],Object.getOwnPropertyDescriptor(ke.prototype,"stopLiveStreaming"),ke.prototype),we(ke.prototype,"startChannelMediaRelay",[HF],Object.getOwnPropertyDescriptor(ke.prototype,"startChannelMediaRelay"),ke.prototype),we(ke.prototype,"updateChannelMediaRelay",[KF],Object.getOwnPropertyDescriptor(ke.prototype,"updateChannelMediaRelay"),ke.prototype),we(ke.prototype,"stopChannelMediaRelay",[zF],Object.getOwnPropertyDescriptor(ke.prototype,"stopChannelMediaRelay"),ke.prototype),we(ke.prototype,"sendCustomReportMessage",[YF],Object.getOwnPropertyDescriptor(ke.prototype,"sendCustomReportMessage"),ke.prototype),we(ke.prototype,"pickSVCLayer",[qF],Object.getOwnPropertyDescriptor(ke.prototype,"pickSVCLayer"),ke.prototype),we(ke.prototype,"setRTMConfig",[XF],Object.getOwnPropertyDescriptor(ke.prototype,"setRTMConfig"),ke.prototype),we(ke.prototype,"enableContentInspect",[JF],Object.getOwnPropertyDescriptor(ke.prototype,"enableContentInspect"),ke.prototype),we(ke.prototype,"disableContentInspect",[QF],Object.getOwnPropertyDescriptor(ke.prototype,"disableContentInspect"),ke.prototype),we(ke.prototype,"setImageModeration",[ZF],Object.getOwnPropertyDescriptor(ke.prototype,"setImageModeration"),ke.prototype),we(ke.prototype,"setP2PTransport",[eB],Object.getOwnPropertyDescriptor(ke.prototype,"setP2PTransport"),ke.prototype),we(ke.prototype,"getJoinChannelServiceRecords",[tB],Object.getOwnPropertyDescriptor(ke.prototype,"getJoinChannelServiceRecords"),ke.prototype),we(ke.prototype,"setPublishAudioFilterEnabled",[nB],Object.getOwnPropertyDescriptor(ke.prototype,"setPublishAudioFilterEnabled"),ke.prototype),ke);function sB(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Zt(5,"client-"),i=Ue.reportApiInvoke(null,{id:n,name:Rn.CREATE_CLIENT,options:[t],tag:hn.TRACER});try{(function(o){Qn(o.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Qn(o.mode,"config.mode",["rtc","live","p2p"]),o.audioCodec!==void 0&&Qn(o.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),o.proxyServer!==void 0&&Vr(o.proxyServer,"config.proxyServer",1,1e4),o.turnServer!==void 0&&M5(o.turnServer),o.httpRetryConfig!==void 0&&L5(o.httpRetryConfig),o.websocketRetryConfig!==void 0&&L5(o.websocketRetryConfig)})(t)}catch(o){throw i.onError(o),o}return(S5(16,0)||WT(16,0))&&(t.codec==="vp9"&&(t.codec="vp8",C.debug("browser not support vp9, force use vp8")),on("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),i.onSuccess(),new Hde(Wo(Wo({forceWaitGatewayResponse:!0},t),{},{role:fe(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)}function Kde(){let e=!1;const t=Ft();return(t.name===Ht.CHROME&&Number(t.version)>=58&&(ha.engine.name!=="WebKit"||function(){const n=Ft();if(jy()){if(n.os===Er.MAC_OS)return!0;if(n.os===Er.IOS){const i=ha.os.version&&ha.os.version.split(".");if(i&&Number(i[0])===14&&i[1]&&Number(i[1])>=3||i&&Number(i[0])>14)return!0}}return!1}())||t.name===Ht.FIREFOX&&Number(t.version)>=56||t.name===Ht.OPERA&&Number(t.version)>=45||t.name===Ht.SAFARI&&Number(t.version)>=11||t.name==="WebKit"&&(ds()||Po())&&t.osVersion&&Number(t.osVersion.split(".")[0])>=11||T5()||Ft().name===Ht.QQ)&&(e=!0),e}class ig{constructor(t,n){D(this,"id",0),D(this,"element",void 0),D(this,"peerPair",void 0),D(this,"context",void 0),D(this,"audioPlayerElement",void 0),D(this,"audioTrack",void 0),ig.count+=1,this.id=ig.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(i,o)=>{const l=o==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(l),i.iceGatheringState==="complete"?i.localDescription:new xe(u=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&u(i.localDescription)}})},n=async(i,o)=>await i.setRemoteDescription(o);try{const i=await t(this.peerPair[0],"offer");await n(this.peerPair[1],i);const o=await t(this.peerPair[1],"answer");await n(this.peerPair[0],o)}catch(i){throw new ne(G.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(o){throw new ne(G.LOCAL_AEC_ERROR,o.toString()).print()}if(!n)throw new ne(G.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){C.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var iB,BE;D(ig,"count",0);const zde=window.AudioContext||window.webkitAudioContext,Yde=new(iB=nt({report:Ue}),we((BE=class{constructor(){D(this,"units",[]),D(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return C.debug("the system does not need to process local aec"),-1;this.context||(this.context=new zde);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new ig(e,this.context),this.units.push(t)),t.startEchoCancellation(),C.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Ft().name!==Ht.SAFARI}}).prototype,"processExternalMediaAEC",[iB],Object.getOwnPropertyDescriptor(BE.prototype,"processExternalMediaAEC"),BE.prototype),BE);function oB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function aB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oB(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oB(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const MR=window||document;function cB(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!MR)return;const n=cr._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const i=o=>{if(!(o&&o.blockedURI&&(cr.onSecurityPolicyViolation||cr.getListeners(oc.SECURITY_POLICY_VIOLATION).length>0)))return;const l=o.blockedURI;$("CSP_DETECTED_HOSTNAME_LIST").some(u=>fe(l).call(l,u))&&(cr.onSecurityPolicyViolation&&typeof cr.onSecurityPolicyViolation=="function"&&cr.onSecurityPolicyViolation(o),cr.getListeners(oc.SECURITY_POLICY_VIOLATION).length>0&&cr.safeEmit(oc.SECURITY_POLICY_VIOLATION,o))};n&&MR.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||cr.getListeners(oc.SECURITY_POLICY_VIOLATION).length>0)&&MR.addEventListener("securitypolicyviolation",i),cr._cspEventHandlerPointer=i}var qde=N,Xde=qw,lB=RegExp.prototype,Jde=function(e){return e===lB||qde(lB,e)?Xde(e):e.flags},ys=h(Jde);function kp(e){let t=e.length;for(;--t>=0;)e[t]=0}const jR=256,dB=286,og=30,ag=15,UR=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),$E=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Qde=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),uB=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),qc=new Array(576);kp(qc);const cg=new Array(60);kp(cg);const lg=new Array(512);kp(lg);const dg=new Array(256);kp(dg);const VR=new Array(29);kp(VR);const WE=new Array(og);function FR(e,t,n,i,o){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=o,this.has_stree=e&&e.length}let hB,pB,mB;function BR(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}kp(WE);const fB=e=>e<256?lg[e]:lg[256+(e>>>7)],ug=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},$i=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,ug(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},hc=(e,t,n)=>{$i(e,n[2*t],n[2*t+1])},gB=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},_B=(e,t,n)=>{const i=new Array(16);let o,l,u=0;for(o=1;o<=ag;o++)u=u+n[o-1]<<1,i[o]=u;for(l=0;l<=t;l++){let p=e[2*l+1];p!==0&&(e[2*l]=gB(i[p]++,p))}},yB=e=>{let t;for(t=0;t<dB;t++)e.dyn_ltree[2*t]=0;for(t=0;t<og;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},EB=e=>{e.bi_valid>8?ug(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},vB=(e,t,n,i)=>{const o=2*t,l=2*n;return e[o]<e[l]||e[o]===e[l]&&i[t]<=i[n]},$R=(e,t,n)=>{const i=e.heap[n];let o=n<<1;for(;o<=e.heap_len&&(o<e.heap_len&&vB(t,e.heap[o+1],e.heap[o],e.depth)&&o++,!vB(t,i,e.heap[o],e.depth));)e.heap[n]=e.heap[o],n=o,o<<=1;e.heap[n]=i},bB=(e,t,n)=>{let i,o,l,u,p=0;if(e.sym_next!==0)do i=255&e.pending_buf[e.sym_buf+p++],i+=(255&e.pending_buf[e.sym_buf+p++])<<8,o=e.pending_buf[e.sym_buf+p++],i===0?hc(e,o,t):(l=dg[o],hc(e,l+jR+1,t),u=UR[l],u!==0&&(o-=VR[l],$i(e,o,u)),i--,l=fB(i),hc(e,l,n),u=$E[l],u!==0&&(i-=WE[l],$i(e,i,u)));while(p<e.sym_next);hc(e,256,t)},WR=(e,t)=>{const n=t.dyn_tree,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems;let u,p,m,g=-1;for(e.heap_len=0,e.heap_max=573,u=0;u<l;u++)n[2*u]!==0?(e.heap[++e.heap_len]=g=u,e.depth[u]=0):n[2*u+1]=0;for(;e.heap_len<2;)m=e.heap[++e.heap_len]=g<2?++g:0,n[2*m]=1,e.depth[m]=0,e.opt_len--,o&&(e.static_len-=i[2*m+1]);for(t.max_code=g,u=e.heap_len>>1;u>=1;u--)$R(e,n,u);m=l;do u=e.heap[1],e.heap[1]=e.heap[e.heap_len--],$R(e,n,1),p=e.heap[1],e.heap[--e.heap_max]=u,e.heap[--e.heap_max]=p,n[2*m]=n[2*u]+n[2*p],e.depth[m]=(e.depth[u]>=e.depth[p]?e.depth[u]:e.depth[p])+1,n[2*u+1]=n[2*p+1]=m,e.heap[1]=m++,$R(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((y,b)=>{const S=b.dyn_tree,w=b.max_code,k=b.stat_desc.static_tree,I=b.stat_desc.has_stree,O=b.stat_desc.extra_bits,W=b.stat_desc.extra_base,H=b.stat_desc.max_length;let Y,Q,Z,q,ee,ce,me=0;for(q=0;q<=ag;q++)y.bl_count[q]=0;for(S[2*y.heap[y.heap_max]+1]=0,Y=y.heap_max+1;Y<573;Y++)Q=y.heap[Y],q=S[2*S[2*Q+1]+1]+1,q>H&&(q=H,me++),S[2*Q+1]=q,Q>w||(y.bl_count[q]++,ee=0,Q>=W&&(ee=O[Q-W]),ce=S[2*Q],y.opt_len+=ce*(q+ee),I&&(y.static_len+=ce*(k[2*Q+1]+ee)));if(me!==0){do{for(q=H-1;y.bl_count[q]===0;)q--;y.bl_count[q]--,y.bl_count[q+1]+=2,y.bl_count[H]--,me-=2}while(me>0);for(q=H;q!==0;q--)for(Q=y.bl_count[q];Q!==0;)Z=y.heap[--Y],Z>w||(S[2*Z+1]!==q&&(y.opt_len+=(q-S[2*Z+1])*S[2*Z],S[2*Z+1]=q),Q--)}})(e,t),_B(n,g,e.bl_count)},SB=(e,t,n)=>{let i,o,l=-1,u=t[1],p=0,m=7,g=4;for(u===0&&(m=138,g=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)o=u,u=t[2*(i+1)+1],++p<m&&o===u||(p<g?e.bl_tree[2*o]+=p:o!==0?(o!==l&&e.bl_tree[2*o]++,e.bl_tree[32]++):p<=10?e.bl_tree[34]++:e.bl_tree[36]++,p=0,l=o,u===0?(m=138,g=3):o===u?(m=6,g=3):(m=7,g=4))},xB=(e,t,n)=>{let i,o,l=-1,u=t[1],p=0,m=7,g=4;for(u===0&&(m=138,g=3),i=0;i<=n;i++)if(o=u,u=t[2*(i+1)+1],!(++p<m&&o===u)){if(p<g)do hc(e,o,e.bl_tree);while(--p!=0);else o!==0?(o!==l&&(hc(e,o,e.bl_tree),p--),hc(e,16,e.bl_tree),$i(e,p-3,2)):p<=10?(hc(e,17,e.bl_tree),$i(e,p-3,3)):(hc(e,18,e.bl_tree),$i(e,p-11,7));p=0,l=o,u===0?(m=138,g=3):o===u?(m=6,g=3):(m=7,g=4)}};let wB=!1;const TB=(e,t,n,i)=>{$i(e,0+(i?1:0),3),EB(e),ug(e,n),ug(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var Zde=e=>{wB||((()=>{let t,n,i,o,l;const u=new Array(16);for(i=0,o=0;o<28;o++)for(VR[o]=i,t=0;t<1<<UR[o];t++)dg[i++]=o;for(dg[i-1]=o,l=0,o=0;o<16;o++)for(WE[o]=l,t=0;t<1<<$E[o];t++)lg[l++]=o;for(l>>=7;o<og;o++)for(WE[o]=l<<7,t=0;t<1<<$E[o]-7;t++)lg[256+l++]=o;for(n=0;n<=ag;n++)u[n]=0;for(t=0;t<=143;)qc[2*t+1]=8,t++,u[8]++;for(;t<=255;)qc[2*t+1]=9,t++,u[9]++;for(;t<=279;)qc[2*t+1]=7,t++,u[7]++;for(;t<=287;)qc[2*t+1]=8,t++,u[8]++;for(_B(qc,287,u),t=0;t<og;t++)cg[2*t+1]=5,cg[2*t]=gB(t,5);hB=new FR(qc,UR,257,dB,ag),pB=new FR(cg,$E,0,og,ag),mB=new FR(new Array(0),Qde,0,19,7)})(),wB=!0),e.l_desc=new BR(e.dyn_ltree,hB),e.d_desc=new BR(e.dyn_dtree,pB),e.bl_desc=new BR(e.bl_tree,mB),e.bi_buf=0,e.bi_valid=0,yB(e)},eue=(e,t,n,i)=>{let o,l,u=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(p=>{let m,g=4093624447;for(m=0;m<=31;m++,g>>>=1)if(1&g&&p.dyn_ltree[2*m]!==0)return 0;if(p.dyn_ltree[18]!==0||p.dyn_ltree[20]!==0||p.dyn_ltree[26]!==0)return 1;for(m=32;m<jR;m++)if(p.dyn_ltree[2*m]!==0)return 1;return 0})(e)),WR(e,e.l_desc),WR(e,e.d_desc),u=(p=>{let m;for(SB(p,p.dyn_ltree,p.l_desc.max_code),SB(p,p.dyn_dtree,p.d_desc.max_code),WR(p,p.bl_desc),m=18;m>=3&&p.bl_tree[2*uB[m]+1]===0;m--);return p.opt_len+=3*(m+1)+5+5+4,m})(e),o=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=o&&(o=l)):o=l=n+5,n+4<=o&&t!==-1?TB(e,t,n,i):e.strategy===4||l===o?($i(e,2+(i?1:0),3),bB(e,qc,cg)):($i(e,4+(i?1:0),3),((p,m,g,y)=>{let b;for($i(p,m-257,5),$i(p,g-1,5),$i(p,y-4,4),b=0;b<y;b++)$i(p,p.bl_tree[2*uB[b]+1],3);xB(p,p.dyn_ltree,m-1),xB(p,p.dyn_dtree,g-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,u+1),bB(e,e.dyn_ltree,e.dyn_dtree)),yB(e),i&&EB(e)},tue=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(dg[n]+jR+1)]++,e.dyn_dtree[2*fB(t)]++),e.sym_next===e.sym_end),nue=e=>{$i(e,2,3),hc(e,256,qc),(t=>{t.bi_valid===16?(ug(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},rue={_tr_init:Zde,_tr_stored_block:TB,_tr_flush_block:eue,_tr_tally:tue,_tr_align:nue},hg=(e,t,n,i)=>{let o=65535&e|0,l=e>>>16&65535|0,u=0;for(;n!==0;){u=n>2e3?2e3:n,n-=u;do o=o+t[i++]|0,l=l+o|0;while(--u);o%=65521,l%=65521}return o|l<<16|0};const sue=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Ps=(e,t,n,i)=>{const o=sue,l=i+n;e^=-1;for(let u=i;u<l;u++)e=e>>>8^o[255&(e^t[u])];return-1^e},xu={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Lp={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:iue,_tr_stored_block:GR,_tr_flush_block:oue,_tr_tally:Gl,_tr_align:aue}=rue,{Z_NO_FLUSH:Hl,Z_PARTIAL_FLUSH:cue,Z_FULL_FLUSH:lue,Z_FINISH:Go,Z_BLOCK:CB,Z_OK:$s,Z_STREAM_END:RB,Z_STREAM_ERROR:pc,Z_DATA_ERROR:due,Z_BUF_ERROR:HR,Z_DEFAULT_COMPRESSION:uue,Z_FILTERED:hue,Z_HUFFMAN_ONLY:GE,Z_RLE:pue,Z_FIXED:mue,Z_DEFAULT_STRATEGY:fue,Z_UNKNOWN:gue,Z_DEFLATED:HE}=Lp,KR=286,_ue=30,yue=19,Eue=2*KR+1,vue=15,wu=258,mc=262,Mp=42,Tu=113,pg=666,Cu=(e,t)=>(e.msg=xu[t],t),NB=e=>2*e-(e>4?9:0),Kl=e=>{let t=e.length;for(;--t>=0;)e[t]=0},bue=e=>{let t,n,i,o=e.w_size;t=e.hash_size,i=t;do n=e.head[--i],e.head[i]=n>=o?n-o:0;while(--t);t=o,i=t;do n=e.prev[--i],e.prev[i]=n>=o?n-o:0;while(--t)};let zl=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const ao=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},co=(e,t)=>{oue(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ao(e.strm)},Hn=(e,t)=>{e.pending_buf[e.pending++]=t},mg=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},zR=(e,t,n,i)=>{let o=e.avail_in;return o>i&&(o=i),o===0?0:(e.avail_in-=o,t.set(e.input.subarray(e.next_in,e.next_in+o),n),e.state.wrap===1?e.adler=hg(e.adler,t,o,n):e.state.wrap===2&&(e.adler=Ps(e.adler,t,o,n)),e.next_in+=o,e.total_in+=o,o)},AB=(e,t)=>{let n,i,o=e.max_chain_length,l=e.strstart,u=e.prev_length,p=e.nice_match;const m=e.strstart>e.w_size-mc?e.strstart-(e.w_size-mc):0,g=e.window,y=e.w_mask,b=e.prev,S=e.strstart+wu;let w=g[l+u-1],k=g[l+u];e.prev_length>=e.good_match&&(o>>=2),p>e.lookahead&&(p=e.lookahead);do if(n=t,g[n+u]===k&&g[n+u-1]===w&&g[n]===g[l]&&g[++n]===g[l+1]){l+=2,n++;do;while(g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&l<S);if(i=wu-(S-l),l=S-wu,i>u){if(e.match_start=t,u=i,i>=p)break;w=g[l+u-1],k=g[l+u]}}while((t=b[t&y])>m&&--o!=0);return u<=e.lookahead?u:e.lookahead},jp=e=>{const t=e.w_size;let n,i,o;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-mc)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),bue(e),i+=t),e.strm.avail_in===0)break;if(n=zR(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=zl(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=zl(e,e.ins_h,e.window[o+3-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<mc&&e.strm.avail_in!==0)},IB=(e,t)=>{let n,i,o,l=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,u=0,p=e.strm.avail_in;do{if(n=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o||(o=e.strm.avail_out-o,i=e.strstart-e.block_start,n>i+e.strm.avail_in&&(n=i+e.strm.avail_in),n>o&&(n=o),n<l&&(n===0&&t!==Go||t===Hl||n!==i+e.strm.avail_in)))break;u=t===Go&&n===i+e.strm.avail_in?1:0,GR(e,0,0,u),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,ao(e.strm),i&&(i>n&&(i=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,n-=i),n&&(zR(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(u===0);return p-=e.strm.avail_in,p&&(p>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=p&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-p,e.strm.next_in),e.strstart),e.strstart+=p,e.insert+=p>e.w_size-e.insert?e.w_size-e.insert:p),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),u?4:t!==Hl&&t!==Go&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(zR(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,l=o>e.w_size?e.w_size:o,i=e.strstart-e.block_start,(i>=l||(i||t===Go)&&t!==Hl&&e.strm.avail_in===0&&i<=o)&&(n=i>o?o:i,u=t===Go&&e.strm.avail_in===0&&n===i?1:0,GR(e,e.block_start,n,u),e.block_start+=n,ao(e.strm)),u?3:1)},YR=(e,t)=>{let n,i;for(;;){if(e.lookahead<mc){if(jp(e),e.lookahead<mc&&t===Hl)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=zl(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-mc&&(e.match_length=AB(e,n)),e.match_length>=3)if(i=Gl(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=zl(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=zl(e,e.ins_h,e.window[e.strstart+1]);else i=Gl(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(co(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Go?(co(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(co(e,!1),e.strm.avail_out===0)?1:2},Up=(e,t)=>{let n,i,o;for(;;){if(e.lookahead<mc){if(jp(e),e.lookahead<mc&&t===Hl)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=zl(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-mc&&(e.match_length=AB(e,n),e.match_length<=5&&(e.strategy===hue||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-3,i=Gl(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=o&&(e.ins_h=zl(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(co(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(i=Gl(e,0,e.window[e.strstart-1]),i&&co(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=Gl(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Go?(co(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(co(e,!1),e.strm.avail_out===0)?1:2};function fc(e,t,n,i,o){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=o}const fg=[new fc(0,0,0,0,IB),new fc(4,4,8,4,YR),new fc(4,5,16,8,YR),new fc(4,6,32,32,YR),new fc(4,4,16,16,Up),new fc(8,16,32,32,Up),new fc(8,16,128,128,Up),new fc(8,32,128,256,Up),new fc(32,128,258,1024,Up),new fc(32,258,258,4096,Up)];function Sue(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=HE,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Eue),this.dyn_dtree=new Uint16Array(2*(2*_ue+1)),this.bl_tree=new Uint16Array(2*(2*yue+1)),Kl(this.dyn_ltree),Kl(this.dyn_dtree),Kl(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(vue+1),this.heap=new Uint16Array(2*KR+1),Kl(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*KR+1),Kl(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const gg=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Mp&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Tu&&t.status!==pg?1:0},OB=e=>{if(gg(e))return Cu(e,pc);e.total_in=e.total_out=0,e.data_type=gue;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Mp:Tu,e.adler=t.wrap===2?0:1,t.last_flush=-2,iue(t),$s},PB=e=>{const t=OB(e);return t===$s&&(n=>{n.window_size=2*n.w_size,Kl(n.head),n.max_lazy_match=fg[n.level].max_lazy,n.good_match=fg[n.level].good_length,n.nice_match=fg[n.level].nice_length,n.max_chain_length=fg[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},DB=(e,t,n,i,o,l)=>{if(!e)return pc;let u=1;if(t===uue&&(t=6),i<0?(u=0,i=-i):i>15&&(u=2,i-=16),o<1||o>9||n!==HE||i<8||i>15||t<0||t>9||l<0||l>mue||i===8&&u!==1)return Cu(e,pc);i===8&&(i=9);const p=new Sue;return e.state=p,p.strm=e,p.status=Mp,p.wrap=u,p.gzhead=null,p.w_bits=i,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=o+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<o+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=3*(p.lit_bufsize-1),p.level=t,p.strategy=l,p.method=n,PB(e)};var xue=(e,t)=>{if(gg(e)||t>CB||t<0)return e?Cu(e,pc):pc;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===pg&&t!==Go)return Cu(e,e.avail_out===0?HR:pc);const i=n.last_flush;if(n.last_flush=t,n.pending!==0){if(ao(e),e.avail_out===0)return n.last_flush=-1,$s}else if(e.avail_in===0&&NB(t)<=NB(i)&&t!==Go)return Cu(e,HR);if(n.status===pg&&e.avail_in!==0)return Cu(e,HR);if(n.status===Mp&&n.wrap===0&&(n.status=Tu),n.status===Mp){let o=HE+(n.w_bits-8<<4)<<8,l=-1;if(l=n.strategy>=GE||n.level<2?0:n.level<6?1:n.level===6?2:3,o|=l<<6,n.strstart!==0&&(o|=32),o+=31-o%31,mg(n,o),n.strstart!==0&&(mg(n,e.adler>>>16),mg(n,65535&e.adler)),e.adler=1,n.status=Tu,ao(e),n.pending!==0)return n.last_flush=-1,$s}if(n.status===57){if(e.adler=0,Hn(n,31),Hn(n,139),Hn(n,8),n.gzhead)Hn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Hn(n,255&n.gzhead.time),Hn(n,n.gzhead.time>>8&255),Hn(n,n.gzhead.time>>16&255),Hn(n,n.gzhead.time>>24&255),Hn(n,n.level===9?2:n.strategy>=GE||n.level<2?4:0),Hn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Hn(n,255&n.gzhead.extra.length),Hn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Ps(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Hn(n,0),Hn(n,0),Hn(n,0),Hn(n,0),Hn(n,0),Hn(n,n.level===9?2:n.strategy>=GE||n.level<2?4:0),Hn(n,3),n.status=Tu,ao(e),n.pending!==0)return n.last_flush=-1,$s}if(n.status===69){if(n.gzhead.extra){let o=n.pending,l=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+l>n.pending_buf_size;){let p=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+p),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>o&&(e.adler=Ps(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex+=p,ao(e),n.pending!==0)return n.last_flush=-1,$s;o=0,l-=p}let u=new Uint8Array(n.gzhead.extra);n.pending_buf.set(u.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending+=l,n.gzhead.hcrc&&n.pending>o&&(e.adler=Ps(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let o,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=Ps(e.adler,n.pending_buf,n.pending-l,l)),ao(e),n.pending!==0)return n.last_flush=-1,$s;l=0}o=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Hn(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>l&&(e.adler=Ps(e.adler,n.pending_buf,n.pending-l,l)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let o,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=Ps(e.adler,n.pending_buf,n.pending-l,l)),ao(e),n.pending!==0)return n.last_flush=-1,$s;l=0}o=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Hn(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>l&&(e.adler=Ps(e.adler,n.pending_buf,n.pending-l,l))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ao(e),n.pending!==0))return n.last_flush=-1,$s;Hn(n,255&e.adler),Hn(n,e.adler>>8&255),e.adler=0}if(n.status=Tu,ao(e),n.pending!==0)return n.last_flush=-1,$s}if(e.avail_in!==0||n.lookahead!==0||t!==Hl&&n.status!==pg){let o=n.level===0?IB(n,t):n.strategy===GE?((l,u)=>{let p;for(;;){if(l.lookahead===0&&(jp(l),l.lookahead===0)){if(u===Hl)return 1;break}if(l.match_length=0,p=Gl(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,p&&(co(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,u===Go?(co(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(co(l,!1),l.strm.avail_out===0)?1:2})(n,t):n.strategy===pue?((l,u)=>{let p,m,g,y;const b=l.window;for(;;){if(l.lookahead<=wu){if(jp(l),l.lookahead<=wu&&u===Hl)return 1;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=3&&l.strstart>0&&(g=l.strstart-1,m=b[g],m===b[++g]&&m===b[++g]&&m===b[++g])){y=l.strstart+wu;do;while(m===b[++g]&&m===b[++g]&&m===b[++g]&&m===b[++g]&&m===b[++g]&&m===b[++g]&&m===b[++g]&&m===b[++g]&&g<y);l.match_length=wu-(y-g),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=3?(p=Gl(l,1,l.match_length-3),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(p=Gl(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),p&&(co(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,u===Go?(co(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(co(l,!1),l.strm.avail_out===0)?1:2})(n,t):fg[n.level].func(n,t);if(o!==3&&o!==4||(n.status=pg),o===1||o===3)return e.avail_out===0&&(n.last_flush=-1),$s;if(o===2&&(t===cue?aue(n):t!==CB&&(GR(n,0,0,!1),t===lue&&(Kl(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),ao(e),e.avail_out===0))return n.last_flush=-1,$s}return t!==Go?$s:n.wrap<=0?RB:(n.wrap===2?(Hn(n,255&e.adler),Hn(n,e.adler>>8&255),Hn(n,e.adler>>16&255),Hn(n,e.adler>>24&255),Hn(n,255&e.total_in),Hn(n,e.total_in>>8&255),Hn(n,e.total_in>>16&255),Hn(n,e.total_in>>24&255)):(mg(n,e.adler>>>16),mg(n,65535&e.adler)),ao(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?$s:RB)},wue=(e,t)=>{let n=t.length;if(gg(e))return pc;const i=e.state,o=i.wrap;if(o===2||o===1&&i.status!==Mp||i.lookahead)return pc;if(o===1&&(e.adler=hg(e.adler,t,n,0)),i.wrap=0,n>=i.w_size){o===0&&(Kl(i.head),i.strstart=0,i.block_start=0,i.insert=0);let m=new Uint8Array(i.w_size);m.set(t.subarray(n-i.w_size,n),0),t=m,n=i.w_size}const l=e.avail_in,u=e.next_in,p=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,jp(i);i.lookahead>=3;){let m=i.strstart,g=i.lookahead-2;do i.ins_h=zl(i,i.ins_h,i.window[m+3-1]),i.prev[m&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=m,m++;while(--g);i.strstart=m,i.lookahead=2,jp(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=u,e.input=p,e.avail_in=l,i.wrap=o,$s},_g={deflateInit:(e,t)=>DB(e,t,HE,15,8,fue),deflateInit2:DB,deflateReset:PB,deflateResetKeep:OB,deflateSetHeader:(e,t)=>gg(e)||e.state.wrap!==2?pc:(e.state.gzhead=t,$s),deflate:xue,deflateEnd:e=>{if(gg(e))return pc;const t=e.state.status;return e.state=null,t===Tu?Cu(e,due):$s},deflateSetDictionary:wue,deflateInfo:"pako deflate (from Nodeca project)"};const Tue=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var KE={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)Tue(n,i)&&(e[i]=n[i])}}return e},flattenChunks:e=>{let t=0;for(let i=0,o=e.length;i<o;i++)t+=e[i].length;const n=new Uint8Array(t);for(let i=0,o=0,l=e.length;i<l;i++){let u=e[i];n.set(u,o),o+=u.length}return n}};let kB=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{kB=!1}const yg=new Uint8Array(256);for(let e=0;e<256;e++)yg[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;yg[254]=yg[254]=1;var Eg={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,i,o,l,u=e.length,p=0;for(o=0;o<u;o++)n=e.charCodeAt(o),(64512&n)==55296&&o+1<u&&(i=e.charCodeAt(o+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),o++)),p+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(p),l=0,o=0;l<p;o++)n=e.charCodeAt(o),(64512&n)==55296&&o+1<u&&(i=e.charCodeAt(o+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),o++)),n<128?t[l++]=n:n<2048?(t[l++]=192|n>>>6,t[l++]=128|63&n):n<65536?(t[l++]=224|n>>>12,t[l++]=128|n>>>6&63,t[l++]=128|63&n):(t[l++]=240|n>>>18,t[l++]=128|n>>>12&63,t[l++]=128|n>>>6&63,t[l++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let i,o;const l=new Array(2*n);for(o=0,i=0;i<n;){let u=e[i++];if(u<128){l[o++]=u;continue}let p=yg[u];if(p>4)l[o++]=65533,i+=p-1;else{for(u&=p===2?31:p===3?15:7;p>1&&i<n;)u=u<<6|63&e[i++],p--;p>1?l[o++]=65533:u<65536?l[o++]=u:(u-=65536,l[o++]=55296|u>>10&1023,l[o++]=56320|1023&u)}}return((u,p)=>{if(p<65534&&u.subarray&&kB)return String.fromCharCode.apply(null,u.length===p?u:u.subarray(0,p));let m="";for(let g=0;g<p;g++)m+=String.fromCharCode(u[g]);return m})(l,o)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+yg[e[n]]>t?n:t}},LB=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const MB=Object.prototype.toString,{Z_NO_FLUSH:Cue,Z_SYNC_FLUSH:Rue,Z_FULL_FLUSH:Nue,Z_FINISH:Aue,Z_OK:zE,Z_STREAM_END:Iue,Z_DEFAULT_COMPRESSION:Oue,Z_DEFAULT_STRATEGY:Pue,Z_DEFLATED:Due}=Lp;function vg(e){this.options=KE.assign({level:Oue,method:Due,chunkSize:16384,windowBits:15,memLevel:8,strategy:Pue},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new LB,this.strm.avail_out=0;let n=_g.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==zE)throw new Error(xu[n]);if(t.header&&_g.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?Eg.string2buf(t.dictionary):MB.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=_g.deflateSetDictionary(this.strm,i),n!==zE)throw new Error(xu[n]);this._dict_set=!0}}function qR(e,t){const n=new vg(t);if(n.push(e,!0),n.err)throw n.msg||xu[n.err];return n.result}vg.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize;let o,l;if(this.ended)return!1;for(l=t===~~t?t:t===!0?Aue:Cue,typeof e=="string"?n.input=Eg.string2buf(e):MB.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(l===Rue||l===Nue)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(o=_g.deflate(n,l),o===Iue)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),o=_g.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===zE;if(n.avail_out!==0){if(l>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},vg.prototype.onData=function(e){this.chunks.push(e)},vg.prototype.onEnd=function(e){e===zE&&(this.result=KE.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var kue={Deflate:vg,deflate:qR,deflateRaw:function(e,t){return(t=t||{}).raw=!0,qR(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,qR(e,t)},constants:Lp};const YE=16209;var Lue=function(e,t){let n,i,o,l,u,p,m,g,y,b,S,w,k,I,O,W,H,Y,Q,Z,q,ee,ce,me;const Oe=e.state;n=e.next_in,ce=e.input,i=n+(e.avail_in-5),o=e.next_out,me=e.output,l=o-(t-e.avail_out),u=o+(e.avail_out-257),p=Oe.dmax,m=Oe.wsize,g=Oe.whave,y=Oe.wnext,b=Oe.window,S=Oe.hold,w=Oe.bits,k=Oe.lencode,I=Oe.distcode,O=(1<<Oe.lenbits)-1,W=(1<<Oe.distbits)-1;e:do{w<15&&(S+=ce[n++]<<w,w+=8,S+=ce[n++]<<w,w+=8),H=k[S&O];t:for(;;){if(Y=H>>>24,S>>>=Y,w-=Y,Y=H>>>16&255,Y===0)me[o++]=65535&H;else{if(!(16&Y)){if(!(64&Y)){H=k[(65535&H)+(S&(1<<Y)-1)];continue t}if(32&Y){Oe.mode=16191;break e}e.msg="invalid literal/length code",Oe.mode=YE;break e}Q=65535&H,Y&=15,Y&&(w<Y&&(S+=ce[n++]<<w,w+=8),Q+=S&(1<<Y)-1,S>>>=Y,w-=Y),w<15&&(S+=ce[n++]<<w,w+=8,S+=ce[n++]<<w,w+=8),H=I[S&W];n:for(;;){if(Y=H>>>24,S>>>=Y,w-=Y,Y=H>>>16&255,!(16&Y)){if(!(64&Y)){H=I[(65535&H)+(S&(1<<Y)-1)];continue n}e.msg="invalid distance code",Oe.mode=YE;break e}if(Z=65535&H,Y&=15,w<Y&&(S+=ce[n++]<<w,w+=8,w<Y&&(S+=ce[n++]<<w,w+=8)),Z+=S&(1<<Y)-1,Z>p){e.msg="invalid distance too far back",Oe.mode=YE;break e}if(S>>>=Y,w-=Y,Y=o-l,Z>Y){if(Y=Z-Y,Y>g&&Oe.sane){e.msg="invalid distance too far back",Oe.mode=YE;break e}if(q=0,ee=b,y===0){if(q+=m-Y,Y<Q){Q-=Y;do me[o++]=b[q++];while(--Y);q=o-Z,ee=me}}else if(y<Y){if(q+=m+y-Y,Y-=y,Y<Q){Q-=Y;do me[o++]=b[q++];while(--Y);if(q=0,y<Q){Y=y,Q-=Y;do me[o++]=b[q++];while(--Y);q=o-Z,ee=me}}}else if(q+=y-Y,Y<Q){Q-=Y;do me[o++]=b[q++];while(--Y);q=o-Z,ee=me}for(;Q>2;)me[o++]=ee[q++],me[o++]=ee[q++],me[o++]=ee[q++],Q-=3;Q&&(me[o++]=ee[q++],Q>1&&(me[o++]=ee[q++]))}else{q=o-Z;do me[o++]=me[q++],me[o++]=me[q++],me[o++]=me[q++],Q-=3;while(Q>2);Q&&(me[o++]=me[q++],Q>1&&(me[o++]=me[q++]))}break}}break}}while(n<i&&o<u);Q=w>>3,n-=Q,w-=Q<<3,S&=(1<<w)-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=o<u?u-o+257:257-(o-u),Oe.hold=S,Oe.bits=w};const qE=15,Mue=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),jue=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Uue=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Vue=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var bg=(e,t,n,i,o,l,u,p)=>{const m=p.bits;let g,y,b,S,w,k,I=0,O=0,W=0,H=0,Y=0,Q=0,Z=0,q=0,ee=0,ce=0,me=null;const Oe=new Uint16Array(16),ot=new Uint16Array(16);let it,wt,yt,Kt=null;for(I=0;I<=qE;I++)Oe[I]=0;for(O=0;O<i;O++)Oe[t[n+O]]++;for(Y=m,H=qE;H>=1&&Oe[H]===0;H--);if(Y>H&&(Y=H),H===0)return o[l++]=20971520,o[l++]=20971520,p.bits=1,0;for(W=1;W<H&&Oe[W]===0;W++);for(Y<W&&(Y=W),q=1,I=1;I<=qE;I++)if(q<<=1,q-=Oe[I],q<0)return-1;if(q>0&&(e===0||H!==1))return-1;for(ot[1]=0,I=1;I<qE;I++)ot[I+1]=ot[I]+Oe[I];for(O=0;O<i;O++)t[n+O]!==0&&(u[ot[t[n+O]]++]=O);if(e===0?(me=Kt=u,k=20):e===1?(me=Mue,Kt=jue,k=257):(me=Uue,Kt=Vue,k=0),ce=0,O=0,I=W,w=l,Q=Y,Z=0,b=-1,ee=1<<Y,S=ee-1,e===1&&ee>852||e===2&&ee>592)return 1;for(;;){it=I-Z,u[O]+1<k?(wt=0,yt=u[O]):u[O]>=k?(wt=Kt[u[O]-k],yt=me[u[O]-k]):(wt=96,yt=0),g=1<<I-Z,y=1<<Q,W=y;do y-=g,o[w+(ce>>Z)+y]=it<<24|wt<<16|yt|0;while(y!==0);for(g=1<<I-1;ce&g;)g>>=1;if(g!==0?(ce&=g-1,ce+=g):ce=0,O++,--Oe[I]==0){if(I===H)break;I=t[n+u[O]]}if(I>Y&&(ce&S)!==b){for(Z===0&&(Z=Y),w+=W,Q=I-Z,q=1<<Q;Q+Z<H&&(q-=Oe[Q+Z],!(q<=0));)Q++,q<<=1;if(ee+=1<<Q,e===1&&ee>852||e===2&&ee>592)return 1;b=ce&S,o[b]=Y<<24|Q<<16|w-l|0}}return ce!==0&&(o[w+ce]=I-Z<<24|64<<16|0),p.bits=Y,0};const{Z_FINISH:jB,Z_BLOCK:Fue,Z_TREES:XE,Z_OK:Ru,Z_STREAM_END:Bue,Z_NEED_DICT:$ue,Z_STREAM_ERROR:Ho,Z_DATA_ERROR:UB,Z_MEM_ERROR:VB,Z_BUF_ERROR:Wue,Z_DEFLATED:FB}=Lp,JE=16180,QE=16190,Xc=16191,XR=16192,JR=16194,ZE=16199,ev=16200,QR=16206,Dr=16209,BB=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Gue(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Nu=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<JE||t.mode>16211?1:0},$B=e=>{if(Nu(e))return Ho;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=JE,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Ru},WB=e=>{if(Nu(e))return Ho;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,$B(e)},GB=(e,t)=>{let n;if(Nu(e))return Ho;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Ho:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,WB(e))},HB=(e,t)=>{if(!e)return Ho;const n=new Gue;e.state=n,n.strm=e,n.window=null,n.mode=JE;const i=GB(e,t);return i!==Ru&&(e.state=null),i};let ZR,eN,KB=!0;const Hue=e=>{if(KB){ZR=new Int32Array(512),eN=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(bg(1,e.lens,0,288,ZR,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;bg(2,e.lens,0,32,eN,0,e.work,{bits:5}),KB=!1}e.lencode=ZR,e.lenbits=9,e.distcode=eN,e.distbits=5},zB=(e,t,n,i)=>{let o;const l=e.state;return l.window===null&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),i>=l.wsize?(l.window.set(t.subarray(n-l.wsize,n),0),l.wnext=0,l.whave=l.wsize):(o=l.wsize-l.wnext,o>i&&(o=i),l.window.set(t.subarray(n-i,n-i+o),l.wnext),(i-=o)?(l.window.set(t.subarray(n-i,n),0),l.wnext=i,l.whave=l.wsize):(l.wnext+=o,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=o))),0};var Kue=(e,t)=>{let n,i,o,l,u,p,m,g,y,b,S,w,k,I,O,W,H,Y,Q,Z,q,ee,ce=0;const me=new Uint8Array(4);let Oe,ot;const it=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Nu(e)||!e.output||!e.input&&e.avail_in!==0)return Ho;n=e.state,n.mode===Xc&&(n.mode=XR),u=e.next_out,o=e.output,m=e.avail_out,l=e.next_in,i=e.input,p=e.avail_in,g=n.hold,y=n.bits,b=p,S=m,ee=Ru;e:for(;;)switch(n.mode){case JE:if(n.wrap===0){n.mode=XR;break}for(;y<16;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}if(2&n.wrap&&g===35615){n.wbits===0&&(n.wbits=15),n.check=0,me[0]=255&g,me[1]=g>>>8&255,n.check=Ps(n.check,me,2,0),g=0,y=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&g)<<8)+(g>>8))%31){e.msg="incorrect header check",n.mode=Dr;break}if((15&g)!==FB){e.msg="unknown compression method",n.mode=Dr;break}if(g>>>=4,y-=4,q=8+(15&g),n.wbits===0&&(n.wbits=q),q>15||q>n.wbits){e.msg="invalid window size",n.mode=Dr;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&g?16189:Xc,g=0,y=0;break;case 16181:for(;y<16;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}if(n.flags=g,(255&ys(n))!==FB){e.msg="unknown compression method",n.mode=Dr;break}if(57344&ys(n)){e.msg="unknown header flags set",n.mode=Dr;break}n.head&&(n.head.text=g>>8&1),512&ys(n)&&4&n.wrap&&(me[0]=255&g,me[1]=g>>>8&255,n.check=Ps(n.check,me,2,0)),g=0,y=0,n.mode=16182;case 16182:for(;y<32;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}n.head&&(n.head.time=g),512&ys(n)&&4&n.wrap&&(me[0]=255&g,me[1]=g>>>8&255,me[2]=g>>>16&255,me[3]=g>>>24&255,n.check=Ps(n.check,me,4,0)),g=0,y=0,n.mode=16183;case 16183:for(;y<16;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}n.head&&(n.head.xflags=255&g,n.head.os=g>>8),512&ys(n)&&4&n.wrap&&(me[0]=255&g,me[1]=g>>>8&255,n.check=Ps(n.check,me,2,0)),g=0,y=0,n.mode=16184;case 16184:if(1024&ys(n)){for(;y<16;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}n.length=g,n.head&&(n.head.extra_len=g),512&ys(n)&&4&n.wrap&&(me[0]=255&g,me[1]=g>>>8&255,n.check=Ps(n.check,me,2,0)),g=0,y=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&ys(n)&&(w=n.length,w>p&&(w=p),w&&(n.head&&(q=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(l,l+w),q)),512&ys(n)&&4&n.wrap&&(n.check=Ps(n.check,i,w,l)),p-=w,l+=w,n.length-=w),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&ys(n)){if(p===0)break e;w=0;do q=i[l+w++],n.head&&q&&n.length<65536&&(n.head.name+=String.fromCharCode(q));while(q&&w<p);if(512&ys(n)&&4&n.wrap&&(n.check=Ps(n.check,i,w,l)),p-=w,l+=w,q)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&ys(n)){if(p===0)break e;w=0;do q=i[l+w++],n.head&&q&&n.length<65536&&(n.head.comment+=String.fromCharCode(q));while(q&&w<p);if(512&ys(n)&&4&n.wrap&&(n.check=Ps(n.check,i,w,l)),p-=w,l+=w,q)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&ys(n)){for(;y<16;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}if(4&n.wrap&&g!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Dr;break}g=0,y=0}n.head&&(n.head.hcrc=ys(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Xc;break;case 16189:for(;y<32;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}e.adler=n.check=BB(g),g=0,y=0,n.mode=QE;case QE:if(n.havedict===0)return e.next_out=u,e.avail_out=m,e.next_in=l,e.avail_in=p,n.hold=g,n.bits=y,$ue;e.adler=n.check=1,n.mode=Xc;case Xc:if(t===Fue||t===XE)break e;case XR:if(n.last){g>>>=7&y,y-=7&y,n.mode=QR;break}for(;y<3;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}switch(n.last=1&g,g>>>=1,y-=1,3&g){case 0:n.mode=16193;break;case 1:if(Hue(n),n.mode=ZE,t===XE){g>>>=2,y-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Dr}g>>>=2,y-=2;break;case 16193:for(g>>>=7&y,y-=7&y;y<32;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}if((65535&g)!=(g>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Dr;break}if(n.length=65535&g,g=0,y=0,n.mode=JR,t===XE)break e;case JR:n.mode=16195;case 16195:if(w=n.length,w){if(w>p&&(w=p),w>m&&(w=m),w===0)break e;o.set(i.subarray(l,l+w),u),p-=w,l+=w,m-=w,u+=w,n.length-=w;break}n.mode=Xc;break;case 16196:for(;y<14;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}if(n.nlen=257+(31&g),g>>>=5,y-=5,n.ndist=1+(31&g),g>>>=5,y-=5,n.ncode=4+(15&g),g>>>=4,y-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Dr;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;y<3;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}n.lens[it[n.have++]]=7&g,g>>>=3,y-=3}for(;n.have<19;)n.lens[it[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Oe={bits:n.lenbits},ee=bg(0,n.lens,0,19,n.lencode,0,n.work,Oe),n.lenbits=Oe.bits,ee){e.msg="invalid code lengths set",n.mode=Dr;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;ce=n.lencode[g&(1<<n.lenbits)-1],O=ce>>>24,W=ce>>>16&255,H=65535&ce,!(O<=y);){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}if(H<16)g>>>=O,y-=O,n.lens[n.have++]=H;else{if(H===16){for(ot=O+2;y<ot;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}if(g>>>=O,y-=O,n.have===0){e.msg="invalid bit length repeat",n.mode=Dr;break}q=n.lens[n.have-1],w=3+(3&g),g>>>=2,y-=2}else if(H===17){for(ot=O+3;y<ot;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}g>>>=O,y-=O,q=0,w=3+(7&g),g>>>=3,y-=3}else{for(ot=O+7;y<ot;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}g>>>=O,y-=O,q=0,w=11+(127&g),g>>>=7,y-=7}if(n.have+w>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Dr;break}for(;w--;)n.lens[n.have++]=q}}if(n.mode===Dr)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=Dr;break}if(n.lenbits=9,Oe={bits:n.lenbits},ee=bg(1,n.lens,0,n.nlen,n.lencode,0,n.work,Oe),n.lenbits=Oe.bits,ee){e.msg="invalid literal/lengths set",n.mode=Dr;break}if(n.distbits=6,n.distcode=n.distdyn,Oe={bits:n.distbits},ee=bg(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Oe),n.distbits=Oe.bits,ee){e.msg="invalid distances set",n.mode=Dr;break}if(n.mode=ZE,t===XE)break e;case ZE:n.mode=ev;case ev:if(p>=6&&m>=258){e.next_out=u,e.avail_out=m,e.next_in=l,e.avail_in=p,n.hold=g,n.bits=y,Lue(e,S),u=e.next_out,o=e.output,m=e.avail_out,l=e.next_in,i=e.input,p=e.avail_in,g=n.hold,y=n.bits,n.mode===Xc&&(n.back=-1);break}for(n.back=0;ce=n.lencode[g&(1<<n.lenbits)-1],O=ce>>>24,W=ce>>>16&255,H=65535&ce,!(O<=y);){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}if(W&&!(240&W)){for(Y=O,Q=W,Z=H;ce=n.lencode[Z+((g&(1<<Y+Q)-1)>>Y)],O=ce>>>24,W=ce>>>16&255,H=65535&ce,!(Y+O<=y);){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}g>>>=Y,y-=Y,n.back+=Y}if(g>>>=O,y-=O,n.back+=O,n.length=H,W===0){n.mode=16205;break}if(32&W){n.back=-1,n.mode=Xc;break}if(64&W){e.msg="invalid literal/length code",n.mode=Dr;break}n.extra=15&W,n.mode=16201;case 16201:if(n.extra){for(ot=n.extra;y<ot;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}n.length+=g&(1<<n.extra)-1,g>>>=n.extra,y-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;ce=n.distcode[g&(1<<n.distbits)-1],O=ce>>>24,W=ce>>>16&255,H=65535&ce,!(O<=y);){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}if(!(240&W)){for(Y=O,Q=W,Z=H;ce=n.distcode[Z+((g&(1<<Y+Q)-1)>>Y)],O=ce>>>24,W=ce>>>16&255,H=65535&ce,!(Y+O<=y);){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}g>>>=Y,y-=Y,n.back+=Y}if(g>>>=O,y-=O,n.back+=O,64&W){e.msg="invalid distance code",n.mode=Dr;break}n.offset=H,n.extra=15&W,n.mode=16203;case 16203:if(n.extra){for(ot=n.extra;y<ot;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}n.offset+=g&(1<<n.extra)-1,g>>>=n.extra,y-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Dr;break}n.mode=16204;case 16204:if(m===0)break e;if(w=S-m,n.offset>w){if(w=n.offset-w,w>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Dr;break}w>n.wnext?(w-=n.wnext,k=n.wsize-w):k=n.wnext-w,w>n.length&&(w=n.length),I=n.window}else I=o,k=u-n.offset,w=n.length;w>m&&(w=m),m-=w,n.length-=w;do o[u++]=I[k++];while(--w);n.length===0&&(n.mode=ev);break;case 16205:if(m===0)break e;o[u++]=n.length,m--,n.mode=ev;break;case QR:if(n.wrap){for(;y<32;){if(p===0)break e;p--,g|=i[l++]<<y,y+=8}if(S-=m,e.total_out+=S,n.total+=S,4&n.wrap&&S&&(e.adler=n.check=ys(n)?Ps(n.check,o,S,u-S):hg(n.check,o,S,u-S)),S=m,4&n.wrap&&(ys(n)?g:BB(g))!==n.check){e.msg="incorrect data check",n.mode=Dr;break}g=0,y=0}n.mode=16207;case 16207:if(n.wrap&&ys(n)){for(;y<32;){if(p===0)break e;p--,g+=i[l++]<<y,y+=8}if(4&n.wrap&&g!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Dr;break}g=0,y=0}n.mode=16208;case 16208:ee=Bue;break e;case Dr:ee=UB;break e;case 16210:return VB;default:return Ho}return e.next_out=u,e.avail_out=m,e.next_in=l,e.avail_in=p,n.hold=g,n.bits=y,(n.wsize||S!==e.avail_out&&n.mode<Dr&&(n.mode<QR||t!==jB))&&zB(e,e.output,e.next_out,S-e.avail_out),b-=e.avail_in,S-=e.avail_out,e.total_in+=b,e.total_out+=S,n.total+=S,4&n.wrap&&S&&(e.adler=n.check=ys(n)?Ps(n.check,o,S,e.next_out-S):hg(n.check,o,S,e.next_out-S)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Xc?128:0)+(n.mode===ZE||n.mode===JR?256:0),(b===0&&S===0||t===jB)&&ee===Ru&&(ee=Wue),ee},Jc={inflateReset:WB,inflateReset2:GB,inflateResetKeep:$B,inflateInit:e=>HB(e,15),inflateInit2:HB,inflate:Kue,inflateEnd:e=>{if(Nu(e))return Ho;let t=e.state;return t.window&&(t.window=null),e.state=null,Ru},inflateGetHeader:(e,t)=>{if(Nu(e))return Ho;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,Ru):Ho},inflateSetDictionary:(e,t)=>{const n=t.length;let i,o,l;return Nu(e)?Ho:(i=e.state,i.wrap!==0&&i.mode!==QE?Ho:i.mode===QE&&(o=1,o=hg(o,t,n,0),o!==i.check)?UB:(l=zB(e,t,n,n),l?(i.mode=16210,VB):(i.havedict=1,Ru)))},inflateInfo:"pako inflate (from Nodeca project)"},zue=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const YB=Object.prototype.toString,{Z_NO_FLUSH:Yue,Z_FINISH:que,Z_OK:Sg,Z_STREAM_END:tN,Z_NEED_DICT:nN,Z_STREAM_ERROR:Xue,Z_DATA_ERROR:qB,Z_MEM_ERROR:Jue}=Lp;function xg(e){this.options=KE.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new LB,this.strm.avail_out=0;let n=Jc.inflateInit2(this.strm,t.windowBits);if(n!==Sg)throw new Error(xu[n]);if(this.header=new zue,Jc.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Eg.string2buf(t.dictionary):YB.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Jc.inflateSetDictionary(this.strm,t.dictionary),n!==Sg)))throw new Error(xu[n])}function rN(e,t){const n=new xg(t);if(n.push(e),n.err)throw n.msg||xu[n.err];return n.result}xg.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,o=this.options.dictionary;let l,u,p;if(this.ended)return!1;for(u=t===~~t?t:t===!0?que:Yue,YB.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),l=Jc.inflate(n,u),l===nN&&o&&(l=Jc.inflateSetDictionary(n,o),l===Sg?l=Jc.inflate(n,u):l===qB&&(l=nN));n.avail_in>0&&l===tN&&n.state.wrap>0&&e[n.next_in]!==0;)Jc.inflateReset(n),l=Jc.inflate(n,u);switch(l){case Xue:case qB:case nN:case Jue:return this.onEnd(l),this.ended=!0,!1}if(p=n.avail_out,n.next_out&&(n.avail_out===0||l===tN))if(this.options.to==="string"){let m=Eg.utf8border(n.output,n.next_out),g=n.next_out-m,y=Eg.buf2string(n.output,m);n.next_out=g,n.avail_out=i-g,g&&n.output.set(n.output.subarray(m,m+g),0),this.onData(y)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(l!==Sg||p!==0){if(l===tN)return l=Jc.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},xg.prototype.onData=function(e){this.chunks.push(e)},xg.prototype.onEnd=function(e){e===Sg&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=KE.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Que={Inflate:xg,inflate:rN,inflateRaw:function(e,t){return(t=t||{}).raw=!0,rN(e,t)},ungzip:rN,constants:Lp};const{Deflate:k1e,deflate:Zue,deflateRaw:ehe,gzip:L1e}=kue,{Inflate:M1e,inflate:the,inflateRaw:nhe,ungzip:j1e}=Que;var rhe=Zue,she=ehe,ihe=the,ohe=nhe,XB=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(XB||{});class ahe{constructor(){D(this,"_sequence",0),D(this,"_startTime",Date.now()),D(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const p=new Uint8Array(4);p.set([1,0,0,0]);const m={id:0,length:4,data:p.buffer},g={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[m]};n.commonPacketHeader.extension=1,n.extension=g,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;$("SHOW_DATASTREAM2_LOG")&&C.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),o=new Uint8Array(i),l=new DataView(i);let u=0;if(l.setUint16(u,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),u+=2,l.setUint32(u,n.commonPacketHeader.sequence,!0),u+=4,l.setUint16(u,n.commonStreamHeader,!0),u+=2,n.extension){const p=this.serializeExtension(n.extension);o.set(new Uint8Array(p),u),u+=p.byteLength}if(o.set(new Uint8Array(n.payload),u),u+=n.payload.byteLength,u!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let i=0;const o=n.getUint16(i,!0);i+=2;const l={length:16383&o,reserved:(16384&o)>>14,extension:(32768&o)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let u,p;if(i+=4,$("SHOW_DATASTREAM2_LOG")&&C.debug("receive data header: ".concat(JSON.stringify(l))),n.getUint16(i,!0),i+=2,l.extension){p=this.deserializeExtension(t.slice(i)),i+=2+p.length,u=t.slice(i);let m=!1;if(p.datas.length>0){const g=p.datas.find(y=>y.id===0);g&&(m=(1&new DataView(g.data).getUint32(0,!0))==1)}u=m?this.decompress(u):u}else u=t.slice(8);return u}serializeExtension(t){const{profile:n,length:i,datas:o}=t,l=new ArrayBuffer(i+2),u=new Uint8Array(l),p=new DataView(l);let m=0;if(p.setUint8(m++,n),p.setUint8(m++,i),o.forEach(g=>{n?(p.setUint8(m++,g.id),p.setUint8(m++,g.length),u.set(new Uint8Array(g.data),m),m+=g.data.byteLength):(p.setUint8(m++,g.id|g.length<<4),u.set(new Uint8Array(g.data),m),m+=g.data.byteLength)}),m!==i+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(i+2));return l}deserializeExtension(t){const n=new DataView(t);let i=0;const o=n.getUint8(i);i++;const l=n.getUint8(i);i++;const u=o===XB.TWO_BYTE,p=[],m=new DataView(t,2);let g=0;for(;g<l;){let y=0,b=0,S=new ArrayBuffer(0);u?(y=m.getUint8(g),g++,b=m.getUint8(g),g++):(y=15&m.getUint8(g),b=m.getUint8(g)>>4,g++),b>0&&(S=m.buffer.slice(g+2,g+2+b),g+=S.byteLength),p.push({id:y,length:b,data:S})}if(g!==l)throw Error("parse error");return{profile:o,length:l,datas:p}}decompress(t){return ihe(new Uint8Array(t))}compress(t){return rhe(new Uint8Array(t))}}const che={name:"DataStream",create:(e,t)=>{const n=t?new hle(e):new ple(e);return n.useDataStream(new ahe),n}};class lhe extends On{constructor(t,n,i){super(),D(this,"ws",void 0),D(this,"requestId",1),D(this,"heartBeatTimer",void 0),D(this,"joinInfo",void 0),D(this,"clientId",void 0),D(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),D(this,"onClose",o=>{this.emit("close"),this.dispose()}),D(this,"onMessage",o=>{const l=JSON.parse(o.data);if(!l||l.command!=="serverResponse"||!l.requestId)return l&&l.command==="serverStatus"&&l.serverStatus&&l.serverStatus.command?(this.emit("status",l.serverStatus),void this.emit(l.serverStatus.command,l.serverStatus)):void 0;this.emit("req_".concat(l.requestId),l)}),this.joinInfo=t,this.clientId=n,this.ws=new Hf("cross-channel-".concat(this.clientId),i),this.ws.on(Et.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Et.CONNECTED,this.onOpen),this.ws.on(Et.ON_MESSAGE,this.onMessage),this.ws.on(Et.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new xe((n,i)=>{const o=window.setTimeout(()=>{i(new ne(G.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,l=>{window.clearTimeout(o),l.state&&l.state!==0?i(new ne(G.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(o),i(new ne(G.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new ne(G.WS_DISCONNECT);const n=()=>new xe((u,p)=>{this.ws.once(Et.CLOSED,()=>p(new ne(G.WS_ABORT))),this.ws.once(Et.CONNECTED,u)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(t),o=new xe((u,p)=>{const m=()=>{p(new ne(G.WS_ABORT))};this.ws.once(Et.RECONNECTING,m),this.ws.once(Et.CLOSED,m),this.once("req_".concat(i),u),vr(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(Et.RECONNECTING,m),this.ws.off(Et.CLOSED,m),p(new ne(G.TIMEOUT,"cross channel ws request timeout"))})}),l=await o;if(!l||l.code!==200)throw new ne(G.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(l)));return l}async connect(t){this.ws.removeAllListeners(Et.REQUEST_NEW_URLS),this.ws.on(Et.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class dhe extends On{set state(t){t!==this._state&&(t!==Qs.RELAY_STATE_FAILURE&&(this.errorCode=vp.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,i,o,l){super(),D(this,"joinInfo",void 0),D(this,"sid",void 0),D(this,"clientId",void 0),D(this,"cancelToken",Ms.CancelToken.source()),D(this,"workerToken",void 0),D(this,"requestId",0),D(this,"signal",void 0),D(this,"prevChannelMediaConfig",void 0),D(this,"httpRetryConfig",void 0),D(this,"_resolution",void 0),D(this,"_state",Qs.RELAY_STATE_IDLE),D(this,"errorCode",vp.RELAY_OK),D(this,"onStatus",u=>{C.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(u))),u&&u.command&&(u.command==="onAudioPacketReceived"&&this.emit("event",Kc.PACKET_RECEIVED_AUDIO_FROM_SRC),u.command==="onVideoPacketReceived"&&this.emit("event",Kc.PACKET_RECEIVED_VIDEO_FROM_SRC),u.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=vp.SRC_TOKEN_EXPIRED,this.state=Qs.RELAY_STATE_FAILURE),u.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=vp.DEST_TOKEN_EXPIRED,this.state=Qs.RELAY_STATE_FAILURE))}),D(this,"onReconnect",async()=>{C.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Kc.NETWORK_DISCONNECTED),this.state=Qs.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(u=>{this.state!==Qs.RELAY_STATE_IDLE&&(C.error("auto restart channel media relay failed",u.toString()),this.errorCode=vp.SERVER_CONNECTION_LOST,this.state=Qs.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=su(),this.signal=new lhe(this.joinInfo,this.clientId,i),this.httpRetryConfig=o,this._resolution=l}async startChannelMediaRelay(t){if(this.state!==Qs.RELAY_STATE_IDLE)throw new ne(G.INVALID_OPERATION);this.state=Qs.RELAY_STATE_CONNECTING,await this.connect(),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new ne(G.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new ne(G.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new ne(G.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Qs.RELAY_STATE_RUNNING)throw new ne(G.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Qs.RELAY_STATE_RUNNING)throw new ne(G.INVALID_OPERATION);const n=this.genMessage(Vs.SetVideoProfile);await this.signal.request(n),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),C.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Qs.RELAY_STATE_IDLE,this.dispose()}dispose(){C.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ms.CancelToken.source(),this.state=Qs.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await _de(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Kc.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(Vs.SetSdkProfile,t);await this.signal.request(n),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(Vs.SetSourceChannel,t);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Kc.PACKET_JOINED_SRC_CHANNEL),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const o=this.genMessage(Vs.SetSourceUserId,t);await this.signal.request(o),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const l=this.genMessage(Vs.SetDestChannel,t);await this.signal.request(l),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Kc.PACKET_JOINED_DEST_CHANNEL),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const u=this.genMessage(Vs.StartPacketTransfer,t);await this.signal.request(u),this.emit("event",Kc.PACKET_SENT_TO_DEST_CHANNEL),this.state=Qs.RELAY_STATE_RUNNING,C.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(Vs.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",Kc.PACKET_UPDATE_DEST_CHANNEL),C.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Vs.StopPacketTransfer);await this.signal.request(t),C.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const i=[],o=[],l=[];this.requestId+=1;const u={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:to,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};u.sdkVersion==="4.24.2"&&(u.sdkVersion="0.0.1");let p=null,m=null;switch(t){case Vs.SetSdkProfile:return u.clientRequest={command:"SetSdkProfile",type:"multi_channel"},u;case Vs.SetSourceChannel:if(m=n&&n.getSrcChannelMediaInfo(),!m)throw new ne(G.UNEXPECTED_ERROR,"can not find source config");return u.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},u;case Vs.SetSourceUserId:if(m=n&&n.getSrcChannelMediaInfo(),!m)throw new ne(G.UNEXPECTED_ERROR,"can not find source config");return u.clientRequest={command:"SetSourceUserId",uid:m.uid+""},u;case Vs.SetDestChannel:if(p=n&&n.getDestChannelMediaInfo(),!p)throw new ne(G.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(g=>{i.push(g.channelName),o.push(g.uid+""),l.push(g.token||this.joinInfo.appId)}),u.clientRequest={command:"SetDestChannel",channelName:i,uid:o,token:l},u;case Vs.StartPacketTransfer:return u.clientRequest={command:"StartPacketTransfer"},u;case Vs.Reconnect:return u.clientRequest={command:"Reconnect"},u;case Vs.StopPacketTransfer:return u.clientRequest={command:"StopPacketTransfer"},u;case Vs.UpdateDestChannel:if(p=n&&n.getDestChannelMediaInfo(),!p)throw new ne(G.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(g=>{i.push(g.channelName),o.push(g.uid+""),l.push(g.token||this.joinInfo.appId)}),u.clientRequest={command:"UpdateDestChannel",channelName:i,uid:o,token:l},u;case Vs.SetVideoProfile:u.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return u}}const uhe={name:"ChannelMediaRelay",create:function(e){return new dhe(e.joinInfo,e.clientId,e.websocketRetryConfig||Zn,e.httpRetryConfig||Zn,e.resolution)}};function JB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function wg(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?JB(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JB(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class hhe extends On{constructor(t,n,i,o){super(),D(this,"spec",void 0),D(this,"token",void 0),D(this,"websocket",void 0),D(this,"pingpongTimer",void 0),D(this,"reconnectMode","retry"),D(this,"serviceMode",void 0),D(this,"reqId",0),D(this,"commandReqId",0),D(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),D(this,"handleWebSocketMessage",l=>{if(!l.data)return;const u=JSON.parse(l.data);u.requestId?this.emit("@".concat(u.requestId,"-").concat(u.sid),u):(Ue.workerEvent(this.spec.sid,{actionType:"status",serverCode:u.code,workerType:this.serviceMode===Hc.TRANSCODE?1:2}),this.emit(Ll.PUBLISH_STREAM_STATUS,u))}),this.spec=n,this.token=t,this.serviceMode=o,this.websocket=new Hf("live-streaming",i),this.websocket.on(Et.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Et.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Et.REQUEST_NEW_URLS,(l,u)=>{ar(this,Ll.REQUEST_NEW_ADDRESS).then(l).catch(u)}),this.websocket.on(Et.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,i,o){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const l=this.commandReqId,u=this.reqId;if(!u||!this.websocket)throw new ne(G.UNEXPECTED_ERROR);const p=wg({command:t,sdkVersion:to==="4.24.2"?"0.0.1":to,seq:u,requestId:u,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new ne(G.WS_DISCONNECT);const m=()=>new xe((S,w)=>{this.websocket.once(Et.CLOSED,()=>w(new ne(G.WS_ABORT))),this.websocket.once(Et.CONNECTED,S)});this.websocket.state!=="connected"&&await m(),p.clientRequest&&(p.clientRequest.workerToken=this.token);const g=new xe((S,w)=>{const k=()=>{w(new ne(G.WS_ABORT))};this.websocket.once(Et.RECONNECTING,k),this.websocket.once(Et.CLOSED,k),this.once("@".concat(u,"-").concat(this.spec.sid),I=>{S(I)})});o&&Ue.workerEvent(this.spec.sid,wg(wg({},o),{},{requestId:l,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const y=Date.now();this.websocket.sendMessage(p);let b=null;try{b=await g}catch(S){if(this.websocket.state==="closed")throw S;return await m(),await this.request(t,n,i)}return o&&Ue.workerEvent(this.spec.sid,wg(wg({},o),{},{requestId:l,actionType:"response",payload:JSON.stringify(b.serverResponse),serverCode:b.code,success:b.code===200,responseTime:Date.now()-y})),b.code!==200&&this.handleResponseError(b),b}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=to==="4.24.2"?"0.0.1":to;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case hr.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void C.warning("live stream response already exists stream");case hr.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case hr.LIVE_STREAM_RESPONSE_BAD_STREAM:case hr.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ne(G.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case hr.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new ne(G.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case hr.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ne(G.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case hr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new ne(G.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Ll.WARNING,n,t.serverResponse.url)}case hr.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new ne(G.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Ll.WARNING,n,t.serverResponse.url)}case hr.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ne(G.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case hr.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ne(G.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case hr.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new ne(G.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Ll.WARNING,n,t.serverResponse.url)}case hr.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ne(G.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case hr.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ne(G.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case hr.LIVE_STREAM_RESPONSE_WORKER_LOST:case hr.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new ne(G.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case hr.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new ne(G.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new ne(G.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case hr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case hr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case hr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case hr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ne(G.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(jf)},6e3)}}function QB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function ei(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?QB(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QB(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class phe extends On{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Zn,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Zn;super(),D(this,"onLiveStreamWarning",void 0),D(this,"onLiveStreamError",void 0),D(this,"spec",void 0),D(this,"retryTimeout",1e4),D(this,"connection",void 0),D(this,"httpRetryConfig",void 0),D(this,"wsRetryConfig",void 0),D(this,"streamingTasks",new Map),D(this,"isStartingStreamingTask",!1),D(this,"taskMutex",new Ar("live-streaming")),D(this,"cancelToken",Ms.CancelToken.source()),D(this,"transcodingConfig",void 0),D(this,"uapResponse",void 0),D(this,"lastTaskId",1),D(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=ei(ei({},Xle),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(C.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(u=>ei(ei(ei({},qle),u),{},{zOrder:u.zOrder?u.zOrder+1:1}))),function(u){jn(u.width)||un(u.width,"config.width",0,1e4),jn(u.height)||un(u.height,"config.height",0,1e4),jn(u.videoBitrate)||un(u.videoBitrate,"config.videoBitrate",1,1e6),jn(u.videoFrameRate)||un(u.videoFrameRate,"config.videoFrameRate"),jn(u.lowLatency)||Do(u.lowLatency,"config.lowLatency"),jn(u.audioSampleRate)||Qn(u.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),jn(u.audioBitrate)||un(u.audioBitrate,"config.audioBitrate",1,128),jn(u.audioChannels)||Qn(u.audioChannels,"config.audioChannels",[1,2,3,4,5]),jn(u.videoGop)||un(u.videoGop,"config.videoGop"),jn(u.videoCodecProfile)||Qn(u.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),jn(u.userCount)||un(u.userCount,"config.userCount",0,17),jn(u.backgroundColor)||un(u.backgroundColor,"config.backgroundColor",0,16777215),jn(u.userConfigExtraInfo)||Vr(u.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),u.transcodingUsers&&!jn(u.transcodingUsers)&&(Wc(u.transcodingUsers,"config.transcodingUsers"),u.transcodingUsers.forEach((p,m)=>{pE(p.uid),jn(p.x)||un(p.x,"transcodingUser[".concat(m,"].x"),0,1e4),jn(p.y)||un(p.y,"transcodingUser[".concat(m,"].y"),0,1e4),jn(p.width)||un(p.width,"transcodingUser[".concat(m,"].width"),0,1e4),jn(p.height)||un(p.height,"transcodingUser[".concat(m,"].height"),0,1e4),jn(p.zOrder)||un(p.zOrder-1,"transcodingUser[".concat(m,"].zOrder"),0,100),jn(p.alpha)||un(p.alpha,"transcodingUser[".concat(m,"].alpha"),0,1,!1)})),jn(u.watermark)||HC(u.watermark,"watermark"),jn(u.backgroundImage)||HC(u.backgroundImage,"backgroundImage"),u.images&&!jn(u.images)&&(Wc(u.images,"config.images"),u.images.forEach((p,m)=>{HC(p,"images[".concat(m,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(u=>ei(ei(ei({},GC),u),{},{zOrder:255}))),n.backgroundImage&&(i.push(ei(ei(ei({},GC),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(ei(ei(ei({},GC),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(u=>ei({},u)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const o=(n.userConfigs||[]).map(u=>typeof u.uid=="number"?xe.resolve(u.uid):v4(u.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await xe.all(o)).forEach((u,p)=>{n.userConfigs&&n.userConfigs[p]&&(n.userConfigs[p].uid=u)}),this.transcodingConfig=n,this.connection)try{var l;const u=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(fi(l=this.streamingTasks).call(l)).map(p=>p.taskId).join("#")});C.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(u.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(u){if(!u.data||!u.data.retry)throw u;u.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(p=>{C.warning("[".concat(this.spec.clientId,"] live streaming receive error"),u.toString(),"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,u).then(()=>{C.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(p.url," success"))}).catch(m=>{C.error("[".concat(this.spec.clientId,"] live streaming republish failed"),p.url,m.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,m)})})}}async startLiveStreamingTask(t,n,i){if(!this.transcodingConfig&&n===Hc.TRANSCODE)throw new ne(G.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const o={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};C.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const l=await this.taskMutex.lock();if(!this.connection&&i)return void l();if(this.streamingTasks.get(t)&&!i)return l(),new ne(G.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(p){throw l(),p}switch(n){case Hc.TRANSCODE:o.transcodingConfig=ei({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(o.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const u=this.lastTaskId++;try{const p=new xe((g,y)=>{vr(this.retryTimeout).then(()=>{if(i)return y(i);const b=this.statusError.get(t);return b?(this.statusError.delete(t),y(b)):void 0})}),m=await xe.race([this.connection.request("request",{clientRequest:o},!0,{url:t,command:"PublishStream",workerType:n===Hc.TRANSCODE?1:2,requestByUser:!i,tid:u.toString()}),p]);this.isStartingStreamingTask=!1,C.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(m.code)),this.streamingTasks.set(t,{clientRequest:o,mode:n,url:t,taskId:u}),l()}catch(p){if(l(),this.isStartingStreamingTask=!1,!p.data||!p.data.retry||i)throw p;return p.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,p)):await this.startLiveStreamingTask(t,n,p)}}stopLiveStreamingTask(t){return new xe((n,i)=>{const o=this.streamingTasks.get(t);if(!o||!this.connection)return new ne(G.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const l=o.mode;o.abortTask=()=>{C.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:o.url}},!1,{url:t,command:"UnPublishStream",workerType:l===Hc.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(u=>{C.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(u.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var t;const n=Array.from(fi(t=this.streamingTasks).call(t));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(o=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,o)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ms.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new ne(G.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await ar(this,KC.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new hhe(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Ll.WARNING,(i,o)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(o,i)),this.connection.on(Ll.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Ll.REQUEST_NEW_ADDRESS,(i,o)=>{if(!this.connection)return o(new ne(G.UNEXPECTED_ERROR,"can not get new live streaming address list"));ar(this,KC.REQUEST_WORKER_MANAGER_LIST,t).then(l=>{this.uapResponse=l,i(l.addressList)}).catch(o)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),o=t.reason;switch(t.code){case hr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case hr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case hr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case hr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const u=new ne(G.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return C.error(u.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,u);if(!this.isStartingStreamingTask)return;this.statusError.set(n,u)}case hr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const u=new ne(G.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,o);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,u)}case hr.LIVE_STREAM_RESPONSE_WORKER_LOST:case hr.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var l;if(!this.connection)return;this.connection.tryNextAddress();const u=Array.from(fi(l=this.streamingTasks).call(l));for(const p of u)p.abortTask?p.abortTask():(C.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new ne(G.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{C.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(m=>{C.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,m)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const mhe={name:"LiveStreaming",create:function(e){return new phe(e.joinInfo,e.websocketRetryConfig||Zn,e.httpRetryConfig||Zn)}};function fhe(e){let t=t6();return function(n,i){let o=n.appId;o!==void 0&&(rn(i,10),gc(i,o));let l=n.cid;l!==void 0&&(rn(i,16),rn(i,l));let u=n.cname;u!==void 0&&(rn(i,26),gc(i,u));let p=n.deviceId;p!==void 0&&(rn(i,34),gc(i,p));let m=n.elapse;m!==void 0&&(rn(i,40),Yl(i,m));let g=n.fileSize;g!==void 0&&(rn(i,48),Yl(i,Vp(g)));let y=n.height;y!==void 0&&(rn(i,56),Yl(i,Vp(y)));let b=n.jpg;b!==void 0&&(rn(i,66),rn(i,b.length),function(An,he){let Ee=Fp(An,he.length);An.bytes.set(he,Ee)}(i,b));let S=n.networkType;S!==void 0&&(rn(i,72),Yl(i,Vp(S)));let w=n.osType;w!==void 0&&(rn(i,80),Yl(i,Vp(w)));let k=n.requestId;k!==void 0&&(rn(i,90),gc(i,k));let I=n.sdkVersion;I!==void 0&&(rn(i,98),gc(i,I));let O=n.sequence;O!==void 0&&(rn(i,104),Yl(i,Vp(O)));let W=n.sid;W!==void 0&&(rn(i,114),gc(i,W));let H=n.timestamp;H!==void 0&&(rn(i,120),Yl(i,H));let Y=n.uid;Y!==void 0&&(rn(i,128),rn(i,Y));let Q=n.vid;Q!==void 0&&(rn(i,136),rn(i,Q));let Z=n.width;Z!==void 0&&(rn(i,144),Yl(i,Vp(Z)));let q=n.service;q!==void 0&&(rn(i,152),rn(i,q));let ee=n.callbackData;ee!==void 0&&(rn(i,162),gc(i,ee));let ce=n.jpgEncryption;ce!==void 0&&(rn(i,168),rn(i,ce));let me=n.requestType;me!==void 0&&(rn(i,176),rn(i,me));let Oe=n.scorePorn;Oe!==void 0&&(rn(i,185),cN(i,Oe));let ot=n.scoreSexy;ot!==void 0&&(rn(i,193),cN(i,ot));let it=n.scoreNeutral;it!==void 0&&(rn(i,201),cN(i,it));let wt=n.scene;wt!==void 0&&(rn(i,208),rn(i,wt));let yt=n.ossFilePrefix;yt!==void 0&&(rn(i,218),gc(i,yt));let Kt=n.serviceVendor;if(Kt!==void 0)for(let An of Kt){rn(i,226);let he=t6();yhe(An,he),rn(i,he.limit),She(i,he),bhe(he)}}(e,t),function(n){let i=n.bytes,o=n.limit;return i.length===o?i:i.subarray(0,o)}(t)}function ghe(e){return function(n){let i={};e:for(;!n6(n);){let o=_c(n);switch(o>>>3){case 0:break e;case 1:i.code=_c(n);break;case 2:i.msg=r6(n,_c(n));break;case 3:{let l=Ehe(n);i.data=_he(n),n.limit=l;break}default:ZB(n,7&o)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function _he(e){let t={};e:for(;!n6(e);){let n=_c(e);switch(n>>>3){case 0:break e;case 1:t.requestId=r6(e,_c(e));break;case 2:t.requestType=_c(e)>>>0;break;case 3:t.scorePorn=aN(e);break;case 4:t.scoreSexy=aN(e);break;case 5:t.scoreNeutral=aN(e);break;case 6:t.requestScene=_c(e)>>>0;break;case 7:t.scene=_c(e)>>>0;break;default:ZB(e,7&n)}}return t}function yhe(e,t){let n=e.service;n!==void 0&&(rn(t,8),rn(t,n));let i=e.vendor;i!==void 0&&(rn(t,16),rn(t,i));let o=e.token;o!==void 0&&(rn(t,26),gc(t,o));let l=e.callbackUrl;l!==void 0&&(rn(t,34),gc(t,l))}function Ehe(e){let t=_c(e),n=e.limit;return e.limit=e.offset+t,n}function ZB(e,t){switch(t){case 0:for(;128&s6(e););break;case 2:iN(e,_c(e));break;case 5:iN(e,4);break;case 1:iN(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let vhe=new Float32Array(1);new Uint8Array(vhe.buffer);let sN=new Float64Array(1),ti=new Uint8Array(sN.buffer);function Vp(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let e6=[];function t6(){const e=e6.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function bhe(e){e6.push(e)}function iN(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function n6(e){return e.offset>=e.limit}function Fp(e,t){let n=e.bytes,i=e.offset,o=e.limit,l=i+t;if(l>n.length){let u=new Uint8Array(2*l);u.set(n),e.bytes=u}return e.offset=l,l>o&&(e.limit=l),i}function oN(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function r6(e,t){let n=oN(e,t),i=String.fromCharCode,o=e.bytes,l="",u="";for(let p=0;p<t;p++){let m,g,y,b,S=o[p+n];128&S?(224&S)==192?p+1>=t?u+=l:(m=o[p+n+1],(192&m)!=128?u+=l:(b=(31&S)<<6|63&m,b<128?u+=l:(u+=i(b),p++))):(240&S)==224?p+2>=t?u+=l:(m=o[p+n+1],g=o[p+n+2],(49344&(m|g<<8))!=32896?u+=l:(b=(15&S)<<12|(63&m)<<6|63&g,b<2048||b>=55296&&b<=57343?u+=l:(u+=i(b),p+=2))):(248&S)==240?p+3>=t?u+=l:(m=o[p+n+1],g=o[p+n+2],y=o[p+n+3],(12632256&(m|g<<8|y<<16))!=8421504?u+=l:(b=(7&S)<<18|(63&m)<<12|(63&g)<<6|63&y,b<65536||b>1114111?u+=l:(b-=65536,u+=i(55296+(b>>10),56320+(1023&b)),p+=3))):u+=l:u+=i(S)}return u}function gc(e,t){let n=t.length,i=0;for(let u=0;u<n;u++){let p=t.charCodeAt(u);p>=55296&&p<=56319&&u+1<n&&(p=(p<<10)+t.charCodeAt(++u)-56613888),i+=p<128?1:p<2048?2:p<65536?3:4}rn(e,i);let o=Fp(e,i),l=e.bytes;for(let u=0;u<n;u++){let p=t.charCodeAt(u);p>=55296&&p<=56319&&u+1<n&&(p=(p<<10)+t.charCodeAt(++u)-56613888),p<128?l[o++]=p:(p<2048?l[o++]=p>>6&31|192:(p<65536?l[o++]=p>>12&15|224:(l[o++]=p>>18&7|240,l[o++]=p>>12&63|128),l[o++]=p>>6&63|128),l[o++]=63&p|128)}}function She(e,t){let n=Fp(e,t.limit),i=e.bytes,o=t.bytes;for(let l=0,u=t.limit;l<u;l++)i[l+n]=o[l]}function s6(e){return e.bytes[oN(e,1)]}function i6(e,t){let n=Fp(e,1);e.bytes[n]=t}function aN(e){let t=oN(e,8),n=e.bytes;return ti[0]=n[t++],ti[1]=n[t++],ti[2]=n[t++],ti[3]=n[t++],ti[4]=n[t++],ti[5]=n[t++],ti[6]=n[t++],ti[7]=n[t++],sN[0]}function cN(e,t){let n=Fp(e,8),i=e.bytes;sN[0]=t,i[n++]=ti[0],i[n++]=ti[1],i[n++]=ti[2],i[n++]=ti[3],i[n++]=ti[4],i[n++]=ti[5],i[n++]=ti[6],i[n++]=ti[7]}function _c(e){let t,n=0,i=0;do t=s6(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function rn(e,t){for(t>>>=0;t>=128;)i6(e,127&t|128),t>>>=7;i6(e,t)}function Yl(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,l=o===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:o<128?9:10,u=Fp(e,l),p=e.bytes;switch(l){case 10:p[u+9]=o>>>7&1;case 9:p[u+8]=l!==9?128|o:127&o;case 8:p[u+7]=l!==8?i>>>21|128:i>>>21&127;case 7:p[u+6]=l!==7?i>>>14|128:i>>>14&127;case 6:p[u+5]=l!==6?i>>>7|128:i>>>7&127;case 5:p[u+4]=l!==5?128|i:127&i;case 4:p[u+3]=l!==4?n>>>21|128:n>>>21&127;case 3:p[u+2]=l!==3?n>>>14|128:n>>>14&127;case 2:p[u+1]=l!==2?n>>>7|128:n>>>7&127;case 1:p[u]=l!==1?128|n:127&n}}function o6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}const xhe=new Map([["moderation",1],["supervise",2]]);class whe extends On{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Or.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=Zi(n=t.map(i=>xhe.get(i)||0)).call(n,(i,o)=>i+o),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),D(this,"name","AgoraRTCVideoContentInspect"),D(this,"_connectionState",Uo.CONNECTING),D(this,"_innerConnectionState",void 0),D(this,"sequence",0),D(this,"inspectStartTime",void 0),D(this,"workerManagerConnection",void 0),D(this,"workerConnection",void 0),D(this,"workerMessageLengthLimit",void 0),D(this,"inspectIntervalMinimum",void 0),D(this,"qualityRatio",void 0),D(this,"_connectInfo",void 0),D(this,"_cancelTokenSource",Ms.CancelToken.source()),D(this,"_retryConfig",void 0),D(this,"wmSequence",0),D(this,"inspectInterval",void 0),D(this,"inspectTimer",null),D(this,"ossFilePrefix",void 0),D(this,"extraInfo",void 0),D(this,"_inspectType",void 0),D(this,"_inspectMode",void 0),D(this,"_quality",1),D(this,"qualityTimer",null),D(this,"_inspectId",void 0),D(this,"_needWorkUrlOnly",!1),D(this,"inspectImage",()=>{if(this.connectionState!==Uo.CONNECTED)throw new ne(G.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Uo.CONNECTED?this.requestToInspectImage():C.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Zt(5,"inspect-"),this.workerMessageLengthLimit=$("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=$("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=$("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Hf("worker-manager-"+this._inspectId,Zn),this.on(Or.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,C.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Vo[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Hf("worker-"+this._inspectId,Zn),this.handleWorkerEvents()}async init(t,n){this.emit(Or.STATE_CHANGE,Vo.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new xe((o,l)=>{this.on(Or.CONNECTION_STATE_CHANGE,(u,p)=>{p===Uo.CONNECTED&&o()}),this.requestAP(t,i,n).then(u=>{this.connectWorkerManager(u)}).catch(u=>{l(u)})})}async requestAP(t,n,i){const o=$("WEBCS_DOMAIN").map(p=>"https://".concat(p,"/api/v1")),l=await function(p,m,g,y){let{appId:b,areaCode:S,cname:w,sid:k,token:I,uid:O}=m;Cp++;const W="image_moderation_api",H={service_name:W,json_body:JSON.stringify({appId:b,areaCode:S,cname:w,command:"allocateEdge",requestId:Cp,seq:Cp,sid:k,token:I,ts:Date.now(),uid:O+""})};let Y,Q,Z=p[0];return ma(async()=>{Y=Date.now();const q=await va(Z,{data:H,cancelToken:g,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Q=Date.now()-Y,q.code!==0){const it=new ne(G.UNEXPECTED_RESPONSE,"image inspect ap error, code"+q.code,{retry:!0,responseTime:Q});throw C.error(it.toString()),it}const ee=JSON.parse(q.json_body);if(ee.code!==200){const it=new ne(G.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ee.code,", reason: ").concat(ee.reason),{code:ee.code,responseTime:Q});throw C.error(it.toString()),it}if(!ee.servers||!Array.isArray(ee.servers)||ee.servers.length===0){const it=new ne(G.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ee.code,responseTime:Q});throw C.error(it.toString()),it}const ce=$("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(ce)return{addressList:[ce],workerToken:ee.workerToken,vid:ee.vid,responseTime:Q};const me=$("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Oe=$("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ee.servers.map(it=>{let{address:wt,wss:yt}=it;if(wt&&yt)return"wss://".concat(wt.replace(/\./g,"-"),".").concat(me,":").concat(Oe||yt)}).filter(it=>!!it),workerToken:ee.workerToken,vid:ee.vid,responseTime:Q}},(q,ee)=>(Ue.apworkerEvent(k,{success:!0,sc:200,serviceName:W,responseDetail:JSON.stringify(q.addressList),firstSuccess:ee===0,responseTime:Q,serverIp:p[ee%p.length]}),!1),(q,ee)=>(Ue.apworkerEvent(k,{success:!1,sc:q.data&&q.data.code||200,serviceName:W,responseTime:Q,serverIp:p[ee%p.length]}),!!(q.code!==G.OPERATION_ABORTED&&q.code!==G.UNEXPECTED_RESPONSE||q.data&&q.data.retry)&&(Z=p[(ee+1)%p.length],!0)),y)}(o,t,n,i);this.emit(Or.STATE_CHANGE,Vo.AP_CONNECTED);const{addressList:u}=l;return this.wmSequence++,u}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Or.STATE_CHANGE,Vo.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Et.CONNECTED,async()=>{this.emit(Or.STATE_CHANGE,Vo.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Et.CLOSED,()=>{this._innerConnectionState<Vo.GET_WORKER_MANAGER_RESPONSE&&C.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Et.FAILED,()=>{this._innerConnectionState<Vo.GET_WORKER_MANAGER_RESPONSE&&C.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Et.RECONNECTING,()=>{this._innerConnectionState<Vo.GET_WORKER_MANAGER_RESPONSE&&C.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Et.ON_MESSAGE,async t=>{this.emit(Or.STATE_CHANGE,Vo.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(t.data);if(i.code!==200)throw C.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new ne(G.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw C.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new ne(G.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const o=$("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,l=n.replace(/:\d+\/?$/,":".concat(o));this.emit(Or.STATE_CHANGE,Vo.CONNECT_WORKER,l),this._needWorkUrlOnly?this.emit(Or.REQUEST_NEW_WORKER_URL,l):await this.connectWorker(l)}}),this.workerManagerConnection.on(Et.WILL_RECONNECT,(t,n,i)=>{i(t)}),this.workerManagerConnection.on(Et.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Et.CONNECTED,async()=>{this.emit(Or.STATE_CHANGE,Vo.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Uo.CONNECTED}),this.workerConnection.on(Et.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const i=ghe(new Uint8Array(t.data));if($("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&C.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Or.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const o={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},l=Zi(n=Object.keys(o)).call(n,(p,m)=>o[p]>o[m]?p:m,"porn"),u=Object.keys(o).find(p=>p===l);this.emit(Or.INSPECT_RESULT,u)}else this.emit(Or.INSPECT_RESULT,void 0,new ne(G.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(Or.INSPECT_RESULT,void 0,new ne(G.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else C.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Or.INSPECT_RESULT,void 0,new ne(G.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Et.CLOSED,()=>{this.connectionState=Uo.CLOSED}),this.workerConnection.on(Et.FAILED,()=>{this.connectionState=Uo.CLOSED}),this.workerConnection.on(Et.RECONNECTING,()=>{this.connectionState=this.connectionState===Uo.CONNECTED?Uo.RECONNECTING:Uo.CONNECTING}),this.workerConnection.on(Et.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this.workerConnection.on(Et.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(Or.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const t=yi(this,Or.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Or.INSPECT_RESULT,void 0,new ne(G.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(t,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(Or.INSPECT_RESULT,void 0,new ne(G.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:i,cname:o,cid:l,vid:u,sid:p,uid:m}=n;const g=Date.now(),y=await t.getCurrentFrameImage("image/jpeg",this.quality),b=await jU(y,i,o),S=this.sequence+"-"+l+"-"+m+"-"+g+"-"+Zt(12,""),w={appId:i,cid:l,cname:o,deviceId:"",elapse:(k=Number(g-this.inspectStartTime),{low:k|=0,high:k>>31,unsigned:k>=0}),fileSize:b.byteLength,jpgEncryption:2,height:y.height,width:y.width,jpg:b,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.2",sequence:this.sequence,sid:p,timestamp:hF(g),uid:m,vid:u,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var k;this.extraInfo===void 0&&delete w.callbackData,this.ossFilePrefix===void 0&&delete w.ossFilePrefix;const I=fhe(w);if(I.byteLength<this.workerMessageLengthLimit){if($("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const O=function(W){for(var H=1;H<arguments.length;H++){var Y=arguments[H]!=null?arguments[H]:{};H%2?o6(Object(Y),!0).forEach(function(Q){D(W,Q,Y[Q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(W,Object.getOwnPropertyDescriptors(Y)):o6(Object(Y)).forEach(function(Q){Object.defineProperty(W,Q,Object.getOwnPropertyDescriptor(Y,Q))})}return W}({},w);delete O.jpg,C.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(O))}return I}{const O=this.quality*this.qualityRatio;return this.quality=O,await this.generateRequestData(t,{appId:i,cname:o,cid:l,vid:u,sid:p,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ms.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Uo.CLOSED,this.emit(Or.STATE_CHANGE,Vo.CLOSED)}}const The={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new ne(G.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new ne(G.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(o=>{var l;if(!fe(l=["supervise","moderation"]).call(l,o))throw new ne(G.INVALID_PARAMS,"".concat(o," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new ne(G.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new whe(t)}};var a6=h(vn.Object.getOwnPropertySymbols),Che=Qt,Rhe=QS.indexOf,Nhe=p_,lN=de([].indexOf),c6=!!lN&&1/lN([1],1,-0)<0;Che({target:"Array",proto:!0,forced:c6||!Nhe("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return c6?lN(this,e,t)||0:Rhe(this,e,t)}});var Ahe=Qi("Array","indexOf"),Ihe=N,Ohe=Ahe,dN=Array.prototype,Phe=function(e){var t=e.indexOf;return e===dN||Ihe(dN,e)&&t===dN.indexOf?Ohe:t},l6=h(Phe);function Dhe(e,t){if(e==null)return{};var n,i,o=function(u,p){if(u==null)return{};var m={};for(var g in u)if({}.hasOwnProperty.call(u,g)){if(l6(p).call(p,g)!==-1)continue;m[g]=u[g]}return m}(e,t);if(a6){var l=a6(e);for(i=0;i<l.length;i++)n=l[i],l6(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}let d6=class{get localCapabilities(){return xn(this._localCapabilities)}get rtpCapabilities(){return xn(this._rtpCapabilities)}get candidates(){return xn(this._candidates)}get iceParameters(){return xn(this._iceParameters)}get dtlsParameters(){return xn(this._dtlsParameters)}constructor(e){D(this,"sessionDesc",void 0),D(this,"_localCapabilities",void 0),D(this,"_rtpCapabilities",void 0),D(this,"_candidates",void 0),D(this,"_iceParameters",void 0),D(this,"_dtlsParameters",void 0),D(this,"setup",void 0),D(this,"currentMidIndex",void 0),D(this,"cname","o/i14u9pJrxRKAsu"),D(this,"firefoxSsrcMidMap",new Map),e=xn(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:o,localCapabilities:l,direction:u,setup:p,videoCodec:m,audioCodec:g}=e;let y;this.setup=p,y=u===Os.RECEIVE_ONLY?Ns(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ns(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=o,this._candidates=i,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=l;const b=u===Os.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,S=u===Os.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,w=u===Os.RECEIVE_ONLY?o.send.videoCodecs:Jf(Me.VIDEO,b,S,m),k=u===Os.RECEIVE_ONLY?o.send.audioCodecs:Jf(Me.AUDIO,b,S,g);for(const I of y.mediaDescriptions)I.attributes.iceUfrag=t.iceUfrag,I.attributes.icePwd=t.icePwd,I.attributes.fingerprints=n.fingerprints,I.attributes.candidates=i,I.attributes.setup=this.setup,I.media.mediaType==="application"&&(I.attributes.sctpPort="5000"),I.media.mediaType==="video"&&(I.media.fmts=w.map(O=>O.payloadType.toString(10)),I.attributes.payloads=w,I.attributes.extmaps=b.videoExtensions),I.media.mediaType==="audio"&&(I.media.fmts=k.map(O=>O.payloadType.toString(10)),I.attributes.payloads=k,I.attributes.extmaps=b.audioExtensions,Tp(I));this.sessionDesc=y,this.currentMidIndex=y.mediaDescriptions.length-1}toString(){return Gc(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,i,o){n=n.replace(/ /g,"-");const{ssrcs:l,ssrcGroups:u}=qf(t,this.cname,$("SYNC_GROUP")?n:void 0),p=this.findPreloadMediaDesc(l);if(p){if(Sn()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,p.attributes.mid),o&&(o.twcc||o.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,o),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(e,l,i);let g;return m===-1?(g=this.createOrRecycleSendMedia(e,l,u,"sendonly",i,o),this.updateBundleMids()):(g=xn(this.sessionDesc.mediaDescriptions[m]),g.attributes.direction="sendonly",g.attributes.ssrcs=l,g.attributes.ssrcGroups=u,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(g,o)),Sn()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,g.attributes.mid),{needExchangeSDP:!0,mid:g.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const i=[];return e.forEach(o=>{const l=o._mediaStreamTrack.kind,u=this.findAvailableRecvMediaIndex(l);let p,m=!1;u===-1?(m=!0,p=this.createOrRecycleRecvMedia(o,[],"recvonly",t,n),this.updateBundleMids()):(p=xn(this.sessionDesc.mediaDescriptions[u]),p.attributes.direction="recvonly"),i.push({mid:p.attributes.mid,needCreateTransceiver:m})}),i}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:i,port:o,type:l,relatedAddress:u,relatedPort:p,priority:m}=new RTCIceCandidate(e),g={foundation:t??"",componentId:"1",transport:n??"",priority:m?m+"":"",connectionAddress:i??"",port:o?o+"":"",type:l?l+"":"",relAddr:u??"",relPort:p?p+"":"",extension:{}};this.candidates.some(y=>y.priority===g.priority&&y.connectionAddress===g.connectionAddress&&y.port===g.port)||(this._candidates.push(g),this.sessionDesc.mediaDescriptions.forEach(y=>{y.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,i,o){const l=e._mediaStreamTrack.kind,u=this.rtpCapabilities.recv,p=Jf(l,u,this.localCapabilities.send,l===Me.AUDIO?o:i),m=l===Me.VIDEO?u.videoExtensions:u.audioExtensions,g="".concat(++this.currentMidIndex);let y={media:{mediaType:l,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};y=this.mungRecvMediaDsec(y,e);const b=this.findFirstClosedMedia(l);if(b){const S=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[S]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>fe(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>fe(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const o=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Sn()){if(o){const l=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(l||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!l||l!==i.attributes.mid)}return!1}return o&&i.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=xn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,i,o,l){const u=this.rtpCapabilities.send,p=e===Me.VIDEO?u.videoCodecs:u.audioCodecs,m=e===Me.VIDEO?u.videoExtensions:u.audioExtensions;Sn()&&(o="".concat(++this.currentMidIndex));let g={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:o}};g=this.mungSendMediaDesc(g,l);const y=this.findFirstClosedMedia(e);if(y){const b=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[b]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}mungRecvMediaDsec(e,t,n){const i=xn(e);return eR(i),_u(i,t),tR(i,t),n4(i),SE(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=xn(e);return SE(n,t,this.localCapabilities.recv),Tp(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Sn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const khe=["sdp"];var wn;function u6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function ql(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?u6(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u6(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let h6=(wn=class Hp extends UV{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,i){super(t,n),D(this,"direction",void 0),D(this,"name",void 0),D(this,"store",void 0),D(this,"spec",void 0),D(this,"peerConnection",void 0),D(this,"initialOffer",void 0),D(this,"transport",void 0),D(this,"statsFilter",void 0),D(this,"localCandidateCount",0),D(this,"_isInRestartIce",!1),D(this,"mutex",void 0),D(this,"onLocalCandidate",void 0),D(this,"remoteSDP",void 0),D(this,"pendingCandidates",[]),D(this,"localCapabilities",void 0),D(this,"isReady",!1),D(this,"restartCnt",0),D(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new Ar("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Hp.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??Os.SEND_ONLY,this.name=this.direction===Os.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Gy(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,Sn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await rR();if(this.localCapabilities=Xf(n),t){const{sdp:i}=t,o=Dhe(t,khe),l=function(){const y={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},b=Yf(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bo(b,y,"videoExtensions",S,w,k),Bo(b,y,"videoCodecs",S,w,k),Bo(b,y,"audioExtensions",S,w,k),Bo(b,y,"audioCodecs",S,w,k),$("RAISE_H264_BASELINE_PRIORITY")){const I=k.videoCodecs.findIndex(O=>O.rtpMap&&O.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&O.fmtp&&O.fmtp.parameters["profile-level-id"]==="42001f");if(I!==-1){const O=k.videoCodecs.findIndex(W=>W.rtpMap&&W.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(O<I){C.debug("raising H264 baseline profile priority");const W=k.videoCodecs[I];k.videoCodecs.splice(I,1),k.videoCodecs.splice(O,0,W)}O!==-1&&$("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(W=>!(W.rtpMap&&W.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&W.fmtp&&W.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:S,recv:w,sendrecv:k}}({},{},i);this.remoteSDP=new d6({remoteIceParameters:o.iceParameters,remoteDtlsParameters:o.dtlsParameters,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const u=await this.peerConnection.createAnswer();if(!u.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const p=cc(u.sdp);await this.peerConnection.setLocalDescription(u);const m=await s4({},{},u.sdp);this.localCapabilities=Xf(m);const g=this.peerConnection.getTransceivers()[0];return g!=null&&g.receiver&&g.receiver.transport&&this.tryBindTransportEvents(g.receiver.transport),ql(ql({},p),{},{sdp:u.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=cc(i.sdp);return this.initialOffer=i,ql(ql({},o),{},{sdp:i.sdp})}}catch(n){throw new oe(G.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:o}=t,l=await s4({},{},n);this.remoteSDP=new d6({remoteIceParameters:i,remoteDtlsParameters:o,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const u=this.peerConnection.getTransceivers()[0];u!=null&&u.sender&&u.sender.transport&&this.tryBindTransportEvents(u.sender.transport)}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new oe(G.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,i){var o=this;return Ls(function*(){const l=yield Tt(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=[],p=o.remoteSDP.receive(t,n,i);t.forEach((O,W)=>{if(p[W].needCreateTransceiver){const H=o.peerConnection.addTransceiver(O._mediaStreamTrack,{direction:"sendonly"});u.push(H),O._updateRtpTransceiver(H)}else{const H=o.peerConnection.getTransceivers().find(Y=>Y.mid===p[W].mid);if(!H)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(p[W].mid));u.push(H),O._updateRtpTransceiver(H)}}),Sn()&&$("SIMULCAST")===!0&&(yield Tt(o.applySimulcastForFirefox(u,t)));const m=p.map(O=>O.mid),g=yield Tt(o.peerConnection.createOffer()),y=o.mungSendOfferSDP(g.sdp,t,m),b=Ns(y),S=m.map(O=>{const W=b.mediaDescriptions.find(H=>H.attributes.mid===O);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return ZC(W,$("USE_PUB_RTX"))}),w=u.map((O,W)=>{const H=m[W];return{localSSRC:S[W],id:H}});yield Tt(o.peerConnection.setLocalDescription({type:"offer",sdp:y}));try{yield w}catch(O){const W=o.remoteSDP.toString();throw yield Tt(o.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield Tt(o.peerConnection.setRemoteDescription({type:"answer",sdp:W})),yield Tt(o.stopSending(m,!0)),O}yield Tt(o.applySimulcastEncodings(u,t)),yield Tt(o.applySendEncodings(u,t));const k=o.remoteSDP.toString(),I=o.logSDPExchange(y,"offer","local","send");return I==null||I(k),yield Tt(o.setRemoteDescription({type:"answer",sdp:k})),u.map((O,W)=>{const H=m[W];return{localSSRC:S[W],id:H}})}catch(u){throw u instanceof oe?u:new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{l()}})()}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length (".concat(o.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));o.map(m=>{var g;m.direction="inactive",(g=m.stop)===null||g===void 0||g.call(m)});const l=await this.peerConnection.createOffer(),u=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const p=this.remoteSDP.toString();u==null||u(p),await this.setRemoteDescription({type:"answer",sdp:p})}catch(o){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:u}=this.remoteSDP.send(t,n,i,o);if(u){const m=this.remoteSDP.toString(),g=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const y=await this.peerConnection.createAnswer(),b=this.mungReceiveAnswerSDP(y.sdp,l,t);g==null||g(b||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:b}),C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const p=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!p||p.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,mid:p.mid,transceiver:p}}catch(l){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async mockReceive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:u}=this.remoteSDP.send(t,n,i,o);if(u){const p=this.remoteSDP.toString(),m=this.logSDPExchange(p,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:p});const g=await this.peerConnection.createAnswer(),y=this.mungReceiveAnswerSDP(g.sdp,l,t);m==null||m(y||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:y}),C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(l){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===iu.Auto&&(this.store.p2pTransport=iu.SdRtn,It().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Hp.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,It().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Hp.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=cc(n.sdp);return this.store.descriptionStart(),this.direction===Os.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Os.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=cc(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const l=this.remoteSDP.toString(),u=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),u==null||u(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new oe(G.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===t);i.length===1&&(this.isVP8Simulcast(n)?Sn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(o=>o.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:o}=n.getSelectedCandidatePair();return{local:ql(ql({},Lo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:ql(ql({},Lo),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;fe(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const o={iceServers:[]};var l;return t.iceServers?o.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Zd(t.turnServer.servers)?o.iceServers=t.turnServer.servers:(o.iceServers&&o.iceServers.push(...Hp.turnServerConfigToIceServers(t.turnServer.servers,n,i)),$("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&t.turnServer.serversFromGateway&&o.iceServers.push(...Hp.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,i)),fe(l=[iu.Relay,iu.SdRtn]).call(l,n)&&(o.iceTransportPolicy="relay"),$("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(u=>{u.forceturn&&(o.iceTransportPolicy="relay")}))),$("ENABLE_ENCODED_TRANSFORM")&&It().supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),C.debug("P2PConnection p2pTransport is ".concat(n)),o}static turnServerConfigToIceServers(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const o=[],l=t.filter(p=>p.tcpport);C.debug("P2PConnection turnServers is ".concat(l,", current index is ").concat(i));const u=l.length>i?l[i]:l[0];switch(n){case iu.SdRtn:const p=t.filter(g=>{var y;return fe(y=g.username).call(y,"glb:")&&g.turnServerURL==g.turnServerURL}),m=p.length>i?p[i]:p[0];m&&(o.push({username:m.username,credential:m.password,credentialType:"password",urls:"turn:".concat(Fo(m.turnServerURL),":").concat(m.tcpport,"?transport=udp")}),o.push({username:m.username,credential:m.password,credentialType:"password",urls:"turns:".concat(Fo(m.turnServerURL),":").concat(m.tcpport,"?transport=tcp")}));break;case iu.Relay:u&&(o.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.tcpport,"?transport=udp")}),o.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(Fo(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}));break;default:u&&(o.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.tcpport,"?transport=udp")}),o.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(Fo(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}),o.push({username:u.username,credential:u.password,credentialType:"password",urls:"stun:".concat(u.turnServerURL,":").concat(u.tcpport)}))}return o}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var i;t!=null&&t.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,t.state))},t.onerror=i=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in i?i.error:i)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const i=t==null?void 0:t.iceTransport.state;var o;i&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:o}=n.getSelectedCandidatePair()||{};if(i&&o){const l=i.address+":"+i.port,u=o.address+":"+o.port;C.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(ac(l)),", remote ").concat(JSON.stringify(ac(u))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(y=>y.track===t._mediaStreamTrack)),!n)return C.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return C.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!It().supportSetRtpSenderParameters)return C.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o={},l={};switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(t._encoderConfig){var u;const{bitrateMax:y,frameRate:b,scaleResolutionDownBy:S}=t._encoderConfig;y&&(l.maxBitrate=1e3*y),fe(u=t._hints).call(u,Xt.LOW_STREAM)&&(b&&(l.maxFramerate=Fs(b)),S&&S>=1&&(l.scaleResolutionDownBy=S))}if($("DSCP_TYPE")&&nc()){var p;const y=$("DSCP_TYPE");fe(p=["very-low","low","medium","high"]).call(p,y)&&(l.networkPriority=y)}const m=n.getParameters(),g=(i=m.encodings)===null||i===void 0?void 0:i[0];Sn()&&!g&&(o.encodings=[l]),g&&Object.assign(g,l),Object.assign(m,o),C.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await n.setParameters(m)}async applySendEncodings(t,n){try{if(!It().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const o=t[i],l=n[i];l instanceof pn&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,o.sender)}}catch{C.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const o=Ns(t);return n.forEach((l,u)=>{const p=i[u],m=o.mediaDescriptions.find(g=>g.attributes.mid===p);m&&(_u(m,l),nR(m,l,this.store.codec))}),Gc(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let m=0;m<t.length;m++){var i,o,l,u,p;const g=t[m],y=n[m];if(y instanceof pn&&!fe(i=y._hints).call(i,Xt.LOW_STREAM)&&(o=y._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((l=y._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(u=y._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((p=y._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){const b={},S={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const w=g.sender.getParameters();await g.sender.setParameters(Object.assign(w,b))}}}async applySimulcastEncodings(t,n){if(!Sn()&&t.length===n.length)for(let i=0;i<t.length;i++){const o=n[i];if(o instanceof pn&&this.isVP8Simulcast(o)){const l=t[i],u={},p={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];const m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,u))}}}isVP8Simulcast(t){var n,i,o,l,u;return!!(t instanceof pn&&$("SIMULCAST")&&this.store.codec==="vp8"&&!fe(n=t._hints).call(n,Xt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=t._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(t,n,i,o){if($("SDP_LOGGING"))return C.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",i==="local"?"remote":"local",o)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(u=>{u.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();o==null||o(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async u=>{u.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const l=this.remoteSDP.toString();o==null||o(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var i;if(n=n??((i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp)){var o;const l=(o=Ns(n).mediaDescriptions.find(u=>u.attributes.mid===t))===null||o===void 0?void 0:o.attributes.ssrcs;return l==null?void 0:l[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),fe(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,i){const o=Ns(t),l=o.mediaDescriptions.find(u=>u.attributes.mid===n);return l&&i===Me.AUDIO&&l.media.mediaType==="audio"&&Tp(l),Gc(o)}},we(wn.prototype,"establish",[Ko],Object.getOwnPropertyDescriptor(wn.prototype,"establish"),wn.prototype),we(wn.prototype,"connect",[Ko],Object.getOwnPropertyDescriptor(wn.prototype,"connect"),wn.prototype),we(wn.prototype,"receive",[Ko],Object.getOwnPropertyDescriptor(wn.prototype,"receive"),wn.prototype),we(wn.prototype,"mockReceive",[Ko],Object.getOwnPropertyDescriptor(wn.prototype,"mockReceive"),wn.prototype),we(wn.prototype,"stopReceiving",[Ko],Object.getOwnPropertyDescriptor(wn.prototype,"stopReceiving"),wn.prototype),we(wn.prototype,"restartICE",[Ko],Object.getOwnPropertyDescriptor(wn.prototype,"restartICE"),wn.prototype),we(wn.prototype,"close",[Ko],Object.getOwnPropertyDescriptor(wn.prototype,"close"),wn.prototype),we(wn.prototype,"updateEncoderConfig",[Ko],Object.getOwnPropertyDescriptor(wn.prototype,"updateEncoderConfig"),wn.prototype),we(wn.prototype,"updateSendParameters",[Ko],Object.getOwnPropertyDescriptor(wn.prototype,"updateSendParameters"),wn.prototype),we(wn.prototype,"replaceTrack",[Ko],Object.getOwnPropertyDescriptor(wn.prototype,"replaceTrack"),wn.prototype),we(wn.prototype,"muteLocal",[Ko],Object.getOwnPropertyDescriptor(wn.prototype,"muteLocal"),wn.prototype),we(wn.prototype,"unmuteLocal",[Ko],Object.getOwnPropertyDescriptor(wn.prototype,"unmuteLocal"),wn.prototype),wn);function Ko(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("From P2PConnection.".concat(t));try{for(var u=arguments.length,p=new Array(u),m=0;m<u;m++)p[m]=arguments[m];return await i.apply(this,p)}finally{l()}},n}let xa=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var p6,m6,f6,g6,_6,y6,E6,v6,b6,S6,x6,Pn;function w6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function tv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?w6(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w6(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Lhe=(p6=wa(xa.SEND_ONLY),m6=wa(xa.SEND_ONLY),f6=wa(),g6=wa(xa.RECEIVE_ONLY),_6=wa(xa.RECEIVE_ONLY),y6=wa(xa.RECEIVE_ONLY),E6=wa(xa.RECEIVE_ONLY),v6=wa(xa.RECEIVE_ONLY),b6=wa(xa.RECEIVE_ONLY),S6=wa(),x6=wa(xa.RECEIVE_ONLY),Pn=class extends On{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Ke.StateChange,t,this._state)}constructor(e,t){super(),D(this,"isPlanB",!1),D(this,"store",void 0),D(this,"statsUploader",void 0),D(this,"sendConnection",void 0),D(this,"recvConnection",void 0),D(this,"localTrackMap",new Map),D(this,"remoteUserMap",new Map),D(this,"localDataChannels",[]),D(this,"pendingLocalTracks",[]),D(this,"pendingRemoteTracks",[]),D(this,"statsCollector",void 0),D(this,"dtlsFailedCount",0),D(this,"sendMutex",void 0),D(this,"recvMutex",void 0),D(this,"_state",qt.Disconnected),D(this,"_restartStates",["disconnected","failed"]),D(this,"reconnectInterval",void 0),D(this,"uploadUnplinkStarted",!1),D(this,"uploadDownlinkStarted",!1),D(this,"uplinkStateUploadInterval",void 0),D(this,"downlinkStatsUploadInterval",void 0),D(this,"handleMuteLocalTrack",async(n,i,o)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==qt.Connected)return void o(new oe(G.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const m=this.filterTobeMutedTracks(n);if(m.length===0)return void i();const g=m.find(w=>w[0]==="videoLowTrack");g&&g[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(m.map(w=>{let[,{id:k}]=w;return k}));let y=!1;var u,p;n.trackMediaType==="video"?y=!((u=this.localTrackMap.get(ge.LocalAudioTrack))===null||u===void 0||!u.track._muted):y=((p=this.localTrackMap.get(ge.LocalVideoTrack))===null||p===void 0?void 0:p.id)===void 0;const b=this.createMuteMessage(m);await mn(this,Ke.RequestMuteLocal,b);const S=n.trackMediaType==="video"?jl.MUTE_LOCAL_VIDEO:jl.MUTE_LOCAL_AUDIO;await mn(this,Ke.RequestP2PMuteLocal,{action:S,message:b,isMuteAll:y}),i()}catch(m){o(m)}finally{l()}}),D(this,"handleUnmuteLocalTrack",async(n,i,o)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==qt.Connected)return void o(new oe(G.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const u=this.filterTobeUnmutedTracks(n);if(u.length===0)return void i();await this.sendConnection.unmuteLocal(u.map(g=>{let[,{id:y}]=g;return y}));const p=this.createUnmuteMessage(u),m=n.trackMediaType==="video"?jl.UNMUTE_LOCAL_VIDEO:jl.UNMUTE_LOCAL_AUDIO;await mn(this,Ke.RequestP2PMuteLocal,{action:m,message:p}),i()}catch(u){o(u)}finally{l()}}),D(this,"handleUpdateVideoEncoder",async(n,i,o,l)=>{let u;typeof l=="boolean"&&l||(u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const m=this.localTrackMap.get(ge.LocalVideoTrack);if(!this.sendConnection||!m||m.track!==n||this.state!==qt.Connected)return void i();const{id:g,track:y}=m;g&&(await this.sendConnection.updateSendParameters(g,y),await this.sendConnection.updateEncoderConfig(g,y),this.emit(Ke.UpdateVideoEncoder,y)),i()}catch(m){o(m)}finally{var p;(p=u)===null||p===void 0||p()}}),D(this,"handleUpdateVideoSendParameters",async(n,i,o)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const u=this.localTrackMap.get(ge.LocalVideoTrack);if(!this.sendConnection||!u||u.track!==n||this.state!==qt.Connected)return void i();const{id:p,track:m}=u;p&&await this.sendConnection.updateSendParameters(p,m),i()}catch(u){o(u)}finally{l()}}),D(this,"handleReplaceTrack",async(n,i,o,l)=>{let u;C.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof l=="boolean"&&l||(u=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var p;const g=Array.from(this.localTrackMap.entries()).find(y=>{let[,{track:b}]=y;return n===b});if(!this.sendConnection||!g||g[1].id===void 0||this.state!==qt.Connected)return void i();if(await((p=this.sendConnection)===null||p===void 0?void 0:p.replaceTrack(n,g[1].id)),g[0]===ge.LocalVideoTrack&&It().supportDualStreamEncoding){const y=this.localTrackMap.get(ge.LocalVideoLowTrack);if(y){const b=n._mediaStreamTrack.clone();y.track._originMediaStreamTrack.stop(),y.track._mediaStreamTrack=b,y.track._originMediaStreamTrack=b,await new xe((S,w)=>{this.handleReplaceTrack(y.track,S,w,!0)})}}i()}catch(g){o(g)}finally{var m;(m=u)===null||m===void 0||m()}}),D(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),D(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),D(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),D(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new F4(e),this.bindStatsUploaderEvents(),this.sendMutex=new Ar("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Ar("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},$("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new oe(G.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new oe(G.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(C.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new h6(e,this.store,Os.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(t);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=qt.New,this.sendConnection&&(C.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new h6(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new oe(G.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=qt.Connected}async addRemoteCandidate(e,t){if(t===Os.RECEIVE_ONLY){if(!this.sendConnection)throw new oe(G.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new oe(G.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var i=this;return Ls(function*(){const o=yield Tt(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==qt.Connected){i.throwIfTrackTypeNotMatch(e);const g=e.filter(y=>i.pendingLocalTracks.indexOf(y)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(g))}i.store.pubId=i.store.pubId+1,rs.markPublishStart(i.store.clientId,i.store.pubId);const l=i.filterTobePublishedTracks(e,t,n);if(l.length===0)return void(yield Tt(i.tryToUnmuteAudio(e)));l.forEach(g=>{let{track:y,type:b}=g;const S=Date.now();i.store.publish(y.getTrackId(),b===ge.LocalAudioTrack?"audio":"video",S)}),i.bindLocalTrackEvents(l);const u=yield Tt(i.sendConnection.send(l.map(g=>{let{track:y}=g;return y}),i.store.codec,i.store.audioCodec)),p=(yield Tt(u.next())).value,m=i.createGatewayPublishMessage(l,p);try{yield m}catch(g){throw u.throw(g),(g==null?void 0:g.code)===G.WS_ABORT&&l.forEach(y=>{let{track:b}=y;i.pendingLocalTracks.indexOf(b)===-1&&i.pendingLocalTracks.push(b)}),i.unbindLocalTrackEvents(l),g}yield Tt(u.next()),l.forEach(g=>{let{type:y}=g;i.statsCollector.addLocalStats(y)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(l,p),l.forEach(g=>{let{track:y,type:b}=g;const S=Date.now();i.store.publish(y.getTrackId(),b===ge.LocalAudioTrack?"audio":"video",void 0,S)}),i.startUploadUplinkState()}finally{o()}})()}async unpublish(e){if(!this.sendConnection||this.state!==qt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(o=>!fe(e).call(e,o)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(o=>o[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(o=>{let[,{id:l}]=o;return l})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(o=>{let[l,{track:u}]=o;return{type:l,track:u}})),t.forEach(o=>{let[l]=o;this.statsCollector.removeLocalStats(l)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===qt.Connected)return n&&n[1].track.close(),i;e.forEach(o=>{const l=this.pendingLocalTracks.indexOf(o);l!==-1&&this.pendingLocalTracks.splice(l,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[o,{track:l,ssrcs:u}]=i;const p={stream_type:xde(l,o),ssrcs:u};l._muted||!l._enabled?t.push(p):n.push(p)}),t.length>0&&t.forEach(i=>{mn(this,Ke.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{mn(this,Ke.RequestUnmuteLocal,[i])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Ls(function*(){throw new oe(G.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(C.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ar(this,Ke.RequestRePublish,this.pendingLocalTracks),this.emit(Ke.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new oe(G.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,i){var o;if(!this.recvConnection)throw new oe(G.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((o=this.remoteUserMap.get(e))!==null&&o!==void 0&&o.has(t))return;const{track:l,mid:u,transceiver:p}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),i);t===Me.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new _p(l,e.uid,e._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),p&&e._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new gp(l,e.uid,e._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),p&&e._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._videoTrack));const m=this.remoteUserMap.get(e);m?m.set(t,u):this.remoteUserMap.set(e,new Map([[t,u]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const g=this.pendingRemoteTracks.findIndex(y=>{let{user:b,kind:S}=y;return b.uid===e.uid&&t===S});g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(Ke.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,i){if(!this.recvConnection)throw new oe(G.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),i)}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:p}=l;return t!==void 0?u.uid===e.uid&&t===p:u.uid===e.uid});if(i.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),this.recvConnection||n||i.forEach(l=>{let{kind:u}=l;var p;if(u===Me.AUDIO)(p=e._audioTrack)===null||p===void 0||p._destroy(),e._audioTrack=void 0;else if(u===Me.VIDEO){var m;(m=e._videoTrack)===null||m===void 0||m._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const o=this.filterTobeUnSubscribedTracks(e,t);o.length!==0&&(await this.recvConnection.stopReceiving(o.map(l=>{let[,{id:u}]=l;return u})),this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),o.forEach(l=>{let[u,{kind:p}]=l;var m,g;if(p===Me.VIDEO&&u._videoSSRC&&((m=this.recvConnection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),p===Me.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),n||((g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0);else if(p===Me.AUDIO){var y;this.unbindRemoteTrackEvents(u._audioTrack),!n&&((y=u._audioTrack)===null||y===void 0||y._destroy(),u._audioTrack=void 0)}}),o.forEach(l=>{let[,{kind:u}]=l;mn(this,Ke.RequestP2PMuteRemote,u)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[Me.VIDEO,Me.AUDIO].forEach(i=>{n.has(i)?mn(this,Ke.RequestP2PUnmuteRemote,i):mn(this,Ke.RequestP2PMuteRemote,i)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new oe(G.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new oe(G.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new oe(G.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new oe(G.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void C.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void C.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===Me.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void C.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||C.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ge.LocalAudioTrack);if((t==null?void 0:t.track)instanceof ur){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return o!==ge.LocalAudioTrack}).filter(i=>{let[o]=i;return!(e&&o===ge.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===ge.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(e,t,n,i,o){if(e){const u=this.localTrackMap.get(ge.LocalAudioTrack),p=i?this.localTrackMap.get(ge.LocalVideoLowTrack):this.localTrackMap.get(ge.LocalVideoTrack);Ue.publish(this.store.sessionId,{eventElapse:rs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(Xt.SCREEN_TRACK))!==-1,audio:!!u,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var l;n||(n=[]);const u=n.find(m=>m instanceof Wn),p=i?(l=this.localTrackMap.get(ge.LocalVideoTrack))===null||l===void 0?void 0:l.track:n.find(m=>m instanceof pn);Ue.publish(this.store.sessionId,{eventElapse:rs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(Xt.SCREEN_TRACK))!==-1,audio:!!u,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,i){const o=i===Me.VIDEO?n._videoSSRC:n._audioSSRC;o&&Ue.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Me.VIDEO,audio:i===Me.AUDIO,peerid:n.uid,subscribeRequestid:i===Me.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:rs.measureFromSubscribeStart(this.store.clientId,o)})}reset(){C.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ar("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Ar("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ge.LocalAudioTrack);if((e==null?void 0:e.track)instanceof ur){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=qt.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ge.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ge.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof pn||t&&t.track instanceof Wn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(us(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ge.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Wd(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(C.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=qt.Reconnecting,$("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case ge.LocalVideoTrack:fe(t=i._hints).call(t,Xt.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ge.LocalAudioTrack:i instanceof ur?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ge.LocalVideoLowTrack:}}),this.emit(Ke.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(us(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Ke.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),C.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:o}=n;if((e instanceof Fl?e.uid:e)===i.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,i;if(e===Os.SEND_ONLY){if(!this.sendConnection)throw new oe(G.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new oe(G.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(t){const o=await i.restartICE(t);return i.isInRestartIce=!1,o}{const o=await i.restartICE();if(o){const l=await ar(this,Ke.RequestP2PRestartICE,{direction:Os.RECEIVE_ONLY,iceParameter:o});await i.restartICE(l),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(ge.LocalVideoTrack),n=this.localTrackMap.get(ge.LocalAudioTrack),i=e.videoSend.find(w=>{var k;return w.ssrc===(t==null||(k=t.ssrcs)===null||k===void 0?void 0:k[0].ssrcId)}),o=e.audioSend.find(w=>{var k;return w.ssrc===(n==null||(k=n.ssrcs)===null||k===void 0?void 0:k[0].ssrcId)});if(!i||!o)return 1;const l=yi(this,Ke.NeedSignalRTT),u=i?i.rttMs:void 0,p=o?o.rttMs:void 0,m=u&&p?(u+p)/2:u||p,g=(m&&l?(m+l)/2:m||l)||0,y=100*e.sendPacketLossRate*.7/50+.3*g/1500,b=y<.17?1:y<.36?2:y<.59?3:y<.1?4:5,S=t==null?void 0:t.track;if(S&&S._encoderConfig&&S._hints.indexOf(Xt.SCREEN_TRACK)===-1){const w=S._encoderConfig.bitrateMax,k=e.bitrate.actualEncoded;if(w&&k){const I=(1e3*w-k)/(1e3*w);return IV[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][b]}}return b}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const o=i._audioSSRC,l=i._videoSSRC,u=e.audioRecv.find(k=>k.ssrc===o),p=e.videoRecv.find(k=>k.ssrc===l);if(!u&&!p)return void(t+=1);const m=yi(this,Ke.NeedSignalRTT),g=e.rtt,y=(g&&m?(g+m)/2:g||m)||0,b=u?u.jitterMs:void 0,S=e.recvPacketLossRate;let w=.7*S*100/50+.3*y/1500;b&&(w=.6*S*100/50+.2*y/1500+.2*b/400),t+=w<.1?1:w<.17?2:w<.36?3:w<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new xe((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const i=[],o=It(),l=this.getAllTracks();e=rp(e=e.filter(m=>l.indexOf(m)===-1));let u=!1,p=!1;for(const m of e){if(m instanceof pn&&(this.localTrackMap.has(ge.LocalVideoTrack)||u?new oe(G.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:m,type:ge.LocalVideoTrack}),u=!0),t)){const g=this.getLowVideoTrack(m,n);i.push({track:g,type:ge.LocalVideoLowTrack})}if(m instanceof Wn){const g=this.localTrackMap.get(ge.LocalAudioTrack);if(g){if(!(g.track instanceof ur))throw new oe(G.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new oe(G.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");g.track.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0)}else if(p){const y=i.find(b=>{let{type:S}=b;return S===ge.LocalAudioTrack});if(!(y.track instanceof ur))throw new oe(G.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new oe(G.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(m)}else{if(!o.webAudioMediaStreamDest||m instanceof ur||m._bypassWebAudio)i.push({track:m,type:ge.LocalAudioTrack});else{const y=new ur;y.addAudioTrack(m),i.push({track:y,type:ge.LocalAudioTrack})}p=!0}}}return i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=rp(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof Wn){const o=this.localTrackMap.get(ge.LocalAudioTrack);if(!o)continue;o.track instanceof ur?(o.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),o.track.trackList.length===0&&(t.push([ge.LocalAudioTrack,o]),o.track.close())):t.push([ge.LocalAudioTrack,o])}if(i instanceof pn){const o=this.localTrackMap.get(ge.LocalVideoTrack);if(!o)continue;t.push([ge.LocalVideoTrack,o]);const l=this.localTrackMap.get(ge.LocalVideoLowTrack);l&&t.push([ge.LocalVideoLowTrack,l])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ge.LocalVideoTrack:n.addListener(Ve.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ge.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ge.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof ur?e.trackList.forEach(n=>{n.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ge.LocalVideoTrack:n.off(Ve.GET_STATS,this.handleGetLocalVideoStats),n.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ge.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ge.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof ur?e.trackList.forEach(t=>{t.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ve.GET_STATS,this.handleGetLocalAudioStats),t.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ve.GET_STATS,this.handleGetLocalAudioStats),e.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof gp&&t.addListener(Ve.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof _p&&t.addListener(Ve.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ve.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Me.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Me.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var o;let l,{track:u,type:p}=n;switch(p){case ge.LocalAudioTrack:l=tn.Audio;break;case ge.LocalVideoTrack:l=fe(o=u._hints).call(o,Xt.SCREEN_TRACK)?tn.Screen:tn.High;break;case ge.LocalVideoLowTrack:l=tn.Low}return{kind:p===ge.LocalAudioTrack?Me.AUDIO:Me.VIDEO,stream_type:l,mid:t[i].id,ssrcs:t[i].localSSRC,isMuted:u.muted||!u.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[o,{track:l,ssrcs:u,id:p}]=t;switch(o){case ge.LocalVideoTrack:i=fe(n=l._hints).call(n,Xt.SCREEN_TRACK)?tn.Screen:tn.High;break;case ge.LocalAudioTrack:i=tn.Audio;break;case ge.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:u,mid:p}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:o,type:l}=n;this.localTrackMap.set(l,{track:o,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Ke.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),fe(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await vr(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Ue.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:hn.TRACER}).onSuccess(),this.emit(Ke.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(us(n=this.remoteUserMap).call(n)).find(l=>l._audioSSRC===t);var o;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(o=i.audioTrack)===null||o===void 0||o.emit(ro.FIRST_FRAME_DECODED),Ue.firstRemoteFrame(this.store.sessionId,dr.FIRST_AUDIO_DECODE,Nn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:rs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(us(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);i&&Ue.firstRemoteFrame(this.store.sessionId,dr.FIRST_AUDIO_RECEIVED,Nn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:rs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoReceived=t=>{var n;const i=Array.from(us(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);i&&Ue.firstRemoteFrame(this.store.sessionId,dr.FIRST_VIDEO_RECEIVED,Nn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:rs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&i===o||this.emit(Ke.ConnectionTypeChange,i),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ul(n))," -> ").concat(JSON.stringify(Ul(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ul(n))," -> ").concat(JSON.stringify(Ul(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Ke.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Os.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,C.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Os.SEND_ONLY?this.restartICE(e):ar(this,Ke.RequestP2PRestartICE,{direction:Os.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ge.LocalAudioTrack);if(e instanceof Wn&&(n==null?void 0:n.track)instanceof ur)return n.track.isActive||t.push([ge.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:l}]=o;return e===l});if(i&&(t.push(i),i[0]===ge.LocalVideoTrack)){const o=this.localTrackMap.get(ge.LocalVideoLowTrack);o&&t.push([ge.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ge.LocalAudioTrack);if(e instanceof Wn&&(n==null?void 0:n.track)instanceof ur)return n.track.isActive&&t.push([ge.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:l}]=o;return e===l});if(i)if(i[0]===ge.LocalVideoTrack){t.push(i);const o=this.localTrackMap.get(ge.LocalVideoLowTrack);o&&t.push([ge.LocalVideoLowTrack,o])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[o,{track:l,ssrcs:u,id:p}]=t;switch(o){case ge.LocalAudioTrack:i=tn.Audio;break;case ge.LocalVideoTrack:i=fe(n=l._hints).call(n,Xt.SCREEN_TRACK)?tn.Screen:tn.High;break;case ge.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:u,mid:p}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[o,{track:l,ssrcs:u,id:p}]=t;switch(o){case ge.LocalAudioTrack:i=tn.Audio;break;case ge.LocalVideoTrack:i=fe(n=l._hints).call(n,Xt.SCREEN_TRACK)?tn.Screen:tn.High;break;case ge.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:u,mid:p}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const o=i.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(i.entries()).forEach(o=>{let[l,u]=o;n.push([e,{kind:l,id:u}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:o,id:l}]=n;switch(o){case Me.VIDEO:return void(i._videoSSRC&&t.push({stream_type:Me.VIDEO,ssrcId:i._videoSSRC}));case Me.AUDIO:return void(i._audioSSRC&&t.push({stream_type:Me.AUDIO,ssrcId:i._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const o=this.remoteUserMap.get(n);o&&(o.delete(i),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ge.LocalVideoTrack),n=this.localTrackMap.get(ge.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new xe((i,o)=>{this.handleUpdateVideoEncoder(t.track,i,o,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new xe((i,o)=>{this.handleUpdateVideoEncoder(n.track,i,o,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Wn){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await mn(this,Ke.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ke.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Ke.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await vr(Fy(this.dtlsFailedCount,Zn)),this.emit(Ke.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ge.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof pn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof pn).length>1)throw new oe(G.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Wn).length>1&&(e.some(t=>t instanceof Wn&&t._bypassWebAudio)||!It().webAudioMediaStreamDest))throw new oe(G.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof pn&&this.pendingLocalTracks.some(n=>n instanceof pn))throw new oe(G.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Wn&&this.pendingLocalTracks.some(n=>n instanceof Wn)&&(!It().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Wn&&n._bypassWebAudio)))throw new oe(G.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding,i=tv(tv({},{width:160,height:120,framerate:15,bitrate:50}),t);let o;o=n?e._mediaStreamTrack.clone():SR(e,i);const l=Zt(8,"track-low-"),u=new pn(o,tv(tv({},n&&{scaleResolutionDownBy:QC(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,l);return u.on(cu.TRANSCEIVER_UPDATED,p=>{e._updateRtpTransceiver(p,dp.LOW_STREAM)}),u._hints.push(Xt.LOW_STREAM),e.addListener(Ve.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,i){var o;const l=Array.from(us(o=this.remoteUserMap).call(o)).find(u=>u._videoSSRC===e);if(l){i||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const u=this.store.keyMetrics,p=u.subscribe.find(m=>m.userId===l.uid&&m.type==="video");Ue.firstRemoteVideoDecode(this.store.sessionId,dr.FIRST_VIDEO_DECODE,Nn.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:n,subscribeElapse:rs.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:u.requestAPEnd||0,apStart:u.requestAPStart||0,joinGwEnd:u.joinGatewayEnd||0,joinGwStart:u.joinGatewayStart||0,pcEnd:u.peerConnectionEnd||0,pcStart:u.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const o=i.get(t);if(!o)return!1;const l=await this.recvConnection.getRemoteSSRC(o);return l!==void 0&&l!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new oe(G.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new oe(G.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new oe(G.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new oe(G.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new oe(G.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new oe(G.NOT_SUPPORTED)}async preConnect(e){throw new oe(G.NOT_SUPPORTED)}getEstablishParams(){throw new oe(G.NOT_SUPPORTED)}async reSubscribe(e){throw new oe(G.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new oe(G.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ge.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,dp.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},we(Pn.prototype,"p2pConnect",[p6],Object.getOwnPropertyDescriptor(Pn.prototype,"p2pConnect"),Pn.prototype),we(Pn.prototype,"unpublish",[m6],Object.getOwnPropertyDescriptor(Pn.prototype,"unpublish"),Pn.prototype),we(Pn.prototype,"unpublishLowStream",[f6],Object.getOwnPropertyDescriptor(Pn.prototype,"unpublishLowStream"),Pn.prototype),we(Pn.prototype,"subscribe",[g6],Object.getOwnPropertyDescriptor(Pn.prototype,"subscribe"),Pn.prototype),we(Pn.prototype,"mockSubscribe",[_6],Object.getOwnPropertyDescriptor(Pn.prototype,"mockSubscribe"),Pn.prototype),we(Pn.prototype,"unsubscribe",[y6],Object.getOwnPropertyDescriptor(Pn.prototype,"unsubscribe"),Pn.prototype),we(Pn.prototype,"muteRemote",[E6],Object.getOwnPropertyDescriptor(Pn.prototype,"muteRemote"),Pn.prototype),we(Pn.prototype,"unmuteRemote",[v6],Object.getOwnPropertyDescriptor(Pn.prototype,"unmuteRemote"),Pn.prototype),we(Pn.prototype,"hasRemoteMediaWithLock",[b6],Object.getOwnPropertyDescriptor(Pn.prototype,"hasRemoteMediaWithLock"),Pn.prototype),we(Pn.prototype,"disconnectForReconnect",[S6],Object.getOwnPropertyDescriptor(Pn.prototype,"disconnectForReconnect"),Pn.prototype),we(Pn.prototype,"remoteMediaSsrcChanged",[x6],Object.getOwnPropertyDescriptor(Pn.prototype,"remoteMediaSsrcChanged"),Pn.prototype),Pn);function wa(e){return function(t,n,i){const o=t[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var l=arguments.length,u=new Array(l),p=0;p<l;p++)u[p]=arguments[p];switch(e){case xa.SEND_ONLY:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,u)}finally{m()}}case xa.RECEIVE_ONLY:{const m=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,u)}finally{m()}}default:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(n)),g=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,u)}finally{m(),g()}}}},i}}class Au extends On{constructor(t,n){super(),D(this,"signal",void 0),D(this,"token",void 0),D(this,"tokenTimeout",void 0),D(this,"tokenInterval",void 0),D(this,"_sequence",0),D(this,"userMap",new Map),D(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const i=()=>{this.signal.connectionState===Lt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*$("P2P_TOKEN_INTERVAL"))};i()}async send(t,n,i,o,l){var u;if(this.userMap.size===0)return;const p=Array.from(fi(u=this.userMap).call(u))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),o=o??Zt(6,""),l=l??this._sequence++;const m={_id:o,_type:t,_seq:l,_message:n,token:"".concat(this.token,"_").concat(p)};$("SHOW_P2P_LOG")&&C.debug("send message",m,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(m)).forEach(y=>{this.signal.request(He.DATA_STREAM,{payload:Dl(this.encoder.encode(y))})});const g=new xe((y,b)=>{const S=window.setTimeout(()=>{this.off("res-@".concat(o,"_ack"),w),this.off("res-@".concat(o),I),this.off(Sp.ABORT,k),C.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(o)),this.userMap.size===0?b(new oe(G.INVALID_REMOTE_USER)):b(new oe(G.TIMEOUT))},$("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),w=()=>{S&&window.clearTimeout(S),this.off(Sp.ABORT,k),i&&y()},k=()=>{S&&window.clearTimeout(S),this.off("res-@".concat(o,"_ack"),w),this.off("res-@".concat(o),I),b(new oe(G.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(o)))};this.once(Sp.ABORT,k),this.once("res-@".concat(o,"_ack"),w);const I=(W,H)=>{O=!0,S&&window.clearTimeout(S),this.off("res-@".concat(o,"_ack"),w),this.off(Sp.ABORT,k),W==="success"?y(H):b(new oe(G.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(o)))};let O=!1;i||(this.once("res-@".concat(o),I),vr($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{O||C.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(o,", ").concat(m))}))});try{return await g}catch(y){if(y.code===G.TIMEOUT)return await this.send(t,n,i,o,l);throw y}}onMessage(t){var n;const{_uid:i}=t;let o,l=this.userMap.get(i);if(l)o=l.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==zn.CHECK)return;const{token:g}=t;o=new Map,l={uid:i,isStart:!0,token:g,splitMessageMap:o,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,l),this.signal.emit(lt.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in t&&"total"in t){var u;const{id:g,total:y}=t,b=(u=o.get(g))!==null&&u!==void 0?u:[];if(b.push(t),o.has(g)||o.set(g,b),b.length!==y)return;{const S=Wd(b).call(b,(w,k)=>w.index-k.index).map(w=>w.payload).join("");o.delete(g),(t=JSON.parse(S))._uid=i}}const{_type:p,token:m}=t;if(fe(n=[zn.ACK,zn.CHECK]).call(n,p))return p===zn.CHECK&&this.handleCheckToken(l,m),void this.receiveMessage(t);m==="".concat(l.token,"_").concat(this.token)?this.handleReceivedMessage(t):C.debug('Receive unexpected message", '.concat(m,", cur_token: ").concat(l.token,"_").concat(this.token),t)}check(){const t={_id:Zt(6,""),token:this.token,_type:zn.CHECK};$("SHOW_P2P_LOG")&&C.debug("send message",t),this.signal.request(He.DATA_STREAM,{payload:Dl(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:zn.ACK,token:this.token};$("SHOW_P2P_LOG")&&C.debug("send message",n),this.signal.request(He.DATA_STREAM,{payload:Dl(this.encoder.encode(JSON.stringify(n)))})}response(t,n,i){this.send(zn.RESPONSE,JSON.stringify({success:!i,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(g=>{const{receivedMessagesMap:y,nextExpectedSequenceNumber:b}=g;for(;y.has(b);){const S=y.get(b);y.delete(b),this.receiveMessage(S),g.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:i,_seq:o}=t,l=this.userMap.get(i),{receivedMessagesMap:u,isStart:p,nextExpectedSequenceNumber:m}=l;if(o<m)return this.ack(t._id),void C.debug("[external-signal] receive old message, seq: ".concat(o,", ").concat(t._message));u.set(o,t),p&&o===m&&(this.receiveMessage(t),u.delete(m),l.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:i,_message:o,_uid:l}=t;if($("SHOW_P2P_LOG")&&C.debug("receive message",t),n){let u;switch(t._type!==zn.ACK&&(o&&(u=JSON.parse(o)),this.ack(t._id)),t._type){case zn.CANDIDATE:case zn.CONTROL:this.signal.emit(i,u,l);break;case zn.PUBLISH:case zn.UNPUBLISH:case zn.RESTART_ICE:case zn.CALL:u.uid=l,ar(this.signal,i,u).then(p=>{this.response(t._id,p)}).catch(()=>{this.response(t._id,void 0,!0)});break;case zn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case zn.RESPONSE:{const{success:p,message:m}=u;this.emit("res-@".concat(n),p?"success":"failed",m);break}}}}splitMessage(t){if(t.length<Au.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:i}=JSON.parse(t),o=Zt(6,"");let l=0,u=800;const p=Math.ceil(t.length/u);for(;t.length>0;){l++;const m={id:o,index:l,total:p,payload:t.slice(0,u),token:"".concat(this.token,"_").concat(i)};JSON.stringify(m).length>Au.MAX_MESSAGE_SIZE?u-=50:(n.push(m),t=t.slice(u))}return n.map(m=>JSON.stringify(m))}handleCheckToken(t,n){return t.token!==n?(C.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{C.debug("token timeout, ".concat(n)),this.reset(t.uid)},$("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await ar(this.signal,zn.CALL,void 0),n=await this.send(zn.CALL,t);this.signal.emit(Fe.P2P_CONNECTION,n,!0)}async reset(t,n){const i=this.userMap.get(t);i&&(this.emit(Sp.ABORT),this.signal.emit(lt.ON_USER_OFFLINE,{uid:i.uid,reason:Jle.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(C.debug("change local token from ".concat(n," to ").concat(n)),this.token=Zt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Sp.ABORT)}}D(Au,"MAX_SIZE",1),D(Au,"MAX_MESSAGE_SIZE",1024);class Mhe extends On{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Lt.CONNECTED?this.emit(Fe.WS_CONNECTED):t===Lt.RECONNECTING?this.emit(Fe.WS_RECONNECTING,this._websocketReconnectReason):t===Lt.CLOSED&&this.emit(Fe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),D(this,"__name__","P2PSignal"),D(this,"_disconnectedReason",void 0),D(this,"_websocketReconnectReason",void 0),D(this,"_connectionState",Lt.CLOSED),D(this,"reconnectToken",void 0),D(this,"p2pToken",void 0),D(this,"websocket",void 0),D(this,"openConnectionTime",void 0),D(this,"clientId",void 0),D(this,"lastMsgTime",Date.now()),D(this,"uploadCache",[]),D(this,"uploadCacheInterval",void 0),D(this,"rttRolling",new tC(5)),D(this,"pingpongTimer",void 0),D(this,"pingpongTimeoutCount",0),D(this,"joinResponse",void 0),D(this,"multiIpOption",void 0),D(this,"initError",void 0),D(this,"spec",void 0),D(this,"store",void 0),D(this,"_external_signal",void 0),D(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Fe.ON_BINARY_DATA,i.data);const o=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const l="res-@".concat(o._id);this.emit(l,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){switch(o._type){case lt.ON_DATA_STREAM:return void this.handleDataStream(o._message);case lt.MUTE_AUDIO:case lt.MUTE_VIDEO:case lt.ON_P2P_LOST:case lt.ON_USER_ONLINE:return;case lt.ON_USER_OFFLINE:const{uid:l}=o._message;return C.debug("[".concat(this.clientId,"] user-offline uid: ").concat(l)),void this._external_signal.reset(l)}if(this.emit(o._type,o._message),o._type===lt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===lt.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(kt.UID_BANNED);break;case 15:this.close(kt.IP_BANNED);break;case 16:this.close(kt.CHANNEL_BANNED)}if(o._type===lt.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case Je.ERR_LICENSE_MISSING:this.close(kt.LICENSE_MISSING);break;case Je.ERR_LICENSE_EXPIRED:this.close(kt.LICENSE_EXPIRED);break;case Je.ERR_LICENSE_MINUTES_EXCEEDED:this.close(kt.LICENSE_MINUTES_EXCEEDED);break;case Je.ERR_LICENSE_PERIOD_INVALID:this.close(kt.LICENSE_PERIOD_INVALID);break;case Je.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(kt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Je.ERR_LICENSE_ILLEGAL:this.close(kt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new qC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Lt.CONNECTED&&this.reconnect("retry",Yr.OFFLINE)}),this.p2pToken=Zt(6,""),this._external_signal=new Au(this,this.p2pToken)}async request(t,n,i,o){const l=Zt(6,""),u={_id:l,_type:t,_message:n},p=this.websocket.connectionID,m=()=>new xe((k,I)=>{if(this.connectionState===Lt.CONNECTED)return k();const O=()=>{this.off(Fe.WS_CLOSED,W),k()},W=()=>{this.off(Fe.WS_CONNECTED,O),I(new oe(G.WS_ABORT))};this.once(Fe.WS_CONNECTED,O),this.once(Fe.WS_CLOSED,W)});if(this.connectionState!==Lt.CONNECTING&&this.connectionState!==Lt.RECONNECTING||t===He.JOIN||t===He.REJOIN||await m(),this.websocket.sendMessage(u,!0),o)return;const g=new xe((k,I)=>{let O=!1;const W=(Y,Q)=>{O=!0,k({isSuccess:Y==="success",message:Q||{}}),this.off(Fe.WS_CLOSED,H),this.off(Fe.WS_RECONNECTING,H),this.emit(Fe.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(l),W);const H=()=>{I(new oe(G.WS_ABORT,"type: ".concat(t))),this.off(Fe.WS_CLOSED,H),this.off(Fe.WS_RECONNECTING,H),this.off("res-@".concat(l),W)};this.once(Fe.WS_CLOSED,H),this.once(Fe.WS_RECONNECTING,H),vr($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||O||(C.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Fe.REQUEST_TIMEOUT,t,n))})});let y=null;try{y=await g}catch(k){if(this.connectionState===Lt.CLOSED||t===He.LEAVE)throw new oe(G.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?k.throw():t===He.JOIN||t===He.REJOIN?null:(await m(),await this.request(t,n))}if(y.isSuccess)return y.message;const b=Number(y.message.error_code||y.message.code),S=gu(b),w=new oe(G.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(y.message.error_str),{code:b,data:y.message,desc:S.desc});return S.action==="success"?y.message:(C.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(b,", message: ").concat(S.desc,", action: ").concat(S.action)),b===Je.ERR_TOO_MANY_BROADCASTERS?((t===He.JOIN||t===He.REJOIN)&&(this.initError=w,this.close()),w.throw()):S.action==="failed"?w.throw():S.action==="quit"?(this.initError=w,this.close(),w.throw()):(b===Je.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=y.message.option,C.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Yr.MULTI_IP)):this.reconnect(S.action,Yr.SERVER_ERROR),t===He.JOIN||t===He.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new xe(i=>{const o=l=>{(!n||n(l))&&(this.off(t,o),i(l))};this.on(t,o)})}uploadWRTCStats(t){if(!this.store.sessionId)return void C.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(fu.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const l=$("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Lt.CONNECTED)return;const u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},$("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(t,n,i){return await this._external_signal.send(t,n,i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new xe((n,i)=>{this.once(Fe.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Fe.WS_CLOSED,()=>i(this.initError||new oe(G.WS_ABORT))),this.connectionState=Lt.CONNECTING,this.websocket.init(t).catch(i)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||kt.LEAVE,this.connectionState=Lt.CLOSED,C.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Zt(6,""),this._external_signal.clear(),this._external_signal=new Au(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Fe.ABORT_P2P_EXECUTION);const t=await ar(this,Fe.REQUEST_JOIN_INFO),n=await this.request(He.JOIN,t);if(!n)return this.emit(Fe.REPORT_JOIN_GATEWAY,G.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Fe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Lt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){return!1}handleDataStream(t){try{var n;const i=ru(t.payload),o=new TextDecoder().decode(i),l=JSON.parse(o);"total"in l&&"id"in l||fe(n=Object.values(zn)).call(n,l._type)?(l._uid=t.uid,this._external_signal.onMessage(l)):this.emit(lt.ON_DATA_STREAM,t)}catch{this.emit(lt.ON_DATA_STREAM,t)}}handleNotification(t){C.debug("[".concat(this.clientId,"] receive notification: "),t);const n=gu(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?t.code===Je.ERR_REPEAT_JOIN_CHANNEL&&$("IGNORE_UID_CHECK")?void this.close(kt.UID_CONFLICT):(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(kt.UID_BANNED),void this.close()):void this.reconnect(n.action,Yr.SERVER_ERROR);C.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=$("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(C.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>$("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Yr.TIMEOUT):this.request(He.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),$("REPORT_STATS")&&this.send(He.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(Et.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Fe.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Et.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Et.CLOSED,()=>{this.connectionState=Lt.CLOSED}),this.websocket.on(Et.FAILED,()=>{this._disconnectedReason=kt.NETWORK_ERROR,this.connectionState=Lt.CLOSED}),this.websocket.on(Et.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Lt.CONNECTED?this.connectionState=Lt.RECONNECTING:this.connectionState=Lt.CONNECTING}),this.websocket.on(Et.WILL_RECONNECT,(t,n,i)=>{t!=="retry"?(C.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):C.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(t)}),this.websocket.on(Et.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(Fe.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof oe&&t.code===G.UNEXPECTED_RESPONSE&&t.data.code===Je.ERR_NO_AUTHORIZED)return C.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Yr.SERVER_ERROR);C.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Yr.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Et.REQUEST_NEW_URLS,(t,n)=>{ar(this,Fe.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Et.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(lt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const jhe={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new Lhe(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new Mhe(n,t)}};function T6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function C6(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?T6(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T6(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Uhe{constructor(t){D(this,"sessionDesc",void 0),D(this,"localCapabilities",void 0),D(this,"rtpCapabilities",void 0),D(this,"candidates",void 0),D(this,"_originCandidates",void 0),D(this,"iceParameters",void 0),D(this,"dtlsParameters",void 0),D(this,"setup",void 0),D(this,"currentMidIndex",void 0),D(this,"cname",void 0),t=xn(t);const{iceParameters:n,dtlsParameters:i,candidates:o,rtpCapabilities:l,setup:u,localCapabilities:p,sdkCodec:m,cname:g}=t,y=Ns(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=l,this.candidates=o,this._originCandidates=xn(o),this.iceParameters=n,this.dtlsParameters=i,this.setup=u,this.localCapabilities=p,this.cname=g;for(let b=0;b<y.mediaDescriptions.length;b++){const S=y.mediaDescriptions[b];if(S.attributes.iceUfrag=n.iceUfrag,S.attributes.icePwd=n.icePwd,S.attributes.fingerprints=i.fingerprints,S.attributes.candidates=o,S.attributes.setup=u,S.media.mediaType==="video"){S.media.fmts=l.videoCodecs.map(I=>I.payloadType.toString(10));const w=l.videoCodecs.filter(I=>{var O,W;return(O=I.rtpMap)===null||O===void 0?void 0:fe(W=O.encodingName.toLowerCase()).call(W,m)}),k=l.videoCodecs.filter(I=>!fe(w).call(w,I));S.attributes.payloads=[...w,...k],S.attributes.extmaps=l.videoExtensions}S.media.mediaType==="audio"&&(S.media.fmts=l.audioCodecs.map(w=>w.payloadType.toString(10)),S.attributes.payloads=l.audioCodecs,S.attributes.extmaps=l.audioExtensions),y.mediaDescriptions[b]=this.mungMediaDesc(S)}this.sessionDesc=y,this.currentMidIndex=y.mediaDescriptions.length-1}toString(){return Gc(this.sessionDesc)}send(t,n,i){const{ssrcs:o,ssrcGroups:l}=qf(n,this.cname),u=this.sessionDesc.mediaDescriptions.find(g=>t===Me.VIDEO?g.media.mediaType==="video":g.media.mediaType==="audio"),p=o[0].attributes.label,m=o[0].attributes.mslabel;return u.attributes.ssrcs=u.attributes.ssrcs.concat(o),u.attributes.ssrcGroups=u.attributes.ssrcGroups.concat(l),{id:p,mslabel:m}}batchSend(t){return t.map(n=>{let{kind:i,ssrcMsg:o}=n;return this.send(i,o,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],o=[],l=[];n.attributes.ssrcs.forEach(u=>{fe(t).call(t,u.attributes.label||"")?l.push(u):i.push(u)}),n.attributes.ssrcGroups.forEach(u=>{var p;fe(p=l.map(m=>m.ssrcId)).call(p,u.ssrcIds[0])||o.push(u)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=o})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,i){t.forEach((o,l)=>{const u=o._mediaStreamTrack,p=this.sessionDesc.mediaDescriptions.findIndex(g=>g.attributes.mid===u.kind),m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],o);this.sessionDesc.mediaDescriptions[p]=m})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(o=>o.transport==="udp"),i=[];if(n.forEach(o=>{i.push(C6(C6({},o),{},{foundation:"tcpcandidate",priority:Number(o.priority)-1+"",transport:"tcp",port:Number(o.port)+90+""}))}),n.length!==0){switch(t){case Ir.TCP_RELAY:this.candidates=i;break;case Ir.UDP_TCP_RELAY:case Ir.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const o of this.sessionDesc.mediaDescriptions)o.attributes.candidates=this.candidates}}restartICE(t){t=xn(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(t,n){const i=xn(t);return _u(i,n),tR(i,n),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=o}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,i){const o=this.sessionDesc.mediaDescriptions.find(u=>t===Me.VIDEO?u.attributes.mid==="video":u.attributes.mid==="audio");if(o){const u=o.attributes.ssrcs.find(p=>p.attributes.label===n);var l;u&&(u.attributes.label=i,(l=u.attributes.msid)===null||l===void 0||l.replace(n,i))}}mungMediaDesc(t){const n=xn(t);return eR(n),function(i){const o=i.attributes.extmaps.find(l=>bE(l.extensionName));o&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(o),1),i.attributes.payloads.forEach(l=>{const u=l.rtcpFeedbacks.findIndex(p=>p.type==="transport-cc");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===t)return[i]}}var fn;function R6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function nv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?R6(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R6(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Vhe=(fn=class qg extends gE{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return fe(n=Object.keys(ou)).call(n,t)}))]}constructor(t,n){super(t,n),D(this,"store",void 0),D(this,"peerConnection",void 0),D(this,"remoteSDP",void 0),D(this,"initialOffer",void 0),D(this,"statsFilter",void 0),D(this,"useRTX",!1),D(this,"localCapabilities",void 0),D(this,"localCandidateCount",0),D(this,"allCandidatesReceived",!1),D(this,"establishPromise",void 0),D(this,"mutex",void 0),this.store=n,this.mutex=new Ar("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(qg.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Gy(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,Sn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=cc(t.sdp),i=Yf(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:$("FILTER_VIDEO_FEC"),filterAudioFec:$("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=t,nv(nv({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new oe(G.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Uhe(nv(nv({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new oe(G.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var i=this;return Ls(function*(){const o=yield Tt(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=t.map(S=>i.peerConnection.addTrack(S._mediaStreamTrack)),u=yield Tt(i.peerConnection.createOffer()),p=Ns(u.sdp),m=t.map(S=>{const w=S._mediaStreamTrack,k=p.mediaDescriptions.find(I=>I.attributes.mid===w.kind);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return function(I,O,W){const H=I.attributes.ssrcs.filter(Q=>Q.attributes.label===O),Y=I.attributes.ssrcGroups;if(H.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(Y&&H.length>1){const Q=Y.find(Z=>Z.ssrcIds.indexOf(H[0].ssrcId)!==-1);return Q?[{ssrcId:Q.ssrcIds[0],rtx:W?Q.ssrcIds[1]:void 0}]:[{ssrcId:H[0].ssrcId}]}return[{ssrcId:H[0].ssrcId}]}(k,w.id,i.useRTX)});let g;try{g=yield m}catch(S){throw l.forEach(w=>{Nr()&&w.replaceTrack(null),i.peerConnection.removeTrack(w)}),S}const y=i.mungSendOfferSDP(u.sdp,t);i.remoteSDP.receive(t,n,g);const b=i.remoteSDP.toString();return yield Tt(i.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield Tt(i.applySendEncodings(l,t)),yield Tt(i.peerConnection.setRemoteDescription({type:"answer",sdp:b})),t.map((S,w)=>{const k=S._mediaStreamTrack.id;return{localSSRC:m[w],id:k}})}catch(l){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{o()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(l=>{var u;return t.indexOf(((u=l.track)===null||u===void 0?void 0:u.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(l=>{Nr()&&l.replaceTrack(null),this.peerConnection.removeTrack(l)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:l,mslabel:u}=this.remoteSDP.send(t,n,o),p=new xe((y,b)=>{const S=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(l)))},1e4),w=k=>{const I=Ft();if((I.name==="Safari"&&Number(I.version)===11||ds())&&k.track.id!==l&&k.streams[0].id===u){var O;const W=k.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(t,l,k.track.id),this.peerConnection.removeEventListener("track",w),clearTimeout(S),void y(W)}if(k.track.id===l)return this.peerConnection.removeEventListener("track",w),clearTimeout(S),void y(k.track)};this.peerConnection.addEventListener("track",w)}),m=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});const g=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(g),{track:await p,id:l}}catch(l){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var o;return t.indexOf(((o=i.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(Nr()&&i.track)i.track.enabled=!1;else{const o=i.getParameters();o.encodings.forEach(l=>l.active=!1),i.setParameters(o)}})}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(l=>{var u;return t.indexOf(((u=l.track)===null||u===void 0?void 0:u.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async l=>{if(Nr()&&l.track)l.track.enabled=!0;else{const u=l.getParameters();u.encodings.forEach(p=>p.active=!0),await l.setParameters(u)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Ls(function*(){const i=yield Tt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const o=It().supportPCSetConfiguration;if(t===Ir.RELAY&&!o)return;if(o){const g=n.peerConnection.getConfiguration(),y=t===Ir.RELAY?"relay":"all";g.iceTransportPolicy!==y&&(C.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(g.iceTransportPolicy,"] to [").concat(y,"]")),g.iceTransportPolicy=y,n.peerConnection.setConfiguration(g))}t!==Ir.RELAY&&n.remoteSDP.updateCandidates(t);const l=yield Tt(n.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=cc(l.sdp),{remoteIceParameters:p}=yield u.iceParameters;n.remoteSDP.restartICE(p);const m=n.remoteSDP.toString();yield Tt(n.peerConnection.setLocalDescription(l)),yield Tt(n.peerConnection.setRemoteDescription({type:"answer",sdp:m}))}catch(o){C.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new oe(G.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getSenders().filter(o=>{var l;return((l=o.track)===null||l===void 0?void 0:l.id)===t});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getSenders().find(o=>{var l;return((l=o.track)===null||l===void 0?void 0:l.id)===n});i&&await i.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new oe(G.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new oe(G.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},$("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Zd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...qg.turnServerConfigToIceServers(t.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...qg.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(g=>{var y;return((y=g.track)===null||y===void 0?void 0:y.id)===t._mediaStreamTrack.id})),!n)return C.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!It().supportSetRtpSenderParameters)return C.warn("Browser not support set rtp-sender parameters");const o={},l={};if(t instanceof pn)switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if($("DSCP_TYPE")&&nc()){var u;const g=$("DSCP_TYPE");fe(u=["very-low","low","medium","high"]).call(u,g)&&(l.networkPriority=g)}const p=n.getParameters(),m=(i=p.encodings)===null||i===void 0?void 0:i[0];m&&Object.assign(m,l),Object.assign(p,o),C.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await n.setParameters(p)}async applySendEncodings(t,n){try{if(!It().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const o=t[i],l=n[i];o&&l&&await this.updateRtpSenderEncodings(l,o)}}catch{C.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const i=Ns(t);return n.forEach((o,l)=>{const u=o._mediaStreamTrack,p=i.mediaDescriptions.find(m=>m.attributes.mid===u.kind);p&&_u(p,o)}),Gc(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((l,u)=>{let{id:p,mslabel:m}=l;const{kind:g}=t[u];return new xe((y,b)=>{const S=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(p)))},1e4),w=k=>{const I=Ft();if(I.name==="Safari"&&Number(I.version)===11&&k.track.id!==p&&k.streams[0].id===m){var O;const W=k.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(g,p,k.track.id),this.peerConnection.removeEventListener("track",w),clearTimeout(S),void y({track:W,id:p})}if(k.track.id===p)return this.peerConnection.removeEventListener("track",w),clearTimeout(S),void y({track:k.track,id:p})};this.peerConnection.addEventListener("track",w)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),await xe.all(n)}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(It().supportPCSetConfiguration){const n=qg.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},we(fn.prototype,"connect",[lo],Object.getOwnPropertyDescriptor(fn.prototype,"connect"),fn.prototype),we(fn.prototype,"stopSending",[lo],Object.getOwnPropertyDescriptor(fn.prototype,"stopSending"),fn.prototype),we(fn.prototype,"receive",[lo],Object.getOwnPropertyDescriptor(fn.prototype,"receive"),fn.prototype),we(fn.prototype,"stopReceiving",[lo],Object.getOwnPropertyDescriptor(fn.prototype,"stopReceiving"),fn.prototype),we(fn.prototype,"muteRemote",[lo],Object.getOwnPropertyDescriptor(fn.prototype,"muteRemote"),fn.prototype),we(fn.prototype,"unmuteRemote",[lo],Object.getOwnPropertyDescriptor(fn.prototype,"unmuteRemote"),fn.prototype),we(fn.prototype,"muteLocal",[lo],Object.getOwnPropertyDescriptor(fn.prototype,"muteLocal"),fn.prototype),we(fn.prototype,"unmuteLocal",[lo],Object.getOwnPropertyDescriptor(fn.prototype,"unmuteLocal"),fn.prototype),we(fn.prototype,"close",[lo],Object.getOwnPropertyDescriptor(fn.prototype,"close"),fn.prototype),we(fn.prototype,"updateEncoderConfig",[lo],Object.getOwnPropertyDescriptor(fn.prototype,"updateEncoderConfig"),fn.prototype),we(fn.prototype,"updateSendParameters",[lo],Object.getOwnPropertyDescriptor(fn.prototype,"updateSendParameters"),fn.prototype),we(fn.prototype,"replaceTrack",[lo],Object.getOwnPropertyDescriptor(fn.prototype,"replaceTrack"),fn.prototype),we(fn.prototype,"getRemoteSSRC",[lo],Object.getOwnPropertyDescriptor(fn.prototype,"getRemoteSSRC"),fn.prototype),fn);function lo(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("Locking from P2PConnection.".concat(t));try{for(var u=arguments.length,p=new Array(u),m=0;m<u;m++)p[m]=arguments[m];return await i.apply(this,p)}finally{l()}},n}const Fhe={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new Vhe(n,t)}},Bhe={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!It().supportWebRTCEncodedTransform)return void C.warning("browser not support audio encoded transform");if(rE.has(e)||!e.track)return;const n={track:e.track};if($c()){if(!e.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(u){return void C.error("create audio-encoded-streams error",u&&u.message)}const l=new TransformStream({transform(u,p){n.controller||(n.controller=p),e.track&&e.track.id!==n.track.id&&(C.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const m=t.metadata&&t.metadata();m?function(g,y){const{chunk:b,controller:S}=y,w=kl.METADATA;b.data=function(k,I,O){const W=O.byteLength,H=W+PC+SV,Y=IC+OC+H,Q=new ArrayBuffer(k.byteLength+Y),Z=new DataView(Q);Z.setUint8(0,bV),Z.setUint16(1,H),Z.setUint8(3,I),Z.setUint16(4,W);for(let ee=0;ee<W;ee++)Z.setUint8(6+ee,O[ee]);const q=new Uint8Array(Z.buffer);return q.set(new Uint8Array(k),Y),q.buffer}(b.data,w,g),S.enqueue(b)}(m,{sender:e,chunk:u,controller:p}):p.enqueue(u)}});o.readable.pipeThrough(l).pipeTo(o.writable)}else if(Nr()){if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");const o=nE(),l=new MessageChannel;await new xe(p=>o.onmessage=m=>{m.data==="registered"&&p(void 0)});const u=new RTCRtpScriptTransform(o,{name:"audio-metadata-tx",port:l.port2},[l.port2]);e.transform=u,await new xe(p=>o.onmessage=m=>{m.data==="started"&&p(void 0)}),l.port1.onmessage=p=>{var m;if(p.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id)C.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i);else if(p.data.getMetadata){const g=t.metadata&&t.metadata();g&&l.port1.postMessage({metadata:g})}},n.worker=o}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const o=rE.get(e);if(o){rE.delete(e);try{var l,u;(l=o.controller)===null||l===void 0||l.terminate(),(u=o.worker)===null||u===void 0||u.terminate()}catch(p){C.warning(p&&p.message)}}}rE.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!It().supportWebRTCEncodedTransform)return void C.warning("browser not support audio encoded transform");if(lE.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if($c()&&!ds()){if(!e.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");BT(Ht.CHROME,87,116)||(t.enableTopn=!1);let o=null;try{o=e.createEncodedStreams()}catch(u){return void C.error("create audio-encoded-streams error",u&&u.message)}const l=new TransformStream({transform(u,p){n.controller||(n.controller=p),e.track&&e.track.id!==n.track.id&&(C.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)),t.enableTopn?function(m,g,y){var b;const S=DC(new DataView(g.data));if(!S)return y.enqueue(g);const w=m.track.id;yle.set(w,m.track);const k=(b=S.tlv.find(Q=>Q.tag===kl.AUDIO_LEVEL))===null||b===void 0?void 0:b.value;let I=0;typeof k=="number"&&(I=127-k);const O=Math.round(Math.pow(10,I/60)-1),{selected:W,speaker:H}=function(Q,Z){let q=yp.get(Q);if(q||(q=function(ee){const ce=new wV;return yp.set(ee,ce),fa||(fa=new gle($("TOPN_SILENCE_THRESHOLD")||500),fa.on("ActiveSpeakerChanged",me=>{me!=null&&(oE=me)})),fa.addSpeakers([ce]),ce}(Q)),yp.size<=TV)return{selected:!0,speaker:q};if(!fa)throw new Error("no active speaker detector");return fa.levelChanged(q.id,Z),hu=fa.loudest.map(ee=>ee.id),oE&&!fe(hu).call(hu,oE)&&hu.length>=TV&&hu.pop(),{selected:fe(hu).call(hu,q.id)||q.id===oE,speaker:q}}(m,O),Y=function(Q,Z,q){const ee=ga.get(Q)||new _le(Q,Z);return ee.score=q,ga.set(Q,ee),function(ce){if(aE.set(ce,!0),!cE)return void(cE=Date.now());const me=Date.now();me-cE>1e3&&(aE.get(ce)?aE.set(ce,!1):(CV(ce),aE.delete(ce)),cE=me)}(Q),ee}(w,m.track,H.energyScore);Y.addSample(W),Y.active&&(g.data=S.frame.buffer,y.enqueue(g))}(e,u,p):t.enableMetadata||t.enablePts?function(m,g,y,b){const S=new DataView(m.data),w=S.getUint8(0);let k;if(128&w&&w!==71){const W=function(H){if(H.byteLength<=0)return[];const Y=[];let Q=0;for(;Q<H.byteLength;){const q=(128&H.getUint8(Q))>>7,ee=127&H.getUint8(Q);if(!(q&&Q+4<=H.byteLength)){Q++;break}{const ce=H.getUint32(Q,!1),me=(16776192&ce)>>10,Oe=1023&ce;Y.push({pt:ee,ts_offset:me,length:Oe,data:new Uint8Array}),Q+=4}}let Z=H.byteLength-Q;for(const q of Y){if(q.length>Z)return console.warn("Broken red payload"),[];q.length>0&&(q.data=new Uint8Array(H.buffer,H.byteOffset+Q,q.length),Q+=q.length,Z-=q.length)}if(Z>0){const q={pt:Y.length>0?Y[Y.length-1].pt:0,ts_offset:0,length:Z,data:new Uint8Array(H.buffer,H.byteOffset+Q,Z)};Y.push(q)}return Y}(S);if(W.length>0){const H=function(Y){let Q=0;for(let ee=0;ee<Y.length;ee++)Q+=ee<Y.length-1?4:1,Q+=Y[ee].length;const Z=new Uint8Array(Q);let q=0;for(let ee=0;ee<Y.length;ee++)if(ee<Y.length-1){const ce=(2147483648|(127&Y[ee].pt)<<24|(262143&Y[ee].ts_offset)<<10|1023&Y[ee].length)>>>0;Z[q++]=ce>>24&255,Z[q++]=ce>>16&255,Z[q++]=ce>>8&255,Z[q++]=255&ce}else Z[q++]=127&Y[ee].pt;for(const ee of Y)Z.set(ee.data,q),q+=ee.length;return Z}(W.map(Y=>{const Q=new Uint8Array(Y.length);Q.set(Y.data);const Z=DC(new DataView(Q.buffer));return Z!=null&&Z.frame&&(Y.data=Z==null?void 0:Z.frame),k=Z,Y}));m.data=H.buffer}}else k=DC(S),k&&(m.data=k.frame.buffer);if(g.enqueue(m),!k)return;const I=k.tlv.find(W=>W.tag===kl.METADATA);I&&y&&I.value instanceof Uint8Array&&y(I.value);const O=k.tlv.find(W=>W.tag===kl.AUDIO_64_BIT_PTS);O&&b&&O.value instanceof Uint8Array&&O.value.length==8&&b(new DataView(O.value.buffer).getBigUint64(0,!0))}(u,p,t.onMetadata,t.onPts):p.enqueue(u)}});o.readable.pipeThrough(l).pipeTo(o.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");const o=nE(),l=new MessageChannel;await new xe(p=>o.onmessage=m=>{m.data==="registered"&&p(void 0)});const u=new RTCRtpScriptTransform(o,{name:"audio-metadata-rx",port:l.port2},[l.port2]);e.transform=u,await new xe(p=>o.onmessage=m=>{m.data==="started"&&p(void 0)}),l.port1.onmessage=p=>{var m;p.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id?(C.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)):p.data.metadata&&n.onMetadata?n.onMetadata(p.data.metadata):p.data.pts&&n.onPts&&n.onPts(p.data.pts)},n.worker=o}function i(){e.track.removeEventListener("ended",i),function(o){const l=lE.get(o);if(l){(function(m){const g=yp.get(m);g&&(yp.delete(m),fa&&(fa.removeSpeakers([g]),yp.size===0&&(fa.destroy(),fa=null)))})(o),CV(o.track.id),lE.delete(o);try{var u,p;(u=l.controller)===null||u===void 0||u.terminate(),(p=l.worker)===null||p===void 0||p.terminate()}catch(m){C.warning(m&&m.message)}}}(e)}lE.set(e,n),e.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(e,t){if(!It().supportWebRTCEncodedTransform)return void C.warning("browser not support video encoded transform");if(dE.has(e)||!e.track)return;const n={track:e.track};if($c()){if(!e.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(p){return void C.error("create video-encoded-streams error",p&&p.message)}const l=[];t.on("sei-to-send",p=>{l.push(p)});const u=new TransformStream({transform(p,m){n.controller||(n.controller=m),e.track&&e.track.id!==n.track.id&&(C.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const g=AV(new Uint8Array(p.data)),y=l.shift();if(y){const b=function(S,w,k){switch(k){case jC:return function(I,O){const W=NV(O),H=W.length,Y=Math.floor(H/255),Q=H%255,Z=new Uint8Array(6+Y+1+H+I.byteLength);Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=1,Z[4]=6,Z[5]=101;let q=0;for(;q<Y;)Z[6+q]=255,q++;return Z[6+q]=Q,q++,Z.set(W,6+q),Z.set(new Uint8Array(I),6+q+H),Z.buffer}(S,w);case UC:return function(I,O){const W=NV(O),H=W.length,Y=Math.floor(H/255),Q=H%255,Z=new Uint8Array(7+Y+1+H+1+I.byteLength);Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=1,Z[4]=78,Z[5]=1,Z[6]=101;let q=0;for(;q<Y;)Z[7+q]=255,q++;return Z[7+q]=Q,q++,Z.set(W,7+q),q+=H,Z[7+q]=128,q++,Z.set(new Uint8Array(I),7+q),Z.buffer}(S,w);default:return null}}(p.data,y,g);b&&(p.data=b)}m.enqueue(p)}});o.readable.pipeThrough(u).pipeTo(o.writable)}else{if(!Nr())return;{if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");const o=nE(),l=new MessageChannel;await new xe(p=>o.onmessage=m=>{m.data==="registered"&&p(void 0)});const u=new RTCRtpScriptTransform(o,{name:"sei-tx",port:l.port2},[l.port2]);e.transform=u,await new xe(p=>o.onmessage=m=>{m.data==="started"&&p(void 0)}),t.on("sei-to-send",p=>{l.port1.postMessage({sei:p})}),l.port1.onmessage=p=>{var m;p.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id&&(C.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i))},n.worker=o}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const o=dE.get(e);if(o){dE.delete(e);try{var l,u;(l=o.controller)===null||l===void 0||l.terminate(),(u=o.worker)===null||u===void 0||u.terminate()}catch(p){C.warning(p&&p.message)}}}dE.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!It().supportWebRTCEncodedTransform)return void C.warning("browser not support video encoded transform");if(!e.track)return;if(Gf.has(e)){const o=Gf.get(e);return void(o&&(o.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if($c()){if(!e.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(u){return void C.error("create video-encoded-streams error",u&&u.message)}const l=new TransformStream({transform(u,p){if(n.controller||(n.controller=p),!n.firstFrameInfo){var m;const y=u.getMetadata()||{};n.firstFrameInfo=En({type:u.type,rtpTimestamp:u.timestamp,payloadType:y.payloadType||0,ssrc:y.synchronizationSource||0,length:u.data.byteLength},"mimeType"in y?{mimeType:y.mimeType}:{}),(m=t.onFirstFrame)===null||m===void 0||m.call(t,n.firstFrameInfo)}e.track&&e.track.id!==n.track.id&&(C.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const g=function(y,b){switch(b){case jC:return function(S){const w=new DataView(S.data);let k=0;for(;k+4<S.data.byteLength;){if(w.getUint8(k+0)===0&&w.getUint8(k+1)===0&&w.getUint8(k+2)===0&&w.getUint8(k+3)===1&&w.getUint8(k+4)===6){let I=k+6,O=0,W=0;for(;(W=w.getUint8(I++))===255;)O+=255;O+=W;const H=RV(S.data,I,O);return new Uint8Array(H)}k++}return null}(y);case UC:return function(S){const w=new DataView(S.data);let k=0;for(;k+5<S.data.byteLength;){if(w.getUint8(k+0)===0&&w.getUint8(k+1)===0&&w.getUint8(k+2)===0&&w.getUint8(k+3)===1&&w.getUint8(k+4)===78&&w.getUint8(k+5)===1&&w.getUint8(k+6)===101){let I=k+7,O=0,W=0;for(;(W=w.getUint8(I++))===255;)O+=255;O+=W;const H=RV(S.data,I,O);return new Uint8Array(H)}k++}return null}(y);default:return null}}(u,AV(new Uint8Array(u.data)));g&&n.onSei&&n.onSei(g),p.enqueue(u)}});o.readable.pipeThrough(l).pipeTo(o.writable)}else if(Nr()){if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");const o=nE(),l=new MessageChannel;await new xe(p=>o.onmessage=m=>{m.data==="registered"&&p(void 0)});const u=new RTCRtpScriptTransform(o,{name:"sei-rx",port:l.port2},[l.port2]);e.transform=u,await new xe(p=>o.onmessage=m=>{m.data==="started"&&p(void 0)}),l.port1.onmessage=p=>{var m;if(p.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id)C.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i);else if(p.data.sei&&n.onSei)n.onSei(p.data.sei);else if(p.data.firstFrameInfo&&t.onFirstFrame){var g;(g=t.onFirstFrame)===null||g===void 0||g.call(t,p.data.firstFrameInfo)}},n.worker=o}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}(function(o){const l=Gf.get(o);if(l){Gf.delete(o);try{var u,p;(u=l.controller)===null||u===void 0||u.terminate(),(p=l.worker)===null||p===void 0||p.terminate()}catch(m){C.warning(m&&m.message)}}})(e)}Gf.set(e,n),e.track.addEventListener("ended",i)}},$he={name:"InterceptFrame",create:()=>Bhe};var Ut;function N6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Ta(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?N6(Object(n),!0).forEach(function(i){D(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N6(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Whe=(Ut=class Kp extends gE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return fe(n=Object.keys(ou)).call(n,t)}))]}constructor(t,n,i){super(t,n),D(this,"id",Zt(5,"connection-")),D(this,"store",void 0),D(this,"peerConnection",void 0),D(this,"forceTurn",!1),D(this,"remoteSDP",void 0),D(this,"initialOffer",void 0),D(this,"transportEventReceiver",void 0),D(this,"statsFilter",void 0),D(this,"extension",{useXR:$("USE_XR")}),D(this,"localCapabilities",void 0),D(this,"remoteCodecs",void 0),D(this,"localCandidateCount",0),D(this,"allCandidatesReceived",!1),D(this,"isPreallocation",!1),D(this,"preMediaMap",new Map),D(this,"dataStreamChannelMap",new Map),D(this,"establishPromise",void 0),D(this,"recoveredDataChannelIds",[]),D(this,"currentDataChannelId",1),D(this,"supportAV1RtpSpec",!1),D(this,"mutex",void 0),D(this,"qualityLimitationReason",op.NONE),D(this,"isFirstConnected",!1),this.store=n,this.forceTurn=bR(t),this.mutex=new Ar("NVConnectionExtension-mutex",n.clientId),this.peerConnection=i,this.isFirstConnected=!1,this.statsFilter=Gy(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,Sn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void C.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const l=this.remoteSDP.toString();o==null||o(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else C.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=cc(n.sdp),o=await rR({filterRTX:!$("USE_PUB_RTX")&&!$("USE_SUB_RTX"),filterVideoFec:$("FILTER_VIDEO_FEC"),filterAudioFec:$("FILTER_AUDIO_FEC"),filterVideoCodec:$("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:$("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:$("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Xf(o),this.initialOffer=n,$("ENABLE_SVC")&&this.store.codec=="av1"){const u=await r4();var t;u&&(this.supportAV1RtpSpec=!0,(t=o.send)===null||t===void 0||t.videoExtensions.push(u))}let l;return n.sdp&&xE(n.sdp)&&(l=xn(o),qV(l)),Ta(Ta({},i),{},{rtpCapabilities:l||o,offerSDP:n.sdp})}catch(n){throw new oe(G.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&xE(this.initialOffer.sdp)&&XV(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new N4(Ta(Ta({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!$("ENABLE_PRE_SUB_WITH_PRE_PC")||!$("PRE_USE_LOCAL_CODECS"))&&Bf(this.store),!0),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const n=this.remoteSDP.toString(),i=sR(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(i||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o==null||o(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),Bf(this.store))if(t.preallocation&&$("ENABLE_PRE_SUB_WITH_PRE_PC")){const u=$("PRE_SUB_NUM"),{mids:p,preSSRCs:m}=this.remoteSDP.preloadRemoteMedia(u);await Zs(this.peerConnection,this.remoteSDP,this.extension),C.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(m)),this.presetMedia(p,m)}else{const{preSSRCs:u=[]}=t,p=u.map(g=>g.ssrcMsg[0].ssrcId);if(u.length===0)return;const{mids:m}=this.remoteSDP.batchSend(u.map(g=>Object.assign({},g)));await Zs(this.peerConnection,this.remoteSDP,this.extension),C.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(p)),this.presetMedia(m,p)}}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(n.toString()))}}presetMedia(t,n){t.forEach((i,o)=>{this.peerConnection.getTransceivers().forEach(l=>{if(l.mid!=null&&i===l.mid&&l.receiver.track){const u=l.receiver.track;let p;u.kind==="video"&&$("ENABLE_PRE_RENDER")&&(p=new eE({trackId:"track-".concat(u.kind,"-unknown-").concat(this.store.clientId,"_").concat(Zt(5,""))},!0),p.updateVideoTrack(u),p.onFirstVideoFrameRender=()=>{var m;const g=this.preMediaMap.get(n[o]);g&&(g.firstVideoRender=Date.now()),(m=this.onFirstVideoRender)===null||m===void 0||m.call(this,n[o])},p.onVideoBufferReady=()=>{var m;(m=this.onFirstVideoBufferReady)===null||m===void 0||m.call(this,n[o])},p.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[o],{mid:i,track:u,player:p,transceiver:l})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:i}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const u=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||u}const{preSSRCs:o=[]}=t,l=o.map(u=>u.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(l)){const u=[],p=[];if(Array.from(this.preMediaMap.entries()).every(m=>{let[g,{mid:y,player:b,track:S}]=m;return u.push(y),p.push(g),this.preMediaMap.delete(g),b&&b.destroy(),!0}),u.length>0&&(this.remoteSDP.stopSending(u),await Zs(this.peerConnection,this.remoteSDP,this.extension),C.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(p)),Ue.reportApiInvoke(this.store.sessionId,{name:Rn.PRELOAD_MEDIA_FAILED,options:[o,p],tag:hn.TRACER}).onSuccess()),o.length>0){const{mids:m}=this.remoteSDP.batchSend(o.map(g=>Object.assign({},g)));await Zs(this.peerConnection,this.remoteSDP,this.extension),C.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(l)),this.presetMedia(m,l)}}n?(await Zs(this.peerConnection,this.remoteSDP,this.extension),C.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):C.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,i){var o=this;return Ls(function*(){const l=yield Tt(o.mutex.lock("From NVConnectionExtension.send"));try{if(!o.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");const u=[],p=zf();t.forEach(O=>{const W=o.peerConnection.addTransceiver(O._mediaStreamTrack,Ta({direction:"sendonly"},O.trackMediaType==="video"&&o.supportAV1RtpSpec&&p?{sendEncodings:[{scalabilityMode:p}]}:{}));u.push(W),O._updateRtpTransceiver(W)}),Sn()&&$("SIMULCAST")===!0&&(yield Tt(o.applySimulcastForFirefox(u,t)));const m=yield Tt(o.peerConnection.createOffer()),g=o.remoteSDP.predictReceivingMids(t.length),y=o.mungSendOfferSDP(m.sdp,t,g),b=Ns(y),S=g.map(O=>{const W=b.mediaDescriptions.find(H=>H.attributes.mid===O);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return ZC(W,$("USE_PUB_RTX"))});let w;try{w=yield S}catch(O){w=[],o.remoteSDP.receive(t,n,i,w);const W=o.remoteSDP.toString();throw yield Tt(o.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield Tt(o.peerConnection.setRemoteDescription({type:"answer",sdp:W})),yield Tt(o.stopSending(g,!0)),O}o.remoteSDP.receive(t,n,i,w);const k=o.remoteSDP.toString(),I=o.logSDPExchange(y,"offer","local","send");return yield Tt(o.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield Tt(o.applySimulcastEncodings(u,t)),yield Tt(o.applySendEncodings(u,t)),I==null||I(k),yield Tt(o.peerConnection.setRemoteDescription({type:"answer",sdp:k})),u.map((O,W)=>{const H=g[W];return{localSSRC:S[W],id:H,transceiver:O}})}catch(u){throw u instanceof oe?u:new oe(G.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(u.toString()))}finally{l()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")C.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{const l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:$("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}n.forEach(l=>{l._updateOriginDataChannel(i)});const{needExchangeSDP:o}=this.remoteSDP.sendDataChannel();if(o){const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const u=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(u),C.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else C.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof oe?i:new oe(G.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof oe?n:new oe(G.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");o.map(m=>{var g;Ap(this.id+m.mid,this),m.direction="inactive",(g=m.stop)===null||g===void 0||g.call(m)});const l=await this.peerConnection.createOffer(),u=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const p=this.remoteSDP.toString();u==null||u(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(o){throw new oe(G.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:u}=this.remoteSDP.send(t,n,i,o);u&&(await Zs(this.peerConnection,this.remoteSDP,this.extension),C.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(t," by exchanging SDP.")));const p=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!p)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,id:l,transceiver:p}}catch(l){throw new oe(G.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);return i&&(await Zs(this.peerConnection,this.remoteSDP,this.extension),C.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),n.map(o=>{const l=this.peerConnection.getTransceivers().find(u=>u.mid===o);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:o,transceiver:l}})}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");t.forEach(l=>{Array.from(this.preMediaMap.entries()).some(u=>{let[p,{mid:m,player:g}]=u;if(m===l)return this.preMediaMap.delete(p),g&&g.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(u=>{u.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();o==null||o(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(u,p)=>{u.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString();o==null||o(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new oe(G.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Ls(function*(){const i=yield Tt(n.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const o=It().supportPCSetConfiguration,l=$("FORCE_TURN_TCP")||n.forceTurn;if(t===Ir.RELAY&&!o)return;if(o&&!l){const b=t===Ir.RELAY?"relay":"all",S=n.peerConnection.getConfiguration();S.iceTransportPolicy!==b&&(C.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(b,"]")),S.iceTransportPolicy=b,n.peerConnection.setConfiguration(S))}n.remoteSDP.updateCandidates(t);const u=yield Tt(n.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const p=cc(u.sdp),{remoteIceParameters:m}=yield p.iceParameters;n.remoteSDP.restartICE(m);const g=n.remoteSDP.toString(),y=n.logSDPExchange(u.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Tt(n.peerConnection.setLocalDescription(u)),y==null||y(g),yield Tt(n.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(o){C.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(Ir.TCP_RELAY),await Zs(this.peerConnection,this.remoteSDP,this.extension)}catch(n){C.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{Ap(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:i}=n;i&&i.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Ta(Ta({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const l=this.remoteSDP.toString(),u=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),u==null||u(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new oe(G.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===t);i.length===1&&(this.isVP8Simulcast(n)?Sn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(o=>o.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:o}=n.getSelectedCandidatePair();return{local:Ta(Ta({},Lo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Ta(Ta({},Lo),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const i="code: ".concat(t.errorCode,", message: ").concat(t.errorText),o=t.port?"local: ".concat(t.port):"",l=ac(t.url||"");C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(i,"), url: ").concat(l||"",", host_candidate:").concat(o)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},$("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},i=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(Zd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:$("NEW_TURN_MODE")&&n.iceServers&&i==="disabled"?($("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...Kp.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...Kp.newTurnServerConfigToIceServers(t.turnServer.servers)),$("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Kp.turnServerConfigToIceServers(t.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Kp.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),$("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(n.iceTransportPolicy="relay")}))),$("ENABLE_ENCODED_TRANSFORM")&&It().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Fo(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!$("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{const o=$("NEW_TURN_MODE");o===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):o===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):o===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Fo(i.turnServerURL),":443?transport=tcp")}):o===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Fo(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in o?o.error:o)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const o=n==null?void 0:n.iceTransport.state;var l;o&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:l}=i.getSelectedCandidatePair()||{};if(o&&l){const u=o.address+":"+o.port,p=l.address+":"+l.port;C.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(ac(u)),", remote ").concat(JSON.stringify(ac(p))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i,o;if(n||(n=this.peerConnection.getSenders().find(O=>O.track===t._mediaStreamTrack)),!n)return C.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return C.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!It().supportSetRtpSenderParameters)return C.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},u={};switch(t._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}const p=zV(this.peerConnection,t._mediaStreamTrack),m=MU(t);if(k4(t)&&p&&n&&m&&this.getLocalVideoStats&&fe(i=["vp8","vp9"]).call(i,this.store.codec)){var g;const I=l.degradationPreference||(fe(g=t._hints).call(g,Xt.CUSTOM_TRACK)?$("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");L4(this.id+p.mid,m,this,I,O=>{n&&this.updateAdaptation(n,O)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var y;const{bitrateMax:I,frameRate:O,scaleResolutionDownBy:W}=t._encoderConfig;I&&(u.maxBitrate=1e3*I),(fe(y=t._hints).call(y,Xt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(O&&(u.maxFramerate=Fs(O)),W&&W>=1&&(u.scaleResolutionDownBy=W))}const{maxFramerate:b}=$("ENCODER_CONFIG_LIMIT");if(b&&typeof b=="number"&&(u.maxFramerate=u.maxFramerate?Math.min(u.maxFramerate,b):b),$("DSCP_TYPE")&&nc()){var S;const I=$("DSCP_TYPE");fe(S=["very-low","low","medium","high"]).call(S,I)&&(u.networkPriority=I)}const w=n.getParameters(),k=(o=w.encodings)===null||o===void 0?void 0:o[0];Sn()&&!k&&(l.encodings=[u]),k&&Object.assign(k,u),Object.assign(w,l),C.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(w.encodings))),await n.setParameters(w),await o4(this.store.codec,n,$("SVC_MODE"))}async updateAdaptation(t,n){var i,o;if(!t)return C.debug("[updateAdaptation] no rtpSender found");if(!It().supportSetRtpSenderParameters)return C.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const l={},{bitrateMax:u,frameRate:p,scaleResolutionDownBy:m}=n;u&&(l.maxBitrate=1e3*u),p&&(l.maxFramerate=Fs(p)),m&&m>=1&&fe(i=["vp8","vp9"]).call(i,this.store.codec)&&(l.scaleResolutionDownBy=m);const g=t.getParameters(),y=(o=g.encodings)===null||o===void 0?void 0:o[0];y&&Object.assign(y,l),Object.assign(g,{});try{await t.setParameters(g),C.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(g.encodings)))}catch(b){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?C.debug("[updateAdaptation] peerConnection not connected}"):C.debug("[updateAdaptation] updateRtpSenderEncodings failed",b):C.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!It().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const o=t[i],l=n[i];l instanceof pn&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,o.sender)}}catch{C.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const o=Ns(t);return n.forEach((l,u)=>{const p=i[u],m=o.mediaDescriptions.find(g=>g.attributes.mid===p);m&&(_u(m,l),nR(m,l,this.store.codec))}),Gc(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let m=0;m<t.length;m++){var i,o,l,u,p;const g=t[m],y=n[m];if(y instanceof pn&&!fe(i=y._hints).call(i,Xt.LOW_STREAM)&&(o=y._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((l=y._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(u=y._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((p=y._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){const b={},S={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const w=g.sender.getParameters();await g.sender.setParameters(Object.assign(w,b))}}}async applySimulcastEncodings(t,n){if(!Sn()&&t.length===n.length)for(let i=0;i<t.length;i++){const o=n[i];if(o instanceof pn&&this.isVP8Simulcast(o)){const l=t[i],u={},p={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];const m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,u))}}}isVP8Simulcast(t){var n,i,o,l,u;return!!(t instanceof pn&&$("SIMULCAST")&&this.store.codec==="vp8"&&!fe(n=t._hints).call(n,Xt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=t._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(t,n,i,o){if($("SDP_LOGGING"))return C.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during NVConnectionExtension.").concat(o,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",i==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(It().supportPCSetConfiguration){const n=Kp.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},we(Ut.prototype,"updateRemoteRTPCapabilities",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"updateRemoteRTPCapabilities"),Ut.prototype),we(Ut.prototype,"connect",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"connect"),Ut.prototype),we(Ut.prototype,"updateRemoteConnect",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"updateRemoteConnect"),Ut.prototype),we(Ut.prototype,"createDataChannels",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"createDataChannels"),Ut.prototype),we(Ut.prototype,"receive",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"receive"),Ut.prototype),we(Ut.prototype,"batchReceive",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"batchReceive"),Ut.prototype),we(Ut.prototype,"stopReceiving",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"stopReceiving"),Ut.prototype),we(Ut.prototype,"muteRemote",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"muteRemote"),Ut.prototype),we(Ut.prototype,"unmuteRemote",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"unmuteRemote"),Ut.prototype),we(Ut.prototype,"muteLocal",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"muteLocal"),Ut.prototype),we(Ut.prototype,"unmuteLocal",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"unmuteLocal"),Ut.prototype),we(Ut.prototype,"close",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"close"),Ut.prototype),we(Ut.prototype,"updateEncoderConfig",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"updateEncoderConfig"),Ut.prototype),we(Ut.prototype,"updateSendParameters",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"updateSendParameters"),Ut.prototype),we(Ut.prototype,"replaceTrack",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"replaceTrack"),Ut.prototype),we(Ut.prototype,"updateAdaptation",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"updateAdaptation"),Ut.prototype),we(Ut.prototype,"getRemoteSSRC",[Ws],Object.getOwnPropertyDescriptor(Ut.prototype,"getRemoteSSRC"),Ut.prototype),Ut);function Ws(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("From NVConnectionExtension.".concat(t));try{for(var u=arguments.length,p=new Array(u),m=0;m<u;m++)p[m]=arguments[m];return await i.apply(this,p)}finally{l()}},n}var sn;function A6(e){var t,n,i,o=2;for(typeof Symbol<"u"&&(n=Ry,i=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new rv(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function rv(e){function t(n){if(Object(n)!==n)return xe.reject(new TypeError(n+" is not an object."));var i=n.done;return xe.resolve(n.value).then(function(o){return{value:o,done:i}})}return rv=function(n){this.s=n,this.n=n.next},rv.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?xe.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?xe.reject(n):t(i.apply(this.s,arguments))}},new rv(e)}let Ghe=(sn=class lb extends gE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,n){super(t,n),D(this,"name","DataChannelConnection"),D(this,"store",void 0),D(this,"peerConnection",void 0),D(this,"cname",void 0),D(this,"mutex",new Ar("DataChannelConnection-mutex")),D(this,"dataChannel",void 0),D(this,"_p2pConnection",void 0),D(this,"establishPromise",void 0),D(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(lb.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Whe(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(t){var n;return(n=this._p2pConnection)===null||n===void 0?void 0:n.getPreMedia(t)}isPreSub(){var t,n;return(t=(n=this._p2pConnection)===null||n===void 0?void 0:n.isPreSub())!==null&&t!==void 0&&t}async establish(){return await this._p2pConnection.establish()}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(t){return this._p2pConnection.updateRtpSenderEncodings(t)}async connect(t){return this.cname=t.cname,await this._p2pConnection.connect(t),await new xe((n,i)=>{const o=setTimeout(()=>{this.closeSignal(),i(new ne(G.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(t.candidates))))},$("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(o),void n()},this.dataChannel.onerror=l=>{this.closeSignal(),i(l)},this.dataChannel.addEventListener("close",()=>{i(new ne(G.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,n){return this._p2pConnection.updateRemoteRTPCapabilities(t,n)}send(t,n,i){var o=this;return Ls(function*(){const l=yield Tt(o.mutex.lock("From DataChannelConnection.send"));try{return yield*ep(A6(o._p2pConnection.send(t,n,i)))}finally{l()}})()}async stopSending(t,n){return this._p2pConnection.stopSending(t,n)}async createDataChannels(t,n){return this._p2pConnection.createDataChannels(t,n)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,n,i,o){return this._nvMedia?(C.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,n,this.cname)):(C.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,n,i,o))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var n=this;return Ls(function*(){return yield*ep(A6(n._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var n;return(n=this._nvMedia)===null||n===void 0||n.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,n){return await this._p2pConnection.updateEncoderConfig(t,n)}async updateSendParameters(t,n){return await this._p2pConnection.updateSendParameters(t,n)}setStatsRemoteVideoIsReady(t,n){this._p2pConnection.setStatsRemoteVideoIsReady(t,n)}async replaceTrack(t,n){return await this._p2pConnection.replaceTrack(t,n)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,n,i,o){if($("SDP_LOGGING"))return C.upload("exchanging ".concat(i," ").concat(n," SDP during DataChannelConnection.").concat(o,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",i==="local"?"remote":"local",o)}:void 0}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Zd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...lb.turnServerConfigToIceServers(t.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...lb.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),$("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),$("ENABLE_ENCODED_TRANSFORM")&&It().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Fo(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!$("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var n;return(n=this.onICEConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var n;return(n=this.onConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var n;return(n=this.onDTLSTransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var n;return(n=this.onDTLSTransportError)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var n;return(n=this.onICETransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var n;return(n=this.onFirstAudioReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var n;return(n=this.onFirstVideoReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var n;return(n=this.onFirstAudioDecoded)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoRender=t=>{var n;return(n=this.onFirstVideoRender)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoBufferReady=t=>{var n;return(n=this.onFirstVideoBufferReady)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,n,i)=>{var o;return(o=this.onFirstVideoDecoded)===null||o===void 0?void 0:o.call(this,t,n,i)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var n;return(n=this.onFirstVideoDecodedTimeout)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,n)=>{var i;return(i=this.onSelectedLocalCandidateChanged)===null||i===void 0?void 0:i.call(this,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,n)=>{var i;return(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0?void 0:i.call(this,t,n)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},we(sn.prototype,"connect",[Wi],Object.getOwnPropertyDescriptor(sn.prototype,"connect"),sn.prototype),we(sn.prototype,"updateRemoteRTPCapabilities",[Wi],Object.getOwnPropertyDescriptor(sn.prototype,"updateRemoteRTPCapabilities"),sn.prototype),we(sn.prototype,"createDataChannels",[Wi],Object.getOwnPropertyDescriptor(sn.prototype,"createDataChannels"),sn.prototype),we(sn.prototype,"receive",[Wi],Object.getOwnPropertyDescriptor(sn.prototype,"receive"),sn.prototype),we(sn.prototype,"stopReceiving",[Wi],Object.getOwnPropertyDescriptor(sn.prototype,"stopReceiving"),sn.prototype),we(sn.prototype,"muteRemote",[Wi],Object.getOwnPropertyDescriptor(sn.prototype,"muteRemote"),sn.prototype),we(sn.prototype,"unmuteRemote",[Wi],Object.getOwnPropertyDescriptor(sn.prototype,"unmuteRemote"),sn.prototype),we(sn.prototype,"muteLocal",[Wi],Object.getOwnPropertyDescriptor(sn.prototype,"muteLocal"),sn.prototype),we(sn.prototype,"unmuteLocal",[Wi],Object.getOwnPropertyDescriptor(sn.prototype,"unmuteLocal"),sn.prototype),we(sn.prototype,"close",[Wi],Object.getOwnPropertyDescriptor(sn.prototype,"close"),sn.prototype),we(sn.prototype,"updateEncoderConfig",[Wi],Object.getOwnPropertyDescriptor(sn.prototype,"updateEncoderConfig"),sn.prototype),we(sn.prototype,"updateSendParameters",[Wi],Object.getOwnPropertyDescriptor(sn.prototype,"updateSendParameters"),sn.prototype),we(sn.prototype,"replaceTrack",[Wi],Object.getOwnPropertyDescriptor(sn.prototype,"replaceTrack"),sn.prototype),we(sn.prototype,"getRemoteSSRC",[Wi],Object.getOwnPropertyDescriptor(sn.prototype,"getRemoteSSRC"),sn.prototype),sn);function Wi(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("From DataChannelConnection.".concat(t));try{for(var u=arguments.length,p=new Array(u),m=0;m<u;m++)p[m]=arguments[m];return await i.apply(this,p)}finally{l()}},n}function I6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}class Hhe extends On{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;fe(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(pr.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(pr.CONNECTED):this._state==="closed"?this.emit(pr.CLOSED):this._state==="failed"&&this.emit(pr.FAILED))}constructor(t,n,i,o){super(),D(this,"connectionID",0),D(this,"currentURLIndex",0),D(this,"reconnectReason",void 0),D(this,"_reconnectMode","tryNext"),D(this,"_initMutex",void 0),D(this,"_name",void 0),D(this,"_state","closed"),D(this,"_reconnectInterrupter",void 0),D(this,"_url",void 0),D(this,"_retryConfig",void 0),D(this,"_reconnectCount",0),D(this,"_forceCloseTimeout",5e3),D(this,"_onlineReconnectListener",void 0),D(this,"_closeEstablishingTransmitter",()=>{}),D(this,"_store",void 0),D(this,"_joinChannelServiceRecordIndex",void 0),D(this,"_transmitter",void 0),D(this,"_useCompress",void 0),D(this,"_inflateLength",0),D(this,"_deflateLength",0),this._store=o,this._name=t,this._retryConfig=function(l){for(var u=1;u<arguments.length;u++){var p=arguments[u]!=null?arguments[u]:{};u%2?I6(Object(p),!0).forEach(function(m){D(l,m,p[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(p)):I6(Object(p)).forEach(function(m){Object.defineProperty(l,m,Object.getOwnPropertyDescriptor(p,m))})}return l}({},n),this._useCompress=i}resetReconnectCount(t){C.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const i=this._transmitter;n?setTimeout(()=>i.close(),500):i.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,n){if(!this._transmitter)return void C.warning("[".concat(this._name,"] can not reconnect, no websocket"));var i;t!==void 0&&(this.reconnectMode=t),C.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((i=this._store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(n)]},this._joinChannelServiceRecordIndex));const o=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),o&&o.bind(this._transmitter)({code:9999,reason:n})}getInflateData(){const t=this._inflateLength,n=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:n}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let Ca=function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e}({});class Khe{constructor(t,n,i){D(this,"version",1),D(this,"initialRTO",void 0),D(this,"maxBatchAckCount",void 0),D(this,"maxRTO",void 0),D(this,"initialRTT",void 0),D(this,"ID",void 0),D(this,"rtt",void 0),D(this,"packetNumber",1),D(this,"rtoRatioMap",new Map),D(this,"timeoutMap",new Map),D(this,"unorderedPacketQueue",[]),D(this,"batchAckPacketQueue",[]),D(this,"lastOrderedPacketNumber",0),D(this,"batchAckTimer",void 0),D(this,"sendImpl",void 0),D(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=Zt(7,"transmitter-"),this.initialRTO=(i==null?void 0:i.initialRTO)!==void 0?i.initialRTO:$("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:$("TRANSMITTER_INITIAL_RTT"),this.rtt=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:$("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(i==null?void 0:i.maxBatchAckCount)!==void 0?i.maxBatchAckCount:$("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(i==null?void 0:i.maxRTO)!==void 0?i.maxRTO:$("TRANSMITTER_MAX_RTO")}packetize(t,n){return{type:Ca.Default,version:this.version,packetNumber:n,payload:t}}serialize(t){switch(t.type){case Ca.Default:{let n;typeof t.payload=="string"?n=new TextEncoder().encode(t.payload):n=t.payload;const i=new ArrayBuffer(n.length+15),o=new DataView(i);return o.setUint16(0,t.version),o.setUint8(2,t.type),o.setUint32(3,t.packetNumber),O5(o,7,BigInt(t.sendTs)),new Uint8Array(o.buffer).set(n,15),i}case Ca.Ack:{const n=new ArrayBuffer(16),i=new DataView(n);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.maxAckPacketNumber),i.setUint8(7,t.shift),O5(i,8,BigInt(t.ackSendTs)),n}}}deserialize(t){const n=new DataView(t),i=n.getUint16(0),o=n.getUint8(2);switch(o){case Ca.Default:{const l=n.getUint32(3),u=I5(n,7),p=t.slice(15),m=new Uint8Array(p);return{version:i,type:o,packetNumber:l,sendTs:Number(u),payload:m}}case Ca.Ack:{const l=n.getUint32(3),u=n.getUint8(7),p=I5(n,8);return{version:i,type:o,maxAckPacketNumber:l,shift:u,ackSendTs:Number(p)}}default:throw C.error("[".concat(this.ID,"] Unrecognized packet type ").concat(o)),new Error("Unrecognized packet type ".concat(o))}}sendMessage(t){$("DC_DEBUG_LOG")&&typeof t=="string"&&C.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(t));const n=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const i=this.calculateRTO(n),o=window.setTimeout(()=>{this.resendMessage(n)},i);this.timeoutMap.set(n.packetNumber,o),this.sendPacket(n)}onData(t){const n=this.deserialize(t);n.type===Ca.Default?this.ack(n):n.type===Ca.Ack&&(this.updateRTT(n,Math.round(performance.now())),this.clearRTO(n))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[n,i]=t;window.clearTimeout(i)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const n=this.calculateRTO(t),i=window.setTimeout(()=>{$("DC_DEBUG_LOG")&&typeof t.payload=="string"&&C.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(t.payload),"timeout: ".concat(n)),this.resendMessage(t)},n);this.timeoutMap.set(t.packetNumber,i),this.sendPacket(t)}calculateRTO(t){const n=this.rtoRatioMap.get(t.packetNumber);if(n===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const i=9*this.rtt/8*n;return this.rtoRatioMap.set(t.packetNumber,n+1),i>this.maxRTO?this.maxRTO:i}}updateRTT(t,n){const i=t.ackSendTs;this.rtt=this.rtt*(7/8)+(n-i-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Ca.Ack,version:this.version};$("DC_DEBUG_LOG")&&C.debug("[".concat(this.ID,"] sending ack packet"),n,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(n)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Ca.Ack,version:this.version};$("DC_DEBUG_LOG")&&C.debug("[".concat(this.ID,"] sending ack packet"),n,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(n)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Ca.Ack,version:this.version};$("DC_DEBUG_LOG")&&C.debug("[".concat(this.ID,"] sending batch ack packet"),t,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===Ca.Default&&(t.sendTs=Math.round(performance.now()));const n=this.serialize(t);this.sendImpl(n)}clearRTO(t){for(let n=t.maxAckPacketNumber-t.shift;n<=t.maxAckPacketNumber;n++){const i=this.timeoutMap.get(n);i!==void 0&&window.clearTimeout(i),this.timeoutMap.delete(n),this.rtoRatioMap.delete(n)}}}class O6 extends Hhe{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),D(this,"_initMutex",void 0),D(this,"_reconnectInterrupter",void 0),D(this,"_url",void 0),D(this,"_transmitter",void 0),D(this,"_addresses",void 0),D(this,"_reliableTransmission",void 0),D(this,"_textEncoder",void 0),D(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new Ar("datachannel");const{timeout:i,timeoutFactor:o}=n,l=Math.max(300,Math.floor(3*i/5)),u=Math.max(1.2,Math.floor(8*o)/10);Rs.ONLINE&&(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=u),Un.on(eu.NETWORK_STATE_CHANGE,(p,m)=>{p!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(p)),p===Rs.ONLINE?(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=u):(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=o))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=n;const i=(o,l)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(p=>p.fingerprint||$("FINGERPRINT"));const u=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(u).then(o).catch(l),this.once(pr.CLOSED,()=>l(new ne(G.WS_DISCONNECT))),this.once(pr.CONNECTED,()=>o())};return this._initMutex.lock().then(o=>new xe((l,u)=>{i(l,u)}).then(()=>{o()}).catch(()=>{o()}))}async sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new ne(G.WS_ABORT,"datachannel is not ready");try{n||(t=JSON.stringify(t));const i=this._textEncoder.encode(t),o=she(i,{raw:!0});this._reliableTransmission.sendMessage(o)}catch(i){throw new ne(G.WS_ERR,"send datachannel signal message error"+i.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const n=JSON.stringify(t);return{compressed:n,compressedLength:n.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new xe((n,i)=>{var o;const l=()=>{C.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),n()},u=async y=>{var b;if((b=this._closeEstablishingTransmitter)===null||b===void 0||b.call(this),C.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(y.code,", reason: ").concat(y.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=y.reason,this.state="reconnecting");const S=yi(this,pr.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,w=await this.reconnectWithAction(S);if(this.state==="closed")return void C.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!w)return i(new ne(G.WS_DISCONNECT,"datachannel reconnect failed: ".concat(y.code))),void this.close(!0);n()}else i(new ne(G.WS_DISCONNECT,"datachannel close: ".concat(y.code))),this.close()},p=async y=>{try{var b;(b=this._reliableTransmission)===null||b===void 0||b.onData(y.data)}catch(S){console.log(S)}};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),C.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const m=(o=this._store)===null||o===void 0?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),g=Date.now();ar(this,pr.TO_CONNECT_DATACHANNEL).then(y=>{var b,S;if(!y)throw new Error("transmissonInfo not exist yet");const{transmitter:w,close:k}=y;this._transmitter=w,(b=this._store)===null||b===void 0||b.signalChannelOpen();const I=Date.now()-g;C.debug("[choose dc] dc open cost ".concat(I,"ms")),this._reliableTransmission=new Khe(O=>{var W;this._transmitter&&this._transmitter.readyState==="open"&&((W=this._transmitter)===null||W===void 0||W.send(O))},O=>{if(typeof O=="string")this.emit(pr.ON_MESSAGE,O);else{const W=ohe(O,{raw:!0}).buffer,H=this._textDecoder.decode(W);this.emit(pr.ON_MESSAGE,H)}}),this._closeEstablishingTransmitter=()=>{var O;(O=this._reliableTransmission)===null||O===void 0||O.close(),this._reliableTransmission=void 0,k()},l&&l(),w.onclose=u,w.onmessage=p,(S=this._store)===null||S===void 0||S.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this._joinChannelServiceRecordIndex=m}).catch(y=>{var b;if((b=this._store)===null||b===void 0||b.recordJoinChannelService({endTs:Date.now(),status:y instanceof ne&&y.code===G.WS_ABORT?"aborted":"error",errors:[y]},m),this.state!=="closed"){if(y instanceof ne&&y.code===G.WS_ERR){const S=new ne(G.WS_ERR,"init datachannel failed! Error: ".concat(y.toString()));return C.error("[".concat(this._name,"]").concat(S)),void i(S)}u&&u(y)}else i(new ne(G.WS_DISCONNECT,"datachannel is closed: ".concat(y.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Un.networkState!==Rs.OFFLINE||(this._onlineReconnectListener=Un.onlineWaiter&&Un.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let i=!0;if(this._reconnectInterrupter=()=>{i=!1},n){const p=Fy(this._reconnectCount,this._retryConfig);C.debug("[".concat(this._name,"] wait ").concat(p,"ms to reconnect datachannel, mode: ").concat(t)),await xe.race([vr(p),this._onlineReconnectListener||new xe(()=>{})])}if(this.state==="closed"||!i)return!1;this._reconnectCount+=1;const o=async(p,m)=>{this.emit(pr.RECONNECT_CREATE_CONNECTION,m),await this.createTransmitterConnection(p)};try{if(t==="retry"){const p=this._addresses[this.currentURLIndex];await o(p,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let m=this.currentURLIndex;m<this._addresses.length;m++){if(this._addresses[m].fingerprint||$("FINGERPRINT")){this.currentURLIndex=m;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return C.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);C.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const p=this._addresses[this.currentURLIndex];await o(p,t)}else t==="recover"&&(C.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(pr.FAILBACK));return!0}catch(p){var l,u;return C.error("[".concat(this._name,"] reconnect failed"),p.toString()),p!=null&&(l=p.data)!==null&&l!==void 0&&l.desc&&Array.isArray(p.data.desc)&&p.data.desc.length&&fe(u=p.data.desc).call(u,"dynamic key expired")?(this.emit(pr.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}}class zhe extends On{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Lt.CONNECTED?this.emit(Fe.WS_CONNECTED):t===Lt.RECONNECTING?this.emit(Fe.WS_RECONNECTING,this._websocketReconnectReason):t===Lt.CLOSED&&this.emit(Fe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(C.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(t=>{let{type:n,message:i}=t;this.emit(n,i),n===lt.ON_NOTIFICATION&&this.handleNotification(i),n===lt.ON_USER_BANNED&&this.handleUserBanned(i)}),this.pendingNotifications=[])}handleUserBanned(t){switch(t.error_code){case 14:this.close(kt.UID_BANNED);break;case 15:this.close(kt.IP_BANNED);break;case 16:this.close(kt.CHANNEL_BANNED)}}constructor(t,n){super(),D(this,"__name__","DataChannelSignal"),D(this,"_disconnectedReason",void 0),D(this,"_websocketReconnectReason",void 0),D(this,"_connectionState",Lt.CLOSED),D(this,"reconnectToken",void 0),D(this,"websocket",void 0),D(this,"openConnectionTime",void 0),D(this,"clientId",void 0),D(this,"lastMsgTime",Date.now()),D(this,"uploadCache",[]),D(this,"uploadCacheInterval",void 0),D(this,"rttRolling",new tC(5)),D(this,"pingpongTimer",void 0),D(this,"inflateDataTimer",void 0),D(this,"pingpongTimeoutCount",0),D(this,"ortc",void 0),D(this,"joinResponse",void 0),D(this,"multiIpOption",void 0),D(this,"initError",void 0),D(this,"spec",void 0),D(this,"store",void 0),D(this,"isJoining",!1),D(this,"pendingNotifications",[]),D(this,"onWebsocketMessage",i=>{if(i instanceof ArrayBuffer)return void this.emit(Fe.ON_BINARY_DATA,i);const o=JSON.parse(i);if($("DC_DEBUG_LOG")&&C.debug("[datachannel-signal] received packet",o),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const l="res-@".concat(o._id);this.emit(l,o._result,o._message)}else Object.prototype.hasOwnProperty.call(o,"_type")&&(this.isJoining?o._type===lt.ON_NOTIFICATION||o._type===lt.ON_USER_BANNED?(this.emit(o._type,o._message),o._type===lt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===lt.ON_USER_BANNED&&this.handleUserBanned(o._message)):(this.pendingNotifications.push({type:o._type,message:o._message}),C.debug("[".concat(this.clientId,"] cached notification during join: ").concat(o._type))):(this.emit(o._type,o._message),o._type===lt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===lt.ON_USER_BANNED&&this.handleUserBanned(o._message)))}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new O6("gateway-".concat(this.clientId),this.spec.retryConfig,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Lt.CONNECTED&&this.reconnect("retry",Ml.OFFLINE)})}async request(t,n,i,o){const l=Zt(6,""),u={_id:l,_type:t,_message:n},p=this.websocket.connectionID,m=()=>new xe((k,I)=>{if(this.connectionState===Lt.CONNECTED)return k();const O=()=>{this.off(Fe.WS_CLOSED,W),k()},W=()=>{this.off(Fe.WS_CONNECTED,O),I(new ne(G.WS_ABORT))};this.once(Fe.WS_CONNECTED,O),this.once(Fe.WS_CLOSED,W),t!==He.PUBLISH&&t!==He.SUBSCRIBE&&t!==He.UNSUBSCRIBE&&t!==He.UNPUBLISH&&t!==He.CONTROL&&t!==He.RESTART_ICE||this.once(Fe.DISCONNECT_P2P,()=>{I(new ne(G.DISCONNECT_P2P))}),t!==He.PUBLISH&&t!==He.RESTART_ICE||this.once(Fe.ABORT_P2P_EXECUTION,()=>{I(new ne(G.DISCONNECT_P2P))})});if(this.connectionState!==Lt.CONNECTING&&this.connectionState!==Lt.RECONNECTING||t===He.JOIN||t===He.REJOIN||await m(),t===He.LEAVE&&(this.websocket.unbindDcCloseEventListener(),o=!0),$("DC_DEBUG_LOG")&&C.debug("[datachannel-signal] sendMessage",u),await this.websocket.sendMessage(u,!0,!1),o)return;const g=new xe((k,I)=>{let O=!1;const W=(Y,Q)=>{O=!0,k({isSuccess:Y==="success",message:Q||{}}),this.off(Fe.WS_CLOSED,H),this.off(Fe.WS_RECONNECTING,H),this.emit(Fe.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(l),W);const H=()=>{I(new ne(G.WS_ABORT,"type: ".concat(t))),this.off(Fe.WS_CLOSED,H),this.off(Fe.WS_RECONNECTING,H),this.off("res-@".concat(l),W)};this.once(Fe.WS_CLOSED,H),this.once(Fe.WS_RECONNECTING,H),vr($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||O||(C.warning("dc request timeout, type: ".concat(t)),this.emit(Fe.REQUEST_TIMEOUT,t,n))})});let y=null;try{y=await g}catch(k){if(this.connectionState===Lt.CLOSED||t===He.LEAVE)throw new ne(G.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?k.throw():t===He.JOIN||t===He.REJOIN?null:(await m(),await this.request(t,n))}if(y.isSuccess)return y.message;const b=Number(y.message.error_code||y.message.code),S=gu(b),w=new ne(G.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(y.message.error_str),{code:b,data:y.message});return S.action==="success"?y.message:(C.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(b,", message: ").concat(S.desc,", action: ").concat(S.action)),b===Je.ERR_TOO_MANY_BROADCASTERS?((t===He.JOIN||t===He.REJOIN)&&(this.initError=w,this.close()),w.throw()):S.action==="failed"?w.throw():S.action==="quit"?(this.initError=w,this.close(),w.throw()):(b===Je.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=y.message.option,C.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ml.MULTI_IP)):this.reconnect(S.action,Ml.SERVER_ERROR),t===He.JOIN||t===He.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new xe(i=>{const o=l=>{(!n||n(l))&&(this.off(t,o),i(l))};this.on(t,o)})}uploadWRTCStats(t){if(!this.store.sessionId)return void C.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(fu.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const l=$("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Lt.CONNECTED)return;const u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},$("UPLOAD_CACHE_INTERVAL")||2e3))}}async send(t,n){const i={_type:t,_message:n};await this.websocket.sendMessage(i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new xe((n,i)=>{this.once(Fe.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Fe.WS_CLOSED,()=>i(this.initError||new ne(G.WS_ABORT))),this.connectionState=Lt.CONNECTING,this.websocket.init(t).catch(i),this.websocket.once(pr.FAILBACK,()=>{i(new ne(G.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(C.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),i(new ne(G.INIT_DATACHANNEL_TIMEOUT)))},$("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=t||kt.LEAVE,this.connectionState=Lt.CLOSED,C.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===kt.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new O6("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),$("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit(Fe.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await ar(this,Fe.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];const n=await this.request(He.JOIN,t);if(this.store.joinRep(),this.ortc=t==null?void 0:t.ortc,!n)return this.emit(Fe.REPORT_JOIN_GATEWAY,G.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Fe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Lt.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0}async rejoin(){if(!this.reconnectToken)throw new ne(G.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=tu(this,Fe.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(He.REJOIN,t);return!!n&&(this.connectionState=Lt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),$("DC_PINGPONG_INTERVAL")),n.peers&&n.peers.forEach(i=>{this.emit(lt.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(lt.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(lt.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(lt.MUTE_AUDIO,{uid:i.uid}):this.emit(lt.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(lt.MUTE_VIDEO,{uid:i.uid}):this.emit(lt.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(lt.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(lt.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(lt.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(lt.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(lt.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(He.DOWNGRADE_CODEC,n)}handleNotification(t){C.debug("[".concat(this.clientId,"] receive notification: "),t);const n=gu(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(kt.UID_BANNED),void this.close()):void this.reconnect(n.action,Ml.SERVER_ERROR);C.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,$("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));const t=$("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(C.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>$("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",Ml.FALLBACK):this.request(He.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),$("REPORT_STATS")&&this.send(He.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleInflateData(){const{inflateLength:t,deflateLength:n}=this.websocket.getInflateData();t!==0&&n!==0&&this.upload(fu.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(pr.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Fe.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(pr.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pr.CLOSED,()=>{this.connectionState=Lt.CLOSED}),this.websocket.on(pr.FAILED,()=>{this._disconnectedReason=kt.NETWORK_ERROR,this.connectionState=Lt.CLOSED}),this.websocket.on(pr.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Lt.CONNECTED?this.connectionState=Lt.RECONNECTING:this.connectionState=Lt.CONNECTING}),this.websocket.on(pr.WILL_RECONNECT,(t,n)=>{if(tu(this,Fe.IS_P2P_DISCONNECTED)&&t==="retry")return C.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Fe.NEED_RENEW_SESSION),this.emit(Fe.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(C.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(Fe.NEED_RENEW_SESSION),this.emit(Fe.DISCONNECT_P2P)),n(t)}),this.websocket.on(pr.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{C.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Ml.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Fe.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof ne&&t.code===G.UNEXPECTED_RESPONSE&&t.data.code===Je.ERR_NO_AUTHORIZED)return C.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Ml.SERVER_ERROR);C.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ml.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(pr.REQUEST_NEW_URLS,(t,n)=>{ar(this,Fe.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(pr.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(lt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(pr.TO_CONNECT_DATACHANNEL,(t,n)=>{ar(this,Fe.PRE_CONNECT_PC).then(t).catch(n)}),this.websocket.on(pr.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(Fe.DATACHANNEL_FAILBACK)})}}const Yhe={name:"DataChannelConnection",create:function(e){let{store:t,spec:n}=e;return new Ghe(n,t)}},qhe={name:"DataChannelSignal",create:function(e){let{store:t,spec:n}=e;return new zhe(n,t)}};aC(),on("PROCESS_ID","process-".concat(Zt(8,""),"-").concat(Zt(4,""),"-").concat(Zt(4,""),"-").concat(Zt(4,""),"-").concat(Zt(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void C.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();C.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(en,i)){const{value:o,expires:l}=t[i];if(l&&l<=n)return;ki[i]=o,en[i]=o}})}catch(t){C.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(ki.AREAS)&&ki.AREAS.length>0&&cR(ki.AREAS,!0);const P6=(e,t,n)=>{C.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),on(e,t,n)};lc(uhe,!1),lc(mhe,!1),lc(Gde,!1),lc(The,!1),lc(che,!1),lc(jhe,!1),lc(Fhe,!1),lc($he,!1),lc(Yhe,!1),lc(qhe,!1);const cr=function(e){const t=new On,n=e,i={getListeners:t.getListeners.bind(t),on:(o,l)=>(function(u,p){u===oc.SECURITY_POLICY_VIOLATION&&cB(p,!0)}(o,l),t.on.bind(t)(o,l)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return aB(aB({},n),i)}({__TRACK_LIST__:au,VERSION:to,BUILD:dC,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:P6,getParameter:$,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(i){let o;return It().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),o=(await i.createOffer()).sdp):o=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,o}(t);if(!n)return e;t.close(),t=null,e=function(i){const o={video:[],audio:[]};return i.match(/ VP8/i)&&o.video.push("VP8"),i.match(/ VP9/i)&&o.video.push("VP9"),i.match(/ AV1/i)&&o.video.push("AV1"),i.match(/ H264/i)&&o.video.push("H264"),i.match(/ H265/i)&&o.video.push("H265"),i.match(/ opus/i)&&o.audio.push("OPUS"),i.match(/ PCMU/i)&&o.audio.push("PCMU"),i.match(/ PCMA/i)&&o.audio.push("PCMA"),i.match(/ G722/i)&&o.audio.push("G722"),o}(n)}catch(t){throw new ne(G.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];const t=Ue.reportApiInvoke(null,{name:Rn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:hn.TRACER}),n=function(){let l=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],u=!1;try{const p=window.RTCPeerConnection,m=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,g=window.WebSocket;u=!(!p||!g),l&&!m&&(u=!1),u&&Df()&&E5(75)&&new p().close()}catch(p){C.error("check system requirement failed: ",p),u=!1}return u}(e),i=Kde();C.debug("checkSystemRequirements, api:",n,"browser",i);const o=n&&i;return t.onSuccess(o),$("IGNORE_RTC_DEVICE_CHECK")?n:o},getDevices:function(e){return Vi.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Vi.getRecordingDevices(e)},getCameras:function(e){return Vi.getCamerasDevices(e)},getElectronScreenSources:wU,getPlaybackDevices:function(e){return Vi.getSpeakers(e)},createClient:sB,createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=$("CAMERA_CAPTURE_CONFIG"),n=Zt(8,"track-cam-"),i=Ue.reportApiInvoke(null,{id:n,tag:hn.TRACER,name:Rn.CREATE_CAM_VIDEO_TRACK,options:[En({},e),t]});t&&(e.encoderConfig=t);const o=Zy(e);let l=null;C.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{l=(await Ui({video:o},n)).getVideoTracks()[0]||null}catch(p){throw i.onError(p),p}if(!l){const p=new oe(G.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(p),p.throw(C)}if(e.optimizationMode&&AC(n,l,e,jo(e.encoderConfig)),$("USE_STANDARD_BITRATE_DEFAULT")){const p=jo(e.encoderConfig);e.encoderConfig=p,delete p.bitrateMax,delete p.bitrateMin}const u=new tE(l,e,o,e.scalabiltyMode?qy(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return i.onSuccess(u.getTrackId()),C.info("create camera video success, trackId:",n),u},createCustomVideoTrack:function(e){const t=Zt(8,"track-cus-"),n=Ue.reportApiInvoke(null,{id:t,tag:hn.TRACER,name:Rn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});$("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const i=new pn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?qy(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Xt.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),C.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(S){const w=kU(S);return pU()&&S.suppressLocalAudioPlayback&&(w.suppressLocalAudioPlayback=S.suppressLocalAudioPlayback),mU()&&S.restrictOwnAudio&&(w.restrictOwnAudio=!0),w}(t):void 0;n&&(t="auto");const i=Zt(8,"track-scr-v-"),o=Ue.reportApiInvoke(null,{id:i,tag:hn.TRACER,name:Rn.CREATE_SCREEN_VIDEO_TRACK,options:[En({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const l=function(S){const w={};S.screenSourceType&&(w.mediaSource=S.screenSourceType),S.extensionId&&$c()&&(w.extensionId=S.extensionId);const{displaySurface:k,selfBrowserSurface:I,surfaceSwitching:O,systemAudio:W,preferCurrentTab:H,windowAudio:Y,monitorTypeSurfaces:Q}=S;(pa(107)||Ol(107)||Qd(93))&&(k&&(Qn(k,"displaySurface",["browser","window","monitor"]),w.displaySurface=k),I?(Qn(I,"selfBrowserSurface",["exclude","include"]),w.selfBrowserSurface=I):w.selfBrowserSurface="include",O&&(Qn(O,"surfaceSwitching",["exclude","include"]),w.surfaceSwitching=O)),(pa(105)||Ol(105)||Qd(91))&&W&&(Qn(W,"systemAudio",["exclude","include"]),w.systemAudio=W),(pa(94)||Ol(94)||Qd(80))&&H&&(w.preferCurrentTab=!0),(pa(141)||Ol(141)||Qd(125))&&Y&&(Qn(Y,"windowAudio",["exclude","system"]),w.windowAudio=Y),(pa(119)||Ol(119)||Qd(105))&&Q&&(Qn(Q,"monitorTypeSurfaces",["exclude","include"]),w.monitorTypeSurfaces=Q),S.electronScreenSourceId&&(w.sourceId=S.electronScreenSourceId);const Z=S.encoderConfig?gC(S.encoderConfig):null;return w.mandatory={chromeMediaSource:"desktop",maxWidth:Z?Z.width:void 0,maxHeight:Z?Z.height:void 0},Z&&(Z.frameRate&&(typeof Z.frameRate=="number"?(w.mandatory.maxFrameRate=Z.frameRate,w.mandatory.minFrameRate=Z.frameRate):(w.mandatory.maxFrameRate=Z.frameRate.max||Z.frameRate.ideal||Z.frameRate.exact||void 0,w.mandatory.minFrameRate=Z.frameRate.min||Z.frameRate.ideal||Z.frameRate.exact||void 0),w.frameRate=Z.frameRate),Z.width&&(w.width=Z.width),Z.height&&(w.height=Z.height)),w}(e);let u=null,p=null;const m=It();if(!m.supportShareAudio&&t==="enable"){const S=new oe(G.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return o.onError(S),S.throw(C)}C.info("start create screen video track with config",e,"withAudio",t,"trackId",i);const g=m.supportShareAudio&&t!=="disable";try{const S=await Ui({screen:l,screenAudio:g?n||!0:void 0},i);u=S.getVideoTracks()[0]||null,p=S.getAudioTracks()[0]||null}catch(S){throw o.onError(S),S}if(!u){const S=new oe(G.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(S),S.throw(C)}if(!p&&t==="enable"){u&&u.stop();const S=new oe(G.SHARE_AUDIO_NOT_ALLOWED);return o.onError(S),S.throw(C)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(AC(i,u,e,e.encoderConfig&&gC(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const y=new pn(u,e.encoderConfig?gC(e.encoderConfig):{},e.scalabiltyMode?qy(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[Xt.SCREEN_TRACK]);if(!p)return o.onSuccess(y.getTrackId()),C.info("create screen video track success","video:",y.getTrackId()),y;const b=new Wn(p,void 0,Zt(8,"track-scr-a-"),!1);return o.onSuccess([y.getTrackId(),b.getTrackId()]),C.info("create screen video track success","video:",y.getTrackId(),"audio:",b.getTrackId()),[y,b]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=$("CAMERA_CAPTURE_CONFIG"),i=Zt(8,"track-mic-"),o=Zt(8,"track-cam-"),l=Ue.reportApiInvoke(null,{id:"".concat(i,"-").concat(o),tag:hn.TRACER,name:Rn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const u=Zy(t),p=LU(e);let m=null,g=null;C.info("start create camera video track(".concat(o,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const S=await Ui({audio:p,video:u},"".concat(i,"-").concat(o));m=S.getAudioTracks()[0],g=S.getVideoTracks()[0]}catch(S){throw l.onError(S),S}if(!m||!g){const S=new oe(G.UNEXPECTED_ERROR,"can not find tracks in media stream");return l.onError(S),S.throw(C)}if(t.optimizationMode&&AC(o,g,t,jo(t.encoderConfig)),$("USE_STANDARD_BITRATE_DEFAULT")){const S=jo(t.encoderConfig);t.encoderConfig=S,delete S.bitrateMax,delete S.bitrateMin}const y=new Wf(m,e,p,i),b=new tE(g,t,u,t.scalabiltyMode?qy(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o);return l.onSuccess([y.getTrackId(),b.getTrackId()]),C.info("create camera video track(".concat(o,") and microphone audio track(").concat(i,") success")),[y,b]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Zt(8,"track-mic-"),n=Ue.reportApiInvoke(null,{id:t,tag:hn.TRACER,name:Rn.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=LU(e);let o=null;C.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{o=(await Ui({audio:i},t)).getAudioTracks()[0]||null}catch(u){throw n.onError(u),u}if(!o){const u=new oe(G.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(u),u.throw(C)}const l=new Wf(o,e,i,t);return n.onSuccess(l.getTrackId()),C.info("create microphone audio track success, trackId:",t),l},createCustomAudioTrack:aV,createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:i}=e;let{source:o}=e;const l={source:o instanceof AudioBuffer?"AudioBuffer":o instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":o,cacheOnlineFile:n,encoderConfig:i},u=Zt(8,"track-buf-"),p=Ue.reportApiInvoke(null,{id:u,tag:hn.TRACER,name:Rn.CREATE_BUFFER_AUDIO_TRACK,options:[l]});if($("DISABLE_WEBAUDIO"))throw new oe(G.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");C.info("start create buffer source audio track with config",JSON.stringify(l),"trackId",u);const m=o;if(!(o instanceof AudioBuffer))try{o=await async function(b,S){let w=null;if(typeof b=="string"){const I=S3.get(b);if(I)return C.debug("use cached audio resource: ",b),I;try{w=(await ma(()=>Ms.get(b,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(O){throw new oe(G.FETCH_AUDIO_FILE_FAILED,O.toString())}}else w=await new xe((O,W)=>{const H=new FileReader;H.onload=Y=>{Y.target?O(Y.target.result):W(new oe(G.READ_LOCAL_AUDIO_FILE_ERROR))},H.onerror=()=>{W(new oe(G.READ_LOCAL_AUDIO_FILE_ERROR))},H.readAsArrayBuffer(b)});const k=await function(I){const O=mp();return new xe((W,H)=>{O.decodeAudioData(I,Y=>{W(Y)},Y=>{H(new oe(G.DECODE_AUDIO_FILE_FAILED,Y.toString()))})})}(w);return typeof b=="string"&&S&&S3.set(b,k),k}(o,n)}catch(b){return p.onError(b),b.throw(C)}const g=new ule(o),y=new dle(m,g,i?Xy(i):{},u);return C.info("create buffer source audio track success, trackId:",u),p.onSuccess(y.getTrackId()),y},setAppType:function(e){if(C.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw C.debug("Invalid appType"),new ne(G.INVALID_PARAMS,"invalid app type",e);on("APP_TYPE",Math.floor(e))},setLogLevel:function(e){C.setLogLevel(e)},enableLogUpload:function(){$("USE_NEW_LOG")?on("UPLOAD_LOG",!0):C.enableLogUpload()},disableLogUpload:function(){$("USE_NEW_LOG")?on("UPLOAD_LOG",!1):C.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new T4},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Ue.reportApiInvoke(null,{tag:hn.TRACER,name:Rn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Wn||e instanceof _p)){const m=new ne(G.INVALID_TRACK,"the parameter is not a audio track");return n.onError(m),m.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof Wn?e.getTrackLabel():"remote_track",o=e.getVolumeLevel();let l=o,u=o;const p=Date.now();return new xe(m=>{const g=setInterval(()=>{const y=e.getVolumeLevel();l=y>l?y:l,u=y<u?y:u;const b=l-u>1e-4,S=Date.now()-p;if(b||S>t){clearInterval(g);const w=b,k={duration:S,deviceLabel:i,maxVolumeLevel:l,result:w};C.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(k))),n.onSuccess(k),m(w)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Ue.reportApiInvoke(null,{tag:hn.TRACER,name:Rn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof pn||e instanceof gp)){const b=new ne(G.INVALID_TRACK,"the parameter is not a video track");return n.onError(b),b.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof pn?e.getTrackLabel():"remote_track",o=e.getMediaStreamTrack(!0),l=document.createElement("video");l.style.width="1px",l.style.height="1px",l.setAttribute("muted",""),l.muted=!0,l.setAttribute("playsinline",""),l.controls=!1,(Nr()||jy())&&(l.style.opacity="0.01",l.style.position="fixed",l.style.left="0",l.style.top="0",document.body.appendChild(l)),l.srcObject=new MediaStream([o]),l.play();const u=document.createElement("canvas");u.width=160,u.height=120;let p=0,m=0;try{const b=Date.now();p=await function(S,w,k,I){let O,W=0,H=null;return new xe((Y,Q)=>{function Z(){W>I&&O&&(O(),Y(W));const q=k.getContext("2d");if(!q){const me=new ne(G.UNEXPECTED_ERROR,"can not get canvas 2d context.");return C.error(me.toString()),void Q(me)}q.drawImage(S,0,0,160,120);const ee=q.getImageData(0,0,k.width,k.height),ce=Math.floor(ee.data.length/3);if(H){for(let me=0;me<ce;me+=3)if(ee.data[me]!==H[me])return W+=1,void(H=ee.data);H=ee.data}else H=ee.data}setTimeout(()=>{O&&(O(),Y(W))},w),O=SC(()=>{Z()},30)})}(l,t,u,4),m=Date.now()-b}catch(b){throw n.onError(b),b}Ide===Ht.SAFARI&&(l.pause(),l.remove()),l.srcObject=null;const g=p>4,y={duration:m,changedPicNum:p,deviceLabel:i,result:g};return C.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(y))),n.onSuccess(y),g},setArea:cR,audioElementPlayCenter:gs,resumeAudioContext:function(){return gs.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Yde.processExternalMediaAEC(e)},registerExtensions:function(e){const t=$("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!fe(t).call(t,n.name)&&t.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=C.extLog,i.reporter.hookApiInvoke=Ue.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(o=>{i.parameters[o]=$(o)})}),P6("PLUGIN_INFO",t)},ChannelMediaRelayError:vp,ChannelMediaRelayEvent:Kc,ChannelMediaRelayState:Qs,RemoteStreamFallbackType:sle,RemoteStreamType:rle,ConnectionDisconnectedReason:kt,AudienceLatencyLevelType:Pce,AREAS:zt,preload:async function(e,t,n,i){return IR(e,t,n,i)},startLastmileProbeTest:async function(e,t,n,i){let o={state:"unavailable"};await IR(e,t,n,i);const l=await OR({appId:e,cname:t,token:n||e,uid:i,cloudProxyServer:"disabled"});if(!l)return o;await PR(l);let u,p=sB({mode:"rtc",codec:"vp8"});try{u=await p.join(e,t,n,i,{networkQualityProbe:!0})}catch{return o}const m=new kde,g=m.createMuteAudioTrack();let y=await aV({mediaStreamTrack:g});await p.publish([y]);let[b,S,w]=await new xe((Y,Q)=>{const Z=setTimeout(()=>{clearTimeout(Z),Y([!0,null,"audio"])},5e3);p.on("user-published",async(q,ee)=>{q.uid===u&&(clearTimeout(Z),Y([!1,q,ee]))})});if(b||!S)return await p.unpublish([y]),await p.leave(),y.close(),m.close(),o;await p.subscribe(S,w),await new xe((Y,Q)=>{const Z=setTimeout(()=>{clearTimeout(Z),Y(null)},5e3)});let k=p.getRTCStats(),I=p.getLocalAudioStats();const O=k.RTT,W=I.sendJitterMs,H=I.currentPacketLossRate;return o={state:"complete",rtt:O,packetLossRate:H,jitter:W,networkQuality:((Y,Q,Z)=>{let q=1;if(Z>0){let ot=Math.log(100*Z)/Math.log(2)+1;ot=Math.min(5,Math.max(0,ot)),q=1-ot/5}let ee=1;if(Y>0){let ot=Math.log(Y/40)/Math.log(2)+1;ot=Math.min(5,Math.max(0,ot)),ee=1-ot/5}let ce=1;if(Q>0){let ot=Math.log(Q/10)/Math.log(2.5)+1;ot=Math.min(5,Math.max(0,ot)),ce=1-ot/5}const me=.5*q+.3*ee+.2*ce;let Oe=0;return Oe=me>=.8?1:me>=.6?2:me>=.4?3:me>=.2?4:5,Oe})(O,W,H)},await p.unsubscribe(S),await p.unpublish([y]),await p.leave(),y.close(),m.close(),await PR(l),o}});return Object.defineProperties(cr,{onAudioAutoplayFailed:{get:()=>Us.onAudioAutoplayFailed,set:e=>{Us.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Us.onAutoplayFailed,set:e=>{Us.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>cr._onSecurityPolicyViolation,set(e){cr._onSecurityPolicyViolation=e,cB(e)}},__CLIENT_LIST__:{get:()=>$("SHOW_GLOBAL_CLIENT_LIST")?pu:[]}}),Vi.on(lu.CAMERA_DEVICE_CHANGED,e=>{C.info("camera device changed",JSON.stringify(e)),cr.onCameraChanged&&cr.onCameraChanged(e),cr.safeEmit(oc.CAMERA_CHANGED,e)}),Vi.on(lu.RECORDING_DEVICE_CHANGED,e=>{C.info("microphone device changed",JSON.stringify(e)),cr.onMicrophoneChanged&&cr.onMicrophoneChanged(e),cr.safeEmit(oc.MICROPHONE_CHANGED,e)}),Vi.on(lu.PLAYOUT_DEVICE_CHANGED,e=>{C.debug("playout device changed",JSON.stringify(e)),cr.onPlaybackDeviceChanged&&cr.onPlaybackDeviceChanged(e),cr.safeEmit(oc.PLAYBACK_DEVICE_CHANGED,e)}),gs.onAutoplayFailed=()=>{C.info("detect audio element autoplay failed"),Us.onAudioAutoplayFailed&&Us.onAudioAutoplayFailed()},an.on("autoplay-failed",()=>{C.info("detect webaudio autoplay failed"),Us.onAudioAutoplayFailed&&Us.onAudioAutoplayFailed(),cr.safeEmit(oc.AUTOPLAY_FAILED)}),an.on(Fr.STATE_CHANGE,(e,t)=>{C.info("audio context state changed: ".concat(t," => ").concat(e)),cr.onAudioContextStateChanged&&cr.onAudioContextStateChanged(e,t),cr.safeEmit(oc.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Un.on(eu.NETWORK_STATE_CHANGE,(e,t)=>{C.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=cr),cr})})(HY);var zNe=HY.exports;const Bg=nI(zNe),ku="http://localhost:5000",dG="8d21c418598b4496907513003a6e123c",YNe=()=>{var ze,at,ft,Rt,Ze;const{theme:r}=sr(),s=r==="dark",[a,c]=V.useState("voice"),[h,f]=V.useState(""),[_,E]=V.useState([]),[v,x]=V.useState([]),[T,R]=V.useState(null),[N,L]=V.useState(!0),[j,F]=V.useState(null),[P,M]=V.useState(null),[U,B]=V.useState([]),[K,J]=V.useState({microphones:[],speakers:[],cameras:[]}),[te,se]=V.useState({microphone:"",speaker:"",camera:""}),[ie,ue]=V.useState(""),[de,Ne]=V.useState(!1),[Ce,tt]=V.useState(!1),[Se,Ge]=V.useState([]),[Xe,Re]=V.useState(""),[le,ve]=V.useState(!1),[Le,qe]=V.useState(!1),We=V.useRef(null),xt=V.useRef(null),bt=V.useRef(null),$t=V.useRef(null),vt=V.useRef(null),ut=V.useRef(null),Wt=V.useRef(null),Jt=s?"bg-[#101828]":"bg-white",Dt=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",At=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",be=s?"text-[#e7eefc]":"text-[#0f172a]",ht=s?"text-[#9bb0d0]":"text-[#475569]",Gt=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",Ln=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",Mn=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",bn=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",ln=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",vn=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",Xn=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",Mr=s?"text-[#e7eefc]":"text-[#0f172a]",So=s?"placeholder-[#9bb0d0]":"placeholder-[#475569]",ir=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",Jn=()=>{try{const ae=localStorage.getItem("iru-auth");if(ae)return JSON.parse(ae).token}catch{}return null},ia=()=>{var ae;try{const Ae=localStorage.getItem("iru-auth");if(Ae)return(ae=JSON.parse(Ae).user)==null?void 0:ae.id}catch{}return null},jr=()=>{try{const ae=localStorage.getItem("iru-auth");if(ae)return JSON.parse(ae).user}catch{}return null};V.useEffect(()=>{const ae=Jn();if(!ae){console.warn("CallsPage: No auth token found");return}const Ae=h0(ku,{auth:{token:ae},transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3});Ae.on("connect",()=>{console.log("CallsPage:  Socket connected, socket ID:",Ae.id);const Ye=ia();console.log("CallsPage: Current user ID:",Ye),console.log("CallsPage: Socket is ready to receive calls"),Ae.emit("join-user-room",{userId:Ye});const pt=sessionStorage.getItem("incoming-call");if(pt)try{const Cn=JSON.parse(pt);console.log("CallsPage: Found stored incoming call:",Cn),M(Cn),sessionStorage.removeItem("incoming-call")}catch(Cn){console.error("CallsPage: Error parsing stored call:",Cn)}}),Ae.on("connect_error",Ye=>{console.error("CallsPage: Socket connection error:",Ye),dt.error("Failed to connect to server")}),Ae.on("disconnect",Ye=>{console.log("CallsPage: Socket disconnected:",Ye)}),Ae.on("call:incoming",Ye=>{console.log("CallsPage: ========== INCOMING CALL RECEIVED =========="),console.log("CallsPage: Call data:",JSON.stringify(Ye,null,2)),console.log("CallsPage: Caller:",Ye.caller),console.log("CallsPage: Call type:",Ye.callType),console.log("CallsPage: Channel:",Ye.channelName),dt.info(`Incoming ${Ye.callType} call from ${Ye.caller.fullName}`,{duration:1e4}),M(Ye),console.log("CallsPage: Incoming call state set, modal should appear"),console.log("CallsPage: ============================================")}),Ae.onAny((Ye,...pt)=>{Ye==="call:incoming"&&console.log("CallsPage: Received call:incoming event via onAny:",pt)}),Ae.on("call:accepted",async Ye=>{console.log("CallsPage: Call accepted:",Ye),dt.success("Call accepted!")}),Ae.on("call:rejected",()=>{console.log("CallsPage: Call was rejected"),dt.info("Call was rejected"),M(null),j&&ws()}),Ae.on("call:ended",()=>{console.log("CallsPage: Call ended"),dt.info("Call ended"),M(null),j&&ws()}),Ae.on("call:unavailable",Ye=>{console.log("CallsPage: Call recipient unavailable:",Ye),dt.error("User is not available for calls"),j&&ws()});const Be=Ye=>{console.log("CallsPage: Received incoming call via custom event:",Ye.detail),M(Ye.detail)};return window.addEventListener("incoming-call-received",Be),Wt.current=Ae,()=>{window.removeEventListener("incoming-call-received",Be),console.log("CallsPage: Cleaning up socket connection"),Ae.disconnect()}},[]);const yr=async()=>{try{L(!0);const ae=Jn();if(!ae){console.error("CallsPage: No auth token found"),L(!1);return}console.log("CallsPage: Fetching users from:",`${ku}/api/users`);let Ae=await fetch(`${ku}/api/users`,{headers:{Authorization:`Bearer ${ae}`}});if(console.log("CallsPage: Users API response status:",Ae.status),Ae.ok){const Be=await Ae.json();console.log("CallsPage: Loaded users from /api/users:",(Be==null?void 0:Be.length)||0,Be);const Ye=Array.isArray(Be)?Be:[];E(Ye),x(Ye)}else{const Be=await Ae.text();if(console.error("CallsPage: Failed to fetch from /api/users:",Ae.status,Be),console.log("CallsPage: Trying alternative endpoint:",`${ku}/api/calls/users`),Ae=await fetch(`${ku}/api/calls/users`,{headers:{Authorization:`Bearer ${ae}`}}),Ae.ok){const Ye=await Ae.json();console.log("CallsPage: Loaded users from /api/calls/users:",(Ye==null?void 0:Ye.length)||0);const pt=Array.isArray(Ye)?Ye:[];E(pt),x(pt)}else console.error("CallsPage: Both endpoints failed")}}catch(ae){console.error("CallsPage: Error fetching users:",ae)}finally{L(!1)}};V.useEffect(()=>{yr()},[]),V.useEffect(()=>{if(!h.trim())x(_),R(null);else{const ae=_.filter(Ae=>Ae.fullName.toLowerCase().includes(h.toLowerCase()));x(ae),ae.length===1&&R(ae[0])}},[h,_]),V.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0,video:!0});const Ae=await navigator.mediaDevices.enumerateDevices();J({microphones:Ae.filter(Be=>Be.kind==="audioinput"),speakers:Ae.filter(Be=>Be.kind==="audiooutput"),cameras:Ae.filter(Be=>Be.kind==="videoinput")})}catch(Ae){console.error("Error getting devices:",Ae)}})()},[]);const di=()=>(We.current||(We.current=Bg.createClient({mode:"rtc",codec:"vp8"}),We.current.on("user-published",async(ae,Ae)=>{var Be;try{if(console.log("CallsPage: User published event - user:",ae.uid,"mediaType:",Ae),await((Be=We.current)==null?void 0:Be.subscribe(ae,Ae)),console.log("CallsPage:  Subscribed to remote",Ae,"from user:",ae.uid),Ae==="video"&&ae.videoTrack){console.log("CallsPage: Setting up remote video track"),ve(!0);let Ye=0;const pt=()=>{var Cn;if(vt.current)try{const yn=vt.current.querySelector("video");yn&&yn.remove(),(Cn=ae.videoTrack)==null||Cn.play(vt.current),console.log("CallsPage:  Playing remote video in remoteVideoRef")}catch(yn){console.error("CallsPage: Error playing remote video:",yn)}else Ye<10?(Ye++,setTimeout(pt,200)):console.warn("CallsPage: remoteVideoRef.current is null after retries")};setTimeout(pt,100)}Ae==="audio"&&ae.audioTrack&&(ae.audioTrack.play(),console.log("CallsPage:  Playing remote audio"))}catch(Ye){console.error("CallsPage: Error handling user-published:",Ye)}}),We.current.on("user-unpublished",(ae,Ae)=>{console.log("User unpublished",Ae),Ae==="video"&&ae.videoTrack&&(ae.videoTrack.stop(),ve(!1)),Ae==="audio"&&ae.audioTrack&&ae.audioTrack.stop()}),We.current.on("user-left",ae=>{console.log("Remote user left:",ae.uid),dt.info("The other user left the call"),ws()}),We.current.on("user-joined",ae=>{console.log("Remote user joined:",ae.uid)})),We.current),ui=async()=>{var ae;if(!T){dt.error("Please select a user to call");return}try{const Ae=Jn(),Be=jr(),Ye=await fetch(`${ku}/api/calls/start`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Ae}`},body:JSON.stringify({recipientId:T.id,callType:a==="meeting"?"video":a})});if(!Ye.ok)throw new Error("Failed to start call");const pt=await Ye.json();if(pt.channelName.length>64)throw new Error("Channel name is too long. Please try again.");console.log("Starting call with channel:",pt.channelName,"token length:",(ae=pt.token)==null?void 0:ae.length);const Cn=di();await Cn.join(dG,pt.channelName,pt.token,0),console.log("Joined Agora channel successfully");const yn=await Bg.createMicrophoneAudioTrack();if(xt.current=yn,a==="video"||a==="meeting"){const as=await Bg.createCameraVideoTrack();bt.current=as,qe(!0);let Ii=0;const Ji=()=>{if($t.current)try{const bh=$t.current.querySelector("video");bh&&bh.remove(),as.play($t.current),console.log("CallsPage:  Playing local video in localVideoRef")}catch(bh){console.error("CallsPage: Error playing local video:",bh)}else Ii<10?(Ii++,setTimeout(Ji,200)):console.warn("CallsPage: localVideoRef.current is null after retries")};setTimeout(Ji,100),await Cn.publish([yn,as]),console.log("CallsPage:  Published audio and video tracks")}else await Cn.publish([yn]),console.log("CallsPage:  Published audio track");if(console.log("CallsPage: ========== INITIATING CALL =========="),console.log("CallsPage: Recipient ID:",T.id),console.log("CallsPage: Recipient name:",T.fullName),console.log("CallsPage: Channel name:",pt.channelName),console.log("CallsPage: Call type:",a==="meeting"?"video":a),console.log("CallsPage: Current user ID:",Be==null?void 0:Be.id),console.log("CallsPage: Current user name:",Be==null?void 0:Be.fullName),!Wt.current){console.error("CallsPage:  Socket ref is null!"),dt.error("Socket not initialized. Please refresh the page.");return}if(!Wt.current.connected){console.error("CallsPage:  Socket not connected! Connected:",Wt.current.connected),console.error("CallsPage: Socket ID:",Wt.current.id),dt.error("Not connected to server. Please refresh the page.");return}console.log("CallsPage:  Socket is connected, socket ID:",Wt.current.id);const nn={recipientId:T.id,channelName:pt.channelName,callType:a==="meeting"?"video":a,caller:{id:(Be==null?void 0:Be.id)||"",fullName:(Be==null?void 0:Be.fullName)||"Unknown",profilePicture:Be==null?void 0:Be.profilePicture},token:pt.token};console.log("CallsPage: Emitting call:initiate with data:",JSON.stringify(nn,null,2)),Wt.current.emit("call:initiate",nn),console.log("CallsPage:  Call initiation event emitted"),console.log("CallsPage: ===================================="),F({isInCall:!0,callType:a==="meeting"?"video":a,channelName:pt.channelName,remoteUser:T,isMuted:!1,isVideoOff:!1,callDuration:0}),Ge([]),ve(!1),qe(!1),ut.current=setInterval(()=>{F(as=>as?{...as,callDuration:as.callDuration+1}:null)},1e3),dt.success(`Calling ${T.fullName}...`)}catch(Ae){console.error("Error starting call:",Ae),dt.error("Failed to start call")}},xs=async()=>{var ae,Ae;if(P)try{const Be=Jn(),Ye=await fetch(`${ku}/api/calls/token`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Be}`},body:JSON.stringify({channelName:P.channelName,uid:0})});if(!Ye.ok){const nn=await Ye.json().catch(()=>({}));throw new Error(nn.error||"Failed to get token")}const pt=await Ye.json();console.log("Answering call with channel:",P.channelName,"token length:",(ae=pt.token)==null?void 0:ae.length);const Cn=di();await Cn.join(dG,P.channelName,pt.token,0),console.log("Joined Agora channel successfully");const yn=await Bg.createMicrophoneAudioTrack();if(xt.current=yn,P.callType==="video"){const nn=await Bg.createCameraVideoTrack();bt.current=nn,qe(!0);let as=0;const Ii=()=>{if($t.current)try{const Ji=$t.current.querySelector("video");Ji&&Ji.remove(),nn.play($t.current),console.log("CallsPage:  Playing local video in localVideoRef (answer call)")}catch(Ji){console.error("CallsPage: Error playing local video:",Ji)}else as<10?(as++,setTimeout(Ii,200)):console.warn("CallsPage: localVideoRef.current is null after retries")};setTimeout(Ii,100),await Cn.publish([yn,nn]),console.log("CallsPage:  Published audio and video tracks (answer call)")}else await Cn.publish([yn]),console.log("CallsPage:  Published audio track (answer call)");(Ae=Wt.current)==null||Ae.emit("call:accept",{channelName:P.channelName,callerId:P.caller.id}),F({isInCall:!0,callType:P.callType,channelName:P.channelName,remoteUser:P.caller,isMuted:!1,isVideoOff:!1,callDuration:0}),Ge([]),ve(!1),qe(!1),ut.current=setInterval(()=>{F(nn=>nn?{...nn,callDuration:nn.callDuration+1}:null)},1e3),M(null),dt.success("Call connected!")}catch(Be){console.error("Error answering call:",Be),dt.error(`Failed to answer call: ${Be.message||"Unknown error"}`)}},xo=()=>{var ae;P&&((ae=Wt.current)==null||ae.emit("call:reject",{channelName:P.channelName,callerId:P.caller.id}),M(null))},ws=async()=>{var ae,Ae,Be,Ye,pt,Cn,yn;try{if(ut.current&&(clearInterval(ut.current),ut.current=null),(ae=xt.current)==null||ae.close(),(Ae=bt.current)==null||Ae.close(),xt.current=null,bt.current=null,await((Be=We.current)==null?void 0:Be.leave()),ve(!1),qe(!1),Ge([]),tt(!1),j){(pt=Wt.current)==null||pt.emit("call:end",{channelName:j.channelName,recipientId:(Ye=j.remoteUser)==null?void 0:Ye.id});const nn={id:Date.now().toString(),contact:((Cn=j.remoteUser)==null?void 0:Cn.fullName)||"Unknown",contactId:((yn=j.remoteUser)==null?void 0:yn.id)||"",type:j.callType,when:new Date().toLocaleTimeString(),duration:wo(j.callDuration),status:"completed"};B(as=>[nn,...as])}F(null)}catch(nn){console.error("Error ending call:",nn)}},hi=()=>{if(xt.current&&j){const ae=!j.isMuted;xt.current.setEnabled(!ae),F({...j,isMuted:ae})}},os=()=>{if(bt.current&&j){const ae=!j.isVideoOff;bt.current.setEnabled(!ae),qe(!ae),F({...j,isVideoOff:ae})}},wo=ae=>{const Ae=Math.floor(ae/60),Be=ae%60;return`${Ae}:${Be.toString().padStart(2,"0")}`},Ai=()=>{const ae=`meet-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,Ae=`${window.location.origin}/join/${ae}`;ue(Ae)},qa=()=>{navigator.clipboard.writeText(ie),Ne(!0),dt.success("Meeting link copied!"),setTimeout(()=>Ne(!1),2e3)},De=async()=>{try{const ae=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0});dt.success("Devices working correctly!"),ae.getTracks().forEach(Ae=>Ae.stop())}catch{dt.error("Failed to access devices. Please check permissions.")}},Ie=ae=>{const Ae=_.find(Be=>Be.id===ae.contactId);Ae&&(R(Ae),f(Ae.fullName),c(ae.type))},Pe=()=>{var Be;if(!Xe.trim()||!j)return;const ae=jr(),Ae={id:Date.now().toString(),sender:(ae==null?void 0:ae.fullName)||"You",senderId:(ae==null?void 0:ae.id)||"",text:Xe.trim(),timestamp:new Date};Ge([...Se,Ae]),(Be=Wt.current)==null||Be.emit("call:message",{channelName:j.channelName,message:Ae}),Re("")};if(V.useEffect(()=>{if(!Wt.current||!j)return;const ae=Ae=>{Ae.channelName===j.channelName&&Ge(Be=>[...Be,Ae.message])};return Wt.current.on("call:message",ae),()=>{var Ae;(Ae=Wt.current)==null||Ae.off("call:message",ae)}},[j]),j!=null&&j.isInCall){const ae=jr(),Ae=((at=(ze=j.remoteUser)==null?void 0:ze.fullName)==null?void 0:at.split(" ").map(Ye=>Ye[0]).join("").toUpperCase().slice(0,2))||"?",Be=((ft=ae==null?void 0:ae.fullName)==null?void 0:ft.split(" ").map(Ye=>Ye[0]).join("").toUpperCase().slice(0,2))||"?";return d.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden bg-[#202124] relative",children:[d.jsx("div",{className:"absolute top-4 left-4 z-20 flex items-center gap-4",children:d.jsx("div",{className:"bg-black/60 backdrop-blur-sm rounded-lg px-4 py-2 text-white text-sm border border-white/10",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"font-medium",children:wo(j.callDuration)}),d.jsx("span",{className:"text-gray-400",children:""}),d.jsx("span",{className:"text-gray-300",children:j.channelName.substring(0,12)})]})})}),d.jsx("div",{className:"absolute top-4 right-4 z-20",children:d.jsxs("div",{className:"bg-black/60 backdrop-blur-sm rounded-full px-3 py-1.5 text-white text-sm flex items-center gap-2 border border-white/10",children:[d.jsx(Nc,{className:"w-4 h-4"}),d.jsx("span",{className:"font-medium",children:"2"})]})}),d.jsxs("div",{className:"flex-1 flex relative overflow-hidden",children:[d.jsxs("div",{className:`flex-1 relative flex items-center justify-center transition-all duration-300 ${Ce?"mr-80":""}`,children:[d.jsx("div",{ref:vt,className:"absolute inset-0 w-full h-full bg-[#1a1a1a] flex items-center justify-center",style:{minHeight:"100%"},children:(!le||j.callType==="voice")&&d.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-48 h-48 rounded-full bg-[#3c4043] flex items-center justify-center mb-6 mx-auto shadow-2xl",children:d.jsx("span",{className:"text-6xl font-medium text-white",children:Ae})}),d.jsx("p",{className:"text-white text-2xl font-medium",children:((Rt=j.remoteUser)==null?void 0:Rt.fullName)||"Unknown"}),j.callType==="video"&&!le&&d.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Waiting for video..."})]})})}),j.callType==="video"&&d.jsxs("div",{className:"absolute bottom-6 right-6 w-72 h-54 rounded-xl overflow-hidden bg-[#1a1a1a] border-2 border-white/30 shadow-2xl z-10",children:[d.jsx("div",{ref:$t,className:"w-full h-full bg-[#1a1a1a] flex items-center justify-center",style:{minHeight:"100%"},children:(j.isVideoOff||!Le)&&d.jsx("div",{className:"absolute inset-0 w-full h-full flex items-center justify-center bg-[#3c4043] z-10",children:d.jsx("span",{className:"text-4xl font-medium text-white",children:Be})})}),d.jsx("div",{className:"absolute bottom-2 left-2 bg-black/70 backdrop-blur-sm rounded px-2 py-1 text-white text-xs font-medium",children:(ae==null?void 0:ae.fullName)||"You"})]})]}),Ce&&d.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-80 bg-[#1f1f1f] border-l border-white/10 flex flex-col z-30 shadow-2xl",children:[d.jsxs("div",{className:"px-4 py-3 border-b border-white/10 flex items-center justify-between",children:[d.jsx("h3",{className:"text-white font-medium text-sm",children:"Chat"}),d.jsx("button",{onClick:()=>tt(!1),className:"text-gray-400 hover:text-white transition-colors",children:d.jsx(yo,{className:"w-4 h-4"})})]}),d.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:Se.length===0?d.jsxs("div",{className:"text-center text-gray-400 text-sm mt-8",children:[d.jsx(pl,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),d.jsx("p",{children:"No messages yet"})]}):Se.map(Ye=>{const pt=Ye.senderId===(ae==null?void 0:ae.id);return d.jsx("div",{className:`flex ${pt?"justify-end":"justify-start"}`,children:d.jsxs("div",{className:`max-w-[75%] rounded-lg px-3 py-2 ${pt?"bg-[#0b57d0] text-white":"bg-[#3c4043] text-white"}`,children:[!pt&&d.jsx("p",{className:"text-xs text-gray-300 mb-1",children:Ye.sender}),d.jsx("p",{className:"text-sm",children:Ye.text}),d.jsx("p",{className:`text-xs mt-1 ${pt?"text-blue-100":"text-gray-400"}`,children:new Date(Ye.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},Ye.id)})}),d.jsx("div",{className:"px-4 py-3 border-t border-white/10",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("input",{type:"text",value:Xe,onChange:Ye=>Re(Ye.target.value),onKeyPress:Ye=>Ye.key==="Enter"&&Pe(),placeholder:"Type a message...",className:"flex-1 bg-[#3c4043] text-white placeholder-gray-400 rounded-lg px-3 py-2 text-sm border border-white/10 focus:outline-none focus:ring-2 focus:ring-[#0b57d0]"}),d.jsx("button",{onClick:Pe,disabled:!Xe.trim(),className:"p-2 bg-[#0b57d0] text-white rounded-lg hover:bg-[#0d47a1] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d.jsx(O0,{className:"w-4 h-4"})})]})})]})]}),d.jsx("div",{className:"bg-[#1f1f1f] border-t border-white/10 px-6 py-4 z-20",children:d.jsxs("div",{className:"max-w-6xl mx-auto flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-4 text-white text-sm",children:[d.jsx("span",{children:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),d.jsx("span",{className:"text-gray-400",children:""}),d.jsx("span",{className:"text-gray-400",children:j.channelName.substring(0,12)})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:hi,className:`p-3 rounded-full transition-all ${j.isMuted?"bg-[#ea4335] text-white hover:bg-[#d33b2c]":"bg-[#3c4043] text-white hover:bg-[#5f6368]"}`,title:j.isMuted?"Unmute":"Mute",children:j.isMuted?d.jsx(Yge,{className:"w-5 h-5"}):d.jsx(mA,{className:"w-5 h-5"})}),j.callType==="video"&&d.jsx("button",{onClick:os,className:`p-3 rounded-full transition-all ${j.isVideoOff?"bg-[#ea4335] text-white hover:bg-[#d33b2c]":"bg-[#3c4043] text-white hover:bg-[#5f6368]"}`,title:j.isVideoOff?"Turn on camera":"Turn off camera",children:j.isVideoOff?d.jsx(s0e,{className:"w-5 h-5"}):d.jsx(eb,{className:"w-5 h-5"})}),d.jsx("button",{onClick:()=>tt(!Ce),className:`p-3 rounded-full transition-all ${Ce?"bg-[#0b57d0] text-white hover:bg-[#0d47a1]":"bg-[#3c4043] text-white hover:bg-[#5f6368]"}`,title:Ce?"Hide chat":"Show chat",children:d.jsx(pl,{className:"w-5 h-5"})}),d.jsx("button",{onClick:ws,className:"p-4 rounded-full bg-[#ea4335] text-white hover:bg-[#d33b2c] transition-all ml-4",title:"End call",children:d.jsx(t$,{className:"w-6 h-6"})})]}),d.jsx("div",{className:"flex items-center gap-3 text-white text-sm",children:d.jsxs("div",{className:"flex items-center gap-2 bg-black/30 rounded-full px-3 py-1.5",children:[d.jsx(Nc,{className:"w-4 h-4"}),d.jsx("span",{children:"2"})]})})]})})]})}return d.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:[P&&d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[9999] flex items-center justify-center p-4 animate-in fade-in duration-200",children:d.jsxs("div",{className:`${Jt} rounded-2xl ${Gt} p-8 max-w-md w-full text-center border-2 ${s?"border-blue-500/50":"border-blue-500"}`,children:[d.jsxs("div",{className:"relative mb-6",children:[d.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center mx-auto shadow-2xl animate-pulse",children:P.caller.profilePicture?d.jsx("img",{src:P.caller.profilePicture,alt:P.caller.fullName,className:"w-full h-full rounded-full object-cover"}):d.jsx("span",{className:"text-4xl font-bold text-white",children:((Ze=P.caller.fullName)==null?void 0:Ze.charAt(0))||"?"})}),d.jsxs("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:[d.jsx("div",{className:"absolute w-24 h-24 rounded-full border-4 border-blue-500 animate-ping opacity-75"}),d.jsx("div",{className:"absolute w-32 h-32 rounded-full border-4 border-blue-400 animate-ping opacity-50",style:{animationDelay:"0.5s"}})]})]}),d.jsx("h3",{className:`text-2xl font-bold ${be} mb-2`,children:P.caller.fullName||"Unknown Caller"}),d.jsx("p",{className:`${ht} mb-2 text-lg`,children:P.callType==="video"?" Video Call":" Voice Call"}),d.jsx("p",{className:`${ht} mb-8 text-sm`,children:"Incoming call..."}),d.jsxs("div",{className:"flex gap-4 justify-center",children:[d.jsx("button",{onClick:xo,className:"p-5 rounded-full bg-red-500 text-white hover:bg-red-600 transition-all transform hover:scale-110 shadow-lg",title:"Decline",children:d.jsx(t$,{className:"w-7 h-7"})}),d.jsx("button",{onClick:xs,className:"p-5 rounded-full bg-green-500 text-white hover:bg-green-600 transition-all transform hover:scale-110 shadow-lg",title:"Answer",children:d.jsx(wd,{className:"w-7 h-7"})})]}),d.jsx("p",{className:`${ht} text-xs mt-6`,children:"Press the buttons above to answer or decline"})]})}),d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 max-w-7xl mx-auto",children:[d.jsxs("section",{className:`${Jt} border ${Dt} rounded-[22px] ${Gt} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${Dt} ${At}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${be}`,children:"Start a Call"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:yr,disabled:N,className:`p-1.5 rounded-lg transition-colors ${ln} disabled:opacity-50`,title:"Refresh users",children:d.jsx(Zv,{className:`w-4 h-4 ${ht} ${N?"animate-spin":""}`})}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${Mn} ${Ln} ${ht} text-xs`,children:"Voice  Video"})]})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"flex flex-wrap gap-2",children:[d.jsxs("button",{onClick:()=>c("voice"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${a==="voice"?bn:ln}`,children:[d.jsx(wd,{className:"w-4 h-4 inline mr-2"}),"Voice call"]}),d.jsxs("button",{onClick:()=>c("video"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${a==="video"?bn:ln}`,children:[d.jsx(eb,{className:"w-4 h-4 inline mr-2"}),"Video call"]}),d.jsxs("button",{onClick:()=>{c("meeting"),Ai()},className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${a==="meeting"?bn:ln}`,children:[d.jsx(Wge,{className:"w-4 h-4 inline mr-2"}),"Create meeting"]})]}),a==="meeting"&&ie&&d.jsxs("div",{className:`p-3 rounded-lg ${vn} border ${Xn}`,children:[d.jsx("p",{className:`text-xs ${ht} mb-2`,children:"Meeting Link:"}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("input",{type:"text",value:ie,readOnly:!0,className:`flex-1 px-3 py-2 rounded-lg ${vn} border ${Xn} ${Mr} text-sm`}),d.jsx("button",{onClick:qa,className:`px-3 py-2 rounded-lg border ${bn}`,children:de?d.jsx(nO,{className:"w-4 h-4"}):d.jsx(Lge,{className:"w-4 h-4"})})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${ht}`,htmlFor:"dial",children:"Search user to call"}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("input",{id:"dial",type:"text",value:h,onChange:ae=>f(ae.target.value),placeholder:"Type a name...",className:`flex-1 px-3 py-2 rounded-lg ${vn} border ${Xn} ${Mr} text-sm ${So} focus:outline-none focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`}),d.jsx("button",{onClick:ui,disabled:!T,className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${T?bn:ln} disabled:opacity-50 disabled:cursor-not-allowed`,children:"Call"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("label",{className:`block text-xs ${ht}`,children:N?"Loading users...":v.length>0?`Available Users (${v.length}${_.length!==v.length?` of ${_.length}`:""})`:_.length>0?`No matches (${_.length} total)`:"No users found"}),_.length>0&&v.length===0&&h&&d.jsx("button",{onClick:()=>f(""),className:`text-xs ${bn} px-2 py-1 rounded`,children:"Clear"})]}),N?d.jsxs("div",{className:`p-4 text-center rounded-lg border ${Xn} ${ht} text-sm`,children:[d.jsx(Zv,{className:"w-5 h-5 animate-spin mx-auto mb-2"}),d.jsx("p",{children:"Loading users..."})]}):v.length>0?d.jsx("div",{className:`max-h-60 overflow-y-auto rounded-lg border ${Xn}`,children:v.map(ae=>{var Ae;return!ae||!ae.id||!ae.fullName?null:d.jsxs("button",{onClick:()=>{R(ae),f(ae.fullName)},className:`w-full px-3 py-2.5 text-left flex items-center gap-3 transition-colors border-b ${Xn} last:border-b-0 ${(T==null?void 0:T.id)===ae.id?bn:`${s?"hover:bg-gray-800":"hover:bg-gray-100"}`}`,children:[d.jsx("div",{className:`w-10 h-10 rounded-full ${s?"bg-gray-700":"bg-gray-300"} flex items-center justify-center flex-shrink-0`,children:ae.profilePicture?d.jsx("img",{src:ae.profilePicture,alt:ae.fullName,className:"w-full h-full object-cover rounded-full"}):d.jsx("span",{className:`text-sm font-medium ${be}`,children:((Ae=ae.fullName)==null?void 0:Ae.charAt(0))||"?"})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("p",{className:`text-sm font-medium ${be} truncate`,children:ae.fullName}),ae.isOnline&&d.jsx("span",{className:`w-2 h-2 rounded-full ${s?"bg-green-400":"bg-green-500"} flex-shrink-0 ml-2`,title:"Online"})]}),d.jsx("p",{className:`text-xs ${ae.isOnline?"text-green-500":ht}`,children:ae.isOnline?"Online":"Offline"})]})]},ae.id)})}):_.length===0?d.jsxs("div",{className:`p-4 text-center rounded-lg border ${Xn} ${ht} text-sm`,children:[d.jsx(Nc,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),d.jsx("p",{className:"font-medium mb-1",children:"No users available"}),d.jsx("p",{className:"text-xs",children:"Please check your connection or try refreshing"}),d.jsxs("button",{onClick:yr,className:`mt-3 text-xs ${bn} px-4 py-2 rounded`,children:[d.jsx(Zv,{className:"w-3 h-3 inline mr-1"}),"Refresh"]})]}):d.jsxs("div",{className:`p-4 text-center rounded-lg border ${Xn} ${ht} text-sm`,children:[d.jsxs("p",{className:"font-medium mb-1",children:['No users match "',h,'"']}),d.jsxs("p",{className:"text-xs mb-2",children:["Found ",_.length," user",_.length!==1?"s":""," total"]}),d.jsx("button",{onClick:()=>f(""),className:`text-xs ${bn} px-4 py-2 rounded`,children:"Clear search"})]})]})]})]}),d.jsxs("section",{className:`${Jt} border ${Dt} rounded-[22px] ${Gt} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${Dt} ${At}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${be}`,children:"Device Check"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${Mn} ${Ln} ${ht} text-xs`,children:"Audio/Video"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("select",{value:te.microphone,onChange:ae=>se({...te,microphone:ae.target.value}),className:`flex-1 px-3 py-2 rounded-lg ${vn} border ${Xn} ${Mr} text-sm focus:outline-none focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`,children:[d.jsx("option",{value:"",children:"Microphone (default)"}),K.microphones.map(ae=>d.jsx("option",{value:ae.deviceId,children:ae.label||"Microphone"},ae.deviceId))]}),d.jsxs("select",{value:te.speaker,onChange:ae=>se({...te,speaker:ae.target.value}),className:`flex-1 px-3 py-2 rounded-lg ${vn} border ${Xn} ${Mr} text-sm focus:outline-none focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`,children:[d.jsx("option",{value:"",children:"Speaker (default)"}),K.speakers.map(ae=>d.jsx("option",{value:ae.deviceId,children:ae.label||"Speaker"},ae.deviceId))]})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("select",{value:te.camera,onChange:ae=>se({...te,camera:ae.target.value}),className:`flex-1 px-3 py-2 rounded-lg ${vn} border ${Xn} ${Mr} text-sm focus:outline-none focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`,children:[d.jsx("option",{value:"",children:"Camera (default)"}),K.cameras.map(ae=>d.jsx("option",{value:ae.deviceId,children:ae.label||"Camera"},ae.deviceId))]}),d.jsx("button",{onClick:De,className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${ln}`,children:"Test"})]}),d.jsx("p",{className:`text-xs ${ht}`,children:"Select your preferred devices for calls."})]})]}),d.jsxs("section",{className:`lg:col-span-2 ${Jt} border ${Dt} rounded-[22px] ${Gt} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${Dt} ${At}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${be}`,children:"Recent Calls"}),d.jsxs("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${Mn} ${Ln} ${ht} text-xs`,children:[U.length," calls"]})]}),d.jsx("div",{className:"p-4",children:U.length===0?d.jsxs("div",{className:"text-center py-8",children:[d.jsx(oO,{className:`w-12 h-12 ${ht} mx-auto mb-3 opacity-50`}),d.jsx("p",{className:`${ht}`,children:"No recent calls"}),d.jsx("p",{className:`text-xs ${ht} mt-1`,children:"Your call history will appear here"})]}):d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${ir} px-2 py-2.5 text-left text-xs font-semibold ${ht}`,children:"Contact"}),d.jsx("th",{className:`border-b ${ir} px-2 py-2.5 text-left text-xs font-semibold ${ht}`,children:"Type"}),d.jsx("th",{className:`border-b ${ir} px-2 py-2.5 text-left text-xs font-semibold ${ht}`,children:"When"}),d.jsx("th",{className:`border-b ${ir} px-2 py-2.5 text-left text-xs font-semibold ${ht}`,children:"Duration"}),d.jsx("th",{className:`border-b ${ir} px-2 py-2.5 text-left text-xs font-semibold ${ht}`,children:"Action"})]})}),d.jsx("tbody",{children:U.map(ae=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${ir} px-2 py-2.5 ${be}`,children:ae.contact}),d.jsxs("td",{className:`border-b ${ir} px-2 py-2.5 ${be}`,children:[ae.type==="video"?d.jsx(eb,{className:"w-4 h-4 inline"}):d.jsx(wd,{className:"w-4 h-4 inline"}),d.jsx("span",{className:"ml-1 capitalize",children:ae.type})]}),d.jsx("td",{className:`border-b ${ir} px-2 py-2.5 ${be}`,children:ae.when}),d.jsx("td",{className:`border-b ${ir} px-2 py-2.5 ${be}`,children:ae.duration}),d.jsx("td",{className:`border-b ${ir} px-2 py-2.5 ${be}`,children:d.jsx("button",{onClick:()=>Ie(ae),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${ln}`,children:"Call back"})})]},ae.id))})]})})]})]})})]})},qNe=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",x=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",T=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",R=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",N=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",L=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",j=s?"text-[#e7eefc]":"text-[#0f172a]",F=s?"placeholder-[#9bb0d0]":"placeholder-[#475569]",P=s?"bg-[rgba(255,255,255,0.09)]":"bg-[rgba(15,23,42,0.10)]",M=[];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 max-w-7xl mx-auto",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Favorites"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${x} ${v} ${_} text-xs`,children:"Quick"})]}),d.jsxs("div",{className:"p-4 space-y-3",children:[M.map((U,B)=>d.jsx("button",{className:`w-full px-4 py-2.5 rounded-lg text-sm font-medium transition-colors border text-left ${R}`,children:U},B)),d.jsx("p",{className:`text-xs ${_}`,children:"Pin contacts for fast calls & chats."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"All Contacts"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${x} ${v} ${_} text-xs`,children:"Directory"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("button",{className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors border ${R}`,children:[d.jsx(Md,{className:"w-4 h-4 inline mr-1"}),"New contact"]}),d.jsxs("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors border ${R}`,children:[d.jsx(fH,{className:"w-4 h-4 inline mr-1"}),"Import"]}),d.jsxs("button",{className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors border ${R}`,children:[d.jsx(r0e,{className:"w-4 h-4 inline mr-1"}),"Export"]})]}),d.jsxs("div",{className:`p-3 rounded-lg border ${c} ${h}`,children:[d.jsxs("div",{className:"mb-2",children:[d.jsx("div",{className:`text-sm font-semibold ${f} mb-1`,children:"Alex N."}),d.jsxs("div",{className:`text-xs ${_} space-y-0.5`,children:[d.jsx("div",{children:"IRU ID: "}),d.jsx("div",{children:"Company  Role  Notes..."})]})]}),d.jsxs("div",{className:"flex gap-2 mt-3",children:[d.jsx("button",{className:`flex-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${T}`,children:"Chat"}),d.jsxs("button",{className:`flex-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${R}`,children:[d.jsx(oO,{className:"w-3 h-3 inline mr-1"}),"Call"]}),d.jsx("button",{className:`flex-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${R}`,children:"Profile"})]})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Replace with search + pagination."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Contact Profile"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${x} ${v} ${_} text-xs`,children:"Details"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsx("p",{className:`text-xs ${_}`,children:"Select a contact to populate this panel."}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:`text-sm ${f}`,children:"Name"}),d.jsx("span",{className:`text-sm ${_}`,children:""})]}),d.jsx("div",{className:`h-px ${P}`}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:`text-sm ${f}`,children:"Phone"}),d.jsx("span",{className:`text-sm ${_}`,children:""})]}),d.jsx("div",{className:`h-px ${P}`}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:`text-sm ${f}`,children:"Email"}),d.jsx("span",{className:`text-sm ${_}`,children:""})]})]}),d.jsx("div",{className:`h-px ${P}`}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,htmlFor:"notes",children:"Notes"}),d.jsx("textarea",{id:"notes",rows:5,placeholder:"Internal notes",className:`w-full px-3 py-2 rounded-lg ${N} border ${L} ${j} text-sm ${F} focus:outline-none focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"} resize-none`}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${T}`,children:"Save notes"})]})]})]})]})})})},XNe=()=>{const{theme:r}=sr(),s=r==="dark",[a,c]=V.useState(""),[h,f]=V.useState(""),[_,E]=V.useState("Training"),[v,x]=V.useState(!0),[T,R]=V.useState(!0),[N,L]=V.useState(!1),[j,F]=V.useState("upcoming"),P=s?"bg-[#101828]":"bg-white",M=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",U=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",B=s?"text-[#e7eefc]":"text-[#0f172a]",K=s?"text-[#9bb0d0]":"text-[#475569]",J=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",te=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",se=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",ie=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",ue=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",de=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",Ne=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",Ce=s?"text-[#e7eefc]":"text-[#0f172a]",tt=s?"placeholder-[#9bb0d0]":"placeholder-[#475569]",Se=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",Ge=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",Xe=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",Re=[{title:"Weekly Update",status:"Upcoming",when:"",visibility:"Org",action:"Open"},{title:"Training Session",status:"Past",when:"",visibility:"Private",action:"Replay"}];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 max-w-7xl mx-auto",children:[d.jsxs("section",{className:`${P} border ${M} rounded-[22px] ${J} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${M} ${U}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${B}`,children:"Go Live"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${se} ${te} ${K} text-xs`,children:"Broadcast"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${K}`,htmlFor:"streamTitle",children:"Title"}),d.jsx("input",{id:"streamTitle",type:"text",value:a,onChange:le=>c(le.target.value),placeholder:"e.g., Weekly IRU Update",className:`w-full px-3 py-2 rounded-lg ${de} border ${Ne} ${Ce} text-sm ${tt} focus:outline-none focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${K}`,htmlFor:"streamDescription",children:"Description"}),d.jsx("textarea",{id:"streamDescription",value:h,onChange:le=>f(le.target.value),placeholder:"What's this stream about?",rows:4,className:`w-full px-3 py-2 rounded-lg ${de} border ${Ne} ${Ce} text-sm ${tt} focus:outline-none focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"} resize-none`})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${K}`,htmlFor:"organization",children:"Organization"}),d.jsxs("select",{id:"organization",value:_,onChange:le=>E(le.target.value),className:`w-full px-3 py-2 rounded-lg ${de} border ${Ne} ${Ce} text-sm focus:outline-none focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`,children:[d.jsx("option",{children:"Training"}),d.jsx("option",{children:"Development"}),d.jsx("option",{children:"Marketing"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:v,onChange:le=>x(le.target.checked),className:`w-4 h-4 rounded ${Ne} ${de} ${s?"text-[#6ea8ff]":"text-[#2563eb]"} focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`}),d.jsx("span",{className:`text-sm ${B}`,children:"Enable chat"})]}),d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:T,onChange:le=>R(le.target.checked),className:`w-4 h-4 rounded ${Ne} ${de} ${s?"text-[#6ea8ff]":"text-[#2563eb]"} focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`}),d.jsx("span",{className:`text-sm ${B}`,children:"Enable Q&A"})]}),d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:N,onChange:le=>L(le.target.checked),className:`w-4 h-4 rounded ${Ne} ${de} ${s?"text-[#6ea8ff]":"text-[#2563eb]"} focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`}),d.jsx("span",{className:`text-sm ${B}`,children:"Enable recording"})]})]}),d.jsx("button",{className:`w-full px-4 py-2.5 rounded-lg text-sm font-medium transition-colors border ${ie}`,children:"Start Stream"}),d.jsx("p",{className:`text-xs ${K}`,children:"Wireframe: integrate RTMP/WebRTC + moderation tools."})]})]}),d.jsxs("section",{className:`${P} border ${M} rounded-[22px] ${J} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${M} ${U}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${B}`,children:"Live Session"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${se} ${te} ${K} text-xs`,children:"Player"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsx("div",{className:`aspect-video rounded-lg ${de} border ${Ne} flex items-center justify-center`,children:d.jsx("p",{className:`text-sm ${K}`,children:"Video player placeholder"})}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{className:`p-3 rounded-lg border ${M} ${U}`,children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("span",{className:`text-xs font-medium ${B}`,children:"Chat"}),d.jsx("span",{className:`inline-flex items-center justify-center px-1.5 py-0.5 rounded-full border ${se} ${te} ${K} text-[10px]`,children:"Live"})]}),d.jsx("p",{className:`text-xs ${K}`,children:"Messages appear here..."})]}),d.jsxs("div",{className:`p-3 rounded-lg border ${M} ${U}`,children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("span",{className:`text-xs font-medium ${B}`,children:"Q&A"}),d.jsx("span",{className:`inline-flex items-center justify-center px-1.5 py-0.5 rounded-full border ${se} ${te} ${K} text-[10px]`,children:"Queue"})]}),d.jsx("p",{className:`text-xs ${K}`,children:"Questions appear here..."})]})]})]})]}),d.jsxs("section",{className:`lg:col-span-2 ${P} border ${M} rounded-[22px] ${J} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${M} ${U}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${B}`,children:"Streams"}),d.jsxs("div",{className:"flex gap-1",children:[d.jsx("button",{onClick:()=>F("upcoming"),className:`px-2 py-1 rounded-full text-xs font-medium transition-colors border ${j==="upcoming"?Ge:Xe}`,children:"Upcoming"}),d.jsx("button",{onClick:()=>F("past"),className:`px-2 py-1 rounded-full text-xs font-medium transition-colors border ${j==="past"?Ge:Xe}`,children:"Past"})]})]}),d.jsxs("div",{className:"p-4",children:[d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${Se} px-2 py-2.5 text-left text-xs font-semibold ${K}`,children:"Title"}),d.jsx("th",{className:`border-b ${Se} px-2 py-2.5 text-left text-xs font-semibold ${K}`,children:"Status"}),d.jsx("th",{className:`border-b ${Se} px-2 py-2.5 text-left text-xs font-semibold ${K}`,children:"When"}),d.jsx("th",{className:`border-b ${Se} px-2 py-2.5 text-left text-xs font-semibold ${K}`,children:"Visibility"}),d.jsx("th",{className:`border-b ${Se} px-2 py-2.5 text-left text-xs font-semibold ${K}`,children:"Action"})]})}),d.jsx("tbody",{children:Re.map((le,ve)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${Se} px-2 py-2.5 ${B}`,children:le.title}),d.jsx("td",{className:`border-b ${Se} px-2 py-2.5 ${B}`,children:le.status}),d.jsx("td",{className:`border-b ${Se} px-2 py-2.5 ${B}`,children:le.when}),d.jsx("td",{className:`border-b ${Se} px-2 py-2.5 ${B}`,children:le.visibility}),d.jsx("td",{className:`border-b ${Se} px-2 py-2.5 ${B}`,children:d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${ue}`,children:le.action})})]},ve))})]}),d.jsx("p",{className:`text-xs ${K} mt-4`,children:"Store stream metadata + recordings links here."})]})]})]})})})},JNe=()=>{const{theme:r}=sr(),s=r==="dark",[a,c]=V.useState(""),h=s?"bg-[#101828]":"bg-white",f=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",_=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",E=s?"text-[#e7eefc]":"text-[#0f172a]",v=s?"text-[#9bb0d0]":"text-[#475569]",x=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",T=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",R=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",N=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",L=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",j=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",F=s?"text-[#e7eefc]":"text-[#0f172a]",P=s?"placeholder-[#9bb0d0]":"placeholder-[#475569]",M=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",U=s?"bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.05)]",B=[{chat:"Client",snippet:'"Proposal..."',date:""}],K=[{contact:"Support",type:"Voice",when:"",result:"Completed"},{contact:"Client",type:"Video",when:"",result:"Missed"}];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 max-w-7xl mx-auto",children:[d.jsxs("section",{className:`${h} border ${f} rounded-[22px] ${x} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${f} ${_}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${E}`,children:"Message History"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"flex gap-2",children:[d.jsx("input",{type:"text",value:a,onChange:J=>c(J.target.value),placeholder:"Search messages...",className:`flex-1 px-3 py-2 rounded-lg ${L} border ${j} ${F} text-sm ${P} focus:outline-none focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`}),d.jsx("button",{className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${N}`,children:"Search"})]}),d.jsx("button",{className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${N}`,children:"Filter"}),d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${M} px-2 py-2.5 text-left text-xs font-semibold ${v}`,children:"Chat"}),d.jsx("th",{className:`border-b ${M} px-2 py-2.5 text-left text-xs font-semibold ${v}`,children:"Snippet"}),d.jsx("th",{className:`border-b ${M} px-2 py-2.5 text-left text-xs font-semibold ${v}`,children:"Date"})]})}),d.jsx("tbody",{children:B.map((J,te)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${M} px-2 py-2.5 ${E}`,children:J.chat}),d.jsx("td",{className:`border-b ${M} px-2 py-2.5 ${E}`,children:J.snippet}),d.jsx("td",{className:`border-b ${M} px-2 py-2.5 ${E}`,children:J.date})]},te))})]})]})]}),d.jsxs("section",{className:`${h} border ${f} rounded-[22px] ${x} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${f} ${_}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${E}`,children:"Call History"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${N}`,children:"Logs"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${M} px-2 py-2.5 text-left text-xs font-semibold ${v}`,children:"Contact"}),d.jsx("th",{className:`border-b ${M} px-2 py-2.5 text-left text-xs font-semibold ${v}`,children:"Type"}),d.jsx("th",{className:`border-b ${M} px-2 py-2.5 text-left text-xs font-semibold ${v}`,children:"When"}),d.jsx("th",{className:`border-b ${M} px-2 py-2.5 text-left text-xs font-semibold ${v}`,children:"Result"})]})}),d.jsx("tbody",{children:K.map((J,te)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${M} px-2 py-2.5 ${E}`,children:J.contact}),d.jsx("td",{className:`border-b ${M} px-2 py-2.5 ${E}`,children:J.type}),d.jsx("td",{className:`border-b ${M} px-2 py-2.5 ${E}`,children:J.when}),d.jsx("td",{className:`border-b ${M} px-2 py-2.5 ${E}`,children:d.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs ${U} ${E}`,children:J.result})})]},te))})]}),d.jsx("p",{className:`text-xs ${v}`,children:"If recording is enabled, surface links here (policy-based)."})]})]}),d.jsxs("section",{className:`lg:col-span-2 ${h} border ${f} rounded-[22px] ${x} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${f} ${_}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${E}`,children:"Sessions & Exports"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${R} ${T} ${v} text-xs`,children:"Security"})]}),d.jsx("div",{className:"p-4",children:d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsxs("div",{className:`p-4 rounded-lg border ${f} ${_}`,children:[d.jsx("h3",{className:`text-sm font-medium mb-2 ${E}`,children:"Active sessions"}),d.jsx("p",{className:`text-xs mb-4 ${v}`,children:"List devices, locations (approx), last active."}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${N}`,children:"Manage"})]}),d.jsxs("div",{className:`p-4 rounded-lg border ${f} ${_}`,children:[d.jsx("h3",{className:`text-sm font-medium mb-2 ${E}`,children:"Download my data"}),d.jsx("p",{className:`text-xs mb-4 ${v}`,children:"Request export (async job)."}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${N}`,children:"Request"})]}),d.jsxs("div",{className:`p-4 rounded-lg border ${f} ${_}`,children:[d.jsx("h3",{className:`text-sm font-medium mb-2 ${E}`,children:"Audit"}),d.jsx("p",{className:`text-xs mb-4 ${v}`,children:"Personal audit logs."}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${N}`,children:"View"})]})]})})]})]})})})},QNe=()=>{const{theme:r}=sr(),s=r==="dark",[a,c]=V.useState("primary"),h=s?"bg-[#101828]":"bg-white",f=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",_=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",E=s?"text-[#e7eefc]":"text-[#0f172a]",v=s?"text-[#9bb0d0]":"text-[#475569]",x=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",T=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",R=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",N=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",L=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",j=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",F=[{item:"",status:"",updated:""},{item:"",status:"",updated:""}];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 max-w-7xl mx-auto",children:[d.jsxs("section",{className:`${h} border ${f} rounded-[22px] ${x} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 border-b ${f} ${_}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${E}`,children:"Action Board"}),d.jsx("p",{className:`text-xs mt-1 mb-0 ${v}`,children:"Tasks extracted from chats with owners, due dates, reminders."})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{onClick:()=>c("primary"),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors border ${a==="primary"?L:j}`,children:"Primary action"}),d.jsx("button",{onClick:()=>c("secondary"),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors border ${a==="secondary"?L:j}`,children:"Secondary"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("h3",{className:`text-xs font-medium ${E}`,children:"Suggested components:"}),d.jsxs("ul",{className:`space-y-1.5 list-disc list-inside ${v} text-xs`,children:[d.jsx("li",{children:"Task extraction from messages"}),d.jsx("li",{children:"Assign owner + due date"}),d.jsx("li",{children:"Reminders & escalation"}),d.jsx("li",{children:"Per-chat Action Board view"}),d.jsx("li",{children:"Export to CSV / Jira / Trello"})]})]})]})]}),d.jsxs("section",{className:`${h} border ${f} rounded-[22px] ${x} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${f} ${_}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${E}`,children:"Data Panel"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${R} ${T} ${v} text-xs`,children:"Placeholder"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${N} px-2 py-2.5 text-left text-xs font-semibold ${v}`,children:"Item"}),d.jsx("th",{className:`border-b ${N} px-2 py-2.5 text-left text-xs font-semibold ${v}`,children:"Status"}),d.jsx("th",{className:`border-b ${N} px-2 py-2.5 text-left text-xs font-semibold ${v}`,children:"Updated"})]})}),d.jsx("tbody",{children:F.map((P,M)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${N} px-2 py-2.5 ${E}`,children:P.item}),d.jsx("td",{className:`border-b ${N} px-2 py-2.5 ${E}`,children:P.status}),d.jsx("td",{className:`border-b ${N} px-2 py-2.5 ${E}`,children:P.updated})]},M))})]}),d.jsx("p",{className:`text-xs ${v}`,children:"Connect to your API + persistence layer."})]})]}),d.jsxs("section",{className:`lg:col-span-2 ${h} border ${f} rounded-[22px] ${x} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${f} ${_}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${E}`,children:"Notes"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${R} ${T} ${v} text-xs`,children:"Implementation"})]}),d.jsx("div",{className:"p-4",children:d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsxs("div",{className:`p-4 rounded-lg border ${f} ${_}`,children:[d.jsx("h3",{className:`text-sm font-medium mb-2 ${E}`,children:"Permissions"}),d.jsx("p",{className:`text-xs ${v}`,children:"Define RBAC access for this tool."})]}),d.jsxs("div",{className:`p-4 rounded-lg border ${f} ${_}`,children:[d.jsx("h3",{className:`text-sm font-medium mb-2 ${E}`,children:"Events"}),d.jsx("p",{className:`text-xs ${v}`,children:"Emit audit + analytics events."})]}),d.jsxs("div",{className:`p-4 rounded-lg border ${f} ${_}`,children:[d.jsx("h3",{className:`text-sm font-medium mb-2 ${E}`,children:"Integrations"}),d.jsx("p",{className:`text-xs ${v}`,children:"Webhooks / exports / automation hooks."})]})]})})]})]})})})},ZNe=()=>{const{theme:r}=sr(),s=r==="dark",[a,c]=V.useState(""),[h,f]=V.useState(""),[_,E]=V.useState("invite"),[v,x]=V.useState("Keep forever"),[T,R]=V.useState(!1),[N,L]=V.useState(!1),[j,F]=V.useState(!1),P=s?"bg-[#101828]":"bg-white",M=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",U=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",B=s?"text-[#e7eefc]":"text-[#0f172a]",K=s?"text-[#9bb0d0]":"text-[#475569]",J=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",te=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",se=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",ie=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",ue=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc] hover:bg-[rgba(110,168,255,0.20)]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a] hover:bg-[rgba(37,99,235,0.20)]",de=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",Ne=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",Ce=s?"text-[#e7eefc]":"text-[#0f172a]",tt=s?"placeholder-[#9bb0d0]":"placeholder-[#475569]",Se=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",Ge=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",Xe=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",Re=[{user:"admin@...",role:"Admin",status:"Active",action:"Manage"},{user:"member@...",role:"Member",status:"Invited",action:"Resend"}];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${B}`,children:"Enterprise Tools"}),d.jsx("p",{className:`text-sm ${K}`,children:"Org setup, RBAC, policies, audits, compliance."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${P} border ${M} rounded-[22px] ${J} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${M} ${U}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${B}`,children:"Organization"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${ie}`,children:"Setup"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${K}`,htmlFor:"orgName",children:"Org name"}),d.jsx("input",{id:"orgName",type:"text",value:a,onChange:le=>c(le.target.value),placeholder:"e.g., IRU Business Group Ltd",className:`w-full px-3 py-2 rounded-lg ${de} border ${Ne} ${Ce} text-sm ${tt} focus:outline-none focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${K}`,htmlFor:"domain",children:"Domain"}),d.jsx("input",{id:"domain",type:"text",value:h,onChange:le=>f(le.target.value),placeholder:"e.g., irubusinessgroup.com",className:`w-full px-3 py-2 rounded-lg ${de} border ${Ne} ${Ce} text-sm ${tt} focus:outline-none focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${ue}`,children:"Save"}),d.jsx("button",{className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${ie}`,children:"Branding"})]}),d.jsx("p",{className:`text-xs ${K}`,children:"Add logo upload, colors, and org profile here."})]})]}),d.jsxs("section",{className:`${P} border ${M} rounded-[22px] ${J} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${M} ${U}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${B}`,children:"Users & Access"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${ie}`,children:"RBAC"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"flex gap-1",children:[d.jsx("button",{onClick:()=>E("invite"),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-colors border ${_==="invite"?Ge:Xe}`,children:"Invite"}),d.jsx("button",{onClick:()=>E("groups"),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-colors border ${_==="groups"?Ge:Xe}`,children:"Groups"}),d.jsx("button",{onClick:()=>E("roles"),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-colors border ${_==="roles"?Ge:Xe}`,children:"Roles"})]}),d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${Se} px-2 py-2.5 text-left text-xs font-semibold ${K}`,children:"User"}),d.jsx("th",{className:`border-b ${Se} px-2 py-2.5 text-left text-xs font-semibold ${K}`,children:"Role"}),d.jsx("th",{className:`border-b ${Se} px-2 py-2.5 text-left text-xs font-semibold ${K}`,children:"Status"}),d.jsx("th",{className:`border-b ${Se} px-2 py-2.5 text-left text-xs font-semibold ${K}`,children:"Action"})]})}),d.jsx("tbody",{children:Re.map((le,ve)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${Se} px-2 py-2.5 ${B}`,children:le.user}),d.jsx("td",{className:`border-b ${Se} px-2 py-2.5 ${B}`,children:le.role}),d.jsx("td",{className:`border-b ${Se} px-2 py-2.5 ${B}`,children:le.status}),d.jsx("td",{className:`border-b ${Se} px-2 py-2.5 ${B}`,children:d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${ie}`,children:le.action})})]},ve))})]})]})]}),d.jsxs("section",{className:`lg:col-span-2 ${P} border ${M} rounded-[22px] ${J} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${M} ${U}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${B}`,children:"Policies & Compliance"}),d.jsxs("div",{className:"flex gap-1",children:[d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${se} ${te} ${K} text-xs`,children:"Retention"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${se} ${te} ${K} text-xs`,children:"Audit"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${se} ${te} ${K} text-xs`,children:"DLP"})]})]}),d.jsxs("div",{className:"p-4",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsxs("div",{className:`p-4 rounded-lg border ${M} ${U}`,children:[d.jsx("h3",{className:`text-sm font-medium mb-4 ${B}`,children:"Retention"}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("select",{value:v,onChange:le=>x(le.target.value),className:`w-full px-3 py-2 rounded-lg ${de} border ${Ne} ${Ce} text-sm focus:outline-none focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`,children:[d.jsx("option",{children:"Keep forever"}),d.jsx("option",{children:"30 days"}),d.jsx("option",{children:"90 days"}),d.jsx("option",{children:"1 year"})]}),d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:T,onChange:le=>R(le.target.checked),className:`w-4 h-4 rounded ${Ne} ${de} ${s?"text-[#6ea8ff]":"text-[#2563eb]"} focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`}),d.jsx("span",{className:`text-sm ${B}`,children:"Legal hold enabled"})]})]})]}),d.jsxs("div",{className:`p-4 rounded-lg border ${M} ${U}`,children:[d.jsx("h3",{className:`text-sm font-medium mb-2 ${B}`,children:"Audit Logs"}),d.jsx("p",{className:`text-xs mb-4 ${K}`,children:"Admin actions, sign-ins, exports."}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${ie}`,children:"View logs"}),d.jsx("button",{className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${ie}`,children:"Export CSV"})]})]}),d.jsxs("div",{className:`p-4 rounded-lg border ${M} ${U}`,children:[d.jsx("h3",{className:`text-sm font-medium mb-4 ${B}`,children:"DLP"}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:N,onChange:le=>L(le.target.checked),className:`w-4 h-4 rounded ${Ne} ${de} ${s?"text-[#6ea8ff]":"text-[#2563eb]"} focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`}),d.jsx("span",{className:`text-sm ${B}`,children:"Block executable files"})]}),d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:j,onChange:le=>F(le.target.checked),className:`w-4 h-4 rounded ${Ne} ${de} ${s?"text-[#6ea8ff]":"text-[#2563eb]"} focus:ring-2 ${s?"focus:ring-[rgba(110,168,255,0.35)]":"focus:ring-[rgba(37,99,235,0.35)]"}`}),d.jsx("span",{className:`text-sm ${B}`,children:"Detect sensitive keywords"})]}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${ie}`,children:"Configure rules"})]})]})]}),d.jsx("p",{className:`text-xs ${K} mt-4`,children:"Hook these controls to a policy engine + admin API."})]})]})]})]})})})},e1e=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",x=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",T=s?"bg-[rgba(34,197,94,0.14)] text-[#4ade80]":"bg-[rgba(34,197,94,0.14)] text-[#16a34a]",R=s?"bg-[rgba(251,191,36,0.14)] text-[#fbbf24]":"bg-[rgba(251,191,36,0.14)] text-[#ca8a04]",N=s?"bg-[rgba(34,197,94,0.14)] text-[#4ade80]":"bg-[rgba(34,197,94,0.14)] text-[#16a34a]",L=s?"bg-[rgba(107,114,128,0.14)] text-[#9ca3af]":"bg-[rgba(107,114,128,0.14)] text-[#6b7280]",j=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",F=[{name:"IRU Chat Sponsored Card",status:"Active",placement:"Inbox",objective:"Traffic",budget:"",action:"Open"},{name:"Enterprise Webinar Promo",status:"Draft",placement:"Live Stream",objective:"Registrations",budget:"",action:"Edit"}],P=[{placement:"Inbox Sponsored",where:"Chats list",format:"Card",status:"On"},{placement:"Call Screen Banner",where:"Calls",format:"Banner",status:"On"},{placement:"Live Stream Promo",where:"Live Stream",format:"Overlay",status:"On"},{placement:"Settings Sponsor",where:"Settings",format:"Tile",status:"Off"}],M=[{campaign:"Sponsored Card",impr:"",clicks:"",ctr:"",spend:""},{campaign:"Webinar Promo",impr:"",clicks:"",ctr:"",spend:""}];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${f}`,children:"Advertise / Marketing"}),d.jsx("p",{className:`text-sm ${_}`,children:"Campaigns, placements, creatives, approvals, analytics."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Campaigns"}),d.jsxs("div",{className:"flex gap-1",children:[d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${x}`,children:"Create"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${x}`,children:"Manage"})]})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"flex gap-2 flex-wrap",children:[d.jsx("button",{className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v}`,children:"New Campaign"}),d.jsx("button",{className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Import"}),d.jsx("button",{className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Templates"})]}),d.jsx("div",{className:"space-y-3",children:F.map((U,B)=>d.jsx("div",{className:`p-3 rounded-lg border ${c} ${h}`,children:d.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[d.jsx("h3",{className:`text-sm font-medium ${f}`,children:U.name}),d.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${U.status==="Active"?T:R}`,children:U.status})]}),d.jsxs("p",{className:`text-xs ${_}`,children:["Placement: ",U.placement,U.objective&&`  Objective: ${U.objective}`,U.budget&&`  Budget: ${U.budget}`]})]}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${x}`,children:U.action})]})},B))}),d.jsx("p",{className:`text-xs ${_}`,children:"Wireframe: connect to your ads service (campaign CRUD + targeting)."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Placements"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${x}`,children:"Inventory"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${j} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Placement"}),d.jsx("th",{className:`border-b ${j} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Where"}),d.jsx("th",{className:`border-b ${j} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Format"}),d.jsx("th",{className:`border-b ${j} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Status"})]})}),d.jsx("tbody",{children:P.map((U,B)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${j} px-2 py-2.5 ${f}`,children:U.placement}),d.jsx("td",{className:`border-b ${j} px-2 py-2.5 ${f}`,children:U.where}),d.jsx("td",{className:`border-b ${j} px-2 py-2.5 ${f}`,children:U.format}),d.jsx("td",{className:`border-b ${j} px-2 py-2.5 ${f}`,children:d.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${U.status==="On"?N:L}`,children:U.status})})]},B))})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Configure"}),d.jsx("button",{className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Pricing"}),d.jsx("button",{className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Policy"})]})]})]}),d.jsxs("section",{className:`lg:col-span-2 ${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Creatives & Approvals"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${x}`,children:"Compliance"})]}),d.jsx("div",{className:"p-4",children:d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsxs("div",{className:`p-4 rounded-lg border ${c} ${h}`,children:[d.jsx("h3",{className:`text-sm font-medium mb-2 ${f}`,children:"Upload Creative"}),d.jsx("p",{className:`text-xs mb-4 ${_}`,children:"Images, video, copy, CTA."}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Upload"})]}),d.jsxs("div",{className:`p-4 rounded-lg border ${c} ${h}`,children:[d.jsx("h3",{className:`text-sm font-medium mb-2 ${f}`,children:"Review Queue"}),d.jsx("p",{className:`text-xs mb-4 ${_}`,children:"Moderation + brand safety checks."}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Open queue"})]}),d.jsxs("div",{className:`p-4 rounded-lg border ${c} ${h}`,children:[d.jsx("h3",{className:`text-sm font-medium mb-2 ${f}`,children:"Tracking"}),d.jsx("p",{className:`text-xs mb-4 ${_}`,children:"UTM, pixels, conversions."}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Configure"})]})]})})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Performance"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${x}`,children:"Analytics"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${j} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Campaign"}),d.jsx("th",{className:`border-b ${j} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Impr."}),d.jsx("th",{className:`border-b ${j} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Clicks"}),d.jsx("th",{className:`border-b ${j} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"CTR"}),d.jsx("th",{className:`border-b ${j} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Spend"})]})}),d.jsx("tbody",{children:M.map((U,B)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${j} px-2 py-2.5 ${f}`,children:U.campaign}),d.jsx("td",{className:`border-b ${j} px-2 py-2.5 ${f}`,children:U.impr}),d.jsx("td",{className:`border-b ${j} px-2 py-2.5 ${f}`,children:U.clicks}),d.jsx("td",{className:`border-b ${j} px-2 py-2.5 ${f}`,children:U.ctr}),d.jsx("td",{className:`border-b ${j} px-2 py-2.5 ${f}`,children:U.spend})]},B))})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Hook to metrics store (daily rollups + realtime)."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Billing"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${x}`,children:"Invoices"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:`text-xs ${_}`,children:"Plan"}),d.jsx("span",{className:`text-xs ${f}`,children:""})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:`text-xs ${_}`,children:"Payment method"}),d.jsx("span",{className:`text-xs ${f}`,children:""})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:`text-xs ${_}`,children:"Outstanding"}),d.jsx("span",{className:`text-xs ${f}`,children:""})]})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Invoices"}),d.jsx("button",{className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Top up"}),d.jsx("button",{className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Tax info"})]})]})]})]})]})})})},t1e=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",x=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",T=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",R=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",N=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",L=[{name:"Project Brief",source:"Client Thread",updated:""}];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${f}`,children:"Thread  Doc Studio"}),d.jsx("p",{className:`text-sm ${_}`,children:"Convert chat threads into structured documents, wikis, and knowledge bases."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Convert Thread"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${T}`,children:"New Doc"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${R}`,children:"From Thread"}),d.jsx("button",{className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${T}`,children:"Template"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Select thread"}),d.jsx("select",{className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`,children:d.jsx("option",{children:"Client Thread"})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Document type"}),d.jsxs("select",{className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`,children:[d.jsx("option",{children:"Meeting Notes"}),d.jsx("option",{children:"Project Brief"}),d.jsx("option",{children:"Wiki Page"})]})]}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${R}`,children:"Generate Document"}),d.jsx("p",{className:`text-xs ${_}`,children:"Wireframe: AI-powered thread-to-doc conversion with formatting."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Document Library"}),d.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-full border ${x} ${v} ${_} text-xs`,children:"Docs"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${N} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Name"}),d.jsx("th",{className:`border-b ${N} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Source"}),d.jsx("th",{className:`border-b ${N} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Updated"})]})}),d.jsx("tbody",{children:L.map((j,F)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${N} px-2 py-2.5 ${f}`,children:j.name}),d.jsx("td",{className:`border-b ${N} px-2 py-2.5 ${f}`,children:j.source}),d.jsx("td",{className:`border-b ${N} px-2 py-2.5 ${f}`,children:j.updated})]},F))})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Store generated documents with version history."})]})]})]})]})})})},n1e=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",x=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",T=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",R=[{chat:"Client Thread",period:"This Week",status:"Pending"}];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${f}`,children:"Smart Summaries"}),d.jsx("p",{className:`text-sm ${_}`,children:"AI-powered summaries of conversations, threads, and chat history."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Generate Summary"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${v}`,children:"Settings"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Select chat or thread"}),d.jsx("select",{className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`,children:d.jsx("option",{children:"Client Thread"})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Time period"}),d.jsxs("select",{className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`,children:[d.jsx("option",{children:"Today"}),d.jsx("option",{children:"This Week"}),d.jsx("option",{children:"This Month"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Summary type"}),d.jsxs("select",{className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`,children:[d.jsx("option",{children:"Brief"}),d.jsx("option",{children:"Detailed"}),d.jsx("option",{children:"Key Points"})]})]}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Generate Summary"}),d.jsx("p",{className:`text-xs ${_}`,children:"Wireframe: AI summarization with customizable templates."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Summary History"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Chat"}),d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Period"}),d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Status"})]})}),d.jsx("tbody",{children:R.map((N,L)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f}`,children:N.chat}),d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f}`,children:N.period}),d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f}`,children:N.status})]},L))})]}),d.jsx("p",{className:`text-xs ${_}`,children:"View and export generated summaries."})]})]})]})]})})})},r1e=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",x=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",T=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",R=[{name:"Auto-Reply",trigger:"Keyword",status:"Active"},{name:"Task Assignment",trigger:"Message",status:"Active"}];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${f}`,children:"Workflow Automations"}),d.jsx("p",{className:`text-sm ${_}`,children:"Create automated workflows, triggers, and actions for chat interactions."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Create Workflow"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${v}`,children:"Templates"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Workflow name"}),d.jsx("input",{type:"text",placeholder:"e.g., Auto-Reply",className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Trigger"}),d.jsxs("select",{className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`,children:[d.jsx("option",{children:"Keyword"}),d.jsx("option",{children:"Message"}),d.jsx("option",{children:"Time"}),d.jsx("option",{children:"User Action"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Action"}),d.jsxs("select",{className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`,children:[d.jsx("option",{children:"Send Message"}),d.jsx("option",{children:"Assign Task"}),d.jsx("option",{children:"Create Summary"}),d.jsx("option",{children:"Webhook"})]})]}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Create Workflow"}),d.jsx("p",{className:`text-xs ${_}`,children:"Wireframe: visual workflow builder with conditions and actions."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Active Workflows"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Name"}),d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Trigger"}),d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Status"})]})}),d.jsx("tbody",{children:R.map((N,L)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f}`,children:N.name}),d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f}`,children:N.trigger}),d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f}`,children:N.status})]},L))})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Manage and monitor your automated workflows."})]})]})]})]})})})},s1e=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",x=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",T=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",R=[{command:"/help",description:"Show available commands",category:"General"},{command:"/status",description:"Set your status",category:"Profile"},{command:"/mute",description:"Mute notifications",category:"Settings"}];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${f}`,children:"Command Center"}),d.jsx("p",{className:`text-sm ${_}`,children:"Slash commands, shortcuts, and quick actions for power users."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Available Commands"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${v}`,children:"Customize"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Command"}),d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Description"}),d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Category"})]})}),d.jsx("tbody",{children:R.map((N,L)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f} font-mono`,children:N.command}),d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f}`,children:N.description}),d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f}`,children:N.category})]},L))})]}),d.jsx("p",{className:`text-xs ${_}`,children:'Type "/" in any chat to see available commands.'})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Keyboard Shortcuts"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:`text-xs ${_}`,children:"Quick search"}),d.jsx("kbd",{className:`px-2 py-1 rounded text-xs ${h} border ${c} ${f}`,children:"Ctrl + K"})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:`text-xs ${_}`,children:"New chat"}),d.jsx("kbd",{className:`px-2 py-1 rounded text-xs ${h} border ${c} ${f}`,children:"Ctrl + N"})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:`text-xs ${_}`,children:"Mark as read"}),d.jsx("kbd",{className:`px-2 py-1 rounded text-xs ${h} border ${c} ${f}`,children:"Ctrl + R"})]})]}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"View All Shortcuts"}),d.jsx("p",{className:`text-xs ${_}`,children:"Customize shortcuts in settings."})]})]})]})]})})})},i1e=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",x=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",[T,R]=V.useState(!1),[N,L]=V.useState("moderate");return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${f}`,children:"IRU Dignity Mode"}),d.jsx("p",{className:`text-sm ${_}`,children:"Advanced content filtering and respectful communication tools."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Dignity Mode Settings"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[d.jsx("span",{className:`text-sm ${f}`,children:"Enable Dignity Mode"}),d.jsx("input",{type:"checkbox",checked:T,onChange:j=>R(j.target.checked),className:`w-4 h-4 rounded ${c} ${h} ${s?"text-[#6ea8ff]":"text-[#2563eb]"}`})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Filter level"}),d.jsxs("select",{value:N,onChange:j=>L(j.target.value),className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`,children:[d.jsx("option",{value:"light",children:"Light"}),d.jsx("option",{value:"moderate",children:"Moderate"}),d.jsx("option",{value:"strict",children:"Strict"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",className:`w-4 h-4 rounded ${c} ${h} ${s?"text-[#6ea8ff]":"text-[#2563eb]"}`}),d.jsx("span",{className:`text-sm ${f}`,children:"Filter offensive language"})]}),d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",className:`w-4 h-4 rounded ${c} ${h} ${s?"text-[#6ea8ff]":"text-[#2563eb]"}`}),d.jsx("span",{className:`text-sm ${f}`,children:"Block harassment"})]}),d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",className:`w-4 h-4 rounded ${c} ${h} ${s?"text-[#6ea8ff]":"text-[#2563eb]"}`}),d.jsx("span",{className:`text-sm ${f}`,children:"Respectful tone enforcement"})]})]}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Save Settings"}),d.jsx("p",{className:`text-xs ${_}`,children:"Wireframe: AI-powered content moderation and respectful communication."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Filter Statistics"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:`text-xs ${_}`,children:"Messages filtered today"}),d.jsx("span",{className:`text-xs ${f}`,children:""})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:`text-xs ${_}`,children:"Warnings issued"}),d.jsx("span",{className:`text-xs ${f}`,children:""})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:`text-xs ${_}`,children:"Blocks applied"}),d.jsx("span",{className:`text-xs ${f}`,children:""})]})]}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v}`,children:"View Reports"}),d.jsx("p",{className:`text-xs ${_}`,children:"Monitor filter effectiveness and user feedback."})]})]})]})]})})})},o1e=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",x=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",[T,R]=V.useState(!1),[N,L]=V.useState(!1),[j,F]=V.useState(!1);return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${f}`,children:"Consent Controls"}),d.jsx("p",{className:`text-sm ${_}`,children:"Manage your privacy preferences and data consent settings."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Privacy Preferences"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[d.jsxs("div",{children:[d.jsx("span",{className:`text-sm ${f}`,children:"Data collection"}),d.jsx("p",{className:`text-xs ${_}`,children:"Allow collection of usage data"})]}),d.jsx("input",{type:"checkbox",checked:T,onChange:P=>R(P.target.checked),className:`w-4 h-4 rounded ${c} ${h} ${s?"text-[#6ea8ff]":"text-[#2563eb]"}`})]}),d.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[d.jsxs("div",{children:[d.jsx("span",{className:`text-sm ${f}`,children:"Analytics"}),d.jsx("p",{className:`text-xs ${_}`,children:"Help improve the platform"})]}),d.jsx("input",{type:"checkbox",checked:N,onChange:P=>L(P.target.checked),className:`w-4 h-4 rounded ${c} ${h} ${s?"text-[#6ea8ff]":"text-[#2563eb]"}`})]}),d.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[d.jsxs("div",{children:[d.jsx("span",{className:`text-sm ${f}`,children:"Marketing communications"}),d.jsx("p",{className:`text-xs ${_}`,children:"Receive updates and offers"})]}),d.jsx("input",{type:"checkbox",checked:j,onChange:P=>F(P.target.checked),className:`w-4 h-4 rounded ${c} ${h} ${s?"text-[#6ea8ff]":"text-[#2563eb]"}`})]}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Save Preferences"}),d.jsx("p",{className:`text-xs ${_}`,children:"Your consent preferences are stored and can be updated anytime."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Consent History"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:`p-3 rounded-lg border ${c} ${h}`,children:[d.jsxs("div",{className:"flex justify-between items-center mb-1",children:[d.jsx("span",{className:`text-xs font-medium ${f}`,children:"Data Collection"}),d.jsx("span",{className:`text-xs ${_}`,children:""})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Last updated: "})]}),d.jsxs("div",{className:`p-3 rounded-lg border ${c} ${h}`,children:[d.jsxs("div",{className:"flex justify-between items-center mb-1",children:[d.jsx("span",{className:`text-xs font-medium ${f}`,children:"Analytics"}),d.jsx("span",{className:`text-xs ${_}`,children:""})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Last updated: "})]})]}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v}`,children:"Export Consent Data"}),d.jsx("p",{className:`text-xs ${_}`,children:"Download your consent history for records."})]})]})]})]})})})},a1e=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",x=s?"bg-[rgba(34,197,94,0.14)] text-[#4ade80]":"bg-[rgba(34,197,94,0.14)] text-[#16a34a]",T=s?"bg-[rgba(251,191,36,0.14)] text-[#fbbf24]":"bg-[rgba(251,191,36,0.14)] text-[#ca8a04]",R=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",N=[{type:"Email",status:"Verified",date:""},{type:"Phone",status:"Pending",date:""}];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${f}`,children:"Identity & Verification"}),d.jsx("p",{className:`text-sm ${_}`,children:"Verify your identity and manage verification methods."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Verification Methods"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${v}`,children:"Add Method"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v} text-left`,children:"Verify Email"}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v} text-left`,children:"Verify Phone"}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v} text-left`,children:"Verify ID Document"})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Wireframe: integrate with identity verification service."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Verification Status"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${R} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Type"}),d.jsx("th",{className:`border-b ${R} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Status"}),d.jsx("th",{className:`border-b ${R} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Date"})]})}),d.jsx("tbody",{children:N.map((L,j)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${R} px-2 py-2.5 ${f}`,children:L.type}),d.jsx("td",{className:`border-b ${R} px-2 py-2.5 ${f}`,children:d.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${L.status==="Verified"?x:T}`,children:L.status})}),d.jsx("td",{className:`border-b ${R} px-2 py-2.5 ${f}`,children:L.date})]},j))})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Track your verification progress and requirements."})]})]})]})]})})})},c1e=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",x=s?"bg-[rgba(251,191,36,0.14)] text-[#fbbf24]":"bg-[rgba(251,191,36,0.14)] text-[#ca8a04]",T=s?"bg-[rgba(34,197,94,0.14)] text-[#4ade80]":"bg-[rgba(34,197,94,0.14)] text-[#16a34a]",R=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",N=[{id:"#001",type:"Harassment",status:"Pending",date:""},{id:"#002",type:"Spam",status:"Resolved",date:""}];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${f}`,children:"Reports & Moderation"}),d.jsx("p",{className:`text-sm ${_}`,children:"Review and manage user reports, moderation actions, and safety incidents."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Recent Reports"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${v}`,children:"View All"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${R} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"ID"}),d.jsx("th",{className:`border-b ${R} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Type"}),d.jsx("th",{className:`border-b ${R} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Status"}),d.jsx("th",{className:`border-b ${R} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Date"})]})}),d.jsx("tbody",{children:N.map((L,j)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${R} px-2 py-2.5 ${f}`,children:L.id}),d.jsx("td",{className:`border-b ${R} px-2 py-2.5 ${f}`,children:L.type}),d.jsx("td",{className:`border-b ${R} px-2 py-2.5 ${f}`,children:d.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${L.status==="Pending"?x:T}`,children:L.status})}),d.jsx("td",{className:`border-b ${R} px-2 py-2.5 ${f}`,children:L.date})]},j))})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Wireframe: connect to moderation queue and review system."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Moderation Actions"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v} text-left`,children:"Review Queue"}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v} text-left`,children:"Ban Management"}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v} text-left`,children:"Appeal Process"})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:`text-xs ${_}`,children:"Pending reviews"}),d.jsx("span",{className:`text-xs ${f}`,children:""})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:`text-xs ${_}`,children:"Resolved today"}),d.jsx("span",{className:`text-xs ${f}`,children:""})]})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Manage moderation workflows and policies."})]})]})]})]})})})},l1e=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",x=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]";return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${f}`,children:"Privacy Center"}),d.jsx("p",{className:`text-sm ${_}`,children:"Manage your privacy settings, data rights, and account security."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Privacy Settings"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsxs("div",{children:[d.jsx("span",{className:`text-sm ${f}`,children:"Profile visibility"}),d.jsx("p",{className:`text-xs ${_}`,children:"Who can see your profile"})]}),d.jsxs("select",{className:`px-3 py-1.5 rounded-lg ${h} border ${c} ${f} text-xs`,children:[d.jsx("option",{children:"Public"}),d.jsx("option",{children:"Contacts"}),d.jsx("option",{children:"Private"})]})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsxs("div",{children:[d.jsx("span",{className:`text-sm ${f}`,children:"Read receipts"}),d.jsx("p",{className:`text-xs ${_}`,children:"Show when you read messages"})]}),d.jsx("input",{type:"checkbox",className:`w-4 h-4 rounded ${c} ${h} ${s?"text-[#6ea8ff]":"text-[#2563eb]"}`})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsxs("div",{children:[d.jsx("span",{className:`text-sm ${f}`,children:"Last seen"}),d.jsx("p",{className:`text-xs ${_}`,children:"Show when you were last active"})]}),d.jsx("input",{type:"checkbox",className:`w-4 h-4 rounded ${c} ${h} ${s?"text-[#6ea8ff]":"text-[#2563eb]"}`})]})]}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Save Settings"}),d.jsx("p",{className:`text-xs ${_}`,children:"Control who can see your information and activity."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Data Rights"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v} text-left`,children:"Download My Data"}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v} text-left`,children:"Delete My Account"}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v} text-left`,children:"Request Data Portability"})]}),d.jsx("div",{className:`p-3 rounded-lg border ${c} ${h}`,children:d.jsx("p",{className:`text-xs ${_}`,children:"You have the right to access, modify, or delete your personal data at any time. Requests are processed within 30 days."})}),d.jsx("p",{className:`text-xs ${_}`,children:"Wireframe: GDPR/CCPA compliance tools and data management."})]})]})]})]})})})},d1e=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",x=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]";return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${f}`,children:"Live Studio"}),d.jsx("p",{className:`text-sm ${_}`,children:"Professional live streaming tools for creators and broadcasters."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Studio Setup"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${v}`,children:"Configure"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Stream title"}),d.jsx("input",{type:"text",placeholder:"Enter stream title",className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Camera"}),d.jsx("select",{className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`,children:d.jsx("option",{children:"Default Camera"})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Microphone"}),d.jsx("select",{className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`,children:d.jsx("option",{children:"Default Microphone"})})]}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Go Live"}),d.jsx("p",{className:`text-xs ${_}`,children:"Wireframe: integrate WebRTC streaming with OBS-like controls."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Live Streams"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsx("div",{className:`aspect-video rounded-lg ${h} border ${c} flex items-center justify-center`,children:d.jsx("p",{className:`text-sm ${_}`,children:"Stream preview"})}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v}`,children:"View Chat"}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v}`,children:"Manage Settings"})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Monitor your live stream performance and engagement."})]})]})]})]})})})},u1e=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",x=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",T=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",R=[{name:"Design Community",members:"",status:"Active"},{name:"Tech Hub",members:"",status:"Active"}];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${f}`,children:"Community Builder"}),d.jsx("p",{className:`text-sm ${_}`,children:"Create and manage communities, groups, and member engagement."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Create Community"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${v}`,children:"Templates"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Community name"}),d.jsx("input",{type:"text",placeholder:"Enter community name",className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Description"}),d.jsx("textarea",{rows:3,placeholder:"Describe your community",className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Privacy"}),d.jsxs("select",{className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`,children:[d.jsx("option",{children:"Public"}),d.jsx("option",{children:"Private"}),d.jsx("option",{children:"Invite Only"})]})]}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Create Community"}),d.jsx("p",{className:`text-xs ${_}`,children:"Wireframe: community management with roles, channels, and moderation."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"My Communities"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Name"}),d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Members"}),d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Status"})]})}),d.jsx("tbody",{children:R.map((N,L)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f}`,children:N.name}),d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f}`,children:N.members}),d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f}`,children:N.status})]},L))})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Manage your communities and member engagement."})]})]})]})]})})})},h1e=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",x=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",T=[{source:"Subscriptions",amount:"",period:"This Month"},{source:"Tips",amount:"",period:"This Month"}];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${f}`,children:"Monetization"}),d.jsx("p",{className:`text-sm ${_}`,children:"Manage subscriptions, tips, revenue streams, and payment settings."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Revenue Streams"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${v}`,children:"Setup"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v} text-left`,children:"Enable Subscriptions"}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v} text-left`,children:"Accept Tips"}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v} text-left`,children:"Paid Content"})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Wireframe: integrate payment processors and subscription management."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Revenue Overview"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${x} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Source"}),d.jsx("th",{className:`border-b ${x} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Amount"}),d.jsx("th",{className:`border-b ${x} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Period"})]})}),d.jsx("tbody",{children:T.map((R,N)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${x} px-2 py-2.5 ${f}`,children:R.source}),d.jsx("td",{className:`border-b ${x} px-2 py-2.5 ${f}`,children:R.amount}),d.jsx("td",{className:`border-b ${x} px-2 py-2.5 ${f}`,children:R.period})]},N))})]}),d.jsx("button",{className:`w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${v}`,children:"View Payouts"}),d.jsx("p",{className:`text-xs ${_}`,children:"Track your earnings and payment history."})]})]})]})]})})})},p1e=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",x=s?"bg-[rgba(110,168,255,0.14)] border-[rgba(110,168,255,0.35)] text-[#e7eefc]":"bg-[rgba(37,99,235,0.14)] border-[rgba(37,99,235,0.35)] text-[#0f172a]",T=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",R=[{name:"Video Intro",type:"Video",size:"",date:""},{name:"Thumbnail Template",type:"Image",size:"",date:""}];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${f}`,children:"Content Library"}),d.jsx("p",{className:`text-sm ${_}`,children:"Organize and manage your media files, templates, and content assets."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Upload Content"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${v}`,children:"Browse"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:`border-2 border-dashed ${c} rounded-lg p-8 text-center`,children:[d.jsx("p",{className:`text-sm ${_} mb-4`,children:"Drag and drop files here"}),d.jsx("button",{className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors border ${x}`,children:"Select Files"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:`block text-xs ${_}`,children:"Content type"}),d.jsxs("select",{className:`w-full px-3 py-2 rounded-lg ${h} border ${c} ${f} text-sm`,children:[d.jsx("option",{children:"Video"}),d.jsx("option",{children:"Image"}),d.jsx("option",{children:"Audio"}),d.jsx("option",{children:"Document"})]})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Wireframe: file upload with progress and organization."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"My Content"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Name"}),d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Type"}),d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Size"}),d.jsx("th",{className:`border-b ${T} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Date"})]})}),d.jsx("tbody",{children:R.map((N,L)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f}`,children:N.name}),d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f}`,children:N.type}),d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f}`,children:N.size}),d.jsx("td",{className:`border-b ${T} px-2 py-2.5 ${f}`,children:N.date})]},L))})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Organize your content with folders and tags."})]})]})]})]})})})},m1e=()=>{const{theme:r}=sr(),s=r==="dark",a=s?"bg-[#101828]":"bg-white",c=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",h=s?"bg-[rgba(255,255,255,0.02)]":"bg-[rgba(15,23,42,0.02)]",f=s?"text-[#e7eefc]":"text-[#0f172a]",_=s?"text-[#9bb0d0]":"text-[#475569]",E=s?"shadow-[0_12px_30px_rgba(0,0,0,0.35)]":"shadow-[0_10px_25px_rgba(2,6,23,0.08)]",v=s?"bg-[rgba(255,255,255,0.02)] border-[rgba(255,255,255,0.09)] text-[#9bb0d0] hover:bg-[rgba(255,255,255,0.05)]":"bg-[rgba(15,23,42,0.02)] border-[rgba(15,23,42,0.10)] text-[#475569] hover:bg-[rgba(15,23,42,0.05)]",x=s?"border-[rgba(255,255,255,0.09)]":"border-[rgba(15,23,42,0.10)]",T=[{metric:"Total Views",value:"",change:""},{metric:"Engagement Rate",value:"",change:""},{metric:"Subscribers",value:"",change:""}];return d.jsx("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:d.jsx("main",{className:`flex-1 overflow-y-auto p-6 ${s?"bg-[#0b0f17]":"bg-[#f6f8fd]"}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("h1",{className:`text-2xl font-semibold ${f}`,children:"Creator Analytics"}),d.jsx("p",{className:`text-sm ${_}`,children:"Track your performance, audience insights, and content metrics."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsxs("div",{className:`px-4 py-3.5 flex items-center justify-between gap-2.5 border-b ${c} ${h}`,children:[d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Key Metrics"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${v}`,children:"Export"})]}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:`border-b ${x} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Metric"}),d.jsx("th",{className:`border-b ${x} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Value"}),d.jsx("th",{className:`border-b ${x} px-2 py-2.5 text-left text-xs font-semibold ${_}`,children:"Change"})]})}),d.jsx("tbody",{children:T.map((R,N)=>d.jsxs("tr",{children:[d.jsx("td",{className:`border-b ${x} px-2 py-2.5 ${f}`,children:R.metric}),d.jsx("td",{className:`border-b ${x} px-2 py-2.5 ${f}`,children:R.value}),d.jsx("td",{className:`border-b ${x} px-2 py-2.5 ${f}`,children:R.change})]},N))})]}),d.jsx("p",{className:`text-xs ${_}`,children:"Wireframe: connect to analytics API with charts and graphs."})]})]}),d.jsxs("section",{className:`${a} border ${c} rounded-[22px] ${E} overflow-hidden`,children:[d.jsx("div",{className:`px-4 py-3.5 border-b ${c} ${h}`,children:d.jsx("h2",{className:`text-sm font-medium tracking-wide m-0 ${f}`,children:"Audience Insights"})}),d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:`text-xs ${_}`,children:"Demographics"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${v}`,children:"View"})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:`text-xs ${_}`,children:"Top Content"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${v}`,children:"View"})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:`text-xs ${_}`,children:"Engagement Trends"}),d.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${v}`,children:"View"})]})]}),d.jsx("div",{className:`p-3 rounded-lg border ${c} ${h}`,children:d.jsx("p",{className:`text-xs ${_}`,children:"Detailed analytics and insights help you understand your audience and optimize your content strategy."})}),d.jsx("p",{className:`text-xs ${_}`,children:"Access detailed reports and export data for analysis."})]})]})]})]})})})},Pa="http://localhost:5000",f1e=()=>{const{theme:r}=sr(),[s,a]=V.useState(!1),[c,h]=V.useState(null),[f,_]=V.useState([]),[E,v]=V.useState(null),[x,T]=V.useState([]),[R,N]=V.useState(""),[L,j]=V.useState(new Set),[F,P]=V.useState(!1),[M,U]=V.useState(new Set),[B,K]=V.useState(""),[J,te]=V.useState(!1),[se,ie]=V.useState(null),[ue,de]=V.useState("chats"),[Ne,Ce]=V.useState("all"),[tt,Se]=V.useState(!1),[Ge,Xe]=V.useState(0),[Re,le]=V.useState(null),[ve,Le]=V.useState(!1),[qe,We]=V.useState(!1),[xt,bt]=V.useState(null),$t=V.useRef(null),vt=V.useRef(null),ut=V.useRef(null),Wt=V.useRef([]),Jt=V.useRef(null),Dt={MESSAGES:"iru-chat-messages",CHATS:"iru-chat-chats"},At=(De,Ie)=>{try{const Pe=localStorage.getItem(Dt.MESSAGES),ze=Pe?JSON.parse(Pe):{};ze[De]=Ie,localStorage.setItem(Dt.MESSAGES,JSON.stringify(ze))}catch(Pe){console.error("Error saving messages to storage:",Pe)}},be=De=>{try{localStorage.setItem(Dt.CHATS,JSON.stringify(De))}catch(Ie){console.error("Error saving chats to storage:",Ie)}},ht=(De,Ie)=>{const Pe=new Map;return De.forEach(ze=>Pe.set(ze.id,ze)),Ie.forEach(ze=>Pe.set(ze.id,ze)),Array.from(Pe.values()).sort((ze,at)=>new Date(ze.createdAt).getTime()-new Date(at.createdAt).getTime())},Gt=()=>{try{const De=localStorage.getItem("iru-auth");if(De)return JSON.parse(De).token}catch{}return null},Ln=()=>{var De;try{const Ie=localStorage.getItem("iru-auth");if(Ie)return(De=JSON.parse(Ie).user)==null?void 0:De.id}catch{}return null},Mn=()=>{try{const De=localStorage.getItem("iru-auth");if(De)return JSON.parse(De).user}catch{}return{id:"current-user",fullName:"You",username:"you",email:"you@example.com",profilePicture:"https://api.dicebear.com/7.x/avataaars/svg?seed=You"}},bn=Ln()||"current-user";V.useEffect(()=>{(()=>{try{const Ie=localStorage.getItem(Dt.CHATS);Ie&&JSON.parse(Ie).some(at=>{const ft=(at.name||"").toLowerCase(),Rt=(at.id||"").toLowerCase();return ft.includes("design team")||ft.includes("m. augustin")||Rt.includes("static-")})&&(console.log("Clearing static chats from localStorage"),localStorage.removeItem(Dt.CHATS),localStorage.removeItem("iru-chat-messages"))}catch{}})()},[]),V.useEffect(()=>{a(!0);const De=Gt();if(!De){console.log("No auth token, skipping socket connection");return}const Ie=h0(Pa,{auth:{token:De},transports:["websocket","polling"],autoConnect:!0,reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:5});return Ie.on("connect",()=>{console.log(" Socket connected")}),Ie.on("disconnect",()=>{console.log(" Socket disconnected")}),Ie.on("connect_error",Pe=>{console.error(" Socket connection error:",Pe.message)}),Ie.on("user:online",({userId:Pe})=>{U(ze=>new Set(ze).add(Pe))}),Ie.on("user:offline",({userId:Pe})=>{U(ze=>{const at=new Set(ze);return at.delete(Pe),at})}),Ie.on("call:incoming",Pe=>{console.log("ChatPage: ========== INCOMING CALL RECEIVED =========="),console.log("ChatPage: Call data:",JSON.stringify(Pe,null,2)),console.log("ChatPage: Redirecting to Calls page..."),sessionStorage.setItem("incoming-call",JSON.stringify(Pe)),dt.info(`Incoming ${Pe.callType} call from ${Pe.caller.fullName}`,{duration:1e4,action:{label:"Answer Call",onClick:()=>{de("calls"),window.dispatchEvent(new CustomEvent("incoming-call-received",{detail:Pe}))}}}),setTimeout(()=>{de("calls"),window.dispatchEvent(new CustomEvent("incoming-call-received",{detail:Pe}))},500)}),Ie.on("message:new",Pe=>{console.log("Received new message via socket:",Pe);const ze={...Pe,sender:Pe.sender||{id:Pe.senderId,fullName:"Unknown User",username:"unknown",email:"",isOnline:!1}};T(at=>{if(ze.chatId!==(E==null?void 0:E.id))return _(ae=>{const Ae=ae.map(Be=>Be.id===ze.chatId?{...Be,messages:[ze],unreadCount:ze.senderId!==Ln()?(Be.unreadCount||0)+1:0}:Be);return be(Ae),Ae}),at;if(at.find(ae=>ae.id===ze.id))return at;const Rt=at.some(ae=>ae.id.startsWith("temp-")&&ae.content===ze.content);let Ze;return Rt?Ze=at.map(ae=>ae.id.startsWith("temp-")&&ae.content===ze.content?ze:ae).filter(ae=>!ae.id.startsWith("temp-")||ae.id===ze.id):Ze=[...at,ze],Ze.sort((ae,Ae)=>new Date(ae.createdAt).getTime()-new Date(Ae.createdAt).getTime()),At(ze.chatId,Ze),Ze}),_(at=>{const ft=at.map(Rt=>Rt.id===ze.chatId?{...Rt,messages:[ze],unreadCount:ze.senderId!==Ln()?(Rt.unreadCount||0)+1:0}:Rt);return be(ft),ft})}),Ie.on("message:sent",Pe=>{console.log("Message sent confirmation:",Pe),T(ze=>{const at=ze.find(ft=>ft.id.startsWith("temp-")&&ft.content===Pe.content);if(at){const ft=ze.map(Rt=>Rt.id===at.id?Pe:Rt);return At(Pe.chatId,ft),ft}return ze})}),Ie.on("message:error",({error:Pe})=>{console.error("Message error from socket:",Pe),dt.error(Pe||"Failed to send message")}),Ie.on("typing:start",({userId:Pe,chatId:ze})=>{E&&ze===E.id&&Pe!==Ln()&&j(at=>new Set(at).add(Pe))}),Ie.on("typing:stop",({userId:Pe,chatId:ze})=>{E&&ze===E.id&&j(at=>{const ft=new Set(at);return ft.delete(Pe),ft})}),Ie.on("message:read",({userId:Pe,messageIds:ze})=>{T(at=>{const ft=at.map(Rt=>ze.includes(Rt.id)?{...Rt,readBy:[...Rt.readBy||[],Pe]}:Rt);return E&&At(E.id,ft),ft})}),h(Ie),()=>{Ie.close()}},[]),V.useEffect(()=>{(()=>{try{console.log("Clearing localStorage to remove static chats");const Pe=localStorage.getItem(Dt.CHATS);if(Pe)try{const ze=JSON.parse(Pe),at=["Design Team","M. Augustin"],ft=["static-"];ze.some(Ze=>{const ae=(Ze.name||"").toLowerCase(),Ae=(Ze.id||"").toLowerCase();return at.some(Be=>ae.includes(Be.toLowerCase()))||ft.some(Be=>Ae.includes(Be))})&&(console.log("Found static chats in localStorage, clearing all data"),localStorage.removeItem(Dt.CHATS),localStorage.removeItem("iru-chat-messages"))}catch{localStorage.removeItem(Dt.CHATS),localStorage.removeItem("iru-chat-messages")}}catch(Pe){console.error("Error clearing localStorage:",Pe)}})(),(async()=>{try{const Pe=Gt();if(!Pe){console.log("No auth token, cannot load chats from API."),_([]);return}const ze=await fetch(`${Pa}/api/chats`,{headers:{Authorization:`Bearer ${Pe}`}});if(ze.ok){const Rt=(await ze.json()||[]).map(Ze=>({...Ze,messages:Ze.messages||[],members:Ze.members||[]})).filter(Ze=>{const ae=(Ze.name||"").toLowerCase(),Ae=(Ze.id||"").toLowerCase();return!ae.includes("design team")&&!ae.includes("m. augustin")&&!Ae.includes("static-")});_(Rt),be(Rt),console.log("Loaded chats from API:",Rt.length)}else console.log("API failed, no chats available"),_([])}catch(Pe){console.error("Error loading chats from API:",Pe),_([])}})()},[]),V.useEffect(()=>{if(!E){T([]);return}const Ie=(()=>{try{const ze=localStorage.getItem("iru-chat-messages"),ft=(ze?JSON.parse(ze):{})[E.id]||[];return T(ft),console.log("Loaded messages from localStorage:",ft.length),ft}catch(ze){return console.error("Error loading messages from storage:",ze),T([]),[]}})();return c&&c.emit("chat:join",E.id),(async()=>{try{const ze=Gt();if(_(at=>{const ft=at.map(Rt=>Rt.id===E.id?{...Rt,unreadCount:0}:Rt);return be(ft),ft}),ze){const at=await fetch(`${Pa}/api/chats/${E.id}/messages`,{headers:{Authorization:`Bearer ${ze}`}});if(at.ok){const ft=await at.json(),Rt=(ft.messages||ft).map(ae=>{var Ae;return{...ae,sender:ae.sender||((Ae=E.members.find(Be=>Be.userId===ae.senderId))==null?void 0:Ae.user)||{id:ae.senderId,fullName:"Unknown User",username:"unknown",email:"",isOnline:!1}}}),Ze=ht(Ie,Rt);T(Ze),Ze.length>0&&At(E.id,Ze)}else console.log("API failed, keeping localStorage messages")}}catch(ze){console.error("Error loading messages:",ze)}})(),()=>{c&&c.emit("chat:leave",E.id)}},[E,c]);const ln=De=>{N(De),!F&&E&&c&&(P(!0),c.emit("typing:start",E.id)),$t.current&&clearTimeout($t.current),$t.current=setTimeout(()=>{E&&c&&(P(!1),c.emit("typing:stop",E.id))},1e3)},vn=async De=>{var Pe;const Ie=(Pe=De.target.files)==null?void 0:Pe[0];if(!Ie){console.log("No file selected");return}if(console.log("File selected:",Ie.name,Ie.type,Ie.size),!E){dt.error("Please select a chat first"),vt.current&&(vt.current.value="");return}ie(Ie),R.trim()?console.log("File selected, will send with text message"):(console.log("Auto-sending file since no text input"),await Xn(Ie))},Xn=async De=>{if(E)try{const Ie=`temp-${Date.now()}`,Pe=Mn(),ze=URL.createObjectURL(De),at={id:Ie,chatId:E.id,senderId:bn,content:"Uploading...",type:De.type.startsWith("image/")?"image":De.type.startsWith("video/")?"video":De.type.startsWith("audio/")?"audio":"file",fileUrl:ze,fileName:De.name,fileSize:De.size,fileType:De.type,createdAt:new Date().toISOString(),sender:{id:bn,fullName:(Pe==null?void 0:Pe.fullName)||"You",username:(Pe==null?void 0:Pe.username)||"you",email:(Pe==null?void 0:Pe.email)||"",profilePicture:Pe==null?void 0:Pe.profilePicture,isOnline:!0},readBy:[]};T(Be=>{const Ye=[...Be,at];return At(E.id,Ye),Ye});let ft=ze,Rt=null;const Ze=Gt();if(!Ze){dt.error("Please login to send files"),T(Be=>Be.filter(Ye=>Ye.id!==Ie));return}const ae=new FormData;ae.append("file",De);const Ae=await fetch(`${Pa}/api/files/upload`,{method:"POST",headers:{Authorization:`Bearer ${Ze}`},body:ae});if(!Ae.ok){const Be=await Ae.text();console.error("File upload failed:",Be);const Ye=new FileReader;Ye.onload=pt=>{var nn;const Cn=(nn=pt.target)==null?void 0:nn.result;ft=Cn;const yn={...at,id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,content:De.name,fileUrl:Cn};T(as=>{const Ii=as.map(Ji=>Ji.id===Ie?yn:Ji);return At(E.id,Ii),Ii})},Ye.readAsDataURL(De),dt.warning("File saved locally (upload failed)");return}Rt=await Ae.json(),console.log("File uploaded successfully:",Rt),ft=Rt.url||Rt.id||ze;try{const Be={chatId:E.id,content:De.name,type:De.type.startsWith("image/")?"image":De.type.startsWith("video/")?"video":De.type.startsWith("audio/")?"audio":"file",fileUrl:ft,fileName:De.name,fileSize:De.size,fileType:De.type};if(c&&c.connected)c.emit("message:send",Be),console.log("File message sent via socket");else{console.log("Socket not connected, using API for file message");const Ye=await fetch(`${Pa}/api/chats/${E.id}/messages`,{method:"POST",headers:{Authorization:`Bearer ${Ze}`,"Content-Type":"application/json"},body:JSON.stringify(Be)});if(!Ye.ok)throw new Error("Failed to send file message");const pt=await Ye.json();console.log("File message sent via API:",pt),T(Cn=>{const yn=Cn.map(nn=>nn.id===Ie?{...pt,sender:pt.sender||nn.sender}:nn);return At(E.id,yn),yn})}}catch(Be){console.error("Error sending file message:",Be),dt.error(Be.message||"Failed to send file message")}T(Be=>{const Ye=Be.map(pt=>pt.id===Ie?{...pt,fileUrl:ft,content:De.name}:pt);return At(E.id,Ye),Ye}),ie(null),vt.current&&(vt.current.value="")}catch(Ie){console.error("Error uploading file:",Ie),dt.error("Failed to upload file"),T(Pe=>{const ze=Pe.filter(at=>at.id!==`temp-${Date.now()}`);return At(E.id,ze),ze})}},Mr=async De=>{if(De.preventDefault(),!E){dt.error("Please select a chat first");return}if(!R.trim()&&!se){dt.error("Please enter a message or select a file");return}console.log("Sending message:",{hasText:!!R.trim(),hasFile:!!se,chatId:E.id});const Ie=R.trim(),Pe=Mn();if(se&&(await Xn(se),!Ie)){N("");return}const ze=`temp-${Date.now()}`,at={id:ze,chatId:E.id,senderId:bn,content:Ie,type:"text",createdAt:new Date().toISOString(),sender:{id:bn,fullName:(Pe==null?void 0:Pe.fullName)||"You",username:(Pe==null?void 0:Pe.username)||"you",email:(Pe==null?void 0:Pe.email)||"",profilePicture:Pe==null?void 0:Pe.profilePicture,isOnline:!0},readBy:[]};T(ft=>{const Rt=[...ft,at];return At(E.id,Rt),Rt}),_(ft=>{const Rt=ft.map(Ze=>Ze.id===E.id?{...Ze,messages:[at],unreadCount:0}:Ze);return be(Rt),Rt}),N(""),F&&c&&(P(!1),c.emit("typing:stop",E.id));try{const ft=Gt();if(!ft){dt.error("Please login to send messages");return}if(c&&c.connected)c.emit("message:send",{chatId:E.id,content:Ie,type:"text"}),console.log("Message sent via socket");else{console.log("Socket not connected, using API fallback");const Rt=await fetch(`${Pa}/api/chats/${E.id}/messages`,{method:"POST",headers:{Authorization:`Bearer ${ft}`,"Content-Type":"application/json"},body:JSON.stringify({content:Ie,type:"text"})});if(!Rt.ok){const ae=await Rt.json().catch(()=>({}));throw new Error(ae.error||"Failed to send message")}const Ze=await Rt.json();console.log("Message sent via API:",Ze),T(ae=>{const Ae=[...ae.filter(Be=>Be.id!==ze),{...Ze,sender:Ze.sender||at.sender}];return At(E.id,Ae),Ae}),_(ae=>{const Ae=ae.map(Be=>Be.id===E.id?{...Be,messages:[Ze],unreadCount:0}:Be);return be(Ae),Ae})}}catch(ft){console.error("Error sending message:",ft),dt.error(ft.message||"Failed to send message"),T(Rt=>{const Ze=Rt.filter(ae=>ae.id!==ze);return At(E.id,Ze),Ze})}},So=async()=>{try{const De=await navigator.mediaDevices.getUserMedia({audio:!0});ut.current=new MediaRecorder(De),Wt.current=[],ut.current.ondataavailable=Ie=>{Wt.current.push(Ie.data)},ut.current.onstop=()=>{const Ie=new Blob(Wt.current,{type:"audio/webm"});le(Ie),De.getTracks().forEach(Pe=>Pe.stop())},ut.current.start(),Se(!0),Xe(0),Jt.current=setInterval(()=>{Xe(Ie=>Ie+1)},1e3)}catch(De){console.error("Error starting recording:",De),dt.error("Could not access microphone")}},ir=()=>{ut.current&&tt&&(ut.current.stop(),Se(!1),Jt.current&&clearInterval(Jt.current))},Jn=()=>{ir(),le(null),Xe(0)},ia=async()=>{if(!(!Re||!E))try{const De=`temp-${Date.now()}`,Ie=Mn(),Pe=URL.createObjectURL(Re),ze=new File([Re],`voice-${Date.now()}.webm`,{type:"audio/webm"}),at={id:De,chatId:E.id,senderId:bn,content:"Voice message",type:"audio",fileUrl:Pe,fileName:ze.name,fileSize:Re.size,fileType:"audio/webm",createdAt:new Date().toISOString(),sender:{id:bn,fullName:(Ie==null?void 0:Ie.fullName)||"You",username:(Ie==null?void 0:Ie.username)||"you",email:(Ie==null?void 0:Ie.email)||"",profilePicture:Ie==null?void 0:Ie.profilePicture,isOnline:!0},readBy:[]};T(Be=>{const Ye=[...Be,at];return At(E.id,Ye),Ye});let ft=Pe,Rt=null;const Ze=Gt();if(!Ze){dt.error("Please login to send voice messages"),T(Be=>Be.filter(Ye=>Ye.id!==De));return}const ae=new FormData;ae.append("file",ze);const Ae=await fetch(`${Pa}/api/files/upload`,{method:"POST",headers:{Authorization:`Bearer ${Ze}`},body:ae});if(!Ae.ok){const Be=new FileReader;Be.onload=Ye=>{var yn;const pt=(yn=Ye.target)==null?void 0:yn.result;ft=pt;const Cn={...at,id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,fileUrl:pt};T(nn=>{const as=nn.map(Ii=>Ii.id===De?Cn:Ii);return At(E.id,as),as})},Be.readAsDataURL(ze),dt.warning("Voice message saved locally (upload failed)"),le(null),Xe(0);return}Rt=await Ae.json(),console.log("Voice uploaded successfully:",Rt),ft=Rt.url||Rt.id||Pe;try{const Be={chatId:E.id,content:"Voice message",type:"audio",fileUrl:ft,fileName:ze.name,fileSize:Re.size,fileType:"audio/webm"};if(c&&c.connected)c.emit("message:send",Be),console.log("Voice message sent via socket");else{console.log("Socket not connected, using API for voice message");const Ye=await fetch(`${Pa}/api/chats/${E.id}/messages`,{method:"POST",headers:{Authorization:`Bearer ${Ze}`,"Content-Type":"application/json"},body:JSON.stringify(Be)});if(!Ye.ok)throw new Error("Failed to send voice message");const pt=await Ye.json();console.log("Voice message sent via API:",pt),T(Cn=>{const yn=Cn.map(nn=>nn.id===De?{...pt,sender:pt.sender||nn.sender}:nn);return At(E.id,yn),yn})}}catch(Be){console.error("Error sending voice message:",Be),dt.error(Be.message||"Failed to send voice message")}T(Be=>{const Ye=Be.map(pt=>pt.id===De?{...pt,fileUrl:ft}:pt);return At(E.id,Ye),Ye}),le(null),Xe(0),dt.success("Voice message sent")}catch(De){console.error("Error sending voice message:",De),dt.error("Failed to send voice message"),T(Ie=>{const Pe=Ie.filter(ze=>!ze.id.startsWith("temp-")||ze.content!=="Voice message");return At(E.id,Pe),Pe})}},jr=De=>{const Ie=Math.floor(De/60),Pe=De%60;return`${Ie}:${Pe.toString().padStart(2,"0")}`},yr=async De=>{if(E)try{const Ie=Gt();if(!Ie){dt.error("Please login to delete messages");return}const Pe=await fetch(`${Pa}/api/chats/${E.id}/messages/${De}`,{method:"DELETE",headers:{Authorization:`Bearer ${Ie}`}});if(Pe.ok)T(ze=>{const at=ze.filter(ft=>ft.id!==De);return At(E.id,at),at}),dt.success("Message deleted");else{const ze=await Pe.json().catch(()=>({}));throw new Error(ze.error||"Failed to delete message")}}catch(Ie){console.error("Error deleting message:",Ie),dt.error(Ie.message||"Failed to delete message")}},di=De=>{if(De.name)return De.name;if(De.type==="one-to-one"||De.type==="direct"){const Ie=De.members.find(Pe=>Pe.userId!==bn);return(Ie==null?void 0:Ie.user.fullName)||"Unknown User"}return"Group Chat"},ui=De=>{if(De.avatar)return De.avatar;if(De.type==="one-to-one"||De.type==="direct"){const Ie=De.members.find(Pe=>Pe.userId!==bn);return Ie==null?void 0:Ie.user.profilePicture}},xs=De=>di(De).split(" ").map(Pe=>Pe[0]).join("").toUpperCase().slice(0,2),xo=De=>{if(De.type==="one-to-one"||De.type==="direct"){const Ie=De.members.find(Pe=>Pe.userId!==bn);return Ie==null?void 0:Ie.user}return null},ws=async De=>{if(!E){dt.error("Please select a chat first");return}const Ie=xo(E);if(!Ie){dt.error("Cannot call in group chats yet");return}try{const Pe=Gt(),ze=await fetch(`${Pa}/api/calls/start`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Pe}`},body:JSON.stringify({recipientId:Ie.id,callType:De})});if(!ze.ok)throw new Error("Failed to start call");const at=await ze.json();bt({chatId:E.id,recipientId:Ie.id,recipientName:Ie.fullName,callType:De,channelName:at.channelName,token:at.token}),c&&c.emit("call:initiate",{recipientId:Ie.id,callType:De,channelName:at.channelName,caller:{id:bn,name:"You"}}),de("calls"),dt.success(`Starting ${De} call with ${Ie.fullName}...`)}catch(Pe){console.error("Error starting call:",Pe),dt.error("Failed to start call")}},hi=()=>ws("voice"),os=()=>ws("video"),wo=De=>(De.readBy||[]).some(Ie=>Ie!==De.senderId),Ai=f.filter(De=>Ne==="unread"?(De.unreadCount||0)>0:Ne==="pinned"?De.isPinned:!0).filter(De=>B?di(De).toLowerCase().includes(B.toLowerCase()):!0),qa=r==="dark";return s?d.jsxs("div",{className:`flex h-screen ${qa?"bg-[#070e18]":"bg-[#f6f8fd]"}`,children:[d.jsx("input",{type:"file",ref:vt,onChange:vn,className:"hidden",accept:"image/*,video/*,audio/*,.pdf,.doc,.docx,.txt",multiple:!1}),d.jsx("div",{className:`hidden lg:flex h-full ${qe?"flex":""}`,children:d.jsx(kRe,{activeNav:ue,onNavChange:De=>{de(De),De==="settings"&&Le(!0)},userProfile:Mn(),isOnline:!0})}),d.jsx("div",{className:"flex-1 flex flex-col overflow-hidden h-full",children:ue==="status"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Status",subtitle:"Presence, privacy, and quick context.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(KNe,{})})]}):ue==="calls"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Calls",subtitle:"Voice/video calling, meeting links, and device check.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(YNe,{})})]}):ue==="contacts"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Contacts",subtitle:"Directory, profiles, notes, import/export.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(qNe,{})})]}):ue==="live-stream"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Live Stream",subtitle:"Broadcast, moderation, and replay library.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(XNe,{})})]}):ue==="histories"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Histories",subtitle:"Messages, calls, sessions, and export tools.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(JNe,{})})]}):ue==="action-board"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Action Board",subtitle:"Tasks extracted from chats with owners, due dates, reminders.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(QNe,{})})]}):ue==="enterprise-tools"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Enterprise Tools",subtitle:"Org setup, RBAC, policies, audits, compliance.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(ZNe,{})})]}):ue==="advertise"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Advertise / Marketing",subtitle:"Campaigns, placements, creatives, approvals, analytics.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(e1e,{})})]}):ue==="thread-doc"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Thread  Doc Studio",subtitle:"Convert chat threads into structured documents, wikis, and knowledge bases.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(t1e,{})})]}):ue==="summaries"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Smart Summaries",subtitle:"AI-powered summaries of conversations, threads, and chat history.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(n1e,{})})]}):ue==="automations"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Workflow Automations",subtitle:"Create automated workflows, triggers, and actions for chat interactions.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(r1e,{})})]}):ue==="command-center"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Command Center",subtitle:"Slash commands, shortcuts, and quick actions for power users.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(s1e,{})})]}):ue==="dignity-mode"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"IRU Dignity Mode",subtitle:"Advanced content filtering and respectful communication tools.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(i1e,{})})]}):ue==="consent-controls"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Consent Controls",subtitle:"Manage your privacy preferences and data consent settings.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(o1e,{})})]}):ue==="verification"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Identity & Verification",subtitle:"Verify your identity and manage verification methods.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(a1e,{})})]}):ue==="moderation"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Reports & Moderation",subtitle:"Review and manage user reports, moderation actions, and safety incidents.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(c1e,{})})]}):ue==="privacy-center"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Privacy Center",subtitle:"Manage your privacy settings, data rights, and account security.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(l1e,{})})]}):ue==="live-studio"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Live Studio",subtitle:"Professional live streaming tools for creators and broadcasters.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(d1e,{})})]}):ue==="communities"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Community Builder",subtitle:"Create and manage communities, groups, and member engagement.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(u1e,{})})]}):ue==="monetization"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Monetization",subtitle:"Manage subscriptions, tips, revenue streams, and payment settings.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(h1e,{})})]}):ue==="content-library"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Content Library",subtitle:"Organize and manage your media files, templates, and content assets.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(p1e,{})})]}):ue==="creator-analytics"?d.jsxs(d.Fragment,{children:[d.jsx($r,{title:"Creator Analytics",subtitle:"Track your performance, audience insights, and content metrics.",searchQuery:B,onSearchChange:K,onNewAction:()=>dt.info("New action"),onMenuToggle:()=>We(!qe)}),d.jsx("div",{className:"animate-fade-in",children:d.jsx(m1e,{})})]}):d.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[d.jsx(FNe,{chats:Ai,selectedChat:E,onChatSelect:async De=>{if(console.log("Selecting chat:",De.id,De.name||"Unnamed chat",De),!De||!De.id){console.error("Invalid chat object:",De),dt.error("Invalid chat selection");return}v(De),N(""),ie(null),vt.current&&(vt.current.value="")},onUserSelect:async De=>{try{const Ie=Gt();if(!Ie){dt.error("Please login to start a chat");return}dt.info("Creating chat...");const Pe=await fetch(`${Pa}/api/chats`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Ie}`},body:JSON.stringify({type:"one-to-one",memberIds:[De.id]})});if(Pe.ok){const ze=await Pe.json();console.log("Chat created:",ze);const at={...ze,messages:ze.messages||[],members:ze.members||[]};_(ft=>{const Rt=[...ft,at];return be(Rt),Rt}),v(at),dt.success(`Chat with ${De.fullName} created!`)}else{const ze=await Pe.json().catch(()=>({})),at=ze.error||ze.message||"Failed to create chat";throw console.error("Chat creation error:",ze),new Error(at)}}catch(Ie){console.error("Error creating chat:",Ie),dt.error(Ie.message||"Failed to create chat")}},onNewChat:()=>te(!0),searchQuery:B,onSearchChange:K,filter:Ne,onFilterChange:Ce,currentUserId:bn,getChatName:di,getChatAvatar:ui,getChatInitials:xs}),d.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[d.jsx($r,{title:"Chats",subtitle:"DMs, groups, threads, and messaging composer.",searchQuery:B,onSearchChange:K,onNewAction:()=>te(!0),onMenuToggle:()=>We(!qe)}),d.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[d.jsx(BNe,{messages:E?x:[],currentUserId:bn,inputValue:R,onInputChange:ln,onSendMessage:Mr,typingUsers:L,isRecording:tt,recordingTime:Ge,onStartRecording:So,onStopRecording:ir,onCancelRecording:Jn,onSendVoice:ia,audioBlob:Re,onFileSelect:()=>{console.log("File select clicked"),vt.current&&vt.current.click()},onDeleteMessage:yr,isMessageRead:wo,formatRecordingTime:jr,chatName:E?di(E):void 0,chatAvatar:E?ui(E):void 0,onVoiceCall:E?hi:void 0,onVideoCall:E?os:void 0}),d.jsx("div",{className:"hidden xl:flex h-full",children:d.jsx($Ne,{chat:E,messages:x,onMute:()=>dt.info("Mute clicked"),onArchive:()=>dt.info("Archive clicked"),onBlockReport:()=>dt.info("Block/Report clicked"),chatName:E?di(E):void 0,chatAvatar:E?ui(E):void 0})})]})]})]})}),d.jsx(WNe,{isOpen:J,onClose:()=>te(!1),onChatCreated:De=>{try{const Ie={...De,messages:De.messages||[],members:De.members||[]};_(Pe=>{if(Pe.find(at=>at.id===Ie.id)){const at=Pe.map(ft=>ft.id===Ie.id?Ie:ft);return be(at),at}else{const at=[...Pe,Ie];return be(at),at}}),v(Ie),dt.success("Chat created successfully!")}catch(Ie){console.error("Error handling created chat:",Ie),dt.error("Failed to add chat to list")}}}),d.jsx(HNe,{isOpen:ve,onClose:()=>Le(!1),isDark:qa})]}):null},g1e=()=>{const[r,s]=V.useState([{id:"1",text:"Hello! How can I help you today?",sender:"bot",timestamp:new Date}]),[a,c]=V.useState(""),[h,f]=V.useState(!1),_=V.useRef(null),E=V.useRef(null),x=(()=>{var P;try{const M=localStorage.getItem("iru-auth");if(M)return((P=JSON.parse(M).user)==null?void 0:P.name)||"Guest"}catch{}return"Guest"})();V.useEffect(()=>{T()},[r,h]);const T=()=>{var P;(P=_.current)==null||P.scrollIntoView({behavior:"smooth"})},R=P=>{if(P.preventDefault(),!a.trim())return;const M={id:Date.now().toString(),text:a,sender:"user",timestamp:new Date};s(U=>[...U,M]),c(""),f(!0),setTimeout(()=>{f(!1);const U={id:(Date.now()+1).toString(),text:N(a),sender:"bot",timestamp:new Date};s(B=>[...B,U])},1e3+Math.random()*1e3)},N=P=>{const M=P.toLowerCase();if(M.includes("order")||M.includes("#")||/\d{4,}/.test(M)){const B=M.match(/#?(\d{4,})/);return`Your order #${B?B[1]:"1788"} has been dispatched and is on its way. You'll receive a tracking number via email shortly.`}if(M.includes("shipping")||M.includes("delivery")||M.includes("when"))return"Standard shipping takes 3-5 business days. Express shipping (1-2 days) is available at checkout.";if(M.includes("return")||M.includes("refund")||M.includes("cancel"))return"You can return items within 30 days of purchase. Please visit our Returns page or reply with your order number for assistance.";if(M.includes("payment")||M.includes("charge")||M.includes("billing"))return"For payment inquiries, please provide your order number and I can check the status of your transaction.";if(M.includes("product")||M.includes("item")||M.includes("available"))return"I can help you find products! What are you looking for? You can also browse our catalog on the website.";if(M.includes("contact")||M.includes("email")||M.includes("phone")||M.includes("whatsapp")||M.includes("address"))return`You can reach us by:
 Phone: 0795 381 733 / 0736 318 111
 WhatsApp: 0795381733
 Address: Gahanga, Kicukiro, Kigali, Rwanda

Our support team is available to assist you!`;if(M.includes("hi")||M.includes("hello")||M.includes("hey"))return"Hello! I'm here to help with any questions about your orders, products, or account. What can I assist you with?";const U=["I understand. Let me help you with that. Can you provide more details?","Thanks for reaching out! I'm here to assist you. What specific information do you need?","I can help with that! Could you share a bit more information so I can assist you better?","Got it! Let me look into that for you. Is there anything else you'd like to know?"];return U[Math.floor(Math.random()*U.length)]},L=()=>{var P;(P=E.current)==null||P.click()},j=P=>{var U;const M=(U=P.target.files)==null?void 0:U[0];if(M){const B={id:Date.now().toString(),text:` ${M.name}`,sender:"user",timestamp:new Date};s(K=>[...K,B]),P.target.value=""}},F=P=>P.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return d.jsx(Eo,{children:d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4",children:d.jsxs("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col h-[90vh] max-h-[800px]",children:[d.jsxs("div",{className:"bg-gradient-to-r from-brand-blue to-brand-cyan px-6 py-4 flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center",children:d.jsx("img",{src:wO,alt:"IRU Chat",className:"w-8 h-8"})}),d.jsxs("div",{children:[d.jsxs("h2",{className:"text-white font-semibold text-lg",children:["Hi, this is ",x,"!"]}),d.jsx("p",{className:"text-white/80 text-sm",children:"Customer Support"})]})]}),d.jsx("button",{onClick:()=>window.history.back(),className:"text-white/80 hover:text-white transition-colors","aria-label":"Close",children:d.jsx(yo,{size:20})})]}),d.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:[r.map(P=>d.jsxs("div",{className:`flex items-end space-x-2 ${P.sender==="user"?"flex-row-reverse space-x-reverse":""}`,children:[d.jsx("div",{className:`w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center ${P.sender==="bot"?"bg-gradient-to-br from-brand-blue to-brand-cyan text-white font-bold":"bg-gray-300"}`,children:P.sender==="bot"?d.jsx("span",{className:"text-sm",children:"IRU"}):d.jsx("span",{className:"text-sm text-gray-600",children:x.charAt(0).toUpperCase()})}),d.jsxs("div",{className:`max-w-[75%] rounded-2xl px-4 py-2 ${P.sender==="user"?"bg-yellow-400 text-gray-900 rounded-br-sm":"bg-white text-gray-800 rounded-bl-sm shadow-sm"}`,children:[d.jsx("p",{className:"text-sm leading-relaxed",children:P.text}),d.jsx("p",{className:`text-xs mt-1 ${P.sender==="user"?"text-gray-700":"text-gray-500"}`,children:F(P.timestamp)})]})]},P.id)),h&&d.jsxs("div",{className:"flex items-end space-x-2",children:[d.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-brand-blue to-brand-cyan flex-shrink-0 flex items-center justify-center",children:d.jsx("span",{className:"text-white text-xs font-bold",children:"IRU"})}),d.jsx("div",{className:"bg-white rounded-2xl rounded-bl-sm px-4 py-3 shadow-sm",children:d.jsxs("div",{className:"flex space-x-1",children:[d.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),d.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),d.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]}),d.jsx("div",{ref:_})]}),d.jsx("form",{onSubmit:R,className:"p-4 bg-white border-t border-gray-200",children:d.jsxs("div",{className:"flex items-end space-x-2",children:[d.jsx("button",{type:"button",onClick:L,className:"p-2 text-gray-500 hover:text-brand-blue transition-colors flex-shrink-0","aria-label":"Attach file",children:d.jsx(fA,{size:20})}),d.jsx("input",{type:"file",ref:E,className:"hidden",onChange:j,accept:"image/*,application/pdf,.doc,.docx"}),d.jsx("button",{type:"button",className:"p-2 text-gray-500 hover:text-brand-blue transition-colors flex-shrink-0","aria-label":"Take photo",children:d.jsx(pH,{size:20})}),d.jsx("div",{className:"flex-1 relative",children:d.jsx("input",{type:"text",value:a,onChange:P=>c(P.target.value),placeholder:"Type your message here",className:"w-full px-4 py-3 pr-12 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-brand-blue focus:border-transparent bg-gray-50 text-gray-900 placeholder-gray-400"})}),d.jsx("button",{type:"submit",disabled:!a.trim(),className:"p-3 rounded-full bg-gradient-to-r from-brand-blue to-brand-cyan text-white hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0","aria-label":"Send message",children:d.jsx(O0,{size:18})})]})})]})})})},YY=V.forwardRef(({className:r,...s},a)=>d.jsx("textarea",{className:Xs("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:a,...s}));YY.displayName="Textarea";const _1e=()=>{const r=[{icon:wd,title:"Call Us",content:"0795 381 733 / 0736 318 111",description:"Available for support",link:"tel:+250795381733"},{icon:wd,title:"WhatsApp",content:"0795381733",description:"Chat with us on WhatsApp",link:"https://wa.me/250795381733"},{icon:sO,title:"Visit Us",content:"Gahanga, Kicukiro",description:"Kigali, Rwanda - IRU BUSINESS GROUP Ltd"},{icon:rO,title:"Business Hours",content:"Mon - Sun",description:"08:00 AM - 8:00 PM"}];return d.jsxs(Eo,{children:[d.jsx("section",{className:"hero-bg py-24",children:d.jsx("div",{className:"container mx-auto px-4",children:d.jsxs("div",{className:"text-center max-w-4xl mx-auto",children:[d.jsxs("h1",{className:"text-5xl md:text-6xl font-bold text-text mb-6",children:["Get in ",d.jsx("span",{className:"text-gradient",children:"Touch"})]}),d.jsx("p",{className:"text-xl text-text-secondary leading-relaxed",children:"Have questions about IRU Chat? Want to discuss enterprise solutions? Our team is here to help you transform your communication experience."})]})})}),d.jsx("section",{className:"py-24 bg-bg",children:d.jsx("div",{className:"container mx-auto px-4",children:d.jsx("div",{className:"max-w-4xl mx-auto",children:d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12",children:[d.jsxs("div",{className:"card-interactive",children:[d.jsx("h2",{className:"text-3xl font-bold text-text mb-6",children:"Send us a Message"}),d.jsxs("form",{className:"space-y-6",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-text text-sm font-medium mb-2",children:"First Name *"}),d.jsx(Fu,{type:"text",placeholder:"John",className:"bg-bg-secondary border-border text-text",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-text text-sm font-medium mb-2",children:"Last Name *"}),d.jsx(Fu,{type:"text",placeholder:"Doe",className:"bg-bg-secondary border-border text-text",required:!0})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-text text-sm font-medium mb-2",children:"Email Address *"}),d.jsx(Fu,{type:"email",placeholder:"john@company.com",className:"bg-bg-secondary border-border text-text",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-text text-sm font-medium mb-2",children:"Company"}),d.jsx(Fu,{type:"text",placeholder:"Your Company",className:"bg-bg-secondary border-border text-text"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-text text-sm font-medium mb-2",children:"Subject *"}),d.jsx(Fu,{type:"text",placeholder:"How can we help you?",className:"bg-bg-secondary border-border text-text",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-text text-sm font-medium mb-2",children:"Message *"}),d.jsx(YY,{placeholder:"Tell us more about your needs...",rows:6,className:"bg-bg-secondary border-border text-text resize-none",required:!0})]}),d.jsxs(qn,{className:"btn-hero w-full",children:["Send Message",d.jsx(O0,{className:"ml-2 w-4 h-4"})]})]})]}),d.jsxs("div",{className:"space-y-8",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"text-2xl font-bold text-text mb-6",children:"Why Choose IRU Chat?"}),d.jsx("ul",{className:"space-y-4",children:["30-day free trial with full features","24/7 customer support and onboarding","Enterprise-grade security and compliance","Custom integrations and white-label options","Scalable solutions for teams of any size"].map((s,a)=>d.jsxs("li",{className:"flex items-start space-x-3",children:[d.jsx("div",{className:"w-2 h-2 bg-brand-blue rounded-full mt-2 flex-shrink-0"}),d.jsx("span",{className:"text-text-secondary",children:s})]},a))})]}),d.jsxs("div",{className:"card-interactive bg-bg-card/50",children:[d.jsx("h4",{className:"text-lg font-semibold text-text mb-4",children:"Need Immediate Help?"}),d.jsx("p",{className:"text-text-secondary mb-4",children:"For urgent support requests or technical issues, reach out to our support team directly."}),d.jsx(qn,{className:"btn-secondary w-full",children:"Contact Support"})]})]})]})})})}),d.jsx("section",{className:"py-24 bg-bg-secondary",children:d.jsx("div",{className:"container mx-auto px-4",children:d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-16",children:r.map((s,a)=>{const c=s.icon,h=s.link?d.jsx("a",{href:s.link,target:s.link.startsWith("http")?"_blank":void 0,rel:s.link.startsWith("http")?"noopener noreferrer":void 0,className:"text-xl font-bold text-gradient mb-2 hover:text-brand-cyan transition-colors",children:s.content}):d.jsx("p",{className:"text-xl font-bold text-gradient mb-2",children:s.content});return d.jsxs("div",{className:"card-interactive text-center",children:[d.jsx("div",{className:"w-16 h-16 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-brand-blue to-brand-cyan flex items-center justify-center",children:d.jsx(c,{className:"w-8 h-8 text-white"})}),d.jsx("h3",{className:"text-lg font-semibold text-text mb-2",children:s.title}),h,d.jsx("p",{className:"text-text-secondary text-sm",children:s.description})]},a)})})})})]})},y1e=()=>{const[r,s]=V.useState(null),[a,c]=V.useState(!0),[h,f]=V.useState(!1),[_,E]=V.useState(""),[v,x]=V.useState(""),T=vh(),{toast:R}=za();V.useEffect(()=>{var F,P,M;const j=localStorage.getItem("iru-auth");if(!j){T("/auth");return}try{const U=JSON.parse(j);s(U.user),E(((F=U.user)==null?void 0:F.name)||((P=U.user)==null?void 0:P.fullName)||""),x(((M=U.user)==null?void 0:M.email)||"")}catch{T("/auth")}finally{c(!1)}},[T]);const N=()=>{localStorage.removeItem("iru-auth"),R({title:"Logged out",description:"You have been successfully logged out."}),T("/")},L=async()=>{const j=localStorage.getItem("iru-auth");if(j)try{const F=JSON.parse(j);F.user.name=_,F.user.email=v,localStorage.setItem("iru-auth",JSON.stringify(F)),s(F.user),f(!1),R({title:"Profile updated",description:"Your profile has been updated successfully."})}catch{R({title:"Update failed",description:"Failed to update profile. Please try again.",variant:"destructive"})}};return a?d.jsx(Eo,{children:d.jsx("div",{className:"min-h-screen flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-blue mx-auto"}),d.jsx("p",{className:"mt-4 text-text-secondary",children:"Loading..."})]})})}):r?d.jsx(Eo,{children:d.jsx("div",{className:"min-h-screen bg-background py-16",children:d.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[d.jsxs(Fn,{to:"/",className:"inline-flex items-center text-text-secondary hover:text-text mb-6 transition-colors",children:[d.jsx(tO,{size:18,className:"mr-2"}),d.jsx("span",{className:"text-sm font-medium",children:"Back to Home"})]}),d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h1",{className:"text-4xl font-bold text-text mb-2",children:"Account Settings"}),d.jsx("p",{className:"text-text-secondary",children:"Manage your account information and preferences"})]}),d.jsxs("div",{className:"bg-bg-card rounded-2xl shadow-lg border border-border p-8 mb-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-6",children:[d.jsxs("h2",{className:"text-2xl font-semibold text-text flex items-center",children:[d.jsx(eh,{className:"mr-3 w-6 h-6 text-brand-blue"}),"Profile Information"]}),!h&&d.jsxs(qn,{variant:"outline",onClick:()=>f(!0),className:"flex items-center",children:[d.jsx(fh,{size:16,className:"mr-2"}),"Edit Profile"]})]}),d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Full Name"}),h?d.jsx("input",{type:"text",value:_,onChange:j=>E(j.target.value),className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-blue text-gray-900 bg-white"}):d.jsx("div",{className:"px-4 py-2 bg-bg-secondary rounded-lg text-text",children:r.name||r.fullName})]}),d.jsxs("div",{children:[d.jsxs("label",{className:"block text-sm font-medium text-text-secondary mb-2 flex items-center",children:[d.jsx(bS,{className:"mr-2 w-4 h-4"}),"Email Address"]}),h?d.jsx("input",{type:"email",value:v,onChange:j=>x(j.target.value),className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-blue text-gray-900 bg-white"}):d.jsx("div",{className:"px-4 py-2 bg-bg-secondary rounded-lg text-text",children:r.email})]}),r.createdAt&&d.jsxs("div",{children:[d.jsxs("label",{className:"block text-sm font-medium text-text-secondary mb-2 flex items-center",children:[d.jsx(km,{className:"mr-2 w-4 h-4"}),"Member Since"]}),d.jsx("div",{className:"px-4 py-2 bg-bg-secondary rounded-lg text-text",children:new Date(r.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]}),h&&d.jsxs("div",{className:"flex gap-3 pt-4",children:[d.jsx(qn,{onClick:L,className:"btn-hero",children:"Save Changes"}),d.jsx(qn,{variant:"outline",onClick:()=>{f(!1),E(r.name||r.fullName||""),x(r.email||"")},children:"Cancel"})]})]})]}),d.jsxs("div",{className:"bg-bg-card rounded-2xl shadow-lg border border-border p-8",children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-6",children:"Account Actions"}),d.jsx("div",{className:"space-y-4",children:d.jsxs(qn,{variant:"outline",onClick:N,className:"w-full flex items-center justify-center text-red-600 hover:text-red-700 hover:bg-red-50 border-red-200",children:[d.jsx(I0,{className:"mr-2 w-5 h-5"}),"Log Out"]})})]})]})})}):null},_r="",E1e=()=>{const[r,s]=V.useState([]),[a,c]=V.useState(!0),[h,f]=V.useState(!1),[_,E]=V.useState(null),[v,x]=V.useState({name:"",description:"",nodes:"[]",edges:"[]",isActive:!0}),{toast:T}=za();V.useEffect(()=>{R()},[]);const R=async()=>{try{const P=bs(),M=await fetch(`${_r}/api/chatflow`,{headers:{Authorization:`Bearer ${P}`}});if(M.ok){const U=await M.json();s(U)}}catch(P){console.error("Error fetching flows:",P)}finally{c(!1)}},N=()=>{E(null),x({name:"",description:"",nodes:"[]",edges:"[]",isActive:!0}),f(!0)},L=P=>{E(P),x({name:P.name,description:P.description||"",nodes:P.nodes||"[]",edges:P.edges||"[]",isActive:P.isActive}),f(!0)},j=async()=>{try{const P=bs(),M={...v,nodes:JSON.parse(v.nodes),edges:JSON.parse(v.edges)},U=_?`${_r}/api/chatflow/${_.id}`:`${_r}/api/chatflow`;(await fetch(U,{method:_?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${P}`},body:JSON.stringify(M)})).ok&&(T({title:"Success",description:`Chat flow ${_?"updated":"created"} successfully.`}),f(!1),R())}catch{T({title:"Error",description:"Failed to save chat flow.",variant:"destructive"})}},F=async P=>{if(window.confirm("Are you sure you want to delete this chat flow?"))try{const M=bs();(await fetch(`${_r}/api/chatflow/${P}`,{method:"DELETE",headers:{Authorization:`Bearer ${M}`}})).ok&&(T({title:"Success",description:"Chat flow deleted successfully."}),R())}catch{T({title:"Error",description:"Failed to delete chat flow.",variant:"destructive"})}};return a?d.jsx("div",{className:"text-center py-8",children:"Loading..."}):d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(pl,{className:"w-6 h-6 text-purple-600"}),d.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Chat Flow"})]}),d.jsxs("button",{onClick:N,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-2",children:[d.jsx(Md,{className:"w-4 h-4"})," Add Flow"]})]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(P=>d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h3",{className:"text-lg font-bold text-gray-800",children:P.name}),d.jsx("span",{className:`px-2 py-1 rounded text-xs ${P.isActive?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:P.isActive?"Active":"Inactive"})]}),P.description&&d.jsx("p",{className:"text-sm text-gray-600 mb-4",children:P.description}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("button",{onClick:()=>L(P),className:"flex-1 px-3 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 flex items-center justify-center gap-2",children:[d.jsx(fh,{className:"w-4 h-4"})," Edit"]}),d.jsx("button",{onClick:()=>F(P.id),className:"px-3 py-2 bg-red-100 text-red-700 rounded hover:bg-red-200",children:d.jsx(gh,{className:"w-4 h-4"})})]})]},P.id))}),h&&d.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:d.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[_?"Edit":"Create"," Chat Flow"]}),d.jsx("button",{onClick:()=>f(!1),children:d.jsx(yo,{className:"w-5 h-5"})})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Name"}),d.jsx("input",{type:"text",value:v.name,onChange:P=>x({...v,name:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Description"}),d.jsx("textarea",{value:v.description,onChange:P=>x({...v,description:P.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Nodes (JSON)"}),d.jsx("textarea",{value:v.nodes,onChange:P=>x({...v,nodes:P.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg font-mono text-sm bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Edges (JSON)"}),d.jsx("textarea",{value:v.edges,onChange:P=>x({...v,edges:P.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg font-mono text-sm bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("input",{type:"checkbox",checked:v.isActive,onChange:P=>x({...v,isActive:P.target.checked}),id:"flowActive"}),d.jsx("label",{htmlFor:"flowActive",className:"text-sm",children:"Active"})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("button",{onClick:j,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center justify-center gap-2",children:[d.jsx(Wm,{className:"w-4 h-4"})," Save"]}),d.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Cancel"})]})]})]})})]})},v1e=()=>{const[r,s]=V.useState([]),[a,c]=V.useState(!0),[h,f]=V.useState(!1),[_,E]=V.useState(null),[v,x]=V.useState({name:"",description:"",examples:"",responses:"",isActive:!0}),{toast:T}=za();V.useEffect(()=>{R()},[]);const R=async()=>{try{const P=bs(),M=await fetch(`${_r}/api/intent`,{headers:{Authorization:`Bearer ${P}`}});if(M.ok){const U=await M.json();s(U)}}catch(P){console.error("Error fetching intents:",P)}finally{c(!1)}},N=()=>{E(null),x({name:"",description:"",examples:"",responses:"",isActive:!0}),f(!0)},L=P=>{var M,U;E(P),x({name:P.name,description:P.description||"",examples:((M=P.examples)==null?void 0:M.join(`
`))||"",responses:((U=P.responses)==null?void 0:U.join(`
`))||"",isActive:P.isActive}),f(!0)},j=async()=>{try{const P=bs(),M={...v,examples:v.examples.split(`
`).filter(J=>J.trim()),responses:v.responses.split(`
`).filter(J=>J.trim())},U=_?`${_r}/api/intent/${_.id}`:`${_r}/api/intent`;(await fetch(U,{method:_?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${P}`},body:JSON.stringify(M)})).ok&&(T({title:"Success",description:`Intent ${_?"updated":"created"} successfully.`}),f(!1),R())}catch{T({title:"Error",description:"Failed to save intent.",variant:"destructive"})}},F=async P=>{if(window.confirm("Are you sure you want to delete this intent?"))try{const M=bs();(await fetch(`${_r}/api/intent/${P}`,{method:"DELETE",headers:{Authorization:`Bearer ${M}`}})).ok&&(T({title:"Success",description:"Intent deleted successfully."}),R())}catch{T({title:"Error",description:"Failed to delete intent.",variant:"destructive"})}};return a?d.jsx("div",{className:"text-center py-8",children:"Loading..."}):d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(pA,{className:"w-6 h-6 text-purple-600"}),d.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Intent"})]}),d.jsxs("button",{onClick:N,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-2",children:[d.jsx(Md,{className:"w-4 h-4"})," Add Intent"]})]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(P=>{var M,U;return d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h3",{className:"text-lg font-bold text-gray-800",children:P.name}),d.jsx("span",{className:`px-2 py-1 rounded text-xs ${P.isActive?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:P.isActive?"Active":"Inactive"})]}),P.description&&d.jsx("p",{className:"text-sm text-gray-600 mb-4",children:P.description}),d.jsxs("div",{className:"mb-4",children:[d.jsxs("p",{className:"text-xs font-medium text-gray-500 mb-1",children:["Examples: ",((M=P.examples)==null?void 0:M.length)||0]}),d.jsxs("p",{className:"text-xs font-medium text-gray-500",children:["Responses: ",((U=P.responses)==null?void 0:U.length)||0]})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("button",{onClick:()=>L(P),className:"flex-1 px-3 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 flex items-center justify-center gap-2",children:[d.jsx(fh,{className:"w-4 h-4"})," Edit"]}),d.jsx("button",{onClick:()=>F(P.id),className:"px-3 py-2 bg-red-100 text-red-700 rounded hover:bg-red-200",children:d.jsx(gh,{className:"w-4 h-4"})})]})]},P.id)})}),h&&d.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:d.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[_?"Edit":"Create"," Intent"]}),d.jsx("button",{onClick:()=>f(!1),children:d.jsx(yo,{className:"w-5 h-5"})})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Name"}),d.jsx("input",{type:"text",value:v.name,onChange:P=>x({...v,name:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Description"}),d.jsx("textarea",{value:v.description,onChange:P=>x({...v,description:P.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Examples (one per line)"}),d.jsx("textarea",{value:v.examples,onChange:P=>x({...v,examples:P.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Responses (one per line)"}),d.jsx("textarea",{value:v.responses,onChange:P=>x({...v,responses:P.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("input",{type:"checkbox",checked:v.isActive,onChange:P=>x({...v,isActive:P.target.checked}),id:"intentActive"}),d.jsx("label",{htmlFor:"intentActive",className:"text-sm",children:"Active"})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("button",{onClick:j,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center justify-center gap-2",children:[d.jsx(Wm,{className:"w-4 h-4"})," Save"]}),d.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Cancel"})]})]})]})})]})},b1e=()=>{var x,T,R,N,L;const[r,s]=V.useState(null),[a,c]=V.useState(null),[h,f]=V.useState(!0),[_,E]=V.useState("7days");V.useEffect(()=>{v()},[_]);const v=async()=>{try{const j=bs(),[F,P]=await Promise.all([fetch(`${_r}/api/reports/stats`,{headers:{Authorization:`Bearer ${j}`}}),fetch(`${_r}/api/reports/sessions`,{headers:{Authorization:`Bearer ${j}`}})]);if(F.ok){const M=await F.json();s(M)}if(P.ok){const M=await P.json();c(M)}}catch(j){console.error("Error fetching reports:",j)}finally{f(!1)}};return h?d.jsx("div",{className:"text-center py-8",children:"Loading..."}):d.jsxs("div",{className:"space-y-6",children:[d.jsx("div",{className:"flex items-center justify-between",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(al,{className:"w-6 h-6 text-purple-600"}),d.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Reports"})]})}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[d.jsx("div",{className:"flex items-center justify-between mb-4",children:d.jsx("div",{className:"p-3 rounded-lg bg-blue-100",children:d.jsx(Nc,{className:"w-6 h-6 text-blue-600"})})}),d.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-1",children:((x=r==null?void 0:r.totalUsers)==null?void 0:x.toLocaleString())||"0"}),d.jsx("p",{className:"text-sm text-gray-600",children:"Total Users"})]}),d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[d.jsx("div",{className:"flex items-center justify-between mb-4",children:d.jsx("div",{className:"p-3 rounded-lg bg-green-100",children:d.jsx(Nc,{className:"w-6 h-6 text-green-600"})})}),d.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-1",children:((T=r==null?void 0:r.activeUsers)==null?void 0:T.toLocaleString())||"0"}),d.jsx("p",{className:"text-sm text-gray-600",children:"Active Users (30d)"})]}),d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[d.jsx("div",{className:"flex items-center justify-between mb-4",children:d.jsx("div",{className:"p-3 rounded-lg bg-orange-100",children:d.jsx(ES,{className:"w-6 h-6 text-orange-600"})})}),d.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-1",children:((R=r==null?void 0:r.totalTransactions)==null?void 0:R.toLocaleString())||"0"}),d.jsx("p",{className:"text-sm text-gray-600",children:"Total Transactions"})]}),d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[d.jsx("div",{className:"flex items-center justify-between mb-4",children:d.jsx("div",{className:"p-3 rounded-lg bg-purple-100",children:d.jsx(vS,{className:"w-6 h-6 text-purple-600"})})}),d.jsxs("h3",{className:"text-2xl font-bold text-gray-800 mb-1",children:["RWF ",((N=r==null?void 0:r.totalRevenue)==null?void 0:N.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))||"0.00"]}),d.jsx("p",{className:"text-sm text-gray-600",children:"Total Revenue"})]})]}),d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-6",children:[d.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Chat Sessions Trend"}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{onClick:()=>E("7days"),className:`px-4 py-2 rounded-lg text-sm font-medium ${_==="7days"?"bg-purple-600 text-white":"bg-gray-100 text-gray-700"}`,children:"Last 7 Days"}),d.jsx("button",{onClick:()=>E("month"),className:`px-4 py-2 rounded-lg text-sm font-medium ${_==="month"?"bg-purple-600 text-white":"bg-gray-100 text-gray-700"}`,children:"Month"})]})]}),d.jsx("div",{className:"h-64 flex items-end justify-between gap-2",children:(L=a==null?void 0:a.trend)==null?void 0:L.map((j,F)=>{const P=j.count/100*100;return d.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[d.jsx("div",{className:"w-full bg-purple-100 rounded-t-lg relative group",children:d.jsx("div",{className:"bg-purple-600 rounded-t-lg transition-all",style:{height:`${P}%`},children:F===3&&d.jsx("div",{className:"absolute -top-2 left-1/2 transform -translate-x-1/2 w-3 h-3 bg-purple-600 rounded-full border-2 border-white"})})}),d.jsx("span",{className:"text-xs text-gray-600 mt-2",children:j.day})]},F)})})]}),(r==null?void 0:r.transactionsByStatus)&&d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[d.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Transaction Status"}),d.jsx("div",{className:"space-y-3",children:r.transactionsByStatus.map((j,F)=>d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-700 capitalize",children:j.status}),d.jsx("span",{className:"text-sm font-semibold text-gray-800",children:j._count})]},F))})]})]})},S1e=()=>{const[r,s]=V.useState([]),[a,c]=V.useState(!0),[h,f]=V.useState(!1),[_,E]=V.useState(null),[v,x]=V.useState({title:"",content:"",category:"",tags:"",isActive:!0}),{toast:T}=za();V.useEffect(()=>{R()},[]);const R=async()=>{try{const P=bs(),M=await fetch(`${_r}/api/knowledge`,{headers:{Authorization:`Bearer ${P}`}});if(M.ok){const U=await M.json();s(U)}}catch(P){console.error("Error fetching knowledge:",P)}finally{c(!1)}},N=()=>{E(null),x({title:"",content:"",category:"",tags:"",isActive:!0}),f(!0)},L=P=>{var M;E(P),x({title:P.title,content:P.content,category:P.category||"",tags:((M=P.tags)==null?void 0:M.join(", "))||"",isActive:P.isActive}),f(!0)},j=async()=>{try{const P=bs(),M={...v,tags:v.tags.split(",").map(J=>J.trim()).filter(J=>J)},U=_?`${_r}/api/knowledge/${_.id}`:`${_r}/api/knowledge`;(await fetch(U,{method:_?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${P}`},body:JSON.stringify(M)})).ok&&(T({title:"Success",description:`Knowledge base item ${_?"updated":"created"} successfully.`}),f(!1),R())}catch{T({title:"Error",description:"Failed to save knowledge base item.",variant:"destructive"})}},F=async P=>{if(window.confirm("Are you sure you want to delete this knowledge base item?"))try{const M=bs();(await fetch(`${_r}/api/knowledge/${P}`,{method:"DELETE",headers:{Authorization:`Bearer ${M}`}})).ok&&(T({title:"Success",description:"Knowledge base item deleted successfully."}),R())}catch{T({title:"Error",description:"Failed to delete knowledge base item.",variant:"destructive"})}};return a?d.jsx("div",{className:"text-center py-8",children:"Loading..."}):d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(yH,{className:"w-6 h-6 text-purple-600"}),d.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Knowledge Base"})]}),d.jsxs("button",{onClick:N,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-2",children:[d.jsx(Md,{className:"w-4 h-4"})," Add Knowledge"]})]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(P=>d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h3",{className:"text-lg font-bold text-gray-800",children:P.title}),d.jsx("span",{className:`px-2 py-1 rounded text-xs ${P.isActive?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:P.isActive?"Active":"Inactive"})]}),P.category&&d.jsx("p",{className:"text-xs text-purple-600 mb-2",children:P.category}),d.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-3",children:P.content}),P.tags&&P.tags.length>0&&d.jsx("div",{className:"flex flex-wrap gap-1 mb-4",children:P.tags.map((M,U)=>d.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs",children:M},U))}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("button",{onClick:()=>L(P),className:"flex-1 px-3 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 flex items-center justify-center gap-2",children:[d.jsx(fh,{className:"w-4 h-4"})," Edit"]}),d.jsx("button",{onClick:()=>F(P.id),className:"px-3 py-2 bg-red-100 text-red-700 rounded hover:bg-red-200",children:d.jsx(gh,{className:"w-4 h-4"})})]})]},P.id))}),h&&d.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:d.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[_?"Edit":"Create"," Knowledge Base Item"]}),d.jsx("button",{onClick:()=>f(!1),children:d.jsx(yo,{className:"w-5 h-5"})})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Title"}),d.jsx("input",{type:"text",value:v.title,onChange:P=>x({...v,title:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Content"}),d.jsx("textarea",{value:v.content,onChange:P=>x({...v,content:P.target.value}),rows:6,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Category"}),d.jsx("input",{type:"text",value:v.category,onChange:P=>x({...v,category:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Tags (comma separated)"}),d.jsx("input",{type:"text",value:v.tags,onChange:P=>x({...v,tags:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("input",{type:"checkbox",checked:v.isActive,onChange:P=>x({...v,isActive:P.target.checked}),id:"kbActive"}),d.jsx("label",{htmlFor:"kbActive",className:"text-sm",children:"Active"})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("button",{onClick:j,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center justify-center gap-2",children:[d.jsx(Wm,{className:"w-4 h-4"})," Save"]}),d.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Cancel"})]})]})]})})]})},x1e=()=>{const[r,s]=V.useState([]),[a,c]=V.useState(!0),[h,f]=V.useState(!1),[_,E]=V.useState(null),[v,x]=V.useState({key:"",value:"",description:""}),{toast:T}=za();V.useEffect(()=>{R()},[]);const R=async()=>{try{const P=bs(),M=await fetch(`${_r}/api/settings`,{headers:{Authorization:`Bearer ${P}`}});if(M.ok){const U=await M.json();s(U)}}catch(P){console.error("Error fetching settings:",P)}finally{c(!1)}},N=()=>{E(null),x({key:"",value:"",description:""}),f(!0)},L=P=>{E(P),x({key:P.key,value:P.value,description:P.description||""}),f(!0)},j=async()=>{try{const P=bs(),M=_?`${_r}/api/settings/${_.key}`:`${_r}/api/settings`;(await fetch(M,{method:_?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${P}`},body:JSON.stringify(v)})).ok&&(T({title:"Success",description:`Setting ${_?"updated":"created"} successfully.`}),f(!1),R())}catch{T({title:"Error",description:"Failed to save setting.",variant:"destructive"})}},F=async P=>{if(window.confirm("Are you sure you want to delete this setting?"))try{const M=bs();(await fetch(`${_r}/api/settings/${P}`,{method:"DELETE",headers:{Authorization:`Bearer ${M}`}})).ok&&(T({title:"Success",description:"Setting deleted successfully."}),R())}catch{T({title:"Error",description:"Failed to delete setting.",variant:"destructive"})}};return a?d.jsx("div",{className:"text-center py-8",children:"Loading..."}):d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(ch,{className:"w-6 h-6 text-purple-600"}),d.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Chatbot Settings"})]}),d.jsxs("button",{onClick:N,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-2",children:[d.jsx(Md,{className:"w-4 h-4"})," Add Setting"]})]}),d.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:d.jsxs("table",{className:"w-full",children:[d.jsx("thead",{className:"bg-gray-50",children:d.jsxs("tr",{children:[d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Key"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Value"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Description"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),d.jsx("tbody",{className:"divide-y divide-gray-200",children:r.map(P=>d.jsxs("tr",{className:"hover:bg-gray-50",children:[d.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:P.key}),d.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:P.value}),d.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:P.description||"-"}),d.jsx("td",{className:"px-6 py-4 text-sm",children:d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{onClick:()=>L(P),className:"text-purple-600 hover:text-purple-700",children:d.jsx(fh,{className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>F(P.key),className:"text-red-600 hover:text-red-700",children:d.jsx(gh,{className:"w-4 h-4"})})]})})]},P.key))})]})}),h&&d.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:d.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[_?"Edit":"Create"," Setting"]}),d.jsx("button",{onClick:()=>f(!1),children:d.jsx(yo,{className:"w-5 h-5"})})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Key"}),d.jsx("input",{type:"text",value:v.key,onChange:P=>x({...v,key:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed",disabled:!!_})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Value"}),d.jsx("textarea",{value:v.value,onChange:P=>x({...v,value:P.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Description"}),d.jsx("input",{type:"text",value:v.description,onChange:P=>x({...v,description:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("button",{onClick:j,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center justify-center gap-2",children:[d.jsx(Wm,{className:"w-4 h-4"})," Save"]}),d.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Cancel"})]})]})]})})]})},w1e=()=>{var P,M;const[r,s]=V.useState(null),[a,c]=V.useState(!0),[h,f]=V.useState("dashboard"),[_,E]=V.useState(!1),[v,x]=V.useState(!0),T=vh(),{toast:R}=za();V.useEffect(()=>{const U=CO();if(!U||!TK()){R({title:"Access Denied",description:"Please log in to access the admin dashboard.",variant:"destructive"}),T("/auth");return}if(!Mve()){R({title:"Access Denied",description:"You do not have admin privileges.",variant:"destructive"}),T("/chatbot");return}s(U),c(!1)},[T,R]);const N=()=>{CK(),R({title:"Logged out",description:"You have been successfully logged out."}),T("/")},L=[{id:"dashboard",label:"Dashboard",icon:Z8},{id:"chatflow",label:"Chat flow",icon:pl},{id:"intent",label:"Intent",icon:pA},{id:"reports",label:"Reports",icon:al},{id:"knowledge",label:"Knowledge Based",icon:yH},{id:"settings",label:"Chatbot Settings",icon:ch},{id:"pricing",label:"Pricing",icon:vS},{id:"transactions",label:"Transactions",icon:ES}],j=[{label:"Chat Sessions",value:"12,508",icon:pl,color:"text-green-600",bg:"bg-green-100"},{label:"Total Users",value:"11,432",icon:Nc,color:"text-blue-600",bg:"bg-blue-100"},{label:"Total Messages",value:"26,235",icon:al,color:"text-orange-600",bg:"bg-orange-100"},{label:"Avg. Session Time",value:"1h 30 min",icon:rO,color:"text-purple-600",bg:"bg-purple-100"}],F=[{title:"Flows",description:"Manage flows by view, edit, and add.",icon:i0e,onClick:()=>f("chatflow")},{title:"Intents",description:"You can view, edit or add new Intents.",icon:pA,onClick:()=>f("intent")},{title:"Knowledge Base",description:"Train your chatbot for better result.",icon:Cge,onClick:()=>f("knowledge")},{title:"Chat History",description:"You can view the chat history.",icon:_H,onClick:()=>f("reports")}];return a?d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),d.jsx("p",{className:"mt-4 text-gray-600",children:"Loading dashboard..."})]})}):((P=L.find(U=>U.id===h))!=null&&P.icon,d.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[d.jsxs("aside",{className:`${v?"w-64":"w-20"} bg-white border-r border-gray-200 transition-all duration-300 flex flex-col`,children:[d.jsx("div",{className:"h-16 flex items-center px-4 border-b border-gray-200",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"w-8 h-8 bg-purple-600 rounded-lg flex items-center justify-center",children:d.jsx("span",{className:"text-white text-sm font-bold",children:"C"})}),v&&d.jsx("span",{className:"text-gray-800 font-semibold",children:"chatbot"})]})}),d.jsx("nav",{className:"flex-1 py-4",children:L.map(U=>{const B=U.icon,K=h===U.id;return d.jsxs("button",{onClick:()=>f(U.id),className:`w-full flex items-center gap-3 px-4 py-3 text-left transition-colors ${K?"bg-purple-50 text-purple-600 border-r-2 border-purple-600":"text-gray-700 hover:bg-gray-50"}`,children:[d.jsx(B,{className:`w-5 h-5 ${K?"text-purple-600":"text-gray-500"}`}),v&&d.jsx("span",{className:"text-sm font-medium",children:U.label})]},U.id)})})]}),d.jsxs("div",{className:"flex-1 flex flex-col",children:[d.jsxs("header",{className:"h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6",children:[d.jsx("div",{className:"flex items-center gap-4",children:d.jsx("button",{onClick:()=>x(!v),className:"p-2 hover:bg-gray-100 rounded-lg",children:d.jsx(iO,{className:"w-5 h-5 text-gray-600"})})}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",children:d.jsx(cA,{className:"w-5 h-5 text-gray-600"})}),d.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",children:d.jsx(Bge,{className:"w-5 h-5 text-gray-600"})}),d.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",children:d.jsx(dH,{className:"w-5 h-5 text-gray-600"})}),d.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",children:d.jsx(Zv,{className:"w-5 h-5 text-gray-600"})}),d.jsxs("div",{className:"relative",children:[d.jsxs("button",{onClick:()=>E(!_),className:"flex items-center gap-2 px-3 py-2 hover:bg-gray-100 rounded-lg",children:[d.jsx("div",{className:"w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center",children:d.jsx("span",{className:"text-white text-xs font-semibold",children:((M=r==null?void 0:r.name)==null?void 0:M.charAt(0).toUpperCase())||"U"})}),v&&d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"text-sm font-medium text-gray-700",children:(r==null?void 0:r.name)||"User"}),d.jsx(mH,{className:"w-4 h-4 text-gray-500"})]})]}),_&&d.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:d.jsx("div",{className:"py-1",children:d.jsxs("button",{onClick:N,className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-50 flex items-center gap-2",children:[d.jsx(I0,{className:"w-4 h-4"}),"Logout"]})})})]})]})]}),d.jsxs("main",{className:"flex-1 p-6 overflow-y-auto",children:[h==="dashboard"&&d.jsxs("div",{className:"space-y-6",children:[d.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Dashboard"}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:j.map((U,B)=>{const K=U.icon;return d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[d.jsx("div",{className:"flex items-center justify-between mb-4",children:d.jsx("div",{className:`p-3 rounded-lg ${U.bg}`,children:d.jsx(K,{className:`w-6 h-6 ${U.color}`})})}),d.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-1",children:U.value}),d.jsx("p",{className:"text-sm text-gray-600",children:U.label})]},B)})}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[d.jsxs("div",{className:"lg:col-span-2 bg-white rounded-lg border border-gray-200 p-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-6",children:[d.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Trend of User Sessions"}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg text-sm font-medium",children:"Last 7 Days"}),d.jsx("button",{className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200",children:"Month"})]})]}),d.jsx("div",{className:"h-64 flex items-end justify-between gap-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((U,B)=>{const J=[15,12,30,50,38,60,55][B]/100*100;return d.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[d.jsx("div",{className:"w-full bg-purple-100 rounded-t-lg relative group",children:d.jsx("div",{className:"bg-purple-600 rounded-t-lg transition-all",style:{height:`${J}%`},children:B===3&&d.jsx("div",{className:"absolute -top-2 left-1/2 transform -translate-x-1/2 w-3 h-3 bg-purple-600 rounded-full border-2 border-white"})})}),d.jsx("span",{className:"text-xs text-gray-600 mt-2",children:U})]},U)})})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[d.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Quick Links"}),d.jsx("div",{className:"space-y-3",children:F.map((U,B)=>{const K=U.icon;return d.jsx("button",{onClick:U.onClick,className:"w-full p-4 bg-gray-50 hover:bg-purple-50 rounded-lg border border-gray-200 hover:border-purple-200 transition-all text-left group",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("div",{className:"p-2 bg-purple-100 rounded-lg group-hover:bg-purple-200",children:d.jsx(K,{className:"w-5 h-5 text-purple-600"})}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"font-medium text-gray-800 mb-1",children:U.title}),d.jsx("p",{className:"text-xs text-gray-600",children:U.description})]})]})},B)})})]}),d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[d.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Help & Documentation"}),d.jsx("button",{className:"w-full p-4 bg-gray-50 hover:bg-purple-50 rounded-lg border border-gray-200 hover:border-purple-200 transition-all text-left group",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("div",{className:"p-2 bg-purple-100 rounded-lg group-hover:bg-purple-200",children:d.jsx(Mge,{className:"w-5 h-5 text-purple-600"})}),d.jsx("div",{className:"flex-1",children:d.jsx("p",{className:"text-sm text-gray-700",children:"Click to view the documentation for understanding the flow and configuration for ease of use."})})]})})]})]})]})]}),h==="pricing"&&d.jsx(T1e,{}),h==="transactions"&&d.jsx(C1e,{}),h==="chatflow"&&d.jsx(E1e,{}),h==="intent"&&d.jsx(v1e,{}),h==="reports"&&d.jsx(b1e,{}),h==="knowledge"&&d.jsx(S1e,{}),h==="settings"&&d.jsx(x1e,{})]})]})]}))},T1e=()=>{const[r,s]=V.useState([]),[a,c]=V.useState(!0),[h,f]=V.useState(!1),[_,E]=V.useState(null),[v,x]=V.useState({name:"",price:"",duration:"monthly",features:"",isActive:!0}),{toast:T}=za();V.useEffect(()=>{R()},[]);const R=async()=>{try{const P=bs(),M=await fetch(`${_r}/api/pricing`,{headers:{Authorization:`Bearer ${P}`}});if(M.ok){const U=await M.json();s(U)}}catch(P){console.error("Error fetching pricing plans:",P)}finally{c(!1)}},N=()=>{E(null),x({name:"",price:"",duration:"monthly",features:"",isActive:!0}),f(!0)},L=P=>{E(P),x({name:P.name,price:P.price.toString(),duration:P.duration,features:P.features.join(`
`),isActive:P.isActive}),f(!0)},j=async()=>{try{const P=bs(),M=v.features.split(`
`).filter(te=>te.trim()),U={...v,price:parseFloat(v.price),features:M},B=_?`${_r}/api/pricing/${_.id}`:`${_r}/api/pricing`;if((await fetch(B,{method:_?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${P}`},body:JSON.stringify(U)})).ok)T({title:"Success",description:`Pricing plan ${_?"updated":"created"} successfully.`}),f(!1),R();else throw new Error("Failed to save")}catch{T({title:"Error",description:"Failed to save pricing plan.",variant:"destructive"})}},F=async P=>{if(window.confirm("Are you sure you want to delete this pricing plan?"))try{const M=bs();(await fetch(`${_r}/api/pricing/${P}`,{method:"DELETE",headers:{Authorization:`Bearer ${M}`}})).ok&&(T({title:"Success",description:"Pricing plan deleted successfully."}),R())}catch{T({title:"Error",description:"Failed to delete pricing plan.",variant:"destructive"})}};return a?d.jsx("div",{className:"text-center py-8",children:"Loading..."}):d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(vS,{className:"w-6 h-6 text-purple-600"}),d.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Pricing"})]}),d.jsxs("button",{onClick:N,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-2",children:[d.jsx(Md,{className:"w-4 h-4"}),"Add Pricing Plan"]})]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(P=>d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-gray-800",children:P.name}),d.jsx("span",{className:`px-2 py-1 rounded text-xs ${P.isActive?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:P.isActive?"Active":"Inactive"})]}),d.jsxs("div",{className:"mb-4",children:[d.jsxs("span",{className:"text-3xl font-bold text-gray-800",children:["RWF ",P.price.toLocaleString()]}),d.jsxs("span",{className:"text-gray-600",children:["/",P.duration]})]}),d.jsx("ul",{className:"space-y-2 mb-4",children:P.features.map((M,U)=>d.jsxs("li",{className:"text-sm text-gray-600 flex items-center gap-2",children:[d.jsx("span",{className:"w-1.5 h-1.5 bg-purple-600 rounded-full"}),M]},U))}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("button",{onClick:()=>L(P),className:"flex-1 px-3 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 flex items-center justify-center gap-2",children:[d.jsx(fh,{className:"w-4 h-4"}),"Edit"]}),d.jsx("button",{onClick:()=>F(P.id),className:"px-3 py-2 bg-red-100 text-red-700 rounded hover:bg-red-200 flex items-center justify-center",children:d.jsx(gh,{className:"w-4 h-4"})})]})]},P.id))}),h&&d.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:d.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[_?"Edit":"Create"," Pricing Plan"]}),d.jsx("button",{onClick:()=>f(!1),children:d.jsx(yo,{className:"w-5 h-5"})})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Name"}),d.jsx("input",{type:"text",value:v.name,onChange:P=>x({...v,name:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Price"}),d.jsx("input",{type:"number",value:v.price,onChange:P=>x({...v,price:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Duration"}),d.jsxs("select",{value:v.duration,onChange:P=>x({...v,duration:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[d.jsx("option",{value:"monthly",children:"Monthly"}),d.jsx("option",{value:"yearly",children:"Yearly"}),d.jsx("option",{value:"lifetime",children:"Lifetime"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Features (one per line)"}),d.jsx("textarea",{value:v.features,onChange:P=>x({...v,features:P.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("input",{type:"checkbox",checked:v.isActive,onChange:P=>x({...v,isActive:P.target.checked}),id:"isActive"}),d.jsx("label",{htmlFor:"isActive",className:"text-sm",children:"Active"})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("button",{onClick:j,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center justify-center gap-2",children:[d.jsx(Wm,{className:"w-4 h-4"}),"Save"]}),d.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Cancel"})]})]})]})})]})},C1e=()=>{const[r,s]=V.useState([]),[a,c]=V.useState(!0),[h,f]=V.useState(!1),[_,E]=V.useState(null),[v,x]=V.useState({userId:"",amount:"",type:"subscription",status:"pending",description:""}),[T,R]=V.useState([]),{toast:N}=za();V.useEffect(()=>{j(),L()},[]);const L=async()=>{R([])},j=async()=>{try{const B=bs(),K=await fetch(`${_r}/api/transactions`,{headers:{Authorization:`Bearer ${B}`}});if(K.ok){const J=await K.json();s(J)}}catch(B){console.error("Error fetching transactions:",B)}finally{c(!1)}},F=()=>{E(null),x({userId:"",amount:"",type:"subscription",status:"pending",description:""}),f(!0)},P=B=>{E(B),x({userId:B.userId,amount:B.amount.toString(),type:B.type,status:B.status,description:B.description||""}),f(!0)},M=async()=>{try{const B=bs(),K={...v,amount:parseFloat(v.amount)},J=_?`${_r}/api/transactions/${_.id}`:`${_r}/api/transactions`;if((await fetch(J,{method:_?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${B}`},body:JSON.stringify(K)})).ok)N({title:"Success",description:`Transaction ${_?"updated":"created"} successfully.`}),f(!1),j();else throw new Error("Failed to save")}catch{N({title:"Error",description:"Failed to save transaction.",variant:"destructive"})}},U=async B=>{if(window.confirm("Are you sure you want to delete this transaction?"))try{const K=bs();(await fetch(`${_r}/api/transactions/${B}`,{method:"DELETE",headers:{Authorization:`Bearer ${K}`}})).ok&&(N({title:"Success",description:"Transaction deleted successfully."}),j())}catch{N({title:"Error",description:"Failed to delete transaction.",variant:"destructive"})}};return a?d.jsx("div",{className:"text-center py-8",children:"Loading..."}):d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(ES,{className:"w-6 h-6 text-purple-600"}),d.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Transactions"})]}),d.jsxs("button",{onClick:F,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-2",children:[d.jsx(Md,{className:"w-4 h-4"}),"Add Transaction"]})]}),d.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:d.jsxs("table",{className:"w-full",children:[d.jsx("thead",{className:"bg-gray-50",children:d.jsxs("tr",{children:[d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"ID"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"User"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Amount"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Type"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),d.jsx("tbody",{className:"divide-y divide-gray-200",children:r.map(B=>{var K;return d.jsxs("tr",{className:"hover:bg-gray-50",children:[d.jsxs("td",{className:"px-6 py-4 text-sm text-gray-900",children:[B.id.substring(0,8),"..."]}),d.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:((K=B.user)==null?void 0:K.fullName)||B.userId}),d.jsxs("td",{className:"px-6 py-4 text-sm text-gray-900",children:["RWF ",B.amount.toLocaleString()]}),d.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 capitalize",children:B.type}),d.jsx("td",{className:"px-6 py-4",children:d.jsx("span",{className:`px-2 py-1 rounded text-xs ${B.status==="completed"?"bg-green-100 text-green-700":B.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:B.status})}),d.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:new Date(B.createdAt).toLocaleDateString()}),d.jsx("td",{className:"px-6 py-4 text-sm",children:d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{onClick:()=>P(B),className:"text-purple-600 hover:text-purple-700",children:d.jsx(fh,{className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>U(B.id),className:"text-red-600 hover:text-red-700",children:d.jsx(gh,{className:"w-4 h-4"})})]})})]},B.id)})})]})}),h&&d.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:d.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[_?"Edit":"Create"," Transaction"]}),d.jsx("button",{onClick:()=>f(!1),children:d.jsx(yo,{className:"w-5 h-5"})})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"User ID"}),d.jsx("input",{type:"text",value:v.userId,onChange:B=>x({...v,userId:B.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Amount"}),d.jsx("input",{type:"number",value:v.amount,onChange:B=>x({...v,amount:B.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Type"}),d.jsxs("select",{value:v.type,onChange:B=>x({...v,type:B.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[d.jsx("option",{value:"subscription",children:"Subscription"}),d.jsx("option",{value:"payment",children:"Payment"}),d.jsx("option",{value:"refund",children:"Refund"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Status"}),d.jsxs("select",{value:v.status,onChange:B=>x({...v,status:B.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[d.jsx("option",{value:"pending",children:"Pending"}),d.jsx("option",{value:"completed",children:"Completed"}),d.jsx("option",{value:"failed",children:"Failed"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700",children:"Description"}),d.jsx("textarea",{value:v.description,onChange:B=>x({...v,description:B.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("button",{onClick:M,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center justify-center gap-2",children:[d.jsx(Wm,{className:"w-4 h-4"}),"Save"]}),d.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Cancel"})]})]})]})})]})},R1e=()=>{const[r,s]=V.useState([]),[a,c]=V.useState(!1),[h,f]=V.useState("");V.useEffect(()=>{f("(empty - using relative URLs)")},[]);const _=T=>{s(R=>[...R,T])},E=(T,R)=>{s(N=>N.map((L,j)=>j===T?{...L,...R}:L))},v=async()=>{c(!0),s([]);const T=[{name:"1. Backend Health Check (Direct)",url:"https://iru-chat-be-production.up.railway.app",method:"GET",expectedStatus:200},{name:"2. Backend API Endpoint (Direct)",url:"https://iru-chat-be-production.up.railway.app/api",method:"GET",expectedStatus:200},{name:"3. Backend via Proxy (Frontend)",url:"/api",method:"GET",expectedStatus:200},{name:"4. Registration Endpoint (Direct)",url:"https://iru-chat-be-production.up.railway.app/api/users/register",method:"POST",body:{name:"Test User",email:`test${Date.now()}@test.com`,password:"test123"},expectedStatus:201},{name:"5. Registration Endpoint (via Proxy)",url:"/api/users/register",method:"POST",body:{name:"Test User Proxy",email:`testproxy${Date.now()}@test.com`,password:"test123"},expectedStatus:201},{name:"6. Login Endpoint (Direct)",url:"https://iru-chat-be-production.up.railway.app/api/users/login",method:"POST",body:{email:"nonexistent@test.com",password:"wrong"},expectedStatus:401},{name:"7. Login Endpoint (via Proxy)",url:"/api/users/login",method:"POST",body:{email:"nonexistent@test.com",password:"wrong"},expectedStatus:401}];for(let R=0;R<T.length;R++){const N=T[R];_({name:N.name,status:"pending",message:"Testing..."});try{const L=Date.now(),j={method:N.method||"GET",headers:{"Content-Type":"application/json"}};N.body&&(j.body=JSON.stringify(N.body));const F=await fetch(N.url,j),M=Date.now()-L;let U;const B=F.headers.get("content-type");B&&B.includes("application/json")?U=await F.json():U=await F.text();const K=N.expectedStatus?F.status===N.expectedStatus:F.ok;E(R,{status:K?"success":"error",message:K?` Success (${F.status}) - ${M}ms`:` Failed (${F.status}) - Expected ${N.expectedStatus||"2xx"}`,details:{status:F.status,statusText:F.statusText,duration:`${M}ms`,headers:Object.fromEntries(F.headers.entries()),body:U,url:N.url,method:N.method}}),await new Promise(J=>setTimeout(J,500))}catch(L){E(R,{status:"error",message:` Error: ${L.message}`,details:{error:L.message,stack:L.stack,url:N.url,method:N.method}})}}c(!1)},x=T=>{switch(T){case"success":return d.jsx(Oge,{className:"w-5 h-5 text-green-500"});case"error":return d.jsx(Dge,{className:"w-5 h-5 text-red-500"});case"pending":return d.jsx(e$,{className:"w-5 h-5 text-blue-500 animate-spin"});default:return null}};return d.jsx(Eo,{children:d.jsx("div",{className:"min-h-screen bg-background py-16",children:d.jsx("div",{className:"container mx-auto px-4 max-w-4xl",children:d.jsxs("div",{className:"bg-bg-card rounded-2xl shadow-lg border border-border p-8",children:[d.jsxs("div",{className:"mb-6",children:[d.jsx("h1",{className:"text-3xl font-bold text-text mb-2",children:"Backend Connection Test"}),d.jsx("p",{className:"text-text-secondary",children:"This page tests the connection between frontend and backend"})]}),d.jsxs("div",{className:"mb-6 p-4 bg-bg-secondary rounded-lg",children:[d.jsx("h2",{className:"text-lg font-semibold text-text mb-2",children:"Configuration"}),d.jsxs("div",{className:"space-y-2 text-sm",children:[d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-text-secondary",children:"API Base URL:"})," ",d.jsx("code",{className:"bg-bg p-1 rounded text-text",children:h})]}),d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-text-secondary",children:"Frontend URL:"})," ",d.jsx("code",{className:"bg-bg p-1 rounded text-text",children:window.location.origin})]}),d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-text-secondary",children:"Backend URL:"})," ",d.jsx("code",{className:"bg-bg p-1 rounded text-text",children:"https://iru-chat-be-production.up.railway.app"})]})]})]}),d.jsx("div",{className:"mb-6",children:d.jsx(qn,{onClick:v,disabled:a,className:"btn-hero",children:a?d.jsxs(d.Fragment,{children:[d.jsx(e$,{className:"w-4 h-4 mr-2 animate-spin"}),"Running Tests..."]}):"Run Connection Tests"})}),r.length>0&&d.jsxs("div",{className:"space-y-4",children:[d.jsx("h2",{className:"text-xl font-semibold text-text",children:"Test Results"}),r.map((T,R)=>d.jsxs("div",{className:`p-4 rounded-lg border ${T.status==="success"?"bg-green-50 border-green-200":T.status==="error"?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"}`,children:[d.jsx("div",{className:"flex items-start justify-between mb-2",children:d.jsxs("div",{className:"flex items-center gap-2",children:[x(T.status),d.jsx("h3",{className:"font-semibold text-text",children:T.name})]})}),d.jsx("p",{className:"text-sm text-text-secondary mb-2",children:T.message}),T.details&&d.jsxs("details",{className:"mt-2",children:[d.jsx("summary",{className:"cursor-pointer text-sm font-medium text-text-secondary hover:text-text",children:"View Details"}),d.jsx("pre",{className:"mt-2 p-3 bg-bg rounded text-xs overflow-auto max-h-64",children:JSON.stringify(T.details,null,2)})]})]},R))]}),d.jsx("div",{className:"mt-8 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:d.jsxs("div",{className:"flex items-start gap-2",children:[d.jsx(Ige,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-semibold text-yellow-800 mb-1",children:"Troubleshooting Tips"}),d.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1 list-disc list-inside",children:[d.jsx("li",{children:"If direct backend tests fail, check if backend server is running on port 5000"}),d.jsx("li",{children:"If proxy tests fail, restart the frontend dev server"}),d.jsx("li",{children:"Check browser console and backend terminal for error messages"}),d.jsx("li",{children:"Verify CORS settings in backend if you see CORS errors"}),d.jsx("li",{children:"Check network tab in browser DevTools to see actual requests"})]})]})]})})]})})})})},N1e=()=>{const r=Eh();return V.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",r.pathname)},[r.pathname]),d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h1",{className:"text-4xl font-bold mb-4 text-text",children:"404"}),d.jsx("p",{className:"text-xl text-text-secondary mb-4",children:"Oops! Page not found"}),d.jsx("a",{href:"/",className:"text-brand-blue hover:text-brand-cyan underline",children:"Return to Home"})]})})},A1e=()=>d.jsx(Eo,{children:d.jsx("div",{className:"min-h-screen bg-background py-16",children:d.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[d.jsxs("div",{className:"mb-8",children:[d.jsx("h1",{className:"text-4xl font-bold text-text mb-4",children:"Privacy Policy"}),d.jsxs("p",{className:"text-text-secondary",children:["Last updated: ",new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]})]}),d.jsxs("div",{className:"bg-bg-card rounded-lg p-8 space-y-8 text-text-secondary",children:[d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"1. Information We Collect"}),d.jsx("p",{className:"mb-3",children:"We collect information that you provide directly to us, including when you:"}),d.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[d.jsx("li",{children:"Create an account or profile"}),d.jsx("li",{children:"Use our services or features"}),d.jsx("li",{children:"Contact us for support or inquiries"}),d.jsx("li",{children:"Subscribe to our newsletter"}),d.jsx("li",{children:"Participate in surveys or promotions"})]}),d.jsx("p",{className:"mt-4",children:"The types of information we may collect include your name, email address, phone number, and any other information you choose to provide."})]}),d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"2. How We Use Your Information"}),d.jsx("p",{className:"mb-3",children:"We use the information we collect to:"}),d.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[d.jsx("li",{children:"Provide, maintain, and improve our services"}),d.jsx("li",{children:"Process transactions and send related information"}),d.jsx("li",{children:"Send technical notices, updates, and support messages"}),d.jsx("li",{children:"Respond to your comments, questions, and requests"}),d.jsx("li",{children:"Monitor and analyze trends, usage, and activities"}),d.jsx("li",{children:"Personalize and improve your experience"})]})]}),d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"3. Information Sharing and Disclosure"}),d.jsx("p",{className:"mb-3",children:"We do not sell, trade, or rent your personal information to third parties. We may share your information only in the following circumstances:"}),d.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[d.jsx("li",{children:"With your consent or at your direction"}),d.jsx("li",{children:"To comply with legal obligations"}),d.jsx("li",{children:"To protect our rights and safety"}),d.jsx("li",{children:"With service providers who assist us in operating our services"})]})]}),d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"4. Data Security"}),d.jsx("p",{children:"We implement appropriate technical and organizational security measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction. However, no method of transmission over the Internet or electronic storage is 100% secure."})]}),d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"5. Your Rights"}),d.jsx("p",{className:"mb-3",children:"You have the right to:"}),d.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[d.jsx("li",{children:"Access and receive a copy of your personal data"}),d.jsx("li",{children:"Rectify inaccurate or incomplete data"}),d.jsx("li",{children:"Request deletion of your personal data"}),d.jsx("li",{children:"Object to processing of your personal data"}),d.jsx("li",{children:"Request restriction of processing"}),d.jsx("li",{children:"Data portability"})]})]}),d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"6. Cookies and Tracking Technologies"}),d.jsx("p",{children:"We use cookies and similar tracking technologies to track activity on our service and hold certain information. You can instruct your browser to refuse all cookies or to indicate when a cookie is being sent."})]}),d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"7. Changes to This Privacy Policy"}),d.jsx("p",{children:'We may update our Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page and updating the "Last updated" date.'})]}),d.jsxs("section",{className:"bg-bg-secondary rounded-lg p-6 border border-border",children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"8. Contact Us"}),d.jsx("p",{className:"mb-4",children:"If you have any questions about this Privacy Policy or our data practices, please contact us:"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(bS,{className:"w-5 h-5 text-brand-blue"}),d.jsx("a",{href:"mailto:irubusinessgroup@gmail.com",className:"text-brand-blue hover:text-brand-cyan transition-colors",children:"irubusinessgroup@gmail.com"})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(wd,{className:"w-5 h-5 text-brand-blue"}),d.jsx("a",{href:"tel:+250795381733",className:"text-brand-blue hover:text-brand-cyan transition-colors",children:"+250 795 381 733 / +250 736 318 111"})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(sO,{className:"w-5 h-5 text-brand-blue"}),d.jsx("span",{className:"text-text-secondary",children:"Gahanga, Kicukiro, Kigali, Rwanda"})]})]}),d.jsx("div",{className:"mt-6 pt-6 border-t border-border",children:d.jsx(Fn,{to:"/contact",className:"inline-block px-6 py-2 bg-brand-blue text-white rounded-lg hover:bg-brand-cyan transition-colors",children:"Contact Us"})})]})]})]})})}),I1e=()=>d.jsx(Eo,{children:d.jsx("div",{className:"min-h-screen bg-background py-16",children:d.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[d.jsxs("div",{className:"mb-8",children:[d.jsx("h1",{className:"text-4xl font-bold text-text mb-4",children:"Terms of Service"}),d.jsxs("p",{className:"text-text-secondary",children:["Last updated: ",new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]})]}),d.jsxs("div",{className:"bg-bg-card rounded-lg p-8 space-y-8 text-text-secondary",children:[d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"1. Acceptance of Terms"}),d.jsx("p",{children:'By accessing and using IRU Chat ("the Service"), you accept and agree to be bound by the terms and provision of this agreement. If you do not agree to abide by the above, please do not use this service.'})]}),d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"2. Use License"}),d.jsx("p",{className:"mb-3",children:"Permission is granted to temporarily use IRU Chat for personal and commercial use. This is the grant of a license, not a transfer of title, and under this license you may not:"}),d.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[d.jsx("li",{children:"Modify or copy the materials"}),d.jsx("li",{children:"Use the materials for any commercial purpose or for any public display"}),d.jsx("li",{children:"Attempt to reverse engineer any software contained in IRU Chat"}),d.jsx("li",{children:"Remove any copyright or other proprietary notations from the materials"}),d.jsx("li",{children:'Transfer the materials to another person or "mirror" the materials on any other server'})]})]}),d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"3. User Accounts"}),d.jsx("p",{className:"mb-3",children:"When you create an account with us, you must provide information that is accurate, complete, and current at all times. You are responsible for:"}),d.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[d.jsx("li",{children:"Maintaining the confidentiality of your account and password"}),d.jsx("li",{children:"Restricting access to your computer and account"}),d.jsx("li",{children:"All activities that occur under your account"}),d.jsx("li",{children:"Notifying us immediately of any unauthorized use of your account"})]})]}),d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"4. Acceptable Use"}),d.jsx("p",{className:"mb-3",children:"You agree not to use the Service to:"}),d.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[d.jsx("li",{children:"Violate any applicable laws or regulations"}),d.jsx("li",{children:"Infringe upon the rights of others"}),d.jsx("li",{children:"Transmit any harmful, offensive, or illegal content"}),d.jsx("li",{children:"Interfere with or disrupt the Service or servers"}),d.jsx("li",{children:"Attempt to gain unauthorized access to any portion of the Service"}),d.jsx("li",{children:"Collect or store personal data about other users"})]})]}),d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"5. Intellectual Property"}),d.jsx("p",{children:"The Service and its original content, features, and functionality are and will remain the exclusive property of IRU Business Group and its licensors. The Service is protected by copyright, trademark, and other laws."})]}),d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"6. Termination"}),d.jsx("p",{children:"We may terminate or suspend your account and bar access to the Service immediately, without prior notice or liability, for any reason whatsoever, including without limitation if you breach the Terms."})]}),d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"7. Disclaimer"}),d.jsx("p",{children:'The information on this Service is provided on an "as is" basis. To the fullest extent permitted by law, IRU Business Group excludes all representations, warranties, and conditions relating to our Service and the use of this Service.'})]}),d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"8. Limitation of Liability"}),d.jsx("p",{children:"In no event shall IRU Business Group, nor its directors, employees, partners, agents, suppliers, or affiliates, be liable for any indirect, incidental, special, consequential, or punitive damages, including without limitation, loss of profits, data, use, goodwill, or other intangible losses, resulting from your use of the Service."})]}),d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"9. Governing Law"}),d.jsx("p",{children:"These Terms shall be interpreted and governed by the laws of Rwanda, without regard to its conflict of law provisions."})]}),d.jsxs("section",{children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"10. Changes to Terms"}),d.jsx("p",{children:"We reserve the right, at our sole discretion, to modify or replace these Terms at any time. If a revision is material, we will provide at least 30 days notice prior to any new terms taking effect."})]}),d.jsxs("section",{className:"bg-bg-secondary rounded-lg p-6 border border-border",children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"11. Contact Information"}),d.jsx("p",{className:"mb-4",children:"If you have any questions about these Terms of Service, please contact us:"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(bS,{className:"w-5 h-5 text-brand-blue"}),d.jsx("a",{href:"mailto:irubusinessgroup@gmail.com",className:"text-brand-blue hover:text-brand-cyan transition-colors",children:"irubusinessgroup@gmail.com"})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(wd,{className:"w-5 h-5 text-brand-blue"}),d.jsx("a",{href:"tel:+250795381733",className:"text-brand-blue hover:text-brand-cyan transition-colors",children:"+250 795 381 733 / +250 736 318 111"})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(sO,{className:"w-5 h-5 text-brand-blue"}),d.jsx("span",{className:"text-text-secondary",children:"Gahanga, Kicukiro, Kigali, Rwanda"})]})]}),d.jsx("div",{className:"mt-6 pt-6 border-t border-border",children:d.jsx(Fn,{to:"/contact",className:"inline-block px-6 py-2 bg-brand-blue text-white rounded-lg hover:bg-brand-cyan transition-colors",children:"Contact Us"})})]})]})]})})}),O1e=()=>{const r=[{name:"Home",path:"/",icon:hA,description:"Main landing page"},{name:"Features",path:"/features",icon:Mb,description:"Explore all our features"},{name:"Solutions",path:"/solutions",icon:uH,description:"Business solutions"},{name:"Pricing",path:"/pricing",icon:vS,description:"View pricing plans"},{name:"About",path:"/about",icon:eh,description:"Learn about us"},{name:"Contact",path:"/contact",icon:bS,description:"Get in touch"}],s=[{name:"Chat",path:"/chat",icon:pl,description:"Community chat interface"},{name:"Account",path:"/account",icon:eh,description:"Manage your account"},{name:"Sign In / Sign Up",path:"/auth",icon:km,description:"Authentication"}],a=[{name:"Privacy Policy",path:"/privacy-policy",icon:al,description:"Our privacy policy"},{name:"Terms of Service",path:"/terms-of-service",icon:al,description:"Terms and conditions"},{name:"Sitemap",path:"/sitemap",icon:Kge,description:"Site navigation map"}],c=({page:h})=>{const f=h.icon;return d.jsx(Fn,{to:h.path,className:"block p-6 bg-bg-card rounded-lg border border-border hover:border-brand-blue hover:shadow-lg transition-all duration-300 group",children:d.jsxs("div",{className:"flex items-start gap-4",children:[d.jsx("div",{className:"p-3 bg-brand-blue/10 rounded-lg group-hover:bg-brand-blue/20 transition-colors",children:d.jsx(f,{className:"w-6 h-6 text-brand-blue"})}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-lg font-semibold text-text mb-1 group-hover:text-brand-blue transition-colors",children:h.name}),d.jsx("p",{className:"text-sm text-text-secondary",children:h.description}),d.jsx("span",{className:"text-xs text-brand-blue mt-2 inline-block group-hover:underline",children:"Visit page "})]})]})})};return d.jsx(Eo,{children:d.jsx("div",{className:"min-h-screen bg-background py-16",children:d.jsxs("div",{className:"container mx-auto px-4 max-w-6xl",children:[d.jsxs("div",{className:"mb-12 text-center",children:[d.jsx("h1",{className:"text-4xl font-bold text-text mb-4",children:"Sitemap"}),d.jsx("p",{className:"text-text-secondary text-lg",children:"Navigate through all pages of IRU Chat"})]}),d.jsxs("div",{className:"space-y-12",children:[d.jsxs("section",{children:[d.jsxs("h2",{className:"text-2xl font-semibold text-text mb-6 flex items-center gap-2",children:[d.jsx(hA,{className:"w-6 h-6 text-brand-blue"}),"Main Pages"]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(h=>d.jsx(c,{page:h},h.path))})]}),d.jsxs("section",{children:[d.jsxs("h2",{className:"text-2xl font-semibold text-text mb-6 flex items-center gap-2",children:[d.jsx(eh,{className:"w-6 h-6 text-brand-blue"}),"User Pages"]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(h=>d.jsx(c,{page:h},h.path))})]}),d.jsxs("section",{children:[d.jsxs("h2",{className:"text-2xl font-semibold text-text mb-6 flex items-center gap-2",children:[d.jsx(al,{className:"w-6 h-6 text-brand-blue"}),"Legal & Information"]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(h=>d.jsx(c,{page:h},h.path))})]}),d.jsxs("section",{className:"bg-bg-card rounded-lg p-8 border border-border",children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-6",children:"Quick Links"}),d.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[...r,...s,...a].map(h=>d.jsx(Fn,{to:h.path,className:"text-brand-blue hover:text-brand-cyan hover:underline transition-colors text-sm",children:h.name},h.path))})]}),d.jsxs("section",{className:"bg-bg-secondary rounded-lg p-8 border border-border",children:[d.jsx("h2",{className:"text-2xl font-semibold text-text mb-4",children:"Need Help?"}),d.jsx("p",{className:"text-text-secondary mb-6",children:"If you can't find what you're looking for, feel free to contact us."}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[d.jsx(Fn,{to:"/contact",className:"inline-block px-6 py-3 bg-brand-blue text-white rounded-lg hover:bg-brand-cyan transition-colors text-center",children:"Contact Us"}),d.jsx("a",{href:"mailto:irubusinessgroup@gmail.com",className:"inline-block px-6 py-3 bg-bg-card border border-border text-text rounded-lg hover:border-brand-blue transition-colors text-center",children:"Email Us"})]})]})]})]})})})},P1e=new DEe,D1e=()=>d.jsx(K0e,{attribute:"class",defaultTheme:"dark",enableSystem:!0,children:d.jsx(LEe,{client:P1e,children:d.jsxs(lEe,{children:[d.jsx(W0e,{}),d.jsx(w_e,{}),d.jsx(Ove,{children:d.jsxs(wve,{children:[d.jsx(Gs,{path:"/",element:d.jsx(gCe,{})}),d.jsx(Gs,{path:"/features",element:d.jsx(yCe,{})}),d.jsx(Gs,{path:"/solutions",element:d.jsx(ECe,{})}),d.jsx(Gs,{path:"/chat",element:d.jsx(f1e,{})}),d.jsx(Gs,{path:"/support",element:d.jsx(g1e,{})}),d.jsx(Gs,{path:"/auth",element:d.jsx(SCe,{})}),d.jsx(Gs,{path:"/account",element:d.jsx(y1e,{})}),d.jsx(Gs,{path:"/admin",element:d.jsx(w1e,{})}),d.jsx(Gs,{path:"/pricing",element:d.jsx(bCe,{})}),d.jsx(Gs,{path:"/about",element:d.jsx(xCe,{})}),d.jsx(Gs,{path:"/contact",element:d.jsx(_1e,{})}),d.jsx(Gs,{path:"/backend-test",element:d.jsx(R1e,{})}),d.jsx(Gs,{path:"/privacy-policy",element:d.jsx(A1e,{})}),d.jsx(Gs,{path:"/terms-of-service",element:d.jsx(I1e,{})}),d.jsx(Gs,{path:"/sitemap",element:d.jsx(O1e,{})}),d.jsx(Gs,{path:"*",element:d.jsx(N1e,{})})]})})]})})});D9(document.getElementById("root")).render(d.jsx(D1e,{}));
